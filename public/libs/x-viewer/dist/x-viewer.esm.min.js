/**
 * x-viewer v0.3.0 build Thu Feb 22 2024
 * https://x-viewer.github.io/x-viewer-examples/
 * Copyright 2024 x-viewer
 * @license UNLICENSED
 */
var gDe=Object.create,vx=Object.defineProperty,vDe=Object.defineProperties,yDe=Object.getOwnPropertyDescriptor,bDe=Object.getOwnPropertyDescriptors,xDe=Object.getOwnPropertyNames,uX=Object.getOwnPropertySymbols,hX=Object.getPrototypeOf,dX=Object.prototype.hasOwnProperty,EDe=Object.prototype.propertyIsEnumerable,_De=Reflect.get,Ga=Math.pow,ik=(e,t,r)=>t in e?vx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,on=(e,t)=>{for(var r in t||(t={}))dX.call(t,r)&&ik(e,r,t[r]);if(uX)for(var r of uX(t))EDe.call(t,r)&&ik(e,r,t[r]);return e},Ii=(e,t)=>vDe(e,bDe(t)),sk=(e=>"undefined"!=typeof require?require:"undefined"!=typeof Proxy?new Proxy(e,{get:(e,t)=>("undefined"!=typeof require?require:e)[t]}):e)((function(e){if("undefined"!=typeof require)return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')})),TDe=(e,t)=>()=>(e&&(t=e(e=0)),t),$=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),fX=(e,t)=>{for(var r in t)vx(e,r,{get:t[r],enumerable:!0})},pX=(e,t,r,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let n of xDe(t))!dX.call(e,n)&&n!==r&&vx(e,n,{get:()=>t[n],enumerable:!(i=yDe(t,n))||i.enumerable});return e},ra=(e,t,r)=>(r=null!=e?gDe(hX(e)):{},pX(!t&&e&&e.__esModule?r:vx(r,"default",{value:e,enumerable:!0}),e)),wDe=e=>pX(vx({},"__esModule",{value:!0}),e),Es=(e,t,r)=>(ik(e,"symbol"!=typeof t?t+"":t,r),r),ak=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},ce=(e,t,r)=>(ak(e,t,"read from private field"),r?r.call(e):t.get(e)),at=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},Bt=(e,t,r,i)=>(ak(e,t,"write to private field"),i?i.call(e,r):t.set(e,r),r),AM=(e,t,r,i)=>({set _(i){Bt(e,t,i,r)},get _(){return ce(e,t,i)}}),Et=(e,t,r)=>(ak(e,t,"access private method"),r),mX=(e,t,r)=>_De(hX(e),r,t),bt=(e,t,r)=>new Promise(((i,n)=>{var a=e=>{try{o(r.next(e))}catch(e){n(e)}},s=e=>{try{o(r.throw(e))}catch(e){n(e)}},o=e=>e.done?i(e.value):Promise.resolve(e.value).then(a,s);o((r=r.apply(e,t)).next())})),yX={};function RM(e){return(RM="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function MDe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function gX(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ADe(e,t,r){return t&&gX(e.prototype,t),r&&gX(e,r),e}function IDe(e,t,r){var i=function(e){do{if(t(e))return e;e=e.replace(/-?[^-]*$/,"")}while(e);return null},n=function(){function n(r){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};MDe(this,n),this._locale=function(e){for(var t=vX(e),r=0;r<t.length;++r){var n=i(t[r]);if(n)return n}return i(CDe())}(r),this._select=t(this._locale),this._type=PDe(a.type),this._nf=new e("en",a)}return ADe(n,[{key:"resolvedOptions",value:function(){var e=this._nf.resolvedOptions(),t=e.minimumIntegerDigits,i=e.minimumFractionDigits,n=e.maximumFractionDigits,a=e.minimumSignificantDigits,s=e.maximumSignificantDigits,o={locale:this._locale,minimumIntegerDigits:t,minimumFractionDigits:i,maximumFractionDigits:n,pluralCategories:r(this._locale,"ordinal"===this._type),type:this._type};return"number"==typeof a&&(o.minimumSignificantDigits=a,o.maximumSignificantDigits=s),o}},{key:"select",value:function(e){if(!(this instanceof n))throw new TypeError("select() called on incompatible ".concat(this));if("number"!=typeof e&&(e=Number(e)),!isFinite(e))return"other";var t=this._nf.format(Math.abs(e));return this._select(t,"ordinal"===this._type)}}],[{key:"supportedLocalesOf",value:function(e){return vX(e).filter(i)}}]),n}();return Object.defineProperty(n,"prototype",{writable:!1}),n}fX(yX,{default:()=>IDe});var RDe,vX,CDe,PDe,bX=TDe((()=>{RDe=function(e){return e.split("-").every((function(e){return/[a-z0-9]+/i.test(e)}))},vX=function(e){if(!e)return[];Array.isArray(e)||(e=[e]);for(var t={},r=0;r<e.length;++r){var i=e[r];if(i&&"object"===RM(i)&&(i=String(i)),"string"!=typeof i){var n="Locales should be strings, ".concat(JSON.stringify(i)," isn't.");throw new TypeError(n)}if("*"!==i[0]){if(!RDe(i)){var a=JSON.stringify(i),s="The locale ".concat(a," is not a structurally valid BCP 47 language tag.");throw new RangeError(s)}t[i]=!0}}return Object.keys(t)},CDe=function(){return"undefined"!=typeof navigator&&navigator&&(navigator.userLanguage||navigator.language)||"en-US"},PDe=function(e){if(!e)return"cardinal";if("cardinal"===e||"ordinal"===e)return e;throw new RangeError("Not a valid plural type: "+JSON.stringify(e))}})),_X=$(((e,t)=>{"use strict";function r(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var i=function(){function e(t,r){var i=r.minimumIntegerDigits,n=r.minimumFractionDigits,a=r.maximumFractionDigits,s=r.minimumSignificantDigits,o=r.maximumSignificantDigits;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._minID="number"==typeof i?i:1,this._minFD="number"==typeof n?n:0,this._maxFD="number"==typeof a?a:Math.max(this._minFD,3),("number"==typeof s||"number"==typeof o)&&(this._minSD="number"==typeof s?s:1,this._maxSD="number"==typeof o?o:21)}return function(e,t,i){t&&r(e.prototype,t),i&&r(e,i)}(e,[{key:"resolvedOptions",value:function(){var e={minimumIntegerDigits:this._minID,minimumFractionDigits:this._minFD,maximumFractionDigits:this._maxFD};return"number"==typeof this._minSD&&(e.minimumSignificantDigits=this._minSD,e.maximumSignificantDigits=this._maxSD),e}},{key:"format",value:function(e){if(this._minSD){for(var t=String(e),r=0,i=0;i<t.length;++i){var n=t[i];n>="0"&&n<="9"&&++r}return r<this._minSD?e.toPrecision(this._minSD):r>this._maxSD?e.toPrecision(this._maxSD):t}return this._minFD>0?e.toFixed(this._minFD):0===this._maxFD?e.toFixed(0):String(e)}}]),e}();t.exports=i})),PX=$(((e,t)=>{"use strict";var r=(bX(),wDe(yX)),i=_X();function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=n(r),s=n(i);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var h,c,u,d,p,f,m,g,v={exports:{}};h=v,u=function(e,t){return t?"other":1==e?"one":"other"},d=function(e,t){return t?"other":0==e||1==e?"one":"other"},p=function(e,t){return t?"other":e>=0&&e<=1?"one":"other"},f=function(e,t){var r=!String(e).split(".")[1];return t?"other":1==e&&r?"one":"other"},g=function(e,t){return t?"other":1==e?"one":2==e?"two":"other"},c={_in:m=function(e,t){return"other"},af:u,ak:d,am:p,an:u,ar:function(e,t){var r=String(e).split("."),i=Number(r[0])==e&&r[0].slice(-2);return t?"other":0==e?"zero":1==e?"one":2==e?"two":i>=3&&i<=10?"few":i>=11&&i<=99?"many":"other"},ars:function(e,t){var r=String(e).split("."),i=Number(r[0])==e&&r[0].slice(-2);return t?"other":0==e?"zero":1==e?"one":2==e?"two":i>=3&&i<=10?"few":i>=11&&i<=99?"many":"other"},as:function(e,t){return t?1==e||5==e||7==e||8==e||9==e||10==e?"one":2==e||3==e?"two":4==e?"few":6==e?"many":"other":e>=0&&e<=1?"one":"other"},asa:u,ast:f,az:function(e,t){var r=String(e).split(".")[0],i=r.slice(-1),n=r.slice(-2),a=r.slice(-3);return t?1==i||2==i||5==i||7==i||8==i||20==n||50==n||70==n||80==n?"one":3==i||4==i||100==a||200==a||300==a||400==a||500==a||600==a||700==a||800==a||900==a?"few":0==r||6==i||40==n||60==n||90==n?"many":"other":1==e?"one":"other"},be:function(e,t){var r=String(e).split("."),i=Number(r[0])==e,n=i&&r[0].slice(-1),a=i&&r[0].slice(-2);return t?2!=n&&3!=n||12==a||13==a?"other":"few":1==n&&11!=a?"one":n>=2&&n<=4&&(a<12||a>14)?"few":i&&0==n||n>=5&&n<=9||a>=11&&a<=14?"many":"other"},bem:u,bez:u,bg:u,bho:d,bm:m,bn:function(e,t){return t?1==e||5==e||7==e||8==e||9==e||10==e?"one":2==e||3==e?"two":4==e?"few":6==e?"many":"other":e>=0&&e<=1?"one":"other"},bo:m,br:function(e,t){var r=String(e).split("."),i=Number(r[0])==e,n=i&&r[0].slice(-1),a=i&&r[0].slice(-2),s=i&&r[0].slice(-6);return t?"other":1==n&&11!=a&&71!=a&&91!=a?"one":2==n&&12!=a&&72!=a&&92!=a?"two":(3==n||4==n||9==n)&&(a<10||a>19)&&(a<70||a>79)&&(a<90||a>99)?"few":0!=e&&i&&0==s?"many":"other"},brx:u,bs:function(e,t){var r=String(e).split("."),i=r[0],n=r[1]||"",a=!r[1],s=i.slice(-1),o=i.slice(-2),l=n.slice(-1),h=n.slice(-2);return t?"other":a&&1==s&&11!=o||1==l&&11!=h?"one":a&&s>=2&&s<=4&&(o<12||o>14)||l>=2&&l<=4&&(h<12||h>14)?"few":"other"},ca:function(e,t){var r=!String(e).split(".")[1];return t?1==e||3==e?"one":2==e?"two":4==e?"few":"other":1==e&&r?"one":"other"},ce:u,ceb:function(e,t){var r=String(e).split("."),i=r[0],n=r[1]||"",a=!r[1],s=i.slice(-1),o=n.slice(-1);return t?"other":a&&(1==i||2==i||3==i)||a&&4!=s&&6!=s&&9!=s||!a&&4!=o&&6!=o&&9!=o?"one":"other"},cgg:u,chr:u,ckb:u,cs:function(e,t){var r=String(e).split("."),i=r[0],n=!r[1];return t?"other":1==e&&n?"one":i>=2&&i<=4&&n?"few":n?"other":"many"},cy:function(e,t){return t?0==e||7==e||8==e||9==e?"zero":1==e?"one":2==e?"two":3==e||4==e?"few":5==e||6==e?"many":"other":0==e?"zero":1==e?"one":2==e?"two":3==e?"few":6==e?"many":"other"},da:function(e,t){var r=String(e).split("."),i=r[0],n=Number(r[0])==e;return t||1!=e&&(n||0!=i&&1!=i)?"other":"one"},de:f,doi:p,dsb:function(e,t){var r=String(e).split("."),i=r[0],n=r[1]||"",a=!r[1],s=i.slice(-2),o=n.slice(-2);return t?"other":a&&1==s||1==o?"one":a&&2==s||2==o?"two":a&&(3==s||4==s)||3==o||4==o?"few":"other"},dv:u,dz:m,ee:u,el:u,en:function(e,t){var r=String(e).split("."),i=!r[1],n=Number(r[0])==e,a=n&&r[0].slice(-1),s=n&&r[0].slice(-2);return t?1==a&&11!=s?"one":2==a&&12!=s?"two":3==a&&13!=s?"few":"other":1==e&&i?"one":"other"},eo:u,es:u,et:f,eu:u,fa:p,ff:function(e,t){return t?"other":e>=0&&e<2?"one":"other"},fi:f,fil:function(e,t){var r=String(e).split("."),i=r[0],n=r[1]||"",a=!r[1],s=i.slice(-1),o=n.slice(-1);return t?1==e?"one":"other":a&&(1==i||2==i||3==i)||a&&4!=s&&6!=s&&9!=s||!a&&4!=o&&6!=o&&9!=o?"one":"other"},fo:u,fr:function(e,t){var r=String(e).split("."),i=r[0],n=!r[1],a=i.slice(-6);return t?1==e?"one":"other":e>=0&&e<2?"one":0!=i&&0==a&&n?"many":"other"},fur:u,fy:f,ga:function(e,t){var r=String(e).split("."),i=Number(r[0])==e;return t?1==e?"one":"other":1==e?"one":2==e?"two":i&&e>=3&&e<=6?"few":i&&e>=7&&e<=10?"many":"other"},gd:function(e,t){var r=String(e).split("."),i=Number(r[0])==e;return t?1==e||11==e?"one":2==e||12==e?"two":3==e||13==e?"few":"other":1==e||11==e?"one":2==e||12==e?"two":i&&e>=3&&e<=10||i&&e>=13&&e<=19?"few":"other"},gl:f,gsw:u,gu:function(e,t){return t?1==e?"one":2==e||3==e?"two":4==e?"few":6==e?"many":"other":e>=0&&e<=1?"one":"other"},guw:d,gv:function(e,t){var r=String(e).split("."),i=r[0],n=!r[1],a=i.slice(-1),s=i.slice(-2);return t?"other":n&&1==a?"one":n&&2==a?"two":!n||0!=s&&20!=s&&40!=s&&60!=s&&80!=s?n?"other":"many":"few"},ha:u,haw:u,he:function(e,t){var r=String(e).split("."),i=r[0],n=!r[1],a=Number(r[0])==e,s=a&&r[0].slice(-1);return t?"other":1==e&&n?"one":2==i&&n?"two":n&&(e<0||e>10)&&a&&0==s?"many":"other"},hi:function(e,t){return t?1==e?"one":2==e||3==e?"two":4==e?"few":6==e?"many":"other":e>=0&&e<=1?"one":"other"},hr:function(e,t){var r=String(e).split("."),i=r[0],n=r[1]||"",a=!r[1],s=i.slice(-1),o=i.slice(-2),l=n.slice(-1),h=n.slice(-2);return t?"other":a&&1==s&&11!=o||1==l&&11!=h?"one":a&&s>=2&&s<=4&&(o<12||o>14)||l>=2&&l<=4&&(h<12||h>14)?"few":"other"},hsb:function(e,t){var r=String(e).split("."),i=r[0],n=r[1]||"",a=!r[1],s=i.slice(-2),o=n.slice(-2);return t?"other":a&&1==s||1==o?"one":a&&2==s||2==o?"two":a&&(3==s||4==s)||3==o||4==o?"few":"other"},hu:function(e,t){return t?1==e||5==e?"one":"other":1==e?"one":"other"},hy:function(e,t){return t?1==e?"one":"other":e>=0&&e<2?"one":"other"},ia:f,id:m,ig:m,ii:m,io:f,is:function(e,t){var r=String(e).split("."),i=r[0],n=Number(r[0])==e,a=i.slice(-1),s=i.slice(-2);return t?"other":n&&1==a&&11!=s||!n?"one":"other"},it:function(e,t){var r=!String(e).split(".")[1];return t?11==e||8==e||80==e||800==e?"many":"other":1==e&&r?"one":"other"},iu:g,iw:function(e,t){var r=String(e).split("."),i=r[0],n=!r[1],a=Number(r[0])==e,s=a&&r[0].slice(-1);return t?"other":1==e&&n?"one":2==i&&n?"two":n&&(e<0||e>10)&&a&&0==s?"many":"other"},ja:m,jbo:m,jgo:u,ji:f,jmc:u,jv:m,jw:m,ka:function(e,t){var r=String(e).split(".")[0],i=r.slice(-2);return t?1==r?"one":0==r||i>=2&&i<=20||40==i||60==i||80==i?"many":"other":1==e?"one":"other"},kab:function(e,t){return t?"other":e>=0&&e<2?"one":"other"},kaj:u,kcg:u,kde:m,kea:m,kk:function(e,t){var r=String(e).split("."),i=Number(r[0])==e,n=i&&r[0].slice(-1);return t?6==n||9==n||i&&0==n&&0!=e?"many":"other":1==e?"one":"other"},kkj:u,kl:u,km:m,kn:p,ko:m,ks:u,ksb:u,ksh:function(e,t){return t?"other":0==e?"zero":1==e?"one":"other"},ku:u,kw:function(e,t){var r=String(e).split("."),i=Number(r[0])==e,n=i&&r[0].slice(-2),a=i&&r[0].slice(-3),s=i&&r[0].slice(-5),o=i&&r[0].slice(-6);return t?i&&e>=1&&e<=4||n>=1&&n<=4||n>=21&&n<=24||n>=41&&n<=44||n>=61&&n<=64||n>=81&&n<=84?"one":5==e||5==n?"many":"other":0==e?"zero":1==e?"one":2==n||22==n||42==n||62==n||82==n||i&&0==a&&(s>=1e3&&s<=2e4||4e4==s||6e4==s||8e4==s)||0!=e&&1e5==o?"two":3==n||23==n||43==n||63==n||83==n?"few":1==e||1!=n&&21!=n&&41!=n&&61!=n&&81!=n?"other":"many"},ky:u,lag:function(e,t){var r=String(e).split(".")[0];return t?"other":0==e?"zero":0!=r&&1!=r||0==e?"other":"one"},lb:u,lg:u,lij:function(e,t){var r=String(e).split("."),i=!r[1],n=Number(r[0])==e;return t?11==e||8==e||n&&e>=80&&e<=89||n&&e>=800&&e<=899?"many":"other":1==e&&i?"one":"other"},lkt:m,ln:d,lo:function(e,t){return t&&1==e?"one":"other"},lt:function(e,t){var r=String(e).split("."),i=r[1]||"",n=Number(r[0])==e,a=n&&r[0].slice(-1),s=n&&r[0].slice(-2);return t?"other":1==a&&(s<11||s>19)?"one":a>=2&&a<=9&&(s<11||s>19)?"few":0!=i?"many":"other"},lv:function(e,t){var r=String(e).split("."),i=r[1]||"",n=i.length,a=Number(r[0])==e,s=a&&r[0].slice(-1),o=a&&r[0].slice(-2),l=i.slice(-2),h=i.slice(-1);return t?"other":a&&0==s||o>=11&&o<=19||2==n&&l>=11&&l<=19?"zero":1==s&&11!=o||2==n&&1==h&&11!=l||2!=n&&1==h?"one":"other"},mas:u,mg:d,mgo:u,mk:function(e,t){var r=String(e).split("."),i=r[0],n=r[1]||"",a=!r[1],s=i.slice(-1),o=i.slice(-2),l=n.slice(-1),h=n.slice(-2);return t?1==s&&11!=o?"one":2==s&&12!=o?"two":7!=s&&8!=s||17==o||18==o?"other":"many":a&&1==s&&11!=o||1==l&&11!=h?"one":"other"},ml:u,mn:u,mo:function(e,t){var r=String(e).split("."),i=!r[1],n=Number(r[0])==e&&r[0].slice(-2);return t?1==e?"one":"other":1==e&&i?"one":!i||0==e||n>=2&&n<=19?"few":"other"},mr:function(e,t){return t?1==e?"one":2==e||3==e?"two":4==e?"few":"other":1==e?"one":"other"},ms:function(e,t){return t&&1==e?"one":"other"},mt:function(e,t){var r=String(e).split("."),i=Number(r[0])==e&&r[0].slice(-2);return t?"other":1==e?"one":0==e||i>=2&&i<=10?"few":i>=11&&i<=19?"many":"other"},my:m,nah:u,naq:g,nb:u,nd:u,ne:function(e,t){var r=String(e).split("."),i=Number(r[0])==e;return t?i&&e>=1&&e<=4?"one":"other":1==e?"one":"other"},nl:f,nn:u,nnh:u,no:u,nqo:m,nr:u,nso:d,ny:u,nyn:u,om:u,or:function(e,t){var r=String(e).split("."),i=Number(r[0])==e;return t?1==e||5==e||i&&e>=7&&e<=9?"one":2==e||3==e?"two":4==e?"few":6==e?"many":"other":1==e?"one":"other"},os:u,osa:m,pa:d,pap:u,pcm:p,pl:function(e,t){var r=String(e).split("."),i=r[0],n=!r[1],a=i.slice(-1),s=i.slice(-2);return t?"other":1==e&&n?"one":n&&a>=2&&a<=4&&(s<12||s>14)?"few":n&&1!=i&&(0==a||1==a)||n&&a>=5&&a<=9||n&&s>=12&&s<=14?"many":"other"},prg:function(e,t){var r=String(e).split("."),i=r[1]||"",n=i.length,a=Number(r[0])==e,s=a&&r[0].slice(-1),o=a&&r[0].slice(-2),l=i.slice(-2),h=i.slice(-1);return t?"other":a&&0==s||o>=11&&o<=19||2==n&&l>=11&&l<=19?"zero":1==s&&11!=o||2==n&&1==h&&11!=l||2!=n&&1==h?"one":"other"},ps:u,pt:function(e,t){var r=String(e).split(".")[0];return t?"other":0==r||1==r?"one":"other"},pt_PT:f,rm:u,ro:function(e,t){var r=String(e).split("."),i=!r[1],n=Number(r[0])==e&&r[0].slice(-2);return t?1==e?"one":"other":1==e&&i?"one":!i||0==e||n>=2&&n<=19?"few":"other"},rof:u,root:m,ru:function(e,t){var r=String(e).split("."),i=r[0],n=!r[1],a=i.slice(-1),s=i.slice(-2);return t?"other":n&&1==a&&11!=s?"one":n&&a>=2&&a<=4&&(s<12||s>14)?"few":n&&0==a||n&&a>=5&&a<=9||n&&s>=11&&s<=14?"many":"other"},rwk:u,sah:m,saq:u,sat:g,sc:function(e,t){var r=!String(e).split(".")[1];return t?11==e||8==e||80==e||800==e?"many":"other":1==e&&r?"one":"other"},scn:function(e,t){var r=!String(e).split(".")[1];return t?11==e||8==e||80==e||800==e?"many":"other":1==e&&r?"one":"other"},sd:u,sdh:u,se:g,seh:u,ses:m,sg:m,sh:function(e,t){var r=String(e).split("."),i=r[0],n=r[1]||"",a=!r[1],s=i.slice(-1),o=i.slice(-2),l=n.slice(-1),h=n.slice(-2);return t?"other":a&&1==s&&11!=o||1==l&&11!=h?"one":a&&s>=2&&s<=4&&(o<12||o>14)||l>=2&&l<=4&&(h<12||h>14)?"few":"other"},shi:function(e,t){var r=String(e).split("."),i=Number(r[0])==e;return t?"other":e>=0&&e<=1?"one":i&&e>=2&&e<=10?"few":"other"},si:function(e,t){var r=String(e).split("."),i=r[0],n=r[1]||"";return t?"other":0==e||1==e||0==i&&1==n?"one":"other"},sk:function(e,t){var r=String(e).split("."),i=r[0],n=!r[1];return t?"other":1==e&&n?"one":i>=2&&i<=4&&n?"few":n?"other":"many"},sl:function(e,t){var r=String(e).split("."),i=r[0],n=!r[1],a=i.slice(-2);return t?"other":n&&1==a?"one":n&&2==a?"two":n&&(3==a||4==a)||!n?"few":"other"},sma:g,smi:g,smj:g,smn:g,sms:g,sn:u,so:u,sq:function(e,t){var r=String(e).split("."),i=Number(r[0])==e,n=i&&r[0].slice(-1),a=i&&r[0].slice(-2);return t?1==e?"one":4==n&&14!=a?"many":"other":1==e?"one":"other"},sr:function(e,t){var r=String(e).split("."),i=r[0],n=r[1]||"",a=!r[1],s=i.slice(-1),o=i.slice(-2),l=n.slice(-1),h=n.slice(-2);return t?"other":a&&1==s&&11!=o||1==l&&11!=h?"one":a&&s>=2&&s<=4&&(o<12||o>14)||l>=2&&l<=4&&(h<12||h>14)?"few":"other"},ss:u,ssy:u,st:u,su:m,sv:function(e,t){var r=String(e).split("."),i=!r[1],n=Number(r[0])==e,a=n&&r[0].slice(-1),s=n&&r[0].slice(-2);return t?1!=a&&2!=a||11==s||12==s?"other":"one":1==e&&i?"one":"other"},sw:f,syr:u,ta:u,te:u,teo:u,th:m,ti:d,tig:u,tk:function(e,t){var r=String(e).split("."),i=Number(r[0])==e&&r[0].slice(-1);return t?6==i||9==i||10==e?"few":"other":1==e?"one":"other"},tl:function(e,t){var r=String(e).split("."),i=r[0],n=r[1]||"",a=!r[1],s=i.slice(-1),o=n.slice(-1);return t?1==e?"one":"other":a&&(1==i||2==i||3==i)||a&&4!=s&&6!=s&&9!=s||!a&&4!=o&&6!=o&&9!=o?"one":"other"},tn:u,to:m,tr:u,ts:u,tzm:function(e,t){var r=String(e).split("."),i=Number(r[0])==e;return t?"other":0==e||1==e||i&&e>=11&&e<=99?"one":"other"},ug:u,uk:function(e,t){var r=String(e).split("."),i=r[0],n=!r[1],a=Number(r[0])==e,s=a&&r[0].slice(-1),o=a&&r[0].slice(-2),l=i.slice(-1),h=i.slice(-2);return t?3==s&&13!=o?"few":"other":n&&1==l&&11!=h?"one":n&&l>=2&&l<=4&&(h<12||h>14)?"few":n&&0==l||n&&l>=5&&l<=9||n&&h>=11&&h<=14?"many":"other"},ur:f,uz:u,ve:u,vi:function(e,t){return t&&1==e?"one":"other"},vo:u,vun:u,wa:d,wae:u,wo:m,xh:u,xog:u,yi:f,yo:m,yue:m,zh:m,zu:p},Object.defineProperty(c,"__esModule",{value:!0}),h.exports=c;var y=l(v.exports),b=Object.freeze(Object.assign(Object.create(null),v.exports,{default:y})),x={exports:{}};!function(e,t){var r,i="zero",n="one",a="two",s="few",o="many",l="other",h={cardinal:[n,l],ordinal:[l]},c={cardinal:[l],ordinal:[l]},u={cardinal:[n,s,o,l],ordinal:[l]},d={cardinal:[n,l],ordinal:[n,l]},p={cardinal:[n,a,l],ordinal:[l]};r={_in:c,af:h,ak:h,am:h,an:h,ar:{cardinal:[i,n,a,s,o,l],ordinal:[l]},ars:{cardinal:[i,n,a,s,o,l],ordinal:[l]},as:{cardinal:[n,l],ordinal:[n,a,s,o,l]},asa:h,ast:h,az:{cardinal:[n,l],ordinal:[n,s,o,l]},be:{cardinal:[n,s,o,l],ordinal:[s,l]},bem:h,bez:h,bg:h,bho:h,bm:c,bn:{cardinal:[n,l],ordinal:[n,a,s,o,l]},bo:c,br:{cardinal:[n,a,s,o,l],ordinal:[l]},brx:h,bs:{cardinal:[n,s,l],ordinal:[l]},ca:{cardinal:[n,l],ordinal:[n,a,s,l]},ce:h,ceb:h,cgg:h,chr:h,ckb:h,cs:u,cy:{cardinal:[i,n,a,s,o,l],ordinal:[i,n,a,s,o,l]},da:h,de:h,doi:h,dsb:{cardinal:[n,a,s,l],ordinal:[l]},dv:h,dz:c,ee:h,el:h,en:{cardinal:[n,l],ordinal:[n,a,s,l]},eo:h,es:h,et:h,eu:h,fa:h,ff:h,fi:h,fil:d,fo:h,fr:{cardinal:[n,o,l],ordinal:[n,l]},fur:h,fy:h,ga:{cardinal:[n,a,s,o,l],ordinal:[n,l]},gd:{cardinal:[n,a,s,l],ordinal:[n,a,s,l]},gl:h,gsw:h,gu:{cardinal:[n,l],ordinal:[n,a,s,o,l]},guw:h,gv:{cardinal:[n,a,s,o,l],ordinal:[l]},ha:h,haw:h,he:{cardinal:[n,a,o,l],ordinal:[l]},hi:{cardinal:[n,l],ordinal:[n,a,s,o,l]},hr:{cardinal:[n,s,l],ordinal:[l]},hsb:{cardinal:[n,a,s,l],ordinal:[l]},hu:d,hy:d,ia:h,id:c,ig:c,ii:c,io:h,is:h,it:{cardinal:[n,l],ordinal:[o,l]},iu:p,iw:{cardinal:[n,a,o,l],ordinal:[l]},ja:c,jbo:c,jgo:h,ji:h,jmc:h,jv:c,jw:c,ka:{cardinal:[n,l],ordinal:[n,o,l]},kab:h,kaj:h,kcg:h,kde:c,kea:c,kk:{cardinal:[n,l],ordinal:[o,l]},kkj:h,kl:h,km:c,kn:h,ko:c,ks:h,ksb:h,ksh:{cardinal:[i,n,l],ordinal:[l]},ku:h,kw:{cardinal:[i,n,a,s,o,l],ordinal:[n,o,l]},ky:h,lag:{cardinal:[i,n,l],ordinal:[l]},lb:h,lg:h,lij:{cardinal:[n,l],ordinal:[o,l]},lkt:c,ln:h,lo:{cardinal:[l],ordinal:[n,l]},lt:u,lv:{cardinal:[i,n,l],ordinal:[l]},mas:h,mg:h,mgo:h,mk:{cardinal:[n,l],ordinal:[n,a,o,l]},ml:h,mn:h,mo:{cardinal:[n,s,l],ordinal:[n,l]},mr:{cardinal:[n,l],ordinal:[n,a,s,l]},ms:{cardinal:[l],ordinal:[n,l]},mt:u,my:c,nah:h,naq:p,nb:h,nd:h,ne:d,nl:h,nn:h,nnh:h,no:h,nqo:c,nr:h,nso:h,ny:h,nyn:h,om:h,or:{cardinal:[n,l],ordinal:[n,a,s,o,l]},os:h,osa:c,pa:h,pap:h,pcm:h,pl:u,prg:{cardinal:[i,n,l],ordinal:[l]},ps:h,pt:h,pt_PT:h,rm:h,ro:{cardinal:[n,s,l],ordinal:[n,l]},rof:h,root:c,ru:u,rwk:h,sah:c,saq:h,sat:p,sc:{cardinal:[n,l],ordinal:[o,l]},scn:{cardinal:[n,l],ordinal:[o,l]},sd:h,sdh:h,se:p,seh:h,ses:c,sg:c,sh:{cardinal:[n,s,l],ordinal:[l]},shi:{cardinal:[n,s,l],ordinal:[l]},si:h,sk:u,sl:{cardinal:[n,a,s,l],ordinal:[l]},sma:p,smi:p,smj:p,smn:p,sms:p,sn:h,so:h,sq:{cardinal:[n,l],ordinal:[n,o,l]},sr:{cardinal:[n,s,l],ordinal:[l]},ss:h,ssy:h,st:h,su:c,sv:d,sw:h,syr:h,ta:h,te:h,teo:h,th:c,ti:h,tig:h,tk:{cardinal:[n,l],ordinal:[s,l]},tl:d,tn:h,to:c,tr:h,ts:h,tzm:h,ug:h,uk:{cardinal:[n,s,o,l],ordinal:[s,l]},ur:h,uz:h,ve:h,vi:{cardinal:[l],ordinal:[n,l]},vo:h,vun:h,wa:h,wae:h,wo:c,xh:h,xog:h,yi:h,yo:c,yue:c,zh:c,zu:h},Object.defineProperty(r,"__esModule",{value:!0}),e.exports=r}(x);var _=l(x.exports),w=Object.freeze(Object.assign(Object.create(null),x.exports,{default:_})),S=y||b,T=_||w,M="object"===("undefined"==typeof Intl?"undefined":o(Intl))&&Intl.NumberFormat||s.default,E=function(e){return"in"===e?"_in":"pt-PT"===e?"pt_PT":e},A=a.default(M,(function(e){return S[E(e)]}),(function(e,t){return T[E(e)][t?"ordinal":"cardinal"]}));t.exports=A})),DX=$((e=>{"use strict";var t=PX();var r,i,n=(r=t)&&"object"==typeof r&&"default"in r?r:{default:r};"undefined"==typeof Intl?("undefined"!=typeof global?global.Intl={PluralRules:n.default}:"undefined"!=typeof window?window.Intl={PluralRules:n.default}:e.Intl={PluralRules:n.default},n.default.polyfill=!0):Intl.PluralRules?(i=["en","es","ru","zh"],Intl.PluralRules.supportedLocalesOf(i).length<i.length&&(Intl.PluralRules=n.default,n.default.polyfill=!0)):(Intl.PluralRules=n.default,n.default.polyfill=!0)})),Ir=$(((e,t)=>{"use strict";var r=function(e){return e&&e.Math===Math&&e};t.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof global&&global)||r("object"==typeof e&&e)||function(){return this}()||Function("return this")()})),ar=$(((e,t)=>{"use strict";t.exports=function(e){try{return!!e()}catch(e){return!0}}})),un=$(((e,t)=>{"use strict";var r=ar();t.exports=!r((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))})),nv=$(((e,t)=>{"use strict";var r=ar();t.exports=!r((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))})),Ln=$(((e,t)=>{"use strict";var r=nv(),i=Function.prototype.call;t.exports=r?i.bind(i):function(){return i.apply(i,arguments)}})),bx=$((e=>{"use strict";var t={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!t.call({1:2},1);e.f=i?function(e){var t=r(this,e);return!!t&&t.enumerable}:t})),ml=$(((e,t)=>{"use strict";t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}})),cr=$(((e,t)=>{"use strict";var r=nv(),i=Function.prototype,n=i.call,a=r&&i.bind.bind(n,n);t.exports=r?a:function(e){return function(){return n.apply(e,arguments)}}})),qa=$(((e,t)=>{"use strict";var r=cr(),i=r({}.toString),n=r("".slice);t.exports=function(e){return n(i(e),8,-1)}})),Um=$(((e,t)=>{"use strict";var r=cr(),i=ar(),n=qa(),a=Object,s=r("".split);t.exports=i((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"===n(e)?s(e,""):a(e)}:a})),fo=$(((e,t)=>{"use strict";t.exports=function(e){return null==e}})),fs=$(((e,t)=>{"use strict";var r=fo(),i=TypeError;t.exports=function(e){if(r(e))throw new i("Can't call method on "+e);return e}})),na=$(((e,t)=>{"use strict";var r=Um(),i=fs();t.exports=function(e){return r(i(e))}})),ri=$(((e,t)=>{"use strict";var r="object"==typeof document&&document.all;t.exports=void 0===r&&void 0!==r?function(e){return"function"==typeof e||e===r}:function(e){return"function"==typeof e}})),zn=$(((e,t)=>{"use strict";var r=ri();t.exports=function(e){return"object"==typeof e?null!==e:r(e)}})),Qi=$(((e,t)=>{"use strict";var r=Ir(),i=ri();t.exports=function(e,t){return arguments.length<2?function(e){return i(e)?e:void 0}(r[e]):r[e]&&r[e][t]}})),Fo=$(((e,t)=>{"use strict";var r=cr();t.exports=r({}.isPrototypeOf)})),eh=$(((e,t)=>{"use strict";t.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""})),th=$(((e,t)=>{"use strict";var r,i,n=Ir(),a=eh(),s=n.process,o=n.Deno,l=s&&s.versions||o&&o.version,h=l&&l.v8;h&&(i=(r=h.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&a&&((!(r=a.match(/Edge\/(\d+)/))||r[1]>=74)&&((r=a.match(/Chrome\/(\d+)/))&&(i=+r[1]))),t.exports=i})),Hm=$(((e,t)=>{"use strict";var r=th(),i=ar(),n=Ir().String;t.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol("symbol detection");return!n(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&r&&r<41}))})),gk=$(((e,t)=>{"use strict";var r=Hm();t.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator})),Xf=$(((e,t)=>{"use strict";var r=Qi(),i=ri(),n=Fo(),a=gk(),s=Object;t.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=r("Symbol");return i(t)&&n(t.prototype,s(e))}})),Yf=$(((e,t)=>{"use strict";var r=String;t.exports=function(e){try{return r(e)}catch(e){return"Object"}}})),ps=$(((e,t)=>{"use strict";var r=ri(),i=Yf(),n=TypeError;t.exports=function(e){if(r(e))return e;throw new n(i(e)+" is not a function")}})),rh=$(((e,t)=>{"use strict";var r=ps(),i=fo();t.exports=function(e,t){var n=e[t];return i(n)?void 0:r(n)}})),xk=$(((e,t)=>{"use strict";var r=Ln(),i=ri(),n=zn(),a=TypeError;t.exports=function(e,t){var s,o;if("string"===t&&i(s=e.toString)&&!n(o=r(s,e))||i(s=e.valueOf)&&!n(o=r(s,e))||"string"!==t&&i(s=e.toString)&&!n(o=r(s,e)))return o;throw new a("Can't convert object to primitive value")}})),_s=$(((e,t)=>{"use strict";t.exports=!1})),OM=$(((e,t)=>{"use strict";var r=Ir(),i=Object.defineProperty;t.exports=function(e,t){try{i(r,e,{value:t,configurable:!0,writable:!0})}catch(i){r[e]=t}return t}})),DM=$(((e,t)=>{"use strict";var r=Ir(),i=OM(),n="__core-js_shared__",a=r[n]||i(n,{});t.exports=a})),Vm=$(((e,t)=>{"use strict";var r=_s(),i=DM();(t.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.35.0",mode:r?"pure":"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.35.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),Mi=$(((e,t)=>{"use strict";var r=fs(),i=Object;t.exports=function(e){return i(r(e))}})),fi=$(((e,t)=>{"use strict";var r=cr(),i=Mi(),n=r({}.hasOwnProperty);t.exports=Object.hasOwn||function(e,t){return n(i(e),t)}})),zm=$(((e,t)=>{"use strict";var r=cr(),i=0,n=Math.random(),a=r(1..toString);t.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++i+n,36)}})),$n=$(((e,t)=>{"use strict";var r=Ir(),i=Vm(),n=fi(),a=zm(),s=Hm(),o=gk(),l=r.Symbol,h=i("wks"),c=o?l.for||l:l&&l.withoutSetter||a;t.exports=function(e){return n(h,e)||(h[e]=s&&n(l,e)?l[e]:c("Symbol."+e)),h[e]}})),xx=$(((e,t)=>{"use strict";var r=Ln(),i=zn(),n=Xf(),a=rh(),s=xk(),o=$n(),l=TypeError,h=o("toPrimitive");t.exports=function(e,t){if(!i(e)||n(e))return e;var o,c=a(e,h);if(c){if(void 0===t&&(t="default"),o=r(c,e,t),!i(o)||n(o))return o;throw new l("Can't convert object to primitive value")}return void 0===t&&(t="number"),s(e,t)}})),nh=$(((e,t)=>{"use strict";var r=xx(),i=Xf();t.exports=function(e){var t=r(e,"string");return i(t)?t:t+""}})),Ex=$(((e,t)=>{"use strict";var r=Ir(),i=zn(),n=r.document,a=i(n)&&i(n.createElement);t.exports=function(e){return a?n.createElement(e):{}}})),Tk=$(((e,t)=>{"use strict";var r=un(),i=ar(),n=Ex();t.exports=!r&&!i((function(){return 7!==Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a}))})),ja=$((e=>{"use strict";var t=un(),r=Ln(),i=bx(),n=ml(),a=na(),s=nh(),o=fi(),l=Tk(),h=Object.getOwnPropertyDescriptor;e.f=t?h:function(e,t){if(e=a(e),t=s(t),l)try{return h(e,t)}catch(e){}if(o(e,t))return n(!r(i.f,e,t),e[t])}})),wk=$(((e,t)=>{"use strict";var r=un(),i=ar();t.exports=r&&i((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))})),kn=$(((e,t)=>{"use strict";var r=zn(),i=String,n=TypeError;t.exports=function(e){if(r(e))return e;throw new n(i(e)+" is not an object")}})),ms=$((e=>{"use strict";var t=un(),r=Tk(),i=wk(),n=kn(),a=nh(),s=TypeError,o=Object.defineProperty,l=Object.getOwnPropertyDescriptor,h="enumerable",c="configurable",u="writable";e.f=t?i?function(e,t,r){if(n(e),t=a(t),n(r),"function"==typeof e&&"prototype"===t&&"value"in r&&u in r&&!r[u]){var i=l(e,t);i&&i[u]&&(e[t]=r.value,r={configurable:c in r?r[c]:i[c],enumerable:h in r?r[h]:i[h],writable:!1})}return o(e,t,r)}:o:function(e,t,i){if(n(e),t=a(t),n(i),r)try{return o(e,t,i)}catch(e){}if("get"in i||"set"in i)throw new s("Accessors not supported");return"value"in i&&(e[t]=i.value),e}})),Wa=$(((e,t)=>{"use strict";var r=un(),i=ms(),n=ml();t.exports=r?function(e,t,r){return i.f(e,t,n(1,r))}:function(e,t,r){return e[t]=r,e}})),Gm=$(((e,t)=>{"use strict";var r=un(),i=fi(),n=Function.prototype,a=r&&Object.getOwnPropertyDescriptor,s=i(n,"name"),o=s&&"something"===function(){}.name,l=s&&(!r||r&&a(n,"name").configurable);t.exports={EXISTS:s,PROPER:o,CONFIGURABLE:l}})),kM=$(((e,t)=>{"use strict";var r=cr(),i=ri(),n=DM(),a=r(Function.toString);i(n.inspectSource)||(n.inspectSource=function(e){return a(e)}),t.exports=n.inspectSource})),Ok=$(((e,t)=>{"use strict";var r=Ir(),i=ri(),n=r.WeakMap;t.exports=i(n)&&/native code/.test(String(n))})),_x=$(((e,t)=>{"use strict";var r=Vm(),i=zm(),n=r("keys");t.exports=function(e){return n[e]||(n[e]=i(e))}})),sv=$(((e,t)=>{"use strict";t.exports={}})),Ws=$(((e,t)=>{"use strict";var r,i,n,a,s,o=Ok(),l=Ir(),h=zn(),c=Wa(),u=fi(),d=DM(),p=_x(),f=sv(),m="Object already initialized",g=l.TypeError,v=l.WeakMap;o||d.state?((a=d.state||(d.state=new v)).get=a.get,a.has=a.has,a.set=a.set,r=function(e,t){if(a.has(e))throw new g(m);return t.facade=e,a.set(e,t),t},i=function(e){return a.get(e)||{}},n=function(e){return a.has(e)}):(f[s=p("state")]=!0,r=function(e,t){if(u(e,s))throw new g(m);return t.facade=e,c(e,s,t),t},i=function(e){return u(e,s)?e[s]:{}},n=function(e){return u(e,s)}),t.exports={set:r,get:i,has:n,enforce:function(e){return n(e)?i(e):r(e,{})},getterFor:function(e){return function(t){var r;if(!h(t)||(r=i(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return r}}}})),HM=$(((e,t)=>{"use strict";var r=cr(),i=ar(),n=ri(),a=fi(),s=un(),o=Gm().CONFIGURABLE,l=kM(),h=Ws(),c=h.enforce,u=h.get,d=String,p=Object.defineProperty,f=r("".slice),m=r("".replace),g=r([].join),v=s&&!i((function(){return 8!==p((function(){}),"length",{value:8}).length})),y=String(String).split("String"),b=t.exports=function(e,t,r){"Symbol("===f(d(t),0,7)&&(t="["+m(d(t),/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!a(e,"name")||o&&e.name!==t)&&(s?p(e,"name",{value:t,configurable:!0}):e.name=t),v&&r&&a(r,"arity")&&e.length!==r.arity&&p(e,"length",{value:r.arity});try{r&&a(r,"constructor")&&r.constructor?s&&p(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var i=c(e);return a(i,"source")||(i.source=g(y,"string"==typeof t?t:"")),e};Function.prototype.toString=b((function(){return n(this)&&u(this).source||l(this)}),"toString")})),os=$(((e,t)=>{"use strict";var r=ri(),i=ms(),n=HM(),a=OM();t.exports=function(e,t,s,o){o||(o={});var l=o.enumerable,h=void 0!==o.name?o.name:t;if(r(s)&&n(s,h,o),o.global)l?e[t]=s:a(t,s);else{try{o.unsafe?e[t]&&(l=!0):delete e[t]}catch(e){}l?e[t]=s:i.f(e,t,{value:s,enumerable:!1,configurable:!o.nonConfigurable,writable:!o.nonWritable})}return e}})),Nk=$(((e,t)=>{"use strict";var r=Math.ceil,i=Math.floor;t.exports=Math.trunc||function(e){var t=+e;return(t>0?i:r)(t)}})),Ps=$(((e,t)=>{"use strict";var r=Nk();t.exports=function(e){var t=+e;return t!=t||0===t?0:r(t)}})),ih=$(((e,t)=>{"use strict";var r=Ps(),i=Math.max,n=Math.min;t.exports=function(e,t){var a=r(e);return a<0?i(a+t,0):n(a,t)}})),Bo=$(((e,t)=>{"use strict";var r=Ps(),i=Math.min;t.exports=function(e){return e>0?i(r(e),9007199254740991):0}})),Ui=$(((e,t)=>{"use strict";var r=Bo();t.exports=function(e){return r(e.length)}})),av=$(((e,t)=>{"use strict";var r=na(),i=ih(),n=Ui(),a=function(e){return function(t,a,s){var o,l=r(t),h=n(l),c=i(s,h);if(e&&a!=a){for(;h>c;)if((o=l[c++])!=o)return!0}else for(;h>c;c++)if((e||c in l)&&l[c]===a)return e||c||0;return!e&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}})),Hk=$(((e,t)=>{"use strict";var r=cr(),i=fi(),n=na(),a=av().indexOf,s=sv(),o=r([].push);t.exports=function(e,t){var r,l=n(e),h=0,c=[];for(r in l)!i(s,r)&&i(l,r)&&o(c,r);for(;t.length>h;)i(l,r=t[h++])&&(~a(c,r)||o(c,r));return c}})),VM=$(((e,t)=>{"use strict";t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]})),$f=$((e=>{"use strict";var t=Hk(),r=VM().concat("length","prototype");e.f=Object.getOwnPropertyNames||function(e){return t(e,r)}})),wx=$((e=>{"use strict";e.f=Object.getOwnPropertySymbols})),zM=$(((e,t)=>{"use strict";var r=Qi(),i=cr(),n=$f(),a=wx(),s=kn(),o=i([].concat);t.exports=r("Reflect","ownKeys")||function(e){var t=n.f(s(e)),r=a.f;return r?o(t,r(e)):t}})),ov=$(((e,t)=>{"use strict";var r=fi(),i=zM(),n=ja(),a=ms();t.exports=function(e,t,s){for(var o=i(t),l=a.f,h=n.f,c=0;c<o.length;c++){var u=o[c];!r(e,u)&&(!s||!r(s,u))&&l(e,u,h(t,u))}}})),lv=$(((e,t)=>{"use strict";var r=ar(),i=ri(),n=/#|\.prototype\./,a=function(e,t){var n=o[s(e)];return n===h||n!==l&&(i(t)?r(t):!!t)},s=a.normalize=function(e){return String(e).replace(n,".").toLowerCase()},o=a.data={},l=a.NATIVE="N",h=a.POLYFILL="P";t.exports=a})),ct=$(((e,t)=>{"use strict";var r=Ir(),i=ja().f,n=Wa(),a=os(),s=OM(),o=ov(),l=lv();t.exports=function(e,t){var h,c,u,d,p,f=e.target,m=e.global,g=e.stat;if(h=m?r:g?r[f]||s(f,{}):(r[f]||{}).prototype)for(c in t){if(d=t[c],e.dontCallGetSet?u=(p=i(h,c))&&p.value:u=h[c],!l(m?c:f+(g?".":"#")+c,e.forced)&&void 0!==u){if(typeof d==typeof u)continue;o(d,u)}(e.sham||u&&u.sham)&&n(d,"sham",!0),a(h,c,d,e)}}})),GM=$(((e,t)=>{"use strict";var r={};r[$n()("toStringTag")]="z",t.exports="[object z]"===String(r)})),Qc=$(((e,t)=>{"use strict";var r=GM(),i=ri(),n=qa(),a=$n()("toStringTag"),s=Object,o="Arguments"===n(function(){return arguments}());t.exports=r?n:function(e){var t,r,l;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=s(e),a))?r:o?n(t):"Object"===(l=n(t))&&i(t.callee)?"Arguments":l}})),Rn=$(((e,t)=>{"use strict";var r=Qc(),i=String;t.exports=function(e){if("Symbol"===r(e))throw new TypeError("Cannot convert a Symbol value to a string");return i(e)}})),cv=$(((e,t)=>{"use strict";var r=Hk(),i=VM();t.exports=Object.keys||function(e){return r(e,i)}})),jM=$((e=>{"use strict";var t=un(),r=wk(),i=ms(),n=kn(),a=na(),s=cv();e.f=t&&!r?Object.defineProperties:function(e,t){n(e);for(var r,o=a(t),l=s(t),h=l.length,c=0;h>c;)i.f(e,r=l[c++],o[r]);return e}})),zk=$(((e,t)=>{"use strict";var r=Qi();t.exports=r("document","documentElement")})),No=$(((e,t)=>{"use strict";var r,i=kn(),n=jM(),a=VM(),s=sv(),o=zk(),l=Ex(),h=_x(),c="prototype",u="script",d=h("IE_PROTO"),p=function(){},f=function(e){return"<"+u+">"+e+"</"+u+">"},m=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},g=function(){try{r=new ActiveXObject("htmlfile")}catch(e){}g="undefined"!=typeof document?document.domain&&r?m(r):function(){var e,t=l("iframe"),r="java"+u+":";return t.style.display="none",o.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F}():m(r);for(var e=a.length;e--;)delete g[c][a[e]];return g()};s[d]=!0,t.exports=Object.create||function(e,t){var r;return null!==e?(p[c]=i(e),r=new p,p[c]=null,r[d]=e):r=g(),void 0===t?r:n.f(r,t)}})),gl=$(((e,t)=>{"use strict";var r=cr();t.exports=r([].slice)})),YM=$(((e,t)=>{"use strict";var r=qa(),i=na(),n=$f().f,a=gl(),s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(e){return s&&"Window"===r(e)?function(e){try{return n(e)}catch(e){return a(s)}}(e):n(i(e))}})),fa=$(((e,t)=>{"use strict";var r=HM(),i=ms();t.exports=function(e,t,n){return n.get&&r(n.get,t,{getter:!0}),n.set&&r(n.set,t,{setter:!0}),i.f(e,t,n)}})),Wk=$((e=>{"use strict";var t=$n();e.f=t})),$M=$(((e,t)=>{"use strict";var r=Ir();t.exports=r})),po=$(((e,t)=>{"use strict";var r=$M(),i=fi(),n=Wk(),a=ms().f;t.exports=function(e){var t=r.Symbol||(r.Symbol={});i(t,e)||a(t,e,{value:n.f(e)})}})),Xk=$(((e,t)=>{"use strict";var r=Ln(),i=Qi(),n=$n(),a=os();t.exports=function(){var e=i("Symbol"),t=e&&e.prototype,s=t&&t.valueOf,o=n("toPrimitive");t&&!t[o]&&a(t,o,(function(e){return r(s,this)}),{arity:1})}})),mo=$(((e,t)=>{"use strict";var r=ms().f,i=fi(),n=$n()("toStringTag");t.exports=function(e,t,a){e&&!a&&(e=e.prototype),e&&!i(e,n)&&r(e,n,{configurable:!0,value:t})}})),yd=$(((e,t)=>{"use strict";var r=qa(),i=cr();t.exports=function(e){if("Function"===r(e))return i(e)}})),Kl=$(((e,t)=>{"use strict";var r=yd(),i=ps(),n=nv(),a=r(r.bind);t.exports=function(e,t){return i(e),void 0===t?e:n?a(e,t):function(){return e.apply(t,arguments)}}})),bd=$(((e,t)=>{"use strict";var r=qa();t.exports=Array.isArray||function(e){return"Array"===r(e)}})),jm=$(((e,t)=>{"use strict";var r=cr(),i=ar(),n=ri(),a=Qc(),s=Qi(),o=kM(),l=function(){},h=[],c=s("Reflect","construct"),u=/^\s*(?:class|function)\b/,d=r(u.exec),p=!u.test(l),f=function(e){if(!n(e))return!1;try{return c(l,h,e),!0}catch(e){return!1}},m=function(e){if(!n(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return p||!!d(u,o(e))}catch(e){return!0}};m.sham=!0,t.exports=!c||i((function(){var e;return f(f.call)||!f(Object)||!f((function(){e=!0}))||e}))?m:f})),aZ=$(((e,t)=>{"use strict";var r=bd(),i=jm(),n=zn(),a=$n()("species"),s=Array;t.exports=function(e){var t;return r(e)&&(t=e.constructor,i(t)&&(t===s||r(t.prototype))?t=void 0:n(t)&&(null===(t=t[a])&&(t=void 0))),void 0===t?s:t}})),uv=$(((e,t)=>{"use strict";var r=aZ();t.exports=function(e,t){return new(r(e))(0===t?0:t)}})),pa=$(((e,t)=>{"use strict";var r=Kl(),i=cr(),n=Um(),a=Mi(),s=Ui(),o=uv(),l=i([].push),h=function(e){var t=1===e,i=2===e,h=3===e,c=4===e,u=6===e,d=7===e,p=5===e||u;return function(f,m,g,v){for(var y,b,x=a(f),_=n(x),w=s(_),S=r(m,g),T=0,M=v||o,E=t?M(f,w):i||d?M(f,0):void 0;w>T;T++)if((p||T in _)&&(b=S(y=_[T],T,x),e))if(t)E[T]=b;else if(b)switch(e){case 3:return!0;case 5:return y;case 6:return T;case 2:l(E,y)}else switch(e){case 4:return!1;case 7:l(E,y)}return u?-1:h||c?c:E}};t.exports={forEach:h(0),map:h(1),filter:h(2),some:h(3),every:h(4),find:h(5),findIndex:h(6),filterReject:h(7)}})),MZ=$((()=>{"use strict";var e=ct(),t=Ir(),r=Ln(),i=cr(),n=_s(),a=un(),s=Hm(),o=ar(),l=fi(),h=Fo(),c=kn(),u=na(),d=nh(),p=Rn(),f=ml(),m=No(),g=cv(),v=$f(),y=YM(),b=wx(),x=ja(),_=ms(),w=jM(),S=bx(),T=os(),M=fa(),E=Vm(),A=_x(),C=sv(),P=zm(),R=$n(),I=Wk(),O=po(),L=Xk(),D=mo(),k=Ws(),F=pa().forEach,N=A("hidden"),U="Symbol",B="prototype",z=k.set,H=k.getterFor(U),V=Object[B],j=t.Symbol,G=j&&j[B],W=t.RangeError,X=t.TypeError,q=t.QObject,Y=x.f,$=_.f,Z=y.f,K=S.f,J=i([].push),Q=E("symbols"),ee=E("op-symbols"),te=E("wks"),re=!q||!q[B]||!q[B].findChild,ie=function(e,t,r){var i=Y(V,t);i&&delete V[t],$(e,t,r),i&&e!==V&&$(V,t,i)},ne=a&&o((function(){return 7!==m($({},"a",{get:function(){return $(this,"a",{value:7}).a}})).a}))?ie:$,ae=function(e,t){var r=Q[e]=m(G);return z(r,{type:U,tag:e,description:t}),a||(r.description=t),r},se=function(e,t,r){e===V&&se(ee,t,r),c(e);var i=d(t);return c(r),l(Q,i)?(r.enumerable?(l(e,N)&&e[N][i]&&(e[N][i]=!1),r=m(r,{enumerable:f(0,!1)})):(l(e,N)||$(e,N,f(1,m(null))),e[N][i]=!0),ne(e,i,r)):$(e,i,r)},oe=function(e,t){c(e);var i=u(t),n=g(i).concat(ue(i));return F(n,(function(t){(!a||r(le,i,t))&&se(e,t,i[t])})),e},le=function(e){var t=d(e),i=r(K,this,t);return!(this===V&&l(Q,t)&&!l(ee,t))&&(!(i||!l(this,t)||!l(Q,t)||l(this,N)&&this[N][t])||i)},he=function(e,t){var r=u(e),i=d(t);if(r!==V||!l(Q,i)||l(ee,i)){var n=Y(r,i);return n&&l(Q,i)&&!(l(r,N)&&r[N][i])&&(n.enumerable=!0),n}},ce=function(e){var t=Z(u(e)),r=[];return F(t,(function(e){!l(Q,e)&&!l(C,e)&&J(r,e)})),r},ue=function(e){var t=e===V,r=Z(t?ee:u(e)),i=[];return F(r,(function(e){l(Q,e)&&(!t||l(V,e))&&J(i,Q[e])})),i};s||(T(G=(j=function(){if(h(G,this))throw new X("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?p(arguments[0]):void 0,i=P(e),n=function(e){var a=void 0===this?t:this;a===V&&r(n,ee,e),l(a,N)&&l(a[N],i)&&(a[N][i]=!1);var s=f(1,e);try{ne(a,i,s)}catch(e){if(!(e instanceof W))throw e;ie(a,i,s)}};return a&&re&&ne(V,i,{configurable:!0,set:n}),ae(i,e)})[B],"toString",(function(){return H(this).tag})),T(j,"withoutSetter",(function(e){return ae(P(e),e)})),S.f=le,_.f=se,w.f=oe,x.f=he,v.f=y.f=ce,b.f=ue,I.f=function(e){return ae(R(e),e)},a&&(M(G,"description",{configurable:!0,get:function(){return H(this).description}}),n||T(V,"propertyIsEnumerable",le,{unsafe:!0}))),e({global:!0,constructor:!0,wrap:!0,forced:!s,sham:!s},{Symbol:j}),F(g(te),(function(e){O(e)})),e({target:U,stat:!0,forced:!s},{useSetter:function(){re=!0},useSimple:function(){re=!1}}),e({target:"Object",stat:!0,forced:!s,sham:!a},{create:function(e,t){return void 0===t?m(e):oe(m(e),t)},defineProperty:se,defineProperties:oe,getOwnPropertyDescriptor:he}),e({target:"Object",stat:!0,forced:!s},{getOwnPropertyNames:ce}),L(),D(j,U),C[N]=!0})),oF=$(((e,t)=>{"use strict";var r=Hm();t.exports=r&&!!Symbol.for&&!!Symbol.keyFor})),CZ=$((()=>{"use strict";var e=ct(),t=Qi(),r=fi(),i=Rn(),n=Vm(),a=oF(),s=n("string-to-symbol-registry"),o=n("symbol-to-string-registry");e({target:"Symbol",stat:!0,forced:!a},{for:function(e){var n=i(e);if(r(s,n))return s[n];var a=t("Symbol")(n);return s[n]=a,o[a]=n,a}})})),IZ=$((()=>{"use strict";var e=ct(),t=fi(),r=Xf(),i=Yf(),n=Vm(),a=oF(),s=n("symbol-to-string-registry");e({target:"Symbol",stat:!0,forced:!a},{keyFor:function(e){if(!r(e))throw new TypeError(i(e)+" is not a symbol");if(t(s,e))return s[e]}})})),vl=$(((e,t)=>{"use strict";var r=nv(),i=Function.prototype,n=i.apply,a=i.call;t.exports="object"==typeof Reflect&&Reflect.apply||(r?a.bind(n):function(){return a.apply(n,arguments)})})),HZ=$(((e,t)=>{"use strict";var r=cr(),i=bd(),n=ri(),a=qa(),s=Rn(),o=r([].push);t.exports=function(e){if(n(e))return e;if(i(e)){for(var t=e.length,r=[],l=0;l<t;l++){var h=e[l];"string"==typeof h?o(r,h):("number"==typeof h||"Number"===a(h)||"String"===a(h))&&o(r,s(h))}var c=r.length,u=!0;return function(e,t){if(u)return u=!1,t;if(i(this))return t;for(var n=0;n<c;n++)if(r[n]===e)return t}}}})),cF=$((()=>{"use strict";var e=ct(),t=Qi(),r=vl(),i=Ln(),n=cr(),a=ar(),s=ri(),o=Xf(),l=gl(),h=HZ(),c=Hm(),u=String,d=t("JSON","stringify"),p=n(/./.exec),f=n("".charAt),m=n("".charCodeAt),g=n("".replace),v=n(1..toString),y=/[\uD800-\uDFFF]/g,b=/^[\uD800-\uDBFF]$/,x=/^[\uDC00-\uDFFF]$/,_=!c||a((function(){var e=t("Symbol")("stringify detection");return"[null]"!==d([e])||"{}"!==d({a:e})||"{}"!==d(Object(e))})),w=a((function(){return'"\\udf06\\ud834"'!==d("\udf06\ud834")||'"\\udead"'!==d("\udead")})),S=function(e,t){var n=l(arguments),a=h(t);if(s(a)||void 0!==e&&!o(e))return n[1]=function(e,t){if(s(a)&&(t=i(a,this,u(e),t)),!o(t))return t},r(d,null,n)},T=function(e,t,r){var i=f(r,t-1),n=f(r,t+1);return p(b,e)&&!p(x,n)||p(x,e)&&!p(b,i)?"\\u"+v(m(e,0),16):e};d&&e({target:"JSON",stat:!0,arity:3,forced:_||w},{stringify:function(e,t,i){var n=l(arguments),a=r(_?S:d,null,n);return w&&"string"==typeof a?g(a,y,T):a}})})),QZ=$((()=>{"use strict";var e=ct(),t=Hm(),r=ar(),i=wx(),n=Mi();e({target:"Object",stat:!0,forced:!t||r((function(){i.f(1)}))},{getOwnPropertySymbols:function(e){var t=i.f;return t?t(n(e)):[]}})})),eK=$((()=>{"use strict";MZ(),CZ(),IZ(),cF(),QZ()})),oK=$((()=>{"use strict";var e,t,r,i,n,a,s,o,l=ct(),h=un(),c=Ir(),u=cr(),d=fi(),p=ri(),f=Fo(),m=Rn(),g=fa(),v=ov(),y=c.Symbol,b=y&&y.prototype;h&&p(y)&&(!("description"in b)||void 0!==y().description)&&(e={},v(t=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:m(arguments[0]),r=f(b,this)?new y(t):void 0===t?y():y(t);return""===t&&(e[r]=!0),r},y),t.prototype=b,b.constructor=t,r="Symbol(description detection)"===String(y("description detection")),i=u(b.valueOf),n=u(b.toString),a=/^Symbol\((.*)\)[^)]+$/,s=u("".replace),o=u("".slice),g(b,"description",{configurable:!0,get:function(){var t=i(this);if(d(e,t))return"";var l=n(t),h=r?o(l,7,-1):s(l,a,"$1");return""===h?void 0:h}}),l({global:!0,constructor:!0,forced:!0},{Symbol:t}))})),lK=$((()=>{"use strict";po()("asyncIterator")})),cK=$((()=>{"use strict";po()("hasInstance")})),uK=$((()=>{"use strict";po()("isConcatSpreadable")})),hK=$((()=>{"use strict";po()("iterator")})),dK=$((()=>{"use strict";po()("match")})),fK=$((()=>{"use strict";po()("matchAll")})),pK=$((()=>{"use strict";po()("replace")})),mK=$((()=>{"use strict";po()("search")})),gK=$((()=>{"use strict";po()("species")})),vK=$((()=>{"use strict";po()("split")})),yK=$((()=>{"use strict";var e=po(),t=Xk();e("toPrimitive"),t()})),bK=$((()=>{"use strict";var e=Qi(),t=po(),r=mo();t("toStringTag"),r(e("Symbol"),"Symbol")})),xK=$((()=>{"use strict";po()("unscopables")})),_K=$(((e,t)=>{"use strict";var r=cr(),i=ps();t.exports=function(e,t,n){try{return r(i(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}}})),hF=$(((e,t)=>{"use strict";var r=zn();t.exports=function(e){return r(e)||null===e}})),dF=$(((e,t)=>{"use strict";var r=hF(),i=String,n=TypeError;t.exports=function(e){if(r(e))return e;throw new n("Can't set "+i(e)+" as a prototype")}})),eu=$(((e,t)=>{"use strict";var r=_K(),i=kn(),n=dF();t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,a={};try{(e=r(Object.prototype,"__proto__","set"))(a,[]),t=a instanceof Array}catch(e){}return function(r,a){return i(r),n(a),t?e(r,a):r.__proto__=a,r}}():void 0)})),fF=$(((e,t)=>{"use strict";var r=ms().f;t.exports=function(e,t,i){i in e||r(e,i,{configurable:!0,get:function(){return t[i]},set:function(e){t[i]=e}})}})),Jf=$(((e,t)=>{"use strict";var r=ri(),i=zn(),n=eu();t.exports=function(e,t,a){var s,o;return n&&r(s=t.constructor)&&s!==a&&i(o=s.prototype)&&o!==a.prototype&&n(e,o),e}})),pv=$(((e,t)=>{"use strict";var r=Rn();t.exports=function(e,t){return void 0===e?arguments.length<2?"":t:r(e)}})),pF=$(((e,t)=>{"use strict";var r=zn(),i=Wa();t.exports=function(e,t){r(t)&&"cause"in t&&i(e,"cause",t.cause)}})),nA=$(((e,t)=>{"use strict";var r=cr(),i=Error,n=r("".replace),a=String(new i("zxcasd").stack),s=/\n\s*at [^:]*:[^\n]*/,o=s.test(a);t.exports=function(e,t){if(o&&"string"==typeof e&&!i.prepareStackTrace)for(;t--;)e=n(e,s,"");return e}})),mF=$(((e,t)=>{"use strict";var r=ar(),i=ml();t.exports=!r((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",i(1,7)),7!==e.stack)}))})),gF=$(((e,t)=>{"use strict";var r=Wa(),i=nA(),n=mF(),a=Error.captureStackTrace;t.exports=function(e,t,s,o){n&&(a?a(e,t):r(e,"stack",i(s,o)))}})),vF=$(((e,t)=>{"use strict";var r=Qi(),i=fi(),n=Wa(),a=Fo(),s=eu(),o=ov(),l=fF(),h=Jf(),c=pv(),u=pF(),d=gF(),p=un(),f=_s();t.exports=function(e,t,m,g){var v="stackTraceLimit",y=g?2:1,b=e.split("."),x=b[b.length-1],_=r.apply(null,b);if(_){var w=_.prototype;if(!f&&i(w,"cause")&&delete w.cause,!m)return _;var S=r("Error"),T=t((function(e,t){var r=c(g?t:e,void 0),i=g?new _(e):new _;return void 0!==r&&n(i,"message",r),d(i,T,i.stack,2),this&&a(w,this)&&h(i,this,T),arguments.length>y&&u(i,arguments[y]),i}));if(T.prototype=w,"Error"!==x?s?s(T,S):o(T,S,{name:!0}):p&&v in _&&(l(T,_,v),l(T,_,"prepareStackTrace")),o(T,_),!f)try{w.name!==x&&n(w,"name",x),w.constructor=T}catch(e){}return T}}})),XK=$((()=>{"use strict";var e=ct(),t=Ir(),r=vl(),i=vF(),n="WebAssembly",a=t[n],s=7!==new Error("e",{cause:7}).cause,o=function(t,r){var n={};n[t]=i(t,r,s),e({global:!0,constructor:!0,arity:1,forced:s},n)},l=function(t,r){if(a&&a[t]){var o={};o[t]=i(n+"."+t,r,s),e({target:n,stat:!0,constructor:!0,arity:1,forced:s},o)}};o("Error",(function(e){return function(t){return r(e,this,arguments)}})),o("EvalError",(function(e){return function(t){return r(e,this,arguments)}})),o("RangeError",(function(e){return function(t){return r(e,this,arguments)}})),o("ReferenceError",(function(e){return function(t){return r(e,this,arguments)}})),o("SyntaxError",(function(e){return function(t){return r(e,this,arguments)}})),o("TypeError",(function(e){return function(t){return r(e,this,arguments)}})),o("URIError",(function(e){return function(t){return r(e,this,arguments)}})),l("CompileError",(function(e){return function(t){return r(e,this,arguments)}})),l("LinkError",(function(e){return function(t){return r(e,this,arguments)}})),l("RuntimeError",(function(e){return function(t){return r(e,this,arguments)}}))})),xF=$(((e,t)=>{"use strict";var r=un(),i=ar(),n=kn(),a=pv(),s=Error.prototype.toString,o=i((function(){if(r){var e=Object.create(Object.defineProperty({},"name",{get:function(){return this===e}}));if("true"!==s.call(e))return!0}return"2: 1"!==s.call({message:1,name:2})||"Error"!==s.call({})}));t.exports=o?function(){var e=n(this),t=a(e.name,"Error"),r=a(e.message);return t?r?t+": "+r:t:r}:s})),JK=$((()=>{"use strict";var e=os(),t=xF(),r=Error.prototype;r.toString!==t&&e(r,"toString",t)})),aA=$(((e,t)=>{"use strict";var r=ar();t.exports=!r((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))})),yl=$(((e,t)=>{"use strict";var r=fi(),i=ri(),n=Mi(),a=_x(),s=aA(),o=a("IE_PROTO"),l=Object,h=l.prototype;t.exports=s?l.getPrototypeOf:function(e){var t=n(e);if(r(t,o))return t[o];var a=t.constructor;return i(a)&&t instanceof a?a.prototype:t instanceof l?h:null}})),mv=$(((e,t)=>{"use strict";t.exports={}})),oA=$(((e,t)=>{"use strict";var r=$n(),i=mv(),n=r("iterator"),a=Array.prototype;t.exports=function(e){return void 0!==e&&(i.Array===e||a[n]===e)}})),gv=$(((e,t)=>{"use strict";var r=Qc(),i=rh(),n=fo(),a=mv(),s=$n()("iterator");t.exports=function(e){if(!n(e))return i(e,s)||i(e,"@@iterator")||a[r(e)]}})),Dx=$(((e,t)=>{"use strict";var r=Ln(),i=ps(),n=kn(),a=Yf(),s=gv(),o=TypeError;t.exports=function(e,t){var l=arguments.length<2?s(e):t;if(i(l))return n(r(l,e));throw new o(a(e)+" is not iterable")}})),_F=$(((e,t)=>{"use strict";var r=Ln(),i=kn(),n=rh();t.exports=function(e,t,a){var s,o;i(e);try{if(!(s=n(e,"return"))){if("throw"===t)throw a;return a}s=r(s,e)}catch(e){o=!0,s=e}if("throw"===t)throw a;if(o)throw s;return i(s),a}})),bl=$(((e,t)=>{"use strict";var r=Kl(),i=Ln(),n=kn(),a=Yf(),s=oA(),o=Ui(),l=Fo(),h=Dx(),c=gv(),u=_F(),d=TypeError,p=function(e,t){this.stopped=e,this.result=t},f=p.prototype;t.exports=function(e,t,m){var g,v,y,b,x,_,w,S=m&&m.that,T=!(!m||!m.AS_ENTRIES),M=!(!m||!m.IS_RECORD),E=!(!m||!m.IS_ITERATOR),A=!(!m||!m.INTERRUPTED),C=r(t,S),P=function(e){return g&&u(g,"normal",e),new p(!0,e)},R=function(e){return T?(n(e),A?C(e[0],e[1],P):C(e[0],e[1])):A?C(e,P):C(e)};if(M)g=e.iterator;else if(E)g=e;else{if(!(v=c(e)))throw new d(a(e)+" is not iterable");if(s(v)){for(y=0,b=o(e);b>y;y++)if((x=R(e[y]))&&l(f,x))return x;return new p(!1)}g=h(e,v)}for(_=M?e.next:g.next;!(w=i(_,g)).done;){try{x=R(w.value)}catch(e){u(g,"throw",e)}if("object"==typeof x&&x&&l(f,x))return x}return new p(!1)}})),pJ=$((()=>{"use strict";var e=ct(),t=Fo(),r=yl(),i=eu(),n=ov(),a=No(),s=Wa(),o=ml(),l=pF(),h=gF(),c=bl(),u=pv(),d=$n()("toStringTag"),p=Error,f=[].push,m=function(e,n){var o,v=t(g,this);i?o=i(new p,v?r(this):g):(o=v?this:a(g),s(o,d,"Error")),void 0!==n&&s(o,"message",u(n)),h(o,m,o.stack,1),arguments.length>2&&l(o,arguments[2]);var y=[];return c(e,f,{that:y}),s(o,"errors",y),o};i?i(m,p):n(m,p,{name:!0});var g=m.prototype=a(p.prototype,{constructor:o(1,m),message:o(1,""),name:o(1,"AggregateError")});e({global:!0,constructor:!0,arity:2},{AggregateError:m})})),mJ=$((()=>{"use strict";pJ()})),bJ=$((()=>{"use strict";var e=ct(),t=Qi(),r=vl(),i=ar(),n=vF(),a="AggregateError",s=t(a),o=!i((function(){return 1!==s([1]).errors[0]}))&&i((function(){return 7!==s([1],a,{cause:7}).cause}));e({global:!0,constructor:!0,arity:2,forced:o},{AggregateError:n(a,(function(e){return function(t,i){return r(e,this,arguments)}}),o,!0)})})),go=$(((e,t)=>{"use strict";var r=$n(),i=No(),n=ms().f,a=r("unscopables"),s=Array.prototype;void 0===s[a]&&n(s,a,{configurable:!0,value:i(null)}),t.exports=function(e){s[a][e]=!0}})),EJ=$((()=>{"use strict";var e=ct(),t=Mi(),r=Ui(),i=Ps(),n=go();e({target:"Array",proto:!0},{at:function(e){var n=t(this),a=r(n),s=i(e),o=s>=0?s:a+s;return o<0||o>=a?void 0:n[o]}}),n("at")})),Zm=$(((e,t)=>{"use strict";var r=TypeError;t.exports=function(e){if(e>9007199254740991)throw r("Maximum allowed index exceeded");return e}})),_d=$(((e,t)=>{"use strict";var r=nh(),i=ms(),n=ml();t.exports=function(e,t,a){var s=r(t);s in e?i.f(e,s,n(0,a)):e[s]=a}})),yv=$(((e,t)=>{"use strict";var r=ar(),i=$n(),n=th(),a=i("species");t.exports=function(e){return n>=51||!r((function(){var t=[];return(t.constructor={})[a]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}})),RJ=$((()=>{"use strict";var e=ct(),t=ar(),r=bd(),i=zn(),n=Mi(),a=Ui(),s=Zm(),o=_d(),l=uv(),h=yv(),c=$n(),u=th(),d=c("isConcatSpreadable"),p=u>=51||!t((function(){var e=[];return e[d]=!1,e.concat()[0]!==e})),f=function(e){if(!i(e))return!1;var t=e[d];return void 0!==t?!!t:r(e)};e({target:"Array",proto:!0,arity:1,forced:!p||!h("concat")},{concat:function(e){var t,r,i,h,c,u=n(this),d=l(u,0),p=0;for(t=-1,i=arguments.length;t<i;t++)if(f(c=-1===t?u:arguments[t]))for(h=a(c),s(p+h),r=0;r<h;r++,p++)r in c&&o(d,p,c[r]);else s(p+1),o(d,p++,c);return d.length=p,d}})})),Lx=$(((e,t)=>{"use strict";var r=Yf(),i=TypeError;t.exports=function(e,t){if(!delete e[t])throw new i("Cannot delete property "+r(t)+" of "+r(e))}})),PF=$(((e,t)=>{"use strict";var r=Mi(),i=ih(),n=Ui(),a=Lx(),s=Math.min;t.exports=[].copyWithin||function(e,t){var o=r(this),l=n(o),h=i(e,l),c=i(t,l),u=arguments.length>2?arguments[2]:void 0,d=s((void 0===u?l:i(u,l))-c,l-h),p=1;for(c<h&&h<c+d&&(p=-1,c+=d-1,h+=d-1);d-- >0;)c in o?o[h]=o[c]:a(o,h),h+=p,c+=p;return o}})),OJ=$((()=>{"use strict";var e=ct(),t=PF(),r=go();e({target:"Array",proto:!0},{copyWithin:t}),r("copyWithin")})),ah=$(((e,t)=>{"use strict";var r=ar();t.exports=function(e,t){var i=[][e];return!!i&&r((function(){i.call(null,t||function(){return 1},1)}))}})),LJ=$((()=>{"use strict";var e=ct(),t=pa().every;e({target:"Array",proto:!0,forced:!ah()("every")},{every:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),hA=$(((e,t)=>{"use strict";var r=Mi(),i=ih(),n=Ui();t.exports=function(e){for(var t=r(this),a=n(t),s=arguments.length,o=i(s>1?arguments[1]:void 0,a),l=s>2?arguments[2]:void 0,h=void 0===l?a:i(l,a);h>o;)t[o++]=e;return t}})),BJ=$((()=>{"use strict";var e=ct(),t=hA(),r=go();e({target:"Array",proto:!0},{fill:t}),r("fill")})),NJ=$((()=>{"use strict";var e=ct(),t=pa().filter;e({target:"Array",proto:!0,forced:!yv()("filter")},{filter:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),HJ=$((()=>{"use strict";var e=ct(),t=pa().find,r=go(),i="find",n=!0;i in[]&&Array(1)[i]((function(){n=!1})),e({target:"Array",proto:!0,forced:n},{find:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r(i)})),zJ=$((()=>{"use strict";var e=ct(),t=pa().findIndex,r=go(),i="findIndex",n=!0;i in[]&&Array(1)[i]((function(){n=!1})),e({target:"Array",proto:!0,forced:n},{findIndex:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r(i)})),kx=$(((e,t)=>{"use strict";var r=Kl(),i=Um(),n=Mi(),a=Ui(),s=function(e){var t=1===e;return function(s,o,l){for(var h,c=n(s),u=i(c),d=a(u),p=r(o,l);d-- >0;)if(p(h=u[d],d,c))switch(e){case 0:return h;case 1:return d}return t?-1:void 0}};t.exports={findLast:s(0),findLastIndex:s(1)}})),jJ=$((()=>{"use strict";var e=ct(),t=kx().findLast,r=go();e({target:"Array",proto:!0},{findLast:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r("findLast")})),WJ=$((()=>{"use strict";var e=ct(),t=kx().findLastIndex,r=go();e({target:"Array",proto:!0},{findLastIndex:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r("findLastIndex")})),DF=$(((e,t)=>{"use strict";var r=bd(),i=Ui(),n=Zm(),a=Kl(),s=function(e,t,o,l,h,c,u,d){for(var p,f,m=h,g=0,v=!!u&&a(u,d);g<l;)g in o&&(p=v?v(o[g],g,t):o[g],c>0&&r(p)?(f=i(p),m=s(e,t,p,f,m,c-1)-1):(n(m+1),e[m]=p),m++),g++;return m};t.exports=s})),$J=$((()=>{"use strict";var e=ct(),t=DF(),r=Mi(),i=Ui(),n=Ps(),a=uv();e({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,s=r(this),o=i(s),l=a(s,0);return l.length=t(l,s,s,o,0,void 0===e?1:n(e)),l}})})),ZJ=$((()=>{"use strict";var e=ct(),t=DF(),r=ps(),i=Mi(),n=Ui(),a=uv();e({target:"Array",proto:!0},{flatMap:function(e){var s,o=i(this),l=n(o);return r(e),(s=a(o,0)).length=t(s,o,o,l,0,1,e,arguments.length>1?arguments[1]:void 0),s}})})),LF=$(((e,t)=>{"use strict";var r=pa().forEach,i=ah()("forEach");t.exports=i?[].forEach:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})),QJ=$((()=>{"use strict";var e=ct(),t=LF();e({target:"Array",proto:!0,forced:[].forEach!==t},{forEach:t})})),tQ=$(((e,t)=>{"use strict";var r=kn(),i=_F();t.exports=function(e,t,n,a){try{return a?t(r(n)[0],n[1]):t(n)}catch(t){i(e,"throw",t)}}})),kF=$(((e,t)=>{"use strict";var r=Kl(),i=Ln(),n=Mi(),a=tQ(),s=oA(),o=jm(),l=Ui(),h=_d(),c=Dx(),u=gv(),d=Array;t.exports=function(e){var t=n(e),p=o(this),f=arguments.length,m=f>1?arguments[1]:void 0,g=void 0!==m;g&&(m=r(m,f>2?arguments[2]:void 0));var v,y,b,x,_,w,S=u(t),T=0;if(!S||this===d&&s(S))for(v=l(t),y=p?new this(v):d(v);v>T;T++)w=g?m(t[T],T):t[T],h(y,T,w);else for(_=(x=c(t,S)).next,y=p?new this:[];!(b=i(_,x)).done;T++)w=g?a(x,m,[b.value,T],!0):b.value,h(y,T,w);return y.length=T,y}})),Fx=$(((e,t)=>{"use strict";var r,i,n=$n()("iterator"),a=!1;try{r=0,(i={next:function(){return{done:!!r++}},return:function(){a=!0}})[n]=function(){return this},Array.from(i,(function(){throw 2}))}catch(e){}t.exports=function(e,t){try{if(!t&&!a)return!1}catch(e){return!1}var r=!1;try{var i={};i[n]=function(){return{next:function(){return{done:r=!0}}}},e(i)}catch(e){}return r}})),cQ=$((()=>{"use strict";var e=ct(),t=kF();e({target:"Array",stat:!0,forced:!Fx()((function(e){Array.from(e)}))},{from:t})})),uQ=$((()=>{"use strict";var e=ct(),t=av().includes,r=ar(),i=go();e({target:"Array",proto:!0,forced:r((function(){return!Array(1).includes()}))},{includes:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),i("includes")})),dQ=$((()=>{"use strict";var e=ct(),t=yd(),r=av().indexOf,i=ah(),n=t([].indexOf),a=!!n&&1/n([1],1,-0)<0;e({target:"Array",proto:!0,forced:a||!i("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return a?n(this,e,t)||0:r(this,e,t)}})})),fQ=$((()=>{"use strict";ct()({target:"Array",stat:!0},{isArray:bd()})})),VF=$(((e,t)=>{"use strict";var r,i,n,a=ar(),s=ri(),o=zn(),l=No(),h=yl(),c=os(),u=$n(),d=_s(),p=u("iterator"),f=!1;[].keys&&("next"in(n=[].keys())?(i=h(h(n)))!==Object.prototype&&(r=i):f=!0),!o(r)||a((function(){var e={};return r[p].call(e)!==e}))?r={}:d&&(r=l(r)),s(r[p])||c(r,p,(function(){return this})),t.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:f}})),dA=$(((e,t)=>{"use strict";var r=VF().IteratorPrototype,i=No(),n=ml(),a=mo(),s=mv(),o=function(){return this};t.exports=function(e,t,l,h){var c=t+" Iterator";return e.prototype=i(r,{next:n(+!h,l)}),a(e,c,!1,!0),s[c]=o,e}})),mA=$(((e,t)=>{"use strict";var r=ct(),i=Ln(),n=_s(),a=Gm(),s=ri(),o=dA(),l=yl(),h=eu(),c=mo(),u=Wa(),d=os(),p=$n(),f=mv(),m=VF(),g=a.PROPER,v=a.CONFIGURABLE,y=m.IteratorPrototype,b=m.BUGGY_SAFARI_ITERATORS,x=p("iterator"),_="keys",w="values",S="entries",T=function(){return this};t.exports=function(e,t,a,p,m,M,E){o(a,t,p);var A,C,P,R=function(e){if(e===m&&k)return k;if(!b&&e&&e in L)return L[e];switch(e){case _:case w:case S:return function(){return new a(this,e)}}return function(){return new a(this)}},I=t+" Iterator",O=!1,L=e.prototype,D=L[x]||L["@@iterator"]||m&&L[m],k=!b&&D||R(m),F="Array"===t&&L.entries||D;if(F&&((A=l(F.call(new e)))!==Object.prototype&&A.next&&(!n&&l(A)!==y&&(h?h(A,y):s(A[x])||d(A,x,T)),c(A,I,!0,!0),n&&(f[I]=T))),g&&m===w&&D&&D.name!==w&&(!n&&v?u(L,"name",w):(O=!0,k=function(){return i(D,this)})),m)if(C={values:R(w),keys:M?k:R(_),entries:R(S)},E)for(P in C)(b||O||!(P in L))&&d(L,P,C[P]);else r({target:t,proto:!0,forced:b||O},C);return(!n||E)&&L[x]!==k&&d(L,x,k,{name:m}),f[t]=k,C}})),bv=$(((e,t)=>{"use strict";t.exports=function(e,t){return{value:e,done:t}}})),Ux=$(((e,t)=>{"use strict";var r=na(),i=go(),n=mv(),a=Ws(),s=ms().f,o=mA(),l=bv(),h=_s(),c=un(),u="Array Iterator",d=a.set,p=a.getterFor(u);t.exports=o(Array,"Array",(function(e,t){d(this,{type:u,target:r(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=void 0,l(void 0,!0);switch(e.kind){case"keys":return l(r,!1);case"values":return l(t[r],!1)}return l([r,t[r]],!1)}),"values");var f=n.Arguments=n.Array;if(i("keys"),i("values"),i("entries"),!h&&c&&"values"!==f.name)try{s(f,"name",{value:"values"})}catch(e){}})),LQ=$((()=>{"use strict";var e=ct(),t=cr(),r=Um(),i=na(),n=ah(),a=t([].join);e({target:"Array",proto:!0,forced:r!==Object||!n("join",",")},{join:function(e){return a(i(this),void 0===e?",":e)}})})),jF=$(((e,t)=>{"use strict";var r=vl(),i=na(),n=Ps(),a=Ui(),s=ah(),o=Math.min,l=[].lastIndexOf,h=!!l&&1/[1].lastIndexOf(1,-0)<0,c=s("lastIndexOf"),u=h||!c;t.exports=u?function(e){if(h)return r(l,this,arguments)||0;var t=i(this),s=a(t),c=s-1;for(arguments.length>1&&(c=o(c,n(arguments[1]))),c<0&&(c=s+c);c>=0;c--)if(c in t&&t[c]===e)return c||0;return-1}:l})),NQ=$((()=>{"use strict";var e=ct(),t=jF();e({target:"Array",proto:!0,forced:t!==[].lastIndexOf},{lastIndexOf:t})})),UQ=$((()=>{"use strict";var e=ct(),t=pa().map;e({target:"Array",proto:!0,forced:!yv()("map")},{map:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),VQ=$((()=>{"use strict";var e=ct(),t=ar(),r=jm(),i=_d(),n=Array;e({target:"Array",stat:!0,forced:t((function(){function e(){}return!(n.of.call(e)instanceof e)}))},{of:function(){for(var e=0,t=arguments.length,a=new(r(this)?this:n)(t);t>e;)i(a,e,arguments[e++]);return a.length=t,a}})})),vA=$(((e,t)=>{"use strict";var r=un(),i=bd(),n=TypeError,a=Object.getOwnPropertyDescriptor,s=r&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();t.exports=s?function(e,t){if(i(e)&&!a(e,"length").writable)throw new n("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}})),GQ=$((()=>{"use strict";var e=ct(),t=Mi(),r=Ui(),i=vA(),n=Zm();e({target:"Array",proto:!0,arity:1,forced:ar()((function(){return 4294967297!==[].push.call({length:4294967296},1)}))||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}}()},{push:function(e){var a=t(this),s=r(a),o=arguments.length;n(s+o);for(var l=0;l<o;l++)a[s]=arguments[l],s++;return i(a,s),s}})})),Hx=$(((e,t)=>{"use strict";var r=ps(),i=Mi(),n=Um(),a=Ui(),s=TypeError,o=function(e){return function(t,o,l,h){var c=i(t),u=n(c),d=a(c);r(o);var p=e?d-1:0,f=e?-1:1;if(l<2)for(;;){if(p in u){h=u[p],p+=f;break}if(p+=f,e?p<0:d<=p)throw new s("Reduce of empty array with no initial value")}for(;e?p>=0:d>p;p+=f)p in u&&(h=o(h,u[p],p,c));return h}};t.exports={left:o(!1),right:o(!0)}})),wd=$(((e,t)=>{"use strict";var r=Ir(),i=qa();t.exports="process"===i(r.process)})),YQ=$((()=>{"use strict";var e=ct(),t=Hx().left,r=ah(),i=th();e({target:"Array",proto:!0,forced:!wd()&&i>79&&i<83||!r("reduce")},{reduce:function(e){var r=arguments.length;return t(this,e,r,r>1?arguments[1]:void 0)}})})),ZQ=$((()=>{"use strict";var e=ct(),t=Hx().right,r=ah(),i=th();e({target:"Array",proto:!0,forced:!wd()&&i>79&&i<83||!r("reduceRight")},{reduceRight:function(e){return t(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})})),JQ=$((()=>{"use strict";var e=ct(),t=cr(),r=bd(),i=t([].reverse),n=[1,2];e({target:"Array",proto:!0,forced:String(n)===String(n.reverse())},{reverse:function(){return r(this)&&(this.length=this.length),i(this)}})})),tee=$((()=>{"use strict";var e=ct(),t=bd(),r=jm(),i=zn(),n=ih(),a=Ui(),s=na(),o=_d(),l=$n(),h=yv(),c=gl(),u=h("slice"),d=l("species"),p=Array,f=Math.max;e({target:"Array",proto:!0,forced:!u},{slice:function(e,l){var h,u,m,g=s(this),v=a(g),y=n(e,v),b=n(void 0===l?v:l,v);if(t(g)&&(h=g.constructor,r(h)&&(h===p||t(h.prototype))?h=void 0:i(h)&&(null===(h=h[d])&&(h=void 0)),h===p||void 0===h))return c(g,y,b);for(u=new(void 0===h?p:h)(f(b-y,0)),m=0;y<b;y++,m++)y in g&&o(u,m,g[y]);return u.length=m,u}})})),ree=$((()=>{"use strict";var e=ct(),t=pa().some;e({target:"Array",proto:!0,forced:!ah()("some")},{some:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),yA=$(((e,t)=>{"use strict";var r=gl(),i=Math.floor,n=function(e,t){var a=e.length;if(a<8)for(var s,o,l=1;l<a;){for(o=l,s=e[l];o&&t(e[o-1],s)>0;)e[o]=e[--o];o!==l++&&(e[o]=s)}else for(var h=i(a/2),c=n(r(e,0,h),t),u=n(r(e,h),t),d=c.length,p=u.length,f=0,m=0;f<d||m<p;)e[f+m]=f<d&&m<p?t(c[f],u[m])<=0?c[f++]:u[m++]:f<d?c[f++]:u[m++];return e};t.exports=n})),YF=$(((e,t)=>{"use strict";var r=eh().match(/firefox\/(\d+)/i);t.exports=!!r&&+r[1]})),$F=$(((e,t)=>{"use strict";var r=eh();t.exports=/MSIE|Trident/.test(r)})),bA=$(((e,t)=>{"use strict";var r=eh().match(/AppleWebKit\/(\d+)\./);t.exports=!!r&&+r[1]})),yee=$((()=>{"use strict";var e=ct(),t=cr(),r=ps(),i=Mi(),n=Ui(),a=Lx(),s=Rn(),o=ar(),l=yA(),h=ah(),c=YF(),u=$F(),d=th(),p=bA(),f=[],m=t(f.sort),g=t(f.push),v=o((function(){f.sort(void 0)})),y=o((function(){f.sort(null)})),b=h("sort"),x=!o((function(){if(d)return d<70;if(!(c&&c>3)){if(u)return!0;if(p)return p<603;var e,t,r,i,n="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(i=0;i<47;i++)f.push({k:t+i,v:r})}for(f.sort((function(e,t){return t.v-e.v})),i=0;i<f.length;i++)t=f[i].k.charAt(0),n.charAt(n.length-1)!==t&&(n+=t);return"DGBEFHACIJK"!==n}}));e({target:"Array",proto:!0,forced:v||!y||!b||!x},{sort:function(e){void 0!==e&&r(e);var t=i(this);if(x)return void 0===e?m(t):m(t,e);var o,h,c=[],u=n(t);for(h=0;h<u;h++)h in t&&g(c,t[h]);for(l(c,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:s(t)>s(r)?1:-1}}(e)),o=n(c),h=0;h<o;)t[h]=c[h++];for(;h<u;)a(t,h++);return t}})})),Km=$(((e,t)=>{"use strict";var r=Qi(),i=fa(),n=$n(),a=un(),s=n("species");t.exports=function(e){var t=r(e);a&&t&&!t[s]&&i(t,s,{configurable:!0,get:function(){return this}})}})),Eee=$((()=>{"use strict";Km()("Array")})),_ee=$((()=>{"use strict";var e=ct(),t=Mi(),r=ih(),i=Ps(),n=Ui(),a=vA(),s=Zm(),o=uv(),l=_d(),h=Lx(),c=yv()("splice"),u=Math.max,d=Math.min;e({target:"Array",proto:!0,forced:!c},{splice:function(e,c){var p,f,m,g,v,y,b=t(this),x=n(b),_=r(e,x),w=arguments.length;for(0===w?p=f=0:1===w?(p=0,f=x-_):(p=w-2,f=d(u(i(c),0),x-_)),s(x+p-f),m=o(b,f),g=0;g<f;g++)(v=_+g)in b&&l(m,g,b[v]);if(m.length=f,p<f){for(g=_;g<x-f;g++)y=g+p,(v=g+f)in b?b[y]=b[v]:h(b,y);for(g=x;g>x-f+p;g--)h(b,g-1)}else if(p>f)for(g=x-f;g>_;g--)y=g+p-1,(v=g+f-1)in b?b[y]=b[v]:h(b,y);for(g=0;g<p;g++)b[g+_]=arguments[g+2];return a(b,x-f+p),m}})})),JF=$(((e,t)=>{"use strict";var r=Ui();t.exports=function(e,t){for(var i=r(e),n=new t(i),a=0;a<i;a++)n[a]=e[i-a-1];return n}})),wee=$((()=>{"use strict";var e=ct(),t=JF(),r=na(),i=go(),n=Array;e({target:"Array",proto:!0},{toReversed:function(){return t(r(this),n)}}),i("toReversed")})),Vx=$(((e,t)=>{"use strict";var r=Ui();t.exports=function(e,t,i){for(var n=0,a=arguments.length>2?i:r(t),s=new e(a);a>n;)s[n]=t[n++];return s}})),Aee=$(((e,t)=>{"use strict";var r=Ir();t.exports=function(e,t){var i=r[e],n=i&&i.prototype;return n&&n[t]}})),Ree=$((()=>{"use strict";var e=ct(),t=cr(),r=ps(),i=na(),n=Vx(),a=Aee(),s=go(),o=Array,l=t(a("Array","sort"));e({target:"Array",proto:!0},{toSorted:function(e){void 0!==e&&r(e);var t=i(this),a=n(o,t);return l(a,e)}}),s("toSorted")})),Cee=$((()=>{"use strict";var e=ct(),t=go(),r=Zm(),i=Ui(),n=ih(),a=na(),s=Ps(),o=Array,l=Math.max,h=Math.min;e({target:"Array",proto:!0},{toSpliced:function(e,t){var c,u,d,p,f=a(this),m=i(f),g=n(e,m),v=arguments.length,y=0;for(0===v?c=u=0:1===v?(c=0,u=m-g):(c=v-2,u=h(l(s(t),0),m-g)),d=r(m+c-u),p=o(d);y<g;y++)p[y]=f[y];for(;y<g+c;y++)p[y]=arguments[y-g+2];for(;y<d;y++)p[y]=f[y+u-c];return p}}),t("toSpliced")})),Pee=$((()=>{"use strict";go()("flat")})),Iee=$((()=>{"use strict";go()("flatMap")})),Oee=$((()=>{"use strict";var e=ct(),t=Mi(),r=Ui(),i=vA(),n=Lx(),a=Zm();e({target:"Array",proto:!0,arity:1,forced:1!==[].unshift(0)||!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}}()},{unshift:function(e){var s=t(this),o=r(s),l=arguments.length;if(l){a(o+l);for(var h=o;h--;){var c=h+l;h in s?s[c]=s[h]:n(s,c)}for(var u=0;u<l;u++)s[u]=arguments[u]}return i(s,o+l)}})})),QF=$(((e,t)=>{"use strict";var r=Ui(),i=Ps(),n=RangeError;t.exports=function(e,t,a,s){var o=r(e),l=i(a),h=l<0?o+l:l;if(h>=o||h<0)throw new n("Incorrect index");for(var c=new t(o),u=0;u<o;u++)c[u]=u===h?s:e[u];return c}})),Lee=$((()=>{"use strict";var e=ct(),t=QF(),r=na(),i=Array;e({target:"Array",proto:!0},{with:function(e,n){return t(r(this),i,e,n)}})})),xA=$(((e,t)=>{"use strict";t.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView})),xv=$(((e,t)=>{"use strict";var r=os();t.exports=function(e,t,i){for(var n in t)r(e,n,t[n],i);return e}})),tu=$(((e,t)=>{"use strict";var r=Fo(),i=TypeError;t.exports=function(e,t){if(r(t,e))return e;throw new i("Incorrect invocation")}})),eB=$(((e,t)=>{"use strict";var r=Ps(),i=Bo(),n=RangeError;t.exports=function(e){if(void 0===e)return 0;var t=r(e),a=i(t);if(t!==a)throw new n("Wrong length or index");return a}})),EA=$(((e,t)=>{"use strict";t.exports=Math.sign||function(e){var t=+e;return 0===t||t!=t?t:t<0?-1:1}})),Gee=$(((e,t)=>{"use strict";var r=EA(),i=Math.abs,n=2220446049250313e-31,a=1/n;t.exports=function(e,t,s,o){var l=+e,h=i(l),c=r(l);if(h<o)return c*function(e){return e+a-a}(h/o/t)*o*t;var u=(1+t/n)*h,d=u-(u-h);return d>s||d!=d?c*(1/0):c*d}})),tB=$(((e,t)=>{"use strict";var r=Gee();t.exports=Math.fround||function(e){return r(e,1.1920928955078125e-7,34028234663852886e22,11754943508222875e-54)}})),Wee=$(((e,t)=>{"use strict";var r=Array,i=Math.abs,n=Math.pow,a=Math.floor,s=Math.log,o=Math.LN2;t.exports={pack:function(e,t,l){var h,c,u,d=r(l),p=8*l-t-1,f=(1<<p)-1,m=f>>1,g=23===t?n(2,-24)-n(2,-77):0,v=e<0||0===e&&1/e<0?1:0,y=0;for((e=i(e))!=e||e===1/0?(c=e!=e?1:0,h=f):(h=a(s(e)/o),e*(u=n(2,-h))<1&&(h--,u*=2),(e+=h+m>=1?g/u:g*n(2,1-m))*u>=2&&(h++,u/=2),h+m>=f?(c=0,h=f):h+m>=1?(c=(e*u-1)*n(2,t),h+=m):(c=e*n(2,m-1)*n(2,t),h=0));t>=8;)d[y++]=255&c,c/=256,t-=8;for(h=h<<t|c,p+=t;p>0;)d[y++]=255&h,h/=256,p-=8;return d[--y]|=128*v,d},unpack:function(e,t){var r,i=e.length,a=8*i-t-1,s=(1<<a)-1,o=s>>1,l=a-7,h=i-1,c=e[h--],u=127&c;for(c>>=7;l>0;)u=256*u+e[h--],l-=8;for(r=u&(1<<-l)-1,u>>=-l,l+=t;l>0;)r=256*r+e[h--],l-=8;if(0===u)u=1-o;else{if(u===s)return r?NaN:c?-1/0:1/0;r+=n(2,t),u-=o}return(c?-1:1)*r*n(2,u-t)}}})),qx=$(((e,t)=>{"use strict";var r,i,n,a=Ir(),s=cr(),o=un(),l=xA(),h=Gm(),c=Wa(),u=fa(),d=xv(),p=ar(),f=tu(),m=Ps(),g=Bo(),v=eB(),y=tB(),b=Wee(),x=yl(),_=eu(),w=hA(),S=gl(),T=Jf(),M=ov(),E=mo(),A=Ws(),C=h.PROPER,P=h.CONFIGURABLE,R="ArrayBuffer",I="DataView",O="prototype",L="Wrong index",D=A.getterFor(R),k=A.getterFor(I),F=A.set,N=a[R],U=N,B=U&&U[O],z=a[I],H=z&&z[O],V=Object.prototype,j=a.Array,G=a.RangeError,W=s(w),X=s([].reverse),q=b.pack,Y=b.unpack,$=function(e){return[255&e]},Z=function(e){return[255&e,e>>8&255]},K=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},J=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},Q=function(e){return q(y(e),23,4)},ee=function(e){return q(e,52,8)},te=function(e,t,r){u(e[O],t,{configurable:!0,get:function(){return r(this)[t]}})},re=function(e,t,r,i){var n=k(e),a=v(r),s=!!i;if(a+t>n.byteLength)throw new G(L);var o=n.bytes,l=a+n.byteOffset,h=S(o,l,l+t);return s?h:X(h)},ie=function(e,t,r,i,n,a){var s=k(e),o=v(r),l=i(+n),h=!!a;if(o+t>s.byteLength)throw new G(L);for(var c=s.bytes,u=o+s.byteOffset,d=0;d<t;d++)c[u+d]=l[h?d:t-d-1]};l?(r=C&&N.name!==R,p((function(){N(1)}))&&p((function(){new N(-1)}))&&!p((function(){return new N,new N(1.5),new N(NaN),1!==N.length||r&&!P}))?r&&P&&c(N,"name",R):((U=function(e){return f(this,B),T(new N(v(e)),this,U)})[O]=B,B.constructor=U,M(U,N)),_&&x(H)!==V&&_(H,V),i=new z(new U(2)),n=s(H.setInt8),i.setInt8(0,2147483648),i.setInt8(1,2147483649),(i.getInt8(0)||!i.getInt8(1))&&d(H,{setInt8:function(e,t){n(this,e,t<<24>>24)},setUint8:function(e,t){n(this,e,t<<24>>24)}},{unsafe:!0})):(B=(U=function(e){f(this,B);var t=v(e);F(this,{type:R,bytes:W(j(t),0),byteLength:t}),o||(this.byteLength=t,this.detached=!1)})[O],H=(z=function(e,t,r){f(this,H),f(e,B);var i=D(e),n=i.byteLength,a=m(t);if(a<0||a>n)throw new G("Wrong offset");if(a+(r=void 0===r?n-a:g(r))>n)throw new G("Wrong length");F(this,{type:I,buffer:e,byteLength:r,byteOffset:a,bytes:i.bytes}),o||(this.buffer=e,this.byteLength=r,this.byteOffset=a)})[O],o&&(te(U,"byteLength",D),te(z,"buffer",k),te(z,"byteLength",k),te(z,"byteOffset",k)),d(H,{getInt8:function(e){return re(this,1,e)[0]<<24>>24},getUint8:function(e){return re(this,1,e)[0]},getInt16:function(e){var t=re(this,2,e,arguments.length>1&&arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=re(this,2,e,arguments.length>1&&arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return J(re(this,4,e,arguments.length>1&&arguments[1]))},getUint32:function(e){return J(re(this,4,e,arguments.length>1&&arguments[1]))>>>0},getFloat32:function(e){return Y(re(this,4,e,arguments.length>1&&arguments[1]),23)},getFloat64:function(e){return Y(re(this,8,e,arguments.length>1&&arguments[1]),52)},setInt8:function(e,t){ie(this,1,e,$,t)},setUint8:function(e,t){ie(this,1,e,$,t)},setInt16:function(e,t){ie(this,2,e,Z,t,arguments.length>2&&arguments[2])},setUint16:function(e,t){ie(this,2,e,Z,t,arguments.length>2&&arguments[2])},setInt32:function(e,t){ie(this,4,e,K,t,arguments.length>2&&arguments[2])},setUint32:function(e,t){ie(this,4,e,K,t,arguments.length>2&&arguments[2])},setFloat32:function(e,t){ie(this,4,e,Q,t,arguments.length>2&&arguments[2])},setFloat64:function(e,t){ie(this,8,e,ee,t,arguments.length>2&&arguments[2])}})),E(U,R),E(z,I),t.exports={ArrayBuffer:U,DataView:z}})),hte=$((()=>{"use strict";var e=ct(),t=Ir(),r=qx(),i=Km(),n="ArrayBuffer",a=r[n];e({global:!0,constructor:!0,forced:t[n]!==a},{ArrayBuffer:a}),i(n)})),Gn=$(((e,t)=>{"use strict";var r,i,n,a=xA(),s=un(),o=Ir(),l=ri(),h=zn(),c=fi(),u=Qc(),d=Yf(),p=Wa(),f=os(),m=fa(),g=Fo(),v=yl(),y=eu(),b=$n(),x=zm(),_=Ws(),w=_.enforce,S=_.get,T=o.Int8Array,M=T&&T.prototype,E=o.Uint8ClampedArray,A=E&&E.prototype,C=T&&v(T),P=M&&v(M),R=Object.prototype,I=o.TypeError,O=b("toStringTag"),L=x("TYPED_ARRAY_TAG"),D="TypedArrayConstructor",k=a&&!!y&&"Opera"!==u(o.opera),F=!1,N={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},U={BigInt64Array:8,BigUint64Array:8},B=function(e){var t=v(e);if(h(t)){var r=S(t);return r&&c(r,D)?r[D]:B(t)}},z=function(e){if(!h(e))return!1;var t=u(e);return c(N,t)||c(U,t)};for(r in N)(n=(i=o[r])&&i.prototype)?w(n)[D]=i:k=!1;for(r in U)(n=(i=o[r])&&i.prototype)&&(w(n)[D]=i);if((!k||!l(C)||C===Function.prototype)&&(C=function(){throw new I("Incorrect invocation")},k))for(r in N)o[r]&&y(o[r],C);if((!k||!P||P===R)&&(P=C.prototype,k))for(r in N)o[r]&&y(o[r].prototype,P);if(k&&v(A)!==P&&y(A,P),s&&!c(P,O))for(r in F=!0,m(P,O,{configurable:!0,get:function(){return h(this)?this[L]:void 0}}),N)o[r]&&p(o[r],L,r);t.exports={NATIVE_ARRAY_BUFFER_VIEWS:k,TYPED_ARRAY_TAG:F&&L,aTypedArray:function(e){if(z(e))return e;throw new I("Target is not a typed array")},aTypedArrayConstructor:function(e){if(l(e)&&(!y||g(C,e)))return e;throw new I(d(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r,i){if(s){if(r)for(var n in N){var a=o[n];if(a&&c(a.prototype,e))try{delete a.prototype[e]}catch(r){try{a.prototype[e]=t}catch(e){}}}(!P[e]||r)&&f(P,e,r?t:k&&M[e]||t,i)}},exportTypedArrayStaticMethod:function(e,t,r){var i,n;if(s){if(y){if(r)for(i in N)if((n=o[i])&&c(n,e))try{delete n[e]}catch(e){}if(C[e]&&!r)return;try{return f(C,e,r?t:k&&C[e]||t)}catch(e){}}for(i in N)(n=o[i])&&(!n[e]||r)&&f(n,e,t)}},getTypedArrayConstructor:B,isView:function(e){if(!h(e))return!1;var t=u(e);return"DataView"===t||c(N,t)||c(U,t)},isTypedArray:z,TypedArray:C,TypedArrayPrototype:P}})),Tte=$((()=>{"use strict";var e=ct(),t=Gn();e({target:"ArrayBuffer",stat:!0,forced:!t.NATIVE_ARRAY_BUFFER_VIEWS},{isView:t.isView})})),OA=$(((e,t)=>{"use strict";var r=jm(),i=Yf(),n=TypeError;t.exports=function(e){if(r(e))return e;throw new n(i(e)+" is not a constructor")}})),Qm=$(((e,t)=>{"use strict";var r=kn(),i=OA(),n=fo(),a=$n()("species");t.exports=function(e,t){var s,o=r(e).constructor;return void 0===o||n(s=r(o)[a])?t:i(s)}})),Ote=$((()=>{"use strict";var e=ct(),t=yd(),r=ar(),i=qx(),n=kn(),a=ih(),s=Bo(),o=Qm(),l=i.ArrayBuffer,h=i.DataView,c=h.prototype,u=t(l.prototype.slice),d=t(c.getUint8),p=t(c.setUint8);e({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:r((function(){return!new l(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(u&&void 0===t)return u(n(this),e);for(var r=n(this).byteLength,i=a(e,r),c=a(void 0===t?r:t,r),f=new(o(this,l))(s(c-i)),m=new h(this),g=new h(f),v=0;i<c;)p(g,v++,d(m,i++));return f}})})),Dte=$((()=>{"use strict";var e=ct(),t=qx();e({global:!0,constructor:!0,forced:!xA()},{DataView:t.DataView})})),Lte=$((()=>{"use strict";Dte()})),kte=$((()=>{"use strict";var e=ct(),t=cr(),r=ar()((function(){return 120!==new Date(16e11).getYear()})),i=t(Date.prototype.getFullYear);e({target:"Date",proto:!0,forced:r},{getYear:function(){return i(this)-1900}})})),Bte=$((()=>{"use strict";var e=ct(),t=cr(),r=Date,i=t(r.prototype.getTime);e({target:"Date",stat:!0},{now:function(){return i(new r)}})})),Hte=$((()=>{"use strict";var e=ct(),t=cr(),r=Ps(),i=Date.prototype,n=t(i.getTime),a=t(i.setFullYear);e({target:"Date",proto:!0},{setYear:function(e){n(this);var t=r(e);return a(this,t>=0&&t<=99?t+1900:t)}})})),Vte=$((()=>{"use strict";ct()({target:"Date",proto:!0},{toGMTString:Date.prototype.toUTCString})})),jx=$(((e,t)=>{"use strict";var r=Ps(),i=Rn(),n=fs(),a=RangeError;t.exports=function(e){var t=i(n(this)),s="",o=r(e);if(o<0||o===1/0)throw new a("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(s+=t);return s}})),DA=$(((e,t)=>{"use strict";var r=cr(),i=Bo(),n=Rn(),a=jx(),s=fs(),o=r(a),l=r("".slice),h=Math.ceil,c=function(e){return function(t,r,a){var c,u,d=n(s(t)),p=i(r),f=d.length,m=void 0===a?" ":n(a);return p<=f||""===m?d:((u=o(m,h((c=p-f)/m.length))).length>c&&(u=l(u,0,c)),e?d+u:u+d)}};t.exports={start:c(!1),end:c(!0)}})),$te=$(((e,t)=>{"use strict";var r=cr(),i=ar(),n=DA().start,a=RangeError,s=isFinite,o=Math.abs,l=Date.prototype,h=l.toISOString,c=r(l.getTime),u=r(l.getUTCDate),d=r(l.getUTCFullYear),p=r(l.getUTCHours),f=r(l.getUTCMilliseconds),m=r(l.getUTCMinutes),g=r(l.getUTCMonth),v=r(l.getUTCSeconds);t.exports=i((function(){return"0385-07-25T07:06:39.999Z"!==h.call(new Date(-50000000000001))}))||!i((function(){h.call(new Date(NaN))}))?function(){if(!s(c(this)))throw new a("Invalid time value");var e=this,t=d(e),r=f(e),i=t<0?"-":t>9999?"+":"";return i+n(o(t),i?6:4,0)+"-"+n(g(e)+1,2,0)+"-"+n(u(e),2,0)+"T"+n(p(e),2,0)+":"+n(m(e),2,0)+":"+n(v(e),2,0)+"."+n(r,3,0)+"Z"}:h})),Kte=$((()=>{"use strict";var e=ct(),t=$te();e({target:"Date",proto:!0,forced:Date.prototype.toISOString!==t},{toISOString:t})})),Jte=$((()=>{"use strict";var e=ct(),t=ar(),r=Mi(),i=xx();e({target:"Date",proto:!0,arity:1,forced:t((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}))},{toJSON:function(e){var t=r(this),n=i(t,"number");return"number"!=typeof n||isFinite(n)?t.toISOString():null}})})),ere=$(((e,t)=>{"use strict";var r=kn(),i=xk(),n=TypeError;t.exports=function(e){if(r(this),"string"===e||"default"===e)e="string";else if("number"!==e)throw new n("Incorrect hint");return i(this,e)}})),nre=$((()=>{"use strict";var e=fi(),t=os(),r=ere(),i=$n()("toPrimitive"),n=Date.prototype;e(n,i)||t(n,i,r)})),ore=$((()=>{"use strict";var e=cr(),t=os(),r=Date.prototype,i="Invalid Date",n="toString",a=e(r[n]),s=e(r.getTime);String(new Date(NaN))!==i&&t(r,n,(function(){var e=s(this);return e==e?a(this):i}))})),cre=$((()=>{"use strict";var e=ct(),t=cr(),r=Rn(),i=t("".charAt),n=t("".charCodeAt),a=t(/./.exec),s=t(1..toString),o=t("".toUpperCase),l=/[\w*+\-./@]/,h=function(e,t){for(var r=s(e,16);r.length<t;)r="0"+r;return r};e({global:!0},{escape:function(e){for(var t,s,c=r(e),u="",d=c.length,p=0;p<d;)t=i(c,p++),a(l,t)?u+=t:u+=(s=n(t,0))<256?"%"+h(s,2):"%u"+o(h(s,4));return u}})})),_B=$(((e,t)=>{"use strict";var r=cr(),i=ps(),n=zn(),a=fi(),s=gl(),o=nv(),l=Function,h=r([].concat),c=r([].join),u={};t.exports=o?l.bind:function(e){var t=i(this),r=t.prototype,o=s(arguments,1),d=function(){var r=h(o,s(arguments));return this instanceof d?function(e,t,r){if(!a(u,t)){for(var i=[],n=0;n<t;n++)i[n]="a["+n+"]";u[t]=l("C,a","return new C("+c(i,",")+")")}return u[t](e,r)}(t,r.length,r):t.apply(e,r)};return n(r)&&(d.prototype=r),d}})),mre=$((()=>{"use strict";var e=ct(),t=_B();e({target:"Function",proto:!0,forced:Function.bind!==t},{bind:t})})),yre=$((()=>{"use strict";var e=ri(),t=zn(),r=ms(),i=Fo(),n=$n(),a=HM(),s=n("hasInstance"),o=Function.prototype;s in o||r.f(o,s,{value:a((function(r){if(!e(this)||!t(r))return!1;var n=this.prototype;return t(n)?i(n,r):r instanceof this}),s)})})),_re=$((()=>{"use strict";var e=un(),t=Gm().EXISTS,r=cr(),i=fa(),n=Function.prototype,a=r(n.toString),s=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,o=r(s.exec);e&&!t&&i(n,"name",{configurable:!0,get:function(){try{return o(s,a(this))[1]}catch(e){return""}}})})),Tre=$((()=>{"use strict";var e=ct(),t=Ir();e({global:!0,forced:t.globalThis!==t},{globalThis:t})})),wre=$((()=>{"use strict";var e=Ir();mo()(e.JSON,"JSON",!0)})),LA=$(((e,t)=>{"use strict";var r=ar();t.exports=r((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}}))})),FA=$(((e,t)=>{"use strict";var r=ar(),i=zn(),n=qa(),a=LA(),s=Object.isExtensible,o=r((function(){s(1)}));t.exports=o||a?function(e){return!(!i(e)||a&&"ArrayBuffer"===n(e))&&(!s||s(e))}:s})),tg=$(((e,t)=>{"use strict";var r=ar();t.exports=!r((function(){return Object.isExtensible(Object.preventExtensions({}))}))})),sp=$(((e,t)=>{"use strict";var r=ct(),i=cr(),n=sv(),a=zn(),s=fi(),o=ms().f,l=$f(),h=YM(),c=FA(),u=zm(),d=tg(),p=!1,f=u("meta"),m=0,g=function(e){o(e,f,{value:{objectID:"O"+m++,weakData:{}}})},v=t.exports={enable:function(){v.enable=function(){},p=!0;var e=l.f,t=i([].splice),n={};n[f]=1,e(n).length&&(l.f=function(r){for(var i=e(r),n=0,a=i.length;n<a;n++)if(i[n]===f){t(i,n,1);break}return i},r({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:h.f}))},fastKey:function(e,t){if(!a(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!s(e,f)){if(!c(e))return"F";if(!t)return"E";g(e)}return e[f].objectID},getWeakData:function(e,t){if(!s(e,f)){if(!c(e))return!0;if(!t)return!1;g(e)}return e[f].weakData},onFreeze:function(e){return d&&p&&c(e)&&!s(e,f)&&g(e),e}};n[f]=!0})),Xx=$(((e,t)=>{"use strict";var r=ct(),i=Ir(),n=cr(),a=lv(),s=os(),o=sp(),l=bl(),h=tu(),c=ri(),u=fo(),d=zn(),p=ar(),f=Fx(),m=mo(),g=Jf();t.exports=function(e,t,v){var y=-1!==e.indexOf("Map"),b=-1!==e.indexOf("Weak"),x=y?"set":"add",_=i[e],w=_&&_.prototype,S=_,T={},M=function(e){var t=n(w[e]);s(w,e,"add"===e?function(e){return t(this,0===e?0:e),this}:"delete"===e?function(e){return!(b&&!d(e))&&t(this,0===e?0:e)}:"get"===e?function(e){return b&&!d(e)?void 0:t(this,0===e?0:e)}:"has"===e?function(e){return!(b&&!d(e))&&t(this,0===e?0:e)}:function(e,r){return t(this,0===e?0:e,r),this})};if(a(e,!c(_)||!(b||w.forEach&&!p((function(){(new _).entries().next()})))))S=v.getConstructor(t,e,y,x),o.enable();else if(a(e,!0)){var E=new S,A=E[x](b?{}:-0,1)!==E,C=p((function(){E.has(1)})),P=f((function(e){new _(e)})),R=!b&&p((function(){for(var e=new _,t=5;t--;)e[x](t,t);return!e.has(-0)}));P||((S=t((function(e,t){h(e,w);var r=g(new _,e,S);return u(t)||l(t,r[x],{that:r,AS_ENTRIES:y}),r}))).prototype=w,w.constructor=S),(C||R)&&(M("delete"),M("has"),y&&M("get")),(R||A)&&M(x),b&&w.clear&&delete w.clear}return T[e]=S,r({global:!0,constructor:!0,forced:S!==_},T),m(S,e),b||v.setStrong(S,e,y),S}})),IB=$(((e,t)=>{"use strict";var r=No(),i=fa(),n=xv(),a=Kl(),s=tu(),o=fo(),l=bl(),h=mA(),c=bv(),u=Km(),d=un(),p=sp().fastKey,f=Ws(),m=f.set,g=f.getterFor;t.exports={getConstructor:function(e,t,h,c){var u=e((function(e,i){s(e,f),m(e,{type:t,index:r(null),first:void 0,last:void 0,size:0}),d||(e.size=0),o(i)||l(i,e[c],{that:e,AS_ENTRIES:h})})),f=u.prototype,v=g(t),y=function(e,t,r){var i,n,a=v(e),s=b(e,t);return s?s.value=r:(a.last=s={index:n=p(t,!0),key:t,value:r,previous:i=a.last,next:void 0,removed:!1},a.first||(a.first=s),i&&(i.next=s),d?a.size++:e.size++,"F"!==n&&(a.index[n]=s)),e},b=function(e,t){var r,i=v(e),n=p(t);if("F"!==n)return i.index[n];for(r=i.first;r;r=r.next)if(r.key===t)return r};return n(f,{clear:function(){for(var e=v(this),t=e.first;t;)t.removed=!0,t.previous&&(t.previous=t.previous.next=void 0),t=t.next;e.first=e.last=void 0,e.index=r(null),d?e.size=0:this.size=0},delete:function(e){var t=this,r=v(t),i=b(t,e);if(i){var n=i.next,a=i.previous;delete r.index[i.index],i.removed=!0,a&&(a.next=n),n&&(n.previous=a),r.first===i&&(r.first=n),r.last===i&&(r.last=a),d?r.size--:t.size--}return!!i},forEach:function(e){for(var t,r=v(this),i=a(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:r.first;)for(i(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!b(this,e)}}),n(f,h?{get:function(e){var t=b(this,e);return t&&t.value},set:function(e,t){return y(this,0===e?0:e,t)}}:{add:function(e){return y(this,e=0===e?0:e,e)}}),d&&i(f,"size",{configurable:!0,get:function(){return v(this).size}}),u},setStrong:function(e,t,r){var i=t+" Iterator",n=g(t),a=g(i);h(e,t,(function(e,t){m(this,{type:i,target:e,state:n(e),kind:t,last:void 0})}),(function(){for(var e=a(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?c("keys"===t?r.key:"values"===t?r.value:[r.key,r.value],!1):(e.target=void 0,c(void 0,!0))}),r?"entries":"values",!r,!0),u(t)}}})),Hre=$((()=>{"use strict";Xx()("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),IB())})),Vre=$((()=>{"use strict";Hre()})),OB=$(((e,t)=>{"use strict";var r=cr(),i=Map.prototype;t.exports={Map:Map,set:r(i.set),get:r(i.get),has:r(i.has),remove:r(i.delete),proto:i}})),Gre=$((()=>{"use strict";var e=ct(),t=cr(),r=ps(),i=fs(),n=bl(),a=OB(),s=_s(),o=a.Map,l=a.has,h=a.get,c=a.set,u=t([].push);e({target:"Map",stat:!0,forced:s},{groupBy:function(e,t){i(e),r(t);var a=new o,s=0;return n(e,(function(e){var r=t(e,s++);l(a,r)?u(h(a,r),e):c(a,r,[e])})),a}})})),DB=$(((e,t)=>{"use strict";var r=Math.log;t.exports=Math.log1p||function(e){var t=+e;return t>-1e-8&&t<1e-8?t-t*t/2:r(1+t)}})),Wre=$((()=>{"use strict";var e=ct(),t=DB(),r=Math.acosh,i=Math.log,n=Math.sqrt,a=Math.LN2;e({target:"Math",stat:!0,forced:!r||710!==Math.floor(r(Number.MAX_VALUE))||r(1/0)!==1/0},{acosh:function(e){var r=+e;return r<1?NaN:r>94906265.62425156?i(r)+a:t(r-1+n(r-1)*n(r+1))}})})),$re=$((()=>{"use strict";var e=ct(),t=Math.asinh,r=Math.log,i=Math.sqrt;e({target:"Math",stat:!0,forced:!(t&&1/t(0)>0)},{asinh:function e(t){var n=+t;return isFinite(n)&&0!==n?n<0?-e(-n):r(n+i(n*n+1)):n}})})),Kre=$((()=>{"use strict";var e=ct(),t=Math.atanh,r=Math.log;e({target:"Math",stat:!0,forced:!(t&&1/t(-0)<0)},{atanh:function(e){var t=+e;return 0===t?t:r((1+t)/(1-t))/2}})})),Jre=$((()=>{"use strict";var e=ct(),t=EA(),r=Math.abs,i=Math.pow;e({target:"Math",stat:!0},{cbrt:function(e){var n=+e;return t(n)*i(r(n),1/3)}})})),Qre=$((()=>{"use strict";var e=ct(),t=Math.floor,r=Math.log,i=Math.LOG2E;e({target:"Math",stat:!0},{clz32:function(e){var n=e>>>0;return n?31-t(r(n+.5)*i):32}})})),Kx=$(((e,t)=>{"use strict";var r=Math.expm1,i=Math.exp;t.exports=!r||r(10)>22025.465794806718||r(10)<22025.465794806718||-2e-17!==r(-2e-17)?function(e){var t=+e;return 0===t?t:t>-1e-6&&t<1e-6?t+t*t/2:i(t)-1}:r})),rne=$((()=>{"use strict";var e=ct(),t=Kx(),r=Math.cosh,i=Math.abs,n=Math.E;e({target:"Math",stat:!0,forced:!r||r(710)===1/0},{cosh:function(e){var r=t(i(e)-1)+1;return(r+1/(r*n*n))*(n/2)}})})),ine=$((()=>{"use strict";var e=ct(),t=Kx();e({target:"Math",stat:!0,forced:t!==Math.expm1},{expm1:t})})),sne=$((()=>{"use strict";ct()({target:"Math",stat:!0},{fround:tB()})})),one=$((()=>{"use strict";var e=ct(),t=Math.hypot,r=Math.abs,i=Math.sqrt;e({target:"Math",stat:!0,arity:2,forced:!!t&&t(1/0,NaN)!==1/0},{hypot:function(e,t){for(var n,a,s=0,o=0,l=arguments.length,h=0;o<l;)h<(n=r(arguments[o++]))?(s=s*(a=h/n)*a+1,h=n):n>0?s+=(a=n/h)*a:s+=n;return h===1/0?1/0:h*i(s)}})})),cne=$((()=>{"use strict";var e=ct(),t=ar(),r=Math.imul;e({target:"Math",stat:!0,forced:t((function(){return-5!==r(4294967295,5)||2!==r.length}))},{imul:function(e,t){var r=65535,i=+e,n=+t,a=r&i,s=r&n;return 0|a*s+((r&i>>>16)*s+a*(r&n>>>16)<<16>>>0)}})})),FB=$(((e,t)=>{"use strict";var r=Math.log,i=Math.LOG10E;t.exports=Math.log10||function(e){return r(e)*i}})),hne=$((()=>{"use strict";ct()({target:"Math",stat:!0},{log10:FB()})})),dne=$((()=>{"use strict";ct()({target:"Math",stat:!0},{log1p:DB()})})),fne=$((()=>{"use strict";var e=ct(),t=Math.log,r=Math.LN2;e({target:"Math",stat:!0},{log2:function(e){return t(e)/r}})})),pne=$((()=>{"use strict";ct()({target:"Math",stat:!0},{sign:EA()})})),vne=$((()=>{"use strict";var e=ct(),t=ar(),r=Kx(),i=Math.abs,n=Math.exp,a=Math.E;e({target:"Math",stat:!0,forced:t((function(){return-2e-17!==Math.sinh(-2e-17)}))},{sinh:function(e){var t=+e;return i(t)<1?(r(t)-r(-t))/2:(n(t-1)-n(-t-1))*(a/2)}})})),xne=$((()=>{"use strict";var e=ct(),t=Kx(),r=Math.exp;e({target:"Math",stat:!0},{tanh:function(e){var i=+e,n=t(i),a=t(-i);return n===1/0?1:a===1/0?-1:(n-a)/(r(i)+r(-i))}})})),Ene=$((()=>{"use strict";mo()(Math,"Math",!0)})),_ne=$((()=>{"use strict";ct()({target:"Math",stat:!0},{trunc:Nk()})})),Jx=$(((e,t)=>{"use strict";var r=cr();t.exports=r(1..valueOf)})),Qx=$(((e,t)=>{"use strict";t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"})),rg=$(((e,t)=>{"use strict";var r=cr(),i=fs(),n=Rn(),a=Qx(),s=r("".replace),o=RegExp("^["+a+"]+"),l=RegExp("(^|[^"+a+"])["+a+"]+$"),h=function(e){return function(t){var r=n(i(t));return 1&e&&(r=s(r,o,"")),2&e&&(r=s(r,l,"$1")),r}};t.exports={start:h(1),end:h(2),trim:h(3)}})),Dne=$((()=>{"use strict";var e=ct(),t=_s(),r=un(),i=Ir(),n=$M(),a=cr(),s=lv(),o=fi(),l=Jf(),h=Fo(),c=Xf(),u=xx(),d=ar(),p=$f().f,f=ja().f,m=ms().f,g=Jx(),v=rg().trim,y="Number",b=i[y],x=n[y],_=b.prototype,w=i.TypeError,S=a("".slice),T=a("".charCodeAt),M=function(e){var t,r,i,n,a,s,o,l,h=u(e,"number");if(c(h))throw new w("Cannot convert a Symbol value to a number");if("string"==typeof h&&h.length>2)if(h=v(h),43===(t=T(h,0))||45===t){if(88===(r=T(h,2))||120===r)return NaN}else if(48===t){switch(T(h,1)){case 66:case 98:i=2,n=49;break;case 79:case 111:i=8,n=55;break;default:return+h}for(s=(a=S(h,2)).length,o=0;o<s;o++)if((l=T(a,o))<48||l>n)return NaN;return parseInt(a,i)}return+h},E=s(y,!b(" 0o1")||!b("0b1")||b("+0x1")),A=function(e){var t,r=arguments.length<1?0:b(function(e){var t=u(e,"number");return"bigint"==typeof t?t:M(t)}(e));return h(_,t=this)&&d((function(){g(t)}))?l(Object(r),this,A):r};A.prototype=_,E&&!t&&(_.constructor=A),e({global:!0,constructor:!0,wrap:!0,forced:E},{Number:A});var C=function(e,t){for(var i,n=r?p(t):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),a=0;n.length>a;a++)o(t,i=n[a])&&!o(e,i)&&m(e,i,f(t,i))};t&&x&&C(n[y],x),(E||t)&&C(n[y],b)})),Lne=$((()=>{"use strict";ct()({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{EPSILON:Math.pow(2,-52)})})),Fne=$(((e,t)=>{"use strict";var r=Ir().isFinite;t.exports=Number.isFinite||function(e){return"number"==typeof e&&r(e)}})),Bne=$((()=>{"use strict";ct()({target:"Number",stat:!0},{isFinite:Fne()})})),zA=$(((e,t)=>{"use strict";var r=zn(),i=Math.floor;t.exports=Number.isInteger||function(e){return!r(e)&&isFinite(e)&&i(e)===e}})),Une=$((()=>{"use strict";ct()({target:"Number",stat:!0},{isInteger:zA()})})),Hne=$((()=>{"use strict";ct()({target:"Number",stat:!0},{isNaN:function(e){return e!=e}})})),Vne=$((()=>{"use strict";var e=ct(),t=zA(),r=Math.abs;e({target:"Number",stat:!0},{isSafeInteger:function(e){return t(e)&&r(e)<=9007199254740991}})})),zne=$((()=>{"use strict";ct()({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991})})),Gne=$((()=>{"use strict";ct()({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MIN_SAFE_INTEGER:-9007199254740991})})),GB=$(((e,t)=>{"use strict";var r=Ir(),i=ar(),n=cr(),a=Rn(),s=rg().trim,o=Qx(),l=n("".charAt),h=r.parseFloat,c=r.Symbol,u=c&&c.iterator,d=1/h(o+"-0")!=-1/0||u&&!i((function(){h(Object(u))}));t.exports=d?function(e){var t=s(a(e)),r=h(t);return 0===r&&"-"===l(t,0)?-0:r}:h})),$ne=$((()=>{"use strict";var e=ct(),t=GB();e({target:"Number",stat:!0,forced:Number.parseFloat!==t},{parseFloat:t})})),qB=$(((e,t)=>{"use strict";var r=Ir(),i=ar(),n=cr(),a=Rn(),s=rg().trim,o=Qx(),l=r.parseInt,h=r.Symbol,c=h&&h.iterator,u=/^[+-]?0x/i,d=n(u.exec),p=8!==l(o+"08")||22!==l(o+"0x16")||c&&!i((function(){l(Object(c))}));t.exports=p?function(e,t){var r=s(a(e));return l(r,t>>>0||(d(u,r)?16:10))}:l})),nie=$((()=>{"use strict";var e=ct(),t=qB();e({target:"Number",stat:!0,forced:Number.parseInt!==t},{parseInt:t})})),lie=$((()=>{"use strict";var e=ct(),t=cr(),r=Ps(),i=Jx(),n=jx(),a=FB(),s=ar(),o=RangeError,l=String,h=isFinite,c=Math.abs,u=Math.floor,d=Math.pow,p=Math.round,f=t(1..toExponential),m=t(n),g=t("".slice),v="-6.9000e-11"===f(-69e-12,4)&&"1.25e+0"===f(1.255,2)&&"1.235e+4"===f(12345,3)&&"3e+1"===f(25,0);e({target:"Number",proto:!0,forced:!v||!(s((function(){f(1,1/0)}))&&s((function(){f(1,-1/0)})))||!!s((function(){f(1/0,1/0),f(NaN,1/0)}))},{toExponential:function(e){var t=i(this);if(void 0===e)return f(t);var n=r(e);if(!h(t))return String(t);if(n<0||n>20)throw new o("Incorrect fraction digits");if(v)return f(t,n);var s="",y="",b=0,x="",_="";if(t<0&&(s="-",t=-t),0===t)b=0,y=m("0",n+1);else{var w=a(t);b=u(w);var S=0,T=d(10,b-n);2*t>=(2*(S=p(t/T))+1)*T&&(S+=1),S>=d(10,n+1)&&(S/=10,b+=1),y=l(S)}return 0!==n&&(y=g(y,0,1)+"."+g(y,1)),0===b?(x="+",_="0"):(x=b>0?"+":"-",_=l(c(b))),s+(y+="e"+x+_)}})})),pie=$((()=>{"use strict";var e=ct(),t=cr(),r=Ps(),i=Jx(),n=jx(),a=ar(),s=RangeError,o=String,l=Math.floor,h=t(n),c=t("".slice),u=t(1..toFixed),d=function(e,t,r){return 0===t?r:t%2==1?d(e,t-1,r*e):d(e*e,t/2,r)},p=function(e,t,r){for(var i=-1,n=r;++i<6;)n+=t*e[i],e[i]=n%1e7,n=l(n/1e7)},f=function(e,t){for(var r=6,i=0;--r>=0;)i+=e[r],e[r]=l(i/t),i=i%t*1e7},m=function(e){for(var t=6,r="";--t>=0;)if(""!==r||0===t||0!==e[t]){var i=o(e[t]);r=""===r?i:r+h("0",7-i.length)+i}return r};e({target:"Number",proto:!0,forced:a((function(){return"0.000"!==u(8e-5,3)||"1"!==u(.9,0)||"1.25"!==u(1.255,2)||"1000000000000000128"!==u(0xde0b6b3a7640080,0)}))||!a((function(){u({})}))},{toFixed:function(e){var t,n,a,l,u=i(this),g=r(e),v=[0,0,0,0,0,0],y="",b="0";if(g<0||g>20)throw new s("Incorrect fraction digits");if(u!=u)return"NaN";if(u<=-1e21||u>=1e21)return o(u);if(u<0&&(y="-",u=-u),u>1e-21)if(t=function(e){for(var t=0,r=e;r>=4096;)t+=12,r/=4096;for(;r>=2;)t+=1,r/=2;return t}(u*d(2,69,1))-69,n=t<0?u*d(2,-t,1):u/d(2,t,1),n*=4503599627370496,(t=52-t)>0){for(p(v,0,n),a=g;a>=7;)p(v,1e7,0),a-=7;for(p(v,d(10,a,1),0),a=t-1;a>=23;)f(v,1<<23),a-=23;f(v,1<<a),p(v,1,1),f(v,2),b=m(v)}else p(v,0,n),p(v,1<<-t,0),b=m(v)+h("0",g);return g>0?b=y+((l=b.length)<=g?"0."+h("0",g-l)+b:c(b,0,l-g)+"."+c(b,l-g)):b=y+b,b}})})),vie=$((()=>{"use strict";var e=ct(),t=cr(),r=ar(),i=Jx(),n=t(1..toPrecision);e({target:"Number",proto:!0,forced:r((function(){return"1"!==n(1,void 0)}))||!r((function(){n({})}))},{toPrecision:function(e){return void 0===e?n(i(this)):n(i(this),e)}})})),KB=$(((e,t)=>{"use strict";var r=un(),i=cr(),n=Ln(),a=ar(),s=cv(),o=wx(),l=bx(),h=Mi(),c=Um(),u=Object.assign,d=Object.defineProperty,p=i([].concat);t.exports=!u||a((function(){if(r&&1!==u({b:1},u(d({},"a",{enumerable:!0,get:function(){d(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},i=Symbol("assign detection"),n="abcdefghijklmnopqrst";return e[i]=7,n.split("").forEach((function(e){t[e]=e})),7!==u({},e)[i]||s(u({},t)).join("")!==n}))?function(e,t){for(var i=h(e),a=arguments.length,u=1,d=o.f,f=l.f;a>u;)for(var m,g=c(arguments[u++]),v=d?p(s(g),d(g)):s(g),y=v.length,b=0;y>b;)m=v[b++],(!r||n(f,g,m))&&(i[m]=g[m]);return i}:u})),_ie=$((()=>{"use strict";var e=ct(),t=KB();e({target:"Object",stat:!0,arity:2,forced:Object.assign!==t},{assign:t})})),Tie=$((()=>{"use strict";ct()({target:"Object",stat:!0,sham:!un()},{create:No()})})),nE=$(((e,t)=>{"use strict";var r=_s(),i=Ir(),n=ar(),a=bA();t.exports=r||!n((function(){if(!(a&&a<535)){var e=Math.random();__defineSetter__.call(null,e,(function(){})),delete i[e]}}))})),Mie=$((()=>{"use strict";var e=ct(),t=un(),r=nE(),i=ps(),n=Mi(),a=ms();t&&e({target:"Object",proto:!0,forced:r},{__defineGetter__:function(e,t){a.f(n(this),e,{get:i(t),enumerable:!0,configurable:!0})}})})),Rie=$((()=>{"use strict";var e=ct(),t=un(),r=jM().f;e({target:"Object",stat:!0,forced:Object.defineProperties!==r,sham:!t},{defineProperties:r})})),Pie=$((()=>{"use strict";var e=ct(),t=un(),r=ms().f;e({target:"Object",stat:!0,forced:Object.defineProperty!==r,sham:!t},{defineProperty:r})})),Iie=$((()=>{"use strict";var e=ct(),t=un(),r=nE(),i=ps(),n=Mi(),a=ms();t&&e({target:"Object",proto:!0,forced:r},{__defineSetter__:function(e,t){a.f(n(this),e,{set:i(t),enumerable:!0,configurable:!0})}})})),JB=$(((e,t)=>{"use strict";var r=un(),i=ar(),n=cr(),a=yl(),s=cv(),o=na(),l=n(bx().f),h=n([].push),c=r&&i((function(){var e=Object.create(null);return e[2]=2,!l(e,2)})),u=function(e){return function(t){for(var i,n=o(t),u=s(n),d=c&&null===a(n),p=u.length,f=0,m=[];p>f;)i=u[f++],(!r||(d?i in n:l(n,i)))&&h(m,e?[i,n[i]]:n[i]);return m}};t.exports={entries:u(!0),values:u(!1)}})),Bie=$((()=>{"use strict";var e=ct(),t=JB().entries;e({target:"Object",stat:!0},{entries:function(e){return t(e)}})})),Nie=$((()=>{"use strict";var e=ct(),t=tg(),r=ar(),i=zn(),n=sp().onFreeze,a=Object.freeze;e({target:"Object",stat:!0,forced:r((function(){a(1)})),sham:!t},{freeze:function(e){return a&&i(e)?a(n(e)):e}})})),Uie=$((()=>{"use strict";var e=ct(),t=bl(),r=_d();e({target:"Object",stat:!0},{fromEntries:function(e){var i={};return t(e,(function(e,t){r(i,e,t)}),{AS_ENTRIES:!0}),i}})})),zie=$((()=>{"use strict";var e=ct(),t=ar(),r=na(),i=ja().f,n=un();e({target:"Object",stat:!0,forced:!n||t((function(){i(1)})),sham:!n},{getOwnPropertyDescriptor:function(e,t){return i(r(e),t)}})})),Gie=$((()=>{"use strict";var e=ct(),t=un(),r=zM(),i=na(),n=ja(),a=_d();e({target:"Object",stat:!0,sham:!t},{getOwnPropertyDescriptors:function(e){for(var t,s,o=i(e),l=n.f,h=r(o),c={},u=0;h.length>u;)void 0!==(s=l(o,t=h[u++]))&&a(c,t,s);return c}})})),qie=$((()=>{"use strict";var e=ct(),t=ar(),r=YM().f;e({target:"Object",stat:!0,forced:t((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:r})})),Wie=$((()=>{"use strict";var e=ct(),t=ar(),r=Mi(),i=yl(),n=aA();e({target:"Object",stat:!0,forced:t((function(){i(1)})),sham:!n},{getPrototypeOf:function(e){return i(r(e))}})})),Xie=$((()=>{"use strict";var e=ct(),t=Qi(),r=cr(),i=ps(),n=fs(),a=nh(),s=bl(),o=t("Object","create"),l=r([].push);e({target:"Object",stat:!0},{groupBy:function(e,t){n(e),i(t);var r=o(null),h=0;return s(e,(function(e){var i=a(t(e,h++));i in r?l(r[i],e):r[i]=[e]})),r}})})),Yie=$((()=>{"use strict";ct()({target:"Object",stat:!0},{hasOwn:fi()})})),eN=$(((e,t)=>{"use strict";t.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}})),Zie=$((()=>{"use strict";ct()({target:"Object",stat:!0},{is:eN()})})),Jie=$((()=>{"use strict";var e=ct(),t=FA();e({target:"Object",stat:!0,forced:Object.isExtensible!==t},{isExtensible:t})})),ese=$((()=>{"use strict";var e=ct(),t=ar(),r=zn(),i=qa(),n=LA(),a=Object.isFrozen;e({target:"Object",stat:!0,forced:n||t((function(){a(1)}))},{isFrozen:function(e){return!(r(e)&&(!n||"ArrayBuffer"!==i(e)))||!!a&&a(e)}})})),rse=$((()=>{"use strict";var e=ct(),t=ar(),r=zn(),i=qa(),n=LA(),a=Object.isSealed;e({target:"Object",stat:!0,forced:n||t((function(){a(1)}))},{isSealed:function(e){return!(r(e)&&(!n||"ArrayBuffer"!==i(e)))||!!a&&a(e)}})})),ise=$((()=>{"use strict";var e=ct(),t=Mi(),r=cv();e({target:"Object",stat:!0,forced:ar()((function(){r(1)}))},{keys:function(e){return r(t(e))}})})),sse=$((()=>{"use strict";var e=ct(),t=un(),r=nE(),i=Mi(),n=nh(),a=yl(),s=ja().f;t&&e({target:"Object",proto:!0,forced:r},{__lookupGetter__:function(e){var t,r=i(this),o=n(e);do{if(t=s(r,o))return t.get}while(r=a(r))}})})),ase=$((()=>{"use strict";var e=ct(),t=un(),r=nE(),i=Mi(),n=nh(),a=yl(),s=ja().f;t&&e({target:"Object",proto:!0,forced:r},{__lookupSetter__:function(e){var t,r=i(this),o=n(e);do{if(t=s(r,o))return t.set}while(r=a(r))}})})),ose=$((()=>{"use strict";var e=ct(),t=zn(),r=sp().onFreeze,i=tg(),n=ar(),a=Object.preventExtensions;e({target:"Object",stat:!0,forced:n((function(){a(1)})),sham:!i},{preventExtensions:function(e){return a&&t(e)?a(r(e)):e}})})),dse=$((()=>{"use strict";var e=un(),t=fa(),r=zn(),i=hF(),n=Mi(),a=fs(),s=Object.getPrototypeOf,o=Object.setPrototypeOf,l=Object.prototype,h="__proto__";if(e&&s&&o&&!(h in l))try{t(l,h,{configurable:!0,get:function(){return s(n(this))},set:function(e){var t=a(this);i(e)&&r(t)&&o(t,e)}})}catch(e){}})),fse=$((()=>{"use strict";var e=ct(),t=zn(),r=sp().onFreeze,i=tg(),n=ar(),a=Object.seal;e({target:"Object",stat:!0,forced:n((function(){a(1)})),sham:!i},{seal:function(e){return a&&t(e)?a(r(e)):e}})})),pse=$((()=>{"use strict";ct()({target:"Object",stat:!0},{setPrototypeOf:eu()})})),gse=$(((e,t)=>{"use strict";var r=GM(),i=Qc();t.exports=r?{}.toString:function(){return"[object "+i(this)+"]"}})),vse=$((()=>{"use strict";var e=GM(),t=os(),r=gse();e||t(Object.prototype,"toString",r,{unsafe:!0})})),yse=$((()=>{"use strict";var e=ct(),t=JB().values;e({target:"Object",stat:!0},{values:function(e){return t(e)}})})),xse=$((()=>{"use strict";var e=ct(),t=GB();e({global:!0,forced:parseFloat!==t},{parseFloat:t})})),_se=$((()=>{"use strict";var e=ct(),t=qB();e({global:!0,forced:parseInt!==t},{parseInt:t})})),Ql=$(((e,t)=>{"use strict";var r=TypeError;t.exports=function(e,t){if(e<t)throw new r("Not enough arguments");return e}})),sN=$(((e,t)=>{"use strict";var r=eh();t.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)})),aE=$(((e,t)=>{"use strict";var r,i,n,a,s=Ir(),o=vl(),l=Kl(),h=ri(),c=fi(),u=ar(),d=zk(),p=gl(),f=Ex(),m=Ql(),g=sN(),v=wd(),y=s.setImmediate,b=s.clearImmediate,x=s.process,_=s.Dispatch,w=s.Function,S=s.MessageChannel,T=s.String,M=0,E={},A="onreadystatechange";u((function(){r=s.location}));var C=function(e){if(c(E,e)){var t=E[e];delete E[e],t()}},P=function(e){return function(){C(e)}},R=function(e){C(e.data)},I=function(e){s.postMessage(T(e),r.protocol+"//"+r.host)};(!y||!b)&&(y=function(e){m(arguments.length,1);var t=h(e)?e:w(e),r=p(arguments,1);return E[++M]=function(){o(t,void 0,r)},i(M),M},b=function(e){delete E[e]},v?i=function(e){x.nextTick(P(e))}:_&&_.now?i=function(e){_.now(P(e))}:S&&!g?(a=(n=new S).port2,n.port1.onmessage=R,i=l(a.postMessage,a)):s.addEventListener&&h(s.postMessage)&&!s.importScripts&&r&&"file:"!==r.protocol&&!u(I)?(i=I,s.addEventListener("message",R,!1)):i=A in f("script")?function(e){d.appendChild(f("script"))[A]=function(){d.removeChild(this),C(e)}}:function(e){setTimeout(P(e),0)}),t.exports={set:y,clear:b}})),pN=$(((e,t)=>{"use strict";var r=Ir(),i=un(),n=Object.getOwnPropertyDescriptor;t.exports=function(e){if(!i)return r[e];var t=n(r,e);return t&&t.value}})),mN=$(((e,t)=>{"use strict";var r=function(){this.head=null,this.tail=null};r.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}},t.exports=r})),Use=$(((e,t)=>{"use strict";var r=eh();t.exports=/ipad|iphone|ipod/i.test(r)&&"undefined"!=typeof Pebble})),Vse=$(((e,t)=>{"use strict";var r=eh();t.exports=/web0s(?!.*chrome)/i.test(r)})),EN=$(((e,t)=>{"use strict";var r,i,n,a,s,o,l,h=Ir(),c=pN(),u=Kl(),d=aE().set,p=mN(),f=sN(),m=Use(),g=Vse(),v=wd(),y=h.MutationObserver||h.WebKitMutationObserver,b=h.document,x=h.process,_=h.Promise,w=c("queueMicrotask");w||(o=new p,l=function(){var e,t;for(v&&(e=x.domain)&&e.exit();t=o.get();)try{t()}catch(e){throw o.head&&r(),e}e&&e.enter()},f||v||g||!y||!b?!m&&_&&_.resolve?((a=_.resolve(void 0)).constructor=_,s=u(a.then,a),r=function(){s(l)}):v?r=function(){x.nextTick(l)}:(d=u(d,h),r=function(){d(l)}):(i=!0,n=b.createTextNode(""),new y(l).observe(n,{characterData:!0}),r=function(){n.data=i=!i}),w=function(e){o.head||r(),o.add(e)}),t.exports=w})),$se=$(((e,t)=>{"use strict";t.exports=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(e){}}})),Ov=$(((e,t)=>{"use strict";t.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}})),ig=$(((e,t)=>{"use strict";var r=Ir();t.exports=r.Promise})),XA=$(((e,t)=>{"use strict";t.exports="object"==typeof Deno&&Deno&&"object"==typeof Deno.version})),_N=$(((e,t)=>{"use strict";var r=XA(),i=wd();t.exports=!r&&!i&&"object"==typeof window&&"object"==typeof document})),Dv=$(((e,t)=>{"use strict";var r=Ir(),i=ig(),n=ri(),a=lv(),s=kM(),o=$n(),l=_N(),h=XA(),c=_s(),u=th(),d=i&&i.prototype,p=o("species"),f=!1,m=n(r.PromiseRejectionEvent),g=a("Promise",(function(){var e=s(i),t=e!==String(i);if(!t&&66===u||c&&(!d.catch||!d.finally))return!0;if(!u||u<51||!/native code/.test(e)){var r=new i((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};if((r.constructor={})[p]=n,!(f=r.then((function(){}))instanceof n))return!0}return!t&&(l||h)&&!m}));t.exports={CONSTRUCTOR:g,REJECTION_EVENT:m,SUBCLASSING:f}})),Pd=$(((e,t)=>{"use strict";var r=ps(),i=TypeError,n=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw new i("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)};t.exports.f=function(e){return new n(e)}})),Tae=$((()=>{"use strict";var e,t,r,i=ct(),n=_s(),a=wd(),s=Ir(),o=Ln(),l=os(),h=eu(),c=mo(),u=Km(),d=ps(),p=ri(),f=zn(),m=tu(),g=Qm(),v=aE().set,y=EN(),b=$se(),x=Ov(),_=mN(),w=Ws(),S=ig(),T=Dv(),M=Pd(),E="Promise",A=T.CONSTRUCTOR,C=T.REJECTION_EVENT,P=T.SUBCLASSING,R=w.getterFor(E),I=w.set,O=S&&S.prototype,L=S,D=O,k=s.TypeError,F=s.document,N=s.process,U=M.f,B=U,z=!!(F&&F.createEvent&&s.dispatchEvent),H="unhandledrejection",V=function(e){var t;return!(!f(e)||!p(t=e.then))&&t},j=function(e,t){var r,i,n,a=t.value,s=1===t.state,l=s?e.ok:e.fail,h=e.resolve,c=e.reject,u=e.domain;try{l?(s||(2===t.rejection&&Y(t),t.rejection=1),!0===l?r=a:(u&&u.enter(),r=l(a),u&&(u.exit(),n=!0)),r===e.promise?c(new k("Promise-chain cycle")):(i=V(r))?o(i,r,h,c):h(r)):c(a)}catch(e){u&&!n&&u.exit(),c(e)}},G=function(e,t){e.notified||(e.notified=!0,y((function(){for(var r,i=e.reactions;r=i.get();)j(r,e);e.notified=!1,t&&!e.rejection&&X(e)})))},W=function(e,t,r){var i,n;z?((i=F.createEvent("Event")).promise=t,i.reason=r,i.initEvent(e,!1,!0),s.dispatchEvent(i)):i={promise:t,reason:r},!C&&(n=s["on"+e])?n(i):e===H&&b("Unhandled promise rejection",r)},X=function(e){o(v,s,(function(){var t,r=e.facade,i=e.value;if(q(e)&&(t=x((function(){a?N.emit("unhandledRejection",i,r):W(H,r,i)})),e.rejection=a||q(e)?2:1,t.error))throw t.value}))},q=function(e){return 1!==e.rejection&&!e.parent},Y=function(e){o(v,s,(function(){var t=e.facade;a?N.emit("rejectionHandled",t):W("rejectionhandled",t,e.value)}))},$=function(e,t,r){return function(i){e(t,i,r)}},Z=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,G(e,!0))},K=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw new k("Promise can't be resolved itself");var i=V(t);i?y((function(){var r={done:!1};try{o(i,t,$(K,r,e),$(Z,r,e))}catch(t){Z(r,t,e)}})):(e.value=t,e.state=1,G(e,!1))}catch(t){Z({done:!1},t,e)}}};if(A&&(D=(L=function(t){m(this,D),d(t),o(e,this);var r=R(this);try{t($(K,r),$(Z,r))}catch(e){Z(r,e)}}).prototype,(e=function(e){I(this,{type:E,done:!1,notified:!1,parent:!1,reactions:new _,rejection:!1,state:0,value:void 0})}).prototype=l(D,"then",(function(e,t){var r=R(this),i=U(g(this,L));return r.parent=!0,i.ok=!p(e)||e,i.fail=p(t)&&t,i.domain=a?N.domain:void 0,0===r.state?r.reactions.add(i):y((function(){j(i,r)})),i.promise})),t=function(){var t=new e,r=R(t);this.promise=t,this.resolve=$(K,r),this.reject=$(Z,r)},M.f=U=function(e){return e===L||undefined===e?new t(e):B(e)},!n&&p(S)&&O!==Object.prototype)){r=O.then,P||l(O,"then",(function(e,t){var i=this;return new L((function(e,t){o(r,i,e,t)})).then(e,t)}),{unsafe:!0});try{delete O.constructor}catch(e){}h&&h(O,D)}i({global:!0,constructor:!0,wrap:!0,forced:A},{Promise:L}),c(L,E,!1,!0),u(E)})),uE=$(((e,t)=>{"use strict";var r=ig(),i=Fx(),n=Dv().CONSTRUCTOR;t.exports=n||!i((function(e){r.all(e).then(void 0,(function(){}))}))})),Sae=$((()=>{"use strict";var e=ct(),t=Ln(),r=ps(),i=Pd(),n=Ov(),a=bl();e({target:"Promise",stat:!0,forced:uE()},{all:function(e){var s=this,o=i.f(s),l=o.resolve,h=o.reject,c=n((function(){var i=r(s.resolve),n=[],o=0,c=1;a(e,(function(e){var r=o++,a=!1;c++,t(i,s,e).then((function(e){a||(a=!0,n[r]=e,--c||l(n))}),h)})),--c||l(n)}));return c.error&&h(c.value),o.promise}})})),Aae=$((()=>{"use strict";var e,t=ct(),r=_s(),i=Dv().CONSTRUCTOR,n=ig(),a=Qi(),s=ri(),o=os(),l=n&&n.prototype;t({target:"Promise",proto:!0,forced:i,real:!0},{catch:function(e){return this.then(void 0,e)}}),!r&&s(n)&&(e=a("Promise").prototype.catch,l.catch!==e&&o(l,"catch",e,{unsafe:!0}))})),Rae=$((()=>{"use strict";var e=ct(),t=Ln(),r=ps(),i=Pd(),n=Ov(),a=bl();e({target:"Promise",stat:!0,forced:uE()},{race:function(e){var s=this,o=i.f(s),l=o.reject,h=n((function(){var i=r(s.resolve);a(e,(function(e){t(i,s,e).then(o.resolve,l)}))}));return h.error&&l(h.value),o.promise}})})),Cae=$((()=>{"use strict";var e=ct(),t=Pd();e({target:"Promise",stat:!0,forced:Dv().CONSTRUCTOR},{reject:function(e){var r=t.f(this);return(0,r.reject)(e),r.promise}})})),kN=$(((e,t)=>{"use strict";var r=kn(),i=zn(),n=Pd();t.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var a=n.f(e);return(0,a.resolve)(t),a.promise}})),Dae=$((()=>{"use strict";var e=ct(),t=Qi(),r=_s(),i=ig(),n=Dv().CONSTRUCTOR,a=kN(),s=t("Promise"),o=r&&!n;e({target:"Promise",stat:!0,forced:r||n},{resolve:function(e){return a(o&&this===s?i:this,e)}})})),Lae=$((()=>{"use strict";Tae(),Sae(),Aae(),Rae(),Cae(),Dae()})),kae=$((()=>{"use strict";var e=ct(),t=Ln(),r=ps(),i=Pd(),n=Ov(),a=bl();e({target:"Promise",stat:!0,forced:uE()},{allSettled:function(e){var s=this,o=i.f(s),l=o.resolve,h=o.reject,c=n((function(){var i=r(s.resolve),n=[],o=0,h=1;a(e,(function(e){var r=o++,a=!1;h++,t(i,s,e).then((function(e){a||(a=!0,n[r]={status:"fulfilled",value:e},--h||l(n))}),(function(e){a||(a=!0,n[r]={status:"rejected",reason:e},--h||l(n))}))})),--h||l(n)}));return c.error&&h(c.value),o.promise}})})),Bae=$((()=>{"use strict";var e=ct(),t=Ln(),r=ps(),i=Qi(),n=Pd(),a=Ov(),s=bl(),o=uE(),l="No one promise resolved";e({target:"Promise",stat:!0,forced:o},{any:function(e){var o=this,h=i("AggregateError"),c=n.f(o),u=c.resolve,d=c.reject,p=a((function(){var i=r(o.resolve),n=[],a=0,c=1,p=!1;s(e,(function(e){var r=a++,s=!1;c++,t(i,o,e).then((function(e){s||p||(p=!0,u(e))}),(function(e){s||p||(s=!0,n[r]=e,--c||d(new h(n,l)))}))})),--c||d(new h(n,l))}));return p.error&&d(p.value),c.promise}})})),Vae=$((()=>{"use strict";var e,t=ct(),r=_s(),i=ig(),n=ar(),a=Qi(),s=ri(),o=Qm(),l=kN(),h=os(),c=i&&i.prototype;t({target:"Promise",proto:!0,real:!0,forced:!!i&&n((function(){c.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=o(this,a("Promise")),r=s(e);return this.then(r?function(r){return l(t,e()).then((function(){return r}))}:e,r?function(r){return l(t,e()).then((function(){throw r}))}:e)}}),!r&&s(i)&&(e=a("Promise").prototype.finally,c.finally!==e&&h(c,"finally",e,{unsafe:!0}))})),zae=$((()=>{"use strict";var e=ct(),t=Pd();e({target:"Promise",stat:!0},{withResolvers:function(){var e=t.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}})})),Gae=$((()=>{"use strict";var e=ct(),t=vl(),r=ps(),i=kn();e({target:"Reflect",stat:!0,forced:!ar()((function(){Reflect.apply((function(){}))}))},{apply:function(e,n,a){return t(r(e),n,i(a))}})})),Zae=$((()=>{"use strict";var e=ct(),t=Qi(),r=vl(),i=_B(),n=OA(),a=kn(),s=zn(),o=No(),l=ar(),h=t("Reflect","construct"),c=Object.prototype,u=[].push,d=l((function(){function e(){}return!(h((function(){}),[],e)instanceof e)})),p=!l((function(){h((function(){}))})),f=d||p;e({target:"Reflect",stat:!0,forced:f,sham:f},{construct:function(e,t){n(e),a(t);var l=arguments.length<3?e:n(arguments[2]);if(p&&!d)return h(e,t,l);if(e===l){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var f=[null];return r(u,f,t),new(r(i,e,f))}var m=l.prototype,g=o(s(m)?m:c),v=r(e,g,t);return s(v)?v:g}})})),Qae=$((()=>{"use strict";var e=ct(),t=un(),r=kn(),i=nh(),n=ms();e({target:"Reflect",stat:!0,forced:ar()((function(){Reflect.defineProperty(n.f({},1,{value:1}),1,{value:2})})),sham:!t},{defineProperty:function(e,t,a){r(e);var s=i(t);r(a);try{return n.f(e,s,a),!0}catch(e){return!1}}})})),eoe=$((()=>{"use strict";var e=ct(),t=kn(),r=ja().f;e({target:"Reflect",stat:!0},{deleteProperty:function(e,i){var n=r(t(e),i);return!(n&&!n.configurable)&&delete e[i]}})})),HN=$(((e,t)=>{"use strict";var r=fi();t.exports=function(e){return void 0!==e&&(r(e,"value")||r(e,"writable"))}})),ioe=$((()=>{"use strict";var e=ct(),t=Ln(),r=zn(),i=kn(),n=HN(),a=ja(),s=yl();e({target:"Reflect",stat:!0},{get:function e(o,l){var h,c,u=arguments.length<3?o:arguments[2];return i(o)===u?o[l]:(h=a.f(o,l))?n(h)?h.value:void 0===h.get?void 0:t(h.get,u):r(c=s(o))?e(c,l,u):void 0}})})),soe=$((()=>{"use strict";var e=ct(),t=un(),r=kn(),i=ja();e({target:"Reflect",stat:!0,sham:!t},{getOwnPropertyDescriptor:function(e,t){return i.f(r(e),t)}})})),aoe=$((()=>{"use strict";var e=ct(),t=kn(),r=yl();e({target:"Reflect",stat:!0,sham:!aA()},{getPrototypeOf:function(e){return r(t(e))}})})),ooe=$((()=>{"use strict";ct()({target:"Reflect",stat:!0},{has:function(e,t){return t in e}})})),loe=$((()=>{"use strict";var e=ct(),t=kn(),r=FA();e({target:"Reflect",stat:!0},{isExtensible:function(e){return t(e),r(e)}})})),coe=$((()=>{"use strict";ct()({target:"Reflect",stat:!0},{ownKeys:zM()})})),uoe=$((()=>{"use strict";var e=ct(),t=Qi(),r=kn();e({target:"Reflect",stat:!0,sham:!tg()},{preventExtensions:function(e){r(e);try{var i=t("Object","preventExtensions");return i&&i(e),!0}catch(e){return!1}}})})),moe=$((()=>{"use strict";var e=ct(),t=Ln(),r=kn(),i=zn(),n=HN(),a=ar(),s=ms(),o=ja(),l=yl(),h=ml();e({target:"Reflect",stat:!0,forced:a((function(){var e=function(){},t=s.f(new e,"a",{configurable:!0});return!1!==Reflect.set(e.prototype,"a",1,t)}))},{set:function e(a,c,u){var d,p,f,m=arguments.length<4?a:arguments[3],g=o.f(r(a),c);if(!g){if(i(p=l(a)))return e(p,c,u,m);g=h(0)}if(n(g)){if(!1===g.writable||!i(m))return!1;if(d=o.f(m,c)){if(d.get||d.set||!1===d.writable)return!1;d.value=u,s.f(m,c,d)}else s.f(m,c,h(0,u))}else{if(void 0===(f=g.set))return!1;t(f,m,u)}return!0}})})),voe=$((()=>{"use strict";var e=ct(),t=kn(),r=dF(),i=eu();i&&e({target:"Reflect",stat:!0},{setPrototypeOf:function(e,n){t(e),r(n);try{return i(e,n),!0}catch(e){return!1}}})})),yoe=$((()=>{"use strict";var e=ct(),t=Ir(),r=mo();e({global:!0},{Reflect:{}}),r(t.Reflect,"Reflect",!0)})),Nv=$(((e,t)=>{"use strict";var r=zn(),i=qa(),n=$n()("match");t.exports=function(e){var t;return r(e)&&(void 0!==(t=e[n])?!!t:"RegExp"===i(e))}})),tR=$(((e,t)=>{"use strict";var r=kn();t.exports=function(){var e=r(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}})),Uv=$(((e,t)=>{"use strict";var r=Ln(),i=fi(),n=Fo(),a=tR(),s=RegExp.prototype;t.exports=function(e){var t=e.flags;return void 0!==t||"flags"in s||i(e,"flags")||!n(s,e)?t:r(a,e)}})),hE=$(((e,t)=>{"use strict";var r=ar(),i=Ir().RegExp,n=r((function(){var e=i("a","y");return e.lastIndex=2,null!==e.exec("abcd")})),a=n||r((function(){return!i("a","y").sticky})),s=n||r((function(){var e=i("^r","gy");return e.lastIndex=2,null!==e.exec("str")}));t.exports={BROKEN_CARET:s,MISSED_STICKY:a,UNSUPPORTED_Y:n}})),rR=$(((e,t)=>{"use strict";var r=ar(),i=Ir().RegExp;t.exports=r((function(){var e=i(".","s");return!(e.dotAll&&e.test("\n")&&"s"===e.flags)}))})),jN=$(((e,t)=>{"use strict";var r=ar(),i=Ir().RegExp;t.exports=r((function(){var e=i("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}))})),Loe=$((()=>{"use strict";var e,t,r,i=un(),n=Ir(),a=cr(),s=lv(),o=Jf(),l=Wa(),h=No(),c=$f().f,u=Fo(),d=Nv(),p=Rn(),f=Uv(),m=hE(),g=fF(),v=os(),y=ar(),b=fi(),x=Ws().enforce,_=Km(),w=$n(),S=rR(),T=jN(),M=w("match"),E=n.RegExp,A=E.prototype,C=n.SyntaxError,P=a(A.exec),R=a("".charAt),I=a("".replace),O=a("".indexOf),L=a("".slice),D=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,k=/a/g,F=/a/g,N=new E(k)!==k,U=m.MISSED_STICKY,B=m.UNSUPPORTED_Y,z=i&&(!N||U||S||T||y((function(){return F[M]=!1,E(k)!==k||E(F)===F||"/a/i"!==String(E(k,"i"))})));if(s("RegExp",z)){for(e=function(t,r){var i,n,a,s,c,m,g=u(A,this),v=d(t),y=void 0===r,_=[],w=t;if(!g&&v&&y&&t.constructor===e)return t;if((v||u(A,t))&&(t=t.source,y&&(r=f(w))),t=void 0===t?"":p(t),r=void 0===r?"":p(r),w=t,S&&"dotAll"in k&&((n=!!r&&O(r,"s")>-1)&&(r=I(r,/s/g,""))),i=r,U&&"sticky"in k&&((a=!!r&&O(r,"y")>-1)&&B&&(r=I(r,/y/g,""))),T&&(s=function(e){for(var t,r=e.length,i=0,n="",a=[],s=h(null),o=!1,l=!1,c=0,u="";i<=r;i++){if("\\"===(t=R(e,i)))t+=R(e,++i);else if("]"===t)o=!1;else if(!o)switch(!0){case"["===t:o=!0;break;case"("===t:P(D,L(e,i+1))&&(i+=2,l=!0),n+=t,c++;continue;case">"===t&&l:if(""===u||b(s,u))throw new C("Invalid capture group name");s[u]=!0,a[a.length]=[u,c],l=!1,u="";continue}l?u+=t:n+=t}return[n,a]}(t),t=s[0],_=s[1]),c=o(E(t,r),g?this:A,e),(n||a||_.length)&&(m=x(c),n&&(m.dotAll=!0,m.raw=e(function(e){for(var t,r=e.length,i=0,n="",a=!1;i<=r;i++)"\\"!==(t=R(e,i))?a||"."!==t?("["===t?a=!0:"]"===t&&(a=!1),n+=t):n+="[\\s\\S]":n+=t+R(e,++i);return n}(t),i)),a&&(m.sticky=!0),_.length&&(m.groups=_)),t!==w)try{l(c,"source",""===w?"(?:)":w)}catch(e){}return c},t=c(E),r=0;t.length>r;)g(e,E,t[r++]);A.constructor=e,e.prototype=A,v(n,"RegExp",e,{constructor:!0})}_("RegExp")})),Foe=$((()=>{"use strict";var e=un(),t=rR(),r=qa(),i=fa(),n=Ws().get,a=RegExp.prototype,s=TypeError;e&&t&&i(a,"dotAll",{configurable:!0,get:function(){if(this!==a){if("RegExp"===r(this))return!!n(this).dotAll;throw new s("Incompatible receiver, RegExp required")}}})})),fE=$(((e,t)=>{"use strict";var r,i,n=Ln(),a=cr(),s=Rn(),o=tR(),l=hE(),h=Vm(),c=No(),u=Ws().get,d=rR(),p=jN(),f=h("native-string-replace",String.prototype.replace),m=RegExp.prototype.exec,g=m,v=a("".charAt),y=a("".indexOf),b=a("".replace),x=a("".slice),_=(i=/b*/g,n(m,r=/a/,"a"),n(m,i,"a"),0!==r.lastIndex||0!==i.lastIndex),w=l.BROKEN_CARET,S=void 0!==/()??/.exec("")[1];(_||S||w||d||p)&&(g=function(e){var t,r,i,a,l,h,d,p=this,T=u(p),M=s(e),E=T.raw;if(E)return E.lastIndex=p.lastIndex,t=n(g,E,M),p.lastIndex=E.lastIndex,t;var A=T.groups,C=w&&p.sticky,P=n(o,p),R=p.source,I=0,O=M;if(C&&(P=b(P,"y",""),-1===y(P,"g")&&(P+="g"),O=x(M,p.lastIndex),p.lastIndex>0&&(!p.multiline||p.multiline&&"\n"!==v(M,p.lastIndex-1))&&(R="(?: "+R+")",O=" "+O,I++),r=new RegExp("^(?:"+R+")",P)),S&&(r=new RegExp("^"+R+"$(?!\\s)",P)),_&&(i=p.lastIndex),a=n(m,C?r:p,O),C?a?(a.input=x(a.input,I),a[0]=x(a[0],I),a.index=p.lastIndex,p.lastIndex+=a[0].length):p.lastIndex=0:_&&a&&(p.lastIndex=p.global?a.index+a[0].length:i),S&&a&&a.length>1&&n(f,a[0],r,(function(){for(l=1;l<arguments.length-2;l++)void 0===arguments[l]&&(a[l]=void 0)})),a&&A)for(a.groups=h=c(null),l=0;l<A.length;l++)h[(d=A[l])[0]]=a[d[1]];return a}),t.exports=g})),aR=$((()=>{"use strict";var e=ct(),t=fE();e({target:"RegExp",proto:!0,forced:/./.exec!==t},{exec:t})})),zoe=$((()=>{"use strict";var e=Ir(),t=un(),r=fa(),i=tR(),n=ar(),a=e.RegExp,s=a.prototype;t&&n((function(){var e=!0;try{a(".","d")}catch(t){e=!1}var t={},r="",i=e?"dgimsy":"gimsy",n=function(e,i){Object.defineProperty(t,e,{get:function(){return r+=i,!0}})},o={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var l in e&&(o.hasIndices="d"),o)n(l,o[l]);return Object.getOwnPropertyDescriptor(s,"flags").get.call(t)!==i||r!==i}))&&r(s,"flags",{configurable:!0,get:i})})),qoe=$((()=>{"use strict";var e=un(),t=hE().MISSED_STICKY,r=qa(),i=fa(),n=Ws().get,a=RegExp.prototype,s=TypeError;e&&t&&i(a,"sticky",{configurable:!0,get:function(){if(this!==a){if("RegExp"===r(this))return!!n(this).sticky;throw new s("Incompatible receiver, RegExp required")}}})})),Xoe=$((()=>{"use strict";aR();var e,t,r=ct(),i=Ln(),n=ri(),a=kn(),s=Rn(),o=(e=!1,(t=/[ac]/).exec=function(){return e=!0,/./.exec.apply(this,arguments)},!0===t.test("abc")&&e),l=/./.test;r({target:"RegExp",proto:!0,forced:!o},{test:function(e){var t=a(this),r=s(e),o=t.exec;if(!n(o))return i(l,t,r);var h=i(o,t,r);return null!==h&&(a(h),!0)}})})),Koe=$((()=>{"use strict";var e=Gm().PROPER,t=os(),r=kn(),i=Rn(),n=ar(),a=Uv(),s="toString",o=RegExp.prototype,l=o[s],h=n((function(){return"/a/b"!==l.call({source:"a",flags:"b"})})),c=e&&l.name!==s;(h||c)&&t(o,s,(function(){var e=r(this);return"/"+i(e.source)+"/"+i(a(e))}),{unsafe:!0})})),Joe=$((()=>{"use strict";Xx()("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),IB())})),Qoe=$((()=>{"use strict";Joe()})),ele=$((()=>{"use strict";var e=ct(),t=cr(),r=fs(),i=Ps(),n=Rn(),a=ar(),s=t("".charAt);e({target:"String",proto:!0,forced:a((function(){return"\ud842"!=="𠮷".at(-2)}))},{at:function(e){var t=n(r(this)),a=t.length,o=i(e),l=o>=0?o:a+o;return l<0||l>=a?void 0:s(t,l)}})})),pE=$(((e,t)=>{"use strict";var r=cr(),i=Ps(),n=Rn(),a=fs(),s=r("".charAt),o=r("".charCodeAt),l=r("".slice),h=function(e){return function(t,r){var h,c,u=n(a(t)),d=i(r),p=u.length;return d<0||d>=p?e?"":void 0:(h=o(u,d))<55296||h>56319||d+1===p||(c=o(u,d+1))<56320||c>57343?e?s(u,d):h:e?l(u,d,d+2):c-56320+(h-55296<<10)+65536}};t.exports={codeAt:h(!1),charAt:h(!0)}})),ile=$((()=>{"use strict";var e=ct(),t=pE().codeAt;e({target:"String",proto:!0},{codePointAt:function(e){return t(this,e)}})})),oR=$(((e,t)=>{"use strict";var r=Nv(),i=TypeError;t.exports=function(e){if(r(e))throw new i("The method doesn't accept regular expressions");return e}})),lR=$(((e,t)=>{"use strict";var r=$n()("match");t.exports=function(e){var t=/./;try{"/./"[e](t)}catch(i){try{return t[r]=!1,"/./"[e](t)}catch(e){}}return!1}})),cle=$((()=>{"use strict";var e,t=ct(),r=yd(),i=ja().f,n=Bo(),a=Rn(),s=oR(),o=fs(),l=lR(),h=_s(),c=r("".slice),u=Math.min,d=l("endsWith");t({target:"String",proto:!0,forced:!!(h||d||(e=i(String.prototype,"endsWith"),!e||e.writable))&&!d},{endsWith:function(e){var t=a(o(this));s(e);var r=arguments.length>1?arguments[1]:void 0,i=t.length,l=void 0===r?i:u(n(r),i),h=a(e);return c(t,l-h.length,l)===h}})})),dle=$((()=>{"use strict";var e=ct(),t=cr(),r=ih(),i=RangeError,n=String.fromCharCode,a=String.fromCodePoint,s=t([].join);e({target:"String",stat:!0,arity:1,forced:!!a&&1!==a.length},{fromCodePoint:function(e){for(var t,a=[],o=arguments.length,l=0;o>l;){if(t=+arguments[l++],r(t,1114111)!==t)throw new i(t+" is not a valid code point");a[l]=t<65536?n(t):n(55296+((t-=65536)>>10),t%1024+56320)}return s(a,"")}})})),ple=$((()=>{"use strict";var e=ct(),t=cr(),r=oR(),i=fs(),n=Rn(),a=lR(),s=t("".indexOf);e({target:"String",proto:!0,forced:!a("includes")},{includes:function(e){return!!~s(n(i(this)),n(r(e)),arguments.length>1?arguments[1]:void 0)}})})),gle=$((()=>{"use strict";var e=ct(),t=cr(),r=fs(),i=Rn(),n=t("".charCodeAt);e({target:"String",proto:!0},{isWellFormed:function(){for(var e=i(r(this)),t=e.length,a=0;a<t;a++){var s=n(e,a);if(55296==(63488&s)&&(s>=56320||++a>=t||56320!=(64512&n(e,a))))return!1}return!0}})})),rU=$((()=>{"use strict";var e=pE().charAt,t=Rn(),r=Ws(),i=mA(),n=bv(),a="String Iterator",s=r.set,o=r.getterFor(a);i(String,"String",(function(e){s(this,{type:a,string:t(e),index:0})}),(function(){var t,r=o(this),i=r.string,a=r.index;return a>=i.length?n(void 0,!0):(t=e(i,a),r.index+=t.length,n(t,!1))}))})),mE=$(((e,t)=>{"use strict";aR();var r=yd(),i=os(),n=fE(),a=ar(),s=$n(),o=Wa(),l=s("species"),h=RegExp.prototype;t.exports=function(e,t,c,u){var d=s(e),p=!a((function(){var t={};return t[d]=function(){return 7},7!==""[e](t)})),f=p&&!a((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[l]=function(){return r},r.flags="",r[d]=/./[d]),r.exec=function(){return t=!0,null},r[d](""),!t}));if(!p||!f||c){var m=r(/./[d]),g=t(d,""[e],(function(e,t,i,a,s){var o=r(e),l=t.exec;return l===n||l===h.exec?p&&!s?{done:!0,value:m(t,i,a)}:{done:!0,value:o(i,t,a)}:{done:!1}}));i(String.prototype,e,g[0]),i(h,d,g[1])}u&&o(h[d],"sham",!0)}})),gE=$(((e,t)=>{"use strict";var r=pE().charAt;t.exports=function(e,t,i){return t+(i?r(e,t).length:1)}})),zv=$(((e,t)=>{"use strict";var r=Ln(),i=kn(),n=ri(),a=qa(),s=fE(),o=TypeError;t.exports=function(e,t){var l=e.exec;if(n(l)){var h=r(l,e,t);return null!==h&&i(h),h}if("RegExp"===a(e))return r(s,e,t);throw new o("RegExp#exec called on incompatible receiver")}})),Cle=$((()=>{"use strict";var e=Ln(),t=mE(),r=kn(),i=fo(),n=Bo(),a=Rn(),s=fs(),o=rh(),l=gE(),h=zv();t("match",(function(t,c,u){return[function(r){var n=s(this),l=i(r)?void 0:o(r,t);return l?e(l,r,n):new RegExp(r)[t](a(n))},function(e){var t=r(this),i=a(e),s=u(c,t,i);if(s.done)return s.value;if(!t.global)return h(t,i);var o=t.unicode;t.lastIndex=0;for(var d,p=[],f=0;null!==(d=h(t,i));){var m=a(d[0]);p[f]=m,""===m&&(t.lastIndex=l(i,n(t.lastIndex),o)),f++}return 0===f?null:p}]}))})),Ule=$((()=>{"use strict";var e=ct(),t=Ln(),r=yd(),i=dA(),n=bv(),a=fs(),s=Bo(),o=Rn(),l=kn(),h=fo(),c=qa(),u=Nv(),d=Uv(),p=rh(),f=os(),m=ar(),g=$n(),v=Qm(),y=gE(),b=zv(),x=Ws(),_=_s(),w=g("matchAll"),S="RegExp String",T=S+" Iterator",M=x.set,E=x.getterFor(T),A=RegExp.prototype,C=TypeError,P=r("".indexOf),R=r("".matchAll),I=!!R&&!m((function(){R("a",/./)})),O=i((function(e,t,r,i){M(this,{type:T,regexp:e,string:t,global:r,unicode:i,done:!1})}),S,(function(){var e=E(this);if(e.done)return n(void 0,!0);var t=e.regexp,r=e.string,i=b(t,r);return null===i?(e.done=!0,n(void 0,!0)):e.global?(""===o(i[0])&&(t.lastIndex=y(r,s(t.lastIndex),e.unicode)),n(i,!1)):(e.done=!0,n(i,!1))})),L=function(e){var t,r,i,n=l(this),a=o(e),h=v(n,RegExp),c=o(d(n));return t=new h(h===RegExp?n.source:n,c),r=!!~P(c,"g"),i=!!~P(c,"u"),t.lastIndex=s(n.lastIndex),new O(t,a,r,i)};e({target:"String",proto:!0,forced:I},{matchAll:function(e){var r,i,n,s,l=a(this);if(h(e)){if(I)return R(l,e)}else{if(u(e)&&(r=o(a(d(e))),!~P(r,"g")))throw new C("`.matchAll` does not allow non-global regexes");if(I)return R(l,e);if(void 0===(n=p(e,w))&&_&&"RegExp"===c(e)&&(n=L),n)return t(n,e,l)}return i=o(l),s=new RegExp(e,"g"),_?t(L,s,i):s[w](i)}}),_||w in A||f(A,w,L)})),cU=$(((e,t)=>{"use strict";var r=eh();t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(r)})),Vle=$((()=>{"use strict";var e=ct(),t=DA().end;e({target:"String",proto:!0,forced:cU()},{padEnd:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),zle=$((()=>{"use strict";var e=ct(),t=DA().start;e({target:"String",proto:!0,forced:cU()},{padStart:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),Wle=$((()=>{"use strict";var e=ct(),t=cr(),r=na(),i=Mi(),n=Rn(),a=Ui(),s=t([].push),o=t([].join);e({target:"String",stat:!0},{raw:function(e){var t=r(i(e).raw),l=a(t);if(!l)return"";for(var h=arguments.length,c=[],u=0;;){if(s(c,n(t[u++])),u===l)return o(c,"");u<h&&s(c,n(arguments[u]))}}})})),Xle=$((()=>{"use strict";ct()({target:"String",proto:!0},{repeat:jx()})})),fU=$(((e,t)=>{"use strict";var r=cr(),i=Mi(),n=Math.floor,a=r("".charAt),s=r("".replace),o=r("".slice),l=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,h=/\$([$&'`]|\d{1,2})/g;t.exports=function(e,t,r,c,u,d){var p=r+e.length,f=c.length,m=h;return void 0!==u&&(u=i(u),m=l),s(d,m,(function(i,s){var l;switch(a(s,0)){case"$":return"$";case"&":return e;case"`":return o(t,0,r);case"'":return o(t,p);case"<":l=u[o(s,1,-1)];break;default:var h=+s;if(0===h)return i;if(h>f){var d=n(h/10);return 0===d?i:d<=f?void 0===c[d-1]?a(s,1):c[d-1]+a(s,1):i}l=c[h-1]}return void 0===l?"":l}))}})),Qle=$((()=>{"use strict";var e=vl(),t=Ln(),r=cr(),i=mE(),n=ar(),a=kn(),s=ri(),o=fo(),l=Ps(),h=Bo(),c=Rn(),u=fs(),d=gE(),p=rh(),f=fU(),m=zv(),g=$n()("replace"),v=Math.max,y=Math.min,b=r([].concat),x=r([].push),_=r("".indexOf),w=r("".slice),S=function(e){return void 0===e?e:String(e)},T="$0"==="a".replace(/./,"$0"),M=!!/./[g]&&""===/./[g]("a","$0");i("replace",(function(r,i,n){var T=M?"$":"$0";return[function(e,r){var n=u(this),a=o(e)?void 0:p(e,g);return a?t(a,e,n,r):t(i,c(n),e,r)},function(t,r){var o=a(this),u=c(t);if("string"==typeof r&&-1===_(r,T)&&-1===_(r,"$<")){var p=n(i,o,u,r);if(p.done)return p.value}var g=s(r);g||(r=c(r));var M,E=o.global;E&&(M=o.unicode,o.lastIndex=0);for(var A,C=[];null!==(A=m(o,u))&&(x(C,A),E);){""===c(A[0])&&(o.lastIndex=d(u,h(o.lastIndex),M))}for(var P="",R=0,I=0;I<C.length;I++){for(var O,L=c((A=C[I])[0]),D=v(y(l(A.index),u.length),0),k=[],F=1;F<A.length;F++)x(k,S(A[F]));var N=A.groups;if(g){var U=b([L],k,D,u);void 0!==N&&x(U,N),O=c(e(r,void 0,U))}else O=f(L,u,D,k,N,r);D>=R&&(P+=w(u,R,D)+O,R=D+L.length)}return P+w(u,R)}]}),!!n((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!T||M)})),ice=$((()=>{"use strict";var e=ct(),t=Ln(),r=cr(),i=fs(),n=ri(),a=fo(),s=Nv(),o=Rn(),l=rh(),h=Uv(),c=fU(),u=$n(),d=_s(),p=u("replace"),f=TypeError,m=r("".indexOf),g=r("".replace),v=r("".slice),y=Math.max,b=function(e,t,r){return r>e.length?-1:""===t?r:m(e,t,r)};e({target:"String",proto:!0},{replaceAll:function(e,r){var u,x,_,w,S,T,M,E,A,C=i(this),P=0,R=0,I="";if(!a(e)){if((u=s(e))&&(x=o(i(h(e))),!~m(x,"g")))throw new f("`.replaceAll` does not allow non-global regexes");if(_=l(e,p))return t(_,e,C,r);if(d&&u)return g(o(C),e,r)}for(w=o(C),S=o(e),(T=n(r))||(r=o(r)),M=S.length,E=y(1,M),P=b(w,S,0);-1!==P;)A=T?o(r(S,P,w)):c(S,w,P,[],void 0,r),I+=v(w,R,P)+A,R=P+M,P=b(w,S,P+E);return R<w.length&&(I+=v(w,R)),I}})})),oce=$((()=>{"use strict";var e=Ln(),t=mE(),r=kn(),i=fo(),n=fs(),a=eN(),s=Rn(),o=rh(),l=zv();t("search",(function(t,h,c){return[function(r){var a=n(this),l=i(r)?void 0:o(r,t);return l?e(l,r,a):new RegExp(r)[t](s(a))},function(e){var t=r(this),i=s(e),n=c(h,t,i);if(n.done)return n.value;var o=t.lastIndex;a(o,0)||(t.lastIndex=0);var u=l(t,i);return a(t.lastIndex,o)||(t.lastIndex=o),null===u?-1:u.index}]}))})),fce=$((()=>{"use strict";var e=vl(),t=Ln(),r=cr(),i=mE(),n=kn(),a=fo(),s=Nv(),o=fs(),l=Qm(),h=gE(),c=Bo(),u=Rn(),d=rh(),p=gl(),f=zv(),m=fE(),g=hE(),v=ar(),y=g.UNSUPPORTED_Y,b=4294967295,x=Math.min,_=[].push,w=r(/./.exec),S=r(_),T=r("".slice);i("split",(function(r,i,g){var v;return v="c"==="abbc".split(/(b)*/)[1]||4!=="test".split(/(?:)/,-1).length||2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(r,n){var a=u(o(this)),l=void 0===n?b:n>>>0;if(0===l)return[];if(void 0===r)return[a];if(!s(r))return t(i,a,r,l);for(var h,c,d,f=[],g=(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.unicode?"u":"")+(r.sticky?"y":""),v=0,y=new RegExp(r.source,g+"g");(h=t(m,y,a))&&!((c=y.lastIndex)>v&&(S(f,T(a,v,h.index)),h.length>1&&h.index<a.length&&e(_,f,p(h,1)),d=h[0].length,v=c,f.length>=l));)y.lastIndex===h.index&&y.lastIndex++;return v===a.length?(d||!w(y,""))&&S(f,""):S(f,T(a,v)),f.length>l?p(f,0,l):f}:"0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:t(i,this,e,r)}:i,[function(e,i){var n=o(this),s=a(e)?void 0:d(e,r);return s?t(s,e,n,i):t(v,u(n),e,i)},function(e,t){var r=n(this),a=u(e),s=g(v,r,a,t,v!==i);if(s.done)return s.value;var o=l(r,RegExp),d=r.unicode,p=(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.unicode?"u":"")+(y?"g":"y"),m=new o(y?"^(?:"+r.source+")":r,p),_=void 0===t?b:t>>>0;if(0===_)return[];if(0===a.length)return null===f(m,a)?[a]:[];for(var w=0,M=0,E=[];M<a.length;){m.lastIndex=y?0:M;var A,C=f(m,y?T(a,M):a);if(null===C||(A=x(c(m.lastIndex+(y?M:0)),a.length))===w)M=h(a,M,d);else{if(S(E,T(a,w,M)),E.length===_)return E;for(var P=1;P<=C.length-1;P++)if(S(E,C[P]),E.length===_)return E;M=w=A}}return S(E,T(a,w)),E}]}),!!v((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]})),y)})),gce=$((()=>{"use strict";var e,t=ct(),r=yd(),i=ja().f,n=Bo(),a=Rn(),s=oR(),o=fs(),l=lR(),h=_s(),c=r("".slice),u=Math.min,d=l("startsWith");t({target:"String",proto:!0,forced:!!(h||d||(e=i(String.prototype,"startsWith"),!e||e.writable))&&!d},{startsWith:function(e){var t=a(o(this));s(e);var r=n(u(arguments.length>1?arguments[1]:void 0,t.length)),i=a(e);return c(t,r,r+i.length)===i}})})),yce=$((()=>{"use strict";var e=ct(),t=cr(),r=fs(),i=Ps(),n=Rn(),a=t("".slice),s=Math.max,o=Math.min;e({target:"String",proto:!0,forced:!"".substr||"b"!=="ab".substr(-1)},{substr:function(e,t){var l,h,c=n(r(this)),u=c.length,d=i(e);return d===1/0&&(d=0),d<0&&(d=s(u+d,0)),(l=void 0===t?u:i(t))<=0||l===1/0?"":d>=(h=o(d+l,u))?"":a(c,d,h)}})})),_ce=$((()=>{"use strict";var e=ct(),t=Ln(),r=cr(),i=fs(),n=Rn(),a=ar(),s=Array,o=r("".charAt),l=r("".charCodeAt),h=r([].join),c="".toWellFormed,u=c&&a((function(){return"1"!==t(c,1)}));e({target:"String",proto:!0,forced:u},{toWellFormed:function(){var e=n(i(this));if(u)return t(c,e);for(var r=e.length,a=s(r),d=0;d<r;d++){var p=l(e,d);55296!=(63488&p)?a[d]=o(e,d):p>=56320||d+1>=r||56320!=(64512&l(e,d+1))?a[d]="�":(a[d]=o(e,d),a[++d]=o(e,d))}return h(a,"")}})})),fR=$(((e,t)=>{"use strict";var r=Gm().PROPER,i=ar(),n=Qx();t.exports=function(e){return i((function(){return!!n[e]()||"​᠎"!=="​᠎"[e]()||r&&n[e].name!==e}))}})),Mce=$((()=>{"use strict";var e=ct(),t=rg().trim;e({target:"String",proto:!0,forced:fR()("trim")},{trim:function(){return t(this)}})})),_U=$(((e,t)=>{"use strict";var r=rg().end,i=fR();t.exports=i("trimEnd")?function(){return r(this)}:"".trimEnd})),Cce=$((()=>{"use strict";var e=ct(),t=_U();e({target:"String",proto:!0,name:"trimEnd",forced:"".trimRight!==t},{trimRight:t})})),Ice=$((()=>{"use strict";Cce();var e=ct(),t=_U();e({target:"String",proto:!0,name:"trimEnd",forced:"".trimEnd!==t},{trimEnd:t})})),TU=$(((e,t)=>{"use strict";var r=rg().start,i=fR();t.exports=i("trimStart")?function(){return r(this)}:"".trimStart})),Lce=$((()=>{"use strict";var e=ct(),t=TU();e({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==t},{trimLeft:t})})),Fce=$((()=>{"use strict";Lce();var e=ct(),t=TU();e({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==t},{trimStart:t})})),Vo=$(((e,t)=>{"use strict";var r=cr(),i=fs(),n=Rn(),a=/"/g,s=r("".replace);t.exports=function(e,t,r,o){var l=n(i(e)),h="<"+t;return""!==r&&(h+=" "+r+'="'+s(n(o),a,"&quot;")+'"'),h+">"+l+"</"+t+">"}})),zo=$(((e,t)=>{"use strict";var r=ar();t.exports=function(e){return r((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))}})),Hce=$((()=>{"use strict";var e=ct(),t=Vo();e({target:"String",proto:!0,forced:zo()("anchor")},{anchor:function(e){return t(this,"a","name",e)}})})),Vce=$((()=>{"use strict";var e=ct(),t=Vo();e({target:"String",proto:!0,forced:zo()("big")},{big:function(){return t(this,"big","","")}})})),zce=$((()=>{"use strict";var e=ct(),t=Vo();e({target:"String",proto:!0,forced:zo()("blink")},{blink:function(){return t(this,"blink","","")}})})),Gce=$((()=>{"use strict";var e=ct(),t=Vo();e({target:"String",proto:!0,forced:zo()("bold")},{bold:function(){return t(this,"b","","")}})})),qce=$((()=>{"use strict";var e=ct(),t=Vo();e({target:"String",proto:!0,forced:zo()("fixed")},{fixed:function(){return t(this,"tt","","")}})})),jce=$((()=>{"use strict";var e=ct(),t=Vo();e({target:"String",proto:!0,forced:zo()("fontcolor")},{fontcolor:function(e){return t(this,"font","color",e)}})})),Wce=$((()=>{"use strict";var e=ct(),t=Vo();e({target:"String",proto:!0,forced:zo()("fontsize")},{fontsize:function(e){return t(this,"font","size",e)}})})),Xce=$((()=>{"use strict";var e=ct(),t=Vo();e({target:"String",proto:!0,forced:zo()("italics")},{italics:function(){return t(this,"i","","")}})})),Yce=$((()=>{"use strict";var e=ct(),t=Vo();e({target:"String",proto:!0,forced:zo()("link")},{link:function(e){return t(this,"a","href",e)}})})),$ce=$((()=>{"use strict";var e=ct(),t=Vo();e({target:"String",proto:!0,forced:zo()("small")},{small:function(){return t(this,"small","","")}})})),Zce=$((()=>{"use strict";var e=ct(),t=Vo();e({target:"String",proto:!0,forced:zo()("strike")},{strike:function(){return t(this,"strike","","")}})})),Kce=$((()=>{"use strict";var e=ct(),t=Vo();e({target:"String",proto:!0,forced:zo()("sub")},{sub:function(){return t(this,"sub","","")}})})),Jce=$((()=>{"use strict";var e=ct(),t=Vo();e({target:"String",proto:!0,forced:zo()("sup")},{sup:function(){return t(this,"sup","","")}})})),pR=$(((e,t)=>{"use strict";var r=Ir(),i=ar(),n=Fx(),a=Gn().NATIVE_ARRAY_BUFFER_VIEWS,s=r.ArrayBuffer,o=r.Int8Array;t.exports=!a||!i((function(){o(1)}))||!i((function(){new o(-1)}))||!n((function(e){new o,new o(null),new o(1.5),new o(e)}),!0)||i((function(){return 1!==new o(new s(2),1,void 0).length}))})),rue=$(((e,t)=>{"use strict";var r=Ps(),i=RangeError;t.exports=function(e){var t=r(e);if(t<0)throw new i("The argument can't be less than 0");return t}})),SU=$(((e,t)=>{"use strict";var r=rue(),i=RangeError;t.exports=function(e,t){var n=r(e);if(n%t)throw new i("Wrong offset");return n}})),sue=$(((e,t)=>{"use strict";var r=Math.round;t.exports=function(e){var t=r(e);return t<0?0:t>255?255:255&t}})),MU=$(((e,t)=>{"use strict";var r=Qc();t.exports=function(e){var t=r(e);return"BigInt64Array"===t||"BigUint64Array"===t}})),mR=$(((e,t)=>{"use strict";var r=xx(),i=TypeError;t.exports=function(e){var t=r(e,"number");if("number"==typeof t)throw new i("Can't convert number to bigint");return BigInt(t)}})),AU=$(((e,t)=>{"use strict";var r=Kl(),i=Ln(),n=OA(),a=Mi(),s=Ui(),o=Dx(),l=gv(),h=oA(),c=MU(),u=Gn().aTypedArrayConstructor,d=mR();t.exports=function(e){var t,p,f,m,g,v,y,b,x=n(this),_=a(e),w=arguments.length,S=w>1?arguments[1]:void 0,T=void 0!==S,M=l(_);if(M&&!h(M))for(b=(y=o(_,M)).next,_=[];!(v=i(b,y)).done;)_.push(v.value);for(T&&w>2&&(S=r(S,arguments[2])),p=s(_),f=new(u(x))(p),m=c(f),t=0;p>t;t++)g=T?S(_[t],t):_[t],f[t]=m?d(g):+g;return f}})),uh=$(((e,t)=>{"use strict";var r=ct(),i=Ir(),n=Ln(),a=un(),s=pR(),o=Gn(),l=qx(),h=tu(),c=ml(),u=Wa(),d=zA(),p=Bo(),f=eB(),m=SU(),g=sue(),v=nh(),y=fi(),b=Qc(),x=zn(),_=Xf(),w=No(),S=Fo(),T=eu(),M=$f().f,E=AU(),A=pa().forEach,C=Km(),P=fa(),R=ms(),I=ja(),O=Vx(),L=Ws(),D=Jf(),k=L.get,F=L.set,N=L.enforce,U=R.f,B=I.f,z=i.RangeError,H=l.ArrayBuffer,V=H.prototype,j=l.DataView,G=o.NATIVE_ARRAY_BUFFER_VIEWS,W=o.TYPED_ARRAY_TAG,X=o.TypedArray,q=o.TypedArrayPrototype,Y=o.isTypedArray,$="BYTES_PER_ELEMENT",Z="Wrong length",K=function(e,t){P(e,t,{configurable:!0,get:function(){return k(this)[t]}})},J=function(e){var t;return S(V,e)||"ArrayBuffer"===(t=b(e))||"SharedArrayBuffer"===t},Q=function(e,t){return Y(e)&&!_(t)&&t in e&&d(+t)&&t>=0},ee=function(e,t){return t=v(t),Q(e,t)?c(2,e[t]):B(e,t)},te=function(e,t,r){return t=v(t),!(Q(e,t)&&x(r)&&y(r,"value"))||y(r,"get")||y(r,"set")||r.configurable||y(r,"writable")&&!r.writable||y(r,"enumerable")&&!r.enumerable?U(e,t,r):(e[t]=r.value,e)};a?(G||(I.f=ee,R.f=te,K(q,"buffer"),K(q,"byteOffset"),K(q,"byteLength"),K(q,"length")),r({target:"Object",stat:!0,forced:!G},{getOwnPropertyDescriptor:ee,defineProperty:te}),t.exports=function(e,t,a){var o=e.match(/\d+/)[0]/8,l=e+(a?"Clamped":"")+"Array",c="get"+e,d="set"+e,v=i[l],y=v,b=y&&y.prototype,_={},S=function(e,t){U(e,t,{get:function(){return function(e,t){var r=k(e);return r.view[c](t*o+r.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,r){var i=k(e);i.view[d](t*o+i.byteOffset,a?g(r):r,!0)}(this,t,e)},enumerable:!0})};G?s&&(y=t((function(e,t,r,i){return h(e,b),D(x(t)?J(t)?void 0!==i?new v(t,m(r,o),i):void 0!==r?new v(t,m(r,o)):new v(t):Y(t)?O(y,t):n(E,y,t):new v(f(t)),e,y)})),T&&T(y,X),A(M(v),(function(e){e in y||u(y,e,v[e])})),y.prototype=b):(y=t((function(e,t,r,i){h(e,b);var a,s,l,c=0,u=0;if(x(t)){if(!J(t))return Y(t)?O(y,t):n(E,y,t);a=t,u=m(r,o);var d=t.byteLength;if(void 0===i){if(d%o)throw new z(Z);if((s=d-u)<0)throw new z(Z)}else if((s=p(i)*o)+u>d)throw new z(Z);l=s/o}else l=f(t),a=new H(s=l*o);for(F(e,{buffer:a,byteOffset:u,byteLength:s,length:l,view:new j(a)});c<l;)S(e,c++)})),T&&T(y,X),b=y.prototype=w(q)),b.constructor!==y&&u(b,"constructor",y),N(b).TypedArrayConstructor=y,W&&u(b,W,l);var P=y!==v;_[l]=y,r({global:!0,constructor:!0,forced:P,sham:!G},_),$ in y||u(y,$,o),$ in b||u(b,$,o),C(l)}):t.exports=function(){}})),Rue=$((()=>{"use strict";uh()("Float32",(function(e){return function(t,r,i){return e(this,t,r,i)}}))})),Cue=$((()=>{"use strict";uh()("Float64",(function(e){return function(t,r,i){return e(this,t,r,i)}}))})),Pue=$((()=>{"use strict";uh()("Int8",(function(e){return function(t,r,i){return e(this,t,r,i)}}))})),Iue=$((()=>{"use strict";uh()("Int16",(function(e){return function(t,r,i){return e(this,t,r,i)}}))})),Oue=$((()=>{"use strict";uh()("Int32",(function(e){return function(t,r,i){return e(this,t,r,i)}}))})),Due=$((()=>{"use strict";uh()("Uint8",(function(e){return function(t,r,i){return e(this,t,r,i)}}))})),Lue=$((()=>{"use strict";uh()("Uint8",(function(e){return function(t,r,i){return e(this,t,r,i)}}),!0)})),kue=$((()=>{"use strict";uh()("Uint16",(function(e){return function(t,r,i){return e(this,t,r,i)}}))})),Fue=$((()=>{"use strict";uh()("Uint32",(function(e){return function(t,r,i){return e(this,t,r,i)}}))})),Nue=$((()=>{"use strict";var e=Gn(),t=Ui(),r=Ps(),i=e.aTypedArray;(0,e.exportTypedArrayMethod)("at",(function(e){var n=i(this),a=t(n),s=r(e),o=s>=0?s:a+s;return o<0||o>=a?void 0:n[o]}))})),Hue=$((()=>{"use strict";var e=cr(),t=Gn(),r=e(PF()),i=t.aTypedArray;(0,t.exportTypedArrayMethod)("copyWithin",(function(e,t){return r(i(this),e,t,arguments.length>2?arguments[2]:void 0)}))})),zue=$((()=>{"use strict";var e=Gn(),t=pa().every,r=e.aTypedArray;(0,e.exportTypedArrayMethod)("every",(function(e){return t(r(this),e,arguments.length>1?arguments[1]:void 0)}))})),que=$((()=>{"use strict";var e=Gn(),t=hA(),r=mR(),i=Qc(),n=Ln(),a=cr(),s=ar(),o=e.aTypedArray,l=e.exportTypedArrayMethod,h=a("".slice);l("fill",(function(e){var a=arguments.length;o(this);var s="Big"===h(i(this),0,3)?r(e):+e;return n(t,this,s,a>1?arguments[1]:void 0,a>2?arguments[2]:void 0)}),s((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e})))})),wE=$(((e,t)=>{"use strict";var r=Gn(),i=Qm(),n=r.aTypedArrayConstructor,a=r.getTypedArrayConstructor;t.exports=function(e){return n(i(e,a(e)))}})),Yue=$(((e,t)=>{"use strict";var r=Vx(),i=wE();t.exports=function(e,t){return r(i(e),t)}})),Zue=$((()=>{"use strict";var e=Gn(),t=pa().filter,r=Yue(),i=e.aTypedArray;(0,e.exportTypedArrayMethod)("filter",(function(e){var n=t(i(this),e,arguments.length>1?arguments[1]:void 0);return r(this,n)}))})),Jue=$((()=>{"use strict";var e=Gn(),t=pa().find,r=e.aTypedArray;(0,e.exportTypedArrayMethod)("find",(function(e){return t(r(this),e,arguments.length>1?arguments[1]:void 0)}))})),ehe=$((()=>{"use strict";var e=Gn(),t=pa().findIndex,r=e.aTypedArray;(0,e.exportTypedArrayMethod)("findIndex",(function(e){return t(r(this),e,arguments.length>1?arguments[1]:void 0)}))})),rhe=$((()=>{"use strict";var e=Gn(),t=kx().findLast,r=e.aTypedArray;(0,e.exportTypedArrayMethod)("findLast",(function(e){return t(r(this),e,arguments.length>1?arguments[1]:void 0)}))})),ihe=$((()=>{"use strict";var e=Gn(),t=kx().findLastIndex,r=e.aTypedArray;(0,e.exportTypedArrayMethod)("findLastIndex",(function(e){return t(r(this),e,arguments.length>1?arguments[1]:void 0)}))})),ahe=$((()=>{"use strict";var e=Gn(),t=pa().forEach,r=e.aTypedArray;(0,e.exportTypedArrayMethod)("forEach",(function(e){t(r(this),e,arguments.length>1?arguments[1]:void 0)}))})),ohe=$((()=>{"use strict";var e=pR();(0,Gn().exportTypedArrayStaticMethod)("from",AU(),e)})),che=$((()=>{"use strict";var e=Gn(),t=av().includes,r=e.aTypedArray;(0,e.exportTypedArrayMethod)("includes",(function(e){return t(r(this),e,arguments.length>1?arguments[1]:void 0)}))})),hhe=$((()=>{"use strict";var e=Gn(),t=av().indexOf,r=e.aTypedArray;(0,e.exportTypedArrayMethod)("indexOf",(function(e){return t(r(this),e,arguments.length>1?arguments[1]:void 0)}))})),ghe=$((()=>{"use strict";var e=Ir(),t=ar(),r=cr(),i=Gn(),n=Ux(),a=$n()("iterator"),s=e.Uint8Array,o=r(n.values),l=r(n.keys),h=r(n.entries),c=i.aTypedArray,u=i.exportTypedArrayMethod,d=s&&s.prototype,p=!t((function(){d[a].call([1])})),f=!!d&&d.values&&d[a]===d.values&&"values"===d.values.name,m=function(){return o(c(this))};u("entries",(function(){return h(c(this))}),p),u("keys",(function(){return l(c(this))}),p),u("values",m,p||!f,{name:"values"}),u(a,m,p||!f,{name:"values"})})),yhe=$((()=>{"use strict";var e=Gn(),t=cr(),r=e.aTypedArray,i=e.exportTypedArrayMethod,n=t([].join);i("join",(function(e){return n(r(this),e)}))})),xhe=$((()=>{"use strict";var e=Gn(),t=vl(),r=jF(),i=e.aTypedArray;(0,e.exportTypedArrayMethod)("lastIndexOf",(function(e){var n=arguments.length;return t(r,i(this),n>1?[e,arguments[1]]:[e])}))})),_he=$((()=>{"use strict";var e=Gn(),t=pa().map,r=wE(),i=e.aTypedArray;(0,e.exportTypedArrayMethod)("map",(function(e){return t(i(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(r(e))(t)}))}))})),whe=$((()=>{"use strict";var e=Gn(),t=pR(),r=e.aTypedArrayConstructor;(0,e.exportTypedArrayStaticMethod)("of",(function(){for(var e=0,t=arguments.length,i=new(r(this))(t);t>e;)i[e]=arguments[e++];return i}),t)})),Mhe=$((()=>{"use strict";var e=Gn(),t=Hx().left,r=e.aTypedArray;(0,e.exportTypedArrayMethod)("reduce",(function(e){var i=arguments.length;return t(r(this),e,i,i>1?arguments[1]:void 0)}))})),Rhe=$((()=>{"use strict";var e=Gn(),t=Hx().right,r=e.aTypedArray;(0,e.exportTypedArrayMethod)("reduceRight",(function(e){var i=arguments.length;return t(r(this),e,i,i>1?arguments[1]:void 0)}))})),Phe=$((()=>{"use strict";var e=Gn(),t=e.aTypedArray,r=e.exportTypedArrayMethod,i=Math.floor;r("reverse",(function(){for(var e,r=this,n=t(r).length,a=i(n/2),s=0;s<a;)e=r[s],r[s++]=r[--n],r[n]=e;return r}))})),Fhe=$((()=>{"use strict";var e=Ir(),t=Ln(),r=Gn(),i=Ui(),n=SU(),a=Mi(),s=ar(),o=e.RangeError,l=e.Int8Array,h=l&&l.prototype,c=h&&h.set,u=r.aTypedArray,d=r.exportTypedArrayMethod,p=!s((function(){var e=new Uint8ClampedArray(2);return t(c,e,{length:1,0:3},1),3!==e[1]})),f=p&&r.NATIVE_ARRAY_BUFFER_VIEWS&&s((function(){var e=new l(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));d("set",(function(e){u(this);var r=n(arguments.length>1?arguments[1]:void 0,1),s=a(e);if(p)return t(c,this,s,r);var l=this.length,h=i(s),d=0;if(h+r>l)throw new o("Wrong length");for(;d<h;)this[r+d]=s[d++]}),!p||f)})),Nhe=$((()=>{"use strict";var e=Gn(),t=wE(),r=ar(),i=gl(),n=e.aTypedArray;(0,e.exportTypedArrayMethod)("slice",(function(e,r){for(var a=i(n(this),e,r),s=t(this),o=0,l=a.length,h=new s(l);l>o;)h[o]=a[o++];return h}),r((function(){new Int8Array(1).slice()})))})),Hhe=$((()=>{"use strict";var e=Gn(),t=pa().some,r=e.aTypedArray;(0,e.exportTypedArrayMethod)("some",(function(e){return t(r(this),e,arguments.length>1?arguments[1]:void 0)}))})),Whe=$((()=>{"use strict";var e=Ir(),t=yd(),r=ar(),i=ps(),n=yA(),a=Gn(),s=YF(),o=$F(),l=th(),h=bA(),c=a.aTypedArray,u=a.exportTypedArrayMethod,d=e.Uint16Array,p=d&&t(d.prototype.sort),f=!(!p||r((function(){p(new d(2),null)}))&&r((function(){p(new d(2),{})}))),m=!!p&&!r((function(){if(l)return l<74;if(s)return s<67;if(o)return!0;if(h)return h<602;var e,t,r=new d(516),i=Array(516);for(e=0;e<516;e++)t=e%4,r[e]=515-e,i[e]=e-2*t+3;for(p(r,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(r[e]!==i[e])return!0}));u("sort",(function(e){return void 0!==e&&i(e),m?p(this,e):n(c(this),(t=e,function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}));var t}),!m||f)})),$he=$((()=>{"use strict";var e=Gn(),t=Bo(),r=ih(),i=wE(),n=e.aTypedArray;(0,e.exportTypedArrayMethod)("subarray",(function(e,a){var s=n(this),o=s.length,l=r(e,o);return new(i(s))(s.buffer,s.byteOffset+l*s.BYTES_PER_ELEMENT,t((void 0===a?o:r(a,o))-l))}))})),ede=$((()=>{"use strict";var e=Ir(),t=vl(),r=Gn(),i=ar(),n=gl(),a=e.Int8Array,s=r.aTypedArray,o=r.exportTypedArrayMethod,l=[].toLocaleString,h=!!a&&i((function(){l.call(new a(1))}));o("toLocaleString",(function(){return t(l,h?n(s(this)):s(this),n(arguments))}),i((function(){return[1,2].toLocaleString()!==new a([1,2]).toLocaleString()}))||!i((function(){a.prototype.toLocaleString.call([1,2])})))})),tde=$((()=>{"use strict";var e=JF(),t=Gn(),r=t.aTypedArray,i=t.exportTypedArrayMethod,n=t.getTypedArrayConstructor;i("toReversed",(function(){return e(r(this),n(this))}))})),rde=$((()=>{"use strict";var e=Gn(),t=cr(),r=ps(),i=Vx(),n=e.aTypedArray,a=e.getTypedArrayConstructor,s=e.exportTypedArrayMethod,o=t(e.TypedArrayPrototype.sort);s("toSorted",(function(e){void 0!==e&&r(e);var t=n(this),s=i(a(t),t);return o(s,e)}))})),ide=$((()=>{"use strict";var e=Gn().exportTypedArrayMethod,t=ar(),r=Ir(),i=cr(),n=r.Uint8Array,a=n&&n.prototype||{},s=[].toString,o=i([].join);t((function(){s.call({})}))&&(s=function(){return o(this)});var l=a.toString!==s;e("toString",s,l)})),sde=$((()=>{"use strict";var e=QF(),t=Gn(),r=MU(),i=Ps(),n=mR(),a=t.aTypedArray,s=t.getTypedArrayConstructor;(0,t.exportTypedArrayMethod)("with",(function(t,o){var l=a(this),h=i(t),c=r(l)?n(o):+o;return e(l,s(l),h,c)}),!!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(e){return 8===e}}())})),ude=$((()=>{"use strict";var e=ct(),t=cr(),r=Rn(),i=String.fromCharCode,n=t("".charAt),a=t(/./.exec),s=t("".slice),o=/^[\da-f]{2}$/i,l=/^[\da-f]{4}$/i;e({global:!0},{unescape:function(e){for(var t,h,c=r(e),u="",d=c.length,p=0;p<d;){if("%"===(t=n(c,p++)))if("u"===n(c,p)){if(h=s(c,p+1,p+5),a(l,h)){u+=i(parseInt(h,16)),p+=5;continue}}else if(h=s(c,p,p+2),a(o,h)){u+=i(parseInt(h,16)),p+=2;continue}u+=t}return u}})})),ZU=$(((e,t)=>{"use strict";var r=cr(),i=xv(),n=sp().getWeakData,a=tu(),s=kn(),o=fo(),l=zn(),h=bl(),c=pa(),u=fi(),d=Ws(),p=d.set,f=d.getterFor,m=c.find,g=c.findIndex,v=r([].splice),y=0,b=function(e){return e.frozen||(e.frozen=new x)},x=function(){this.entries=[]},_=function(e,t){return m(e.entries,(function(e){return e[0]===t}))};x.prototype={get:function(e){var t=_(this,e);if(t)return t[1]},has:function(e){return!!_(this,e)},set:function(e,t){var r=_(this,e);r?r[1]=t:this.entries.push([e,t])},delete:function(e){var t=g(this.entries,(function(t){return t[0]===e}));return~t&&v(this.entries,t,1),!!~t}},t.exports={getConstructor:function(e,t,r,c){var d=e((function(e,i){a(e,m),p(e,{type:t,id:y++,frozen:void 0}),o(i)||h(i,e[c],{that:e,AS_ENTRIES:r})})),m=d.prototype,g=f(t),v=function(e,t,r){var i=g(e),a=n(s(t),!0);return!0===a?b(i).set(t,r):a[i.id]=r,e};return i(m,{delete:function(e){var t=g(this);if(!l(e))return!1;var r=n(e);return!0===r?b(t).delete(e):r&&u(r,t.id)&&delete r[t.id]},has:function(e){var t=g(this);if(!l(e))return!1;var r=n(e);return!0===r?b(t).has(e):r&&u(r,t.id)}}),i(m,r?{get:function(e){var t=g(this);if(l(e)){var r=n(e);return!0===r?b(t).get(e):r?r[t.id]:void 0}},set:function(e,t){return v(this,e,t)}}:{add:function(e){return v(this,e,!0)}}),d}}})),wde=$((()=>{"use strict";var e,t,r,i,n=tg(),a=Ir(),s=cr(),o=xv(),l=sp(),h=Xx(),c=ZU(),u=zn(),d=Ws().enforce,p=ar(),f=Ok(),m=Object,g=Array.isArray,v=m.isExtensible,y=m.isFrozen,b=m.isSealed,x=m.freeze,_=m.seal,w=!a.ActiveXObject&&"ActiveXObject"in a,S=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},T=h("WeakMap",S,c),M=T.prototype,E=s(M.set);f&&(w?(e=c.getConstructor(S,"WeakMap",!0),l.enable(),t=s(M.delete),r=s(M.has),i=s(M.get),o(M,{delete:function(r){if(u(r)&&!v(r)){var i=d(this);return i.frozen||(i.frozen=new e),t(this,r)||i.frozen.delete(r)}return t(this,r)},has:function(t){if(u(t)&&!v(t)){var i=d(this);return i.frozen||(i.frozen=new e),r(this,t)||i.frozen.has(t)}return r(this,t)},get:function(t){if(u(t)&&!v(t)){var n=d(this);return n.frozen||(n.frozen=new e),r(this,t)?i(this,t):n.frozen.get(t)}return i(this,t)},set:function(t,i){if(u(t)&&!v(t)){var n=d(this);n.frozen||(n.frozen=new e),r(this,t)?E(this,t,i):n.frozen.set(t,i)}else E(this,t,i);return this}})):n&&p((function(){var e=x([]);return E(new T,e,1),!y(e)}))&&o(M,{set:function(e,t){var r;return g(e)&&(y(e)?r=x:b(e)&&(r=_)),E(this,e,t),r&&r(e),this}}))})),Sde=$((()=>{"use strict";wde()})),Mde=$((()=>{"use strict";Xx()("WeakSet",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),ZU())})),Ade=$((()=>{"use strict";Mde()})),QU=$(((e,t)=>{"use strict";var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=r+"+/",n=r+"-_",a=function(e){for(var t={},r=0;r<64;r++)t[e.charAt(r)]=r;return t};t.exports={i2c:i,c2i:a(i),i2cUrl:n,c2iUrl:a(n)}})),Ude=$((()=>{"use strict";var e=ct(),t=Ir(),r=Qi(),i=cr(),n=Ln(),a=ar(),s=Rn(),o=Ql(),l=QU().c2i,h=/[^\d+/a-z]/i,c=/[\t\n\f\r ]+/g,u=/[=]{1,2}$/,d=r("atob"),p=String.fromCharCode,f=i("".charAt),m=i("".replace),g=i(h.exec),v=!!d&&!a((function(){return"hi"!==d("aGk=")})),y=v&&a((function(){return""!==d(" ")})),b=v&&!a((function(){d("a")})),x=v&&!a((function(){d()})),_=v&&1!==d.length;e({global:!0,bind:!0,enumerable:!0,forced:!v||y||b||x||_},{atob:function(e){if(o(arguments.length,1),v&&!y&&!b)return n(d,t,e);var i,a,x,_=m(s(e),c,""),w="",S=0,T=0;if(_.length%4==0&&(_=m(_,u,"")),(i=_.length)%4==1||g(h,_))throw new(r("DOMException"))("The string is not correctly encoded","InvalidCharacterError");for(;S<i;)a=f(_,S++),x=T%4?64*x+l[a]:l[a],T++%4&&(w+=p(255&x>>(-2*T&6)));return w}})})),qde=$((()=>{"use strict";var e=ct(),t=Ir(),r=Qi(),i=cr(),n=Ln(),a=ar(),s=Rn(),o=Ql(),l=QU().i2c,h=r("btoa"),c=i("".charAt),u=i("".charCodeAt),d=!!h&&!a((function(){return"aGk="!==h("hi")})),p=d&&!a((function(){h()})),f=d&&a((function(){return"bnVsbA=="!==h(null)})),m=d&&1!==h.length;e({global:!0,bind:!0,enumerable:!0,forced:!d||p||f||m},{btoa:function(e){if(o(arguments.length,1),d)return n(h,t,s(e));for(var i,a,p=s(e),f="",m=0,g=l;c(p,m)||(g="=",m%1);){if((a=u(p,m+=3/4))>255)throw new(r("DOMException"))("The string contains characters outside of the Latin1 range","InvalidCharacterError");f+=c(g,63&(i=i<<8|a)>>8-m%1*8)}return f}})})),rH=$(((e,t)=>{"use strict";t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}})),iH=$(((e,t)=>{"use strict";var r=Ex()("span").classList,i=r&&r.constructor&&r.constructor.prototype;t.exports=i===Object.prototype?void 0:i})),Kde=$((()=>{"use strict";var e,t=Ir(),r=rH(),i=iH(),n=LF(),a=Wa(),s=function(e){if(e&&e.forEach!==n)try{a(e,"forEach",n)}catch(t){e.forEach=n}};for(e in r)r[e]&&s(t[e]&&t[e].prototype);s(i)})),rfe=$((()=>{"use strict";var e,t=Ir(),r=rH(),i=iH(),n=Ux(),a=Wa(),s=mo(),o=$n()("iterator"),l=n.values,h=function(e,t){if(e){if(e[o]!==l)try{a(e,o,l)}catch(t){e[o]=l}if(s(e,t,!0),r[t])for(var i in n)if(e[i]!==n[i])try{a(e,i,n[i])}catch(t){e[i]=n[i]}}};for(e in r)h(t[e]&&t[e].prototype,e);h(i,"DOMTokenList")})),lH=$(((e,t)=>{"use strict";var r=wd();t.exports=function(e){try{if(r)return Function('return require("'+e+'")')()}catch(e){}}})),cH=$(((e,t)=>{"use strict";t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}})),mfe=$((()=>{"use strict";var e=ct(),t=lH(),r=Qi(),i=ar(),n=No(),a=ml(),s=ms().f,o=os(),l=fa(),h=fi(),c=tu(),u=kn(),d=xF(),p=pv(),f=cH(),m=nA(),g=Ws(),v=un(),y=_s(),b="DOMException",x="DATA_CLONE_ERR",_=r("Error"),w=r(b)||function(){try{(new(r("MessageChannel")||t("worker_threads").MessageChannel)).port1.postMessage(new WeakMap)}catch(e){if(e.name===x&&25===e.code)return e.constructor}}(),S=w&&w.prototype,T=_.prototype,M=g.set,E=g.getterFor(b),A="stack"in new _(b),C=function(e){return h(f,e)&&f[e].m?f[e].c:0},P=function(){c(this,R);var e=arguments.length,t=p(e<1?void 0:arguments[0]),r=p(e<2?void 0:arguments[1],"Error"),i=C(r);if(M(this,{type:b,name:r,message:t,code:i}),v||(this.name=r,this.message=t,this.code=i),A){var n=new _(t);n.name=b,s(this,"stack",a(1,m(n.stack,1)))}},R=P.prototype=n(T),I=function(e){return{enumerable:!0,configurable:!0,get:e}},O=function(e){return I((function(){return E(this)[e]}))};v&&(l(R,"code",O("code")),l(R,"message",O("message")),l(R,"name",O("name"))),s(R,"constructor",a(1,P));var L=i((function(){return!(new w instanceof _)})),D=L||i((function(){return T.toString!==d||"2: 1"!==String(new w(1,2))})),k=L||i((function(){return 25!==new w(1,"DataCloneError").code})),F=L||25!==w[x]||25!==S[x],N=y?D||k||F:L;e({global:!0,constructor:!0,forced:N},{DOMException:N?P:w});var U,B,z,H,V=r(b),j=V.prototype;for(H in D&&(y||w===V)&&o(j,"toString",d),k&&v&&w===V&&l(j,"code",I((function(){return C(u(this).name)}))),f)h(f,H)&&(B=(U=f[H]).s,z=a(6,U.c),h(V,B)||s(V,B,z),h(j,B)||s(j,B,z))})),_fe=$((()=>{"use strict";var e=ct(),t=Ir(),r=Qi(),i=ml(),n=ms().f,a=fi(),s=tu(),o=Jf(),l=pv(),h=cH(),c=nA(),u=un(),d=_s(),p="DOMException",f=r("Error"),m=r(p),g=function(){s(this,v);var e=arguments.length,t=l(e<1?void 0:arguments[0]),r=l(e<2?void 0:arguments[1],"Error"),a=new m(t,r),h=new f(t);return h.name=p,n(a,"stack",i(1,c(h.stack,1))),o(a,this,g),a},v=g.prototype=m.prototype,y="stack"in new f(p),b="stack"in new m(1,2),x=m&&u&&Object.getOwnPropertyDescriptor(t,p),_=!(!x||x.writable&&x.configurable),w=y&&!_&&!b;e({global:!0,constructor:!0,forced:d||w},{DOMException:w?g:m});var S,T,M,E=r(p),A=E.prototype;if(A.constructor!==E)for(M in d||n(A,"constructor",i(1,E)),h)a(h,M)&&(a(E,T=(S=h[M]).s)||n(E,T,i(6,S.c)))})),wfe=$((()=>{"use strict";var e=Qi(),t="DOMException";mo()(e(t),t)})),Mfe=$((()=>{"use strict";var e=ct(),t=Ir(),r=aE().clear;e({global:!0,bind:!0,enumerable:!0,forced:t.clearImmediate!==r},{clearImmediate:r})})),Rfe=$(((e,t)=>{"use strict";t.exports="function"==typeof Bun&&Bun&&"string"==typeof Bun.version})),zR=$(((e,t)=>{"use strict";var r,i=Ir(),n=vl(),a=ri(),s=Rfe(),o=eh(),l=gl(),h=Ql(),c=i.Function,u=/MSIE .\./.test(o)||s&&((r=i.Bun.version.split(".")).length<3||"0"===r[0]&&(r[1]<3||"3"===r[1]&&"0"===r[2]));t.exports=function(e,t){var r=t?2:1;return u?function(i,s){var o=h(arguments.length,1)>r,u=a(i)?i:c(i),d=o?l(arguments,r):[],p=o?function(){n(u,this,d)}:u;return t?e(p,s):e(p)}:e}})),Lfe=$((()=>{"use strict";var e=ct(),t=Ir(),r=aE().set,i=zR(),n=t.setImmediate?i(r,!1):r;e({global:!0,bind:!0,enumerable:!0,forced:t.setImmediate!==n},{setImmediate:n})})),kfe=$((()=>{"use strict";Mfe(),Lfe()})),Ffe=$((()=>{"use strict";var e=ct(),t=EN(),r=ps(),i=Ql();e({global:!0,enumerable:!0,dontCallGetSet:!0},{queueMicrotask:function(e){i(arguments.length,1),t(r(e))}})})),Nfe=$((()=>{"use strict";var e,t=ct(),r=Ir(),i=fa(),n=un(),a=TypeError,s=Object.defineProperty,o=r.self!==r;try{n?(e=Object.getOwnPropertyDescriptor(r,"self"),(o||!e||!e.get||!e.enumerable)&&i(r,"self",{get:function(){return r},set:function(e){if(this!==r)throw new a("Illegal invocation");s(r,"self",{value:e,writable:!0,configurable:!0,enumerable:!0})},configurable:!0,enumerable:!0})):t({global:!0,simple:!0,forced:o},{self:r})}catch(e){}})),CH=$(((e,t)=>{"use strict";var r=cr(),i=Set.prototype;t.exports={Set:Set,add:r(i.add),has:r(i.has),remove:r(i.delete),proto:i}})),Vfe=$(((e,t)=>{"use strict";var r=Ln();t.exports=function(e,t,i){for(var n,a,s=i?e:e.iterator,o=e.next;!(n=r(o,s)).done;)if(void 0!==(a=t(n.value)))return a}})),Xfe=$(((e,t)=>{"use strict";var r=cr(),i=Vfe(),n=CH(),a=n.Set,s=n.proto,o=r(s.forEach),l=r(s.keys),h=l(new a).next;t.exports=function(e,t,r){return r?i({iterator:l(e),next:h},t):o(e,t)}})),IH=$(((e,t)=>{"use strict";var r=Ir(),i=ar(),n=th(),a=_N(),s=XA(),o=wd(),l=r.structuredClone;t.exports=!!l&&!i((function(){if(s&&n>92||o&&n>94||a&&n>97)return!1;var e=new ArrayBuffer(8),t=l(e,{transfer:[e]});return 0!==e.byteLength||8!==t.byteLength}))})),Qfe=$(((e,t)=>{"use strict";var r,i,n,a,s=Ir(),o=lH(),l=IH(),h=s.structuredClone,c=s.ArrayBuffer,u=s.MessageChannel,d=!1;if(l)d=function(e){h(e,{transfer:[e]})};else if(c)try{u||(r=o("worker_threads"))&&(u=r.MessageChannel),u&&(i=new u,n=new c(2),a=function(e){i.port1.postMessage(null,[e])},2===n.byteLength&&(a(n),0===n.byteLength&&(d=a)))}catch(e){}t.exports=d})),upe=$((()=>{"use strict";var e,t=_s(),r=ct(),i=Ir(),n=Qi(),a=cr(),s=ar(),o=zm(),l=ri(),h=jm(),c=fo(),u=zn(),d=Xf(),p=bl(),f=kn(),m=Qc(),g=fi(),v=_d(),y=Wa(),b=Ui(),x=Ql(),_=Uv(),w=OB(),S=CH(),T=Xfe(),M=Qfe(),E=mF(),A=IH(),C=i.Object,P=i.Array,R=i.Date,I=i.Error,O=i.TypeError,L=i.PerformanceMark,D=n("DOMException"),k=w.Map,F=w.has,N=w.get,U=w.set,B=S.Set,z=S.add,H=S.has,V=n("Object","keys"),j=a([].push),G=a((!0).valueOf),W=a(1..valueOf),X=a("".valueOf),q=a(R.prototype.getTime),Y=o("structuredClone"),$="DataCloneError",Z="Transferring",K=function(e){return!s((function(){var t=new i.Set([7]),r=e(t),n=e(C(7));return r===t||!r.has(7)||!u(n)||7!=+n}))&&e},J=function(e,t){return!s((function(){var r=new t,i=e({a:r,b:r});return!(i&&i.a===i.b&&i.a instanceof t&&i.a.stack===r.stack)}))},Q=i.structuredClone,ee=t||!J(Q,I)||!J(Q,D)||(e=Q,!!s((function(){var t=e(new i.AggregateError([1],Y,{cause:3}));return"AggregateError"!==t.name||1!==t.errors[0]||t.message!==Y||3!==t.cause}))),te=!Q&&K((function(e){return new L(Y,{detail:e}).detail})),re=K(Q)||te,ie=function(e){throw new D("Uncloneable type: "+e,$)},ne=function(e,t){throw new D((t||"Cloning")+" of "+e+" cannot be properly polyfilled in this engine",$)},ae=function(e,t){return re||ne(t),re(e)},se=function(e,t,r){if(F(t,e))return N(t,e);var n,a,s,o,h,c;if("SharedArrayBuffer"===(r||m(e)))n=re?re(e):e;else{var u=i.DataView;!u&&!l(e.slice)&&ne("ArrayBuffer");try{if(l(e.slice)&&!e.resizable)n=e.slice(0);else for((a=e.byteLength,s="maxByteLength"in e?{maxByteLength:e.maxByteLength}:void 0,n=new ArrayBuffer(a,s),o=new u(e),h=new u(n),c=0);c<a;c++)h.setUint8(c,o.getUint8(c))}catch(e){throw new D("ArrayBuffer is detached",$)}}return U(t,e,n),n},oe=function(e,t){if(d(e)&&ie("Symbol"),!u(e))return e;if(t){if(F(t,e))return N(t,e)}else t=new k;var r,a,s,o,h,c,p,f,x=m(e);switch(x){case"Array":s=P(b(e));break;case"Object":s={};break;case"Map":s=new k;break;case"Set":s=new B;break;case"RegExp":s=new RegExp(e.source,_(e));break;case"Error":switch(a=e.name){case"AggregateError":s=new(n(a))([]);break;case"EvalError":case"RangeError":case"ReferenceError":case"SuppressedError":case"SyntaxError":case"TypeError":case"URIError":s=new(n(a));break;case"CompileError":case"LinkError":case"RuntimeError":s=new(n("WebAssembly",a));break;default:s=new I}break;case"DOMException":s=new D(e.message,e.name);break;case"ArrayBuffer":case"SharedArrayBuffer":s=se(e,t,x);break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float16Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":c="DataView"===x?e.byteLength:e.length,s=function(e,t,r,n,a){var s=i[t];return u(s)||ne(t),new s(se(e.buffer,a),r,n)}(e,x,e.byteOffset,c,t);break;case"DOMQuad":try{s=new DOMQuad(oe(e.p1,t),oe(e.p2,t),oe(e.p3,t),oe(e.p4,t))}catch(t){s=ae(e,x)}break;case"File":if(re)try{s=re(e),m(s)!==x&&(s=void 0)}catch(e){}if(!s)try{s=new File([e],e.name,e)}catch(e){}s||ne(x);break;case"FileList":if(o=function(){var e;try{e=new i.DataTransfer}catch(t){try{e=new i.ClipboardEvent("").clipboardData}catch(e){}}return e&&e.items&&e.files?e:null}(),o){for(h=0,c=b(e);h<c;h++)o.items.add(oe(e[h],t));s=o.files}else s=ae(e,x);break;case"ImageData":try{s=new ImageData(oe(e.data,t),e.width,e.height,{colorSpace:e.colorSpace})}catch(t){s=ae(e,x)}break;default:if(re)s=re(e);else switch(x){case"BigInt":s=C(e.valueOf());break;case"Boolean":s=C(G(e));break;case"Number":s=C(W(e));break;case"String":s=C(X(e));break;case"Date":s=new R(q(e));break;case"Blob":try{s=e.slice(0,e.size,e.type)}catch(e){ne(x)}break;case"DOMPoint":case"DOMPointReadOnly":r=i[x];try{s=r.fromPoint?r.fromPoint(e):new r(e.x,e.y,e.z,e.w)}catch(e){ne(x)}break;case"DOMRect":case"DOMRectReadOnly":r=i[x];try{s=r.fromRect?r.fromRect(e):new r(e.x,e.y,e.width,e.height)}catch(e){ne(x)}break;case"DOMMatrix":case"DOMMatrixReadOnly":r=i[x];try{s=r.fromMatrix?r.fromMatrix(e):new r(e)}catch(e){ne(x)}break;case"AudioData":case"VideoFrame":l(e.clone)||ne(x);try{s=e.clone()}catch(e){ie(x)}break;case"CropTarget":case"CryptoKey":case"FileSystemDirectoryHandle":case"FileSystemFileHandle":case"FileSystemHandle":case"GPUCompilationInfo":case"GPUCompilationMessage":case"ImageBitmap":case"RTCCertificate":case"WebAssembly.Module":ne(x);default:ie(x)}}switch(U(t,e,s),x){case"Array":case"Object":for(p=V(e),h=0,c=b(p);h<c;h++)f=p[h],v(s,f,oe(e[f],t));break;case"Map":e.forEach((function(e,r){U(s,oe(r,t),oe(e,t))}));break;case"Set":e.forEach((function(e){z(s,oe(e,t))}));break;case"Error":y(s,"message",oe(e.message,t)),g(e,"cause")&&y(s,"cause",oe(e.cause,t)),"AggregateError"===a?s.errors=oe(e.errors,t):"SuppressedError"===a&&(s.error=oe(e.error,t),s.suppressed=oe(e.suppressed,t));case"DOMException":E&&y(s,"stack",oe(e.stack,t))}return s};r({global:!0,enumerable:!0,sham:!A,forced:ee},{structuredClone:function(e){var t,r,n=x(arguments.length,1)>1&&!c(arguments[1])?f(arguments[1]):void 0,a=n?n.transfer:void 0;void 0!==a&&(r=function(e,t){if(!u(e))throw new O("Transfer option cannot be converted to a sequence");var r=[];p(e,(function(e){j(r,f(e))}));for(var n,a,s,o,c,d=0,g=b(r),v=new B;d<g;){if(n=r[d++],"ArrayBuffer"===(a=m(n))?H(v,n):F(t,n))throw new D("Duplicate transferable",$);if("ArrayBuffer"!==a){if(A)o=Q(n,{transfer:[n]});else switch(a){case"ImageBitmap":s=i.OffscreenCanvas,h(s)||ne(a,Z);try{(c=new s(n.width,n.height)).getContext("bitmaprenderer").transferFromImageBitmap(n),o=c.transferToImageBitmap()}catch(e){}break;case"AudioData":case"VideoFrame":(!l(n.clone)||!l(n.close))&&ne(a,Z);try{o=n.clone(),n.close()}catch(e){}break;case"MediaSourceHandle":case"MessagePort":case"OffscreenCanvas":case"ReadableStream":case"TransformStream":case"WritableStream":ne(a,Z)}if(void 0===o)throw new D("This object cannot be transferred: "+a,$);U(t,n,o)}else z(v,n)}return v}(a,t=new k));var s=oe(e,t);return r&&function(e){T(e,(function(e){A?re(e,{transfer:[e]}):l(e.transfer)?e.transfer():M?M(e):ne("ArrayBuffer",Z)}))}(r),s}})})),fpe=$((()=>{"use strict";var e=ct(),t=Ir(),r=zR()(t.setInterval,!0);e({global:!0,bind:!0,forced:t.setInterval!==r},{setInterval:r})})),gpe=$((()=>{"use strict";var e=ct(),t=Ir(),r=zR()(t.setTimeout,!0);e({global:!0,bind:!0,forced:t.setTimeout!==r},{setTimeout:r})})),vpe=$((()=>{"use strict";fpe(),gpe()})),QR=$(((e,t)=>{"use strict";var r=ar(),i=$n(),n=un(),a=_s(),s=i("iterator");t.exports=!r((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2&b=3"),i="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),i+=r+e})),r.delete("a",2),r.delete("b",void 0),a&&(!e.toJSON||!r.has("a",1)||r.has("a",2)||!r.has("a",void 0)||r.has("b"))||!t.size&&(a||!n)||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[s]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==i||"x"!==new URL("http://x",void 0).host}))})),Rpe=$(((e,t)=>{"use strict";var r=cr(),i=2147483647,n=/[^\0-\u007E]/,a=/[.\u3002\uFF0E\uFF61]/g,s="Overflow: input needs wider integers to process",o=RangeError,l=r(a.exec),h=Math.floor,c=String.fromCharCode,u=r("".charCodeAt),d=r([].join),p=r([].push),f=r("".replace),m=r("".split),g=r("".toLowerCase),v=function(e){return e+22+75*(e<26)},y=function(e,t,r){var i=0;for(e=r?h(e/700):e>>1,e+=h(e/t);e>455;)e=h(e/35),i+=36;return h(i+36*e/(e+38))},b=function(e){var t=[];e=function(e){for(var t=[],r=0,i=e.length;r<i;){var n=u(e,r++);if(n>=55296&&n<=56319&&r<i){var a=u(e,r++);56320==(64512&a)?p(t,((1023&n)<<10)+(1023&a)+65536):(p(t,n),r--)}else p(t,n)}return t}(e);var r,n,a=e.length,l=128,f=0,m=72;for(r=0;r<e.length;r++)(n=e[r])<128&&p(t,c(n));var g=t.length,b=g;for(g&&p(t,"-");b<a;){var x=i;for(r=0;r<e.length;r++)(n=e[r])>=l&&n<x&&(x=n);var _=b+1;if(x-l>h((i-f)/_))throw new o(s);for(f+=(x-l)*_,l=x,r=0;r<e.length;r++){if((n=e[r])<l&&++f>i)throw new o(s);if(n===l){for(var w=f,S=36;;){var T=S<=m?1:S>=m+26?26:S-m;if(w<T)break;var M=w-T,E=36-T;p(t,c(v(T+M%E))),w=h(M/E),S+=36}p(t,c(v(w))),m=y(f,_,b===g),f=0,b++}}f++,l++}return d(t,"")};t.exports=function(e){var t,r,i=[],s=m(f(g(e),a,"."),".");for(t=0;t<s.length;t++)r=s[t],p(i,l(n,r)?"xn--"+b(r):r);return d(i,".")}})),n5=$(((e,t)=>{"use strict";Ux();var r=ct(),i=Ir(),n=pN(),a=Ln(),s=cr(),o=un(),l=QR(),h=os(),c=fa(),u=xv(),d=mo(),p=dA(),f=Ws(),m=tu(),g=ri(),v=fi(),y=Kl(),b=Qc(),x=kn(),_=zn(),w=Rn(),S=No(),T=ml(),M=Dx(),E=gv(),A=bv(),C=Ql(),P=$n(),R=yA(),I=P("iterator"),O="URLSearchParams",L=O+"Iterator",D=f.set,k=f.getterFor(O),F=f.getterFor(L),N=n("fetch"),U=n("Request"),B=n("Headers"),z=U&&U.prototype,H=B&&B.prototype,V=i.RegExp,j=i.TypeError,G=i.decodeURIComponent,W=i.encodeURIComponent,X=s("".charAt),q=s([].join),Y=s([].push),$=s("".replace),Z=s([].shift),K=s([].splice),J=s("".split),Q=s("".slice),ee=/\+/g,te=Array(4),re=function(e){return te[e-1]||(te[e-1]=V("((?:%[\\da-f]{2}){"+e+"})","gi"))},ie=function(e){try{return G(e)}catch(t){return e}},ne=function(e){var t=$(e,ee," "),r=4;try{return G(t)}catch(e){for(;r;)t=$(t,re(r--),ie);return t}},ae=/[!'()~]|%20/g,se={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},oe=function(e){return se[e]},le=function(e){return $(W(e),ae,oe)},he=p((function(e,t){D(this,{type:L,target:k(e).entries,index:0,kind:t})}),O,(function(){var e=F(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=void 0,A(void 0,!0);var i=t[r];switch(e.kind){case"keys":return A(i.key,!1);case"values":return A(i.value,!1)}return A([i.key,i.value],!1)}),!0),ce=function(e){this.entries=[],this.url=null,void 0!==e&&(_(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===X(e,0)?Q(e,1):e:w(e)))};ce.prototype={type:O,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,i,n,s,o,l,h=this.entries,c=E(e);if(c)for(r=(t=M(e,c)).next;!(i=a(r,t)).done;){if(s=(n=M(x(i.value))).next,(o=a(s,n)).done||(l=a(s,n)).done||!a(s,n).done)throw new j("Expected sequence with length 2");Y(h,{key:w(o.value),value:w(l.value)})}else for(var u in e)v(e,u)&&Y(h,{key:u,value:w(e[u])})},parseQuery:function(e){if(e)for(var t,r,i=this.entries,n=J(e,"&"),a=0;a<n.length;)(t=n[a++]).length&&(r=J(t,"="),Y(i,{key:ne(Z(r)),value:ne(q(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],i=0;i<t.length;)e=t[i++],Y(r,le(e.key)+"="+le(e.value));return q(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ue,de,pe,fe,me=function(){m(this,ge);var e=D(this,new ce(arguments.length>0?arguments[0]:void 0));o||(this.size=e.entries.length)},ge=me.prototype;u(ge,{append:function(e,t){var r=k(this);C(arguments.length,2),Y(r.entries,{key:w(e),value:w(t)}),o||this.length++,r.updateURL()},delete:function(e){for(var t=k(this),r=C(arguments.length,1),i=t.entries,n=w(e),a=r<2?void 0:arguments[1],s=void 0===a?a:w(a),l=0;l<i.length;){var h=i[l];if(h.key!==n||void 0!==s&&h.value!==s)l++;else if(K(i,l,1),void 0!==s)break}o||(this.size=i.length),t.updateURL()},get:function(e){var t=k(this).entries;C(arguments.length,1);for(var r=w(e),i=0;i<t.length;i++)if(t[i].key===r)return t[i].value;return null},getAll:function(e){var t=k(this).entries;C(arguments.length,1);for(var r=w(e),i=[],n=0;n<t.length;n++)t[n].key===r&&Y(i,t[n].value);return i},has:function(e){for(var t=k(this).entries,r=C(arguments.length,1),i=w(e),n=r<2?void 0:arguments[1],a=void 0===n?n:w(n),s=0;s<t.length;){var o=t[s++];if(o.key===i&&(void 0===a||o.value===a))return!0}return!1},set:function(e,t){var r=k(this);C(arguments.length,1);for(var i,n=r.entries,a=!1,s=w(e),l=w(t),h=0;h<n.length;h++)(i=n[h]).key===s&&(a?K(n,h--,1):(a=!0,i.value=l));a||Y(n,{key:s,value:l}),o||(this.size=n.length),r.updateURL()},sort:function(){var e=k(this);R(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,r=k(this).entries,i=y(e,arguments.length>1?arguments[1]:void 0),n=0;n<r.length;)i((t=r[n++]).value,t.key,this)},keys:function(){return new he(this,"keys")},values:function(){return new he(this,"values")},entries:function(){return new he(this,"entries")}},{enumerable:!0}),h(ge,I,ge.entries,{name:"entries"}),h(ge,"toString",(function(){return k(this).serialize()}),{enumerable:!0}),o&&c(ge,"size",{get:function(){return k(this).entries.length},configurable:!0,enumerable:!0}),d(me,O),r({global:!0,constructor:!0,forced:!l},{URLSearchParams:me}),!l&&g(B)&&(ue=s(H.has),de=s(H.set),pe=function(e){if(_(e)){var t,r=e.body;if(b(r)===O)return t=e.headers?new B(e.headers):new B,ue(t,"content-type")||de(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),S(e,{body:T(0,w(r)),headers:T(0,t)})}return e},g(N)&&r({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return N(e,arguments.length>1?pe(arguments[1]):{})}}),g(U)&&(fe=function(e){return m(this,z),new U(e,arguments.length>1?pe(arguments[1]):{})},z.constructor=fe,fe.prototype=z,r({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:fe}))),t.exports={URLSearchParams:me,getState:k}})),fme=$((()=>{"use strict";rU();var e,t=ct(),r=un(),i=QR(),n=Ir(),a=Kl(),s=cr(),o=os(),l=fa(),h=tu(),c=fi(),u=KB(),d=kF(),p=gl(),f=pE().codeAt,m=Rpe(),g=Rn(),v=mo(),y=Ql(),b=n5(),x=Ws(),_=x.set,w=x.getterFor("URL"),S=b.URLSearchParams,T=b.getState,M=n.URL,E=n.TypeError,A=n.parseInt,C=Math.floor,P=Math.pow,R=s("".charAt),I=s(/./.exec),O=s([].join),L=s(1..toString),D=s([].pop),k=s([].push),F=s("".replace),N=s([].shift),U=s("".split),B=s("".slice),z=s("".toLowerCase),H=s([].unshift),V="Invalid scheme",j="Invalid host",G="Invalid port",W=/[a-z]/i,X=/[\d+-.a-z]/i,q=/\d/,Y=/^0x/i,$=/^[0-7]+$/,Z=/^\d+$/,K=/^[\da-f]+$/i,J=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Q=/[\0\t\n\r #/:<>?@[\\\]^|]/,ee=/^[\u0000-\u0020]+/,te=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,re=/[\t\n\r]/g,ie=function(e){var t,r,i,n;if("number"==typeof e){for(t=[],r=0;r<4;r++)H(t,e%256),e=C(e/256);return O(t,".")}if("object"==typeof e){for(t="",i=function(e){for(var t=null,r=1,i=null,n=0,a=0;a<8;a++)0!==e[a]?(n>r&&(t=i,r=n),i=null,n=0):(null===i&&(i=a),++n);return n>r&&(t=i,r=n),t}(e),r=0;r<8;r++)n&&0===e[r]||(n&&(n=!1),i===r?(t+=r?":":"::",n=!0):(t+=L(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},ne={},ae=u({},ne,{" ":1,'"':1,"<":1,">":1,"`":1}),se=u({},ae,{"#":1,"?":1,"{":1,"}":1}),oe=u({},se,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),le=function(e,t){var r=f(e,0);return r>32&&r<127&&!c(t,e)?e:encodeURIComponent(e)},he={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ce=function(e,t){var r;return 2===e.length&&I(W,R(e,0))&&(":"===(r=R(e,1))||!t&&"|"===r)},ue=function(e){var t;return e.length>1&&ce(B(e,0,2))&&(2===e.length||"/"===(t=R(e,2))||"\\"===t||"?"===t||"#"===t)},de=function(e){return"."===e||"%2e"===z(e)},pe=function(e){return".."===(e=z(e))||"%2e."===e||".%2e"===e||"%2e%2e"===e},fe={},me={},ge={},ve={},ye={},be={},xe={},_e={},we={},Se={},Te={},Me={},Ee={},Ae={},Ce={},Pe={},Re={},Ie={},Oe={},Le={},De={},ke=function(e,t,r){var i,n,a,s=g(e);if(t){if(n=this.parse(s))throw new E(n);this.searchParams=null}else{if(void 0!==r&&(i=new ke(r,!0)),n=this.parse(s,null,i))throw new E(n);(a=T(new S)).bindURL(this),this.searchParams=a}};ke.prototype={type:"URL",parse:function(t,r,i){var n,a,s,o,l=this,h=r||fe,u=0,f="",m=!1,v=!1,y=!1;for(t=g(t),r||(l.scheme="",l.username="",l.password="",l.host=null,l.port=null,l.path=[],l.query=null,l.fragment=null,l.cannotBeABaseURL=!1,t=F(t,ee,""),t=F(t,te,"$1")),t=F(t,re,""),n=d(t);u<=n.length;){switch(a=n[u],h){case fe:if(!a||!I(W,a)){if(r)return V;h=ge;continue}f+=z(a),h=me;break;case me:if(a&&(I(X,a)||"+"===a||"-"===a||"."===a))f+=z(a);else{if(":"!==a){if(r)return V;f="",h=ge,u=0;continue}if(r&&(l.isSpecial()!==c(he,f)||"file"===f&&(l.includesCredentials()||null!==l.port)||"file"===l.scheme&&!l.host))return;if(l.scheme=f,r)return void(l.isSpecial()&&he[l.scheme]===l.port&&(l.port=null));f="","file"===l.scheme?h=Ae:l.isSpecial()&&i&&i.scheme===l.scheme?h=ve:l.isSpecial()?h=_e:"/"===n[u+1]?(h=ye,u++):(l.cannotBeABaseURL=!0,k(l.path,""),h=Oe)}break;case ge:if(!i||i.cannotBeABaseURL&&"#"!==a)return V;if(i.cannotBeABaseURL&&"#"===a){l.scheme=i.scheme,l.path=p(i.path),l.query=i.query,l.fragment="",l.cannotBeABaseURL=!0,h=De;break}h="file"===i.scheme?Ae:be;continue;case ve:if("/"!==a||"/"!==n[u+1]){h=be;continue}h=we,u++;break;case ye:if("/"===a){h=Se;break}h=Ie;continue;case be:if(l.scheme=i.scheme,a===e)l.username=i.username,l.password=i.password,l.host=i.host,l.port=i.port,l.path=p(i.path),l.query=i.query;else if("/"===a||"\\"===a&&l.isSpecial())h=xe;else if("?"===a)l.username=i.username,l.password=i.password,l.host=i.host,l.port=i.port,l.path=p(i.path),l.query="",h=Le;else{if("#"!==a){l.username=i.username,l.password=i.password,l.host=i.host,l.port=i.port,l.path=p(i.path),l.path.length--,h=Ie;continue}l.username=i.username,l.password=i.password,l.host=i.host,l.port=i.port,l.path=p(i.path),l.query=i.query,l.fragment="",h=De}break;case xe:if(!l.isSpecial()||"/"!==a&&"\\"!==a){if("/"!==a){l.username=i.username,l.password=i.password,l.host=i.host,l.port=i.port,h=Ie;continue}h=Se}else h=we;break;case _e:if(h=we,"/"!==a||"/"!==R(f,u+1))continue;u++;break;case we:if("/"!==a&&"\\"!==a){h=Se;continue}break;case Se:if("@"===a){m&&(f="%40"+f),m=!0,s=d(f);for(var b=0;b<s.length;b++){var x=s[b];if(":"!==x||y){var _=le(x,oe);y?l.password+=_:l.username+=_}else y=!0}f=""}else if(a===e||"/"===a||"?"===a||"#"===a||"\\"===a&&l.isSpecial()){if(m&&""===f)return"Invalid authority";u-=d(f).length+1,f="",h=Te}else f+=a;break;case Te:case Me:if(r&&"file"===l.scheme){h=Pe;continue}if(":"!==a||v){if(a===e||"/"===a||"?"===a||"#"===a||"\\"===a&&l.isSpecial()){if(l.isSpecial()&&""===f)return j;if(r&&""===f&&(l.includesCredentials()||null!==l.port))return;if(o=l.parseHost(f))return o;if(f="",h=Re,r)return;continue}"["===a?v=!0:"]"===a&&(v=!1),f+=a}else{if(""===f)return j;if(o=l.parseHost(f))return o;if(f="",h=Ee,r===Me)return}break;case Ee:if(!I(q,a)){if(a===e||"/"===a||"?"===a||"#"===a||"\\"===a&&l.isSpecial()||r){if(""!==f){var w=A(f,10);if(w>65535)return G;l.port=l.isSpecial()&&w===he[l.scheme]?null:w,f=""}if(r)return;h=Re;continue}return G}f+=a;break;case Ae:if(l.scheme="file","/"===a||"\\"===a)h=Ce;else{if(!i||"file"!==i.scheme){h=Ie;continue}switch(a){case e:l.host=i.host,l.path=p(i.path),l.query=i.query;break;case"?":l.host=i.host,l.path=p(i.path),l.query="",h=Le;break;case"#":l.host=i.host,l.path=p(i.path),l.query=i.query,l.fragment="",h=De;break;default:ue(O(p(n,u),""))||(l.host=i.host,l.path=p(i.path),l.shortenPath()),h=Ie;continue}}break;case Ce:if("/"===a||"\\"===a){h=Pe;break}i&&"file"===i.scheme&&!ue(O(p(n,u),""))&&(ce(i.path[0],!0)?k(l.path,i.path[0]):l.host=i.host),h=Ie;continue;case Pe:if(a===e||"/"===a||"\\"===a||"?"===a||"#"===a){if(!r&&ce(f))h=Ie;else if(""===f){if(l.host="",r)return;h=Re}else{if(o=l.parseHost(f))return o;if("localhost"===l.host&&(l.host=""),r)return;f="",h=Re}continue}f+=a;break;case Re:if(l.isSpecial()){if(h=Ie,"/"!==a&&"\\"!==a)continue}else if(r||"?"!==a)if(r||"#"!==a){if(a!==e&&(h=Ie,"/"!==a))continue}else l.fragment="",h=De;else l.query="",h=Le;break;case Ie:if(a===e||"/"===a||"\\"===a&&l.isSpecial()||!r&&("?"===a||"#"===a)){if(pe(f)?(l.shortenPath(),"/"!==a&&!("\\"===a&&l.isSpecial())&&k(l.path,"")):de(f)?"/"!==a&&!("\\"===a&&l.isSpecial())&&k(l.path,""):("file"===l.scheme&&!l.path.length&&ce(f)&&(l.host&&(l.host=""),f=R(f,0)+":"),k(l.path,f)),f="","file"===l.scheme&&(a===e||"?"===a||"#"===a))for(;l.path.length>1&&""===l.path[0];)N(l.path);"?"===a?(l.query="",h=Le):"#"===a&&(l.fragment="",h=De)}else f+=le(a,se);break;case Oe:"?"===a?(l.query="",h=Le):"#"===a?(l.fragment="",h=De):a!==e&&(l.path[0]+=le(a,ne));break;case Le:r||"#"!==a?a!==e&&("'"===a&&l.isSpecial()?l.query+="%27":l.query+="#"===a?"%23":le(a,ne)):(l.fragment="",h=De);break;case De:a!==e&&(l.fragment+=le(a,ae))}u++}},parseHost:function(e){var t,r,i;if("["===R(e,0)){if("]"!==R(e,e.length-1)||(t=function(e){var t,r,i,n,a,s,o,l=[0,0,0,0,0,0,0,0],h=0,c=null,u=0,d=function(){return R(e,u)};if(":"===d()){if(":"!==R(e,1))return;u+=2,c=++h}for(;d();){if(8===h)return;if(":"!==d()){for(t=r=0;r<4&&I(K,d());)t=16*t+A(d(),16),u++,r++;if("."===d()){if(0===r||(u-=r,h>6))return;for(i=0;d();){if(n=null,i>0){if(!("."===d()&&i<4))return;u++}if(!I(q,d()))return;for(;I(q,d());){if(a=A(d(),10),null===n)n=a;else{if(0===n)return;n=10*n+a}if(n>255)return;u++}l[h]=256*l[h]+n,(2==++i||4===i)&&h++}if(4!==i)return;break}if(":"===d()){if(u++,!d())return}else if(d())return;l[h++]=t}else{if(null!==c)return;u++,c=++h}}if(null!==c)for(s=h-c,h=7;0!==h&&s>0;)o=l[h],l[h--]=l[c+s-1],l[c+--s]=o;else if(8!==h)return;return l}(B(e,1,-1)),!t))return j;this.host=t}else if(this.isSpecial()){if(e=m(e),I(J,e)||(t=function(e){var t,r,i,n,a,s,o,l=U(e,".");if(l.length&&""===l[l.length-1]&&l.length--,(t=l.length)>4)return e;for(r=[],i=0;i<t;i++){if(""===(n=l[i]))return e;if(a=10,n.length>1&&"0"===R(n,0)&&(a=I(Y,n)?16:8,n=B(n,8===a?1:2)),""===n)s=0;else{if(!I(10===a?Z:8===a?$:K,n))return e;s=A(n,a)}k(r,s)}for(i=0;i<t;i++)if(s=r[i],i===t-1){if(s>=P(256,5-t))return null}else if(s>255)return null;for(o=D(r),i=0;i<r.length;i++)o+=r[i]*P(256,3-i);return o}(e),null===t))return j;this.host=t}else{if(I(Q,e))return j;for(t="",r=d(e),i=0;i<r.length;i++)t+=le(r[i],ne);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return c(he,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;t&&("file"!==this.scheme||1!==t||!ce(e[0],!0))&&e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,i=e.password,n=e.host,a=e.port,s=e.path,o=e.query,l=e.fragment,h=t+":";return null!==n?(h+="//",e.includesCredentials()&&(h+=r+(i?":"+i:"")+"@"),h+=ie(n),null!==a&&(h+=":"+a)):"file"===t&&(h+="//"),h+=e.cannotBeABaseURL?s[0]:s.length?"/"+O(s,"/"):"",null!==o&&(h+="?"+o),null!==l&&(h+="#"+l),h},setHref:function(e){var t=this.parse(e);if(t)throw new E(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"===e)try{return new Ue(e.path[0]).origin}catch(e){return"null"}return"file"!==e&&this.isSpecial()?e+"://"+ie(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(g(e)+":",fe)},getUsername:function(){return this.username},setUsername:function(e){var t=d(g(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=le(t[r],oe)}},getPassword:function(){return this.password},setPassword:function(e){var t=d(g(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=le(t[r],oe)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?ie(e):ie(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Te)},getHostname:function(){var e=this.host;return null===e?"":ie(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Me)},getPort:function(){var e=this.port;return null===e?"":g(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""===(e=g(e))?this.port=null:this.parse(e,Ee))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+O(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Re))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""===(e=g(e))?this.query=null:("?"===R(e,0)&&(e=B(e,1)),this.query="",this.parse(e,Le)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!==(e=g(e))?("#"===R(e,0)&&(e=B(e,1)),this.fragment="",this.parse(e,De)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Fe,Ne,Ue=function(e){var t=h(this,Be),i=y(arguments.length,1)>1?arguments[1]:void 0,n=_(t,new ke(e,!1,i));r||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},Be=Ue.prototype,ze=function(e,t){return{get:function(){return w(this)[e]()},set:t&&function(e){return w(this)[t](e)},configurable:!0,enumerable:!0}};r&&(l(Be,"href",ze("serialize","setHref")),l(Be,"origin",ze("getOrigin")),l(Be,"protocol",ze("getProtocol","setProtocol")),l(Be,"username",ze("getUsername","setUsername")),l(Be,"password",ze("getPassword","setPassword")),l(Be,"host",ze("getHost","setHost")),l(Be,"hostname",ze("getHostname","setHostname")),l(Be,"port",ze("getPort","setPort")),l(Be,"pathname",ze("getPathname","setPathname")),l(Be,"search",ze("getSearch","setSearch")),l(Be,"searchParams",ze("getSearchParams")),l(Be,"hash",ze("getHash","setHash"))),o(Be,"toJSON",(function(){return w(this).serialize()}),{enumerable:!0}),o(Be,"toString",(function(){return w(this).serialize()}),{enumerable:!0}),M&&(Fe=M.createObjectURL,Ne=M.revokeObjectURL,Fe&&o(Ue,"createObjectURL",a(Fe,M)),Ne&&o(Ue,"revokeObjectURL",a(Ne,M))),v(Ue,"URL"),t({global:!0,constructor:!0,forced:!i,sham:!r},{URL:Ue})})),pme=$((()=>{"use strict";fme()})),vme=$((()=>{"use strict";var e=ct(),t=Qi(),r=ar(),i=Ql(),n=Rn(),a=QR(),s=t("URL");e({target:"URL",stat:!0,forced:!(a&&r((function(){s.canParse()})))},{canParse:function(e){var t=i(arguments.length,1),r=n(e),a=t<2||void 0===arguments[1]?void 0:n(arguments[1]);try{return!!new s(r,a)}catch(e){return!1}}})})),yme=$((()=>{"use strict";var e=ct(),t=Ln();e({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return t(URL.prototype.toString,this)}})})),bme=$((()=>{"use strict";n5()})),Tme=$((()=>{"use strict";var e=os(),t=cr(),r=Rn(),i=Ql(),n=URLSearchParams,a=n.prototype,s=t(a.append),o=t(a.delete),l=t(a.forEach),h=t([].push),c=new n("a=1&a=2&b=3");c.delete("a",1),c.delete("b",void 0),c+""!="a=2"&&e(a,"delete",(function(e){var t=arguments.length,n=t<2?void 0:arguments[1];if(t&&void 0===n)return o(this,e);var a=[];l(this,(function(e,t){h(a,{key:t,value:e})})),i(t,1);for(var c,u=r(e),d=r(n),p=0,f=0,m=!1,g=a.length;p<g;)c=a[p++],m||c.key===u?(m=!0,o(this,c.key)):f++;for(;f<g;)(c=a[f++]).key===u&&c.value===d||s(this,c.key,c.value)}),{enumerable:!0,unsafe:!0})})),Ame=$((()=>{"use strict";var e=os(),t=cr(),r=Rn(),i=Ql(),n=URLSearchParams,a=n.prototype,s=t(a.getAll),o=t(a.has),l=new n("a=1");(l.has("a",2)||!l.has("a",void 0))&&e(a,"has",(function(e){var t=arguments.length,n=t<2?void 0:arguments[1];if(t&&void 0===n)return o(this,e);var a=s(this,e);i(t,1);for(var l=r(n),h=0;h<a.length;)if(a[h++]===l)return!0;return!1}),{enumerable:!0,unsafe:!0})})),Rme=$((()=>{"use strict";var e=un(),t=cr(),r=fa(),i=URLSearchParams.prototype,n=t(i.forEach);e&&!("size"in i)&&r(i,"size",{get:function(){var e=0;return n(this,(function(){e++})),e},configurable:!0,enumerable:!0})})),Pme=$(((e,t)=>{"use strict";eK(),oK(),lK(),cK(),uK(),hK(),dK(),fK(),pK(),mK(),gK(),vK(),yK(),bK(),xK(),XK(),JK(),mJ(),bJ(),EJ(),RJ(),OJ(),LJ(),BJ(),NJ(),HJ(),zJ(),jJ(),WJ(),$J(),ZJ(),QJ(),cQ(),uQ(),dQ(),fQ(),Ux(),LQ(),NQ(),UQ(),VQ(),GQ(),YQ(),ZQ(),JQ(),tee(),ree(),yee(),Eee(),_ee(),wee(),Ree(),Cee(),Pee(),Iee(),Oee(),Lee(),hte(),Tte(),Ote(),Lte(),kte(),Bte(),Hte(),Vte(),Kte(),Jte(),nre(),ore(),cre(),mre(),yre(),_re(),Tre(),cF(),wre(),Vre(),Gre(),Wre(),$re(),Kre(),Jre(),Qre(),rne(),ine(),sne(),one(),cne(),hne(),dne(),fne(),pne(),vne(),xne(),Ene(),_ne(),Dne(),Lne(),Bne(),Une(),Hne(),Vne(),zne(),Gne(),$ne(),nie(),lie(),pie(),vie(),_ie(),Tie(),Mie(),Rie(),Pie(),Iie(),Bie(),Nie(),Uie(),zie(),Gie(),qie(),Wie(),Xie(),Yie(),Zie(),Jie(),ese(),rse(),ise(),sse(),ase(),ose(),dse(),fse(),pse(),vse(),yse(),xse(),_se(),Lae(),kae(),Bae(),Vae(),zae(),Gae(),Zae(),Qae(),eoe(),ioe(),soe(),aoe(),ooe(),loe(),coe(),uoe(),moe(),voe(),yoe(),Loe(),Foe(),aR(),zoe(),qoe(),Xoe(),Koe(),Qoe(),ele(),ile(),cle(),dle(),ple(),gle(),rU(),Cle(),Ule(),Vle(),zle(),Wle(),Xle(),Qle(),ice(),oce(),fce(),gce(),yce(),_ce(),Mce(),Ice(),Fce(),Hce(),Vce(),zce(),Gce(),qce(),jce(),Wce(),Xce(),Yce(),$ce(),Zce(),Kce(),Jce(),Rue(),Cue(),Pue(),Iue(),Oue(),Due(),Lue(),kue(),Fue(),Nue(),Hue(),zue(),que(),Zue(),Jue(),ehe(),rhe(),ihe(),ahe(),ohe(),che(),hhe(),ghe(),yhe(),xhe(),_he(),whe(),Mhe(),Rhe(),Phe(),Fhe(),Nhe(),Hhe(),Whe(),$he(),ede(),tde(),rde(),ide(),sde(),ude(),Sde(),Ade(),Ude(),qde(),Kde(),rfe(),mfe(),_fe(),wfe(),kfe(),Ffe(),Nfe(),upe(),vpe(),pme(),vme(),yme(),bme(),Tme(),Ame(),Rme(),t.exports=$M()})),Ime=$(((e,t)=>{var r=function(e){"use strict";var t,r=Object.prototype,i=r.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function h(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,r){return e[t]=r}}function c(e,t,r,i){var a=t&&t.prototype instanceof v?t:v,s=Object.create(a.prototype),o=new R(i||[]);return n(s,"_invoke",{value:E(e,r,o)}),s}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d="suspendedStart",p="suspendedYield",f="executing",m="completed",g={};function v(){}function y(){}function b(){}var x={};h(x,s,(function(){return this}));var _=Object.getPrototypeOf,w=_&&_(_(I([])));w&&w!==r&&i.call(w,s)&&(x=w);var S=b.prototype=v.prototype=Object.create(x);function T(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function M(e,t){function r(n,a,s,o){var l=u(e[n],e,a);if("throw"!==l.type){var h=l.arg,c=h.value;return c&&"object"==typeof c&&i.call(c,"__await")?t.resolve(c.__await).then((function(e){r("next",e,s,o)}),(function(e){r("throw",e,s,o)})):t.resolve(c).then((function(e){h.value=e,s(h)}),(function(e){return r("throw",e,s,o)}))}o(l.arg)}var a;n(this,"_invoke",{value:function(e,i){function n(){return new t((function(t,n){r(e,i,t,n)}))}return a=a?a.then(n,n):n()}})}function E(e,t,r){var i=d;return function(n,a){if(i===f)throw new Error("Generator is already running");if(i===m){if("throw"===n)throw a;return O()}for(r.method=n,r.arg=a;;){var s=r.delegate;if(s){var o=A(s,r);if(o){if(o===g)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=f;var l=u(e,t,r);if("normal"===l.type){if(i=r.done?m:p,l.arg===g)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i=m,r.method="throw",r.arg=l.arg)}}}function A(e,r){var i=r.method,n=e.iterator[i];if(n===t)return r.delegate=null,"throw"===i&&e.iterator.return&&(r.method="return",r.arg=t,A(e,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;var a=u(n,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var s=a.arg;return s?s.done?(r[e.resultName]=s.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function I(e){if(e){var r=e[s];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function r(){for(;++n<e.length;)if(i.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}return{next:O}}function O(){return{value:t,done:!0}}return y.prototype=b,n(S,"constructor",{value:b,configurable:!0}),n(b,"constructor",{value:y,configurable:!0}),y.displayName=h(b,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,h(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},T(M.prototype),h(M.prototype,o,(function(){return this})),e.AsyncIterator=M,e.async=function(t,r,i,n,a){void 0===a&&(a=Promise);var s=new M(c(t,r,i,n),a);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},T(S),h(S,l,"Generator"),h(S,s,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var i in t)r.push(i);return r.reverse(),function e(){for(;r.length;){var i=r.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},e.values=I,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(i,n){return o.type="throw",o.arg=e,r.next=i,n&&(r.method="next",r.arg=t),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var l=i.call(s,"catchLoc"),h=i.call(s,"finallyLoc");if(l&&h){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;P(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,i){return this.delegate={iterator:I(e),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=t),g}},e}("object"==typeof t?t.exports:{});try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}})),tye=$(((e,t)=>{!function(e,r){"use strict";"function"==typeof define&&define.amd?define(r):"object"==typeof t&&t.exports?t.exports=r():e.log=r()}(e,(function(){"use strict";var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function n(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(t,r){for(var n=0;n<i.length;n++){var a=i[n];this[a]=n<t?e:this.methodFactory(a,t,r)}this.log=this.debug}function o(e,r,i){return function(){typeof console!==t&&(s.call(this,r,i),this[e].apply(this,arguments))}}function l(i,s,l){return function(i){return"debug"===i&&(i="log"),typeof console!==t&&("trace"===i&&r?a:void 0!==console[i]?n(console,i):void 0!==console.log?n(console,"log"):e)}(i)||o.apply(this,arguments)}function h(e,r,n){var a,o=this;r=null==r?"WARN":r;var h="loglevel";function c(){var e;if(typeof window!==t&&h){try{e=window.localStorage[h]}catch(e){}if(typeof e===t)try{var r=window.document.cookie,i=r.indexOf(encodeURIComponent(h)+"=");-1!==i&&(e=/^([^;]+)/.exec(r.slice(i))[1])}catch(e){}return void 0===o.levels[e]&&(e=void 0),e}}"string"==typeof e?h+=":"+e:"symbol"==typeof e&&(h=void 0),o.name=e,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=n||l,o.getLevel=function(){return a},o.setLevel=function(r,n){if("string"==typeof r&&void 0!==o.levels[r.toUpperCase()]&&(r=o.levels[r.toUpperCase()]),!("number"==typeof r&&r>=0&&r<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+r;if(a=r,!1!==n&&function(e){var r=(i[e]||"silent").toUpperCase();if(typeof window!==t&&h){try{return void(window.localStorage[h]=r)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"="+r+";"}catch(e){}}}(r),s.call(o,r,e),typeof console===t&&r<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(e){r=e,c()||o.setLevel(e,!1)},o.resetLevel=function(){o.setLevel(r,!1),function(){if(typeof window!==t&&h){try{return void window.localStorage.removeItem(h)}catch(e){}try{window.document.cookie=encodeURIComponent(h)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},o.enableAll=function(e){o.setLevel(o.levels.TRACE,e)},o.disableAll=function(e){o.setLevel(o.levels.SILENT,e)};var u=c();null==u&&(u=r),o.setLevel(u,!1)}var c=new h,u={};c.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=u[e];return t||(t=u[e]=new h(e,c.getLevel(),c.methodFactory)),t};var d=typeof window!==t?window.log:void 0;return c.noConflict=function(){return typeof window!==t&&window.log===c&&(window.log=d),c},c.getLoggers=function(){return u},c.default=c,c}))})),HP=$(((e,t)=>{"use strict";t.exports=function(e,t,i){var n=e*t,a=r*e,s=a-(a-e),o=e-s,l=r*t,h=l-(l-t),c=t-h,u=o*c-(n-s*h-o*h-s*c);return i?(i[0]=u,i[1]=n,i):[u,n]};var r=+(Math.pow(2,27)+1)})),e8=$(((e,t)=>{"use strict";t.exports=function(e,t){var r=0|e.length,i=0|t.length;if(1===r&&1===i)return function(e,t){var r=e+t,i=r-e,n=r-i,a=t-i,s=e-n,o=s+a;return o?[o,r]:[r]}(e[0],t[0]);var n,a,s=new Array(r+i),o=0,l=0,h=0,c=Math.abs,u=e[l],d=c(u),p=t[h],f=c(p);d<f?(a=u,(l+=1)<r&&(u=e[l],d=c(u))):(a=p,(h+=1)<i&&(p=t[h],f=c(p))),l<r&&d<f||h>=i?(n=u,(l+=1)<r&&(u=e[l],d=c(u))):(n=p,(h+=1)<i&&(p=t[h],f=c(p)));for(var m,g,v=n+a,y=v-n,b=a-y,x=b,_=v;l<r&&h<i;)d<f?(n=u,(l+=1)<r&&(u=e[l],d=c(u))):(n=p,(h+=1)<i&&(p=t[h],f=c(p))),(b=(a=x)-(y=(v=n+a)-n))&&(s[o++]=b),x=_-((m=_+v)-(g=m-_))+(v-g),_=m;for(;l<r;)(b=(a=x)-(y=(v=(n=u)+a)-n))&&(s[o++]=b),x=_-((m=_+v)-(g=m-_))+(v-g),_=m,(l+=1)<r&&(u=e[l]);for(;h<i;)(b=(a=x)-(y=(v=(n=p)+a)-n))&&(s[o++]=b),x=_-((m=_+v)-(g=m-_))+(v-g),_=m,(h+=1)<i&&(p=t[h]);return x&&(s[o++]=x),_&&(s[o++]=_),o||(s[o++]=0),s.length=o,s}})),Wye=$(((e,t)=>{"use strict";t.exports=function(e,t,r){var i=e+t,n=i-e,a=t-n,s=e-(i-n);return r?(r[0]=s+a,r[1]=i,r):[s+a,i]}})),r8=$(((e,t)=>{"use strict";var r=HP(),i=Wye();t.exports=function(e,t){var n=e.length;if(1===n){var a=r(e[0],t);return a[0]?a:[a[1]]}var s=new Array(2*n),o=[.1,.1],l=[.1,.1],h=0;r(e[0],t,o),o[0]&&(s[h++]=o[0]);for(var c=1;c<n;++c){r(e[c],t,l);var u=o[1];i(u,l[0],o),o[0]&&(s[h++]=o[0]);var d=l[1],p=o[1],f=d+p,m=p-(f-d);o[1]=f,m&&(s[h++]=m)}return o[1]&&(s[h++]=o[1]),0===h&&(s[h++]=0),s.length=h,s}})),$ye=$(((e,t)=>{"use strict";t.exports=function(e){for(var t=e.length,r=e[e.length-1],i=t,n=t-2;n>=0;--n){var a=r;(l=(o=e[n])-((r=a+o)-a))&&(e[--i]=r,r=l)}var s=0;for(n=i;n<t;++n){var o,l;(l=(o=r)-((r=(a=e[n])+o)-a))&&(e[s++]=l)}return e[s++]=r,e.length=s,e}})),Kye=$(((e,t)=>{"use strict";t.exports=function(e,t){var r=0|e.length,i=0|t.length;if(1===r&&1===i)return function(e,t){var r=e+t,i=r-e,n=r-i,a=t-i,s=e-n,o=s+a;return o?[o,r]:[r]}(e[0],-t[0]);var n,a,s=new Array(r+i),o=0,l=0,h=0,c=Math.abs,u=e[l],d=c(u),p=-t[h],f=c(p);d<f?(a=u,(l+=1)<r&&(u=e[l],d=c(u))):(a=p,(h+=1)<i&&(p=-t[h],f=c(p))),l<r&&d<f||h>=i?(n=u,(l+=1)<r&&(u=e[l],d=c(u))):(n=p,(h+=1)<i&&(p=-t[h],f=c(p)));for(var m,g,v=n+a,y=v-n,b=a-y,x=b,_=v;l<r&&h<i;)d<f?(n=u,(l+=1)<r&&(u=e[l],d=c(u))):(n=p,(h+=1)<i&&(p=-t[h],f=c(p))),(b=(a=x)-(y=(v=n+a)-n))&&(s[o++]=b),x=_-((m=_+v)-(g=m-_))+(v-g),_=m;for(;l<r;)(b=(a=x)-(y=(v=(n=u)+a)-n))&&(s[o++]=b),x=_-((m=_+v)-(g=m-_))+(v-g),_=m,(l+=1)<r&&(u=e[l]);for(;h<i;)(b=(a=x)-(y=(v=(n=p)+a)-n))&&(s[o++]=b),x=_-((m=_+v)-(g=m-_))+(v-g),_=m,(h+=1)<i&&(p=-t[h]);return x&&(s[o++]=x),_&&(s[o++]=_),o||(s[o++]=0),s.length=o,s}})),Qye=$(((e,t)=>{"use strict";var r=HP(),i=e8(),n=r8(),a=Kye();function s(e,t,r,i){return function(r,n,a){var s=e(e(t(n[1],a[0]),t(-a[1],n[0])),e(t(r[1],n[0]),t(-n[1],r[0]))),o=e(t(r[1],a[0]),t(-a[1],r[0])),l=i(s,o);return l[l.length-1]}}function o(e,t,r,i){return function(n,a,s,o){var l=e(e(r(e(t(s[1],o[0]),t(-o[1],s[0])),a[2]),e(r(e(t(a[1],o[0]),t(-o[1],a[0])),-s[2]),r(e(t(a[1],s[0]),t(-s[1],a[0])),o[2]))),e(r(e(t(a[1],o[0]),t(-o[1],a[0])),n[2]),e(r(e(t(n[1],o[0]),t(-o[1],n[0])),-a[2]),r(e(t(n[1],a[0]),t(-a[1],n[0])),o[2])))),h=e(e(r(e(t(s[1],o[0]),t(-o[1],s[0])),n[2]),e(r(e(t(n[1],o[0]),t(-o[1],n[0])),-s[2]),r(e(t(n[1],s[0]),t(-s[1],n[0])),o[2]))),e(r(e(t(a[1],s[0]),t(-s[1],a[0])),n[2]),e(r(e(t(n[1],s[0]),t(-s[1],n[0])),-a[2]),r(e(t(n[1],a[0]),t(-a[1],n[0])),s[2])))),c=i(l,h);return c[c.length-1]}}function l(e,t,r,i){return function(n,a,s,o,l){var h=e(e(e(r(e(r(e(t(o[1],l[0]),t(-l[1],o[0])),s[2]),e(r(e(t(s[1],l[0]),t(-l[1],s[0])),-o[2]),r(e(t(s[1],o[0]),t(-o[1],s[0])),l[2]))),a[3]),e(r(e(r(e(t(o[1],l[0]),t(-l[1],o[0])),a[2]),e(r(e(t(a[1],l[0]),t(-l[1],a[0])),-o[2]),r(e(t(a[1],o[0]),t(-o[1],a[0])),l[2]))),-s[3]),r(e(r(e(t(s[1],l[0]),t(-l[1],s[0])),a[2]),e(r(e(t(a[1],l[0]),t(-l[1],a[0])),-s[2]),r(e(t(a[1],s[0]),t(-s[1],a[0])),l[2]))),o[3]))),e(r(e(r(e(t(s[1],o[0]),t(-o[1],s[0])),a[2]),e(r(e(t(a[1],o[0]),t(-o[1],a[0])),-s[2]),r(e(t(a[1],s[0]),t(-s[1],a[0])),o[2]))),-l[3]),e(r(e(r(e(t(o[1],l[0]),t(-l[1],o[0])),a[2]),e(r(e(t(a[1],l[0]),t(-l[1],a[0])),-o[2]),r(e(t(a[1],o[0]),t(-o[1],a[0])),l[2]))),n[3]),r(e(r(e(t(o[1],l[0]),t(-l[1],o[0])),n[2]),e(r(e(t(n[1],l[0]),t(-l[1],n[0])),-o[2]),r(e(t(n[1],o[0]),t(-o[1],n[0])),l[2]))),-a[3])))),e(e(r(e(r(e(t(a[1],l[0]),t(-l[1],a[0])),n[2]),e(r(e(t(n[1],l[0]),t(-l[1],n[0])),-a[2]),r(e(t(n[1],a[0]),t(-a[1],n[0])),l[2]))),o[3]),e(r(e(r(e(t(a[1],o[0]),t(-o[1],a[0])),n[2]),e(r(e(t(n[1],o[0]),t(-o[1],n[0])),-a[2]),r(e(t(n[1],a[0]),t(-a[1],n[0])),o[2]))),-l[3]),r(e(r(e(t(s[1],o[0]),t(-o[1],s[0])),a[2]),e(r(e(t(a[1],o[0]),t(-o[1],a[0])),-s[2]),r(e(t(a[1],s[0]),t(-s[1],a[0])),o[2]))),n[3]))),e(r(e(r(e(t(s[1],o[0]),t(-o[1],s[0])),n[2]),e(r(e(t(n[1],o[0]),t(-o[1],n[0])),-s[2]),r(e(t(n[1],s[0]),t(-s[1],n[0])),o[2]))),-a[3]),e(r(e(r(e(t(a[1],o[0]),t(-o[1],a[0])),n[2]),e(r(e(t(n[1],o[0]),t(-o[1],n[0])),-a[2]),r(e(t(n[1],a[0]),t(-a[1],n[0])),o[2]))),s[3]),r(e(r(e(t(a[1],s[0]),t(-s[1],a[0])),n[2]),e(r(e(t(n[1],s[0]),t(-s[1],n[0])),-a[2]),r(e(t(n[1],a[0]),t(-a[1],n[0])),s[2]))),-o[3]))))),c=e(e(e(r(e(r(e(t(o[1],l[0]),t(-l[1],o[0])),s[2]),e(r(e(t(s[1],l[0]),t(-l[1],s[0])),-o[2]),r(e(t(s[1],o[0]),t(-o[1],s[0])),l[2]))),n[3]),r(e(r(e(t(o[1],l[0]),t(-l[1],o[0])),n[2]),e(r(e(t(n[1],l[0]),t(-l[1],n[0])),-o[2]),r(e(t(n[1],o[0]),t(-o[1],n[0])),l[2]))),-s[3])),e(r(e(r(e(t(s[1],l[0]),t(-l[1],s[0])),n[2]),e(r(e(t(n[1],l[0]),t(-l[1],n[0])),-s[2]),r(e(t(n[1],s[0]),t(-s[1],n[0])),l[2]))),o[3]),r(e(r(e(t(s[1],o[0]),t(-o[1],s[0])),n[2]),e(r(e(t(n[1],o[0]),t(-o[1],n[0])),-s[2]),r(e(t(n[1],s[0]),t(-s[1],n[0])),o[2]))),-l[3]))),e(e(r(e(r(e(t(s[1],l[0]),t(-l[1],s[0])),a[2]),e(r(e(t(a[1],l[0]),t(-l[1],a[0])),-s[2]),r(e(t(a[1],s[0]),t(-s[1],a[0])),l[2]))),n[3]),r(e(r(e(t(s[1],l[0]),t(-l[1],s[0])),n[2]),e(r(e(t(n[1],l[0]),t(-l[1],n[0])),-s[2]),r(e(t(n[1],s[0]),t(-s[1],n[0])),l[2]))),-a[3])),e(r(e(r(e(t(a[1],l[0]),t(-l[1],a[0])),n[2]),e(r(e(t(n[1],l[0]),t(-l[1],n[0])),-a[2]),r(e(t(n[1],a[0]),t(-a[1],n[0])),l[2]))),s[3]),r(e(r(e(t(a[1],s[0]),t(-s[1],a[0])),n[2]),e(r(e(t(n[1],s[0]),t(-s[1],n[0])),-a[2]),r(e(t(n[1],a[0]),t(-a[1],n[0])),s[2]))),-l[3])))),u=i(h,c);return u[u.length-1]}}function h(e){return(3===e?s:4===e?o:l)(i,r,n,a)}var c=h(3),u=h(4),d=[function(){return 0},function(){return 0},function(e,t){return t[0]-e[0]},function(e,t,r){var i,n=(e[1]-r[1])*(t[0]-r[0]),a=(e[0]-r[0])*(t[1]-r[1]),s=n-a;if(n>0){if(a<=0)return s;i=n+a}else{if(!(n<0))return s;if(a>=0)return s;i=-(n+a)}var o=33306690738754716e-32*i;return s>=o||s<=-o?s:c(e,t,r)},function(e,t,r,i){var n=e[0]-i[0],a=t[0]-i[0],s=r[0]-i[0],o=e[1]-i[1],l=t[1]-i[1],h=r[1]-i[1],c=e[2]-i[2],d=t[2]-i[2],p=r[2]-i[2],f=a*h,m=s*l,g=s*o,v=n*h,y=n*l,b=a*o,x=c*(f-m)+d*(g-v)+p*(y-b),_=7771561172376103e-31*((Math.abs(f)+Math.abs(m))*Math.abs(c)+(Math.abs(g)+Math.abs(v))*Math.abs(d)+(Math.abs(y)+Math.abs(b))*Math.abs(p));return x>_||-x>_?x:u(e,t,r,i)}];function p(e){var t=d[e.length];return t||(t=d[e.length]=h(e.length)),t.apply(void 0,e)}function f(e,t,r,i,n,a,s){return function(t,r,o,l,h){switch(arguments.length){case 0:case 1:return 0;case 2:return i(t,r);case 3:return n(t,r,o);case 4:return a(t,r,o,l);case 5:return s(t,r,o,l,h)}for(var c=new Array(arguments.length),u=0;u<arguments.length;++u)c[u]=arguments[u];return e(c)}}!function(){for(;d.length<=5;)d.push(h(d.length));t.exports=f.apply(void 0,[p].concat(d));for(var e=0;e<=5;++e)t.exports[e]=d[e]}()})),t1e=$(((e,t)=>{"use strict";t.exports=function(e,t,i,n){var a=r(e,i,n),s=r(t,i,n);if(a>0&&s>0||a<0&&s<0)return!1;var o=r(i,e,t),l=r(n,e,t);return!(o>0&&l>0||o<0&&l<0)&&(0!==a||0!==s||0!==o||0!==l||function(e,t,r,i){for(var n=0;n<2;++n){var a=e[n],s=t[n],o=Math.min(a,s),l=Math.max(a,s),h=r[n],c=i[n],u=Math.min(h,c);if(Math.max(h,c)<o||l<u)return!1}return!0}(e,t,i,n))};var r=Qye()[3]})),n1e=$(((e,t)=>{"use strict";t.exports=function(e,t,o,l){if(!s(e,t,o,l))return[[0],[0],[0]];var h=i([o[1]],[-l[1]]),c=i([-o[0]],[l[0]]),u=i(i(n(c,e[1]),n(c,-t[1])),i(n(h,e[0]),n(h,-t[0]))),d=i(r(-e[0],t[1]),r(e[1],t[0])),p=i(r(-o[0],l[1]),r(o[1],l[0])),f=i(i(n(p,e[0]),n(p,-t[0])),i(n(d,-o[0]),n(d,l[0]))),m=i(i(n(p,e[1]),n(p,-t[1])),i(n(d,-o[1]),n(d,l[1])));return[a(f),a(m),a(u)]};var r=HP(),i=e8(),n=r8(),a=$ye(),s=t1e()})),s1e=$(((e,t)=>{t.exports=function(e){var t=0,r=e.length;switch(r){case 1:t=e[0];break;case 2:t=e[0]+e[1];break;case 3:t=e[0]+e[1]+e[2];break;case 4:t=e[0]+e[1]+e[2]+e[3];break;default:for(var i=0;i<r;i++)t+=e[i]}return t}})),o1e=$(((e,t)=>{var r=n1e(),i=s1e();function n(e,t){return e[0]===t[0]&&e[1]===t[1]}t.exports=function(e,t){for(var c={},u=e.length,d=[],p=0;p<u;p++){var f=e[p],m=e[(p+1)%u];h(f,o),h(m,l);for(var g=0;g<u;g++)if(p!==g){var v=e[g],y=e[(g+1)%u];if(h(v,a),h(y,s),!(n(a,o)||n(a,l)||n(s,o)||n(s,l))){var b=r(o,l,a,s),x=b[2];if(1!==x.length||x[0]){var _=i(b[2]);if(b[0]=i(b[0])/_,b[1]=i(b[1])/_,b.pop(),!(n(b,o)||n(b,l)||n(b,a)||n(b,s))){var w=b+"",S=!c[w];S&&(c[w]=!0);var T=S;t&&(T=t(b,p,f,m,g,v,y,S)),T&&d.push(b)}}}}}return d};var a=[0,0],s=[0,0],o=[0,0],l=[0,0];function h(e,t){Array.isArray(e)?(t[0]=e[0],t[1]=e[1]):(t[0]=e.x,t[1]=e.y)}})),y3=$((()=>{})),Hxe=$(((e,t)=>{var r,i;r=e,i=function(){"use strict";var e=Math.imul,t=Math.clz32;function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r,i=0;i<t.length;i++)(r=t[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}function n(e){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function o(){return(o=s()?Reflect.construct:function(e,t,r){var i=[null];i.push.apply(i,t);var n=new(Function.bind.apply(e,i));return r&&a(n,r.prototype),n}).apply(null,arguments)}function l(e){var t="function"==typeof Map?new Map:void 0;return l=function(e){function r(){return o(e,arguments,n(this).constructor)}if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),a(r,e)},l(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){var t=s();return function(){var r,i=n(e);if(t){var a=n(this).constructor;r=Reflect.construct(i,arguments,a)}else r=i.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}(this,r)}}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var i,n,a=[],s=!0,o=!1;try{for(r=r.call(e);!(s=(i=r.next()).done)&&(a.push(i.value),!t||a.length!==t);s=!0);}catch(e){o=!0,n=e}finally{try{s||null==r.return||r.return()}finally{if(o)throw n}}return a}}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(e,t):void 0}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}var f=function(e){var t=Math.abs,n=Math.max,s=Math.floor;function o(e,t){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(r=l.call(this,e)).sign=t,Object.setPrototypeOf(h(r),o.prototype),e>o.__kMaxLength)throw new RangeError("Maximum BigInt size exceeded");return r}!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(o,e);var l=c(o);return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1})}(o,[{key:"toDebugString",value:function(){var e,t=["BigInt["],r=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=d(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}(this);try{for(r.s();!(e=r.n()).done;){var i=e.value;t.push((i&&(i>>>0).toString(16))+", ")}}catch(e){r.e(e)}finally{r.f()}return t.push("]"),t.join("")}},{key:"toString",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10;if(2>e||36<e)throw new RangeError("toString() radix argument must be between 2 and 36");return 0===this.length?"0":e&e-1?o.__toStringGeneric(this,e,!1):o.__toStringBasePowerOfTwo(this,e)}},{key:"valueOf",value:function(){throw new Error("Convert JSBI instances to native numbers using `toNumber`.")}},{key:"__copy",value:function(){for(var e=new o(this.length,this.sign),t=0;t<this.length;t++)e[t]=this[t];return e}},{key:"__trim",value:function(){for(var e=this.length,t=this[e-1];0===t;)t=this[--e-1],this.pop();return 0===e&&(this.sign=!1),this}},{key:"__initializeDigits",value:function(){for(var e=0;e<this.length;e++)this[e]=0}},{key:"__clzmsd",value:function(){return o.__clz30(this.__digit(this.length-1))}},{key:"__inplaceMultiplyAdd",value:function(e,t,r){r>this.length&&(r=this.length);for(var i=32767&e,n=e>>>15,a=0,s=t,l=0;l<r;l++){var h=this.__digit(l),c=32767&h,u=h>>>15,d=o.__imul(c,i),p=o.__imul(c,n),f=o.__imul(u,i),m=s+d+a;a=m>>>30,m&=1073741823,a+=(m+=((32767&p)<<15)+((32767&f)<<15))>>>30,s=o.__imul(u,n)+(p>>>15)+(f>>>15),this.__setDigit(l,1073741823&m)}if(0!==a||0!==s)throw new Error("implementation bug")}},{key:"__inplaceAdd",value:function(e,t,r){for(var i,n=0,a=0;a<r;a++)n=(i=this.__halfDigit(t+a)+e.__halfDigit(a)+n)>>>15,this.__setHalfDigit(t+a,32767&i);return n}},{key:"__inplaceSub",value:function(e,t,r){var i=0;if(1&t){t>>=1;for(var n=this.__digit(t),a=32767&n,s=0;s<r-1>>>1;s++){var o=e.__digit(s),l=(n>>>15)-(32767&o)-i;i=1&l>>>15,this.__setDigit(t+s,(32767&l)<<15|32767&a),i=1&(a=(32767&(n=this.__digit(t+s+1)))-(o>>>15)-i)>>>15}var h=e.__digit(s),c=(n>>>15)-(32767&h)-i;if(i=1&c>>>15,this.__setDigit(t+s,(32767&c)<<15|32767&a),t+s+1>=this.length)throw new RangeError("out of bounds");!(1&r)&&(i=1&(a=(32767&(n=this.__digit(t+s+1)))-(h>>>15)-i)>>>15,this.__setDigit(t+e.length,1073709056&n|32767&a))}else{t>>=1;for(var u=0;u<e.length-1;u++){var d=this.__digit(t+u),p=e.__digit(u),f=(32767&d)-(32767&p)-i,m=(d>>>15)-(p>>>15)-(i=1&f>>>15);i=1&m>>>15,this.__setDigit(t+u,(32767&m)<<15|32767&f)}var g=this.__digit(t+u),v=e.__digit(u),y=(32767&g)-(32767&v)-i;i=1&y>>>15;var b=0;!(1&r)&&(i=1&(b=(g>>>15)-(v>>>15)-i)>>>15),this.__setDigit(t+u,(32767&b)<<15|32767&y)}return i}},{key:"__inplaceRightShift",value:function(e){if(0!==e){for(var t,r=this.__digit(0)>>>e,i=this.length-1,n=0;n<i;n++)t=this.__digit(n+1),this.__setDigit(n,1073741823&t<<30-e|r),r=t>>>e;this.__setDigit(i,r)}}},{key:"__digit",value:function(e){return this[e]}},{key:"__unsignedDigit",value:function(e){return this[e]>>>0}},{key:"__setDigit",value:function(e,t){this[e]=0|t}},{key:"__setDigitGrow",value:function(e,t){this[e]=0|t}},{key:"__halfDigitLength",value:function(){var e=this.length;return 32767>=this.__unsignedDigit(e-1)?2*e-1:2*e}},{key:"__halfDigit",value:function(e){return 32767&this[e>>>1]>>>15*(1&e)}},{key:"__setHalfDigit",value:function(e,t){var r=e>>>1,i=this.__digit(r),n=1&e?32767&i|t<<15:1073709056&i|32767&t;this.__setDigit(r,n)}}],[{key:"BigInt",value:function(e){var t=Number.isFinite;if("number"==typeof e){if(0===e)return o.__zero();if(o.__isOneDigitInt(e))return 0>e?o.__oneDigit(-e,!0):o.__oneDigit(e,!1);if(!t(e)||s(e)!==e)throw new RangeError("The number "+e+" cannot be converted to BigInt because it is not an integer");return o.__fromDouble(e)}if("string"==typeof e){var i=o.__fromString(e);if(null===i)throw new SyntaxError("Cannot convert "+e+" to a BigInt");return i}if("boolean"==typeof e)return!0===e?o.__oneDigit(1,!1):o.__zero();if("object"===r(e)){if(e.constructor===o)return e;var n=o.__toPrimitive(e);return o.BigInt(n)}throw new TypeError("Cannot convert "+e+" to a BigInt")}},{key:"toNumber",value:function(e){var t=e.length;if(0===t)return 0;if(1===t){var r=e.__unsignedDigit(0);return e.sign?-r:r}var i=e.__digit(t-1),n=o.__clz30(i),a=30*t-n;if(1024<a)return e.sign?-1/0:1/0;var s=a-1,l=i,h=t-1,c=n+3,u=32===c?0:l<<c;u>>>=12;var d=c-12,p=12<=c?0:l<<20+c,f=20+c;for(0<d&&0<h&&(h--,u|=(l=e.__digit(h))>>>30-d,p=l<<d+2,f=d+2);0<f&&0<h;)h--,l=e.__digit(h),p|=30<=f?l<<f-30:l>>>30-f,f-=30;var m=o.__decideRounding(e,f,h,l);if((1===m||0===m&&1==(1&p))&&0==(p=p+1>>>0)&&++u>>>20!=0&&(u=0,1023<++s))return e.sign?-1/0:1/0;var g=e.sign?-2147483648:0;return s=s+1023<<20,o.__kBitConversionInts[1]=g|s|u,o.__kBitConversionInts[0]=p,o.__kBitConversionDouble[0]}},{key:"unaryMinus",value:function(e){if(0===e.length)return e;var t=e.__copy();return t.sign=!e.sign,t}},{key:"bitwiseNot",value:function(e){return e.sign?o.__absoluteSubOne(e).__trim():o.__absoluteAddOne(e,!0)}},{key:"exponentiate",value:function(e,t){if(t.sign)throw new RangeError("Exponent must be positive");if(0===t.length)return o.__oneDigit(1,!1);if(0===e.length)return e;if(1===e.length&&1===e.__digit(0))return!e.sign||1&t.__digit(0)?e:o.unaryMinus(e);if(1<t.length)throw new RangeError("BigInt too big");var r=t.__unsignedDigit(0);if(1===r)return e;if(r>=o.__kMaxLengthBits)throw new RangeError("BigInt too big");if(1===e.length&&2===e.__digit(0)){var i=1+(0|r/30),n=new o(i,e.sign&&0!=(1&r));n.__initializeDigits();var a=1<<r%30;return n.__setDigit(i-1,a),n}var s=null,l=e;for(1&r&&(s=e),r>>=1;0!==r;r>>=1)l=o.multiply(l,l),1&r&&(s=null===s?l:o.multiply(s,l));return s}},{key:"multiply",value:function(e,t){if(0===e.length)return e;if(0===t.length)return t;var r=e.length+t.length;30<=e.__clzmsd()+t.__clzmsd()&&r--;var i=new o(r,e.sign!==t.sign);i.__initializeDigits();for(var n=0;n<e.length;n++)o.__multiplyAccumulate(t,e.__digit(n),i,n);return i.__trim()}},{key:"divide",value:function(e,t){if(0===t.length)throw new RangeError("Division by zero");if(0>o.__absoluteCompare(e,t))return o.__zero();var r,i=e.sign!==t.sign,n=t.__unsignedDigit(0);if(1===t.length&&32767>=n){if(1===n)return i===e.sign?e:o.unaryMinus(e);r=o.__absoluteDivSmall(e,n,null)}else r=o.__absoluteDivLarge(e,t,!0,!1);return r.sign=i,r.__trim()}},{key:"remainder",value:function(e,t){if(0===t.length)throw new RangeError("Division by zero");if(0>o.__absoluteCompare(e,t))return e;var r=t.__unsignedDigit(0);if(1===t.length&&32767>=r){if(1===r)return o.__zero();var i=o.__absoluteModSmall(e,r);return 0===i?o.__zero():o.__oneDigit(i,e.sign)}var n=o.__absoluteDivLarge(e,t,!1,!0);return n.sign=e.sign,n.__trim()}},{key:"add",value:function(e,t){var r=e.sign;return r===t.sign?o.__absoluteAdd(e,t,r):0<=o.__absoluteCompare(e,t)?o.__absoluteSub(e,t,r):o.__absoluteSub(t,e,!r)}},{key:"subtract",value:function(e,t){var r=e.sign;return r===t.sign?0<=o.__absoluteCompare(e,t)?o.__absoluteSub(e,t,r):o.__absoluteSub(t,e,!r):o.__absoluteAdd(e,t,r)}},{key:"leftShift",value:function(e,t){return 0===t.length||0===e.length?e:t.sign?o.__rightShiftByAbsolute(e,t):o.__leftShiftByAbsolute(e,t)}},{key:"signedRightShift",value:function(e,t){return 0===t.length||0===e.length?e:t.sign?o.__leftShiftByAbsolute(e,t):o.__rightShiftByAbsolute(e,t)}},{key:"unsignedRightShift",value:function(){throw new TypeError("BigInts have no unsigned right shift; use >> instead")}},{key:"lessThan",value:function(e,t){return 0>o.__compareToBigInt(e,t)}},{key:"lessThanOrEqual",value:function(e,t){return 0>=o.__compareToBigInt(e,t)}},{key:"greaterThan",value:function(e,t){return 0<o.__compareToBigInt(e,t)}},{key:"greaterThanOrEqual",value:function(e,t){return 0<=o.__compareToBigInt(e,t)}},{key:"equal",value:function(e,t){if(e.sign!==t.sign||e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e.__digit(r)!==t.__digit(r))return!1;return!0}},{key:"notEqual",value:function(e,t){return!o.equal(e,t)}},{key:"bitwiseAnd",value:function(e,t){if(!e.sign&&!t.sign)return o.__absoluteAnd(e,t).__trim();if(e.sign&&t.sign){var r=n(e.length,t.length)+1,i=o.__absoluteSubOne(e,r),a=o.__absoluteSubOne(t);return i=o.__absoluteOr(i,a,i),o.__absoluteAddOne(i,!0,i).__trim()}if(e.sign){var s=[t,e];e=s[0],t=s[1]}return o.__absoluteAndNot(e,o.__absoluteSubOne(t)).__trim()}},{key:"bitwiseXor",value:function(e,t){if(!e.sign&&!t.sign)return o.__absoluteXor(e,t).__trim();if(e.sign&&t.sign){var r=n(e.length,t.length),i=o.__absoluteSubOne(e,r),a=o.__absoluteSubOne(t);return o.__absoluteXor(i,a,i).__trim()}var s=n(e.length,t.length)+1;if(e.sign){var l=[t,e];e=l[0],t=l[1]}var h=o.__absoluteSubOne(t,s);return h=o.__absoluteXor(h,e,h),o.__absoluteAddOne(h,!0,h).__trim()}},{key:"bitwiseOr",value:function(e,t){var r=n(e.length,t.length);if(!e.sign&&!t.sign)return o.__absoluteOr(e,t).__trim();if(e.sign&&t.sign){var i=o.__absoluteSubOne(e,r),a=o.__absoluteSubOne(t);return i=o.__absoluteAnd(i,a,i),o.__absoluteAddOne(i,!0,i).__trim()}if(e.sign){var s=[t,e];e=s[0],t=s[1]}var l=o.__absoluteSubOne(t,r);return l=o.__absoluteAndNot(l,e,l),o.__absoluteAddOne(l,!0,l).__trim()}},{key:"asIntN",value:function(e,t){if(0===t.length)return t;if(0>(e=s(e)))throw new RangeError("Invalid value: not (convertible to) a safe integer");if(0===e)return o.__zero();if(e>=o.__kMaxLengthBits)return t;var r=0|(e+29)/30;if(t.length<r)return t;var i=t.__unsignedDigit(r-1),n=1<<(e-1)%30;if(t.length===r&&i<n)return t;if((i&n)!==n)return o.__truncateToNBits(e,t);if(!t.sign)return o.__truncateAndSubFromPowerOfTwo(e,t,!0);if(!(i&n-1)){for(var a=r-2;0<=a;a--)if(0!==t.__digit(a))return o.__truncateAndSubFromPowerOfTwo(e,t,!1);return t.length===r&&i===n?t:o.__truncateToNBits(e,t)}return o.__truncateAndSubFromPowerOfTwo(e,t,!1)}},{key:"asUintN",value:function(e,t){if(0===t.length)return t;if(0>(e=s(e)))throw new RangeError("Invalid value: not (convertible to) a safe integer");if(0===e)return o.__zero();if(t.sign){if(e>o.__kMaxLengthBits)throw new RangeError("BigInt too big");return o.__truncateAndSubFromPowerOfTwo(e,t,!1)}if(e>=o.__kMaxLengthBits)return t;var r=0|(e+29)/30;if(t.length<r)return t;var i=e%30;if(t.length==r){if(0===i)return t;if(!(t.__digit(r-1)>>>i))return t}return o.__truncateToNBits(e,t)}},{key:"ADD",value:function(e,t){if(e=o.__toPrimitive(e),t=o.__toPrimitive(t),"string"==typeof e)return"string"!=typeof t&&(t=t.toString()),e+t;if("string"==typeof t)return e.toString()+t;if(e=o.__toNumeric(e),t=o.__toNumeric(t),o.__isBigInt(e)&&o.__isBigInt(t))return o.add(e,t);if("number"==typeof e&&"number"==typeof t)return e+t;throw new TypeError("Cannot mix BigInt and other types, use explicit conversions")}},{key:"LT",value:function(e,t){return o.__compare(e,t,0)}},{key:"LE",value:function(e,t){return o.__compare(e,t,1)}},{key:"GT",value:function(e,t){return o.__compare(e,t,2)}},{key:"GE",value:function(e,t){return o.__compare(e,t,3)}},{key:"EQ",value:function(e,t){for(;;){if(o.__isBigInt(e))return o.__isBigInt(t)?o.equal(e,t):o.EQ(t,e);if("number"==typeof e){if(o.__isBigInt(t))return o.__equalToNumber(t,e);if("object"!==r(t))return e==t;t=o.__toPrimitive(t)}else if("string"==typeof e){if(o.__isBigInt(t))return null!==(e=o.__fromString(e))&&o.equal(e,t);if("object"!==r(t))return e==t;t=o.__toPrimitive(t)}else if("boolean"==typeof e){if(o.__isBigInt(t))return o.__equalToNumber(t,+e);if("object"!==r(t))return e==t;t=o.__toPrimitive(t)}else if("symbol"===r(e)){if(o.__isBigInt(t))return!1;if("object"!==r(t))return e==t;t=o.__toPrimitive(t)}else{if("object"!==r(e))return e==t;if("object"===r(t)&&t.constructor!==o)return e==t;e=o.__toPrimitive(e)}}}},{key:"NE",value:function(e,t){return!o.EQ(e,t)}},{key:"DataViewGetBigInt64",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return o.asIntN(64,o.DataViewGetBigUint64(e,t,r))}},{key:"DataViewGetBigUint64",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=u(r?[4,0]:[0,4],2),n=i[0],a=i[1],s=e.getUint32(t+n,r),l=e.getUint32(t+a,r),h=new o(3,!1);return h.__setDigit(0,1073741823&l),h.__setDigit(1,(268435455&s)<<2|l>>>30),h.__setDigit(2,s>>>28),h.__trim()}},{key:"DataViewSetBigInt64",value:function(e,t,r){var i=3<arguments.length&&void 0!==arguments[3]&&arguments[3];o.DataViewSetBigUint64(e,t,r,i)}},{key:"DataViewSetBigUint64",value:function(e,t,r){var i=3<arguments.length&&void 0!==arguments[3]&&arguments[3],n=0,a=0;if(0<(r=o.asUintN(64,r)).length&&(a=r.__digit(0),1<r.length)){var s=r.__digit(1);a|=s<<30,n=s>>>2,2<r.length&&(n|=r.__digit(2)<<28)}var l=u(i?[4,0]:[0,4],2),h=l[0],c=l[1];e.setUint32(t+h,n,i),e.setUint32(t+c,a,i)}},{key:"__zero",value:function(){return new o(0,!1)}},{key:"__oneDigit",value:function(e,t){var r=new o(1,t);return r.__setDigit(0,e),r}},{key:"__decideRounding",value:function(e,t,r,i){if(0<t)return-1;var n;if(0>t)n=-t-1;else{if(0===r)return-1;r--,i=e.__digit(r),n=29}var a=1<<n;if(!(i&a))return-1;if(0!=(i&(a-=1)))return 1;for(;0<r;)if(r--,0!==e.__digit(r))return 1;return 0}},{key:"__fromDouble",value:function(e){o.__kBitConversionDouble[0]=e;var t,r=(2047&o.__kBitConversionInts[1]>>>20)-1023,i=1+(0|r/30),n=new o(i,0>e),a=1048575&o.__kBitConversionInts[1]|1048576,s=o.__kBitConversionInts[0],l=r%30,h=0;if(l<20){var c=20-l;h=c+32,t=a>>>c,a=a<<32-c|s>>>c,s<<=32-c}else if(20===l)h=32,t=a,a=s,s=0;else{var u=l-20;h=32-u,t=a<<u|s>>>32-u,a=s<<u,s=0}n.__setDigit(i-1,t);for(var d=i-2;0<=d;d--)0<h?(h-=30,t=a>>>2,a=a<<30|s>>>2,s<<=30):t=0,n.__setDigit(d,t);return n.__trim()}},{key:"__isWhitespace",value:function(e){return 13>=e&&9<=e||(159>=e?32==e:131071>=e?160==e||5760==e:196607>=e?10>=(e&=131071)||40==e||41==e||47==e||95==e||4096==e:65279==e)}},{key:"__fromString",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=0,i=e.length,n=0;if(n===i)return o.__zero();for(var a=e.charCodeAt(n);o.__isWhitespace(a);){if(++n===i)return o.__zero();a=e.charCodeAt(n)}if(43===a){if(++n===i)return null;a=e.charCodeAt(n),r=1}else if(45===a){if(++n===i)return null;a=e.charCodeAt(n),r=-1}if(0===t){if(t=10,48===a){if(++n===i)return o.__zero();if(88===(a=e.charCodeAt(n))||120===a){if(t=16,++n===i)return null;a=e.charCodeAt(n)}else if(79===a||111===a){if(t=8,++n===i)return null;a=e.charCodeAt(n)}else if(66===a||98===a){if(t=2,++n===i)return null;a=e.charCodeAt(n)}}}else if(16===t&&48===a){if(++n===i)return o.__zero();if(88===(a=e.charCodeAt(n))||120===a){if(++n===i)return null;a=e.charCodeAt(n)}}if(0!==r&&10!==t)return null;for(;48===a;){if(++n===i)return o.__zero();a=e.charCodeAt(n)}var s=i-n,l=o.__kMaxBitsPerChar[t],h=o.__kBitsPerCharTableMultiplier-1;if(s>1073741824/l)return null;var c=new o(0|(29+(l*s+h>>>o.__kBitsPerCharTableShift))/30,!1),u=10>t?t:10,d=10<t?t-10:0;if(t&t-1){c.__initializeDigits();var p=!1,f=0;do{for(var m,g=0,v=1;;){if(m=void 0,a-48>>>0<u)m=a-48;else{if(!((32|a)-97>>>0<d)){p=!0;break}m=(32|a)-87}var y=v*t;if(1073741823<y)break;if(v=y,g=g*t+m,f++,++n===i){p=!0;break}a=e.charCodeAt(n)}var b=0|(l*f+(h=30*o.__kBitsPerCharTableMultiplier-1)>>>o.__kBitsPerCharTableShift)/30;c.__inplaceMultiplyAdd(v,g,b)}while(!p)}else{l>>=o.__kBitsPerCharTableShift;var x=[],_=[],w=!1;do{for(var S,T=0,M=0;;){if(S=void 0,a-48>>>0<u)S=a-48;else{if(!((32|a)-97>>>0<d)){w=!0;break}S=(32|a)-87}if(M+=l,T=T<<l|S,++n===i){w=!0;break}if(a=e.charCodeAt(n),30<M+l)break}x.push(T),_.push(M)}while(!w);o.__fillFromParts(c,x,_)}if(n!==i){if(!o.__isWhitespace(a))return null;for(n++;n<i;n++)if(a=e.charCodeAt(n),!o.__isWhitespace(a))return null}return c.sign=-1===r,c.__trim()}},{key:"__fillFromParts",value:function(e,t,r){for(var i=0,n=0,a=0,s=t.length-1;0<=s;s--){var o=t[s],l=r[s];n|=o<<a,30===(a+=l)?(e.__setDigit(i++,n),a=0,n=0):30<a&&(e.__setDigit(i++,1073741823&n),n=o>>>l-(a-=30))}if(0!==n){if(i>=e.length)throw new Error("implementation bug");e.__setDigit(i++,n)}for(;i<e.length;i++)e.__setDigit(i,0)}},{key:"__toStringBasePowerOfTwo",value:function(e,t){var r=e.length,i=t-1,n=i=(15&(i=(51&(i=(85&i>>>1)+(85&i))>>>2)+(51&i))>>>4)+(15&i),a=t-1,s=e.__digit(r-1),l=0|(30*r-o.__clz30(s)+n-1)/n;if(e.sign&&l++,268435456<l)throw new Error("string too long");for(var h=Array(l),c=l-1,u=0,d=0,p=0;p<r-1;p++){var f=e.__digit(p),m=(u|f<<d)&a;h[c--]=o.__kConversionChars[m];var g=n-d;for(u=f>>>g,d=30-g;d>=n;)h[c--]=o.__kConversionChars[u&a],u>>>=n,d-=n}var v=(u|s<<d)&a;for(h[c--]=o.__kConversionChars[v],u=s>>>n-d;0!==u;)h[c--]=o.__kConversionChars[u&a],u>>>=n;if(e.sign&&(h[c--]="-"),-1!==c)throw new Error("implementation bug");return h.join("")}},{key:"__toStringGeneric",value:function(e,t,r){var i=e.length;if(0===i)return"";if(1===i){var n=e.__unsignedDigit(0).toString(t);return!1===r&&e.sign&&(n="-"+n),n}var a,s,l=30*i-o.__clz30(e.__digit(i-1)),h=o.__kMaxBitsPerChar[t]-1,c=l*o.__kBitsPerCharTableMultiplier,u=1+(c=0|(c+=h-1)/h)>>1,d=o.exponentiate(o.__oneDigit(t,!1),o.__oneDigit(u,!1)),p=d.__unsignedDigit(0);if(1===d.length&&32767>=p){(a=new o(e.length,!1)).__initializeDigits();for(var f,m=0,g=2*e.length-1;0<=g;g--)f=m<<15|e.__halfDigit(g),a.__setHalfDigit(g,0|f/p),m=0|f%p;s=m.toString(t)}else{var v=o.__absoluteDivLarge(e,d,!0,!0);a=v.quotient;var y=v.remainder.__trim();s=o.__toStringGeneric(y,t,!0)}a.__trim();for(var b=o.__toStringGeneric(a,t,!0);s.length<u;)s="0"+s;return!1===r&&e.sign&&(b="-"+b),b+s}},{key:"__unequalSign",value:function(e){return e?-1:1}},{key:"__absoluteGreater",value:function(e){return e?-1:1}},{key:"__absoluteLess",value:function(e){return e?1:-1}},{key:"__compareToBigInt",value:function(e,t){var r=e.sign;if(r!==t.sign)return o.__unequalSign(r);var i=o.__absoluteCompare(e,t);return 0<i?o.__absoluteGreater(r):0>i?o.__absoluteLess(r):0}},{key:"__compareToNumber",value:function(e,r){if(o.__isOneDigitInt(r)){var i=e.sign,n=0>r;if(i!==n)return o.__unequalSign(i);if(0===e.length){if(n)throw new Error("implementation bug");return 0===r?0:-1}if(1<e.length)return o.__absoluteGreater(i);var a=t(r),s=e.__unsignedDigit(0);return s>a?o.__absoluteGreater(i):s<a?o.__absoluteLess(i):0}return o.__compareToDouble(e,r)}},{key:"__compareToDouble",value:function(e,t){if(t!=t)return t;if(t===1/0)return-1;if(t===-1/0)return 1;var r=e.sign;if(r!==0>t)return o.__unequalSign(r);if(0===t)throw new Error("implementation bug: should be handled elsewhere");if(0===e.length)return-1;o.__kBitConversionDouble[0]=t;var i=2047&o.__kBitConversionInts[1]>>>20;if(2047==i)throw new Error("implementation bug: handled elsewhere");var n=i-1023;if(0>n)return o.__absoluteGreater(r);var a=e.length,s=e.__digit(a-1),l=o.__clz30(s),h=30*a-l,c=n+1;if(h<c)return o.__absoluteLess(r);if(h>c)return o.__absoluteGreater(r);var u=1048576|1048575&o.__kBitConversionInts[1],d=o.__kBitConversionInts[0],p=29-l;if(p!==(0|(h-1)%30))throw new Error("implementation bug");var f,m=0;if(p<20){var g=20-p;m=g+32,f=u>>>g,u=u<<32-g|d>>>g,d<<=32-g}else if(20===p)m=32,f=u,u=d,d=0;else{var v=p-20;m=32-v,f=u<<v|d>>>32-v,u=d<<v,d=0}if((s>>>=0)>(f>>>=0))return o.__absoluteGreater(r);if(s<f)return o.__absoluteLess(r);for(var y=a-2;0<=y;y--){0<m?(m-=30,f=u>>>2,u=u<<30|d>>>2,d<<=30):f=0;var b=e.__unsignedDigit(y);if(b>f)return o.__absoluteGreater(r);if(b<f)return o.__absoluteLess(r)}if(0!==u||0!==d){if(0===m)throw new Error("implementation bug");return o.__absoluteLess(r)}return 0}},{key:"__equalToNumber",value:function(e,r){return o.__isOneDigitInt(r)?0===r?0===e.length:1===e.length&&e.sign===0>r&&e.__unsignedDigit(0)===t(r):0===o.__compareToDouble(e,r)}},{key:"__comparisonResultToBool",value:function(e,t){return 0===t?0>e:1===t?0>=e:2===t?0<e:3===t?0<=e:void 0}},{key:"__compare",value:function(e,t,r){if(e=o.__toPrimitive(e),t=o.__toPrimitive(t),"string"==typeof e&&"string"==typeof t)switch(r){case 0:return e<t;case 1:return e<=t;case 2:return e>t;case 3:return e>=t}if(o.__isBigInt(e)&&"string"==typeof t)return null!==(t=o.__fromString(t))&&o.__comparisonResultToBool(o.__compareToBigInt(e,t),r);if("string"==typeof e&&o.__isBigInt(t))return null!==(e=o.__fromString(e))&&o.__comparisonResultToBool(o.__compareToBigInt(e,t),r);if(e=o.__toNumeric(e),t=o.__toNumeric(t),o.__isBigInt(e)){if(o.__isBigInt(t))return o.__comparisonResultToBool(o.__compareToBigInt(e,t),r);if("number"!=typeof t)throw new Error("implementation bug");return o.__comparisonResultToBool(o.__compareToNumber(e,t),r)}if("number"!=typeof e)throw new Error("implementation bug");if(o.__isBigInt(t))return o.__comparisonResultToBool(o.__compareToNumber(t,e),2^r);if("number"!=typeof t)throw new Error("implementation bug");return 0===r?e<t:1===r?e<=t:2===r?e>t:3===r?e>=t:void 0}},{key:"__absoluteAdd",value:function(e,t,r){if(e.length<t.length)return o.__absoluteAdd(t,e,r);if(0===e.length)return e;if(0===t.length)return e.sign===r?e:o.unaryMinus(e);var i=e.length;(0===e.__clzmsd()||t.length===e.length&&0===t.__clzmsd())&&i++;for(var n,a=new o(i,r),s=0,l=0;l<t.length;l++)s=(n=e.__digit(l)+t.__digit(l)+s)>>>30,a.__setDigit(l,1073741823&n);for(;l<e.length;l++){var h=e.__digit(l)+s;s=h>>>30,a.__setDigit(l,1073741823&h)}return l<a.length&&a.__setDigit(l,s),a.__trim()}},{key:"__absoluteSub",value:function(e,t,r){if(0===e.length)return e;if(0===t.length)return e.sign===r?e:o.unaryMinus(e);for(var i,n=new o(e.length,r),a=0,s=0;s<t.length;s++)a=1&(i=e.__digit(s)-t.__digit(s)-a)>>>30,n.__setDigit(s,1073741823&i);for(;s<e.length;s++){var l=e.__digit(s)-a;a=1&l>>>30,n.__setDigit(s,1073741823&l)}return n.__trim()}},{key:"__absoluteAddOne",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=e.length;null===r?r=new o(i,t):r.sign=t;for(var n,a=1,s=0;s<i;s++)a=(n=e.__digit(s)+a)>>>30,r.__setDigit(s,1073741823&n);return 0!==a&&r.__setDigitGrow(i,1),r}},{key:"__absoluteSubOne",value:function(e,t){for(var r,i=e.length,n=new o(t=t||i,!1),a=1,s=0;s<i;s++)a=1&(r=e.__digit(s)-a)>>>30,n.__setDigit(s,1073741823&r);if(0!==a)throw new Error("implementation bug");for(var l=i;l<t;l++)n.__setDigit(l,0);return n}},{key:"__absoluteAnd",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=e.length,n=t.length,a=n;if(i<n){a=i;var s=e,l=i;e=t,i=n,t=s,n=l}var h=a;null===r?r=new o(h,!1):h=r.length;for(var c=0;c<a;c++)r.__setDigit(c,e.__digit(c)&t.__digit(c));for(;c<h;c++)r.__setDigit(c,0);return r}},{key:"__absoluteAndNot",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=e.length,n=t.length,a=n;i<n&&(a=i);var s=i;null===r?r=new o(s,!1):s=r.length;for(var l=0;l<a;l++)r.__setDigit(l,e.__digit(l)&~t.__digit(l));for(;l<i;l++)r.__setDigit(l,e.__digit(l));for(;l<s;l++)r.__setDigit(l,0);return r}},{key:"__absoluteOr",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=e.length,n=t.length,a=n;if(i<n){a=i;var s=e,l=i;e=t,i=n,t=s,n=l}var h=i;null===r?r=new o(h,!1):h=r.length;for(var c=0;c<a;c++)r.__setDigit(c,e.__digit(c)|t.__digit(c));for(;c<i;c++)r.__setDigit(c,e.__digit(c));for(;c<h;c++)r.__setDigit(c,0);return r}},{key:"__absoluteXor",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=e.length,n=t.length,a=n;if(i<n){a=i;var s=e,l=i;e=t,i=n,t=s,n=l}var h=i;null===r?r=new o(h,!1):h=r.length;for(var c=0;c<a;c++)r.__setDigit(c,e.__digit(c)^t.__digit(c));for(;c<i;c++)r.__setDigit(c,e.__digit(c));for(;c<h;c++)r.__setDigit(c,0);return r}},{key:"__absoluteCompare",value:function(e,t){var r=e.length-t.length;if(0!=r)return r;for(var i=e.length-1;0<=i&&e.__digit(i)===t.__digit(i);)i--;return 0>i?0:e.__unsignedDigit(i)>t.__unsignedDigit(i)?1:-1}},{key:"__multiplyAccumulate",value:function(e,t,r,i){if(0!==t){for(var n=32767&t,a=t>>>15,s=0,l=0,h=0;h<e.length;h++,i++){var c=r.__digit(i),u=e.__digit(h),d=32767&u,p=u>>>15,f=o.__imul(d,n),m=o.__imul(d,a),g=o.__imul(p,n);s=(c+=l+f+s)>>>30,c&=1073741823,s+=(c+=((32767&m)<<15)+((32767&g)<<15))>>>30,l=o.__imul(p,a)+(m>>>15)+(g>>>15),r.__setDigit(i,1073741823&c)}for(;0!==s||0!==l;i++){var v=r.__digit(i);v+=s+l,l=0,s=v>>>30,r.__setDigit(i,1073741823&v)}}}},{key:"__internalMultiplyAdd",value:function(e,t,r,i,n){for(var a=r,s=0,l=0;l<i;l++){var h=e.__digit(l),c=o.__imul(32767&h,t),u=o.__imul(h>>>15,t),d=c+((32767&u)<<15)+s+a;a=d>>>30,s=u>>>15,n.__setDigit(l,1073741823&d)}if(n.length>i)for(n.__setDigit(i++,a+s);i<n.length;)n.__setDigit(i++,0);else if(a+s!==0)throw new Error("implementation bug")}},{key:"__absoluteDivSmall",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;null===r&&(r=new o(e.length,!1));for(var i=0,n=2*e.length-1;0<=n;n-=2){var a=(i<<15|e.__halfDigit(n))>>>0,s=0|a/t,l=0|(a=((i=0|a%t)<<15|e.__halfDigit(n-1))>>>0)/t;i=0|a%t,r.__setDigit(n>>>1,s<<15|l)}return r}},{key:"__absoluteModSmall",value:function(e,t){for(var r=0,i=2*e.length-1;0<=i;i--)r=0|((r<<15|e.__halfDigit(i))>>>0)%t;return r}},{key:"__absoluteDivLarge",value:function(e,t,r,i){var n=t.__halfDigitLength(),a=t.length,s=e.__halfDigitLength()-n,l=null;r&&(l=new o(s+2>>>1,!1)).__initializeDigits();var h=new o(n+2>>>1,!1);h.__initializeDigits();var c=o.__clz15(t.__halfDigit(n-1));0<c&&(t=o.__specialLeftShift(t,c,0));for(var u=o.__specialLeftShift(e,c,1),d=t.__halfDigit(n-1),p=0,f=s;0<=f;f--){var m=32767,g=u.__halfDigit(f+n);if(g!==d){var v=(g<<15|u.__halfDigit(f+n-1))>>>0;m=0|v/d;for(var y=0|v%d,b=t.__halfDigit(n-2),x=u.__halfDigit(f+n-2);o.__imul(m,b)>>>0>(y<<16|x)>>>0&&(m--,!(32767<(y+=d))););}o.__internalMultiplyAdd(t,m,0,a,h);var _=u.__inplaceSub(h,f,n+1);0!==_&&(_=u.__inplaceAdd(t,f,n),u.__setHalfDigit(f+n,32767&u.__halfDigit(f+n)+_),m--),r&&(1&f?p=m<<15:l.__setDigit(f>>>1,p|m))}if(i)return u.__inplaceRightShift(c),r?{quotient:l,remainder:u}:u;if(r)return l;throw new Error("unreachable")}},{key:"__clz15",value:function(e){return o.__clz30(e)-15}},{key:"__specialLeftShift",value:function(e,t,r){var i=e.length,n=new o(i+r,!1);if(0===t){for(var a=0;a<i;a++)n.__setDigit(a,e.__digit(a));return 0<r&&n.__setDigit(i,0),n}for(var s,l=0,h=0;h<i;h++)s=e.__digit(h),n.__setDigit(h,1073741823&s<<t|l),l=s>>>30-t;return 0<r&&n.__setDigit(i,l),n}},{key:"__leftShiftByAbsolute",value:function(e,t){var r=o.__toShiftAmount(t);if(0>r)throw new RangeError("BigInt too big");var i=0|r/30,n=r%30,a=e.length,s=0!==n&&e.__digit(a-1)>>>30-n!=0,l=a+i+(s?1:0),h=new o(l,e.sign);if(0===n){for(var c=0;c<i;c++)h.__setDigit(c,0);for(;c<l;c++)h.__setDigit(c,e.__digit(c-i))}else{for(var u=0,d=0;d<i;d++)h.__setDigit(d,0);for(var p,f=0;f<a;f++)p=e.__digit(f),h.__setDigit(f+i,1073741823&p<<n|u),u=p>>>30-n;if(s)h.__setDigit(a+i,u);else if(0!==u)throw new Error("implementation bug")}return h.__trim()}},{key:"__rightShiftByAbsolute",value:function(e,t){var r=e.length,i=e.sign,n=o.__toShiftAmount(t);if(0>n)return o.__rightShiftByMaximum(i);var a=0|n/30,s=n%30,l=r-a;if(0>=l)return o.__rightShiftByMaximum(i);var h=!1;if(i)if(e.__digit(a)&(1<<s)-1)h=!0;else for(var c=0;c<a;c++)if(0!==e.__digit(c)){h=!0;break}h&&0===s&&!~e.__digit(r-1)&&l++;var u=new o(l,i);if(0===s){u.__setDigit(l-1,0);for(var d=a;d<r;d++)u.__setDigit(d-a,e.__digit(d))}else{for(var p,f=e.__digit(a)>>>s,m=r-a-1,g=0;g<m;g++)p=e.__digit(g+a+1),u.__setDigit(g,1073741823&p<<30-s|f),f=p>>>s;u.__setDigit(m,f)}return h&&(u=o.__absoluteAddOne(u,!0,u)),u.__trim()}},{key:"__rightShiftByMaximum",value:function(e){return e?o.__oneDigit(1,!0):o.__zero()}},{key:"__toShiftAmount",value:function(e){if(1<e.length)return-1;var t=e.__unsignedDigit(0);return t>o.__kMaxLengthBits?-1:t}},{key:"__toPrimitive",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"default";if("object"!==r(e)||e.constructor===o)return e;if("undefined"!=typeof Symbol&&"symbol"===r(Symbol.toPrimitive)){var i=e[Symbol.toPrimitive];if(i){var n=i(t);if("object"!==r(n))return n;throw new TypeError("Cannot convert object to primitive value")}}var a=e.valueOf;if(a){var s=a.call(e);if("object"!==r(s))return s}var l=e.toString;if(l){var h=l.call(e);if("object"!==r(h))return h}throw new TypeError("Cannot convert object to primitive value")}},{key:"__toNumeric",value:function(e){return o.__isBigInt(e)?e:+e}},{key:"__isBigInt",value:function(e){return"object"===r(e)&&null!==e&&e.constructor===o}},{key:"__truncateToNBits",value:function(e,t){for(var r=0|(e+29)/30,i=new o(r,t.sign),n=r-1,a=0;a<n;a++)i.__setDigit(a,t.__digit(a));var s=t.__digit(n);if(e%30!=0){var l=32-e%30;s=s<<l>>>l}return i.__setDigit(n,s),i.__trim()}},{key:"__truncateAndSubFromPowerOfTwo",value:function(e,t,r){for(var i,n=Math.min,a=0|(e+29)/30,s=new o(a,r),l=0,h=a-1,c=0,u=n(h,t.length);l<u;l++)c=1&(i=0-t.__digit(l)-c)>>>30,s.__setDigit(l,1073741823&i);for(;l<h;l++)s.__setDigit(l,0|1073741823&-c);var d,p=h<t.length?t.__digit(h):0,f=e%30;if(0===f)d=0-p-c,d&=1073741823;else{var m=32-f,g=1<<32-m;d=g-(p=p<<m>>>m)-c,d&=g-1}return s.__setDigit(h,d),s.__trim()}},{key:"__digitPow",value:function(e,t){for(var r=1;0<t;)1&t&&(r*=e),t>>>=1,e*=e;return r}},{key:"__isOneDigitInt",value:function(e){return(1073741823&e)===e}}]),o}(l(Array));return f.__kMaxLength=33554432,f.__kMaxLengthBits=f.__kMaxLength<<5,f.__kMaxBitsPerChar=[0,0,32,51,64,75,83,90,96,102,107,111,115,119,122,126,128,131,134,136,139,141,143,145,147,149,151,153,154,156,158,159,160,162,163,165,166],f.__kBitsPerCharTableShift=5,f.__kBitsPerCharTableMultiplier=1<<f.__kBitsPerCharTableShift,f.__kConversionChars=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],f.__kBitConversionBuffer=new ArrayBuffer(8),f.__kBitConversionDouble=new Float64Array(f.__kBitConversionBuffer),f.__kBitConversionInts=new Int32Array(f.__kBitConversionBuffer),f.__clz30=t?function(e){return t(e)-2}:function(e){var t=Math.LN2,r=Math.log;return 0===e?30:0|29-(0|r(e>>>0)/t)},f.__imul=e||function(e,t){return 0|e*t},f},"object"==typeof e&&void 0!==t?t.exports=i():"function"==typeof define&&define.amd?define(i):(r=r||self).JSBI=i()})),pEe=$(((e,t)=>{var r,i;r=e,i=function(){"use strict";function e(e,i,n,a,s){!function e(r,i,n,a,s){for(;a>n;){if(a-n>600){var o=a-n+1,l=i-n+1,h=Math.log(o),c=.5*Math.exp(2*h/3),u=.5*Math.sqrt(h*c*(o-c)/o)*(l-o/2<0?-1:1);e(r,i,Math.max(n,Math.floor(i-l*c/o+u)),Math.min(a,Math.floor(i+(o-l)*c/o+u)),s)}var d=r[i],p=n,f=a;for(t(r,n,i),s(r[a],d)>0&&t(r,n,a);p<f;){for(t(r,p,f),p++,f--;s(r[p],d)<0;)p++;for(;s(r[f],d)>0;)f--}0===s(r[n],d)?t(r,n,f):t(r,++f,a),f<=i&&(n=f+1),i<=f&&(a=f-1)}}(e,i,n||0,a||e.length-1,s||r)}function t(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function r(e,t){return e<t?-1:e>t?1:0}var i=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(e,t,r){if(!r)return t.indexOf(e);for(var i=0;i<t.length;i++)if(r(e,t[i]))return i;return-1}function a(e,t){s(e,0,e.children.length,t,e)}function s(e,t,r,i,n){n||(n=f(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var a=t;a<r;a++){var s=e.children[a];o(n,e.leaf?i(s):s)}return n}function o(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function h(e,t){return e.minY-t.minY}function c(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function u(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function p(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function f(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(t,r,i,n,a){for(var s=[r,i];s.length;)if(!((i=s.pop())-(r=s.pop())<=n)){var o=r+Math.ceil((i-r)/n/2)*n;e(t,o,r,i,a),s.push(r,o,o,i)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(e){var t=this.data,r=[];if(!p(e,t))return r;for(var i=this.toBBox,n=[];t;){for(var a=0;a<t.children.length;a++){var s=t.children[a],o=t.leaf?i(s):s;p(e,o)&&(t.leaf?r.push(s):d(e,o)?this._all(s,r):n.push(s))}t=n.pop()}return r},i.prototype.collides=function(e){var t=this.data;if(!p(e,t))return!1;for(var r=[];t;){for(var i=0;i<t.children.length;i++){var n=t.children[i],a=t.leaf?this.toBBox(n):n;if(p(e,a)){if(t.leaf||d(e,a))return!0;r.push(n)}}t=r.pop()}return!1},i.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var r=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},i.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},i.prototype.clear=function(){return this.data=f([]),this},i.prototype.remove=function(e,t){if(!e)return this;for(var r,i,a,s=this.data,o=this.toBBox(e),l=[],h=[];s||l.length;){if(s||(s=l.pop(),i=l[l.length-1],r=h.pop(),a=!0),s.leaf){var c=n(e,s.children,t);if(-1!==c)return s.children.splice(c,1),l.push(s),this._condense(l),this}a||s.leaf||!d(s,o)?i?(r++,s=i.children[r],a=!1):s=null:(l.push(s),h.push(r),r=0,i=s,s=s.children[0])}return this},i.prototype.toBBox=function(e){return e},i.prototype.compareMinX=function(e,t){return e.minX-t.minX},i.prototype.compareMinY=function(e,t){return e.minY-t.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(e){return this.data=e,this},i.prototype._all=function(e,t){for(var r=[];e;)e.leaf?t.push.apply(t,e.children):r.push.apply(r,e.children),e=r.pop();return t},i.prototype._build=function(e,t,r,i){var n,s=r-t+1,o=this._maxEntries;if(s<=o)return a(n=f(e.slice(t,r+1)),this.toBBox),n;i||(i=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,i-1))),(n=f([])).leaf=!1,n.height=i;var l=Math.ceil(s/o),h=l*Math.ceil(Math.sqrt(o));m(e,t,r,h,this.compareMinX);for(var c=t;c<=r;c+=h){var u=Math.min(c+h-1,r);m(e,c,u,l,this.compareMinY);for(var d=c;d<=u;d+=l){var p=Math.min(d+l-1,u);n.children.push(this._build(e,d,p,i-1))}}return a(n,this.toBBox),n},i.prototype._chooseSubtree=function(e,t,r,i){for(;i.push(t),!t.leaf&&i.length-1!==r;){for(var n=1/0,a=1/0,s=void 0,o=0;o<t.children.length;o++){var l=t.children[o],h=c(l),u=(d=e,p=l,(Math.max(p.maxX,d.maxX)-Math.min(p.minX,d.minX))*(Math.max(p.maxY,d.maxY)-Math.min(p.minY,d.minY))-h);u<a?(a=u,n=h<n?h:n,s=l):u===a&&h<n&&(n=h,s=l)}t=s||t.children[0]}var d,p;return t},i.prototype._insert=function(e,t,r){var i=r?e:this.toBBox(e),n=[],a=this._chooseSubtree(i,this.data,t,n);for(a.children.push(e),o(a,i);t>=0&&n[t].children.length>this._maxEntries;)this._split(n,t),t--;this._adjustParentBBoxes(i,n,t)},i.prototype._split=function(e,t){var r=e[t],i=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,i);var s=this._chooseSplitIndex(r,n,i),o=f(r.children.splice(s,r.children.length-s));o.height=r.height,o.leaf=r.leaf,a(r,this.toBBox),a(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(r,o)},i.prototype._splitRoot=function(e,t){this.data=f([e,t]),this.data.height=e.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(e,t,r){for(var i,n,a,o,l,h,u,d=1/0,p=1/0,f=t;f<=r-t;f++){var m=s(e,0,f,this.toBBox),g=s(e,f,r,this.toBBox),v=(n=m,a=g,o=Math.max(n.minX,a.minX),l=Math.max(n.minY,a.minY),h=Math.min(n.maxX,a.maxX),u=Math.min(n.maxY,a.maxY),Math.max(0,h-o)*Math.max(0,u-l)),y=c(m)+c(g);v<d?(d=v,i=f,p=y<p?y:p):v===d&&y<p&&(p=y,i=f)}return i||r-t},i.prototype._chooseSplitAxis=function(e,t,r){var i=e.leaf?this.compareMinX:l,n=e.leaf?this.compareMinY:h;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,n)&&e.children.sort(i)},i.prototype._allDistMargin=function(e,t,r,i){e.children.sort(i);for(var n=this.toBBox,a=s(e,0,t,n),l=s(e,r-t,r,n),h=u(a)+u(l),c=t;c<r-t;c++){var d=e.children[c];o(a,e.leaf?n(d):d),h+=u(a)}for(var p=r-t-1;p>=t;p--){var f=e.children[p];o(l,e.leaf?n(f):f),h+=u(l)}return h},i.prototype._adjustParentBBoxes=function(e,t,r){for(var i=r;i>=0;i--)o(t[i],e)},i.prototype._condense=function(e){for(var t=e.length-1,r=void 0;t>=0;t--)0===e[t].children.length?t>0?(r=e[t-1].children).splice(r.indexOf(e[t]),1):this.clear():a(e[t],this.toBBox)},i},"object"==typeof e&&void 0!==t?t.exports=i():"function"==typeof define&&define.amd?define(i):(r=r||self).RBush=i()})),mEe=$(((e,t)=>{var r,i;r=e,i=function(){"use strict";var e=function(e,r){if(void 0===e&&(e=[]),void 0===r&&(r=t),this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)};function t(e,t){return e<t?-1:e>t?1:0}return e.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(e){for(var t=this.data,r=this.compare,i=t[e];e>0;){var n=e-1>>1,a=t[n];if(r(i,a)>=0)break;t[e]=a,e=n}t[e]=i},e.prototype._down=function(e){for(var t=this.data,r=this.compare,i=this.length>>1,n=t[e];e<i;){var a=1+(e<<1),s=t[a],o=a+1;if(o<this.length&&r(t[o],s)<0&&(a=o,s=t[o]),r(s,n)>=0)break;t[e]=s,e=a}t[e]=n},e},"object"==typeof e&&void 0!==t?t.exports=i():"function"==typeof define&&define.amd?define(i):(r=r||self).TinyQueue=i()})),vEe=$(((e,t)=>{t.exports=function(e,t,r,i){var n=e[0],a=e[1],s=!1;void 0===r&&(r=0),void 0===i&&(i=t.length);for(var o=(i-r)/2,l=0,h=o-1;l<o;h=l++){var c=t[r+2*l+0],u=t[r+2*l+1],d=t[r+2*h+0],p=t[r+2*h+1];u>a!=p>a&&n<(d-c)*(a-u)/(p-u)+c&&(s=!s)}return s}})),bEe=$(((e,t)=>{t.exports=function(e,t,r,i){var n=e[0],a=e[1],s=!1;void 0===r&&(r=0),void 0===i&&(i=t.length);for(var o=i-r,l=0,h=o-1;l<o;h=l++){var c=t[l+r][0],u=t[l+r][1],d=t[h+r][0],p=t[h+r][1];u>a!=p>a&&n<(d-c)*(a-u)/(p-u)+c&&(s=!s)}return s}})),_Ee=$(((e,t)=>{var r=vEe(),i=bEe();t.exports=function(e,t,n,a){return t.length>0&&Array.isArray(t[0])?i(e,t,n,a):r(e,t,n,a)},t.exports.nested=i,t.exports.flat=r})),wEe=$(((e,t)=>{var r,i;r=e,i=function(e){"use strict";function t(e,t,r,i,n){let a,s,o,l,h=t[0],c=i[0],u=0,d=0;c>h==c>-h?(a=h,h=t[++u]):(a=c,c=i[++d]);let p=0;if(u<e&&d<r)for(c>h==c>-h?(o=a-((s=h+a)-h),h=t[++u]):(o=a-((s=c+a)-c),c=i[++d]),a=s,0!==o&&(n[p++]=o);u<e&&d<r;)c>h==c>-h?(o=a-((s=a+h)-(l=s-a))+(h-l),h=t[++u]):(o=a-((s=a+c)-(l=s-a))+(c-l),c=i[++d]),a=s,0!==o&&(n[p++]=o);for(;u<e;)o=a-((s=a+h)-(l=s-a))+(h-l),h=t[++u],a=s,0!==o&&(n[p++]=o);for(;d<r;)o=a-((s=a+c)-(l=s-a))+(c-l),c=i[++d],a=s,0!==o&&(n[p++]=o);return 0===a&&0!==p||(n[p++]=a),p}function r(e){return new Float64Array(e)}let i=r(4),n=r(8),a=r(12),s=r(16),o=r(4);e.orient2d=function(e,r,l,h,c,u){let d=(r-u)*(l-c),p=(e-c)*(h-u),f=d-p;if(0===d||0===p||d>0!=p>0)return f;let m=Math.abs(d+p);return Math.abs(f)>=33306690738754716e-32*m?f:-function(e,r,l,h,c,u,d){let p,f,m,g,v,y,b,x,_,w,S,T,M,E,A,C,P,R,I=e-c,O=l-c,L=r-u,D=h-u;v=(A=(x=I-(b=(y=134217729*I)-(y-I)))*(w=D-(_=(y=134217729*D)-(y-D)))-((E=I*D)-b*_-x*_-b*w))-(S=A-(P=(x=L-(b=(y=134217729*L)-(y-L)))*(w=O-(_=(y=134217729*O)-(y-O)))-((C=L*O)-b*_-x*_-b*w))),i[0]=A-(S+v)+(v-P),v=(M=E-((T=E+S)-(v=T-E))+(S-v))-(S=M-C),i[1]=M-(S+v)+(v-C),v=(R=T+S)-T,i[2]=T-(R-v)+(S-v),i[3]=R;let k=function(e,t){let r=t[0];for(let e=1;e<4;e++)r+=t[e];return r}(0,i),F=22204460492503146e-32*d;if(k>=F||-k>=F||(p=e-(I+(v=e-I))+(v-c),m=l-(O+(v=l-O))+(v-c),f=r-(L+(v=r-L))+(v-u),g=h-(D+(v=h-D))+(v-u),0===p&&0===f&&0===m&&0===g)||(F=11093356479670487e-47*d+33306690738754706e-32*Math.abs(k),(k+=I*g+D*p-(L*m+O*f))>=F||-k>=F))return k;v=(A=(x=p-(b=(y=134217729*p)-(y-p)))*(w=D-(_=(y=134217729*D)-(y-D)))-((E=p*D)-b*_-x*_-b*w))-(S=A-(P=(x=f-(b=(y=134217729*f)-(y-f)))*(w=O-(_=(y=134217729*O)-(y-O)))-((C=f*O)-b*_-x*_-b*w))),o[0]=A-(S+v)+(v-P),v=(M=E-((T=E+S)-(v=T-E))+(S-v))-(S=M-C),o[1]=M-(S+v)+(v-C),v=(R=T+S)-T,o[2]=T-(R-v)+(S-v),o[3]=R;let N=t(4,i,4,o,n);v=(A=(x=I-(b=(y=134217729*I)-(y-I)))*(w=g-(_=(y=134217729*g)-(y-g)))-((E=I*g)-b*_-x*_-b*w))-(S=A-(P=(x=L-(b=(y=134217729*L)-(y-L)))*(w=m-(_=(y=134217729*m)-(y-m)))-((C=L*m)-b*_-x*_-b*w))),o[0]=A-(S+v)+(v-P),v=(M=E-((T=E+S)-(v=T-E))+(S-v))-(S=M-C),o[1]=M-(S+v)+(v-C),v=(R=T+S)-T,o[2]=T-(R-v)+(S-v),o[3]=R;let U=t(N,n,4,o,a);v=(A=(x=p-(b=(y=134217729*p)-(y-p)))*(w=g-(_=(y=134217729*g)-(y-g)))-((E=p*g)-b*_-x*_-b*w))-(S=A-(P=(x=f-(b=(y=134217729*f)-(y-f)))*(w=m-(_=(y=134217729*m)-(y-m)))-((C=f*m)-b*_-x*_-b*w))),o[0]=A-(S+v)+(v-P),v=(M=E-((T=E+S)-(v=T-E))+(S-v))-(S=M-C),o[1]=M-(S+v)+(v-C),v=(R=T+S)-T,o[2]=T-(R-v)+(S-v),o[3]=R;let B=t(U,a,4,o,s);return s[B-1]}(e,r,l,h,c,u,m)},e.orient2dfast=function(e,t,r,i,n,a){return(t-a)*(r-n)-(e-n)*(i-a)},Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof e&&void 0!==t?i(e):"function"==typeof define&&define.amd?define(["exports"],i):i((r=r||self).predicates={})})),PEe=$(((e,t)=>{"use strict";var r=pEe(),i=mEe(),n=_Ee(),a=wEe().orient2d;function s(e,t,i){t=Math.max(0,void 0===t?2:t),i=i||0;var a=function(e){for(var t=e[0],r=e[0],i=e[0],a=e[0],s=0;s<e.length;s++){var o=e[s];o[0]<t[0]&&(t=o),o[0]>i[0]&&(i=o),o[1]<r[1]&&(r=o),o[1]>a[1]&&(a=o)}var l=[t,r,i,a],h=l.slice();for(s=0;s<e.length;s++)n(e[s],l)||h.push(e[s]);return function(e){e.sort(b);for(var t=[],r=0;r<e.length;r++){for(;t.length>=2&&d(t[t.length-2],t[t.length-1],e[r])<=0;)t.pop();t.push(e[r])}for(var i=[],n=e.length-1;n>=0;n--){for(;i.length>=2&&d(i[i.length-2],i[i.length-1],e[n])<=0;)i.pop();i.push(e[n])}return i.pop(),t.pop(),t.concat(i)}(h)}(e),s=new r(16);s.toBBox=function(e){return{minX:e[0],minY:e[1],maxX:e[0],maxY:e[1]}},s.compareMinX=function(e,t){return e[0]-t[0]},s.compareMinY=function(e,t){return e[1]-t[1]},s.load(e);for(var l,h=[],c=0;c<a.length;c++){var u=a[c];s.remove(u),l=m(u,l),h.push(l)}var p=new r(16);for(c=0;c<h.length;c++)p.insert(f(h[c]));for(var v=t*t,y=i*i;h.length;){var x=h.shift(),_=x.p,w=x.next.p,S=g(_,w);if(!(S<y)){var T=S/v;(u=o(s,x.prev.p,_,w,x.next.next.p,T,p))&&Math.min(g(u,_),g(u,w))<=T&&(h.push(x),h.push(m(u,x)),s.remove(u),p.remove(x),p.insert(f(x)),p.insert(f(x.next)))}}x=l;var M=[];do{M.push(x.p),x=x.next}while(x!==l);return M.push(x.p),M}function o(e,t,r,n,a,s,o){for(var c=new i([],l),d=e.data;d;){for(var p=0;p<d.children.length;p++){var f=d.children[p],m=d.leaf?v(f,r,n):h(r,n,f);m>s||c.push({node:f,dist:m})}for(;c.length&&!c.peek().node.children;){var g=c.pop(),y=g.node,b=v(y,t,r),x=v(y,n,a);if(g.dist<b&&g.dist<x&&u(r,y,o)&&u(n,y,o))return y}(d=c.pop())&&(d=d.node)}return null}function l(e,t){return e.dist-t.dist}function h(e,t,r){if(c(e,r)||c(t,r))return 0;var i=y(e[0],e[1],t[0],t[1],r.minX,r.minY,r.maxX,r.minY);if(0===i)return 0;var n=y(e[0],e[1],t[0],t[1],r.minX,r.minY,r.minX,r.maxY);if(0===n)return 0;var a=y(e[0],e[1],t[0],t[1],r.maxX,r.minY,r.maxX,r.maxY);if(0===a)return 0;var s=y(e[0],e[1],t[0],t[1],r.minX,r.maxY,r.maxX,r.maxY);return 0===s?0:Math.min(i,n,a,s)}function c(e,t){return e[0]>=t.minX&&e[0]<=t.maxX&&e[1]>=t.minY&&e[1]<=t.maxY}function u(e,t,r){for(var i=Math.min(e[0],t[0]),n=Math.min(e[1],t[1]),a=Math.max(e[0],t[0]),s=Math.max(e[1],t[1]),o=r.search({minX:i,minY:n,maxX:a,maxY:s}),l=0;l<o.length;l++)if(p(o[l].p,o[l].next.p,e,t))return!1;return!0}function d(e,t,r){return a(e[0],e[1],t[0],t[1],r[0],r[1])}function p(e,t,r,i){return e!==i&&t!==r&&d(e,t,r)>0!=d(e,t,i)>0&&d(r,i,e)>0!=d(r,i,t)>0}function f(e){var t=e.p,r=e.next.p;return e.minX=Math.min(t[0],r[0]),e.minY=Math.min(t[1],r[1]),e.maxX=Math.max(t[0],r[0]),e.maxY=Math.max(t[1],r[1]),e}function m(e,t){var r={p:e,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return t?(r.next=t.next,r.prev=t,t.next.prev=r,t.next=r):(r.prev=r,r.next=r),r}function g(e,t){var r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function v(e,t,r){var i=t[0],n=t[1],a=r[0]-i,s=r[1]-n;if(0!==a||0!==s){var o=((e[0]-i)*a+(e[1]-n)*s)/(a*a+s*s);o>1?(i=r[0],n=r[1]):o>0&&(i+=a*o,n+=s*o)}return(a=e[0]-i)*a+(s=e[1]-n)*s}function y(e,t,r,i,n,a,s,o){var l,h,c,u,d=r-e,p=i-t,f=s-n,m=o-a,g=e-n,v=t-a,y=d*d+p*p,b=d*f+p*m,x=f*f+m*m,_=d*g+p*v,w=f*g+m*v,S=y*x-b*b,T=S,M=S;0===S?(h=0,T=1,u=w,M=x):(u=y*w-b*_,(h=b*w-x*_)<0?(h=0,u=w,M=x):h>T&&(h=T,u=w+b,M=x)),u<0?(u=0,-_<0?h=0:-_>y?h=T:(h=-_,T=y)):u>M&&(u=M,-_+b<0?h=0:-_+b>y?h=T:(h=-_+b,T=y));var E=(1-(c=0===u?0:u/M))*n+c*s-((1-(l=0===h?0:h/T))*e+l*r),A=(1-c)*a+c*o-((1-l)*t+l*i);return E*E+A*A}function b(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]}i.default&&(i=i.default),t.exports=s,t.exports.default=s})),KEe=$(((e,t)=>{t.exports=function(){var e,t=0,r=!1;function i(t,r){return e.list.push({type:t,data:r?JSON.parse(JSON.stringify(r)):void 0}),e}return e={list:[],segmentId:function(){return t++},checkIntersection:function(e,t){return i("check",{seg1:e,seg2:t})},segmentChop:function(e,t){return i("div_seg",{seg:e,pt:t}),i("chop",{seg:e,pt:t})},statusRemove:function(e){return i("pop_seg",{seg:e})},segmentUpdate:function(e){return i("seg_update",{seg:e})},segmentNew:function(e,t){return i("new_seg",{seg:e,primary:t})},segmentRemove:function(e){return i("rem_seg",{seg:e})},tempStatus:function(e,t,r){return i("temp_status",{seg:e,above:t,below:r})},rewind:function(e){return i("rewind",{seg:e})},status:function(e,t,r){return i("status",{seg:e,above:t,below:r})},vert:function(t){return t===r?e:(r=t,i("vert",{x:t}))},log:function(e){return"string"!=typeof e&&(e=JSON.stringify(e,!1,"  ")),i("log",{txt:e})},reset:function(){return i("reset")},selected:function(e){return i("selected",{segs:e})},chainStart:function(e){return i("chain_start",{seg:e})},chainRemoveHead:function(e,t){return i("chain_rem_head",{index:e,pt:t})},chainRemoveTail:function(e,t){return i("chain_rem_tail",{index:e,pt:t})},chainNew:function(e,t){return i("chain_new",{pt1:e,pt2:t})},chainMatch:function(e){return i("chain_match",{index:e})},chainClose:function(e){return i("chain_close",{index:e})},chainAddHead:function(e,t){return i("chain_add_head",{index:e,pt:t})},chainAddTail:function(e,t){return i("chain_add_tail",{index:e,pt:t})},chainConnect:function(e,t){return i("chain_con",{index1:e,index2:t})},chainReverse:function(e){return i("chain_rev",{index:e})},chainJoin:function(e,t){return i("chain_join",{index1:e,index2:t})},done:function(){return i("done")}}}})),QEe=$(((e,t)=>{t.exports=function(e){"number"!=typeof e&&(e=1e-10);var t={epsilon:function(t){return"number"==typeof t&&(e=t),e},pointAboveOrOnLine:function(t,r,i){var n=r[0],a=r[1],s=i[0],o=i[1],l=t[0];return(s-n)*(t[1]-a)-(o-a)*(l-n)>=-e},pointBetween:function(t,r,i){var n=t[1]-r[1],a=i[0]-r[0],s=t[0]-r[0],o=i[1]-r[1],l=s*a+n*o;return!(l<e)&&!(l-(a*a+o*o)>-e)},pointsSameX:function(t,r){return Math.abs(t[0]-r[0])<e},pointsSameY:function(t,r){return Math.abs(t[1]-r[1])<e},pointsSame:function(e,r){return t.pointsSameX(e,r)&&t.pointsSameY(e,r)},pointsCompare:function(e,r){return t.pointsSameX(e,r)?t.pointsSameY(e,r)?0:e[1]<r[1]?-1:1:e[0]<r[0]?-1:1},pointsCollinear:function(t,r,i){var n=t[0]-r[0],a=t[1]-r[1],s=r[0]-i[0],o=r[1]-i[1];return Math.abs(n*o-s*a)<e},linesIntersect:function(t,r,i,n){var a=r[0]-t[0],s=r[1]-t[1],o=n[0]-i[0],l=n[1]-i[1],h=a*l-s*o;if(Math.abs(h)<e)return!1;var c=t[0]-i[0],u=t[1]-i[1],d=(o*u-l*c)/h,p=(a*u-s*c)/h,f={alongA:0,alongB:0,pt:[t[0]+d*a,t[1]+d*s]};return f.alongA=d<=-e?-2:d<e?-1:d-1<=-e?0:d-1<e?1:2,f.alongB=p<=-e?-2:p<e?-1:p-1<=-e?0:p-1<e?1:2,f},pointInsideRegion:function(t,r){for(var i=t[0],n=t[1],a=r[r.length-1][0],s=r[r.length-1][1],o=!1,l=0;l<r.length;l++){var h=r[l][0],c=r[l][1];c-n>e!=s-n>e&&(a-h)*(n-c)/(s-c)+h-i>e&&(o=!o),a=h,s=c}return o}};return t}})),t_e=$(((e,t)=>{t.exports={create:function(){var e={root:{root:!0,next:null},exists:function(t){return!(null===t||t===e.root)},isEmpty:function(){return null===e.root.next},getHead:function(){return e.root.next},insertBefore:function(t,r){for(var i=e.root,n=e.root.next;null!==n;){if(r(n))return t.prev=n.prev,t.next=n,n.prev.next=t,void(n.prev=t);i=n,n=n.next}i.next=t,t.prev=i,t.next=null},findTransition:function(t){for(var r=e.root,i=e.root.next;null!==i&&!t(i);)r=i,i=i.next;return{before:r===e.root?null:r,after:i,insert:function(e){return e.prev=r,e.next=i,r.next=e,null!==i&&(i.prev=e),e}}}};return e},node:function(e){return e.prev=null,e.next=null,e.remove=function(){e.prev.next=e.next,e.next&&(e.next.prev=e.prev),e.prev=null,e.next=null},e}}})),n_e=$(((e,t)=>{var r=t_e();t.exports=function(e,t,i){function n(e,t){return{id:i?i.segmentId():-1,start:e,end:t,myFill:{above:null,below:null},otherFill:null}}function a(e,t,r){return{id:i?i.segmentId():-1,start:e,end:t,myFill:{above:r.myFill.above,below:r.myFill.below},otherFill:null}}var s=r.create();function o(e,r){s.insertBefore(e,(function(i){var n=function(e,r,i,n,a,s){var o=t.pointsCompare(r,a);return 0!==o?o:t.pointsSame(i,s)?0:e!==n?e?1:-1:t.pointAboveOrOnLine(i,n?a:s,n?s:a)?1:-1}(e.isStart,e.pt,r,i.isStart,i.pt,i.other.pt);return n<0}))}function l(e,t){var i=function(e,t){var i=r.node({isStart:!0,pt:e.start,seg:e,primary:t,other:null,status:null});return o(i,e.end),i}(e,t);return function(e,t,i){var n=r.node({isStart:!1,pt:t.end,seg:t,primary:i,other:e,status:null});e.other=n,o(n,e.pt)}(i,e,t),i}function h(e,t){var r=a(t,e.seg.end,e.seg);return function(e,t){i&&i.segmentChop(e.seg,t),e.other.remove(),e.seg.end=t,e.other.pt=t,o(e.other,e.pt)}(e,t),l(r,e.primary)}function c(n,a){var o=r.create();function l(e){return o.findTransition((function(r){var i=function(e,r){var i=e.seg.start,n=e.seg.end,a=r.seg.start,s=r.seg.end;return t.pointsCollinear(i,a,s)?t.pointsCollinear(n,a,s)||t.pointAboveOrOnLine(n,a,s)?1:-1:t.pointAboveOrOnLine(i,a,s)?1:-1}(e,r.ev);return i>0}))}function c(e,r){var n=e.seg,a=r.seg,s=n.start,o=n.end,l=a.start,c=a.end;i&&i.checkIntersection(n,a);var u=t.linesIntersect(s,o,l,c);if(!1===u){if(!t.pointsCollinear(s,o,l)||t.pointsSame(s,c)||t.pointsSame(o,l))return!1;var d=t.pointsSame(s,l),p=t.pointsSame(o,c);if(d&&p)return r;var f=!d&&t.pointBetween(s,l,c),m=!p&&t.pointBetween(o,l,c);if(d)return m?h(r,o):h(e,c),r;f&&(p||(m?h(r,o):h(e,c)),h(r,s))}else 0===u.alongA&&(-1===u.alongB?h(e,l):0===u.alongB?h(e,u.pt):1===u.alongB&&h(e,c)),0===u.alongB&&(-1===u.alongA?h(r,s):0===u.alongA?h(r,u.pt):1===u.alongA&&h(r,o));return!1}for(var u=[];!s.isEmpty();){var d=s.getHead();if(i&&i.vert(d.pt[0]),d.isStart){let t=function(){if(f){var e=c(d,f);if(e)return e}return!!m&&c(d,m)};i&&i.segmentNew(d.seg,d.primary);var p=l(d),f=p.before?p.before.ev:null,m=p.after?p.after.ev:null;i&&i.tempStatus(d.seg,!!f&&f.seg,!!m&&m.seg);var g=t();if(g){var v;if(e)(v=null===d.seg.myFill.below||d.seg.myFill.above!==d.seg.myFill.below)&&(g.seg.myFill.above=!g.seg.myFill.above);else g.seg.otherFill=d.seg.myFill;i&&i.segmentUpdate(g.seg),d.other.remove(),d.remove()}if(s.getHead()!==d){i&&i.rewind(d.seg);continue}if(e)v=null===d.seg.myFill.below||d.seg.myFill.above!==d.seg.myFill.below,d.seg.myFill.below=m?m.seg.myFill.above:n,d.seg.myFill.above=v?!d.seg.myFill.below:d.seg.myFill.below;else if(null===d.seg.otherFill){var y;y=m?d.primary===m.primary?m.seg.otherFill.above:m.seg.myFill.above:d.primary?a:n,d.seg.otherFill={above:y,below:y}}i&&i.status(d.seg,!!f&&f.seg,!!m&&m.seg),d.other.status=p.insert(r.node({ev:d}))}else{var b=d.status;if(null===b)throw new Error("PolyBool: Zero-length segment detected; your epsilon is probably too small or too large");if(o.exists(b.prev)&&o.exists(b.next)&&c(b.prev.ev,b.next.ev),i&&i.statusRemove(b.ev.seg),b.remove(),!d.primary){var x=d.seg.myFill;d.seg.myFill=d.seg.otherFill,d.seg.otherFill=x}u.push(d.seg)}s.getHead().remove()}return i&&i.done(),u}return e?{addRegion:function(e){for(var r,i=e[e.length-1],a=0;a<e.length;a++){r=i,i=e[a];var s=t.pointsCompare(r,i);0!==s&&l(n(s<0?r:i,s<0?i:r),!0)}},calculate:function(e){return c(e,!1)}}:{calculate:function(e,t,r,i){return e.forEach((function(e){l(a(e.start,e.end,e),!0)})),r.forEach((function(e){l(a(e.start,e.end,e),!1)})),c(t,i)}}}})),s_e=$(((e,t)=>{t.exports=function(e,t,r){var i=[],n=[];return e.forEach((function(e){var a=e.start,s=e.end;if(t.pointsSame(a,s))console.warn("PolyBool: Warning: Zero-length segment detected; your epsilon is probably too small or too large");else{r&&r.chainStart(e);for(var o={index:0,matches_head:!1,matches_pt1:!1},l={index:0,matches_head:!1,matches_pt1:!1},h=o,c=0;c<i.length;c++){var u=(g=i[c])[0],d=(g[1],g[g.length-1]);g[g.length-2];if(t.pointsSame(u,a)){if(T(c,!0,!0))break}else if(t.pointsSame(u,s)){if(T(c,!0,!1))break}else if(t.pointsSame(d,a)){if(T(c,!1,!0))break}else if(t.pointsSame(d,s)&&T(c,!1,!1))break}if(h===o)return i.push([a,s]),void(r&&r.chainNew(a,s));if(h===l){r&&r.chainMatch(o.index);var p=o.index,f=o.matches_pt1?s:a,m=o.matches_head,g=i[p],v=m?g[0]:g[g.length-1],y=m?g[1]:g[g.length-2],b=m?g[g.length-1]:g[0],x=m?g[g.length-2]:g[1];return t.pointsCollinear(y,v,f)&&(m?(r&&r.chainRemoveHead(o.index,f),g.shift()):(r&&r.chainRemoveTail(o.index,f),g.pop()),v=y),t.pointsSame(b,f)?(i.splice(p,1),t.pointsCollinear(x,b,v)&&(m?(r&&r.chainRemoveTail(o.index,v),g.pop()):(r&&r.chainRemoveHead(o.index,v),g.shift())),r&&r.chainClose(o.index),void n.push(g)):void(m?(r&&r.chainAddHead(o.index,f),g.unshift(f)):(r&&r.chainAddTail(o.index,f),g.push(f)))}var _=o.index,w=l.index;r&&r.chainConnect(_,w);var S=i[_].length<i[w].length;o.matches_head?l.matches_head?S?(M(_),E(_,w)):(M(w),E(w,_)):E(w,_):l.matches_head?E(_,w):S?(M(_),E(w,_)):(M(w),E(_,w))}function T(e,t,r){return h.index=e,h.matches_head=t,h.matches_pt1=r,h===o?(h=l,!1):(h=null,!0)}function M(e){r&&r.chainReverse(e),i[e].reverse()}function E(e,n){var a=i[e],s=i[n],o=a[a.length-1],l=a[a.length-2],h=s[0],c=s[1];t.pointsCollinear(l,o,h)&&(r&&r.chainRemoveTail(e,o),a.pop(),o=l),t.pointsCollinear(o,h,c)&&(r&&r.chainRemoveHead(n,h),s.shift()),r&&r.chainJoin(e,n),i[e]=a.concat(s),i.splice(n,1)}})),n}})),o_e=$(((e,t)=>{function r(e,t,r){var i=[];return e.forEach((function(e){var n=(e.myFill.above?8:0)+(e.myFill.below?4:0)+(e.otherFill&&e.otherFill.above?2:0)+(e.otherFill&&e.otherFill.below?1:0);0!==t[n]&&i.push({id:r?r.segmentId():-1,start:e.start,end:e.end,myFill:{above:1===t[n],below:2===t[n]},otherFill:null})})),r&&r.selected(i),i}var i={union:function(e,t){return r(e,[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],t)},intersect:function(e,t){return r(e,[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],t)},difference:function(e,t){return r(e,[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0],t)},differenceRev:function(e,t){return r(e,[0,2,1,0,0,0,1,1,0,2,0,2,0,0,0,0],t)},xor:function(e,t){return r(e,[0,2,1,0,2,0,0,1,1,0,0,2,0,1,2,0],t)}};t.exports=i})),c_e=$(((e,t)=>{var r={toPolygon:function(e,t){function r(t){if(t.length<=0)return e.segments({inverted:!1,regions:[]});function r(t){var r=t.slice(0,t.length-1);return e.segments({inverted:!1,regions:[r]})}for(var i=r(t[0]),n=1;n<t.length;n++)i=e.selectDifference(e.combine(i,r(t[n])));return i}if("Polygon"===t.type)return e.polygon(r(t.coordinates));if("MultiPolygon"===t.type){for(var i=e.segments({inverted:!1,regions:[]}),n=0;n<t.coordinates.length;n++)i=e.selectUnion(e.combine(i,r(t.coordinates[n])));return e.polygon(i)}throw new Error("PolyBool: Cannot convert GeoJSON object to PolyBool polygon")},fromPolygon:function(e,t,r){function i(e,r){return t.pointInsideRegion([.5*(e[0][0]+e[1][0]),.5*(e[0][1]+e[1][1])],r)}function n(e){return{region:e,children:[]}}r=e.polygon(e.segments(r));var a=n(null);function s(e,t){for(var r=0;r<e.children.length;r++){if(i(t,(o=e.children[r]).region))return void s(o,t)}var a=n(t);for(r=0;r<e.children.length;r++){var o;i((o=e.children[r]).region,t)&&(a.children.push(o),e.children.splice(r,1),r--)}e.children.push(a)}for(var o=0;o<r.regions.length;o++){var l=r.regions[o];l.length<3||s(a,l)}function h(e,t){for(var r=0,i=e[e.length-1][0],n=e[e.length-1][1],a=[],s=0;s<e.length;s++){var o=e[s][0],l=e[s][1];a.push([o,l]),r+=l*i-o*n,i=o,n=l}return r<0!==t&&a.reverse(),a.push([a[0][0],a[0][1]]),a}var c=[];function u(e){var t=[h(e.region,!1)];c.push(t);for(var r=0;r<e.children.length;r++)t.push(d(e.children[r]))}function d(e){for(var t=0;t<e.children.length;t++)u(e.children[t]);return h(e.region,!0)}for(o=0;o<a.children.length;o++)u(a.children[o]);return c.length<=0?{type:"Polygon",coordinates:[]}:1==c.length?{type:"Polygon",coordinates:c[0]}:{type:"MultiPolygon",coordinates:c}}};t.exports=r})),f_e=$(((e,t)=>{var r,i=KEe(),n=QEe(),a=n_e(),s=s_e(),o=o_e(),l=c_e(),h=!1,c=n();function u(e,t,i){var n=r.segments(e),a=r.segments(t),s=i(r.combine(n,a));return r.polygon(s)}r={buildLog:function(e){return!0===e?h=i():!1===e&&(h=!1),!1!==h&&h.list},epsilon:function(e){return c.epsilon(e)},segments:function(e){var t=a(!0,c,h);return e.regions.forEach(t.addRegion),{segments:t.calculate(e.inverted),inverted:e.inverted}},combine:function(e,t){return{combined:a(!1,c,h).calculate(e.segments,e.inverted,t.segments,t.inverted),inverted1:e.inverted,inverted2:t.inverted}},selectUnion:function(e){return{segments:o.union(e.combined,h),inverted:e.inverted1||e.inverted2}},selectIntersect:function(e){return{segments:o.intersect(e.combined,h),inverted:e.inverted1&&e.inverted2}},selectDifference:function(e){return{segments:o.difference(e.combined,h),inverted:e.inverted1&&!e.inverted2}},selectDifferenceRev:function(e){return{segments:o.differenceRev(e.combined,h),inverted:!e.inverted1&&e.inverted2}},selectXor:function(e){return{segments:o.xor(e.combined,h),inverted:e.inverted1!==e.inverted2}},polygon:function(e){return{regions:s(e.segments,c,h),inverted:e.inverted}},polygonFromGeoJSON:function(e){return l.toPolygon(r,e)},polygonToGeoJSON:function(e){return l.fromPolygon(r,c,e)},union:function(e,t){return u(e,t,r.selectUnion)},intersect:function(e,t){return u(e,t,r.selectIntersect)},difference:function(e,t){return u(e,t,r.selectDifference)},differenceRev:function(e,t){return u(e,t,r.selectDifferenceRev)},xor:function(e,t){return u(e,t,r.selectXor)}},"object"==typeof window&&(window.PolyBool=r),t.exports=r})),r7=$(((e,t)=>{"use strict";t.exports=function(e,t){for(var r=new Array(arguments.length-1),i=0,n=2,a=!0;n<arguments.length;)r[i++]=arguments[n++];return new Promise((function(n,s){r[i]=function(e){if(a)if(a=!1,e)s(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];n.apply(null,t)}};try{e.apply(t||null,r)}catch(e){a&&(a=!1,s(e))}}))}})),xTe=$((e=>{"use strict";var t=e;t.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};var r,i=new Array(64),n=new Array(123);for(r=0;r<64;)n[i[r]=r<26?r+65:r<52?r+71:r<62?r-4:r-59|43]=r++;t.encode=function(e,t,r){for(var n,a=null,s=[],o=0,l=0;t<r;){var h=e[t++];switch(l){case 0:s[o++]=i[h>>2],n=(3&h)<<4,l=1;break;case 1:s[o++]=i[n|h>>4],n=(15&h)<<2,l=2;break;case 2:s[o++]=i[n|h>>6],s[o++]=i[63&h],l=0}o>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,s)),o=0)}return l&&(s[o++]=i[n],s[o++]=61,1===l&&(s[o++]=61)),a?(o&&a.push(String.fromCharCode.apply(String,s.slice(0,o))),a.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var a="invalid encoding";t.decode=function(e,t,r){for(var i,s=r,o=0,l=0;l<e.length;){var h=e.charCodeAt(l++);if(61===h&&o>1)break;if(void 0===(h=n[h]))throw Error(a);switch(o){case 0:i=h,o=1;break;case 1:t[r++]=i<<2|(48&h)>>4,i=h,o=2;break;case 2:t[r++]=(15&i)<<4|(60&h)>>2,i=h,o=3;break;case 3:t[r++]=(3&i)<<6|h,o=0}}if(1===o)throw Error(a);return r-s},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}})),_Te=$(((e,t)=>{"use strict";function r(){this._listeners={}}t.exports=r,r.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},r.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this},r.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}})),CTe=$(((e,t)=>{"use strict";function r(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),i=128===r[3];function n(e,i,n){t[0]=e,i[n]=r[0],i[n+1]=r[1],i[n+2]=r[2],i[n+3]=r[3]}function a(e,i,n){t[0]=e,i[n]=r[3],i[n+1]=r[2],i[n+2]=r[1],i[n+3]=r[0]}function s(e,i){return r[0]=e[i],r[1]=e[i+1],r[2]=e[i+2],r[3]=e[i+3],t[0]}function o(e,i){return r[3]=e[i],r[2]=e[i+1],r[1]=e[i+2],r[0]=e[i+3],t[0]}e.writeFloatLE=i?n:a,e.writeFloatBE=i?a:n,e.readFloatLE=i?s:o,e.readFloatBE=i?o:s}():function(){function t(e,t,r,i){var n=t<0?1:0;if(n&&(t=-t),0===t)e(1/t>0?0:2147483648,r,i);else if(isNaN(t))e(2143289344,r,i);else if(t>34028234663852886e22)e((n<<31|2139095040)>>>0,r,i);else if(t<11754943508222875e-54)e((n<<31|Math.round(t/1401298464324817e-60))>>>0,r,i);else{var a=Math.floor(Math.log(t)/Math.LN2);e((n<<31|a+127<<23|8388607&Math.round(t*Math.pow(2,-a)*8388608))>>>0,r,i)}}function r(e,t,r){var i=e(t,r),n=2*(i>>31)+1,a=i>>>23&255,s=8388607&i;return 255===a?s?NaN:n*(1/0):0===a?1401298464324817e-60*n*s:n*Math.pow(2,a-150)*(s+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,n),e.readFloatLE=r.bind(null,a),e.readFloatBE=r.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),i=128===r[7];function n(e,i,n){t[0]=e,i[n]=r[0],i[n+1]=r[1],i[n+2]=r[2],i[n+3]=r[3],i[n+4]=r[4],i[n+5]=r[5],i[n+6]=r[6],i[n+7]=r[7]}function a(e,i,n){t[0]=e,i[n]=r[7],i[n+1]=r[6],i[n+2]=r[5],i[n+3]=r[4],i[n+4]=r[3],i[n+5]=r[2],i[n+6]=r[1],i[n+7]=r[0]}function s(e,i){return r[0]=e[i],r[1]=e[i+1],r[2]=e[i+2],r[3]=e[i+3],r[4]=e[i+4],r[5]=e[i+5],r[6]=e[i+6],r[7]=e[i+7],t[0]}function o(e,i){return r[7]=e[i],r[6]=e[i+1],r[5]=e[i+2],r[4]=e[i+3],r[3]=e[i+4],r[2]=e[i+5],r[1]=e[i+6],r[0]=e[i+7],t[0]}e.writeDoubleLE=i?n:a,e.writeDoubleBE=i?a:n,e.readDoubleLE=i?s:o,e.readDoubleBE=i?o:s}():function(){function t(e,t,r,i,n,a){var s=i<0?1:0;if(s&&(i=-i),0===i)e(0,n,a+t),e(1/i>0?0:2147483648,n,a+r);else if(isNaN(i))e(0,n,a+t),e(2146959360,n,a+r);else if(i>17976931348623157e292)e(0,n,a+t),e((s<<31|2146435072)>>>0,n,a+r);else{var o;if(i<22250738585072014e-324)e((o=i/5e-324)>>>0,n,a+t),e((s<<31|o/4294967296)>>>0,n,a+r);else{var l=Math.floor(Math.log(i)/Math.LN2);1024===l&&(l=1023),e(4503599627370496*(o=i*Math.pow(2,-l))>>>0,n,a+t),e((s<<31|l+1023<<20|1048576*o&1048575)>>>0,n,a+r)}}}function r(e,t,r,i,n){var a=e(i,n+t),s=e(i,n+r),o=2*(s>>31)+1,l=s>>>20&2047,h=4294967296*(1048575&s)+a;return 2047===l?h?NaN:o*(1/0):0===l?5e-324*o*h:o*Math.pow(2,l-1075)*(h+4503599627370496)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,n,4,0),e.readDoubleLE=r.bind(null,a,0,4),e.readDoubleBE=r.bind(null,s,4,0)}(),e}function i(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function n(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function a(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}t.exports=r(r)})),n7=$(((exports,module)=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire})),ITe=$((e=>{"use strict";var t=e;t.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)(r=e.charCodeAt(i))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(i+1))?(++i,t+=4):t+=3;return t},t.read=function(e,t,r){if(r-t<1)return"";for(var i,n=null,a=[],s=0;t<r;)(i=e[t++])<128?a[s++]=i:i>191&&i<224?a[s++]=(31&i)<<6|63&e[t++]:i>239&&i<365?(i=((7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,a[s++]=55296+(i>>10),a[s++]=56320+(1023&i)):a[s++]=(15&i)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,a)),s=0);return n?(s&&n.push(String.fromCharCode.apply(String,a.slice(0,s))),n.join("")):String.fromCharCode.apply(String,a.slice(0,s))},t.write=function(e,t,r){for(var i,n,a=r,s=0;s<e.length;++s)(i=e.charCodeAt(s))<128?t[r++]=i:i<2048?(t[r++]=i>>6|192,t[r++]=63&i|128):55296==(64512&i)&&56320==(64512&(n=e.charCodeAt(s+1)))?(i=65536+((1023&i)<<10)+(1023&n),++s,t[r++]=i>>18|240,t[r++]=i>>12&63|128,t[r++]=i>>6&63|128,t[r++]=63&i|128):(t[r++]=i>>12|224,t[r++]=i>>6&63|128,t[r++]=63&i|128);return r-a}})),DTe=$(((e,t)=>{"use strict";t.exports=function(e,t,r){var i=r||8192,n=i>>>1,a=null,s=i;return function(r){if(r<1||r>n)return e(r);s+r>i&&(a=e(i),s=0);var o=t.call(a,s,s+=r);return 7&s&&(s=1+(7|s)),o}}})),kTe=$(((e,t)=>{"use strict";t.exports=i;var r=qh();function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var n=i.zero=new i(0,0);n.toNumber=function(){return 0},n.zzEncode=n.zzDecode=function(){return this},n.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return n;var t=e<0;t&&(e=-e);var r=e>>>0,a=(e-r)/4294967296>>>0;return t&&(a=~a>>>0,r=~r>>>0,++r>4294967295&&(r=0,++a>4294967295&&(a=0))),new i(r,a)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(r.isString(e)){if(!r.Long)return i.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):n},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var s=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?n:new i((s.call(e,0)|s.call(e,1)<<8|s.call(e,2)<<16|s.call(e,3)<<24)>>>0,(s.call(e,4)|s.call(e,5)<<8|s.call(e,6)<<16|s.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}})),qh=$((e=>{"use strict";var t=e;function r(e,t,r){for(var i=Object.keys(t),n=0;n<i.length;++n)(void 0===e[i[n]]||!r)&&(e[i[n]]=t[i[n]]);return e}function i(e){function t(e,i){if(!(this instanceof t))return new t(e,i);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),i&&r(this,i)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}t.asPromise=r7(),t.base64=xTe(),t.EventEmitter=_Te(),t.float=CTe(),t.inquire=n7(),t.utf8=ITe(),t.pool=DTe(),t.LongBits=kTe(),t.isNode=Boolean("undefined"!=typeof global&&global&&global.process&&global.process.versions&&global.process.versions.node),t.global=t.isNode&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||e,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"==typeof e},t.isset=t.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,r){var i=t.LongBits.fromHash(e);return t.Long?t.Long.fromBits(i.lo,i.hi,r):i.toNumber(Boolean(r))},t.merge=r,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=i,t.ProtocolError=i("ProtocolError"),t.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},t.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}})),TO=$(((e,t)=>{"use strict";t.exports=c;var r,i=qh(),n=i.LongBits,a=i.base64,s=i.utf8;function o(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function l(){}function h(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function c(){this.len=0,this.head=new o(l,0,0),this.tail=this.head,this.states=null}var u=function(){return i.Buffer?function(){return(c.create=function(){return new r})()}:function(){return new c}};function d(e,t,r){t[r]=255&e}function p(e,t){this.len=e,this.next=void 0,this.val=t}function f(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function m(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}c.create=u(),c.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(c.alloc=i.pool(c.alloc,i.Array.prototype.subarray)),c.prototype._push=function(e,t,r){return this.tail=this.tail.next=new o(e,t,r),this.len+=t,this},p.prototype=Object.create(o.prototype),p.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},c.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new p((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},c.prototype.int32=function(e){return e<0?this._push(f,10,n.fromNumber(e)):this.uint32(e)},c.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},c.prototype.uint64=function(e){var t=n.from(e);return this._push(f,t.length(),t)},c.prototype.int64=c.prototype.uint64,c.prototype.sint64=function(e){var t=n.from(e).zzEncode();return this._push(f,t.length(),t)},c.prototype.bool=function(e){return this._push(d,1,e?1:0)},c.prototype.fixed32=function(e){return this._push(m,4,e>>>0)},c.prototype.sfixed32=c.prototype.fixed32,c.prototype.fixed64=function(e){var t=n.from(e);return this._push(m,4,t.lo)._push(m,4,t.hi)},c.prototype.sfixed64=c.prototype.fixed64,c.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},c.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var g=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};c.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(d,1,0);if(i.isString(e)){var r=c.alloc(t=a.length(e));a.decode(e,r,0),e=r}return this.uint32(t)._push(g,t,e)},c.prototype.string=function(e){var t=s.length(e);return t?this.uint32(t)._push(s.write,t,e):this._push(d,1,0)},c.prototype.fork=function(){return this.states=new h(this),this.head=this.tail=new o(l,0,0),this.len=0,this},c.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new o(l,0,0),this.len=0),this},c.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},c.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},c._configure=function(e){r=e,c.create=u(),r._configure()}})),qTe=$(((e,t)=>{"use strict";t.exports=n;var r=TO();(n.prototype=Object.create(r.prototype)).constructor=n;var i=qh();function n(){r.call(this)}function a(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}n._configure=function(){n.alloc=i._Buffer_allocUnsafe,n.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}},n.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(n.writeBytesBuffer,t,e),this},n.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},n._configure()})),SO=$(((e,t)=>{"use strict";t.exports=o;var r,i=qh(),n=i.LongBits,a=i.utf8;function s(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function o(e){this.buf=e,this.pos=0,this.len=e.length}var l,h="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new o(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new o(e);throw Error("illegal buffer")},c=function(){return i.Buffer?function(e){return(o.create=function(e){return i.Buffer.isBuffer(e)?new r(e):h(e)})(e)}:h};function u(){var e=new n(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw s(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw s(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw s(this,8);return new n(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}o.create=c(),o.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,o.prototype.uint32=(l=4294967295,function(){if(l=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(l=(l|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(l=(l|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(l=(l|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(l=(l|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return l;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return l}),o.prototype.int32=function(){return 0|this.uint32()},o.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},o.prototype.bool=function(){return 0!==this.uint32()},o.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return d(this.buf,this.pos+=4)},o.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|d(this.buf,this.pos+=4)},o.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},o.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},o.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw s(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var n=i.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)},o.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},o.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw s(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},o.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},o._configure=function(e){r=e,o.create=c(),r._configure();var t=i.Long?"toLong":"toNumber";i.merge(o.prototype,{int64:function(){return u.call(this)[t](!1)},uint64:function(){return u.call(this)[t](!0)},sint64:function(){return u.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}})),QTe=$(((e,t)=>{"use strict";t.exports=n;var r=SO();(n.prototype=Object.create(r.prototype)).constructor=n;var i=qh();function n(e){r.call(this,e)}n._configure=function(){i.Buffer&&(n.prototype._slice=i.Buffer.prototype.slice)},n.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},n._configure()})),twe=$(((e,t)=>{"use strict";t.exports=i;var r=qh();function i(e,t,i){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(i)}(i.prototype=Object.create(r.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,i,n,a,s){if(!a)throw TypeError("request must be specified");var o=this;if(!s)return r.asPromise(e,o,t,i,n,a);if(o.rpcImpl)try{return o.rpcImpl(t,i[o.requestDelimited?"encodeDelimited":"encode"](a).finish(),(function(e,r){if(e)return o.emit("error",e,t),s(e);if(null!==r){if(!(r instanceof n))try{r=n[o.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return o.emit("error",e,t),s(e)}return o.emit("data",r,t),s(null,r)}o.end(!0)}))}catch(e){return o.emit("error",e,t),void setTimeout((function(){s(e)}),0)}else setTimeout((function(){s(Error("already ended"))}),0)},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}})),m7=$((e=>{"use strict";e.Service=twe()})),g7=$(((e,t)=>{"use strict";t.exports={}})),awe=$((e=>{"use strict";var t=e;function r(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}t.build="minimal",t.Writer=TO(),t.BufferWriter=qTe(),t.Reader=SO(),t.BufferReader=QTe(),t.util=qh(),t.rpc=m7(),t.roots=g7(),t.configure=r,r()})),lwe=$(((e,t)=>{"use strict";function r(e,t){"string"==typeof e&&(t=e,e=void 0);var i=[];function n(e){if("string"!=typeof e){var t=a();if(r.verbose&&console.log("codegen: "+t),t="return "+t,e){for(var s=Object.keys(e),o=new Array(s.length+1),l=new Array(s.length),h=0;h<s.length;)o[h]=s[h],l[h]=e[s[h++]];return o[h]=t,Function.apply(null,o).apply(null,l)}return Function(t)()}for(var c=new Array(arguments.length-1),u=0;u<c.length;)c[u]=arguments[++u];if(u=0,e=e.replace(/%([%dfijs])/g,(function(e,t){var r=c[u++];switch(t){case"d":case"f":return String(Number(r));case"i":return String(Math.floor(r));case"j":return JSON.stringify(r);case"s":return String(r)}return"%"})),u!==c.length)throw Error("parameter count mismatch");return i.push(e),n}function a(r){return"function "+(r||t||"")+"("+(e&&e.join(",")||"")+"){\n  "+i.join("\n  ")+"\n}"}return n.toString=a,n}t.exports=r,r.verbose=!1})),uwe=$(((e,t)=>{"use strict";t.exports=n;var r=r7(),i=n7()("fs");function n(e,t,a){return"function"==typeof t?(a=t,t={}):t||(t={}),a?!t.xhr&&i&&i.readFile?i.readFile(e,(function(r,i){return r&&"undefined"!=typeof XMLHttpRequest?n.xhr(e,t,a):r?a(r):a(null,t.binary?i:i.toString("utf8"))})):n.xhr(e,t,a):r(n,this,e,t)}n.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===i.readyState){if(0!==i.status&&200!==i.status)return r(Error("status "+i.status));if(t.binary){var e=i.response;if(!e){e=[];for(var n=0;n<i.responseText.length;++n)e.push(255&i.responseText.charCodeAt(n))}return r(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}})),fwe=$((e=>{"use strict";var t=e,r=t.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},i=t.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),i=r(e),n="";i&&(n=t.shift()+"/");for(var a=0;a<t.length;)".."===t[a]?a>0&&".."!==t[a-1]?t.splice(--a,2):i?t.splice(a,1):++a:"."===t[a]?t.splice(a,1):++a;return n+t.join("/")};t.resolve=function(e,t,n){return n||(t=i(t)),r(t)?t:(n||(e=i(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?i(e+"/"+t):t)}})),R0=$((e=>{"use strict";var t=e,r=wa(),i=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function n(e,t){var r=0,n={};for(t|=0;r<e.length;)n[i[r+t]]=e[r++];return n}t.basic=n([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),t.defaults=n([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",r.emptyArray,null]),t.long=n([0,0,0,1,1],7),t.mapKey=n([0,0,0,5,5,0,0,0,1,1,0,2],2),t.packed=n([1,5,0,0,0,5,5,0,0,0,1,1,0])})),hm=$(((e,t)=>{"use strict";t.exports=l;var r=C0();((l.prototype=Object.create(r.prototype)).constructor=l).className="Field";var i,n=zu(),a=R0(),s=wa(),o=/^required|optional|repeated$/;function l(e,t,i,n,l,h,c){if(s.isObject(n)?(c=l,h=n,n=l=void 0):s.isObject(l)&&(c=h,h=l,l=void 0),r.call(this,e,h),!s.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!s.isString(i))throw TypeError("type must be a string");if(void 0!==n&&!o.test(n=n.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==l&&!s.isString(l))throw TypeError("extend must be a string");"proto3_optional"===n&&(n="optional"),this.rule=n&&"optional"!==n?n:void 0,this.type=i,this.id=t,this.extend=l||void 0,this.required="required"===n,this.optional=!this.required,this.repeated="repeated"===n,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!s.Long&&void 0!==a.long[i],this.bytes="bytes"===i,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=c}l.fromJSON=function(e,t){return new l(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)},Object.defineProperty(l.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),l.prototype.setOption=function(e,t,i){return"packed"===e&&(this._packed=null),r.prototype.setOption.call(this,e,t,i)},l.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return s.toObject(["rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},l.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=a.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof i?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof n&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((!0===this.options.packed||void 0!==this.options.packed&&this.resolvedType&&!(this.resolvedType instanceof n))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=s.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;s.base64.test(this.typeDefault)?s.base64.decode(this.typeDefault,e=s.newBuffer(s.base64.length(this.typeDefault)),0):s.utf8.write(this.typeDefault,e=s.newBuffer(s.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=s.emptyObject:this.repeated?this.defaultValue=s.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof i&&(this.parent.ctor.prototype[this.name]=this.defaultValue),r.prototype.resolve.call(this)},l.d=function(e,t,r,i){return"function"==typeof t?t=s.decorateType(t).name:t&&"object"==typeof t&&(t=s.decorateEnum(t).name),function(n,a){s.decorateType(n.constructor).add(new l(a,e,t,r,{default:i}))}},l._configure=function(e){i=e}})),_b=$(((e,t)=>{"use strict";t.exports=a;var r=C0();((a.prototype=Object.create(r.prototype)).constructor=a).className="OneOf";var i=hm(),n=wa();function a(e,t,i,n){if(Array.isArray(t)||(i=t,t=void 0),r.call(this,e,i),void 0!==t&&!Array.isArray(t))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=n}function s(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}a.fromJSON=function(e,t){return new a(e,t.oneof,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return n.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},a.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,s(this),this},a.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},a.prototype.onAdd=function(e){r.prototype.onAdd.call(this,e);for(var t=0;t<this.oneof.length;++t){var i=e.get(this.oneof[t]);i&&!i.partOf&&(i.partOf=this,this.fieldsArray.push(i))}s(this)},a.prototype.onRemove=function(e){for(var t,i=0;i<this.fieldsArray.length;++i)(t=this.fieldsArray[i]).parent&&t.parent.remove(t);r.prototype.onRemove.call(this,e)},a.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,r){n.decorateType(t.constructor).add(new a(r,e)),Object.defineProperty(t,r,{get:n.oneOfGetter(e),set:n.oneOfSetter(e)})}}})),Sb=$(((e,t)=>{"use strict";t.exports=c;var r=C0();((c.prototype=Object.create(r.prototype)).constructor=c).className="Namespace";var i,n,a,s=hm(),o=wa(),l=_b();function h(e,t){if(e&&e.length){for(var r={},i=0;i<e.length;++i)r[e[i].name]=e[i].toJSON(t);return r}}function c(e,t){r.call(this,e,t),this.nested=void 0,this._nestedArray=null}function u(e){return e._nestedArray=null,e}c.fromJSON=function(e,t){return new c(e,t.options).addJSON(t.nested)},c.arrayToJSON=h,c.isReservedId=function(e,t){if(e)for(var r=0;r<e.length;++r)if("string"!=typeof e[r]&&e[r][0]<=t&&e[r][1]>t)return!0;return!1},c.isReservedName=function(e,t){if(e)for(var r=0;r<e.length;++r)if(e[r]===t)return!0;return!1},Object.defineProperty(c.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=o.toArray(this.nested))}}),c.prototype.toJSON=function(e){return o.toObject(["options",this.options,"nested",h(this.nestedArray,e)])},c.prototype.addJSON=function(e){if(e)for(var t,r=Object.keys(e),o=0;o<r.length;++o)t=e[r[o]],this.add((void 0!==t.fields?i.fromJSON:void 0!==t.values?a.fromJSON:void 0!==t.methods?n.fromJSON:void 0!==t.id?s.fromJSON:c.fromJSON)(r[o],t));return this},c.prototype.get=function(e){return this.nested&&this.nested[e]||null},c.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof a)return this.nested[e].values;throw Error("no such enum: "+e)},c.prototype.add=function(e){if(!(e instanceof s&&void 0!==e.extend||e instanceof i||e instanceof l||e instanceof a||e instanceof n||e instanceof c))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t){if(!(t instanceof c&&e instanceof c)||t instanceof i||t instanceof n)throw Error("duplicate name '"+e.name+"' in "+this);for(var r=t.nestedArray,o=0;o<r.length;++o)e.add(r[o]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}}else this.nested={};return this.nested[e.name]=e,e.onAdd(this),u(this)},c.prototype.remove=function(e){if(!(e instanceof r))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),u(this)},c.prototype.define=function(e,t){if(o.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(!((r=r.nested[i])instanceof c))throw Error("path conflicts with non-namespace objects")}else r.add(r=new c(i))}return t&&r.addJSON(t),r},c.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof c?e[t++].resolveAll():e[t++].resolve();return this.resolve()},c.prototype.lookup=function(e,t,r){if("boolean"==typeof t?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),o.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;if(""===e[0])return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(1===e.length){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof c&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var n=0;n<this.nestedArray.length;++n)if(this._nestedArray[n]instanceof c&&(i=this._nestedArray[n].lookup(e,t,!0)))return i;return null===this.parent||r?null:this.parent.lookup(e,t)},c.prototype.lookupType=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such type: "+e);return t},c.prototype.lookupEnum=function(e){var t=this.lookup(e,[a]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},c.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[i,a]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},c.prototype.lookupService=function(e){var t=this.lookup(e,[n]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},c._configure=function(e,t,r){i=e,n=t,a=r}})),PO=$(((e,t)=>{"use strict";t.exports=a;var r=hm();((a.prototype=Object.create(r.prototype)).constructor=a).className="MapField";var i=R0(),n=wa();function a(e,t,i,a,s,o){if(r.call(this,e,t,a,void 0,void 0,s,o),!n.isString(i))throw TypeError("keyType must be a string");this.keyType=i,this.resolvedKeyType=null,this.map=!0}a.fromJSON=function(e,t){return new a(e,t.id,t.keyType,t.type,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return n.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},a.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return r.prototype.resolve.call(this)},a.d=function(e,t,r){return"function"==typeof r?r=n.decorateType(r).name:r&&"object"==typeof r&&(r=n.decorateEnum(r).name),function(i,s){n.decorateType(i.constructor).add(new a(s,e,t,r))}}})),IO=$(((e,t)=>{"use strict";t.exports=n;var r=C0();((n.prototype=Object.create(r.prototype)).constructor=n).className="Method";var i=wa();function n(e,t,n,a,s,o,l,h,c){if(i.isObject(s)?(l=s,s=o=void 0):i.isObject(o)&&(l=o,o=void 0),void 0!==t&&!i.isString(t))throw TypeError("type must be a string");if(!i.isString(n))throw TypeError("requestType must be a string");if(!i.isString(a))throw TypeError("responseType must be a string");r.call(this,e,l),this.type=t||"rpc",this.requestType=n,this.requestStream=!!s||void 0,this.responseType=a,this.responseStream=!!o||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=h,this.parsedOptions=c}n.fromJSON=function(e,t){return new n(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},n.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},n.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),r.prototype.resolve.call(this))}})),OO=$(((e,t)=>{"use strict";t.exports=s;var r=Sb();((s.prototype=Object.create(r.prototype)).constructor=s).className="Service";var i=IO(),n=wa(),a=m7();function s(e,t){r.call(this,e,t),this.methods={},this._methodsArray=null}function o(e){return e._methodsArray=null,e}s.fromJSON=function(e,t){var r=new s(e,t.options);if(t.methods)for(var n=Object.keys(t.methods),a=0;a<n.length;++a)r.add(i.fromJSON(n[a],t.methods[n[a]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r},s.prototype.toJSON=function(e){var t=r.prototype.toJSON.call(this,e),i=!!e&&Boolean(e.keepComments);return n.toObject(["options",t&&t.options||void 0,"methods",r.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",i?this.comment:void 0])},Object.defineProperty(s.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=n.toArray(this.methods))}}),s.prototype.get=function(e){return this.methods[e]||r.prototype.get.call(this,e)},s.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return r.prototype.resolve.call(this)},s.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,o(this)):r.prototype.add.call(this,e)},s.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,o(this)}return r.prototype.remove.call(this,e)},s.prototype.create=function(e,t,r){for(var i,s=new a.Service(e,t,r),o=0;o<this.methodsArray.length;++o){var l=n.lcFirst((i=this._methodsArray[o]).resolve().name).replace(/[^$\w_]/g,"");s[l]=n.codegen(["r","c"],n.isReserved(l)?l+"_":l)("return this.rpcCall(m,q,s,r,c)")({m:i,q:i.resolvedRequestType.ctor,s:i.resolvedResponseType.ctor})}return s}})),DO=$(((e,t)=>{"use strict";t.exports=i;var r=qh();function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)this[t[r]]=e[t[r]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,r.toJSONOptions)}})),M7=$(((e,t)=>{"use strict";t.exports=function(e){var t=n.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter((function(e){return e.map})).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var s=0;s<e.fieldsArray.length;++s){var o=e._fieldsArray[s].resolve(),l=o.resolvedType instanceof r?"int32":o.type,h="m"+n.safeProp(o.name);t("case %i: {",o.id),o.map?(t("if(%s===util.emptyObject)",h)("%s={}",h)("var c2 = r.uint32()+r.pos"),void 0!==i.defaults[o.keyType]?t("k=%j",i.defaults[o.keyType]):t("k=null"),void 0!==i.defaults[l]?t("value=%j",i.defaults[l]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",o.keyType)("case 2:"),void 0===i.basic[l]?t("value=types[%i].decode(r,r.uint32())",s):t("value=r.%s()",l),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),void 0!==i.long[o.keyType]?t('%s[typeof k==="object"?util.longToHash(k):k]=value',h):t("%s[k]=value",h)):o.repeated?(t("if(!(%s&&%s.length))",h,h)("%s=[]",h),void 0!==i.packed[l]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",h,l)("}else"),void 0===i.basic[l]?t(o.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",h,s):t("%s.push(r.%s())",h,l)):void 0===i.basic[l]?t(o.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",h,s):t("%s=r.%s()",h,l),t("break")("}")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),s=0;s<e._fieldsArray.length;++s){var c=e._fieldsArray[s];c.required&&t("if(!m.hasOwnProperty(%j))",c.name)("throw util.ProtocolError(%j,{instance:m})",a(c))}return t("return m")};var r=zu(),i=R0(),n=wa();function a(e){return"missing required '"+e.name+"'"}})),C7=$(((e,t)=>{"use strict";t.exports=function(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),r=e.oneofsArray,o={};r.length&&t("var p={}");for(var l=0;l<e.fieldsArray.length;++l){var h=e._fieldsArray[l].resolve(),c="m"+i.safeProp(h.name);if(h.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",c,h.name),h.map)t("if(!util.isObject(%s))",c)("return%j",n(h,"object"))("var k=Object.keys(%s)",c)("for(var i=0;i<k.length;++i){"),s(t,h,"k[i]"),a(t,h,l,c+"[k[i]]")("}");else if(h.repeated)t("if(!Array.isArray(%s))",c)("return%j",n(h,"array"))("for(var i=0;i<%s.length;++i){",c),a(t,h,l,c+"[i]")("}");else{if(h.partOf){var u=i.safeProp(h.partOf.name);1===o[h.partOf.name]&&t("if(p%s===1)",u)("return%j",h.partOf.name+": multiple values"),o[h.partOf.name]=1,t("p%s=1",u)}a(t,h,l,c)}h.optional&&t("}")}return t("return null")};var r=zu(),i=wa();function n(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function a(e,t,i,a){if(t.resolvedType)if(t.resolvedType instanceof r){e("switch(%s){",a)("default:")("return%j",n(t,"enum value"));for(var s=Object.keys(t.resolvedType.values),o=0;o<s.length;++o)e("case %i:",t.resolvedType.values[s[o]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",i,a)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",a)("return%j",n(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",a,a,a,a)("return%j",n(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',a)("return%j",n(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',a)("return%j",n(t,"boolean"));break;case"string":e("if(!util.isString(%s))",a)("return%j",n(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',a,a,a)("return%j",n(t,"buffer"))}return e}function s(e,t,r){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",r)("return%j",n(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",r)("return%j",n(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",r)("return%j",n(t,"boolean key"))}return e}})),O7=$((e=>{"use strict";var t=e,r=zu(),i=wa();function n(e,t,i,n){var a=!1;if(t.resolvedType)if(t.resolvedType instanceof r){e("switch(d%s){",n);for(var s=t.resolvedType.values,o=Object.keys(s),l=0;l<o.length;++l)s[o[l]]===t.typeDefault&&!a&&(e("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',n,n,n),t.repeated||e("break"),a=!0),e("case%j:",o[l])("case %i:",s[o[l]])("m%s=%j",n,s[o[l]])("break");e("}")}else e('if(typeof d%s!=="object")',n)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",n,i,n);else{var h=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",n,n);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",n,n);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",n,n);break;case"uint64":h=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",n,n,h)('else if(typeof d%s==="string")',n)("m%s=parseInt(d%s,10)",n,n)('else if(typeof d%s==="number")',n)("m%s=d%s",n,n)('else if(typeof d%s==="object")',n)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",n,n,n,h?"true":"");break;case"bytes":e('if(typeof d%s==="string")',n)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",n,n,n)("else if(d%s.length >= 0)",n)("m%s=d%s",n,n);break;case"string":e("m%s=String(d%s)",n,n);break;case"bool":e("m%s=Boolean(d%s)",n,n)}}return e}function a(e,t,i,n){if(t.resolvedType)t.resolvedType instanceof r?e("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",n,i,n,n,i,n,n):e("d%s=types[%i].toObject(m%s,o)",n,i,n);else{var a=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",n,n,n,n);break;case"uint64":a=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',n)("d%s=o.longs===String?String(m%s):m%s",n,n,n)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",n,n,n,n,a?"true":"",n);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",n,n,n,n,n);break;default:e("d%s=m%s",n,n)}}return e}t.fromObject=function(e){var t=e.fieldsArray,a=i.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return a("return new this.ctor");a("var m=new this.ctor");for(var s=0;s<t.length;++s){var o=t[s].resolve(),l=i.safeProp(o.name);o.map?(a("if(d%s){",l)('if(typeof d%s!=="object")',l)("throw TypeError(%j)",o.fullName+": object expected")("m%s={}",l)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",l),n(a,o,s,l+"[ks[i]]")("}")("}")):o.repeated?(a("if(d%s){",l)("if(!Array.isArray(d%s))",l)("throw TypeError(%j)",o.fullName+": array expected")("m%s=[]",l)("for(var i=0;i<d%s.length;++i){",l),n(a,o,s,l+"[i]")("}")("}")):(o.resolvedType instanceof r||a("if(d%s!=null){",l),n(a,o,s,l),o.resolvedType instanceof r||a("}"))}return a("return m")},t.toObject=function(e){var t=e.fieldsArray.slice().sort(i.compareFieldsById);if(!t.length)return i.codegen()("return {}");for(var n=i.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),s=[],o=[],l=[],h=0;h<t.length;++h)t[h].partOf||(t[h].resolve().repeated?s:t[h].map?o:l).push(t[h]);if(s.length){for(n("if(o.arrays||o.defaults){"),h=0;h<s.length;++h)n("d%s=[]",i.safeProp(s[h].name));n("}")}if(o.length){for(n("if(o.objects||o.defaults){"),h=0;h<o.length;++h)n("d%s={}",i.safeProp(o[h].name));n("}")}if(l.length){for(n("if(o.defaults){"),h=0;h<l.length;++h){var c=l[h],u=i.safeProp(c.name);if(c.resolvedType instanceof r)n("d%s=o.enums===String?%j:%j",u,c.resolvedType.valuesById[c.typeDefault],c.typeDefault);else if(c.long)n("if(util.Long){")("var n=new util.Long(%i,%i,%j)",c.typeDefault.low,c.typeDefault.high,c.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",u)("}else")("d%s=o.longs===String?%j:%i",u,c.typeDefault.toString(),c.typeDefault.toNumber());else if(c.bytes){var d="["+Array.prototype.slice.call(c.typeDefault).join(",")+"]";n("if(o.bytes===String)d%s=%j",u,String.fromCharCode.apply(String,c.typeDefault))("else{")("d%s=%s",u,d)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",u,u)("}")}else n("d%s=%j",u,c.typeDefault)}n("}")}var p=!1;for(h=0;h<t.length;++h){c=t[h];var f=e._fieldsArray.indexOf(c);u=i.safeProp(c.name);c.map?(p||(p=!0,n("var ks2")),n("if(m%s&&(ks2=Object.keys(m%s)).length){",u,u)("d%s={}",u)("for(var j=0;j<ks2.length;++j){"),a(n,c,f,u+"[ks2[j]]")("}")):c.repeated?(n("if(m%s&&m%s.length){",u,u)("d%s=[]",u)("for(var j=0;j<m%s.length;++j){",u),a(n,c,f,u+"[j]")("}")):(n("if(m%s!=null&&m.hasOwnProperty(%j)){",u,c.name),a(n,c,f,u),c.partOf&&n("if(o.oneofs)")("d%s=%j",i.safeProp(c.partOf.name),c.name)),n("}")}return n("return d")}})),D7=$((e=>{"use strict";var t=e,r=DO();t[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),r=this.lookup(t);if(r){var i="."===e["@type"].charAt(0)?e["@type"].slice(1):e["@type"];return-1===i.indexOf("/")&&(i="/"+i),this.create({type_url:i,value:r.encode(r.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var i="",n="";if(t&&t.json&&e.type_url&&e.value){n=e.type_url.substring(e.type_url.lastIndexOf("/")+1),i=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var a=this.lookup(n);a&&(e=a.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof r){var s=e.$type.toObject(e,t);return""===i&&(i="type.googleapis.com/"),n=i+("."===e.$type.fullName[0]?e.$type.fullName.slice(1):e.$type.fullName),s["@type"]=n,s}return this.toObject(e,t)}}})),FO=$(((e,t)=>{"use strict";t.exports=v;var r=Sb();((v.prototype=Object.create(r.prototype)).constructor=v).className="Type";var i=zu(),n=_b(),a=hm(),s=PO(),o=OO(),l=DO(),h=SO(),c=TO(),u=wa(),d=B7(),p=M7(),f=C7(),m=O7(),g=D7();function v(e,t){r.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function y(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(v.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var r=this.fields[e[t]],i=r.id;if(this._fieldsById[i])throw Error("duplicate id "+i+" in "+this);this._fieldsById[i]=r}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=u.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=u.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=v.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof l||((e.prototype=new l).constructor=e,u.merge(e.prototype,t)),e.$type=e.prototype.$type=this,u.merge(e,l,!0),this._ctor=e;for(var r=0;r<this.fieldsArray.length;++r)this._fieldsArray[r].resolve();var i={};for(r=0;r<this.oneofsArray.length;++r)i[this._oneofsArray[r].resolve().name]={get:u.oneOfGetter(this._oneofsArray[r].oneof),set:u.oneOfSetter(this._oneofsArray[r].oneof)};r&&Object.defineProperties(e.prototype,i)}}}),v.generateConstructor=function(e){for(var t,r=u.codegen(["p"],e.name),i=0;i<e.fieldsArray.length;++i)(t=e._fieldsArray[i]).map?r("this%s={}",u.safeProp(t.name)):t.repeated&&r("this%s=[]",u.safeProp(t.name));return r("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},v.fromJSON=function(e,t){var l=new v(e,t.options);l.extensions=t.extensions,l.reserved=t.reserved;for(var h=Object.keys(t.fields),c=0;c<h.length;++c)l.add((void 0!==t.fields[h[c]].keyType?s.fromJSON:a.fromJSON)(h[c],t.fields[h[c]]));if(t.oneofs)for(h=Object.keys(t.oneofs),c=0;c<h.length;++c)l.add(n.fromJSON(h[c],t.oneofs[h[c]]));if(t.nested)for(h=Object.keys(t.nested),c=0;c<h.length;++c){var u=t.nested[h[c]];l.add((void 0!==u.id?a.fromJSON:void 0!==u.fields?v.fromJSON:void 0!==u.values?i.fromJSON:void 0!==u.methods?o.fromJSON:r.fromJSON)(h[c],u))}return t.extensions&&t.extensions.length&&(l.extensions=t.extensions),t.reserved&&t.reserved.length&&(l.reserved=t.reserved),t.group&&(l.group=!0),t.comment&&(l.comment=t.comment),l},v.prototype.toJSON=function(e){var t=r.prototype.toJSON.call(this,e),i=!!e&&Boolean(e.keepComments);return u.toObject(["options",t&&t.options||void 0,"oneofs",r.arrayToJSON(this.oneofsArray,e),"fields",r.arrayToJSON(this.fieldsArray.filter((function(e){return!e.declaringField})),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",i?this.comment:void 0])},v.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var i=this.oneofsArray;for(t=0;t<i.length;)i[t++].resolve();return r.prototype.resolveAll.call(this)},v.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},v.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof a&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),y(this)}return e instanceof n?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),y(this)):r.prototype.add.call(this,e)},v.prototype.remove=function(e){if(e instanceof a&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),y(this)}if(e instanceof n){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),y(this)}return r.prototype.remove.call(this,e)},v.prototype.isReservedId=function(e){return r.isReservedId(this.reserved,e)},v.prototype.isReservedName=function(e){return r.isReservedName(this.reserved,e)},v.prototype.create=function(e){return new this.ctor(e)},v.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=d(this)({Writer:c,types:t,util:u}),this.decode=p(this)({Reader:h,types:t,util:u}),this.verify=f(this)({types:t,util:u}),this.fromObject=m.fromObject(this)({types:t,util:u}),this.toObject=m.toObject(this)({types:t,util:u});var i=g[e];if(i){var n=Object.create(this);n.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(n),n.toObject=this.toObject,this.toObject=i.toObject.bind(n)}return this},v.prototype.encode=function(e,t){return this.setup().encode(e,t)},v.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},v.prototype.decode=function(e,t){return this.setup().decode(e,t)},v.prototype.decodeDelimited=function(e){return e instanceof h||(e=h.create(e)),this.decode(e,e.uint32())},v.prototype.verify=function(e){return this.setup().verify(e)},v.prototype.fromObject=function(e){return this.setup().fromObject(e)},v.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},v.d=function(e){return function(t){u.decorateType(t,e)}}})),UO=$(((e,t)=>{"use strict";t.exports=c;var r=Sb();((c.prototype=Object.create(r.prototype)).constructor=c).className="Root";var i,n,a,s=hm(),o=zu(),l=_b(),h=wa();function c(e){r.call(this,"",e),this.deferred=[],this.files=[]}function u(){}c.fromJSON=function(e,t){return t||(t=new c),e.options&&t.setOptions(e.options),t.addJSON(e.nested)},c.prototype.resolvePath=h.path.resolve,c.prototype.fetch=h.fetch,c.prototype.load=function e(t,r,i){"function"==typeof r&&(i=r,r=void 0);var s=this;if(!i)return h.asPromise(e,s,t,r);var o=i===u;function l(e,t){if(i){var r=i;if(i=null,o)throw e;r(e,t)}}function c(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var r=e.substring(t);if(r in a)return r}return null}function d(e,t){try{if(h.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),h.isString(t)){n.filename=e;var i,a=n(t,s,r),u=0;if(a.imports)for(;u<a.imports.length;++u)(i=c(a.imports[u])||s.resolvePath(e,a.imports[u]))&&p(i);if(a.weakImports)for(u=0;u<a.weakImports.length;++u)(i=c(a.weakImports[u])||s.resolvePath(e,a.weakImports[u]))&&p(i,!0)}else s.setOptions(t.options).addJSON(t.nested)}catch(e){l(e)}!o&&!f&&l(null,s)}function p(e,t){if(e=c(e)||e,!(s.files.indexOf(e)>-1)){if(s.files.push(e),e in a)return void(o?d(e,a[e]):(++f,setTimeout((function(){--f,d(e,a[e])}))));if(o){var r;try{r=h.fs.readFileSync(e).toString("utf8")}catch(e){return void(t||l(e))}d(e,r)}else++f,s.fetch(e,(function(r,n){if(--f,i){if(r)return void(t?f||l(null,s):l(r));d(e,n)}}))}}var f=0;h.isString(t)&&(t=[t]);for(var m,g=0;g<t.length;++g)(m=s.resolvePath("",t[g]))&&p(m);if(o)return s;f||l(null,s)},c.prototype.loadSync=function(e,t){if(!h.isNode)throw Error("not supported");return this.load(e,t,u)},c.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map((function(e){return"'extend "+e.extend+"' in "+e.parent.fullName})).join(", "));return r.prototype.resolveAll.call(this)};var d=/^[A-Z]/;function p(e,t){var r=t.parent.lookup(t.extend);if(r){var i=new s(t.fullName,t.id,t.type,t.rule,void 0,t.options);return r.get(i.name)||(i.declaringField=t,t.extensionField=i,r.add(i)),!0}return!1}c.prototype._handleAdd=function(e){if(e instanceof s)void 0!==e.extend&&!e.extensionField&&(p(0,e)||this.deferred.push(e));else if(e instanceof o)d.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof l)){if(e instanceof i)for(var t=0;t<this.deferred.length;)p(0,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);d.test(e.name)&&(e.parent[e.name]=e)}},c.prototype._handleRemove=function(e){if(e instanceof s){if(void 0!==e.extend)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof o)d.test(e.name)&&delete e.parent[e.name];else if(e instanceof r){for(var i=0;i<e.nestedArray.length;++i)this._handleRemove(e._nestedArray[i]);d.test(e.name)&&delete e.parent[e.name]}},c._configure=function(e,t,r){i=e,n=t,a=r}})),wa=$(((e,t)=>{"use strict";var r,i,n=t.exports=qh(),a=g7();n.codegen=lwe(),n.fetch=uwe(),n.path=fwe(),n.fs=n.inquire("fs"),n.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]},n.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],n=e[r++];void 0!==n&&(t[i]=n)}return t};var s=/\\/g,o=/"/g;n.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},n.safeProp=function(e){return!/^[$\w_]+$/.test(e)||n.isReserved(e)?'["'+e.replace(s,"\\\\").replace(o,'\\"')+'"]':"."+e},n.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var l=/_([a-z])/g;n.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(l,(function(e,t){return t.toUpperCase()}))},n.compareFieldsById=function(e,t){return e.id-t.id},n.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(n.decorateRoot.remove(e.$type),e.$type.name=t,n.decorateRoot.add(e.$type)),e.$type;r||(r=FO());var i=new r(t||e.name);return n.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var h=0;n.decorateEnum=function(e){if(e.$type)return e.$type;i||(i=zu());var t=new i("Enum"+h++,e);return n.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t},n.setProperty=function(e,t,r){if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return function e(t,r,i){var n=r.shift();if("__proto__"===n||"prototype"===n)return t;if(r.length>0)t[n]=e(t[n]||{},r,i);else{var a=t[n];a&&(i=[].concat(a).concat(i)),t[n]=i}return t}(e,t=t.split("."),r)},Object.defineProperty(n,"decorateRoot",{get:function(){return a.decorated||(a.decorated=new(UO()))}})})),C0=$(((e,t)=>{"use strict";t.exports=n,n.className="ReflectionObject";var r,i=wa();function n(e,t){if(!i.isString(e))throw TypeError("name must be a string");if(t&&!i.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(n.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),n.prototype.toJSON=function(){throw Error()},n.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof r&&t._handleAdd(this)},n.prototype.onRemove=function(e){var t=e.root;t instanceof r&&t._handleRemove(this),this.parent=null,this.resolved=!1},n.prototype.resolve=function(){return this.resolved||this.root instanceof r&&(this.resolved=!0),this},n.prototype.getOption=function(e){if(this.options)return this.options[e]},n.prototype.setOption=function(e,t,r){return(!r||!this.options||void 0===this.options[e])&&((this.options||(this.options={}))[e]=t),this},n.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var n=this.parsedOptions;if(r){var a=n.find((function(t){return Object.prototype.hasOwnProperty.call(t,e)}));if(a){var s=a[e];i.setProperty(s,r,t)}else(a={})[e]=i.setProperty({},r,t),n.push(a)}else{var o={};o[e]=t,n.push(o)}return this},n.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this},n.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},n._configure=function(e){r=e}})),zu=$(((e,t)=>{"use strict";t.exports=a;var r=C0();((a.prototype=Object.create(r.prototype)).constructor=a).className="Enum";var i=Sb(),n=wa();function a(e,t,i,n,a,s){if(r.call(this,e,i),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=n,this.comments=a||{},this.valuesOptions=s,this.reserved=void 0,t)for(var o=Object.keys(t),l=0;l<o.length;++l)"number"==typeof t[o[l]]&&(this.valuesById[this.values[o[l]]=t[o[l]]]=o[l])}a.fromJSON=function(e,t){var r=new a(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r},a.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return n.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},a.prototype.add=function(e,t,r,i){if(!n.isString(e))throw TypeError("name must be a string");if(!n.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this},a.prototype.remove=function(e){if(!n.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this},a.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},a.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}})),B7=$(((e,t)=>{"use strict";t.exports=function(e){for(var t,s=n.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),o=e.fieldsArray.slice().sort(n.compareFieldsById),l=0;l<o.length;++l){var h=o[l].resolve(),c=e._fieldsArray.indexOf(h),u=h.resolvedType instanceof r?"int32":h.type,d=i.basic[u];t="m"+n.safeProp(h.name),h.map?(s("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",t,h.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",t)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(h.id<<3|2)>>>0,8|i.mapKey[h.keyType],h.keyType),void 0===d?s("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",c,t):s(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|d,u,t),s("}")("}")):h.repeated?(s("if(%s!=null&&%s.length){",t,t),h.packed&&void 0!==i.packed[u]?s("w.uint32(%i).fork()",(h.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",t)("w.%s(%s[i])",u,t)("w.ldelim()"):(s("for(var i=0;i<%s.length;++i)",t),void 0===d?a(s,h,c,t+"[i]"):s("w.uint32(%i).%s(%s[i])",(h.id<<3|d)>>>0,u,t)),s("}")):(h.optional&&s("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",t,h.name),void 0===d?a(s,h,c,t):s("w.uint32(%i).%s(%s)",(h.id<<3|d)>>>0,u,t))}return s("return w")};var r=zu(),i=R0(),n=wa();function a(e,t,r,i){return t.resolvedType.group?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",r,i,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",r,i,(t.id<<3|2)>>>0)}})),Jwe=$(((e,t)=>{"use strict";var r=t.exports=awe();r.build="light",r.load=function(e,t,i){return"function"==typeof t?(i=t,t=new r.Root):t||(t=new r.Root),t.load(e,i)},r.loadSync=function(e,t){return t||(t=new r.Root),t.loadSync(e)},r.encoder=B7(),r.decoder=M7(),r.verifier=C7(),r.converter=O7(),r.ReflectionObject=C0(),r.Namespace=Sb(),r.Root=UO(),r.Enum=zu(),r.Type=FO(),r.Field=hm(),r.OneOf=_b(),r.MapField=PO(),r.Service=OO(),r.Method=IO(),r.Message=DO(),r.wrappers=D7(),r.types=R0(),r.util=wa(),r.ReflectionObject._configure(r.Root),r.Namespace._configure(r.Type,r.Service,r.Enum),r.Root._configure(r.Type),r.Field._configure(r.Type)})),j7=$(((e,t)=>{"use strict";t.exports=d;var r=/[\s{}=;:[\],'"()<>]/g,i=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,n=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,a=/^ *[*/]+ */,s=/^\s*\*?\/*/,o=/\n/g,l=/\s/,h=/\\(.?)/g,c={0:"\0",r:"\r",n:"\n",t:"\t"};function u(e){return e.replace(h,(function(e,t){switch(t){case"\\":case"":return t;default:return c[t]||""}}))}function d(e,t){e=e.toString();var h=0,c=e.length,d=1,p=0,f={},m=[],g=null;function v(e){return Error("illegal "+e+" (line "+d+")")}function y(t){return e.charAt(t)}function b(r,i,n){var l,h={type:e.charAt(r++),lineEmpty:!1,leading:n},c=r-(t?2:3);do{if(--c<0||"\n"===(l=e.charAt(c))){h.lineEmpty=!0;break}}while(" "===l||"\t"===l);for(var u=e.substring(r,i).split(o),m=0;m<u.length;++m)u[m]=u[m].replace(t?s:a,"").trim();h.text=u.join("\n").trim(),f[d]=h,p=d}function x(t){var r=_(t),i=e.substring(t,r);return/^\s*\/\//.test(i)}function _(e){for(var t=e;t<c&&"\n"!==y(t);)t++;return t}function w(){if(m.length>0)return m.shift();if(g)return function(){var t="'"===g?n:i;t.lastIndex=h-1;var r=t.exec(e);if(!r)throw v("string");return h=t.lastIndex,S(g),g=null,u(r[1])}();var a,s,o,p,f,w=0===h;do{if(h===c)return null;for(a=!1;l.test(o=y(h));)if("\n"===o&&(w=!0,++d),++h===c)return null;if("/"===y(h)){if(++h===c)throw v("comment");if("/"===y(h))if(t){if(p=h,f=!1,x(h-1)){f=!0;do{if((h=_(h))===c||(h++,!w))break}while(x(h))}else h=Math.min(c,_(h)+1);f&&(b(p,h,w),w=!0),d++,a=!0}else{for(f="/"===y(p=h+1);"\n"!==y(++h);)if(h===c)return null;++h,f&&(b(p,h-1,w),w=!0),++d,a=!0}else{if("*"!==(o=y(h)))return"/";p=h+1,f=t||"*"===y(p);do{if("\n"===o&&++d,++h===c)throw v("comment");s=o,o=y(h)}while("*"!==s||"/"!==o);++h,f&&(b(p,h-2,w),w=!0),a=!0}}}while(a);var T=h;if(r.lastIndex=0,!r.test(y(T++)))for(;T<c&&!r.test(y(T));)++T;var M=e.substring(h,h=T);return('"'===M||"'"===M)&&(g=M),M}function S(e){m.push(e)}function T(){if(!m.length){var e=w();if(null===e)return null;S(e)}return m[0]}return Object.defineProperty({next:w,peek:T,push:S,skip:function(e,t){var r=T();if(r===e)return w(),!0;if(!t)throw v("token '"+r+"', '"+e+"' expected");return!1},cmnt:function(e){var r,i=null;return void 0===e?(r=f[d-1],delete f[d-1],r&&(t||"*"===r.type||r.lineEmpty)&&(i=r.leading?r.text:null)):(p<e&&T(),r=f[e],delete f[e],r&&!r.lineEmpty&&(t||"/"===r.type)&&(i=r.leading?null:r.text)),i}},"line",{get:function(){return d}})}d.unescape=u})),oSe=$(((e,t)=>{"use strict";t.exports=S,S.filename=null,S.defaults={keepCase:!1};var r=j7(),i=UO(),n=FO(),a=hm(),s=PO(),o=_b(),l=zu(),h=OO(),c=IO(),u=R0(),d=wa(),p=/^[1-9][0-9]*$/,f=/^-?[1-9][0-9]*$/,m=/^0[x][0-9a-fA-F]+$/,g=/^-?0[x][0-9a-fA-F]+$/,v=/^0[0-7]+$/,y=/^-?0[0-7]+$/,b=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,x=/^[a-zA-Z_][a-zA-Z_0-9]*$/,_=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,w=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function S(e,t,T){t instanceof i||(T=t,t=new i),T||(T=S.defaults);var M,E,A,C,P,R=T.preferTrailingComment||!1,I=r(e,T.alternateCommentMode||!1),O=I.next,L=I.push,D=I.peek,k=I.skip,F=I.cmnt,N=!0,U=!1,B=t,z=T.keepCase?function(e){return e}:d.camelCase;function H(e,t,r){var i=S.filename;return r||(S.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(i?i+", ":"")+"line "+I.line+")")}function V(){var e,t=[];do{if('"'!==(e=O())&&"'"!==e)throw H(e);t.push(O()),k(e),e=D()}while('"'===e||"'"===e);return t.join("")}function j(e){var t=O();switch(t){case"'":case'"':return L(t),V();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return function(e,t){var r=1;switch("-"===e.charAt(0)&&(r=-1,e=e.substring(1)),e){case"inf":case"INF":case"Inf":return r*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(p.test(e))return r*parseInt(e,10);if(m.test(e))return r*parseInt(e,16);if(v.test(e))return r*parseInt(e,8);if(b.test(e))return r*parseFloat(e);throw H(e,"number",t)}(t,!0)}catch(r){if(e&&_.test(t))return t;throw H(t,"value")}}function G(e,t){var r,i;do{!t||'"'!==(r=D())&&"'"!==r?e.push([i=W(O()),k("to",!0)?W(O()):i]):e.push(V())}while(k(",",!0));k(";")}function W(e,t){switch(e){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!t&&"-"===e.charAt(0))throw H(e,"id");if(f.test(e))return parseInt(e,10);if(g.test(e))return parseInt(e,16);if(y.test(e))return parseInt(e,8);throw H(e,"id")}function X(){if(void 0!==M)throw H("package");if(M=O(),!_.test(M))throw H(M,"name");B=B.define(M),k(";")}function q(){var e,t=D();switch(t){case"weak":e=A||(A=[]),O();break;case"public":O();default:e=E||(E=[])}t=V(),k(";"),e.push(t)}function Y(){if(k("="),C=V(),!(U="proto3"===C)&&"proto2"!==C)throw H(C,"syntax");k(";")}function $(e,t){switch(t){case"option":return ee(e,t),k(";"),!0;case"message":return K(e,t),!0;case"enum":return Q(e,t),!0;case"service":return function(e,t){if(!x.test(t=O()))throw H(t,"service name");var r=new h(t);Z(r,(function(e){if(!$(r,e)){if("rpc"!==e)throw H(e);!function(e,t){var r=F(),i=t;if(!x.test(t=O()))throw H(t,"name");var n,a,s,o,l=t;if(k("("),k("stream",!0)&&(a=!0),!_.test(t=O())||(n=t,k(")"),k("returns"),k("("),k("stream",!0)&&(o=!0),!_.test(t=O())))throw H(t);s=t,k(")");var h=new c(l,i,n,s,a,o);h.comment=r,Z(h,(function(e){if("option"!==e)throw H(e);ee(h,e),k(";")})),e.add(h)}(r,e)}})),e.add(r)}(e,t),!0;case"extend":return function(e,t){if(!_.test(t=O()))throw H(t,"reference");var r=t;Z(null,(function(t){switch(t){case"required":case"repeated":J(e,t,r);break;case"optional":J(e,U?"proto3_optional":"optional",r);break;default:if(!U||!_.test(t))throw H(t);L(t),J(e,"optional",r)}}))}(e,t),!0}return!1}function Z(e,t,r){var i=I.line;if(e&&("string"!=typeof e.comment&&(e.comment=F()),e.filename=S.filename),k("{",!0)){for(var n;"}"!==(n=O());)t(n);k(";",!0)}else r&&r(),k(";"),e&&("string"!=typeof e.comment||R)&&(e.comment=F(i)||e.comment)}function K(e,t){if(!x.test(t=O()))throw H(t,"type name");var r=new n(t);Z(r,(function(e){if(!$(r,e))switch(e){case"map":!function(e){k("<");var t=O();if(void 0===u.mapKey[t])throw H(t,"type");k(",");var r=O();if(!_.test(r))throw H(r,"type");k(">");var i=O();if(!x.test(i))throw H(i,"name");k("=");var n=new s(z(i),W(O()),t,r);Z(n,(function(e){if("option"!==e)throw H(e);ee(n,e),k(";")}),(function(){ie(n)})),e.add(n)}(r);break;case"required":case"repeated":J(r,e);break;case"optional":J(r,U?"proto3_optional":"optional");break;case"oneof":!function(e,t){if(!x.test(t=O()))throw H(t,"name");var r=new o(z(t));Z(r,(function(e){"option"===e?(ee(r,e),k(";")):(L(e),J(r,"optional"))})),e.add(r)}(r,e);break;case"extensions":G(r.extensions||(r.extensions=[]));break;case"reserved":G(r.reserved||(r.reserved=[]),!0);break;default:if(!U||!_.test(e))throw H(e);L(e),J(r,"optional")}})),e.add(r)}function J(e,t,r){var i=O();if("group"!==i){for(;i.endsWith(".")||D().startsWith(".");)i+=O();if(!_.test(i))throw H(i,"type");var s=O();if(!x.test(s))throw H(s,"name");s=z(s),k("=");var l=new a(s,W(O()),i,t,r);if(Z(l,(function(e){if("option"!==e)throw H(e);ee(l,e),k(";")}),(function(){ie(l)})),"proto3_optional"===t){var h=new o("_"+s);l.setOption("proto3_optional",!0),h.add(l),e.add(h)}else e.add(l);!U&&l.repeated&&(void 0!==u.packed[i]||void 0===u.basic[i])&&l.setOption("packed",!1,!0)}else!function(e,t){var r=O();if(!x.test(r))throw H(r,"name");var i=d.lcFirst(r);r===i&&(r=d.ucFirst(r)),k("=");var s=W(O()),o=new n(r);o.group=!0;var l=new a(i,s,r,t);l.filename=S.filename,Z(o,(function(e){switch(e){case"option":ee(o,e),k(";");break;case"required":case"repeated":J(o,e);break;case"optional":J(o,U?"proto3_optional":"optional");break;case"message":K(o,e);break;case"enum":Q(o,e);break;default:throw H(e)}})),e.add(o).add(l)}(e,t)}function Q(e,t){if(!x.test(t=O()))throw H(t,"name");var r=new l(t);Z(r,(function(e){switch(e){case"option":ee(r,e),k(";");break;case"reserved":G(r.reserved||(r.reserved=[]),!0);break;default:!function(e,t){if(!x.test(t))throw H(t,"name");k("=");var r=W(O(),!0),i={options:void 0,setOption:function(e,t){void 0===this.options&&(this.options={}),this.options[e]=t}};Z(i,(function(e){if("option"!==e)throw H(e);ee(i,e),k(";")}),(function(){ie(i)})),e.add(t,r,i.comment,i.options)}(r,e)}})),e.add(r)}function ee(e,t){var r=k("(",!0);if(!_.test(t=O()))throw H(t,"name");var i,n=t,a=n;r&&(k(")"),a=n="("+n+")",t=D(),w.test(t)&&(i=t.slice(1),n+=t,O())),k("="),function(e,t,r,i){e.setParsedOption&&e.setParsedOption(t,r,i)}(e,a,te(e,n),i)}function te(e,t){if(k("{",!0)){for(var r={};!k("}",!0);){if(!x.test(P=O()))throw H(P,"name");if(null===P)throw H(P,"end of input");var i,n=P;if(k(":",!0),"{"===D())i=te(e,t+"."+P);else if("["===D()){var a;if(i=[],k("[",!0)){do{a=j(!0),i.push(a)}while(k(",",!0));k("]"),void 0!==a&&re(e,t+"."+P,a)}}else i=j(!0),re(e,t+"."+P,i);var s=r[n];s&&(i=[].concat(s).concat(i)),r[n]=i,k(",",!0),k(";",!0)}return r}var o=j(!0);return re(e,t,o),o}function re(e,t,r){e.setOption&&e.setOption(t,r)}function ie(e){if(k("[",!0)){do{ee(e,"option")}while(k(",",!0));k("]")}return e}for(;null!==(P=O());)switch(P){case"package":if(!N)throw H(P);X();break;case"import":if(!N)throw H(P);q();break;case"syntax":if(!N)throw H(P);Y();break;case"option":ee(B,P),k(";");break;default:if($(B,P)){N=!1;continue}throw H(P)}return S.filename=null,{package:M,imports:E,weakImports:A,syntax:C,root:t}}})),uSe=$(((e,t)=>{"use strict";t.exports=n;var r,i=/\/|\./;function n(e,t){i.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),n[e]=t}n("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),n("duration",{Duration:r={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),n("timestamp",{Timestamp:r}),n("empty",{Empty:{fields:{}}}),n("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),n("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),n("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),n.get=function(e){return n[e]||null}})),dSe=$(((e,t)=>{"use strict";var r=t.exports=Jwe();r.build="full",r.tokenize=j7(),r.parse=oSe(),r.common=uSe(),r.Root._configure(r.Type,r.parse,r.common)})),pSe=$(((e,t)=>{"use strict";t.exports=dSe()})),_m=$(((e,t)=>{(function(){var r,i="Expected a function",n="__lodash_hash_undefined__",a="__lodash_placeholder__",s=16,o=32,l=64,h=128,c=256,u=1/0,d=9007199254740991,p=NaN,f=4294967295,m=[["ary",h],["bind",1],["bindKey",2],["curry",8],["curryRight",s],["flip",512],["partial",o],["partialRight",l],["rearg",c]],g="[object Arguments]",v="[object Array]",y="[object Boolean]",b="[object Date]",x="[object Error]",_="[object Function]",w="[object GeneratorFunction]",S="[object Map]",T="[object Number]",M="[object Object]",E="[object Promise]",A="[object RegExp]",C="[object Set]",P="[object String]",R="[object Symbol]",I="[object WeakMap]",O="[object ArrayBuffer]",L="[object DataView]",D="[object Float32Array]",k="[object Float64Array]",F="[object Int8Array]",N="[object Int16Array]",U="[object Int32Array]",B="[object Uint8Array]",z="[object Uint8ClampedArray]",H="[object Uint16Array]",V="[object Uint32Array]",j=/\b__p \+= '';/g,G=/\b(__p \+=) '' \+/g,W=/(__e\(.*?\)|\b__t\)) \+\n'';/g,X=/&(?:amp|lt|gt|quot|#39);/g,q=/[&<>"']/g,Y=RegExp(X.source),$=RegExp(q.source),Z=/<%-([\s\S]+?)%>/g,K=/<%([\s\S]+?)%>/g,J=/<%=([\s\S]+?)%>/g,Q=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ee=/^\w*$/,te=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,re=/[\\^$.*+?()[\]{}|]/g,ie=RegExp(re.source),ne=/^\s+/,ae=/\s/,se=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,oe=/\{\n\/\* \[wrapped with (.+)\] \*/,le=/,? & /,he=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ce=/[()=,{}\[\]\/\s]/,ue=/\\(\\)?/g,de=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,pe=/\w*$/,fe=/^[-+]0x[0-9a-f]+$/i,me=/^0b[01]+$/i,ge=/^\[object .+?Constructor\]$/,ve=/^0o[0-7]+$/i,ye=/^(?:0|[1-9]\d*)$/,be=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,xe=/($^)/,_e=/['\n\r\u2028\u2029\\]/g,we="\\ud800-\\udfff",Se="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Te="\\u2700-\\u27bf",Me="a-z\\xdf-\\xf6\\xf8-\\xff",Ee="A-Z\\xc0-\\xd6\\xd8-\\xde",Ae="\\ufe0e\\ufe0f",Ce="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Pe="['’]",Re="["+we+"]",Ie="["+Ce+"]",Oe="["+Se+"]",Le="\\d+",De="["+Te+"]",ke="["+Me+"]",Fe="[^"+we+Ce+Le+Te+Me+Ee+"]",Ne="\\ud83c[\\udffb-\\udfff]",Ue="[^"+we+"]",Be="(?:\\ud83c[\\udde6-\\uddff]){2}",ze="[\\ud800-\\udbff][\\udc00-\\udfff]",He="["+Ee+"]",Ve="\\u200d",je="(?:"+ke+"|"+Fe+")",Ge="(?:"+He+"|"+Fe+")",We="(?:['’](?:d|ll|m|re|s|t|ve))?",Xe="(?:['’](?:D|LL|M|RE|S|T|VE))?",qe="(?:"+Oe+"|"+Ne+")"+"?",Ye="["+Ae+"]?",$e=Ye+qe+("(?:"+Ve+"(?:"+[Ue,Be,ze].join("|")+")"+Ye+qe+")*"),Ze="(?:"+[De,Be,ze].join("|")+")"+$e,Ke="(?:"+[Ue+Oe+"?",Oe,Be,ze,Re].join("|")+")",Je=RegExp(Pe,"g"),Qe=RegExp(Oe,"g"),et=RegExp(Ne+"(?="+Ne+")|"+Ke+$e,"g"),tt=RegExp([He+"?"+ke+"+"+We+"(?="+[Ie,He,"$"].join("|")+")",Ge+"+"+Xe+"(?="+[Ie,He+je,"$"].join("|")+")",He+"?"+je+"+"+We,He+"+"+Xe,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Le,Ze].join("|"),"g"),rt=RegExp("["+Ve+we+Se+Ae+"]"),it=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,nt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],at=-1,st={};st[D]=st[k]=st[F]=st[N]=st[U]=st[B]=st[z]=st[H]=st[V]=!0,st[g]=st[v]=st[O]=st[y]=st[L]=st[b]=st[x]=st[_]=st[S]=st[T]=st[M]=st[A]=st[C]=st[P]=st[I]=!1;var ot={};ot[g]=ot[v]=ot[O]=ot[L]=ot[y]=ot[b]=ot[D]=ot[k]=ot[F]=ot[N]=ot[U]=ot[S]=ot[T]=ot[M]=ot[A]=ot[C]=ot[P]=ot[R]=ot[B]=ot[z]=ot[H]=ot[V]=!0,ot[x]=ot[_]=ot[I]=!1;var lt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ht=parseFloat,ct=parseInt,ut="object"==typeof global&&global&&global.Object===Object&&global,dt="object"==typeof self&&self&&self.Object===Object&&self,pt=ut||dt||Function("return this")(),ft="object"==typeof e&&e&&!e.nodeType&&e,mt=ft&&"object"==typeof t&&t&&!t.nodeType&&t,gt=mt&&mt.exports===ft,vt=gt&&ut.process,yt=function(){try{return mt&&mt.require&&mt.require("util").types||vt&&vt.binding&&vt.binding("util")}catch(e){}}(),bt=yt&&yt.isArrayBuffer,xt=yt&&yt.isDate,_t=yt&&yt.isMap,wt=yt&&yt.isRegExp,St=yt&&yt.isSet,Tt=yt&&yt.isTypedArray;function Mt(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function Et(e,t,r,i){for(var n=-1,a=null==e?0:e.length;++n<a;){var s=e[n];t(i,s,r(s),e)}return i}function At(e,t){for(var r=-1,i=null==e?0:e.length;++r<i&&!1!==t(e[r],r,e););return e}function Ct(e,t){for(var r=null==e?0:e.length;r--&&!1!==t(e[r],r,e););return e}function Pt(e,t){for(var r=-1,i=null==e?0:e.length;++r<i;)if(!t(e[r],r,e))return!1;return!0}function Rt(e,t){for(var r=-1,i=null==e?0:e.length,n=0,a=[];++r<i;){var s=e[r];t(s,r,e)&&(a[n++]=s)}return a}function It(e,t){return!!(null==e?0:e.length)&&Ht(e,t,0)>-1}function Ot(e,t,r){for(var i=-1,n=null==e?0:e.length;++i<n;)if(r(t,e[i]))return!0;return!1}function Lt(e,t){for(var r=-1,i=null==e?0:e.length,n=Array(i);++r<i;)n[r]=t(e[r],r,e);return n}function Dt(e,t){for(var r=-1,i=t.length,n=e.length;++r<i;)e[n+r]=t[r];return e}function kt(e,t,r,i){var n=-1,a=null==e?0:e.length;for(i&&a&&(r=e[++n]);++n<a;)r=t(r,e[n],n,e);return r}function Ft(e,t,r,i){var n=null==e?0:e.length;for(i&&n&&(r=e[--n]);n--;)r=t(r,e[n],n,e);return r}function Nt(e,t){for(var r=-1,i=null==e?0:e.length;++r<i;)if(t(e[r],r,e))return!0;return!1}var Ut=Wt("length");function Bt(e,t,r){var i;return r(e,(function(e,r,n){if(t(e,r,n))return i=r,!1})),i}function zt(e,t,r,i){for(var n=e.length,a=r+(i?1:-1);i?a--:++a<n;)if(t(e[a],a,e))return a;return-1}function Ht(e,t,r){return t==t?function(e,t,r){for(var i=r-1,n=e.length;++i<n;)if(e[i]===t)return i;return-1}(e,t,r):zt(e,jt,r)}function Vt(e,t,r,i){for(var n=r-1,a=e.length;++n<a;)if(i(e[n],t))return n;return-1}function jt(e){return e!=e}function Gt(e,t){var r=null==e?0:e.length;return r?Yt(e,t)/r:p}function Wt(e){return function(t){return null==t?r:t[e]}}function Xt(e){return function(t){return null==e?r:e[t]}}function qt(e,t,r,i,n){return n(e,(function(e,n,a){r=i?(i=!1,e):t(r,e,n,a)})),r}function Yt(e,t){for(var i,n=-1,a=e.length;++n<a;){var s=t(e[n]);s!==r&&(i=i===r?s:i+s)}return i}function $t(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}function Zt(e){return e&&e.slice(0,dr(e)+1).replace(ne,"")}function Kt(e){return function(t){return e(t)}}function Jt(e,t){return Lt(t,(function(t){return e[t]}))}function Qt(e,t){return e.has(t)}function er(e,t){for(var r=-1,i=e.length;++r<i&&Ht(t,e[r],0)>-1;);return r}function tr(e,t){for(var r=e.length;r--&&Ht(t,e[r],0)>-1;);return r}var rr=Xt({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),ir=Xt({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function nr(e){return"\\"+lt[e]}function ar(e){return rt.test(e)}function sr(e){var t=-1,r=Array(e.size);return e.forEach((function(e,i){r[++t]=[i,e]})),r}function or(e,t){return function(r){return e(t(r))}}function lr(e,t){for(var r=-1,i=e.length,n=0,s=[];++r<i;){var o=e[r];(o===t||o===a)&&(e[r]=a,s[n++]=r)}return s}function hr(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r}function cr(e){return ar(e)?function(e){for(var t=et.lastIndex=0;et.test(e);)++t;return t}(e):Ut(e)}function ur(e){return ar(e)?function(e){return e.match(et)||[]}(e):function(e){return e.split("")}(e)}function dr(e){for(var t=e.length;t--&&ae.test(e.charAt(t)););return t}var pr=Xt({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var fr=function e(t){var ae,we=(t=null==t?pt:fr.defaults(pt.Object(),t,fr.pick(pt,nt))).Array,Se=t.Date,Te=t.Error,Me=t.Function,Ee=t.Math,Ae=t.Object,Ce=t.RegExp,Pe=t.String,Re=t.TypeError,Ie=we.prototype,Oe=Me.prototype,Le=Ae.prototype,De=t["__core-js_shared__"],ke=Oe.toString,Fe=Le.hasOwnProperty,Ne=0,Ue=(ae=/[^.]+$/.exec(De&&De.keys&&De.keys.IE_PROTO||""))?"Symbol(src)_1."+ae:"",Be=Le.toString,ze=ke.call(Ae),He=pt._,Ve=Ce("^"+ke.call(Fe).replace(re,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),je=gt?t.Buffer:r,Ge=t.Symbol,We=t.Uint8Array,Xe=je?je.allocUnsafe:r,qe=or(Ae.getPrototypeOf,Ae),Ye=Ae.create,$e=Le.propertyIsEnumerable,Ze=Ie.splice,Ke=Ge?Ge.isConcatSpreadable:r,et=Ge?Ge.iterator:r,rt=Ge?Ge.toStringTag:r,lt=function(){try{var e=ua(Ae,"defineProperty");return e({},"",{}),e}catch(e){}}(),ut=t.clearTimeout!==pt.clearTimeout&&t.clearTimeout,dt=Se&&Se.now!==pt.Date.now&&Se.now,ft=t.setTimeout!==pt.setTimeout&&t.setTimeout,mt=Ee.ceil,vt=Ee.floor,yt=Ae.getOwnPropertySymbols,Ut=je?je.isBuffer:r,Xt=t.isFinite,mr=Ie.join,gr=or(Ae.keys,Ae),vr=Ee.max,yr=Ee.min,br=Se.now,xr=t.parseInt,_r=Ee.random,wr=Ie.reverse,Sr=ua(t,"DataView"),Tr=ua(t,"Map"),Mr=ua(t,"Promise"),Er=ua(t,"Set"),Ar=ua(t,"WeakMap"),Cr=ua(Ae,"create"),Pr=Ar&&new Ar,Rr={},Ir=Na(Sr),Or=Na(Tr),Lr=Na(Mr),Dr=Na(Er),kr=Na(Ar),Fr=Ge?Ge.prototype:r,Nr=Fr?Fr.valueOf:r,Ur=Fr?Fr.toString:r;function Br(e){if(eo(e)&&!js(e)&&!(e instanceof jr)){if(e instanceof Vr)return e;if(Fe.call(e,"__wrapped__"))return Ua(e)}return new Vr(e)}var zr=function(){function e(){}return function(t){if(!Qs(t))return{};if(Ye)return Ye(t);e.prototype=t;var i=new e;return e.prototype=r,i}}();function Hr(){}function Vr(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}function jr(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=f,this.__views__=[]}function Gr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function Wr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function Xr(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}function qr(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Xr;++t<r;)this.add(e[t])}function Yr(e){var t=this.__data__=new Wr(e);this.size=t.size}function $r(e,t){var r=js(e),i=!r&&Vs(e),n=!r&&!i&&qs(e),a=!r&&!i&&!n&&lo(e),s=r||i||n||a,o=s?$t(e.length,Pe):[],l=o.length;for(var h in e)(t||Fe.call(e,h))&&(!s||!("length"==h||n&&("offset"==h||"parent"==h)||a&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||ya(h,l)))&&o.push(h);return o}function Zr(e){var t=e.length;return t?e[qi(0,t-1)]:r}function Kr(e,t){return Da(Pn(e),si(t,0,e.length))}function Jr(e){return Da(Pn(e))}function Qr(e,t,i){(i!==r&&!Bs(e[t],i)||i===r&&!(t in e))&&ni(e,t,i)}function ei(e,t,i){var n=e[t];(!Fe.call(e,t)||!Bs(n,i)||i===r&&!(t in e))&&ni(e,t,i)}function ti(e,t){for(var r=e.length;r--;)if(Bs(e[r][0],t))return r;return-1}function ri(e,t,r,i){return ui(e,(function(e,n,a){t(i,e,r(e),a)})),i}function ii(e,t){return e&&Rn(t,Io(t),e)}function ni(e,t,r){"__proto__"==t&&lt?lt(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function ai(e,t){for(var i=-1,n=t.length,a=we(n),s=null==e;++i<n;)a[i]=s?r:Eo(e,t[i]);return a}function si(e,t,i){return e==e&&(i!==r&&(e=e<=i?e:i),t!==r&&(e=e>=t?e:t)),e}function oi(e,t,i,n,a,s){var o,l=1&t,h=2&t,c=4&t;if(i&&(o=a?i(e,n,a,s):i(e)),o!==r)return o;if(!Qs(e))return e;var u=js(e);if(u){if(o=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&Fe.call(e,"index")&&(r.index=e.index,r.input=e.input),r}(e),!l)return Pn(e,o)}else{var d=fa(e),p=d==_||d==w;if(qs(e))return Sn(e,l);if(d==M||d==g||p&&!a){if(o=h||p?{}:ga(e),!l)return h?function(e,t){return Rn(e,pa(e),t)}(e,function(e,t){return e&&Rn(t,Oo(t),e)}(o,e)):function(e,t){return Rn(e,da(e),t)}(e,ii(o,e))}else{if(!ot[d])return a?e:{};o=function(e,t,r){var i=e.constructor;switch(t){case O:return Tn(e);case y:case b:return new i(+e);case L:return function(e,t){var r=t?Tn(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}(e,r);case D:case k:case F:case N:case U:case B:case z:case H:case V:return Mn(e,r);case S:return new i;case T:case P:return new i(e);case A:return function(e){var t=new e.constructor(e.source,pe.exec(e));return t.lastIndex=e.lastIndex,t}(e);case C:return new i;case R:return function(e){return Nr?Ae(Nr.call(e)):{}}(e)}}(e,d,l)}}s||(s=new Yr);var f=s.get(e);if(f)return f;s.set(e,o),ao(e)?e.forEach((function(r){o.add(oi(r,t,i,r,e,s))})):to(e)&&e.forEach((function(r,n){o.set(n,oi(r,t,i,n,e,s))}));var m=u?r:(c?h?na:ia:h?Oo:Io)(e);return At(m||e,(function(r,n){m&&(r=e[n=r]),ei(o,n,oi(r,t,i,n,e,s))})),o}function li(e,t,i){var n=i.length;if(null==e)return!n;for(e=Ae(e);n--;){var a=i[n],s=t[a],o=e[a];if(o===r&&!(a in e)||!s(o))return!1}return!0}function hi(e,t,n){if("function"!=typeof e)throw new Re(i);return Ra((function(){e.apply(r,n)}),t)}function ci(e,t,r,i){var n=-1,a=It,s=!0,o=e.length,l=[],h=t.length;if(!o)return l;r&&(t=Lt(t,Kt(r))),i?(a=Ot,s=!1):t.length>=200&&(a=Qt,s=!1,t=new qr(t));e:for(;++n<o;){var c=e[n],u=null==r?c:r(c);if(c=i||0!==c?c:0,s&&u==u){for(var d=h;d--;)if(t[d]===u)continue e;l.push(c)}else a(t,u,i)||l.push(c)}return l}Br.templateSettings={escape:Z,evaluate:K,interpolate:J,variable:"",imports:{_:Br}},Br.prototype=Hr.prototype,Br.prototype.constructor=Br,Vr.prototype=zr(Hr.prototype),Vr.prototype.constructor=Vr,jr.prototype=zr(Hr.prototype),jr.prototype.constructor=jr,Gr.prototype.clear=function(){this.__data__=Cr?Cr(null):{},this.size=0},Gr.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Gr.prototype.get=function(e){var t=this.__data__;if(Cr){var i=t[e];return i===n?r:i}return Fe.call(t,e)?t[e]:r},Gr.prototype.has=function(e){var t=this.__data__;return Cr?t[e]!==r:Fe.call(t,e)},Gr.prototype.set=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Cr&&t===r?n:t,this},Wr.prototype.clear=function(){this.__data__=[],this.size=0},Wr.prototype.delete=function(e){var t=this.__data__,r=ti(t,e);return!(r<0)&&(r==t.length-1?t.pop():Ze.call(t,r,1),--this.size,!0)},Wr.prototype.get=function(e){var t=this.__data__,i=ti(t,e);return i<0?r:t[i][1]},Wr.prototype.has=function(e){return ti(this.__data__,e)>-1},Wr.prototype.set=function(e,t){var r=this.__data__,i=ti(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this},Xr.prototype.clear=function(){this.size=0,this.__data__={hash:new Gr,map:new(Tr||Wr),string:new Gr}},Xr.prototype.delete=function(e){var t=ha(this,e).delete(e);return this.size-=t?1:0,t},Xr.prototype.get=function(e){return ha(this,e).get(e)},Xr.prototype.has=function(e){return ha(this,e).has(e)},Xr.prototype.set=function(e,t){var r=ha(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this},qr.prototype.add=qr.prototype.push=function(e){return this.__data__.set(e,n),this},qr.prototype.has=function(e){return this.__data__.has(e)},Yr.prototype.clear=function(){this.__data__=new Wr,this.size=0},Yr.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},Yr.prototype.get=function(e){return this.__data__.get(e)},Yr.prototype.has=function(e){return this.__data__.has(e)},Yr.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Wr){var i=r.__data__;if(!Tr||i.length<199)return i.push([e,t]),this.size=++r.size,this;r=this.__data__=new Xr(i)}return r.set(e,t),this.size=r.size,this};var ui=Ln(bi),di=Ln(xi,!0);function pi(e,t){var r=!0;return ui(e,(function(e,i,n){return r=!!t(e,i,n)})),r}function fi(e,t,i){for(var n=-1,a=e.length;++n<a;){var s=e[n],o=t(s);if(null!=o&&(l===r?o==o&&!oo(o):i(o,l)))var l=o,h=s}return h}function mi(e,t){var r=[];return ui(e,(function(e,i,n){t(e,i,n)&&r.push(e)})),r}function gi(e,t,r,i,n){var a=-1,s=e.length;for(r||(r=va),n||(n=[]);++a<s;){var o=e[a];t>0&&r(o)?t>1?gi(o,t-1,r,i,n):Dt(n,o):i||(n[n.length]=o)}return n}var vi=Dn(),yi=Dn(!0);function bi(e,t){return e&&vi(e,t,Io)}function xi(e,t){return e&&yi(e,t,Io)}function _i(e,t){return Rt(t,(function(t){return Zs(e[t])}))}function wi(e,t){for(var i=0,n=(t=bn(t,e)).length;null!=e&&i<n;)e=e[Fa(t[i++])];return i&&i==n?e:r}function Si(e,t,r){var i=t(e);return js(e)?i:Dt(i,r(e))}function Ti(e){return null==e?e===r?"[object Undefined]":"[object Null]":rt&&rt in Ae(e)?function(e){var t=Fe.call(e,rt),i=e[rt];try{e[rt]=r;var n=!0}catch(e){}var a=Be.call(e);return n&&(t?e[rt]=i:delete e[rt]),a}(e):function(e){return Be.call(e)}(e)}function Mi(e,t){return e>t}function Ei(e,t){return null!=e&&Fe.call(e,t)}function Ai(e,t){return null!=e&&t in Ae(e)}function Ci(e,t,i){for(var n=i?Ot:It,a=e[0].length,s=e.length,o=s,l=we(s),h=1/0,c=[];o--;){var u=e[o];o&&t&&(u=Lt(u,Kt(t))),h=yr(u.length,h),l[o]=!i&&(t||a>=120&&u.length>=120)?new qr(o&&u):r}u=e[0];var d=-1,p=l[0];e:for(;++d<a&&c.length<h;){var f=u[d],m=t?t(f):f;if(f=i||0!==f?f:0,!(p?Qt(p,m):n(c,m,i))){for(o=s;--o;){var g=l[o];if(!(g?Qt(g,m):n(e[o],m,i)))continue e}p&&p.push(m),c.push(f)}}return c}function Pi(e,t,i){var n=null==(e=Aa(e,t=bn(t,e)))?e:e[Fa($a(t))];return null==n?r:Mt(n,e,i)}function Ri(e){return eo(e)&&Ti(e)==g}function Ii(e,t,i,n,a){return e===t||(null==e||null==t||!eo(e)&&!eo(t)?e!=e&&t!=t:function(e,t,i,n,a,s){var o=js(e),l=js(t),h=o?v:fa(e),c=l?v:fa(t),u=(h=h==g?M:h)==M,d=(c=c==g?M:c)==M,p=h==c;if(p&&qs(e)){if(!qs(t))return!1;o=!0,u=!1}if(p&&!u)return s||(s=new Yr),o||lo(e)?ta(e,t,i,n,a,s):function(e,t,r,i,n,a,s){switch(r){case L:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case O:return!(e.byteLength!=t.byteLength||!a(new We(e),new We(t)));case y:case b:case T:return Bs(+e,+t);case x:return e.name==t.name&&e.message==t.message;case A:case P:return e==t+"";case S:var o=sr;case C:var l=1&i;if(o||(o=hr),e.size!=t.size&&!l)return!1;var h=s.get(e);if(h)return h==t;i|=2,s.set(e,t);var c=ta(o(e),o(t),i,n,a,s);return s.delete(e),c;case R:if(Nr)return Nr.call(e)==Nr.call(t)}return!1}(e,t,h,i,n,a,s);if(!(1&i)){var f=u&&Fe.call(e,"__wrapped__"),m=d&&Fe.call(t,"__wrapped__");if(f||m){var _=f?e.value():e,w=m?t.value():t;return s||(s=new Yr),a(_,w,i,n,s)}}return!!p&&(s||(s=new Yr),function(e,t,i,n,a,s){var o=1&i,l=ia(e),h=l.length,c=ia(t),u=c.length;if(h!=u&&!o)return!1;for(var d=h;d--;){var p=l[d];if(!(o?p in t:Fe.call(t,p)))return!1}var f=s.get(e),m=s.get(t);if(f&&m)return f==t&&m==e;var g=!0;s.set(e,t),s.set(t,e);for(var v=o;++d<h;){var y=e[p=l[d]],b=t[p];if(n)var x=o?n(b,y,p,t,e,s):n(y,b,p,e,t,s);if(!(x===r?y===b||a(y,b,i,n,s):x)){g=!1;break}v||(v="constructor"==p)}if(g&&!v){var _=e.constructor,w=t.constructor;_!=w&&"constructor"in e&&"constructor"in t&&!("function"==typeof _&&_ instanceof _&&"function"==typeof w&&w instanceof w)&&(g=!1)}return s.delete(e),s.delete(t),g}(e,t,i,n,a,s))}(e,t,i,n,Ii,a))}function Oi(e,t,i,n){var a=i.length,s=a,o=!n;if(null==e)return!s;for(e=Ae(e);a--;){var l=i[a];if(o&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++a<s;){var h=(l=i[a])[0],c=e[h],u=l[1];if(o&&l[2]){if(c===r&&!(h in e))return!1}else{var d=new Yr;if(n)var p=n(c,u,h,e,t,d);if(!(p===r?Ii(u,c,3,n,d):p))return!1}}return!0}function Li(e){return!(!Qs(e)||function(e){return!!Ue&&Ue in e}(e))&&(Zs(e)?Ve:ge).test(Na(e))}function Di(e){return"function"==typeof e?e:null==e?il:"object"==typeof e?js(e)?zi(e[0],e[1]):Bi(e):dl(e)}function ki(e){if(!Sa(e))return gr(e);var t=[];for(var r in Ae(e))Fe.call(e,r)&&"constructor"!=r&&t.push(r);return t}function Fi(e){if(!Qs(e))return function(e){var t=[];if(null!=e)for(var r in Ae(e))t.push(r);return t}(e);var t=Sa(e),r=[];for(var i in e)"constructor"==i&&(t||!Fe.call(e,i))||r.push(i);return r}function Ni(e,t){return e<t}function Ui(e,t){var r=-1,i=Ws(e)?we(e.length):[];return ui(e,(function(e,n,a){i[++r]=t(e,n,a)})),i}function Bi(e){var t=ca(e);return 1==t.length&&t[0][2]?Ma(t[0][0],t[0][1]):function(r){return r===e||Oi(r,e,t)}}function zi(e,t){return xa(e)&&Ta(t)?Ma(Fa(e),t):function(i){var n=Eo(i,e);return n===r&&n===t?Ao(i,e):Ii(t,n,3)}}function Hi(e,t,i,n,a){e!==t&&vi(t,(function(s,o){if(a||(a=new Yr),Qs(s))!function(e,t,i,n,a,s,o){var l=Ca(e,i),h=Ca(t,i),c=o.get(h);if(c)return void Qr(e,i,c);var u=s?s(l,h,i+"",e,t,o):r,d=u===r;if(d){var p=js(h),f=!p&&qs(h),m=!p&&!f&&lo(h);u=h,p||f||m?js(l)?u=l:Xs(l)?u=Pn(l):f?(d=!1,u=Sn(h,!0)):m?(d=!1,u=Mn(h,!0)):u=[]:io(h)||Vs(h)?(u=l,Vs(l)?u=vo(l):(!Qs(l)||Zs(l))&&(u=ga(h))):d=!1}d&&(o.set(h,u),a(u,h,n,s,o),o.delete(h)),Qr(e,i,u)}(e,t,o,i,Hi,n,a);else{var l=n?n(Ca(e,o),s,o+"",e,t,a):r;l===r&&(l=s),Qr(e,o,l)}}),Oo)}function Vi(e,t){var i=e.length;if(i)return ya(t+=t<0?i:0,i)?e[t]:r}function ji(e,t,r){t=t.length?Lt(t,(function(e){return js(e)?function(t){return wi(t,1===e.length?e[0]:e)}:e})):[il];var i=-1;return t=Lt(t,Kt(la())),function(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}(Ui(e,(function(e,r,n){return{criteria:Lt(t,(function(t){return t(e)})),index:++i,value:e}})),(function(e,t){return function(e,t,r){for(var i=-1,n=e.criteria,a=t.criteria,s=n.length,o=r.length;++i<s;){var l=En(n[i],a[i]);if(l)return i>=o?l:l*("desc"==r[i]?-1:1)}return e.index-t.index}(e,t,r)}))}function Gi(e,t,r){for(var i=-1,n=t.length,a={};++i<n;){var s=t[i],o=wi(e,s);r(o,s)&&Ji(a,bn(s,e),o)}return a}function Wi(e,t,r,i){var n=i?Vt:Ht,a=-1,s=t.length,o=e;for(e===t&&(t=Pn(t)),r&&(o=Lt(e,Kt(r)));++a<s;)for(var l=0,h=t[a],c=r?r(h):h;(l=n(o,c,l,i))>-1;)o!==e&&Ze.call(o,l,1),Ze.call(e,l,1);return e}function Xi(e,t){for(var r=e?t.length:0,i=r-1;r--;){var n=t[r];if(r==i||n!==a){var a=n;ya(n)?Ze.call(e,n,1):un(e,n)}}return e}function qi(e,t){return e+vt(_r()*(t-e+1))}function Yi(e,t){var r="";if(!e||t<1||t>d)return r;do{t%2&&(r+=e),(t=vt(t/2))&&(e+=e)}while(t);return r}function $i(e,t){return Ia(Ea(e,t,il),e+"")}function Zi(e){return Zr(zo(e))}function Ki(e,t){var r=zo(e);return Da(r,si(t,0,r.length))}function Ji(e,t,i,n){if(!Qs(e))return e;for(var a=-1,s=(t=bn(t,e)).length,o=s-1,l=e;null!=l&&++a<s;){var h=Fa(t[a]),c=i;if("__proto__"===h||"constructor"===h||"prototype"===h)return e;if(a!=o){var u=l[h];(c=n?n(u,h,l):r)===r&&(c=Qs(u)?u:ya(t[a+1])?[]:{})}ei(l,h,c),l=l[h]}return e}var Qi=Pr?function(e,t){return Pr.set(e,t),e}:il,en=lt?function(e,t){return lt(e,"toString",{configurable:!0,enumerable:!1,value:el(t),writable:!0})}:il;function tn(e){return Da(zo(e))}function rn(e,t,r){var i=-1,n=e.length;t<0&&(t=-t>n?0:n+t),(r=r>n?n:r)<0&&(r+=n),n=t>r?0:r-t>>>0,t>>>=0;for(var a=we(n);++i<n;)a[i]=e[i+t];return a}function nn(e,t){var r;return ui(e,(function(e,i,n){return!(r=t(e,i,n))})),!!r}function an(e,t,r){var i=0,n=null==e?i:e.length;if("number"==typeof t&&t==t&&n<=2147483647){for(;i<n;){var a=i+n>>>1,s=e[a];null!==s&&!oo(s)&&(r?s<=t:s<t)?i=a+1:n=a}return n}return sn(e,t,il,r)}function sn(e,t,i,n){var a=0,s=null==e?0:e.length;if(0===s)return 0;for(var o=(t=i(t))!=t,l=null===t,h=oo(t),c=t===r;a<s;){var u=vt((a+s)/2),d=i(e[u]),p=d!==r,f=null===d,m=d==d,g=oo(d);if(o)var v=n||m;else v=c?m&&(n||p):l?m&&p&&(n||!f):h?m&&p&&!f&&(n||!g):!f&&!g&&(n?d<=t:d<t);v?a=u+1:s=u}return yr(s,4294967294)}function on(e,t){for(var r=-1,i=e.length,n=0,a=[];++r<i;){var s=e[r],o=t?t(s):s;if(!r||!Bs(o,l)){var l=o;a[n++]=0===s?0:s}}return a}function ln(e){return"number"==typeof e?e:oo(e)?p:+e}function hn(e){if("string"==typeof e)return e;if(js(e))return Lt(e,hn)+"";if(oo(e))return Ur?Ur.call(e):"";var t=e+"";return"0"==t&&1/e==-u?"-0":t}function cn(e,t,r){var i=-1,n=It,a=e.length,s=!0,o=[],l=o;if(r)s=!1,n=Ot;else if(a>=200){var h=t?null:$n(e);if(h)return hr(h);s=!1,n=Qt,l=new qr}else l=t?[]:o;e:for(;++i<a;){var c=e[i],u=t?t(c):c;if(c=r||0!==c?c:0,s&&u==u){for(var d=l.length;d--;)if(l[d]===u)continue e;t&&l.push(u),o.push(c)}else n(l,u,r)||(l!==o&&l.push(u),o.push(c))}return o}function un(e,t){return null==(e=Aa(e,t=bn(t,e)))||delete e[Fa($a(t))]}function dn(e,t,r,i){return Ji(e,t,r(wi(e,t)),i)}function pn(e,t,r,i){for(var n=e.length,a=i?n:-1;(i?a--:++a<n)&&t(e[a],a,e););return r?rn(e,i?0:a,i?a+1:n):rn(e,i?a+1:0,i?n:a)}function fn(e,t){var r=e;return r instanceof jr&&(r=r.value()),kt(t,(function(e,t){return t.func.apply(t.thisArg,Dt([e],t.args))}),r)}function mn(e,t,r){var i=e.length;if(i<2)return i?cn(e[0]):[];for(var n=-1,a=we(i);++n<i;)for(var s=e[n],o=-1;++o<i;)o!=n&&(a[n]=ci(a[n]||s,e[o],t,r));return cn(gi(a,1),t,r)}function gn(e,t,i){for(var n=-1,a=e.length,s=t.length,o={};++n<a;){var l=n<s?t[n]:r;i(o,e[n],l)}return o}function vn(e){return Xs(e)?e:[]}function yn(e){return"function"==typeof e?e:il}function bn(e,t){return js(e)?e:xa(e,t)?[e]:ka(yo(e))}var xn=$i;function _n(e,t,i){var n=e.length;return i=i===r?n:i,!t&&i>=n?e:rn(e,t,i)}var wn=ut||function(e){return pt.clearTimeout(e)};function Sn(e,t){if(t)return e.slice();var r=e.length,i=Xe?Xe(r):new e.constructor(r);return e.copy(i),i}function Tn(e){var t=new e.constructor(e.byteLength);return new We(t).set(new We(e)),t}function Mn(e,t){var r=t?Tn(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function En(e,t){if(e!==t){var i=e!==r,n=null===e,a=e==e,s=oo(e),o=t!==r,l=null===t,h=t==t,c=oo(t);if(!l&&!c&&!s&&e>t||s&&o&&h&&!l&&!c||n&&o&&h||!i&&h||!a)return 1;if(!n&&!s&&!c&&e<t||c&&i&&a&&!n&&!s||l&&i&&a||!o&&a||!h)return-1}return 0}function An(e,t,r,i){for(var n=-1,a=e.length,s=r.length,o=-1,l=t.length,h=vr(a-s,0),c=we(l+h),u=!i;++o<l;)c[o]=t[o];for(;++n<s;)(u||n<a)&&(c[r[n]]=e[n]);for(;h--;)c[o++]=e[n++];return c}function Cn(e,t,r,i){for(var n=-1,a=e.length,s=-1,o=r.length,l=-1,h=t.length,c=vr(a-o,0),u=we(c+h),d=!i;++n<c;)u[n]=e[n];for(var p=n;++l<h;)u[p+l]=t[l];for(;++s<o;)(d||n<a)&&(u[p+r[s]]=e[n++]);return u}function Pn(e,t){var r=-1,i=e.length;for(t||(t=we(i));++r<i;)t[r]=e[r];return t}function Rn(e,t,i,n){var a=!i;i||(i={});for(var s=-1,o=t.length;++s<o;){var l=t[s],h=n?n(i[l],e[l],l,i,e):r;h===r&&(h=e[l]),a?ni(i,l,h):ei(i,l,h)}return i}function In(e,t){return function(r,i){var n=js(r)?Et:ri,a=t?t():{};return n(r,e,la(i,2),a)}}function On(e){return $i((function(t,i){var n=-1,a=i.length,s=a>1?i[a-1]:r,o=a>2?i[2]:r;for(s=e.length>3&&"function"==typeof s?(a--,s):r,o&&ba(i[0],i[1],o)&&(s=a<3?r:s,a=1),t=Ae(t);++n<a;){var l=i[n];l&&e(t,l,n,s)}return t}))}function Ln(e,t){return function(r,i){if(null==r)return r;if(!Ws(r))return e(r,i);for(var n=r.length,a=t?n:-1,s=Ae(r);(t?a--:++a<n)&&!1!==i(s[a],a,s););return r}}function Dn(e){return function(t,r,i){for(var n=-1,a=Ae(t),s=i(t),o=s.length;o--;){var l=s[e?o:++n];if(!1===r(a[l],l,a))break}return t}}function kn(e){return function(t){var i=ar(t=yo(t))?ur(t):r,n=i?i[0]:t.charAt(0),a=i?_n(i,1).join(""):t.slice(1);return n[e]()+a}}function Fn(e){return function(t){return kt(Ko(jo(t).replace(Je,"")),e,"")}}function Nn(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=zr(e.prototype),i=e.apply(r,t);return Qs(i)?i:r}}function Un(e){return function(t,i,n){var a=Ae(t);if(!Ws(t)){var s=la(i,3);t=Io(t),i=function(e){return s(a[e],e,a)}}var o=e(t,i,n);return o>-1?a[s?t[o]:o]:r}}function Bn(e){return ra((function(t){var n=t.length,a=n,s=Vr.prototype.thru;for(e&&t.reverse();a--;){var o=t[a];if("function"!=typeof o)throw new Re(i);if(s&&!l&&"wrapper"==sa(o))var l=new Vr([],!0)}for(a=l?a:n;++a<n;){var h=sa(o=t[a]),c="wrapper"==h?aa(o):r;l=c&&_a(c[0])&&424==c[1]&&!c[4].length&&1==c[9]?l[sa(c[0])].apply(l,c[3]):1==o.length&&_a(o)?l[h]():l.thru(o)}return function(){var e=arguments,r=e[0];if(l&&1==e.length&&js(r))return l.plant(r).value();for(var i=0,a=n?t[i].apply(this,e):r;++i<n;)a=t[i].call(this,a);return a}}))}function zn(e,t,i,n,a,s,o,l,c,u){var d=t&h,p=1&t,f=2&t,m=24&t,g=512&t,v=f?r:Nn(e);return function h(){for(var y=arguments.length,b=we(y),x=y;x--;)b[x]=arguments[x];if(m)var _=oa(h),w=function(e,t){for(var r=e.length,i=0;r--;)e[r]===t&&++i;return i}(b,_);if(n&&(b=An(b,n,a,m)),s&&(b=Cn(b,s,o,m)),y-=w,m&&y<u){var S=lr(b,_);return qn(e,t,zn,h.placeholder,i,b,S,l,c,u-y)}var T=p?i:this,M=f?T[e]:e;return y=b.length,l?b=function(e,t){for(var i=e.length,n=yr(t.length,i),a=Pn(e);n--;){var s=t[n];e[n]=ya(s,i)?a[s]:r}return e}(b,l):g&&y>1&&b.reverse(),d&&c<y&&(b.length=c),this&&this!==pt&&this instanceof h&&(M=v||Nn(M)),M.apply(T,b)}}function Hn(e,t){return function(r,i){return function(e,t,r,i){return bi(e,(function(e,n,a){t(i,r(e),n,a)})),i}(r,e,t(i),{})}}function Vn(e,t){return function(i,n){var a;if(i===r&&n===r)return t;if(i!==r&&(a=i),n!==r){if(a===r)return n;"string"==typeof i||"string"==typeof n?(i=hn(i),n=hn(n)):(i=ln(i),n=ln(n)),a=e(i,n)}return a}}function jn(e){return ra((function(t){return t=Lt(t,Kt(la())),$i((function(r){var i=this;return e(t,(function(e){return Mt(e,i,r)}))}))}))}function Gn(e,t){var i=(t=t===r?" ":hn(t)).length;if(i<2)return i?Yi(t,e):t;var n=Yi(t,mt(e/cr(t)));return ar(t)?_n(ur(n),0,e).join(""):n.slice(0,e)}function Wn(e){return function(t,i,n){return n&&"number"!=typeof n&&ba(t,i,n)&&(i=n=r),t=po(t),i===r?(i=t,t=0):i=po(i),function(e,t,r,i){for(var n=-1,a=vr(mt((t-e)/(r||1)),0),s=we(a);a--;)s[i?a:++n]=e,e+=r;return s}(t,i,n=n===r?t<i?1:-1:po(n),e)}}function Xn(e){return function(t,r){return"string"==typeof t&&"string"==typeof r||(t=go(t),r=go(r)),e(t,r)}}function qn(e,t,i,n,a,s,h,c,u,d){var p=8&t;t|=p?o:l,4&(t&=~(p?l:o))||(t&=-4);var f=[e,t,a,p?s:r,p?h:r,p?r:s,p?r:h,c,u,d],m=i.apply(r,f);return _a(e)&&Pa(m,f),m.placeholder=n,Oa(m,e,t)}function Yn(e){var t=Ee[e];return function(e,r){if(e=go(e),(r=null==r?0:yr(fo(r),292))&&Xt(e)){var i=(yo(e)+"e").split("e");return+((i=(yo(t(i[0]+"e"+(+i[1]+r)))+"e").split("e"))[0]+"e"+(+i[1]-r))}return t(e)}}var $n=Er&&1/hr(new Er([,-0]))[1]==u?function(e){return new Er(e)}:ll;function Zn(e){return function(t){var r=fa(t);return r==S?sr(t):r==C?function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=[e,e]})),r}(t):function(e,t){return Lt(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Kn(e,t,n,u,d,p,f,m){var g=2&t;if(!g&&"function"!=typeof e)throw new Re(i);var v=u?u.length:0;if(v||(t&=-97,u=d=r),f=f===r?f:vr(fo(f),0),m=m===r?m:fo(m),v-=d?d.length:0,t&l){var y=u,b=d;u=d=r}var x=g?r:aa(e),_=[e,t,n,u,d,y,b,p,f,m];if(x&&function(e,t){var r=e[1],i=t[1],n=r|i,s=n<131,o=i==h&&8==r||i==h&&r==c&&e[7].length<=t[8]||384==i&&t[7].length<=t[8]&&8==r;if(!s&&!o)return e;1&i&&(e[2]=t[2],n|=1&r?0:4);var l=t[3];if(l){var u=e[3];e[3]=u?An(u,l,t[4]):l,e[4]=u?lr(e[3],a):t[4]}l=t[5],l&&(u=e[5],e[5]=u?Cn(u,l,t[6]):l,e[6]=u?lr(e[5],a):t[6]),l=t[7],l&&(e[7]=l),i&h&&(e[8]=null==e[8]?t[8]:yr(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=n}(_,x),e=_[0],t=_[1],n=_[2],u=_[3],d=_[4],!(m=_[9]=_[9]===r?g?0:e.length:vr(_[9]-v,0))&&24&t&&(t&=-25),t&&1!=t)w=8==t||t==s?function(e,t,i){var n=Nn(e);return function a(){for(var s=arguments.length,o=we(s),l=s,h=oa(a);l--;)o[l]=arguments[l];var c=s<3&&o[0]!==h&&o[s-1]!==h?[]:lr(o,h);return(s-=c.length)<i?qn(e,t,zn,a.placeholder,r,o,c,r,r,i-s):Mt(this&&this!==pt&&this instanceof a?n:e,this,o)}}(e,t,m):t!=o&&33!=t||d.length?zn.apply(r,_):function(e,t,r,i){var n=1&t,a=Nn(e);return function t(){for(var s=-1,o=arguments.length,l=-1,h=i.length,c=we(h+o),u=this&&this!==pt&&this instanceof t?a:e;++l<h;)c[l]=i[l];for(;o--;)c[l++]=arguments[++s];return Mt(u,n?r:this,c)}}(e,t,n,u);else var w=function(e,t,r){var i=1&t,n=Nn(e);return function t(){return(this&&this!==pt&&this instanceof t?n:e).apply(i?r:this,arguments)}}(e,t,n);return Oa((x?Qi:Pa)(w,_),e,t)}function Jn(e,t,i,n){return e===r||Bs(e,Le[i])&&!Fe.call(n,i)?t:e}function Qn(e,t,i,n,a,s){return Qs(e)&&Qs(t)&&(s.set(t,e),Hi(e,t,r,Qn,s),s.delete(t)),e}function ea(e){return io(e)?r:e}function ta(e,t,i,n,a,s){var o=1&i,l=e.length,h=t.length;if(l!=h&&!(o&&h>l))return!1;var c=s.get(e),u=s.get(t);if(c&&u)return c==t&&u==e;var d=-1,p=!0,f=2&i?new qr:r;for(s.set(e,t),s.set(t,e);++d<l;){var m=e[d],g=t[d];if(n)var v=o?n(g,m,d,t,e,s):n(m,g,d,e,t,s);if(v!==r){if(v)continue;p=!1;break}if(f){if(!Nt(t,(function(e,t){if(!Qt(f,t)&&(m===e||a(m,e,i,n,s)))return f.push(t)}))){p=!1;break}}else if(m!==g&&!a(m,g,i,n,s)){p=!1;break}}return s.delete(e),s.delete(t),p}function ra(e){return Ia(Ea(e,r,Ga),e+"")}function ia(e){return Si(e,Io,da)}function na(e){return Si(e,Oo,pa)}var aa=Pr?function(e){return Pr.get(e)}:ll;function sa(e){for(var t=e.name+"",r=Rr[t],i=Fe.call(Rr,t)?r.length:0;i--;){var n=r[i],a=n.func;if(null==a||a==e)return n.name}return t}function oa(e){return(Fe.call(Br,"placeholder")?Br:e).placeholder}function la(){var e=Br.iteratee||nl;return e=e===nl?Di:e,arguments.length?e(arguments[0],arguments[1]):e}function ha(e,t){var r=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?r["string"==typeof t?"string":"hash"]:r.map}function ca(e){for(var t=Io(e),r=t.length;r--;){var i=t[r],n=e[i];t[r]=[i,n,Ta(n)]}return t}function ua(e,t){var i=function(e,t){return null==e?r:e[t]}(e,t);return Li(i)?i:r}var da=yt?function(e){return null==e?[]:(e=Ae(e),Rt(yt(e),(function(t){return $e.call(e,t)})))}:ml,pa=yt?function(e){for(var t=[];e;)Dt(t,da(e)),e=qe(e);return t}:ml,fa=Ti;function ma(e,t,r){for(var i=-1,n=(t=bn(t,e)).length,a=!1;++i<n;){var s=Fa(t[i]);if(!(a=null!=e&&r(e,s)))break;e=e[s]}return a||++i!=n?a:!!(n=null==e?0:e.length)&&Js(n)&&ya(s,n)&&(js(e)||Vs(e))}function ga(e){return"function"!=typeof e.constructor||Sa(e)?{}:zr(qe(e))}function va(e){return js(e)||Vs(e)||!!(Ke&&e&&e[Ke])}function ya(e,t){var r=typeof e;return!!(t=null==t?d:t)&&("number"==r||"symbol"!=r&&ye.test(e))&&e>-1&&e%1==0&&e<t}function ba(e,t,r){if(!Qs(r))return!1;var i=typeof t;return!!("number"==i?Ws(r)&&ya(t,r.length):"string"==i&&t in r)&&Bs(r[t],e)}function xa(e,t){if(js(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!oo(e))||(ee.test(e)||!Q.test(e)||null!=t&&e in Ae(t))}function _a(e){var t=sa(e),r=Br[t];if("function"!=typeof r||!(t in jr.prototype))return!1;if(e===r)return!0;var i=aa(r);return!!i&&e===i[0]}(Sr&&fa(new Sr(new ArrayBuffer(1)))!=L||Tr&&fa(new Tr)!=S||Mr&&fa(Mr.resolve())!=E||Er&&fa(new Er)!=C||Ar&&fa(new Ar)!=I)&&(fa=function(e){var t=Ti(e),i=t==M?e.constructor:r,n=i?Na(i):"";if(n)switch(n){case Ir:return L;case Or:return S;case Lr:return E;case Dr:return C;case kr:return I}return t});var wa=De?Zs:gl;function Sa(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Le)}function Ta(e){return e==e&&!Qs(e)}function Ma(e,t){return function(i){return null!=i&&(i[e]===t&&(t!==r||e in Ae(i)))}}function Ea(e,t,i){return t=vr(t===r?e.length-1:t,0),function(){for(var r=arguments,n=-1,a=vr(r.length-t,0),s=we(a);++n<a;)s[n]=r[t+n];n=-1;for(var o=we(t+1);++n<t;)o[n]=r[n];return o[t]=i(s),Mt(e,this,o)}}function Aa(e,t){return t.length<2?e:wi(e,rn(t,0,-1))}function Ca(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var Pa=La(Qi),Ra=ft||function(e,t){return pt.setTimeout(e,t)},Ia=La(en);function Oa(e,t,r){var i=t+"";return Ia(e,function(e,t){var r=t.length;if(!r)return e;var i=r-1;return t[i]=(r>1?"& ":"")+t[i],t=t.join(r>2?", ":" "),e.replace(se,"{\n/* [wrapped with "+t+"] */\n")}(i,function(e,t){return At(m,(function(r){var i="_."+r[0];t&r[1]&&!It(e,i)&&e.push(i)})),e.sort()}(function(e){var t=e.match(oe);return t?t[1].split(le):[]}(i),r)))}function La(e){var t=0,i=0;return function(){var n=br(),a=16-(n-i);if(i=n,a>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(r,arguments)}}function Da(e,t){var i=-1,n=e.length,a=n-1;for(t=t===r?n:t;++i<t;){var s=qi(i,a),o=e[s];e[s]=e[i],e[i]=o}return e.length=t,e}var ka=function(e){var t=Ls(e,(function(e){return 500===r.size&&r.clear(),e})),r=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(te,(function(e,r,i,n){t.push(i?n.replace(ue,"$1"):r||e)})),t}));function Fa(e){if("string"==typeof e||oo(e))return e;var t=e+"";return"0"==t&&1/e==-u?"-0":t}function Na(e){if(null!=e){try{return ke.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ua(e){if(e instanceof jr)return e.clone();var t=new Vr(e.__wrapped__,e.__chain__);return t.__actions__=Pn(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Ba=$i((function(e,t){return Xs(e)?ci(e,gi(t,1,Xs,!0)):[]})),za=$i((function(e,t){var i=$a(t);return Xs(i)&&(i=r),Xs(e)?ci(e,gi(t,1,Xs,!0),la(i,2)):[]})),Ha=$i((function(e,t){var i=$a(t);return Xs(i)&&(i=r),Xs(e)?ci(e,gi(t,1,Xs,!0),r,i):[]}));function Va(e,t,r){var i=null==e?0:e.length;if(!i)return-1;var n=null==r?0:fo(r);return n<0&&(n=vr(i+n,0)),zt(e,la(t,3),n)}function ja(e,t,i){var n=null==e?0:e.length;if(!n)return-1;var a=n-1;return i!==r&&(a=fo(i),a=i<0?vr(n+a,0):yr(a,n-1)),zt(e,la(t,3),a,!0)}function Ga(e){return(null==e?0:e.length)?gi(e,1):[]}function Wa(e){return e&&e.length?e[0]:r}var Xa=$i((function(e){var t=Lt(e,vn);return t.length&&t[0]===e[0]?Ci(t):[]})),qa=$i((function(e){var t=$a(e),i=Lt(e,vn);return t===$a(i)?t=r:i.pop(),i.length&&i[0]===e[0]?Ci(i,la(t,2)):[]})),Ya=$i((function(e){var t=$a(e),i=Lt(e,vn);return(t="function"==typeof t?t:r)&&i.pop(),i.length&&i[0]===e[0]?Ci(i,r,t):[]}));function $a(e){var t=null==e?0:e.length;return t?e[t-1]:r}var Za=$i(Ka);function Ka(e,t){return e&&e.length&&t&&t.length?Wi(e,t):e}var Ja=ra((function(e,t){var r=null==e?0:e.length,i=ai(e,t);return Xi(e,Lt(t,(function(e){return ya(e,r)?+e:e})).sort(En)),i}));function Qa(e){return null==e?e:wr.call(e)}var es=$i((function(e){return cn(gi(e,1,Xs,!0))})),ts=$i((function(e){var t=$a(e);return Xs(t)&&(t=r),cn(gi(e,1,Xs,!0),la(t,2))})),rs=$i((function(e){var t=$a(e);return t="function"==typeof t?t:r,cn(gi(e,1,Xs,!0),r,t)}));function is(e){if(!e||!e.length)return[];var t=0;return e=Rt(e,(function(e){if(Xs(e))return t=vr(e.length,t),!0})),$t(t,(function(t){return Lt(e,Wt(t))}))}function ns(e,t){if(!e||!e.length)return[];var i=is(e);return null==t?i:Lt(i,(function(e){return Mt(t,r,e)}))}var as=$i((function(e,t){return Xs(e)?ci(e,t):[]})),ss=$i((function(e){return mn(Rt(e,Xs))})),os=$i((function(e){var t=$a(e);return Xs(t)&&(t=r),mn(Rt(e,Xs),la(t,2))})),ls=$i((function(e){var t=$a(e);return t="function"==typeof t?t:r,mn(Rt(e,Xs),r,t)})),hs=$i(is);var cs=$i((function(e){var t=e.length,i=t>1?e[t-1]:r;return i="function"==typeof i?(e.pop(),i):r,ns(e,i)}));function us(e){var t=Br(e);return t.__chain__=!0,t}function ds(e,t){return t(e)}var ps=ra((function(e){var t=e.length,i=t?e[0]:0,n=this.__wrapped__,a=function(t){return ai(t,e)};return!(t>1||this.__actions__.length)&&n instanceof jr&&ya(i)?((n=n.slice(i,+i+(t?1:0))).__actions__.push({func:ds,args:[a],thisArg:r}),new Vr(n,this.__chain__).thru((function(e){return t&&!e.length&&e.push(r),e}))):this.thru(a)}));var fs=In((function(e,t,r){Fe.call(e,r)?++e[r]:ni(e,r,1)}));var ms=Un(Va),gs=Un(ja);function vs(e,t){return(js(e)?At:ui)(e,la(t,3))}function ys(e,t){return(js(e)?Ct:di)(e,la(t,3))}var bs=In((function(e,t,r){Fe.call(e,r)?e[r].push(t):ni(e,r,[t])}));var xs=$i((function(e,t,r){var i=-1,n="function"==typeof t,a=Ws(e)?we(e.length):[];return ui(e,(function(e){a[++i]=n?Mt(t,e,r):Pi(e,t,r)})),a})),_s=In((function(e,t,r){ni(e,r,t)}));function ws(e,t){return(js(e)?Lt:Ui)(e,la(t,3))}var Ss=In((function(e,t,r){e[r?0:1].push(t)}),(function(){return[[],[]]}));var Ts=$i((function(e,t){if(null==e)return[];var r=t.length;return r>1&&ba(e,t[0],t[1])?t=[]:r>2&&ba(t[0],t[1],t[2])&&(t=[t[0]]),ji(e,gi(t,1),[])})),Ms=dt||function(){return pt.Date.now()};function Es(e,t,i){return t=i?r:t,t=e&&null==t?e.length:t,Kn(e,h,r,r,r,r,t)}function As(e,t){var n;if("function"!=typeof t)throw new Re(i);return e=fo(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=r),n}}var Cs=$i((function(e,t,r){var i=1;if(r.length){var n=lr(r,oa(Cs));i|=o}return Kn(e,i,t,r,n)})),Ps=$i((function(e,t,r){var i=3;if(r.length){var n=lr(r,oa(Ps));i|=o}return Kn(t,i,e,r,n)}));function Rs(e,t,n){var a,s,o,l,h,c,u=0,d=!1,p=!1,f=!0;if("function"!=typeof e)throw new Re(i);function m(t){var i=a,n=s;return a=s=r,u=t,l=e.apply(n,i)}function g(e){var i=e-c;return c===r||i>=t||i<0||p&&e-u>=o}function v(){var e=Ms();if(g(e))return y(e);h=Ra(v,function(e){var r=t-(e-c);return p?yr(r,o-(e-u)):r}(e))}function y(e){return h=r,f&&a?m(e):(a=s=r,l)}function b(){var e=Ms(),i=g(e);if(a=arguments,s=this,c=e,i){if(h===r)return function(e){return u=e,h=Ra(v,t),d?m(e):l}(c);if(p)return wn(h),h=Ra(v,t),m(c)}return h===r&&(h=Ra(v,t)),l}return t=go(t)||0,Qs(n)&&(d=!!n.leading,o=(p="maxWait"in n)?vr(go(n.maxWait)||0,t):o,f="trailing"in n?!!n.trailing:f),b.cancel=function(){h!==r&&wn(h),u=0,a=c=s=h=r},b.flush=function(){return h===r?l:y(Ms())},b}var Is=$i((function(e,t){return hi(e,1,t)})),Os=$i((function(e,t,r){return hi(e,go(t)||0,r)}));function Ls(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new Re(i);var r=function(){var i=arguments,n=t?t.apply(this,i):i[0],a=r.cache;if(a.has(n))return a.get(n);var s=e.apply(this,i);return r.cache=a.set(n,s)||a,s};return r.cache=new(Ls.Cache||Xr),r}function Ds(e){if("function"!=typeof e)throw new Re(i);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Ls.Cache=Xr;var ks=xn((function(e,t){var r=(t=1==t.length&&js(t[0])?Lt(t[0],Kt(la())):Lt(gi(t,1),Kt(la()))).length;return $i((function(i){for(var n=-1,a=yr(i.length,r);++n<a;)i[n]=t[n].call(this,i[n]);return Mt(e,this,i)}))})),Fs=$i((function(e,t){var i=lr(t,oa(Fs));return Kn(e,o,r,t,i)})),Ns=$i((function(e,t){var i=lr(t,oa(Ns));return Kn(e,l,r,t,i)})),Us=ra((function(e,t){return Kn(e,c,r,r,r,t)}));function Bs(e,t){return e===t||e!=e&&t!=t}var zs=Xn(Mi),Hs=Xn((function(e,t){return e>=t})),Vs=Ri(function(){return arguments}())?Ri:function(e){return eo(e)&&Fe.call(e,"callee")&&!$e.call(e,"callee")},js=we.isArray,Gs=bt?Kt(bt):function(e){return eo(e)&&Ti(e)==O};function Ws(e){return null!=e&&Js(e.length)&&!Zs(e)}function Xs(e){return eo(e)&&Ws(e)}var qs=Ut||gl,Ys=xt?Kt(xt):function(e){return eo(e)&&Ti(e)==b};function $s(e){if(!eo(e))return!1;var t=Ti(e);return t==x||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!io(e)}function Zs(e){if(!Qs(e))return!1;var t=Ti(e);return t==_||t==w||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Ks(e){return"number"==typeof e&&e==fo(e)}function Js(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=d}function Qs(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function eo(e){return null!=e&&"object"==typeof e}var to=_t?Kt(_t):function(e){return eo(e)&&fa(e)==S};function ro(e){return"number"==typeof e||eo(e)&&Ti(e)==T}function io(e){if(!eo(e)||Ti(e)!=M)return!1;var t=qe(e);if(null===t)return!0;var r=Fe.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&ke.call(r)==ze}var no=wt?Kt(wt):function(e){return eo(e)&&Ti(e)==A};var ao=St?Kt(St):function(e){return eo(e)&&fa(e)==C};function so(e){return"string"==typeof e||!js(e)&&eo(e)&&Ti(e)==P}function oo(e){return"symbol"==typeof e||eo(e)&&Ti(e)==R}var lo=Tt?Kt(Tt):function(e){return eo(e)&&Js(e.length)&&!!st[Ti(e)]};var ho=Xn(Ni),co=Xn((function(e,t){return e<=t}));function uo(e){if(!e)return[];if(Ws(e))return so(e)?ur(e):Pn(e);if(et&&e[et])return function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}(e[et]());var t=fa(e);return(t==S?sr:t==C?hr:zo)(e)}function po(e){return e?(e=go(e))===u||e===-u?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function fo(e){var t=po(e),r=t%1;return t==t?r?t-r:t:0}function mo(e){return e?si(fo(e),0,f):0}function go(e){if("number"==typeof e)return e;if(oo(e))return p;if(Qs(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Qs(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Zt(e);var r=me.test(e);return r||ve.test(e)?ct(e.slice(2),r?2:8):fe.test(e)?p:+e}function vo(e){return Rn(e,Oo(e))}function yo(e){return null==e?"":hn(e)}var bo=On((function(e,t){if(Sa(t)||Ws(t))Rn(t,Io(t),e);else for(var r in t)Fe.call(t,r)&&ei(e,r,t[r])})),xo=On((function(e,t){Rn(t,Oo(t),e)})),_o=On((function(e,t,r,i){Rn(t,Oo(t),e,i)})),wo=On((function(e,t,r,i){Rn(t,Io(t),e,i)})),So=ra(ai);var To=$i((function(e,t){e=Ae(e);var i=-1,n=t.length,a=n>2?t[2]:r;for(a&&ba(t[0],t[1],a)&&(n=1);++i<n;)for(var s=t[i],o=Oo(s),l=-1,h=o.length;++l<h;){var c=o[l],u=e[c];(u===r||Bs(u,Le[c])&&!Fe.call(e,c))&&(e[c]=s[c])}return e})),Mo=$i((function(e){return e.push(r,Qn),Mt(Do,r,e)}));function Eo(e,t,i){var n=null==e?r:wi(e,t);return n===r?i:n}function Ao(e,t){return null!=e&&ma(e,t,Ai)}var Co=Hn((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Be.call(t)),e[t]=r}),el(il)),Po=Hn((function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Be.call(t)),Fe.call(e,t)?e[t].push(r):e[t]=[r]}),la),Ro=$i(Pi);function Io(e){return Ws(e)?$r(e):ki(e)}function Oo(e){return Ws(e)?$r(e,!0):Fi(e)}var Lo=On((function(e,t,r){Hi(e,t,r)})),Do=On((function(e,t,r,i){Hi(e,t,r,i)})),ko=ra((function(e,t){var r={};if(null==e)return r;var i=!1;t=Lt(t,(function(t){return t=bn(t,e),i||(i=t.length>1),t})),Rn(e,na(e),r),i&&(r=oi(r,7,ea));for(var n=t.length;n--;)un(r,t[n]);return r}));var Fo=ra((function(e,t){return null==e?{}:function(e,t){return Gi(e,t,(function(t,r){return Ao(e,r)}))}(e,t)}));function No(e,t){if(null==e)return{};var r=Lt(na(e),(function(e){return[e]}));return t=la(t),Gi(e,r,(function(e,r){return t(e,r[0])}))}var Uo=Zn(Io),Bo=Zn(Oo);function zo(e){return null==e?[]:Jt(e,Io(e))}var Ho=Fn((function(e,t,r){return t=t.toLowerCase(),e+(r?Vo(t):t)}));function Vo(e){return Zo(yo(e).toLowerCase())}function jo(e){return(e=yo(e))&&e.replace(be,rr).replace(Qe,"")}var Go=Fn((function(e,t,r){return e+(r?"-":"")+t.toLowerCase()})),Wo=Fn((function(e,t,r){return e+(r?" ":"")+t.toLowerCase()})),Xo=kn("toLowerCase");var qo=Fn((function(e,t,r){return e+(r?"_":"")+t.toLowerCase()}));var Yo=Fn((function(e,t,r){return e+(r?" ":"")+Zo(t)}));var $o=Fn((function(e,t,r){return e+(r?" ":"")+t.toUpperCase()})),Zo=kn("toUpperCase");function Ko(e,t,i){return e=yo(e),(t=i?r:t)===r?function(e){return it.test(e)}(e)?function(e){return e.match(tt)||[]}(e):function(e){return e.match(he)||[]}(e):e.match(t)||[]}var Jo=$i((function(e,t){try{return Mt(e,r,t)}catch(e){return $s(e)?e:new Te(e)}})),Qo=ra((function(e,t){return At(t,(function(t){t=Fa(t),ni(e,t,Cs(e[t],e))})),e}));function el(e){return function(){return e}}var tl=Bn(),rl=Bn(!0);function il(e){return e}function nl(e){return Di("function"==typeof e?e:oi(e,1))}var al=$i((function(e,t){return function(r){return Pi(r,e,t)}})),sl=$i((function(e,t){return function(r){return Pi(e,r,t)}}));function ol(e,t,r){var i=Io(t),n=_i(t,i);null==r&&(!Qs(t)||!n.length&&i.length)&&(r=t,t=e,e=this,n=_i(t,Io(t)));var a=!(Qs(r)&&"chain"in r&&!r.chain),s=Zs(e);return At(n,(function(r){var i=t[r];e[r]=i,s&&(e.prototype[r]=function(){var t=this.__chain__;if(a||t){var r=e(this.__wrapped__);return(r.__actions__=Pn(this.__actions__)).push({func:i,args:arguments,thisArg:e}),r.__chain__=t,r}return i.apply(e,Dt([this.value()],arguments))})})),e}function ll(){}var hl=jn(Lt),cl=jn(Pt),ul=jn(Nt);function dl(e){return xa(e)?Wt(Fa(e)):function(e){return function(t){return wi(t,e)}}(e)}var pl=Wn(),fl=Wn(!0);function ml(){return[]}function gl(){return!1}var vl=Vn((function(e,t){return e+t}),0),yl=Yn("ceil"),bl=Vn((function(e,t){return e/t}),1),xl=Yn("floor");var _l=Vn((function(e,t){return e*t}),1),wl=Yn("round"),Sl=Vn((function(e,t){return e-t}),0);return Br.after=function(e,t){if("function"!=typeof t)throw new Re(i);return e=fo(e),function(){if(--e<1)return t.apply(this,arguments)}},Br.ary=Es,Br.assign=bo,Br.assignIn=xo,Br.assignInWith=_o,Br.assignWith=wo,Br.at=So,Br.before=As,Br.bind=Cs,Br.bindAll=Qo,Br.bindKey=Ps,Br.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return js(e)?e:[e]},Br.chain=us,Br.chunk=function(e,t,i){t=(i?ba(e,t,i):t===r)?1:vr(fo(t),0);var n=null==e?0:e.length;if(!n||t<1)return[];for(var a=0,s=0,o=we(mt(n/t));a<n;)o[s++]=rn(e,a,a+=t);return o},Br.compact=function(e){for(var t=-1,r=null==e?0:e.length,i=0,n=[];++t<r;){var a=e[t];a&&(n[i++]=a)}return n},Br.concat=function(){var e=arguments.length;if(!e)return[];for(var t=we(e-1),r=arguments[0],i=e;i--;)t[i-1]=arguments[i];return Dt(js(r)?Pn(r):[r],gi(t,1))},Br.cond=function(e){var t=null==e?0:e.length,r=la();return e=t?Lt(e,(function(e){if("function"!=typeof e[1])throw new Re(i);return[r(e[0]),e[1]]})):[],$i((function(r){for(var i=-1;++i<t;){var n=e[i];if(Mt(n[0],this,r))return Mt(n[1],this,r)}}))},Br.conforms=function(e){return function(e){var t=Io(e);return function(r){return li(r,e,t)}}(oi(e,1))},Br.constant=el,Br.countBy=fs,Br.create=function(e,t){var r=zr(e);return null==t?r:ii(r,t)},Br.curry=function e(t,i,n){var a=Kn(t,8,r,r,r,r,r,i=n?r:i);return a.placeholder=e.placeholder,a},Br.curryRight=function e(t,i,n){var a=Kn(t,s,r,r,r,r,r,i=n?r:i);return a.placeholder=e.placeholder,a},Br.debounce=Rs,Br.defaults=To,Br.defaultsDeep=Mo,Br.defer=Is,Br.delay=Os,Br.difference=Ba,Br.differenceBy=za,Br.differenceWith=Ha,Br.drop=function(e,t,i){var n=null==e?0:e.length;return n?rn(e,(t=i||t===r?1:fo(t))<0?0:t,n):[]},Br.dropRight=function(e,t,i){var n=null==e?0:e.length;return n?rn(e,0,(t=n-(t=i||t===r?1:fo(t)))<0?0:t):[]},Br.dropRightWhile=function(e,t){return e&&e.length?pn(e,la(t,3),!0,!0):[]},Br.dropWhile=function(e,t){return e&&e.length?pn(e,la(t,3),!0):[]},Br.fill=function(e,t,i,n){var a=null==e?0:e.length;return a?(i&&"number"!=typeof i&&ba(e,t,i)&&(i=0,n=a),function(e,t,i,n){var a=e.length;for((i=fo(i))<0&&(i=-i>a?0:a+i),(n=n===r||n>a?a:fo(n))<0&&(n+=a),n=i>n?0:mo(n);i<n;)e[i++]=t;return e}(e,t,i,n)):[]},Br.filter=function(e,t){return(js(e)?Rt:mi)(e,la(t,3))},Br.flatMap=function(e,t){return gi(ws(e,t),1)},Br.flatMapDeep=function(e,t){return gi(ws(e,t),u)},Br.flatMapDepth=function(e,t,i){return i=i===r?1:fo(i),gi(ws(e,t),i)},Br.flatten=Ga,Br.flattenDeep=function(e){return(null==e?0:e.length)?gi(e,u):[]},Br.flattenDepth=function(e,t){return(null==e?0:e.length)?gi(e,t=t===r?1:fo(t)):[]},Br.flip=function(e){return Kn(e,512)},Br.flow=tl,Br.flowRight=rl,Br.fromPairs=function(e){for(var t=-1,r=null==e?0:e.length,i={};++t<r;){var n=e[t];i[n[0]]=n[1]}return i},Br.functions=function(e){return null==e?[]:_i(e,Io(e))},Br.functionsIn=function(e){return null==e?[]:_i(e,Oo(e))},Br.groupBy=bs,Br.initial=function(e){return(null==e?0:e.length)?rn(e,0,-1):[]},Br.intersection=Xa,Br.intersectionBy=qa,Br.intersectionWith=Ya,Br.invert=Co,Br.invertBy=Po,Br.invokeMap=xs,Br.iteratee=nl,Br.keyBy=_s,Br.keys=Io,Br.keysIn=Oo,Br.map=ws,Br.mapKeys=function(e,t){var r={};return t=la(t,3),bi(e,(function(e,i,n){ni(r,t(e,i,n),e)})),r},Br.mapValues=function(e,t){var r={};return t=la(t,3),bi(e,(function(e,i,n){ni(r,i,t(e,i,n))})),r},Br.matches=function(e){return Bi(oi(e,1))},Br.matchesProperty=function(e,t){return zi(e,oi(t,1))},Br.memoize=Ls,Br.merge=Lo,Br.mergeWith=Do,Br.method=al,Br.methodOf=sl,Br.mixin=ol,Br.negate=Ds,Br.nthArg=function(e){return e=fo(e),$i((function(t){return Vi(t,e)}))},Br.omit=ko,Br.omitBy=function(e,t){return No(e,Ds(la(t)))},Br.once=function(e){return As(2,e)},Br.orderBy=function(e,t,i,n){return null==e?[]:(js(t)||(t=null==t?[]:[t]),js(i=n?r:i)||(i=null==i?[]:[i]),ji(e,t,i))},Br.over=hl,Br.overArgs=ks,Br.overEvery=cl,Br.overSome=ul,Br.partial=Fs,Br.partialRight=Ns,Br.partition=Ss,Br.pick=Fo,Br.pickBy=No,Br.property=dl,Br.propertyOf=function(e){return function(t){return null==e?r:wi(e,t)}},Br.pull=Za,Br.pullAll=Ka,Br.pullAllBy=function(e,t,r){return e&&e.length&&t&&t.length?Wi(e,t,la(r,2)):e},Br.pullAllWith=function(e,t,i){return e&&e.length&&t&&t.length?Wi(e,t,r,i):e},Br.pullAt=Ja,Br.range=pl,Br.rangeRight=fl,Br.rearg=Us,Br.reject=function(e,t){return(js(e)?Rt:mi)(e,Ds(la(t,3)))},Br.remove=function(e,t){var r=[];if(!e||!e.length)return r;var i=-1,n=[],a=e.length;for(t=la(t,3);++i<a;){var s=e[i];t(s,i,e)&&(r.push(s),n.push(i))}return Xi(e,n),r},Br.rest=function(e,t){if("function"!=typeof e)throw new Re(i);return $i(e,t=t===r?t:fo(t))},Br.reverse=Qa,Br.sampleSize=function(e,t,i){return t=(i?ba(e,t,i):t===r)?1:fo(t),(js(e)?Kr:Ki)(e,t)},Br.set=function(e,t,r){return null==e?e:Ji(e,t,r)},Br.setWith=function(e,t,i,n){return n="function"==typeof n?n:r,null==e?e:Ji(e,t,i,n)},Br.shuffle=function(e){return(js(e)?Jr:tn)(e)},Br.slice=function(e,t,i){var n=null==e?0:e.length;return n?(i&&"number"!=typeof i&&ba(e,t,i)?(t=0,i=n):(t=null==t?0:fo(t),i=i===r?n:fo(i)),rn(e,t,i)):[]},Br.sortBy=Ts,Br.sortedUniq=function(e){return e&&e.length?on(e):[]},Br.sortedUniqBy=function(e,t){return e&&e.length?on(e,la(t,2)):[]},Br.split=function(e,t,i){return i&&"number"!=typeof i&&ba(e,t,i)&&(t=i=r),(i=i===r?f:i>>>0)?(e=yo(e))&&("string"==typeof t||null!=t&&!no(t))&&(!(t=hn(t))&&ar(e))?_n(ur(e),0,i):e.split(t,i):[]},Br.spread=function(e,t){if("function"!=typeof e)throw new Re(i);return t=null==t?0:vr(fo(t),0),$i((function(r){var i=r[t],n=_n(r,0,t);return i&&Dt(n,i),Mt(e,this,n)}))},Br.tail=function(e){var t=null==e?0:e.length;return t?rn(e,1,t):[]},Br.take=function(e,t,i){return e&&e.length?rn(e,0,(t=i||t===r?1:fo(t))<0?0:t):[]},Br.takeRight=function(e,t,i){var n=null==e?0:e.length;return n?rn(e,(t=n-(t=i||t===r?1:fo(t)))<0?0:t,n):[]},Br.takeRightWhile=function(e,t){return e&&e.length?pn(e,la(t,3),!1,!0):[]},Br.takeWhile=function(e,t){return e&&e.length?pn(e,la(t,3)):[]},Br.tap=function(e,t){return t(e),e},Br.throttle=function(e,t,r){var n=!0,a=!0;if("function"!=typeof e)throw new Re(i);return Qs(r)&&(n="leading"in r?!!r.leading:n,a="trailing"in r?!!r.trailing:a),Rs(e,t,{leading:n,maxWait:t,trailing:a})},Br.thru=ds,Br.toArray=uo,Br.toPairs=Uo,Br.toPairsIn=Bo,Br.toPath=function(e){return js(e)?Lt(e,Fa):oo(e)?[e]:Pn(ka(yo(e)))},Br.toPlainObject=vo,Br.transform=function(e,t,r){var i=js(e),n=i||qs(e)||lo(e);if(t=la(t,4),null==r){var a=e&&e.constructor;r=n?i?new a:[]:Qs(e)&&Zs(a)?zr(qe(e)):{}}return(n?At:bi)(e,(function(e,i,n){return t(r,e,i,n)})),r},Br.unary=function(e){return Es(e,1)},Br.union=es,Br.unionBy=ts,Br.unionWith=rs,Br.uniq=function(e){return e&&e.length?cn(e):[]},Br.uniqBy=function(e,t){return e&&e.length?cn(e,la(t,2)):[]},Br.uniqWith=function(e,t){return t="function"==typeof t?t:r,e&&e.length?cn(e,r,t):[]},Br.unset=function(e,t){return null==e||un(e,t)},Br.unzip=is,Br.unzipWith=ns,Br.update=function(e,t,r){return null==e?e:dn(e,t,yn(r))},Br.updateWith=function(e,t,i,n){return n="function"==typeof n?n:r,null==e?e:dn(e,t,yn(i),n)},Br.values=zo,Br.valuesIn=function(e){return null==e?[]:Jt(e,Oo(e))},Br.without=as,Br.words=Ko,Br.wrap=function(e,t){return Fs(yn(t),e)},Br.xor=ss,Br.xorBy=os,Br.xorWith=ls,Br.zip=hs,Br.zipObject=function(e,t){return gn(e||[],t||[],ei)},Br.zipObjectDeep=function(e,t){return gn(e||[],t||[],Ji)},Br.zipWith=cs,Br.entries=Uo,Br.entriesIn=Bo,Br.extend=xo,Br.extendWith=_o,ol(Br,Br),Br.add=vl,Br.attempt=Jo,Br.camelCase=Ho,Br.capitalize=Vo,Br.ceil=yl,Br.clamp=function(e,t,i){return i===r&&(i=t,t=r),i!==r&&(i=(i=go(i))==i?i:0),t!==r&&(t=(t=go(t))==t?t:0),si(go(e),t,i)},Br.clone=function(e){return oi(e,4)},Br.cloneDeep=function(e){return oi(e,5)},Br.cloneDeepWith=function(e,t){return oi(e,5,t="function"==typeof t?t:r)},Br.cloneWith=function(e,t){return oi(e,4,t="function"==typeof t?t:r)},Br.conformsTo=function(e,t){return null==t||li(e,t,Io(t))},Br.deburr=jo,Br.defaultTo=function(e,t){return null==e||e!=e?t:e},Br.divide=bl,Br.endsWith=function(e,t,i){e=yo(e),t=hn(t);var n=e.length,a=i=i===r?n:si(fo(i),0,n);return(i-=t.length)>=0&&e.slice(i,a)==t},Br.eq=Bs,Br.escape=function(e){return(e=yo(e))&&$.test(e)?e.replace(q,ir):e},Br.escapeRegExp=function(e){return(e=yo(e))&&ie.test(e)?e.replace(re,"\\$&"):e},Br.every=function(e,t,i){var n=js(e)?Pt:pi;return i&&ba(e,t,i)&&(t=r),n(e,la(t,3))},Br.find=ms,Br.findIndex=Va,Br.findKey=function(e,t){return Bt(e,la(t,3),bi)},Br.findLast=gs,Br.findLastIndex=ja,Br.findLastKey=function(e,t){return Bt(e,la(t,3),xi)},Br.floor=xl,Br.forEach=vs,Br.forEachRight=ys,Br.forIn=function(e,t){return null==e?e:vi(e,la(t,3),Oo)},Br.forInRight=function(e,t){return null==e?e:yi(e,la(t,3),Oo)},Br.forOwn=function(e,t){return e&&bi(e,la(t,3))},Br.forOwnRight=function(e,t){return e&&xi(e,la(t,3))},Br.get=Eo,Br.gt=zs,Br.gte=Hs,Br.has=function(e,t){return null!=e&&ma(e,t,Ei)},Br.hasIn=Ao,Br.head=Wa,Br.identity=il,Br.includes=function(e,t,r,i){e=Ws(e)?e:zo(e),r=r&&!i?fo(r):0;var n=e.length;return r<0&&(r=vr(n+r,0)),so(e)?r<=n&&e.indexOf(t,r)>-1:!!n&&Ht(e,t,r)>-1},Br.indexOf=function(e,t,r){var i=null==e?0:e.length;if(!i)return-1;var n=null==r?0:fo(r);return n<0&&(n=vr(i+n,0)),Ht(e,t,n)},Br.inRange=function(e,t,i){return t=po(t),i===r?(i=t,t=0):i=po(i),function(e,t,r){return e>=yr(t,r)&&e<vr(t,r)}(e=go(e),t,i)},Br.invoke=Ro,Br.isArguments=Vs,Br.isArray=js,Br.isArrayBuffer=Gs,Br.isArrayLike=Ws,Br.isArrayLikeObject=Xs,Br.isBoolean=function(e){return!0===e||!1===e||eo(e)&&Ti(e)==y},Br.isBuffer=qs,Br.isDate=Ys,Br.isElement=function(e){return eo(e)&&1===e.nodeType&&!io(e)},Br.isEmpty=function(e){if(null==e)return!0;if(Ws(e)&&(js(e)||"string"==typeof e||"function"==typeof e.splice||qs(e)||lo(e)||Vs(e)))return!e.length;var t=fa(e);if(t==S||t==C)return!e.size;if(Sa(e))return!ki(e).length;for(var r in e)if(Fe.call(e,r))return!1;return!0},Br.isEqual=function(e,t){return Ii(e,t)},Br.isEqualWith=function(e,t,i){var n=(i="function"==typeof i?i:r)?i(e,t):r;return n===r?Ii(e,t,r,i):!!n},Br.isError=$s,Br.isFinite=function(e){return"number"==typeof e&&Xt(e)},Br.isFunction=Zs,Br.isInteger=Ks,Br.isLength=Js,Br.isMap=to,Br.isMatch=function(e,t){return e===t||Oi(e,t,ca(t))},Br.isMatchWith=function(e,t,i){return i="function"==typeof i?i:r,Oi(e,t,ca(t),i)},Br.isNaN=function(e){return ro(e)&&e!=+e},Br.isNative=function(e){if(wa(e))throw new Te("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Li(e)},Br.isNil=function(e){return null==e},Br.isNull=function(e){return null===e},Br.isNumber=ro,Br.isObject=Qs,Br.isObjectLike=eo,Br.isPlainObject=io,Br.isRegExp=no,Br.isSafeInteger=function(e){return Ks(e)&&e>=-d&&e<=d},Br.isSet=ao,Br.isString=so,Br.isSymbol=oo,Br.isTypedArray=lo,Br.isUndefined=function(e){return e===r},Br.isWeakMap=function(e){return eo(e)&&fa(e)==I},Br.isWeakSet=function(e){return eo(e)&&"[object WeakSet]"==Ti(e)},Br.join=function(e,t){return null==e?"":mr.call(e,t)},Br.kebabCase=Go,Br.last=$a,Br.lastIndexOf=function(e,t,i){var n=null==e?0:e.length;if(!n)return-1;var a=n;return i!==r&&(a=(a=fo(i))<0?vr(n+a,0):yr(a,n-1)),t==t?function(e,t,r){for(var i=r+1;i--;)if(e[i]===t)return i;return i}(e,t,a):zt(e,jt,a,!0)},Br.lowerCase=Wo,Br.lowerFirst=Xo,Br.lt=ho,Br.lte=co,Br.max=function(e){return e&&e.length?fi(e,il,Mi):r},Br.maxBy=function(e,t){return e&&e.length?fi(e,la(t,2),Mi):r},Br.mean=function(e){return Gt(e,il)},Br.meanBy=function(e,t){return Gt(e,la(t,2))},Br.min=function(e){return e&&e.length?fi(e,il,Ni):r},Br.minBy=function(e,t){return e&&e.length?fi(e,la(t,2),Ni):r},Br.stubArray=ml,Br.stubFalse=gl,Br.stubObject=function(){return{}},Br.stubString=function(){return""},Br.stubTrue=function(){return!0},Br.multiply=_l,Br.nth=function(e,t){return e&&e.length?Vi(e,fo(t)):r},Br.noConflict=function(){return pt._===this&&(pt._=He),this},Br.noop=ll,Br.now=Ms,Br.pad=function(e,t,r){e=yo(e);var i=(t=fo(t))?cr(e):0;if(!t||i>=t)return e;var n=(t-i)/2;return Gn(vt(n),r)+e+Gn(mt(n),r)},Br.padEnd=function(e,t,r){e=yo(e);var i=(t=fo(t))?cr(e):0;return t&&i<t?e+Gn(t-i,r):e},Br.padStart=function(e,t,r){e=yo(e);var i=(t=fo(t))?cr(e):0;return t&&i<t?Gn(t-i,r)+e:e},Br.parseInt=function(e,t,r){return r||null==t?t=0:t&&(t=+t),xr(yo(e).replace(ne,""),t||0)},Br.random=function(e,t,i){if(i&&"boolean"!=typeof i&&ba(e,t,i)&&(t=i=r),i===r&&("boolean"==typeof t?(i=t,t=r):"boolean"==typeof e&&(i=e,e=r)),e===r&&t===r?(e=0,t=1):(e=po(e),t===r?(t=e,e=0):t=po(t)),e>t){var n=e;e=t,t=n}if(i||e%1||t%1){var a=_r();return yr(e+a*(t-e+ht("1e-"+((a+"").length-1))),t)}return qi(e,t)},Br.reduce=function(e,t,r){var i=js(e)?kt:qt,n=arguments.length<3;return i(e,la(t,4),r,n,ui)},Br.reduceRight=function(e,t,r){var i=js(e)?Ft:qt,n=arguments.length<3;return i(e,la(t,4),r,n,di)},Br.repeat=function(e,t,i){return t=(i?ba(e,t,i):t===r)?1:fo(t),Yi(yo(e),t)},Br.replace=function(){var e=arguments,t=yo(e[0]);return e.length<3?t:t.replace(e[1],e[2])},Br.result=function(e,t,i){var n=-1,a=(t=bn(t,e)).length;for(a||(a=1,e=r);++n<a;){var s=null==e?r:e[Fa(t[n])];s===r&&(n=a,s=i),e=Zs(s)?s.call(e):s}return e},Br.round=wl,Br.runInContext=e,Br.sample=function(e){return(js(e)?Zr:Zi)(e)},Br.size=function(e){if(null==e)return 0;if(Ws(e))return so(e)?cr(e):e.length;var t=fa(e);return t==S||t==C?e.size:ki(e).length},Br.snakeCase=qo,Br.some=function(e,t,i){var n=js(e)?Nt:nn;return i&&ba(e,t,i)&&(t=r),n(e,la(t,3))},Br.sortedIndex=function(e,t){return an(e,t)},Br.sortedIndexBy=function(e,t,r){return sn(e,t,la(r,2))},Br.sortedIndexOf=function(e,t){var r=null==e?0:e.length;if(r){var i=an(e,t);if(i<r&&Bs(e[i],t))return i}return-1},Br.sortedLastIndex=function(e,t){return an(e,t,!0)},Br.sortedLastIndexBy=function(e,t,r){return sn(e,t,la(r,2),!0)},Br.sortedLastIndexOf=function(e,t){if(null==e?0:e.length){var r=an(e,t,!0)-1;if(Bs(e[r],t))return r}return-1},Br.startCase=Yo,Br.startsWith=function(e,t,r){return e=yo(e),r=null==r?0:si(fo(r),0,e.length),t=hn(t),e.slice(r,r+t.length)==t},Br.subtract=Sl,Br.sum=function(e){return e&&e.length?Yt(e,il):0},Br.sumBy=function(e,t){return e&&e.length?Yt(e,la(t,2)):0},Br.template=function(e,t,i){var n=Br.templateSettings;i&&ba(e,t,i)&&(t=r),e=yo(e),t=_o({},t,n,Jn);var a,s,o=_o({},t.imports,n.imports,Jn),l=Io(o),h=Jt(o,l),c=0,u=t.interpolate||xe,d="__p += '",p=Ce((t.escape||xe).source+"|"+u.source+"|"+(u===J?de:xe).source+"|"+(t.evaluate||xe).source+"|$","g"),f="//# sourceURL="+(Fe.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++at+"]")+"\n";e.replace(p,(function(t,r,i,n,o,l){return i||(i=n),d+=e.slice(c,l).replace(_e,nr),r&&(a=!0,d+="' +\n__e("+r+") +\n'"),o&&(s=!0,d+="';\n"+o+";\n__p += '"),i&&(d+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),c=l+t.length,t})),d+="';\n";var m=Fe.call(t,"variable")&&t.variable;if(m){if(ce.test(m))throw new Te("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(s?d.replace(j,""):d).replace(G,"$1").replace(W,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(a?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=Jo((function(){return Me(l,f+"return "+d).apply(r,h)}));if(g.source=d,$s(g))throw g;return g},Br.times=function(e,t){if((e=fo(e))<1||e>d)return[];var r=f,i=yr(e,f);t=la(t),e-=f;for(var n=$t(i,t);++r<e;)t(r);return n},Br.toFinite=po,Br.toInteger=fo,Br.toLength=mo,Br.toLower=function(e){return yo(e).toLowerCase()},Br.toNumber=go,Br.toSafeInteger=function(e){return e?si(fo(e),-d,d):0===e?e:0},Br.toString=yo,Br.toUpper=function(e){return yo(e).toUpperCase()},Br.trim=function(e,t,i){if((e=yo(e))&&(i||t===r))return Zt(e);if(!e||!(t=hn(t)))return e;var n=ur(e),a=ur(t);return _n(n,er(n,a),tr(n,a)+1).join("")},Br.trimEnd=function(e,t,i){if((e=yo(e))&&(i||t===r))return e.slice(0,dr(e)+1);if(!e||!(t=hn(t)))return e;var n=ur(e);return _n(n,0,tr(n,ur(t))+1).join("")},Br.trimStart=function(e,t,i){if((e=yo(e))&&(i||t===r))return e.replace(ne,"");if(!e||!(t=hn(t)))return e;var n=ur(e);return _n(n,er(n,ur(t))).join("")},Br.truncate=function(e,t){var i=30,n="...";if(Qs(t)){var a="separator"in t?t.separator:a;i="length"in t?fo(t.length):i,n="omission"in t?hn(t.omission):n}var s=(e=yo(e)).length;if(ar(e)){var o=ur(e);s=o.length}if(i>=s)return e;var l=i-cr(n);if(l<1)return n;var h=o?_n(o,0,l).join(""):e.slice(0,l);if(a===r)return h+n;if(o&&(l+=h.length-l),no(a)){if(e.slice(l).search(a)){var c,u=h;for(a.global||(a=Ce(a.source,yo(pe.exec(a))+"g")),a.lastIndex=0;c=a.exec(u);)var d=c.index;h=h.slice(0,d===r?l:d)}}else if(e.indexOf(hn(a),l)!=l){var p=h.lastIndexOf(a);p>-1&&(h=h.slice(0,p))}return h+n},Br.unescape=function(e){return(e=yo(e))&&Y.test(e)?e.replace(X,pr):e},Br.uniqueId=function(e){var t=++Ne;return yo(e)+t},Br.upperCase=$o,Br.upperFirst=Zo,Br.each=vs,Br.eachRight=ys,Br.first=Wa,ol(Br,function(){var e={};return bi(Br,(function(t,r){Fe.call(Br.prototype,r)||(e[r]=t)})),e}(),{chain:!1}),Br.VERSION="4.17.21",At(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){Br[e].placeholder=Br})),At(["drop","take"],(function(e,t){jr.prototype[e]=function(i){i=i===r?1:vr(fo(i),0);var n=this.__filtered__&&!t?new jr(this):this.clone();return n.__filtered__?n.__takeCount__=yr(i,n.__takeCount__):n.__views__.push({size:yr(i,f),type:e+(n.__dir__<0?"Right":"")}),n},jr.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),At(["filter","map","takeWhile"],(function(e,t){var r=t+1,i=1==r||3==r;jr.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:la(e,3),type:r}),t.__filtered__=t.__filtered__||i,t}})),At(["head","last"],(function(e,t){var r="take"+(t?"Right":"");jr.prototype[e]=function(){return this[r](1).value()[0]}})),At(["initial","tail"],(function(e,t){var r="drop"+(t?"":"Right");jr.prototype[e]=function(){return this.__filtered__?new jr(this):this[r](1)}})),jr.prototype.compact=function(){return this.filter(il)},jr.prototype.find=function(e){return this.filter(e).head()},jr.prototype.findLast=function(e){return this.reverse().find(e)},jr.prototype.invokeMap=$i((function(e,t){return"function"==typeof e?new jr(this):this.map((function(r){return Pi(r,e,t)}))})),jr.prototype.reject=function(e){return this.filter(Ds(la(e)))},jr.prototype.slice=function(e,t){e=fo(e);var i=this;return i.__filtered__&&(e>0||t<0)?new jr(i):(e<0?i=i.takeRight(-e):e&&(i=i.drop(e)),t!==r&&(i=(t=fo(t))<0?i.dropRight(-t):i.take(t-e)),i)},jr.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},jr.prototype.toArray=function(){return this.take(f)},bi(jr.prototype,(function(e,t){var i=/^(?:filter|find|map|reject)|While$/.test(t),n=/^(?:head|last)$/.test(t),a=Br[n?"take"+("last"==t?"Right":""):t],s=n||/^find/.test(t);a&&(Br.prototype[t]=function(){var t=this.__wrapped__,o=n?[1]:arguments,l=t instanceof jr,h=o[0],c=l||js(t),u=function(e){var t=a.apply(Br,Dt([e],o));return n&&d?t[0]:t};c&&i&&"function"==typeof h&&1!=h.length&&(l=c=!1);var d=this.__chain__,p=!!this.__actions__.length,f=s&&!d,m=l&&!p;if(!s&&c){t=m?t:new jr(this);var g=e.apply(t,o);return g.__actions__.push({func:ds,args:[u],thisArg:r}),new Vr(g,d)}return f&&m?e.apply(this,o):(g=this.thru(u),f?n?g.value()[0]:g.value():g)})})),At(["pop","push","shift","sort","splice","unshift"],(function(e){var t=Ie[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:pop|shift)$/.test(e);Br.prototype[e]=function(){var e=arguments;if(i&&!this.__chain__){var n=this.value();return t.apply(js(n)?n:[],e)}return this[r]((function(r){return t.apply(js(r)?r:[],e)}))}})),bi(jr.prototype,(function(e,t){var r=Br[t];if(r){var i=r.name+"";Fe.call(Rr,i)||(Rr[i]=[]),Rr[i].push({name:t,func:r})}})),Rr[zn(r,2).name]=[{name:"wrapper",func:r}],jr.prototype.clone=function(){var e=new jr(this.__wrapped__);return e.__actions__=Pn(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Pn(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Pn(this.__views__),e},jr.prototype.reverse=function(){if(this.__filtered__){var e=new jr(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},jr.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,r=js(e),i=t<0,n=r?e.length:0,a=function(e,t,r){for(var i=-1,n=r.length;++i<n;){var a=r[i],s=a.size;switch(a.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=yr(t,e+s);break;case"takeRight":e=vr(e,t-s)}}return{start:e,end:t}}(0,n,this.__views__),s=a.start,o=a.end,l=o-s,h=i?o:s-1,c=this.__iteratees__,u=c.length,d=0,p=yr(l,this.__takeCount__);if(!r||!i&&n==l&&p==l)return fn(e,this.__actions__);var f=[];e:for(;l--&&d<p;){for(var m=-1,g=e[h+=t];++m<u;){var v=c[m],y=v.iteratee,b=v.type,x=y(g);if(2==b)g=x;else if(!x){if(1==b)continue e;break e}}f[d++]=g}return f},Br.prototype.at=ps,Br.prototype.chain=function(){return us(this)},Br.prototype.commit=function(){return new Vr(this.value(),this.__chain__)},Br.prototype.next=function(){this.__values__===r&&(this.__values__=uo(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?r:this.__values__[this.__index__++]}},Br.prototype.plant=function(e){for(var t,i=this;i instanceof Hr;){var n=Ua(i);n.__index__=0,n.__values__=r,t?a.__wrapped__=n:t=n;var a=n;i=i.__wrapped__}return a.__wrapped__=e,t},Br.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof jr){var t=e;return this.__actions__.length&&(t=new jr(this)),(t=t.reverse()).__actions__.push({func:ds,args:[Qa],thisArg:r}),new Vr(t,this.__chain__)}return this.thru(Qa)},Br.prototype.toJSON=Br.prototype.valueOf=Br.prototype.value=function(){return fn(this.__wrapped__,this.__actions__)},Br.prototype.first=Br.prototype.head,et&&(Br.prototype[et]=function(){return this}),Br}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(pt._=fr,define((function(){return fr}))):mt?((mt.exports=fr)._=fr,ft._=fr):pt._=fr}).call(e)})),$Me=$(((e,t)=>{var r,i;r=e,i=function(){"use strict";function e(e,t){var r,i,n,a,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}var t=function(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null};function r(e,t){return e>t?1:e<t?-1:0}function i(e,r,i){for(var n=new t(null,null),a=n,s=n;;){var o=i(e,r.key);if(o<0){if(null===r.left)break;if(i(e,r.left.key)<0){var l=r.left;if(r.left=l.right,l.right=r,null===(r=l).left)break}s.left=r,s=r,r=r.left}else{if(!(o>0))break;if(null===r.right)break;if(i(e,r.right.key)>0&&(l=r.right,r.right=l.left,l.left=r,null===(r=l).right))break;a.right=r,a=r,r=r.right}}return a.right=r.left,s.left=r.right,r.left=n.right,r.right=n.left,r}function n(e,r,n,a){var s=new t(e,r);if(null===n)return s.left=s.right=null,s;var o=a(e,(n=i(e,n,a)).key);return o<0?(s.left=n.left,s.right=n,n.left=null):o>=0&&(s.right=n.right,s.left=n,n.right=null),s}function a(e,t,r){var n=null,a=null;if(t){var s=r((t=i(e,t,r)).key,e);0===s?(n=t.left,a=t.right):s<0?(a=t.right,t.right=null,n=t):(n=t.left,t.left=null,a=t)}return{left:n,right:a}}function s(e,t,r,i,n){if(e){i(t+(r?"└── ":"├── ")+n(e)+"\n");var a=t+(r?"    ":"│   ");e.left&&s(e.left,a,!1,i,n),e.right&&s(e.right,a,!0,i,n)}}var o=function(){function o(e){void 0===e&&(e=r),this._root=null,this._size=0,this._comparator=e}return o.prototype.insert=function(e,t){return this._size++,this._root=n(e,t,this._root,this._comparator)},o.prototype.add=function(e,r){var n=new t(e,r);null===this._root&&(n.left=n.right=null,this._size++,this._root=n);var a=this._comparator,s=i(e,this._root,a),o=a(e,s.key);return 0===o?this._root=s:(o<0?(n.left=s.left,n.right=s,s.left=null):o>0&&(n.right=s.right,n.left=s,s.right=null),this._size++,this._root=n),this._root},o.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},o.prototype._remove=function(e,t,r){var n;return null===t?null:0===r(e,(t=i(e,t,r)).key)?(null===t.left?n=t.right:(n=i(e,t.left,r)).right=t.right,this._size--,n):t},o.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=i(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},o.prototype.findStatic=function(e){for(var t=this._root,r=this._comparator;t;){var i=r(e,t.key);if(0===i)return t;t=i<0?t.left:t.right}return null},o.prototype.find=function(e){return this._root&&(this._root=i(e,this._root,this._comparator),0!==this._comparator(e,this._root.key))?null:this._root},o.prototype.contains=function(e){for(var t=this._root,r=this._comparator;t;){var i=r(e,t.key);if(0===i)return!0;t=i<0?t.left:t.right}return!1},o.prototype.forEach=function(e,t){for(var r=this._root,i=[],n=!1;!n;)null!==r?(i.push(r),r=r.left):0!==i.length?(r=i.pop(),e.call(t,r),r=r.right):n=!0;return this},o.prototype.range=function(e,t,r,i){for(var n=[],a=this._comparator,s=this._root;0!==n.length||s;)if(s)n.push(s),s=s.left;else{if(a((s=n.pop()).key,t)>0)break;if(a(s.key,e)>=0&&r.call(i,s))return this;s=s.right}return this},o.prototype.keys=function(){var e=[];return this.forEach((function(t){var r=t.key;return e.push(r)})),e},o.prototype.values=function(){var e=[];return this.forEach((function(t){var r=t.data;return e.push(r)})),e},o.prototype.min=function(){return this._root?this.minNode(this._root).key:null},o.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},o.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},o.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},o.prototype.at=function(e){for(var t=this._root,r=!1,i=0,n=[];!r;)if(t)n.push(t),t=t.left;else if(n.length>0){if(t=n.pop(),i===e)return t;i++,t=t.right}else r=!0;return null},o.prototype.next=function(e){var t=this._root,r=null;if(e.right){for(r=e.right;r.left;)r=r.left;return r}for(var i=this._comparator;t;){var n=i(e.key,t.key);if(0===n)break;n<0?(r=t,t=t.left):t=t.right}return r},o.prototype.prev=function(e){var t=this._root,r=null;if(null!==e.left){for(r=e.left;r.right;)r=r.right;return r}for(var i=this._comparator;t;){var n=i(e.key,t.key);if(0===n)break;n<0?t=t.left:(r=t,t=t.right)}return r},o.prototype.clear=function(){return this._root=null,this._size=0,this},o.prototype.toList=function(){return function(e){for(var r=e,i=[],n=!1,a=new t(null,null),s=a;!n;)r?(i.push(r),r=r.left):i.length>0?r=(r=s=s.next=i.pop()).right:n=!0;return s.next=null,a.next}(this._root)},o.prototype.load=function(e,r,i){void 0===r&&(r=[]),void 0===i&&(i=!1);var n=e.length,a=this._comparator;if(i&&c(e,r,0,n-1,a),null===this._root)this._root=l(e,r,0,n),this._size=n;else{var s=function(e,r,i){for(var n=new t(null,null),a=n,s=e,o=r;null!==s&&null!==o;)i(s.key,o.key)<0?(a.next=s,s=s.next):(a.next=o,o=o.next),a=a.next;return null!==s?a.next=s:null!==o&&(a.next=o),n.next}(this.toList(),function(e,r){for(var i=new t(null,null),n=i,a=0;a<e.length;a++)n=n.next=new t(e[a],r[a]);return n.next=null,i.next}(e,r),a);n=this._size+n,this._root=h({head:s},0,n)}return this},o.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(o.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),o.prototype.toString=function(e){void 0===e&&(e=function(e){return String(e.key)});var t=[];return s(this._root,"",!0,(function(e){return t.push(e)}),e),t.join("")},o.prototype.update=function(e,t,r){var s=this._comparator,o=a(e,this._root,s),l=o.left,h=o.right;s(e,t)<0?h=n(t,r,h,s):l=n(t,r,l,s),this._root=function(e,t,r){return null===t?e:(null===e||((t=i(e.key,t,r)).left=e),t)}(l,h,s)},o.prototype.split=function(e){return a(e,this._root,this._comparator)},o.prototype[Symbol.iterator]=function(){var t,r,i;return e(this,(function(e){switch(e.label){case 0:t=this._root,r=[],i=!1,e.label=1;case 1:return i?[3,6]:null===t?[3,2]:(r.push(t),t=t.left,[3,5]);case 2:return 0===r.length?[3,4]:[4,t=r.pop()];case 3:return e.sent(),t=t.right,[3,5];case 4:i=!0,e.label=5;case 5:return[3,1];case 6:return[2]}}))},o}();function l(e,r,i,n){var a=n-i;if(a>0){var s=i+Math.floor(a/2),o=e[s],h=r[s],c=new t(o,h);return c.left=l(e,r,i,s),c.right=l(e,r,s+1,n),c}return null}function h(e,t,r){var i=r-t;if(i>0){var n=t+Math.floor(i/2),a=h(e,t,n),s=e.head;return s.left=a,e.head=e.head.next,s.right=h(e,n+1,r),s}return null}function c(e,t,r,i,n){if(!(r>=i)){for(var a=e[r+i>>1],s=r-1,o=i+1;;){do{s++}while(n(e[s],a)<0);do{o--}while(n(e[o],a)>0);if(s>=o)break;var l=e[s];e[s]=e[o],e[o]=l,l=t[s],t[s]=t[o],t[o]=l}c(e,t,r,o,n),c(e,t,o+1,i,n)}}let u=(e,t)=>e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y,d=(e,t)=>{if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;let r=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x;return{ll:{x:r,y:e.ll.y<t.ll.y?t.ll.y:e.ll.y},ur:{x:i,y:e.ur.y<t.ur.y?e.ur.y:t.ur.y}}},p=Number.EPSILON;void 0===p&&(p=Math.pow(2,-52));let f=p*p,m=(e,t)=>{if(-p<e&&e<p&&-p<t&&t<p)return 0;let r=e-t;return r*r<f*e*t?0:e<t?-1:1};class g{constructor(){this.tree=new o,this.round(0)}round(e){let t=this.tree.add(e),r=this.tree.prev(t);if(null!==r&&0===m(t.key,r.key))return this.tree.remove(e),r.key;let i=this.tree.next(t);return null!==i&&0===m(t.key,i.key)?(this.tree.remove(e),i.key):e}}let v=new class{constructor(){this.reset()}reset(){this.xRounder=new g,this.yRounder=new g}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}},y=11102230246251565e-32,b=134217729,x=(3+8*y)*y;function _(e,t,r,i,n){let a,s,o,l,h=t[0],c=i[0],u=0,d=0;c>h==c>-h?(a=h,h=t[++u]):(a=c,c=i[++d]);let p=0;if(u<e&&d<r)for(c>h==c>-h?(s=h+a,o=a-(s-h),h=t[++u]):(s=c+a,o=a-(s-c),c=i[++d]),a=s,0!==o&&(n[p++]=o);u<e&&d<r;)c>h==c>-h?(s=a+h,l=s-a,o=a-(s-l)+(h-l),h=t[++u]):(s=a+c,l=s-a,o=a-(s-l)+(c-l),c=i[++d]),a=s,0!==o&&(n[p++]=o);for(;u<e;)s=a+h,l=s-a,o=a-(s-l)+(h-l),h=t[++u],a=s,0!==o&&(n[p++]=o);for(;d<r;)s=a+c,l=s-a,o=a-(s-l)+(c-l),c=i[++d],a=s,0!==o&&(n[p++]=o);return(0!==a||0===p)&&(n[p++]=a),p}function w(e){return new Float64Array(e)}let S=(2+12*y)*y,T=(9+64*y)*y*y,M=w(4),E=w(8),A=w(12),C=w(16),P=w(4);function R(e,t,r,i,n,a){let s=(t-a)*(r-n),o=(e-n)*(i-a),l=s-o,h=Math.abs(s+o);return Math.abs(l)>=33306690738754716e-32*h?l:-function(e,t,r,i,n,a,s){let o,l,h,c,u,d,p,f,m,g,v,y,w,R,I,O,L,D,k=e-n,F=r-n,N=t-a,U=i-a;R=k*U,d=b*k,p=d-(d-k),f=k-p,d=b*U,m=d-(d-U),g=U-m,I=f*g-(R-p*m-f*m-p*g),O=N*F,d=b*N,p=d-(d-N),f=N-p,d=b*F,m=d-(d-F),g=F-m,L=f*g-(O-p*m-f*m-p*g),v=I-L,u=I-v,M[0]=I-(v+u)+(u-L),y=R+v,u=y-R,w=R-(y-u)+(v-u),v=w-O,u=w-v,M[1]=w-(v+u)+(u-O),D=y+v,u=D-y,M[2]=y-(D-u)+(v-u),M[3]=D;let B=function(e,t){let r=t[0];for(let i=1;i<e;i++)r+=t[i];return r}(4,M),z=S*s;if(B>=z||-B>=z||(u=e-k,o=e-(k+u)+(u-n),u=r-F,h=r-(F+u)+(u-n),u=t-N,l=t-(N+u)+(u-a),u=i-U,c=i-(U+u)+(u-a),0===o&&0===l&&0===h&&0===c)||(z=T*s+x*Math.abs(B),B+=k*c+U*o-(N*h+F*l),B>=z||-B>=z))return B;R=o*U,d=b*o,p=d-(d-o),f=o-p,d=b*U,m=d-(d-U),g=U-m,I=f*g-(R-p*m-f*m-p*g),O=l*F,d=b*l,p=d-(d-l),f=l-p,d=b*F,m=d-(d-F),g=F-m,L=f*g-(O-p*m-f*m-p*g),v=I-L,u=I-v,P[0]=I-(v+u)+(u-L),y=R+v,u=y-R,w=R-(y-u)+(v-u),v=w-O,u=w-v,P[1]=w-(v+u)+(u-O),D=y+v,u=D-y,P[2]=y-(D-u)+(v-u),P[3]=D;let H=_(4,M,4,P,E);R=k*c,d=b*k,p=d-(d-k),f=k-p,d=b*c,m=d-(d-c),g=c-m,I=f*g-(R-p*m-f*m-p*g),O=N*h,d=b*N,p=d-(d-N),f=N-p,d=b*h,m=d-(d-h),g=h-m,L=f*g-(O-p*m-f*m-p*g),v=I-L,u=I-v,P[0]=I-(v+u)+(u-L),y=R+v,u=y-R,w=R-(y-u)+(v-u),v=w-O,u=w-v,P[1]=w-(v+u)+(u-O),D=y+v,u=D-y,P[2]=y-(D-u)+(v-u),P[3]=D;let V=_(H,E,4,P,A);R=o*c,d=b*o,p=d-(d-o),f=o-p,d=b*c,m=d-(d-c),g=c-m,I=f*g-(R-p*m-f*m-p*g),O=l*h,d=b*l,p=d-(d-l),f=l-p,d=b*h,m=d-(d-h),g=h-m,L=f*g-(O-p*m-f*m-p*g),v=I-L,u=I-v,P[0]=I-(v+u)+(u-L),y=R+v,u=y-R,w=R-(y-u)+(v-u),v=w-O,u=w-v,P[1]=w-(v+u)+(u-O),D=y+v,u=D-y,P[2]=y-(D-u)+(v-u),P[3]=D;let j=_(V,A,4,P,C);return C[j-1]}(e,t,r,i,n,a,h)}let I=(e,t)=>e.x*t.y-e.y*t.x,O=(e,t)=>e.x*t.x+e.y*t.y,L=(e,t,r)=>{let i=R(e.x,e.y,t.x,t.y,r.x,r.y);return i>0?-1:i<0?1:0},D=e=>Math.sqrt(O(e,e)),k=(e,t,r)=>{let i={x:t.x-e.x,y:t.y-e.y},n={x:r.x-e.x,y:r.y-e.y};return I(n,i)/D(n)/D(i)},F=(e,t,r)=>{let i={x:t.x-e.x,y:t.y-e.y},n={x:r.x-e.x,y:r.y-e.y};return O(n,i)/D(n)/D(i)},N=(e,t,r)=>0===t.y?null:{x:e.x+t.x/t.y*(r-e.y),y:r},U=(e,t,r)=>0===t.x?null:{x:r,y:e.y+t.y/t.x*(r-e.x)};class B{static compare(e,t){let r=B.comparePoints(e.point,t.point);return 0!==r?r:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:H.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){void 0===e.events?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");let t=e.point.events;for(let e=0,r=t.length;e<r;e++){let r=t[e];this.point.events.push(r),r.point=this.point}this.checkForConsuming()}checkForConsuming(){let e=this.point.events.length;for(let t=0;t<e;t++){let r=this.point.events[t];if(void 0===r.segment.consumedBy)for(let i=t+1;i<e;i++){let e=this.point.events[i];void 0===e.consumedBy&&r.otherSE.point.events===e.otherSE.point.events&&r.segment.consume(e.segment)}}}getAvailableLinkedEvents(){let e=[];for(let t=0,r=this.point.events.length;t<r;t++){let r=this.point.events[t];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&e.push(r)}return e}getLeftmostComparator(e){let t=new Map,r=r=>{let i=r.otherSE;t.set(r,{sine:k(this.point,e.point,i.point),cosine:F(this.point,e.point,i.point)})};return(e,i)=>{t.has(e)||r(e),t.has(i)||r(i);let{sine:n,cosine:a}=t.get(e),{sine:s,cosine:o}=t.get(i);return n>=0&&s>=0?a<o?1:a>o?-1:0:n<0&&s<0?a<o?-1:a>o?1:0:s<n?-1:s>n?1:0}}}let z=0;class H{static compare(e,t){let r=e.leftSE.point.x,i=t.leftSE.point.x,n=e.rightSE.point.x,a=t.rightSE.point.x;if(a<r)return 1;if(n<i)return-1;let s=e.leftSE.point.y,o=t.leftSE.point.y,l=e.rightSE.point.y,h=t.rightSE.point.y;if(r<i){if(o<s&&o<l)return 1;if(o>s&&o>l)return-1;let r=e.comparePoint(t.leftSE.point);if(r<0)return 1;if(r>0)return-1;let i=t.comparePoint(e.rightSE.point);return 0!==i?i:-1}if(r>i){if(s<o&&s<h)return-1;if(s>o&&s>h)return 1;let r=t.comparePoint(e.leftSE.point);if(0!==r)return r;let i=e.comparePoint(t.rightSE.point);return i<0?1:i>0?-1:1}if(s<o)return-1;if(s>o)return 1;if(n<a){let r=t.comparePoint(e.rightSE.point);if(0!==r)return r}if(n>a){let r=e.comparePoint(t.rightSE.point);if(r<0)return 1;if(r>0)return-1}if(n!==a){let e=l-s,t=n-r,c=h-o,u=a-i;if(e>t&&c<u)return 1;if(e<t&&c>u)return-1}return n>a?1:n<a||l<h?-1:l>h?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,r,i){this.id=++z,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=r,this.windings=i}static fromRing(e,t,r){let i,n,a,s=B.comparePoints(e,t);if(s<0)i=e,n=t,a=1;else{if(!(s>0))throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);i=t,n=e,a=-1}let o=new B(i,!0),l=new B(n,!1);return new H(o,l,[r],[a])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){let e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;let t=this.leftSE.point,r=this.rightSE.point,i=this.vector();if(t.x===r.x)return e.x===t.x?0:e.x<t.x?1:-1;let n=(e.y-t.y)/i.y,a=t.x+n*i.x;if(e.x===a)return 0;let s=(e.x-t.x)/i.x,o=t.y+s*i.y;return e.y===o?0:e.y<o?-1:1}getIntersection(e){let t=this.bbox(),r=e.bbox(),i=d(t,r);if(null===i)return null;let n=this.leftSE.point,a=this.rightSE.point,s=e.leftSE.point,o=e.rightSE.point,l=u(t,s)&&0===this.comparePoint(s),h=u(r,n)&&0===e.comparePoint(n),c=u(t,o)&&0===this.comparePoint(o),p=u(r,a)&&0===e.comparePoint(a);if(h&&l)return p&&!c?a:!p&&c?o:null;if(h)return c&&n.x===o.x&&n.y===o.y?null:n;if(l)return p&&a.x===s.x&&a.y===s.y?null:s;if(p&&c)return null;if(p)return a;if(c)return o;let f=((e,t,r,i)=>{if(0===t.x)return U(r,i,e.x);if(0===i.x)return U(e,t,r.x);if(0===t.y)return N(r,i,e.y);if(0===i.y)return N(e,t,r.y);let n=I(t,i);if(0==n)return null;let a={x:r.x-e.x,y:r.y-e.y},s=I(a,t)/n,o=I(a,i)/n;return{x:(e.x+o*t.x+(r.x+s*i.x))/2,y:(e.y+o*t.y+(r.y+s*i.y))/2}})(n,this.vector(),s,e.vector());return null!==f&&u(i,f)?v.round(f.x,f.y):null}split(e){let t=[],r=void 0!==e.events,i=new B(e,!0),n=new B(e,!1),a=this.rightSE;this.replaceRightSE(n),t.push(n),t.push(i);let s=new H(i,a,this.rings.slice(),this.windings.slice());return B.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),B.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),n.checkForConsuming()),t}swapEvents(){let e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,t=this.windings.length;e<t;e++)this.windings[e]*=-1}consume(e){let t=this,r=e;for(;t.consumedBy;)t=t.consumedBy;for(;r.consumedBy;)r=r.consumedBy;let i=H.compare(t,r);if(0!==i){if(i>0){let e=t;t=r,r=e}if(t.prev===r){let e=t;t=r,r=e}for(let e=0,i=r.rings.length;e<i;e++){let i=r.rings[e],n=r.windings[e],a=t.rings.indexOf(i);-1===a?(t.rings.push(i),t.windings.push(n)):t.windings[a]+=n}r.rings=null,r.windings=null,r.consumedBy=t,r.leftSE.consumedBy=t.leftSE,r.rightSE.consumedBy=t.rightSE}}prevInResult(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}beforeState(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){let e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}afterState(){if(void 0!==this._afterState)return this._afterState;let e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};let t=this._afterState.rings,r=this._afterState.windings,i=this._afterState.multiPolys;for(let e=0,i=this.rings.length;e<i;e++){let i=this.rings[e],n=this.windings[e],a=t.indexOf(i);-1===a?(t.push(i),r.push(n)):r[a]+=n}let n=[],a=[];for(let e=0,i=t.length;e<i;e++){if(0===r[e])continue;let i=t[e],s=i.poly;if(-1===a.indexOf(s))if(i.isExterior)n.push(s);else{-1===a.indexOf(s)&&a.push(s);let e=n.indexOf(i.poly);-1!==e&&n.splice(e,1)}}for(let e=0,t=n.length;e<t;e++){let t=n[e].multiPoly;-1===i.indexOf(t)&&i.push(t)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;let e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(K.type){case"union":{let r=0===e.length,i=0===t.length;this._isInResult=r!==i;break}case"intersection":{let r,i;e.length<t.length?(r=e.length,i=t.length):(r=t.length,i=e.length),this._isInResult=i===K.numMultiPolys&&r<i;break}case"xor":{let r=Math.abs(e.length-t.length);this._isInResult=r%2==1;break}case"difference":{let r=e=>1===e.length&&e[0].isSubject;this._isInResult=r(e)!==r(t);break}default:throw new Error(`Unrecognized operation type found ${K.type}`)}return this._isInResult}}class V{constructor(e,t,r){if(!Array.isArray(e)||0===e.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=r,this.segments=[],"number"!=typeof e[0][0]||"number"!=typeof e[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let i=v.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let n=i;for(let t=1,r=e.length;t<r;t++){if("number"!=typeof e[t][0]||"number"!=typeof e[t][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let r=v.round(e[t][0],e[t][1]);r.x===n.x&&r.y===n.y||(this.segments.push(H.fromRing(n,r,this)),r.x<this.bbox.ll.x&&(this.bbox.ll.x=r.x),r.y<this.bbox.ll.y&&(this.bbox.ll.y=r.y),r.x>this.bbox.ur.x&&(this.bbox.ur.x=r.x),r.y>this.bbox.ur.y&&(this.bbox.ur.y=r.y),n=r)}(i.x!==n.x||i.y!==n.y)&&this.segments.push(H.fromRing(n,i,this))}getSweepEvents(){let e=[];for(let t=0,r=this.segments.length;t<r;t++){let r=this.segments[t];e.push(r.leftSE),e.push(r.rightSE)}return e}}class j{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new V(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,r=e.length;t<r;t++){let r=new V(e[t],this,!1);r.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=r.bbox.ur.y),this.interiorRings.push(r)}this.multiPoly=t}getSweepEvents(){let e=this.exteriorRing.getSweepEvents();for(let t=0,r=this.interiorRings.length;t<r;t++){let r=this.interiorRings[t].getSweepEvents();for(let t=0,i=r.length;t<i;t++)e.push(r[t])}return e}}class G{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof e[0][0][0]&&(e=[e])}catch(e){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let t=0,r=e.length;t<r;t++){let r=new j(e[t],this);r.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=r.bbox.ll.x),r.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=r.bbox.ll.y),r.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=r.bbox.ur.x),r.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=r.bbox.ur.y),this.polys.push(r)}this.isSubject=t}getSweepEvents(){let e=[];for(let t=0,r=this.polys.length;t<r;t++){let r=this.polys[t].getSweepEvents();for(let t=0,i=r.length;t<i;t++)e.push(r[t])}return e}}class W{static factory(e){let t=[];for(let r=0,i=e.length;r<i;r++){let i=e[r];if(!i.isInResult()||i.ringOut)continue;let n=null,a=i.leftSE,s=i.rightSE,o=[a],l=a.point,h=[];for(;n=a,a=s,o.push(a),a.point!==l;)for(;;){let e=a.getAvailableLinkedEvents();if(0===e.length){let e=o[0].point,t=o[o.length-1].point;throw new Error(`Unable to complete output ring starting at [${e.x}, ${e.y}]. Last matching segment found ends at [${t.x}, ${t.y}].`)}if(1===e.length){s=e[0].otherSE;break}let r=null;for(let e=0,t=h.length;e<t;e++)if(h[e].point===a.point){r=e;break}if(null!==r){let e=h.splice(r)[0],i=o.splice(e.index);i.unshift(i[0].otherSE),t.push(new W(i.reverse()));continue}h.push({index:o.length,point:a.point});let i=a.getLeftmostComparator(n);s=e.sort(i)[0].otherSE;break}t.push(new W(o))}return t}constructor(e){this.events=e;for(let t=0,r=e.length;t<r;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point,t=[e];for(let r=1,i=this.events.length-1;r<i;r++){let i=this.events[r].point,n=this.events[r+1].point;0!==L(i,e,n)&&(t.push(i),e=i)}if(1===t.length)return null;let r=t[0],i=t[1];0===L(r,e,i)&&t.shift(),t.push(t[0]);let n=this.isExteriorRing()?1:-1,a=this.isExteriorRing()?0:t.length-1,s=this.isExteriorRing()?t.length:-1,o=[];for(let e=a;e!=s;e+=n)o.push([t[e].x,t[e].y]);return o}isExteriorRing(){if(void 0===this._isExteriorRing){let e=this.enclosingRing();this._isExteriorRing=!e||!e.isExteriorRing()}return this._isExteriorRing}enclosingRing(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let t=1,r=this.events.length;t<r;t++){let r=this.events[t];B.compare(e,r)>0&&(e=r)}let t=e.segment.prevInResult(),r=t?t.prevInResult():null;for(;;){if(!t)return null;if(!r)return t.ringOut;if(r.ringOut!==t.ringOut)return r.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=r.prevInResult(),r=t?t.prevInResult():null}}}class X{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){let e=[this.exteriorRing.getGeom()];if(null===e[0])return null;for(let t=0,r=this.interiorRings.length;t<r;t++){let r=this.interiorRings[t].getGeom();null!==r&&e.push(r)}return e}}class q{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){let e=[];for(let t=0,r=this.polys.length;t<r;t++){let r=this.polys[t].getGeom();null!==r&&e.push(r)}return e}_composePolys(e){let t=[];for(let r=0,i=e.length;r<i;r++){let i=e[r];if(!i.poly)if(i.isExteriorRing())t.push(new X(i));else{let e=i.enclosingRing();e.poly||t.push(new X(e)),e.poly.addInterior(i)}}return t}}class Y{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.compare;this.queue=e,this.tree=new o(t),this.segments=[]}process(e){let t=e.segment,r=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),r;let i=e.isLeft?this.tree.add(t):this.tree.find(t);if(!i)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let n,a,s=i,o=i;for(;void 0===n;)s=this.tree.prev(s),null===s?n=null:void 0===s.key.consumedBy&&(n=s.key);for(;void 0===a;)o=this.tree.next(o),null===o?a=null:void 0===o.key.consumedBy&&(a=o.key);if(e.isLeft){let i=null;if(n){let e=n.getIntersection(t);if(null!==e&&(t.isAnEndpoint(e)||(i=e),!n.isAnEndpoint(e))){let t=this._splitSafely(n,e);for(let e=0,i=t.length;e<i;e++)r.push(t[e])}}let s=null;if(a){let e=a.getIntersection(t);if(null!==e&&(t.isAnEndpoint(e)||(s=e),!a.isAnEndpoint(e))){let t=this._splitSafely(a,e);for(let e=0,i=t.length;e<i;e++)r.push(t[e])}}if(null!==i||null!==s){let e=null;e=null===i?s:null===s||B.comparePoints(i,s)<=0?i:s,this.queue.remove(t.rightSE),r.push(t.rightSE);let n=t.split(e);for(let e=0,t=n.length;e<t;e++)r.push(n[e])}r.length>0?(this.tree.remove(t),r.push(e)):(this.segments.push(t),t.prev=n)}else{if(n&&a){let e=n.getIntersection(a);if(null!==e){if(!n.isAnEndpoint(e)){let t=this._splitSafely(n,e);for(let e=0,i=t.length;e<i;e++)r.push(t[e])}if(!a.isAnEndpoint(e)){let t=this._splitSafely(a,e);for(let e=0,i=t.length;e<i;e++)r.push(t[e])}}}this.tree.remove(t)}return r}_splitSafely(e,t){this.tree.remove(e);let r=e.rightSE;this.queue.remove(r);let i=e.split(t);return i.push(r),void 0===e.consumedBy&&this.tree.add(e),i}}let $="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Z="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,K=new class{run(e,t,r){K.type=e,v.reset();let i=[new G(t,!0)];for(let e=0,t=r.length;e<t;e++)i.push(new G(r[e],!1));if(K.numMultiPolys=i.length,"difference"===K.type){let e=i[0],t=1;for(;t<i.length;)null!==d(i[t].bbox,e.bbox)?t++:i.splice(t,1)}if("intersection"===K.type)for(let e=0,t=i.length;e<t;e++){let t=i[e];for(let r=e+1,n=i.length;r<n;r++)if(null===d(t.bbox,i[r].bbox))return[]}let n=new o(B.compare);for(let e=0,t=i.length;e<t;e++){let t=i[e].getSweepEvents();for(let e=0,r=t.length;e<r;e++)if(n.insert(t[e]),n.size>$)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}let a=new Y(n),s=n.size,l=n.pop();for(;l;){let e=l.key;if(n.size===s){let t=e.segment;throw new Error(`Unable to pop() ${e.isLeft?"left":"right"} SweepEvent [${e.point.x}, ${e.point.y}] from segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] from queue.`)}if(n.size>$)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(a.segments.length>Z)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");let t=a.process(e);for(let e=0,r=t.length;e<r;e++){let r=t[e];void 0===r.consumedBy&&n.insert(r)}s=n.size,l=n.pop()}v.reset();let h=W.factory(a.segments);return new q(h).getGeom()}};var J={union:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return K.run("union",e,r)},intersection:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return K.run("intersection",e,r)},xor:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return K.run("xor",e,r)},difference:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return K.run("difference",e,r)}};return J},"object"==typeof e&&void 0!==t?t.exports=i():"function"==typeof define&&define.amd?define(i):(r="undefined"!=typeof globalThis?globalThis:r||self).polygonClipping=i()})),FAe=$(((e,t)=>{!function(){"use strict";var e,r={version:"6.4.2.2",use_lines:!0,use_xyz:!1},i=!1;if(void 0!==t&&t.exports?(t.exports=r,i=!0):("function"==typeof define&&define.amd&&define(r),"undefined"!=typeof document?window.ClipperLib=r:self.ClipperLib=r),i){var n="chrome";e="Netscape"}else{n=navigator.userAgent.toString().toLowerCase();e=navigator.appName}var a={};-1!=n.indexOf("chrome")&&-1==n.indexOf("chromium")?a.chrome=1:a.chrome=0,-1!=n.indexOf("chromium")?a.chromium=1:a.chromium=0,-1!=n.indexOf("safari")&&-1==n.indexOf("chrome")&&-1==n.indexOf("chromium")?a.safari=1:a.safari=0,-1!=n.indexOf("firefox")?a.firefox=1:a.firefox=0,-1!=n.indexOf("firefox/17")?a.firefox17=1:a.firefox17=0,-1!=n.indexOf("firefox/15")?a.firefox15=1:a.firefox15=0,-1!=n.indexOf("firefox/3")?a.firefox3=1:a.firefox3=0,-1!=n.indexOf("opera")?a.opera=1:a.opera=0,-1!=n.indexOf("msie 10")?a.msie10=1:a.msie10=0,-1!=n.indexOf("msie 9")?a.msie9=1:a.msie9=0,-1!=n.indexOf("msie 8")?a.msie8=1:a.msie8=0,-1!=n.indexOf("msie 7")?a.msie7=1:a.msie7=0,-1!=n.indexOf("msie ")?a.msie=1:a.msie=0,r.biginteger_used=null;var s;function o(e,t,i){r.biginteger_used=1,null!=e&&("number"==typeof e&&void 0===t?this.fromInt(e):"number"==typeof e?this.fromNumber(e,t,i):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function l(){return new o(null,void 0,void 0)}"Microsoft Internet Explorer"==e?(o.prototype.am=function(e,t,r,i,n,a){for(var s=32767&t,o=t>>15;--a>=0;){var l=32767&this[e],h=this[e++]>>15,c=o*l+h*s;n=((l=s*l+((32767&c)<<15)+r[i]+(1073741823&n))>>>30)+(c>>>15)+o*h+(n>>>30),r[i++]=1073741823&l}return n},s=30):"Netscape"!=e?(o.prototype.am=function(e,t,r,i,n,a){for(;--a>=0;){var s=t*this[e++]+r[i]+n;n=Math.floor(s/67108864),r[i++]=67108863&s}return n},s=26):(o.prototype.am=function(e,t,r,i,n,a){for(var s=16383&t,o=t>>14;--a>=0;){var l=16383&this[e],h=this[e++]>>14,c=o*l+h*s;n=((l=s*l+((16383&c)<<14)+r[i]+n)>>28)+(c>>14)+o*h,r[i++]=268435455&l}return n},s=28),o.prototype.DB=s,o.prototype.DM=(1<<s)-1,o.prototype.DV=1<<s;o.prototype.FV=Math.pow(2,52),o.prototype.F1=52-s,o.prototype.F2=2*s-52;var h,c,u="0123456789abcdefghijklmnopqrstuvwxyz",d=new Array;for(h="0".charCodeAt(0),c=0;c<=9;++c)d[h++]=c;for(h="a".charCodeAt(0),c=10;c<36;++c)d[h++]=c;for(h="A".charCodeAt(0),c=10;c<36;++c)d[h++]=c;function p(e){return u.charAt(e)}function f(e,t){var r=d[e.charCodeAt(t)];return null==r?-1:r}function m(e){var t=l();return t.fromInt(e),t}function g(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=(t=e>>1)&&(e=t,r+=1),r}function v(e){this.m=e}function y(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function b(e,t){return e&t}function x(e,t){return e|t}function _(e,t){return e^t}function w(e,t){return e&~t}function S(e){if(0==e)return-1;var t=0;return 65535&e||(e>>=16,t+=16),255&e||(e>>=8,t+=8),15&e||(e>>=4,t+=4),3&e||(e>>=2,t+=2),1&e||++t,t}function T(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function M(){}function E(e){return e}function A(e){this.r2=l(),this.q3=l(),o.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}v.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},v.prototype.revert=function(e){return e},v.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},v.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},v.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},y.prototype.convert=function(e){var t=l();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(o.ZERO)>0&&this.m.subTo(t,t),t},y.prototype.revert=function(e){var t=l();return e.copyTo(t),this.reduce(t),t},y.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=32767&e[t],i=r*this.mpl+((r*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[r=t+this.m.t]+=this.m.am(0,i,e,t,0,this.m.t);e[r]>=e.DV;)e[r]-=e.DV,e[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},y.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},y.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},o.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s},o.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0},o.prototype.fromString=function(e,t){var r;if(16==t)r=4;else if(8==t)r=3;else if(256==t)r=8;else if(2==t)r=1;else if(32==t)r=5;else{if(4!=t)return void this.fromRadix(e,t);r=2}this.t=0,this.s=0;for(var i=e.length,n=!1,a=0;--i>=0;){var s=8==r?255&e[i]:f(e,i);s<0?"-"==e.charAt(i)&&(n=!0):(n=!1,0==a?this[this.t++]=s:a+r>this.DB?(this[this.t-1]|=(s&(1<<this.DB-a)-1)<<a,this[this.t++]=s>>this.DB-a):this[this.t-1]|=s<<a,(a+=r)>=this.DB&&(a-=this.DB))}8==r&&128&e[0]&&(this.s=-1,a>0&&(this[this.t-1]|=(1<<this.DB-a)-1<<a)),this.clamp(),n&&o.ZERO.subTo(this,this)},o.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},o.prototype.dlShiftTo=function(e,t){var r;for(r=this.t-1;r>=0;--r)t[r+e]=this[r];for(r=e-1;r>=0;--r)t[r]=0;t.t=this.t+e,t.s=this.s},o.prototype.drShiftTo=function(e,t){for(var r=e;r<this.t;++r)t[r-e]=this[r];t.t=Math.max(this.t-e,0),t.s=this.s},o.prototype.lShiftTo=function(e,t){var r,i=e%this.DB,n=this.DB-i,a=(1<<n)-1,s=Math.floor(e/this.DB),o=this.s<<i&this.DM;for(r=this.t-1;r>=0;--r)t[r+s+1]=this[r]>>n|o,o=(this[r]&a)<<i;for(r=s-1;r>=0;--r)t[r]=0;t[s]=o,t.t=this.t+s+1,t.s=this.s,t.clamp()},o.prototype.rShiftTo=function(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{var i=e%this.DB,n=this.DB-i,a=(1<<i)-1;t[0]=this[r]>>i;for(var s=r+1;s<this.t;++s)t[s-r-1]|=(this[s]&a)<<n,t[s-r]=this[s]>>i;i>0&&(t[this.t-r-1]|=(this.s&a)<<n),t.t=this.t-r,t.clamp()}},o.prototype.subTo=function(e,t){for(var r=0,i=0,n=Math.min(e.t,this.t);r<n;)i+=this[r]-e[r],t[r++]=i&this.DM,i>>=this.DB;if(e.t<this.t){for(i-=e.s;r<this.t;)i+=this[r],t[r++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;r<e.t;)i-=e[r],t[r++]=i&this.DM,i>>=this.DB;i-=e.s}t.s=i<0?-1:0,i<-1?t[r++]=this.DV+i:i>0&&(t[r++]=i),t.t=r,t.clamp()},o.prototype.multiplyTo=function(e,t){var r=this.abs(),i=e.abs(),n=r.t;for(t.t=n+i.t;--n>=0;)t[n]=0;for(n=0;n<i.t;++n)t[n+r.t]=r.am(0,i[n],t,n,0,r.t);t.s=0,t.clamp(),this.s!=e.s&&o.ZERO.subTo(t,t)},o.prototype.squareTo=function(e){for(var t=this.abs(),r=e.t=2*t.t;--r>=0;)e[r]=0;for(r=0;r<t.t-1;++r){var i=t.am(r,t[r],e,2*r,0,1);(e[r+t.t]+=t.am(r+1,2*t[r],e,2*r+1,i,t.t-r-1))>=t.DV&&(e[r+t.t]-=t.DV,e[r+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(r,t[r],e,2*r,0,1)),e.s=0,e.clamp()},o.prototype.divRemTo=function(e,t,r){var i=e.abs();if(!(i.t<=0)){var n=this.abs();if(n.t<i.t)return null!=t&&t.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=l());var a=l(),s=this.s,h=e.s,c=this.DB-g(i[i.t-1]);c>0?(i.lShiftTo(c,a),n.lShiftTo(c,r)):(i.copyTo(a),n.copyTo(r));var u=a.t,d=a[u-1];if(0!=d){var p=d*(1<<this.F1)+(u>1?a[u-2]>>this.F2:0),f=this.FV/p,m=(1<<this.F1)/p,v=1<<this.F2,y=r.t,b=y-u,x=null==t?l():t;for(a.dlShiftTo(b,x),r.compareTo(x)>=0&&(r[r.t++]=1,r.subTo(x,r)),o.ONE.dlShiftTo(u,x),x.subTo(a,a);a.t<u;)a[a.t++]=0;for(;--b>=0;){var _=r[--y]==d?this.DM:Math.floor(r[y]*f+(r[y-1]+v)*m);if((r[y]+=a.am(0,_,r,b,0,u))<_)for(a.dlShiftTo(b,x),r.subTo(x,r);r[y]<--_;)r.subTo(x,r)}null!=t&&(r.drShiftTo(u,t),s!=h&&o.ZERO.subTo(t,t)),r.t=u,r.clamp(),c>0&&r.rShiftTo(c,r),s<0&&o.ZERO.subTo(r,r)}}},o.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(!(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},o.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},o.prototype.exp=function(e,t){if(e>4294967295||e<1)return o.ONE;var r=l(),i=l(),n=t.convert(this),a=g(e)-1;for(n.copyTo(r);--a>=0;)if(t.sqrTo(r,i),(e&1<<a)>0)t.mulTo(i,n,r);else{var s=r;r=i,i=s}return t.revert(r)},o.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,i=(1<<t)-1,n=!1,a="",s=this.t,o=this.DB-s*this.DB%t;if(s-- >0)for(o<this.DB&&(r=this[s]>>o)>0&&(n=!0,a=p(r));s>=0;)o<t?(r=(this[s]&(1<<o)-1)<<t-o,r|=this[--s]>>(o+=this.DB-t)):(r=this[s]>>(o-=t)&i,o<=0&&(o+=this.DB,--s)),r>0&&(n=!0),n&&(a+=p(r));return n?a:"0"},o.prototype.negate=function(){var e=l();return o.ZERO.subTo(this,e),e},o.prototype.abs=function(){return this.s<0?this.negate():this},o.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(0!=(t=r-e.t))return this.s<0?-t:t;for(;--r>=0;)if(0!=(t=this[r]-e[r]))return t;return 0},o.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+g(this[this.t-1]^this.s&this.DM)},o.prototype.mod=function(e){var t=l();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(o.ZERO)>0&&e.subTo(t,t),t},o.prototype.modPowInt=function(e,t){var r;return r=e<256||t.isEven()?new v(t):new y(t),this.exp(e,r)},o.ZERO=m(0),o.ONE=m(1),M.prototype.convert=E,M.prototype.revert=E,M.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r)},M.prototype.sqrTo=function(e,t){e.squareTo(t)},A.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=l();return e.copyTo(t),this.reduce(t),t},A.prototype.revert=function(e){return e},A.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},A.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},A.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var C=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],P=(1<<26)/C[C.length-1];o.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},o.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),i=m(r),n=l(),a=l(),s="";for(this.divRemTo(i,n,a);n.signum()>0;)s=(r+a.intValue()).toString(e).substr(1)+s,n.divRemTo(i,n,a);return a.intValue().toString(e)+s},o.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var r=this.chunkSize(t),i=Math.pow(t,r),n=!1,a=0,s=0,l=0;l<e.length;++l){var h=f(e,l);h<0?"-"==e.charAt(l)&&0==this.signum()&&(n=!0):(s=t*s+h,++a>=r&&(this.dMultiply(i),this.dAddOffset(s,0),a=0,s=0))}a>0&&(this.dMultiply(Math.pow(t,a)),this.dAddOffset(s,0)),n&&o.ZERO.subTo(this,this)},o.prototype.fromNumber=function(e,t,r){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,r),this.testBit(e-1)||this.bitwiseTo(o.ONE.shiftLeft(e-1),x,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(o.ONE.shiftLeft(e-1),this);else{var i=new Array,n=7&e;i.length=1+(e>>3),t.nextBytes(i),n>0?i[0]&=(1<<n)-1:i[0]=0,this.fromString(i,256)}},o.prototype.bitwiseTo=function(e,t,r){var i,n,a=Math.min(e.t,this.t);for(i=0;i<a;++i)r[i]=t(this[i],e[i]);if(e.t<this.t){for(n=e.s&this.DM,i=a;i<this.t;++i)r[i]=t(this[i],n);r.t=this.t}else{for(n=this.s&this.DM,i=a;i<e.t;++i)r[i]=t(n,e[i]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()},o.prototype.changeBit=function(e,t){var r=o.ONE.shiftLeft(e);return this.bitwiseTo(r,t,r),r},o.prototype.addTo=function(e,t){for(var r=0,i=0,n=Math.min(e.t,this.t);r<n;)i+=this[r]+e[r],t[r++]=i&this.DM,i>>=this.DB;if(e.t<this.t){for(i+=e.s;r<this.t;)i+=this[r],t[r++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;r<e.t;)i+=e[r],t[r++]=i&this.DM,i>>=this.DB;i+=e.s}t.s=i<0?-1:0,i>0?t[r++]=i:i<-1&&(t[r++]=this.DV+i),t.t=r,t.clamp()},o.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},o.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},o.prototype.multiplyLowerTo=function(e,t,r){var i,n=Math.min(this.t+e.t,t);for(r.s=0,r.t=n;n>0;)r[--n]=0;for(i=r.t-this.t;n<i;++n)r[n+this.t]=this.am(0,e[n],r,n,0,this.t);for(i=Math.min(e.t,t);n<i;++n)this.am(0,e[n],r,n,0,t-n);r.clamp()},o.prototype.multiplyUpperTo=function(e,t,r){--t;var i=r.t=this.t+e.t-t;for(r.s=0;--i>=0;)r[i]=0;for(i=Math.max(t-this.t,0);i<e.t;++i)r[this.t+i-t]=this.am(t-i,e[i],r,0,0,this.t+i-t);r.clamp(),r.drShiftTo(1,r)},o.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,r=this.s<0?e-1:0;if(this.t>0)if(0==t)r=this[0]%e;else for(var i=this.t-1;i>=0;--i)r=(t*r+this[i])%e;return r},o.prototype.millerRabin=function(e){var t=this.subtract(o.ONE),r=t.getLowestSetBit();if(r<=0)return!1;var i=t.shiftRight(r);(e=e+1>>1)>C.length&&(e=C.length);for(var n=l(),a=0;a<e;++a){n.fromInt(C[Math.floor(Math.random()*C.length)]);var s=n.modPow(i,this);if(0!=s.compareTo(o.ONE)&&0!=s.compareTo(t)){for(var h=1;h++<r&&0!=s.compareTo(t);)if(0==(s=s.modPowInt(2,this)).compareTo(o.ONE))return!1;if(0!=s.compareTo(t))return!1}}return!0},o.prototype.clone=function(){var e=l();return this.copyTo(e),e},o.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},o.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},o.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},o.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},o.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var r,i=this.DB-e*this.DB%8,n=0;if(e-- >0)for(i<this.DB&&(r=this[e]>>i)!=(this.s&this.DM)>>i&&(t[n++]=r|this.s<<this.DB-i);e>=0;)i<8?(r=(this[e]&(1<<i)-1)<<8-i,r|=this[--e]>>(i+=this.DB-8)):(r=this[e]>>(i-=8)&255,i<=0&&(i+=this.DB,--e)),128&r&&(r|=-256),0==n&&(128&this.s)!=(128&r)&&++n,(n>0||r!=this.s)&&(t[n++]=r);return t},o.prototype.equals=function(e){return 0==this.compareTo(e)},o.prototype.min=function(e){return this.compareTo(e)<0?this:e},o.prototype.max=function(e){return this.compareTo(e)>0?this:e},o.prototype.and=function(e){var t=l();return this.bitwiseTo(e,b,t),t},o.prototype.or=function(e){var t=l();return this.bitwiseTo(e,x,t),t},o.prototype.xor=function(e){var t=l();return this.bitwiseTo(e,_,t),t},o.prototype.andNot=function(e){var t=l();return this.bitwiseTo(e,w,t),t},o.prototype.not=function(){for(var e=l(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},o.prototype.shiftLeft=function(e){var t=l();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},o.prototype.shiftRight=function(e){var t=l();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},o.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+S(this[e]);return this.s<0?this.t*this.DB:-1},o.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r)e+=T(this[r]^t);return e},o.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)},o.prototype.setBit=function(e){return this.changeBit(e,x)},o.prototype.clearBit=function(e){return this.changeBit(e,w)},o.prototype.flipBit=function(e){return this.changeBit(e,_)},o.prototype.add=function(e){var t=l();return this.addTo(e,t),t},o.prototype.subtract=function(e){var t=l();return this.subTo(e,t),t},o.prototype.multiply=function(e){var t=l();return this.multiplyTo(e,t),t},o.prototype.divide=function(e){var t=l();return this.divRemTo(e,t,null),t},o.prototype.remainder=function(e){var t=l();return this.divRemTo(e,null,t),t},o.prototype.divideAndRemainder=function(e){var t=l(),r=l();return this.divRemTo(e,t,r),new Array(t,r)},o.prototype.modPow=function(e,t){var r,i,n=e.bitLength(),a=m(1);if(n<=0)return a;r=n<18?1:n<48?3:n<144?4:n<768?5:6,i=n<8?new v(t):t.isEven()?new A(t):new y(t);var s=new Array,o=3,h=r-1,c=(1<<r)-1;if(s[1]=i.convert(this),r>1){var u=l();for(i.sqrTo(s[1],u);o<=c;)s[o]=l(),i.mulTo(u,s[o-2],s[o]),o+=2}var d,p,f=e.t-1,b=!0,x=l();for(n=g(e[f])-1;f>=0;){for(n>=h?d=e[f]>>n-h&c:(d=(e[f]&(1<<n+1)-1)<<h-n,f>0&&(d|=e[f-1]>>this.DB+n-h)),o=r;!(1&d);)d>>=1,--o;if((n-=o)<0&&(n+=this.DB,--f),b)s[d].copyTo(a),b=!1;else{for(;o>1;)i.sqrTo(a,x),i.sqrTo(x,a),o-=2;o>0?i.sqrTo(a,x):(p=a,a=x,x=p),i.mulTo(x,s[d],a)}for(;f>=0&&!(e[f]&1<<n);)i.sqrTo(a,x),p=a,a=x,x=p,--n<0&&(n=this.DB-1,--f)}return i.revert(a)},o.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return o.ZERO;for(var r=e.clone(),i=this.clone(),n=m(1),a=m(0),s=m(0),l=m(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),t?((!n.isEven()||!a.isEven())&&(n.addTo(this,n),a.subTo(e,a)),n.rShiftTo(1,n)):a.isEven()||a.subTo(e,a),a.rShiftTo(1,a);for(;i.isEven();)i.rShiftTo(1,i),t?((!s.isEven()||!l.isEven())&&(s.addTo(this,s),l.subTo(e,l)),s.rShiftTo(1,s)):l.isEven()||l.subTo(e,l),l.rShiftTo(1,l);r.compareTo(i)>=0?(r.subTo(i,r),t&&n.subTo(s,n),a.subTo(l,a)):(i.subTo(r,i),t&&s.subTo(n,s),l.subTo(a,l))}return 0!=i.compareTo(o.ONE)?o.ZERO:l.compareTo(e)>=0?l.subtract(e):l.signum()<0?(l.addTo(e,l),l.signum()<0?l.add(e):l):l},o.prototype.pow=function(e){return this.exp(e,new M)},o.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(t.compareTo(r)<0){var i=t;t=r,r=i}var n=t.getLowestSetBit(),a=r.getLowestSetBit();if(a<0)return t;for(n<a&&(a=n),a>0&&(t.rShiftTo(a,t),r.rShiftTo(a,r));t.signum()>0;)(n=t.getLowestSetBit())>0&&t.rShiftTo(n,t),(n=r.getLowestSetBit())>0&&r.rShiftTo(n,r),t.compareTo(r)>=0?(t.subTo(r,t),t.rShiftTo(1,t)):(r.subTo(t,r),r.rShiftTo(1,r));return a>0&&r.lShiftTo(a,r),r},o.prototype.isProbablePrime=function(e){var t,r=this.abs();if(1==r.t&&r[0]<=C[C.length-1]){for(t=0;t<C.length;++t)if(r[0]==C[t])return!0;return!1}if(r.isEven())return!1;for(t=1;t<C.length;){for(var i=C[t],n=t+1;n<C.length&&i<P;)i*=C[n++];for(i=r.modInt(i);t<n;)if(i%C[t++]==0)return!1}return r.millerRabin(e)},o.prototype.square=function(){var e=l();return this.squareTo(e),e};var R=o;R.prototype.IsNegative=function(){return-1==this.compareTo(R.ZERO)},R.op_Equality=function(e,t){return 0==e.compareTo(t)},R.op_Inequality=function(e,t){return 0!=e.compareTo(t)},R.op_GreaterThan=function(e,t){return e.compareTo(t)>0},R.op_LessThan=function(e,t){return e.compareTo(t)<0},R.op_Addition=function(e,t){return new R(e,void 0,void 0).add(new R(t,void 0,void 0))},R.op_Subtraction=function(e,t){return new R(e,void 0,void 0).subtract(new R(t,void 0,void 0))},R.Int128Mul=function(e,t){return new R(e,void 0,void 0).multiply(new R(t,void 0,void 0))},R.op_Division=function(e,t){return e.divide(t)},R.prototype.ToDouble=function(){return parseFloat(this.toString())};var I=function(e,t){var r;if(void 0===Object.getOwnPropertyNames){for(r in t.prototype)(void 0===e.prototype[r]||e.prototype[r]===Object.prototype[r])&&(e.prototype[r]=t.prototype[r]);for(r in t)void 0===e[r]&&(e[r]=t[r]);e.$baseCtor=t}else{for(var i=Object.getOwnPropertyNames(t.prototype),n=0;n<i.length;n++)void 0===Object.getOwnPropertyDescriptor(e.prototype,i[n])&&Object.defineProperty(e.prototype,i[n],Object.getOwnPropertyDescriptor(t.prototype,i[n]));for(r in t)void 0===e[r]&&(e[r]=t[r]);e.$baseCtor=t}};r.Path=function(){return[]},r.Path.prototype.push=Array.prototype.push,r.Paths=function(){return[]},r.Paths.prototype.push=Array.prototype.push,r.DoublePoint=function(){var e=arguments;this.X=0,this.Y=0,1===e.length?(this.X=e[0].X,this.Y=e[0].Y):2===e.length&&(this.X=e[0],this.Y=e[1])},r.DoublePoint0=function(){this.X=0,this.Y=0},r.DoublePoint0.prototype=r.DoublePoint.prototype,r.DoublePoint1=function(e){this.X=e.X,this.Y=e.Y},r.DoublePoint1.prototype=r.DoublePoint.prototype,r.DoublePoint2=function(e,t){this.X=e,this.Y=t},r.DoublePoint2.prototype=r.DoublePoint.prototype,r.PolyNode=function(){this.m_Parent=null,this.m_polygon=new r.Path,this.m_Index=0,this.m_jointype=0,this.m_endtype=0,this.m_Childs=[],this.IsOpen=!1},r.PolyNode.prototype.IsHoleNode=function(){for(var e=!0,t=this.m_Parent;null!==t;)e=!e,t=t.m_Parent;return e},r.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length},r.PolyNode.prototype.Contour=function(){return this.m_polygon},r.PolyNode.prototype.AddChild=function(e){var t=this.m_Childs.length;this.m_Childs.push(e),e.m_Parent=this,e.m_Index=t},r.PolyNode.prototype.GetNext=function(){return this.m_Childs.length>0?this.m_Childs[0]:this.GetNextSiblingUp()},r.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index===this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]},r.PolyNode.prototype.Childs=function(){return this.m_Childs},r.PolyNode.prototype.Parent=function(){return this.m_Parent},r.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()},r.PolyTree=function(){this.m_AllPolys=[],r.PolyNode.call(this)},r.PolyTree.prototype.Clear=function(){for(var e=0,t=this.m_AllPolys.length;e<t;e++)this.m_AllPolys[e]=null;this.m_AllPolys.length=0,this.m_Childs.length=0},r.PolyTree.prototype.GetFirst=function(){return this.m_Childs.length>0?this.m_Childs[0]:null},r.PolyTree.prototype.Total=function(){var e=this.m_AllPolys.length;return e>0&&this.m_Childs[0]!==this.m_AllPolys[0]&&e--,e},I(r.PolyTree,r.PolyNode),r.Math_Abs_Int64=r.Math_Abs_Int32=r.Math_Abs_Double=function(e){return Math.abs(e)},r.Math_Max_Int32_Int32=function(e,t){return Math.max(e,t)},a.msie||a.opera||a.safari?r.Cast_Int32=function(e){return 0|e}:r.Cast_Int32=function(e){return~~e},void 0===Number.toInteger&&(Number.toInteger=null),a.chrome?r.Cast_Int64=function(e){return e<-2147483648||e>2147483647?e<0?Math.ceil(e):Math.floor(e):~~e}:a.firefox&&"function"==typeof Number.toInteger?r.Cast_Int64=function(e){return Number.toInteger(e)}:a.msie7||a.msie8?r.Cast_Int64=function(e){return parseInt(e,10)}:a.msie?r.Cast_Int64=function(e){return e<-2147483648||e>2147483647?e<0?Math.ceil(e):Math.floor(e):0|e}:r.Cast_Int64=function(e){return e<0?Math.ceil(e):Math.floor(e)},r.Clear=function(e){e.length=0},r.PI=3.141592653589793,r.PI2=6.283185307179586,r.IntPoint=function(){var e=arguments,t=e.length;if(this.X=0,this.Y=0,r.use_xyz)if(this.Z=0,3===t)this.X=e[0],this.Y=e[1],this.Z=e[2];else if(2===t)this.X=e[0],this.Y=e[1],this.Z=0;else if(1===t)if(e[0]instanceof r.DoublePoint){var i=e[0];this.X=r.Clipper.Round(i.X),this.Y=r.Clipper.Round(i.Y),this.Z=0}else{void 0===(n=e[0]).Z&&(n.Z=0),this.X=n.X,this.Y=n.Y,this.Z=n.Z}else this.X=0,this.Y=0,this.Z=0;else if(2===t)this.X=e[0],this.Y=e[1];else if(1===t)if(e[0]instanceof r.DoublePoint){i=e[0];this.X=r.Clipper.Round(i.X),this.Y=r.Clipper.Round(i.Y)}else{var n=e[0];this.X=n.X,this.Y=n.Y}else this.X=0,this.Y=0},r.IntPoint.op_Equality=function(e,t){return e.X===t.X&&e.Y===t.Y},r.IntPoint.op_Inequality=function(e,t){return e.X!==t.X||e.Y!==t.Y},r.IntPoint0=function(){this.X=0,this.Y=0,r.use_xyz&&(this.Z=0)},r.IntPoint0.prototype=r.IntPoint.prototype,r.IntPoint1=function(e){this.X=e.X,this.Y=e.Y,r.use_xyz&&(void 0===e.Z?this.Z=0:this.Z=e.Z)},r.IntPoint1.prototype=r.IntPoint.prototype,r.IntPoint1dp=function(e){this.X=r.Clipper.Round(e.X),this.Y=r.Clipper.Round(e.Y),r.use_xyz&&(this.Z=0)},r.IntPoint1dp.prototype=r.IntPoint.prototype,r.IntPoint2=function(e,t,i){this.X=e,this.Y=t,r.use_xyz&&(this.Z=void 0===i?0:i)},r.IntPoint2.prototype=r.IntPoint.prototype,r.IntRect=function(){var e=arguments,t=e.length;if(4===t)this.left=e[0],this.top=e[1],this.right=e[2],this.bottom=e[3];else if(1===t){var r=e[0];this.left=r.left,this.top=r.top,this.right=r.right,this.bottom=r.bottom}else this.left=0,this.top=0,this.right=0,this.bottom=0},r.IntRect0=function(){this.left=0,this.top=0,this.right=0,this.bottom=0},r.IntRect0.prototype=r.IntRect.prototype,r.IntRect1=function(e){this.left=e.left,this.top=e.top,this.right=e.right,this.bottom=e.bottom},r.IntRect1.prototype=r.IntRect.prototype,r.IntRect4=function(e,t,r,i){this.left=e,this.top=t,this.right=r,this.bottom=i},r.IntRect4.prototype=r.IntRect.prototype,r.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3},r.PolyType={ptSubject:0,ptClip:1},r.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3},r.JoinType={jtSquare:0,jtRound:1,jtMiter:2},r.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4},r.EdgeSide={esLeft:0,esRight:1},r.Direction={dRightToLeft:0,dLeftToRight:1},r.TEdge=function(){this.Bot=new r.IntPoint0,this.Curr=new r.IntPoint0,this.Top=new r.IntPoint0,this.Delta=new r.IntPoint0,this.Dx=0,this.PolyTyp=r.PolyType.ptSubject,this.Side=r.EdgeSide.esLeft,this.WindDelta=0,this.WindCnt=0,this.WindCnt2=0,this.OutIdx=0,this.Next=null,this.Prev=null,this.NextInLML=null,this.NextInAEL=null,this.PrevInAEL=null,this.NextInSEL=null,this.PrevInSEL=null},r.IntersectNode=function(){this.Edge1=null,this.Edge2=null,this.Pt=new r.IntPoint0},r.MyIntersectNodeSort=function(){},r.MyIntersectNodeSort.Compare=function(e,t){var r=t.Pt.Y-e.Pt.Y;return r>0?1:r<0?-1:0},r.LocalMinima=function(){this.Y=0,this.LeftBound=null,this.RightBound=null,this.Next=null},r.Scanbeam=function(){this.Y=0,this.Next=null},r.Maxima=function(){this.X=0,this.Next=null,this.Prev=null},r.OutRec=function(){this.Idx=0,this.IsHole=!1,this.IsOpen=!1,this.FirstLeft=null,this.Pts=null,this.BottomPt=null,this.PolyNode=null},r.OutPt=function(){this.Idx=0,this.Pt=new r.IntPoint0,this.Next=null,this.Prev=null},r.Join=function(){this.OutPt1=null,this.OutPt2=null,this.OffPt=new r.IntPoint0},r.ClipperBase=function(){this.m_MinimaList=null,this.m_CurrentLM=null,this.m_edges=new Array,this.m_UseFullRange=!1,this.m_HasOpenPaths=!1,this.PreserveCollinear=!1,this.m_Scanbeam=null,this.m_PolyOuts=null,this.m_ActiveEdges=null},r.ClipperBase.horizontal=-9007199254740992,r.ClipperBase.Skip=-2,r.ClipperBase.Unassigned=-1,r.ClipperBase.tolerance=1e-20,r.ClipperBase.loRange=47453132,r.ClipperBase.hiRange=0xfffffffffffff,r.ClipperBase.near_zero=function(e){return e>-r.ClipperBase.tolerance&&e<r.ClipperBase.tolerance},r.ClipperBase.IsHorizontal=function(e){return 0===e.Delta.Y},r.ClipperBase.prototype.PointIsVertex=function(e,t){var i=t;do{if(r.IntPoint.op_Equality(i.Pt,e))return!0;i=i.Next}while(i!==t);return!1},r.ClipperBase.prototype.PointOnLineSegment=function(e,t,r,i){return i?e.X===t.X&&e.Y===t.Y||e.X===r.X&&e.Y===r.Y||e.X>t.X==e.X<r.X&&e.Y>t.Y==e.Y<r.Y&&R.op_Equality(R.Int128Mul(e.X-t.X,r.Y-t.Y),R.Int128Mul(r.X-t.X,e.Y-t.Y)):e.X===t.X&&e.Y===t.Y||e.X===r.X&&e.Y===r.Y||e.X>t.X==e.X<r.X&&e.Y>t.Y==e.Y<r.Y&&(e.X-t.X)*(r.Y-t.Y)==(r.X-t.X)*(e.Y-t.Y)},r.ClipperBase.prototype.PointOnPolygon=function(e,t,r){for(var i=t;;){if(this.PointOnLineSegment(e,i.Pt,i.Next.Pt,r))return!0;if((i=i.Next)===t)break}return!1},r.ClipperBase.prototype.SlopesEqual=r.ClipperBase.SlopesEqual=function(){var e,t,i,n,a,s,o=arguments,l=o.length;return 3===l?(e=o[0],t=o[1],o[2]?R.op_Equality(R.Int128Mul(e.Delta.Y,t.Delta.X),R.Int128Mul(e.Delta.X,t.Delta.Y)):r.Cast_Int64(e.Delta.Y*t.Delta.X)===r.Cast_Int64(e.Delta.X*t.Delta.Y)):4===l?(i=o[0],n=o[1],a=o[2],o[3]?R.op_Equality(R.Int128Mul(i.Y-n.Y,n.X-a.X),R.Int128Mul(i.X-n.X,n.Y-a.Y)):r.Cast_Int64((i.Y-n.Y)*(n.X-a.X))-r.Cast_Int64((i.X-n.X)*(n.Y-a.Y))==0):(i=o[0],n=o[1],a=o[2],s=o[3],o[4]?R.op_Equality(R.Int128Mul(i.Y-n.Y,a.X-s.X),R.Int128Mul(i.X-n.X,a.Y-s.Y)):r.Cast_Int64((i.Y-n.Y)*(a.X-s.X))-r.Cast_Int64((i.X-n.X)*(a.Y-s.Y))==0)},r.ClipperBase.SlopesEqual3=function(e,t,i){return i?R.op_Equality(R.Int128Mul(e.Delta.Y,t.Delta.X),R.Int128Mul(e.Delta.X,t.Delta.Y)):r.Cast_Int64(e.Delta.Y*t.Delta.X)===r.Cast_Int64(e.Delta.X*t.Delta.Y)},r.ClipperBase.SlopesEqual4=function(e,t,i,n){return n?R.op_Equality(R.Int128Mul(e.Y-t.Y,t.X-i.X),R.Int128Mul(e.X-t.X,t.Y-i.Y)):r.Cast_Int64((e.Y-t.Y)*(t.X-i.X))-r.Cast_Int64((e.X-t.X)*(t.Y-i.Y))==0},r.ClipperBase.SlopesEqual5=function(e,t,i,n,a){return a?R.op_Equality(R.Int128Mul(e.Y-t.Y,i.X-n.X),R.Int128Mul(e.X-t.X,i.Y-n.Y)):r.Cast_Int64((e.Y-t.Y)*(i.X-n.X))-r.Cast_Int64((e.X-t.X)*(i.Y-n.Y))==0},r.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var e=0,t=this.m_edges.length;e<t;++e){for(var i=0,n=this.m_edges[e].length;i<n;++i)this.m_edges[e][i]=null;r.Clear(this.m_edges[e])}r.Clear(this.m_edges),this.m_UseFullRange=!1,this.m_HasOpenPaths=!1},r.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var e=this.m_MinimaList.Next;this.m_MinimaList=null,this.m_MinimaList=e}this.m_CurrentLM=null},r.ClipperBase.prototype.RangeTest=function(e,t){t.Value?(e.X>r.ClipperBase.hiRange||e.Y>r.ClipperBase.hiRange||-e.X>r.ClipperBase.hiRange||-e.Y>r.ClipperBase.hiRange)&&r.Error("Coordinate outside allowed range in RangeTest()."):(e.X>r.ClipperBase.loRange||e.Y>r.ClipperBase.loRange||-e.X>r.ClipperBase.loRange||-e.Y>r.ClipperBase.loRange)&&(t.Value=!0,this.RangeTest(e,t))},r.ClipperBase.prototype.InitEdge=function(e,t,i,n){e.Next=t,e.Prev=i,e.Curr.X=n.X,e.Curr.Y=n.Y,r.use_xyz&&(e.Curr.Z=n.Z),e.OutIdx=-1},r.ClipperBase.prototype.InitEdge2=function(e,t){e.Curr.Y>=e.Next.Curr.Y?(e.Bot.X=e.Curr.X,e.Bot.Y=e.Curr.Y,r.use_xyz&&(e.Bot.Z=e.Curr.Z),e.Top.X=e.Next.Curr.X,e.Top.Y=e.Next.Curr.Y,r.use_xyz&&(e.Top.Z=e.Next.Curr.Z)):(e.Top.X=e.Curr.X,e.Top.Y=e.Curr.Y,r.use_xyz&&(e.Top.Z=e.Curr.Z),e.Bot.X=e.Next.Curr.X,e.Bot.Y=e.Next.Curr.Y,r.use_xyz&&(e.Bot.Z=e.Next.Curr.Z)),this.SetDx(e),e.PolyTyp=t},r.ClipperBase.prototype.FindNextLocMin=function(e){for(var t;;){for(;r.IntPoint.op_Inequality(e.Bot,e.Prev.Bot)||r.IntPoint.op_Equality(e.Curr,e.Top);)e=e.Next;if(e.Dx!==r.ClipperBase.horizontal&&e.Prev.Dx!==r.ClipperBase.horizontal)break;for(;e.Prev.Dx===r.ClipperBase.horizontal;)e=e.Prev;for(t=e;e.Dx===r.ClipperBase.horizontal;)e=e.Next;if(e.Top.Y!==e.Prev.Bot.Y){t.Prev.Bot.X<e.Bot.X&&(e=t);break}}return e},r.ClipperBase.prototype.ProcessBound=function(e,t){var i,n,a=e;if(a.OutIdx===r.ClipperBase.Skip){if(e=a,t){for(;e.Top.Y===e.Next.Bot.Y;)e=e.Next;for(;e!==a&&e.Dx===r.ClipperBase.horizontal;)e=e.Prev}else{for(;e.Top.Y===e.Prev.Bot.Y;)e=e.Prev;for(;e!==a&&e.Dx===r.ClipperBase.horizontal;)e=e.Next}if(e===a)a=t?e.Next:e.Prev;else{e=t?a.Next:a.Prev;var s=new r.LocalMinima;s.Next=null,s.Y=e.Bot.Y,s.LeftBound=null,s.RightBound=e,e.WindDelta=0,a=this.ProcessBound(e,t),this.InsertLocalMinima(s)}return a}if(e.Dx===r.ClipperBase.horizontal&&((i=t?e.Prev:e.Next).Dx===r.ClipperBase.horizontal?i.Bot.X!==e.Bot.X&&i.Top.X!==e.Bot.X&&this.ReverseHorizontal(e):i.Bot.X!==e.Bot.X&&this.ReverseHorizontal(e)),i=e,t){for(;a.Top.Y===a.Next.Bot.Y&&a.Next.OutIdx!==r.ClipperBase.Skip;)a=a.Next;if(a.Dx===r.ClipperBase.horizontal&&a.Next.OutIdx!==r.ClipperBase.Skip){for(n=a;n.Prev.Dx===r.ClipperBase.horizontal;)n=n.Prev;n.Prev.Top.X>a.Next.Top.X&&(a=n.Prev)}for(;e!==a;)e.NextInLML=e.Next,e.Dx===r.ClipperBase.horizontal&&e!==i&&e.Bot.X!==e.Prev.Top.X&&this.ReverseHorizontal(e),e=e.Next;e.Dx===r.ClipperBase.horizontal&&e!==i&&e.Bot.X!==e.Prev.Top.X&&this.ReverseHorizontal(e),a=a.Next}else{for(;a.Top.Y===a.Prev.Bot.Y&&a.Prev.OutIdx!==r.ClipperBase.Skip;)a=a.Prev;if(a.Dx===r.ClipperBase.horizontal&&a.Prev.OutIdx!==r.ClipperBase.Skip){for(n=a;n.Next.Dx===r.ClipperBase.horizontal;)n=n.Next;(n.Next.Top.X===a.Prev.Top.X||n.Next.Top.X>a.Prev.Top.X)&&(a=n.Next)}for(;e!==a;)e.NextInLML=e.Prev,e.Dx===r.ClipperBase.horizontal&&e!==i&&e.Bot.X!==e.Next.Top.X&&this.ReverseHorizontal(e),e=e.Prev;e.Dx===r.ClipperBase.horizontal&&e!==i&&e.Bot.X!==e.Next.Top.X&&this.ReverseHorizontal(e),a=a.Prev}return a},r.ClipperBase.prototype.AddPath=function(e,t,i){r.use_lines?!i&&t===r.PolyType.ptClip&&r.Error("AddPath: Open paths must be subject."):i||r.Error("AddPath: Open paths have been disabled.");var n=e.length-1;if(i)for(;n>0&&r.IntPoint.op_Equality(e[n],e[0]);)--n;for(;n>0&&r.IntPoint.op_Equality(e[n],e[n-1]);)--n;if(i&&n<2||!i&&n<1)return!1;for(var a=new Array,s=0;s<=n;s++)a.push(new r.TEdge);var o=!0;a[1].Curr.X=e[1].X,a[1].Curr.Y=e[1].Y,r.use_xyz&&(a[1].Curr.Z=e[1].Z);var l={Value:this.m_UseFullRange};this.RangeTest(e[0],l),this.m_UseFullRange=l.Value,l.Value=this.m_UseFullRange,this.RangeTest(e[n],l),this.m_UseFullRange=l.Value,this.InitEdge(a[0],a[1],a[n],e[0]),this.InitEdge(a[n],a[0],a[n-1],e[n]);for(s=n-1;s>=1;--s)l.Value=this.m_UseFullRange,this.RangeTest(e[s],l),this.m_UseFullRange=l.Value,this.InitEdge(a[s],a[s+1],a[s-1],e[s]);for(var h=a[0],c=h,u=h;;)if(c.Curr!==c.Next.Curr||!i&&c.Next===h){if(c.Prev===c.Next)break;if(!i||!r.ClipperBase.SlopesEqual4(c.Prev.Curr,c.Curr,c.Next.Curr,this.m_UseFullRange)||this.PreserveCollinear&&this.Pt2IsBetweenPt1AndPt3(c.Prev.Curr,c.Curr,c.Next.Curr)){if((c=c.Next)===u||!i&&c.Next===h)break}else c===h&&(h=c.Next),u=c=(c=this.RemoveEdge(c)).Prev}else{if(c===c.Next)break;c===h&&(h=c.Next),u=c=this.RemoveEdge(c)}if(!i&&c===c.Next||i&&c.Prev===c.Next)return!1;i||(this.m_HasOpenPaths=!0,h.Prev.OutIdx=r.ClipperBase.Skip),c=h;do{this.InitEdge2(c,t),c=c.Next,o&&c.Curr.Y!==h.Curr.Y&&(o=!1)}while(c!==h);if(o){if(i)return!1;for(c.Prev.OutIdx=r.ClipperBase.Skip,(f=new r.LocalMinima).Next=null,f.Y=c.Bot.Y,f.LeftBound=null,f.RightBound=c,f.RightBound.Side=r.EdgeSide.esRight,f.RightBound.WindDelta=0;c.Bot.X!==c.Prev.Top.X&&this.ReverseHorizontal(c),c.Next.OutIdx!==r.ClipperBase.Skip;)c.NextInLML=c.Next,c=c.Next;return this.InsertLocalMinima(f),this.m_edges.push(a),!0}this.m_edges.push(a);var d,p=null;for(r.IntPoint.op_Equality(c.Prev.Bot,c.Prev.Top)&&(c=c.Next);(c=this.FindNextLocMin(c))!==p;){var f;null===p&&(p=c),(f=new r.LocalMinima).Next=null,f.Y=c.Bot.Y,c.Dx<c.Prev.Dx?(f.LeftBound=c.Prev,f.RightBound=c,d=!1):(f.LeftBound=c,f.RightBound=c.Prev,d=!0),f.LeftBound.Side=r.EdgeSide.esLeft,f.RightBound.Side=r.EdgeSide.esRight,i?f.LeftBound.Next===f.RightBound?f.LeftBound.WindDelta=-1:f.LeftBound.WindDelta=1:f.LeftBound.WindDelta=0,f.RightBound.WindDelta=-f.LeftBound.WindDelta,(c=this.ProcessBound(f.LeftBound,d)).OutIdx===r.ClipperBase.Skip&&(c=this.ProcessBound(c,d));var m=this.ProcessBound(f.RightBound,!d);m.OutIdx===r.ClipperBase.Skip&&(m=this.ProcessBound(m,!d)),f.LeftBound.OutIdx===r.ClipperBase.Skip?f.LeftBound=null:f.RightBound.OutIdx===r.ClipperBase.Skip&&(f.RightBound=null),this.InsertLocalMinima(f),d||(c=m)}return!0},r.ClipperBase.prototype.AddPaths=function(e,t,r){for(var i=!1,n=0,a=e.length;n<a;++n)this.AddPath(e[n],t,r)&&(i=!0);return i},r.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(e,t,i){return!(r.IntPoint.op_Equality(e,i)||r.IntPoint.op_Equality(e,t)||r.IntPoint.op_Equality(i,t))&&(e.X!==i.X?t.X>e.X==t.X<i.X:t.Y>e.Y==t.Y<i.Y)},r.ClipperBase.prototype.RemoveEdge=function(e){e.Prev.Next=e.Next,e.Next.Prev=e.Prev;var t=e.Next;return e.Prev=null,t},r.ClipperBase.prototype.SetDx=function(e){e.Delta.X=e.Top.X-e.Bot.X,e.Delta.Y=e.Top.Y-e.Bot.Y,0===e.Delta.Y?e.Dx=r.ClipperBase.horizontal:e.Dx=e.Delta.X/e.Delta.Y},r.ClipperBase.prototype.InsertLocalMinima=function(e){if(null===this.m_MinimaList)this.m_MinimaList=e;else if(e.Y>=this.m_MinimaList.Y)e.Next=this.m_MinimaList,this.m_MinimaList=e;else{for(var t=this.m_MinimaList;null!==t.Next&&e.Y<t.Next.Y;)t=t.Next;e.Next=t.Next,t.Next=e}},r.ClipperBase.prototype.PopLocalMinima=function(e,t){return t.v=this.m_CurrentLM,null!==this.m_CurrentLM&&this.m_CurrentLM.Y===e&&(this.m_CurrentLM=this.m_CurrentLM.Next,!0)},r.ClipperBase.prototype.ReverseHorizontal=function(e){var t=e.Top.X;e.Top.X=e.Bot.X,e.Bot.X=t,r.use_xyz&&(t=e.Top.Z,e.Top.Z=e.Bot.Z,e.Bot.Z=t)},r.ClipperBase.prototype.Reset=function(){if(this.m_CurrentLM=this.m_MinimaList,null!==this.m_CurrentLM){this.m_Scanbeam=null;for(var e=this.m_MinimaList;null!==e;){this.InsertScanbeam(e.Y);var t=e.LeftBound;null!==t&&(t.Curr.X=t.Bot.X,t.Curr.Y=t.Bot.Y,r.use_xyz&&(t.Curr.Z=t.Bot.Z),t.OutIdx=r.ClipperBase.Unassigned),null!==(t=e.RightBound)&&(t.Curr.X=t.Bot.X,t.Curr.Y=t.Bot.Y,r.use_xyz&&(t.Curr.Z=t.Bot.Z),t.OutIdx=r.ClipperBase.Unassigned),e=e.Next}this.m_ActiveEdges=null}},r.ClipperBase.prototype.InsertScanbeam=function(e){if(null===this.m_Scanbeam)this.m_Scanbeam=new r.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=e;else if(e>this.m_Scanbeam.Y){var t=new r.Scanbeam;t.Y=e,t.Next=this.m_Scanbeam,this.m_Scanbeam=t}else{for(var i=this.m_Scanbeam;null!==i.Next&&e<=i.Next.Y;)i=i.Next;if(e===i.Y)return;var n=new r.Scanbeam;n.Y=e,n.Next=i.Next,i.Next=n}},r.ClipperBase.prototype.PopScanbeam=function(e){return null===this.m_Scanbeam?(e.v=0,!1):(e.v=this.m_Scanbeam.Y,this.m_Scanbeam=this.m_Scanbeam.Next,!0)},r.ClipperBase.prototype.LocalMinimaPending=function(){return null!==this.m_CurrentLM},r.ClipperBase.prototype.CreateOutRec=function(){var e=new r.OutRec;return e.Idx=r.ClipperBase.Unassigned,e.IsHole=!1,e.IsOpen=!1,e.FirstLeft=null,e.Pts=null,e.BottomPt=null,e.PolyNode=null,this.m_PolyOuts.push(e),e.Idx=this.m_PolyOuts.length-1,e},r.ClipperBase.prototype.DisposeOutRec=function(e){var t=this.m_PolyOuts[e];t.Pts=null,t=null,this.m_PolyOuts[e]=null},r.ClipperBase.prototype.UpdateEdgeIntoAEL=function(e){null===e.NextInLML&&r.Error("UpdateEdgeIntoAEL: invalid call");var t=e.PrevInAEL,i=e.NextInAEL;return e.NextInLML.OutIdx=e.OutIdx,null!==t?t.NextInAEL=e.NextInLML:this.m_ActiveEdges=e.NextInLML,null!==i&&(i.PrevInAEL=e.NextInLML),e.NextInLML.Side=e.Side,e.NextInLML.WindDelta=e.WindDelta,e.NextInLML.WindCnt=e.WindCnt,e.NextInLML.WindCnt2=e.WindCnt2,(e=e.NextInLML).Curr.X=e.Bot.X,e.Curr.Y=e.Bot.Y,e.PrevInAEL=t,e.NextInAEL=i,r.ClipperBase.IsHorizontal(e)||this.InsertScanbeam(e.Top.Y),e},r.ClipperBase.prototype.SwapPositionsInAEL=function(e,t){if(e.NextInAEL!==e.PrevInAEL&&t.NextInAEL!==t.PrevInAEL){if(e.NextInAEL===t){var r=t.NextInAEL;null!==r&&(r.PrevInAEL=e);var i=e.PrevInAEL;null!==i&&(i.NextInAEL=t),t.PrevInAEL=i,t.NextInAEL=e,e.PrevInAEL=t,e.NextInAEL=r}else if(t.NextInAEL===e){var n=e.NextInAEL;null!==n&&(n.PrevInAEL=t);var a=t.PrevInAEL;null!==a&&(a.NextInAEL=e),e.PrevInAEL=a,e.NextInAEL=t,t.PrevInAEL=e,t.NextInAEL=n}else{var s=e.NextInAEL,o=e.PrevInAEL;e.NextInAEL=t.NextInAEL,null!==e.NextInAEL&&(e.NextInAEL.PrevInAEL=e),e.PrevInAEL=t.PrevInAEL,null!==e.PrevInAEL&&(e.PrevInAEL.NextInAEL=e),t.NextInAEL=s,null!==t.NextInAEL&&(t.NextInAEL.PrevInAEL=t),t.PrevInAEL=o,null!==t.PrevInAEL&&(t.PrevInAEL.NextInAEL=t)}null===e.PrevInAEL?this.m_ActiveEdges=e:null===t.PrevInAEL&&(this.m_ActiveEdges=t)}},r.ClipperBase.prototype.DeleteFromAEL=function(e){var t=e.PrevInAEL,r=e.NextInAEL;null===t&&null===r&&e!==this.m_ActiveEdges||(null!==t?t.NextInAEL=r:this.m_ActiveEdges=r,null!==r&&(r.PrevInAEL=t),e.NextInAEL=null,e.PrevInAEL=null)},r.Clipper=function(e){void 0===e&&(e=0),this.m_PolyOuts=null,this.m_ClipType=r.ClipType.ctIntersection,this.m_Scanbeam=null,this.m_Maxima=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=null,this.m_IntersectNodeComparer=null,this.m_ExecuteLocked=!1,this.m_ClipFillType=r.PolyFillType.pftEvenOdd,this.m_SubjFillType=r.PolyFillType.pftEvenOdd,this.m_Joins=null,this.m_GhostJoins=null,this.m_UsingPolyTree=!1,this.ReverseSolution=!1,this.StrictlySimple=!1,r.ClipperBase.call(this),this.m_Scanbeam=null,this.m_Maxima=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=new Array,this.m_IntersectNodeComparer=r.MyIntersectNodeSort.Compare,this.m_ExecuteLocked=!1,this.m_UsingPolyTree=!1,this.m_PolyOuts=new Array,this.m_Joins=new Array,this.m_GhostJoins=new Array,this.ReverseSolution=0!=(1&e),this.StrictlySimple=0!=(2&e),this.PreserveCollinear=0!=(4&e),r.use_xyz&&(this.ZFillFunction=null)},r.Clipper.ioReverseSolution=1,r.Clipper.ioStrictlySimple=2,r.Clipper.ioPreserveCollinear=4,r.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),r.ClipperBase.prototype.Clear.call(this))},r.Clipper.prototype.InsertMaxima=function(e){var t=new r.Maxima;if(t.X=e,null===this.m_Maxima)this.m_Maxima=t,this.m_Maxima.Next=null,this.m_Maxima.Prev=null;else if(e<this.m_Maxima.X)t.Next=this.m_Maxima,t.Prev=null,this.m_Maxima=t;else{for(var i=this.m_Maxima;null!==i.Next&&e>=i.Next.X;)i=i.Next;if(e===i.X)return;t.Next=i.Next,t.Prev=i,null!==i.Next&&(i.Next.Prev=t),i.Next=t}},r.Clipper.prototype.Execute=function(){var e=arguments,t=e.length,i=e[1]instanceof r.PolyTree;if(4===t&&!i){var n=e[0],a=e[1],s=e[2],o=e[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&r.Error("Error: PolyTree struct is needed for open path clipping."),this.m_ExecuteLocked=!0,r.Clear(a),this.m_SubjFillType=s,this.m_ClipFillType=o,this.m_ClipType=n,this.m_UsingPolyTree=!1;try{(h=this.ExecuteInternal())&&this.BuildResult(a)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return h}if(4===t&&i){n=e[0];var l=e[1];s=e[2],o=e[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0,this.m_SubjFillType=s,this.m_ClipFillType=o,this.m_ClipType=n,this.m_UsingPolyTree=!0;try{var h;(h=this.ExecuteInternal())&&this.BuildResult2(l)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return h}if(2===t&&!i){n=e[0],a=e[1];return this.Execute(n,a,r.PolyFillType.pftEvenOdd,r.PolyFillType.pftEvenOdd)}if(2===t&&i){n=e[0],l=e[1];return this.Execute(n,l,r.PolyFillType.pftEvenOdd,r.PolyFillType.pftEvenOdd)}},r.Clipper.prototype.FixHoleLinkage=function(e){if(null!==e.FirstLeft&&(e.IsHole===e.FirstLeft.IsHole||null===e.FirstLeft.Pts)){for(var t=e.FirstLeft;null!==t&&(t.IsHole===e.IsHole||null===t.Pts);)t=t.FirstLeft;e.FirstLeft=t}},r.Clipper.prototype.ExecuteInternal=function(){try{this.Reset(),this.m_SortedEdges=null,this.m_Maxima=null;var e,t,r,i={},n={};if(!this.PopScanbeam(i))return!1;for(this.InsertLocalMinimaIntoAEL(i.v);this.PopScanbeam(n)||this.LocalMinimaPending();){if(this.ProcessHorizontals(),this.m_GhostJoins.length=0,!this.ProcessIntersections(n.v))return!1;this.ProcessEdgesAtTopOfScanbeam(n.v),i.v=n.v,this.InsertLocalMinimaIntoAEL(i.v)}for(t=0,r=this.m_PolyOuts.length;t<r;t++)null!==(e=this.m_PolyOuts[t]).Pts&&!e.IsOpen&&(e.IsHole^this.ReverseSolution)==this.Area$1(e)>0&&this.ReversePolyPtLinks(e.Pts);for(this.JoinCommonEdges(),t=0,r=this.m_PolyOuts.length;t<r;t++)null!==(e=this.m_PolyOuts[t]).Pts&&(e.IsOpen?this.FixupOutPolyline(e):this.FixupOutPolygon(e));return this.StrictlySimple&&this.DoSimplePolygons(),!0}finally{this.m_Joins.length=0,this.m_GhostJoins.length=0}},r.Clipper.prototype.DisposeAllPolyPts=function(){for(var e=0,t=this.m_PolyOuts.length;e<t;++e)this.DisposeOutRec(e);r.Clear(this.m_PolyOuts)},r.Clipper.prototype.AddJoin=function(e,t,i){var n=new r.Join;n.OutPt1=e,n.OutPt2=t,n.OffPt.X=i.X,n.OffPt.Y=i.Y,r.use_xyz&&(n.OffPt.Z=i.Z),this.m_Joins.push(n)},r.Clipper.prototype.AddGhostJoin=function(e,t){var i=new r.Join;i.OutPt1=e,i.OffPt.X=t.X,i.OffPt.Y=t.Y,r.use_xyz&&(i.OffPt.Z=t.Z),this.m_GhostJoins.push(i)},r.Clipper.prototype.SetZ=function(e,t,i){if(null!==this.ZFillFunction){if(0!==e.Z||null===this.ZFillFunction)return;r.IntPoint.op_Equality(e,t.Bot)?e.Z=t.Bot.Z:r.IntPoint.op_Equality(e,t.Top)?e.Z=t.Top.Z:r.IntPoint.op_Equality(e,i.Bot)?e.Z=i.Bot.Z:r.IntPoint.op_Equality(e,i.Top)?e.Z=i.Top.Z:this.ZFillFunction(t.Bot,t.Top,i.Bot,i.Top,e)}},r.Clipper.prototype.InsertLocalMinimaIntoAEL=function(e){for(var t,i,n={};this.PopLocalMinima(e,n);){t=n.v.LeftBound,i=n.v.RightBound;var a=null;if(null===t?(this.InsertEdgeIntoAEL(i,null),this.SetWindingCount(i),this.IsContributing(i)&&(a=this.AddOutPt(i,i.Bot))):null===i?(this.InsertEdgeIntoAEL(t,null),this.SetWindingCount(t),this.IsContributing(t)&&(a=this.AddOutPt(t,t.Bot)),this.InsertScanbeam(t.Top.Y)):(this.InsertEdgeIntoAEL(t,null),this.InsertEdgeIntoAEL(i,t),this.SetWindingCount(t),i.WindCnt=t.WindCnt,i.WindCnt2=t.WindCnt2,this.IsContributing(t)&&(a=this.AddLocalMinPoly(t,i,t.Bot)),this.InsertScanbeam(t.Top.Y)),null!==i&&(r.ClipperBase.IsHorizontal(i)?(null!==i.NextInLML&&this.InsertScanbeam(i.NextInLML.Top.Y),this.AddEdgeToSEL(i)):this.InsertScanbeam(i.Top.Y)),null!==t&&null!==i){if(null!==a&&r.ClipperBase.IsHorizontal(i)&&this.m_GhostJoins.length>0&&0!==i.WindDelta)for(var s=0,o=this.m_GhostJoins.length;s<o;s++){var l=this.m_GhostJoins[s];this.HorzSegmentsOverlap(l.OutPt1.Pt.X,l.OffPt.X,i.Bot.X,i.Top.X)&&this.AddJoin(l.OutPt1,a,l.OffPt)}if(t.OutIdx>=0&&null!==t.PrevInAEL&&t.PrevInAEL.Curr.X===t.Bot.X&&t.PrevInAEL.OutIdx>=0&&r.ClipperBase.SlopesEqual5(t.PrevInAEL.Curr,t.PrevInAEL.Top,t.Curr,t.Top,this.m_UseFullRange)&&0!==t.WindDelta&&0!==t.PrevInAEL.WindDelta){var h=this.AddOutPt(t.PrevInAEL,t.Bot);this.AddJoin(a,h,t.Top)}if(t.NextInAEL!==i){if(i.OutIdx>=0&&i.PrevInAEL.OutIdx>=0&&r.ClipperBase.SlopesEqual5(i.PrevInAEL.Curr,i.PrevInAEL.Top,i.Curr,i.Top,this.m_UseFullRange)&&0!==i.WindDelta&&0!==i.PrevInAEL.WindDelta){h=this.AddOutPt(i.PrevInAEL,i.Bot);this.AddJoin(a,h,i.Top)}var c=t.NextInAEL;if(null!==c)for(;c!==i;)this.IntersectEdges(i,c,t.Curr),c=c.NextInAEL}}}},r.Clipper.prototype.InsertEdgeIntoAEL=function(e,t){if(null===this.m_ActiveEdges)e.PrevInAEL=null,e.NextInAEL=null,this.m_ActiveEdges=e;else if(null===t&&this.E2InsertsBeforeE1(this.m_ActiveEdges,e))e.PrevInAEL=null,e.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges.PrevInAEL=e,this.m_ActiveEdges=e;else{for(null===t&&(t=this.m_ActiveEdges);null!==t.NextInAEL&&!this.E2InsertsBeforeE1(t.NextInAEL,e);)t=t.NextInAEL;e.NextInAEL=t.NextInAEL,null!==t.NextInAEL&&(t.NextInAEL.PrevInAEL=e),e.PrevInAEL=t,t.NextInAEL=e}},r.Clipper.prototype.E2InsertsBeforeE1=function(e,t){return t.Curr.X===e.Curr.X?t.Top.Y>e.Top.Y?t.Top.X<r.Clipper.TopX(e,t.Top.Y):e.Top.X>r.Clipper.TopX(t,e.Top.Y):t.Curr.X<e.Curr.X},r.Clipper.prototype.IsEvenOddFillType=function(e){return e.PolyTyp===r.PolyType.ptSubject?this.m_SubjFillType===r.PolyFillType.pftEvenOdd:this.m_ClipFillType===r.PolyFillType.pftEvenOdd},r.Clipper.prototype.IsEvenOddAltFillType=function(e){return e.PolyTyp===r.PolyType.ptSubject?this.m_ClipFillType===r.PolyFillType.pftEvenOdd:this.m_SubjFillType===r.PolyFillType.pftEvenOdd},r.Clipper.prototype.IsContributing=function(e){var t,i;switch(e.PolyTyp===r.PolyType.ptSubject?(t=this.m_SubjFillType,i=this.m_ClipFillType):(t=this.m_ClipFillType,i=this.m_SubjFillType),t){case r.PolyFillType.pftEvenOdd:if(0===e.WindDelta&&1!==e.WindCnt)return!1;break;case r.PolyFillType.pftNonZero:if(1!==Math.abs(e.WindCnt))return!1;break;case r.PolyFillType.pftPositive:if(1!==e.WindCnt)return!1;break;default:if(-1!==e.WindCnt)return!1}switch(this.m_ClipType){case r.ClipType.ctIntersection:switch(i){case r.PolyFillType.pftEvenOdd:case r.PolyFillType.pftNonZero:return 0!==e.WindCnt2;case r.PolyFillType.pftPositive:return e.WindCnt2>0;default:return e.WindCnt2<0}case r.ClipType.ctUnion:switch(i){case r.PolyFillType.pftEvenOdd:case r.PolyFillType.pftNonZero:return 0===e.WindCnt2;case r.PolyFillType.pftPositive:return e.WindCnt2<=0;default:return e.WindCnt2>=0}case r.ClipType.ctDifference:if(e.PolyTyp===r.PolyType.ptSubject)switch(i){case r.PolyFillType.pftEvenOdd:case r.PolyFillType.pftNonZero:return 0===e.WindCnt2;case r.PolyFillType.pftPositive:return e.WindCnt2<=0;default:return e.WindCnt2>=0}else switch(i){case r.PolyFillType.pftEvenOdd:case r.PolyFillType.pftNonZero:return 0!==e.WindCnt2;case r.PolyFillType.pftPositive:return e.WindCnt2>0;default:return e.WindCnt2<0}case r.ClipType.ctXor:if(0!==e.WindDelta)return!0;switch(i){case r.PolyFillType.pftEvenOdd:case r.PolyFillType.pftNonZero:return 0===e.WindCnt2;case r.PolyFillType.pftPositive:return e.WindCnt2<=0;default:return e.WindCnt2>=0}}return!0},r.Clipper.prototype.SetWindingCount=function(e){for(var t=e.PrevInAEL;null!==t&&(t.PolyTyp!==e.PolyTyp||0===t.WindDelta);)t=t.PrevInAEL;if(null===t){var i=e.PolyTyp===r.PolyType.ptSubject?this.m_SubjFillType:this.m_ClipFillType;0===e.WindDelta?e.WindCnt=i===r.PolyFillType.pftNegative?-1:1:e.WindCnt=e.WindDelta,e.WindCnt2=0,t=this.m_ActiveEdges}else if(0===e.WindDelta&&this.m_ClipType!==r.ClipType.ctUnion)e.WindCnt=1,e.WindCnt2=t.WindCnt2,t=t.NextInAEL;else if(this.IsEvenOddFillType(e)){if(0===e.WindDelta){for(var n=!0,a=t.PrevInAEL;null!==a;)a.PolyTyp===t.PolyTyp&&0!==a.WindDelta&&(n=!n),a=a.PrevInAEL;e.WindCnt=n?0:1}else e.WindCnt=e.WindDelta;e.WindCnt2=t.WindCnt2,t=t.NextInAEL}else t.WindCnt*t.WindDelta<0?Math.abs(t.WindCnt)>1?t.WindDelta*e.WindDelta<0?e.WindCnt=t.WindCnt:e.WindCnt=t.WindCnt+e.WindDelta:e.WindCnt=0===e.WindDelta?1:e.WindDelta:0===e.WindDelta?e.WindCnt=t.WindCnt<0?t.WindCnt-1:t.WindCnt+1:t.WindDelta*e.WindDelta<0?e.WindCnt=t.WindCnt:e.WindCnt=t.WindCnt+e.WindDelta,e.WindCnt2=t.WindCnt2,t=t.NextInAEL;if(this.IsEvenOddAltFillType(e))for(;t!==e;)0!==t.WindDelta&&(e.WindCnt2=0===e.WindCnt2?1:0),t=t.NextInAEL;else for(;t!==e;)e.WindCnt2+=t.WindDelta,t=t.NextInAEL},r.Clipper.prototype.AddEdgeToSEL=function(e){null===this.m_SortedEdges?(this.m_SortedEdges=e,e.PrevInSEL=null,e.NextInSEL=null):(e.NextInSEL=this.m_SortedEdges,e.PrevInSEL=null,this.m_SortedEdges.PrevInSEL=e,this.m_SortedEdges=e)},r.Clipper.prototype.PopEdgeFromSEL=function(e){if(e.v=this.m_SortedEdges,null===e.v)return!1;var t=e.v;return this.m_SortedEdges=e.v.NextInSEL,null!==this.m_SortedEdges&&(this.m_SortedEdges.PrevInSEL=null),t.NextInSEL=null,t.PrevInSEL=null,!0},r.Clipper.prototype.CopyAELToSEL=function(){var e=this.m_ActiveEdges;for(this.m_SortedEdges=e;null!==e;)e.PrevInSEL=e.PrevInAEL,e.NextInSEL=e.NextInAEL,e=e.NextInAEL},r.Clipper.prototype.SwapPositionsInSEL=function(e,t){if(!(null===e.NextInSEL&&null===e.PrevInSEL||null===t.NextInSEL&&null===t.PrevInSEL)){if(e.NextInSEL===t)null!==(r=t.NextInSEL)&&(r.PrevInSEL=e),null!==(i=e.PrevInSEL)&&(i.NextInSEL=t),t.PrevInSEL=i,t.NextInSEL=e,e.PrevInSEL=t,e.NextInSEL=r;else if(t.NextInSEL===e){null!==(r=e.NextInSEL)&&(r.PrevInSEL=t),null!==(i=t.PrevInSEL)&&(i.NextInSEL=e),e.PrevInSEL=i,e.NextInSEL=t,t.PrevInSEL=e,t.NextInSEL=r}else{var r=e.NextInSEL,i=e.PrevInSEL;e.NextInSEL=t.NextInSEL,null!==e.NextInSEL&&(e.NextInSEL.PrevInSEL=e),e.PrevInSEL=t.PrevInSEL,null!==e.PrevInSEL&&(e.PrevInSEL.NextInSEL=e),t.NextInSEL=r,null!==t.NextInSEL&&(t.NextInSEL.PrevInSEL=t),t.PrevInSEL=i,null!==t.PrevInSEL&&(t.PrevInSEL.NextInSEL=t)}null===e.PrevInSEL?this.m_SortedEdges=e:null===t.PrevInSEL&&(this.m_SortedEdges=t)}},r.Clipper.prototype.AddLocalMaxPoly=function(e,t,r){this.AddOutPt(e,r),0===t.WindDelta&&this.AddOutPt(t,r),e.OutIdx===t.OutIdx?(e.OutIdx=-1,t.OutIdx=-1):e.OutIdx<t.OutIdx?this.AppendPolygon(e,t):this.AppendPolygon(t,e)},r.Clipper.prototype.AddLocalMinPoly=function(e,t,i){var n,a,s;if(r.ClipperBase.IsHorizontal(t)||e.Dx>t.Dx?(n=this.AddOutPt(e,i),t.OutIdx=e.OutIdx,e.Side=r.EdgeSide.esLeft,t.Side=r.EdgeSide.esRight,s=(a=e).PrevInAEL===t?t.PrevInAEL:a.PrevInAEL):(n=this.AddOutPt(t,i),e.OutIdx=t.OutIdx,e.Side=r.EdgeSide.esRight,t.Side=r.EdgeSide.esLeft,s=(a=t).PrevInAEL===e?e.PrevInAEL:a.PrevInAEL),null!==s&&s.OutIdx>=0&&s.Top.Y<i.Y&&a.Top.Y<i.Y){var o=r.Clipper.TopX(s,i.Y),l=r.Clipper.TopX(a,i.Y);if(o===l&&0!==a.WindDelta&&0!==s.WindDelta&&r.ClipperBase.SlopesEqual5(new r.IntPoint2(o,i.Y),s.Top,new r.IntPoint2(l,i.Y),a.Top,this.m_UseFullRange)){var h=this.AddOutPt(s,i);this.AddJoin(n,h,a.Top)}}return n},r.Clipper.prototype.AddOutPt=function(e,t){if(e.OutIdx<0){(n=this.CreateOutRec()).IsOpen=0===e.WindDelta;var i=new r.OutPt;return n.Pts=i,i.Idx=n.Idx,i.Pt.X=t.X,i.Pt.Y=t.Y,r.use_xyz&&(i.Pt.Z=t.Z),i.Next=i,i.Prev=i,n.IsOpen||this.SetHoleState(e,n),e.OutIdx=n.Idx,i}var n,a=(n=this.m_PolyOuts[e.OutIdx]).Pts,s=e.Side===r.EdgeSide.esLeft;return s&&r.IntPoint.op_Equality(t,a.Pt)?a:!s&&r.IntPoint.op_Equality(t,a.Prev.Pt)?a.Prev:((i=new r.OutPt).Idx=n.Idx,i.Pt.X=t.X,i.Pt.Y=t.Y,r.use_xyz&&(i.Pt.Z=t.Z),i.Next=a,i.Prev=a.Prev,i.Prev.Next=i,a.Prev=i,s&&(n.Pts=i),i)},r.Clipper.prototype.GetLastOutPt=function(e){var t=this.m_PolyOuts[e.OutIdx];return e.Side===r.EdgeSide.esLeft?t.Pts:t.Pts.Prev},r.Clipper.prototype.SwapPoints=function(e,t){var i=new r.IntPoint1(e.Value);e.Value.X=t.Value.X,e.Value.Y=t.Value.Y,r.use_xyz&&(e.Value.Z=t.Value.Z),t.Value.X=i.X,t.Value.Y=i.Y,r.use_xyz&&(t.Value.Z=i.Z)},r.Clipper.prototype.HorzSegmentsOverlap=function(e,t,r,i){var n;return e>t&&(n=e,e=t,t=n),r>i&&(n=r,r=i,i=n),e<i&&r<t},r.Clipper.prototype.SetHoleState=function(e,t){for(var r=e.PrevInAEL,i=null;null!==r;)r.OutIdx>=0&&0!==r.WindDelta&&(null===i?i=r:i.OutIdx===r.OutIdx&&(i=null)),r=r.PrevInAEL;null===i?(t.FirstLeft=null,t.IsHole=!1):(t.FirstLeft=this.m_PolyOuts[i.OutIdx],t.IsHole=!t.FirstLeft.IsHole)},r.Clipper.prototype.GetDx=function(e,t){return e.Y===t.Y?r.ClipperBase.horizontal:(t.X-e.X)/(t.Y-e.Y)},r.Clipper.prototype.FirstIsBottomPt=function(e,t){for(var i=e.Prev;r.IntPoint.op_Equality(i.Pt,e.Pt)&&i!==e;)i=i.Prev;var n=Math.abs(this.GetDx(e.Pt,i.Pt));for(i=e.Next;r.IntPoint.op_Equality(i.Pt,e.Pt)&&i!==e;)i=i.Next;var a=Math.abs(this.GetDx(e.Pt,i.Pt));for(i=t.Prev;r.IntPoint.op_Equality(i.Pt,t.Pt)&&i!==t;)i=i.Prev;var s=Math.abs(this.GetDx(t.Pt,i.Pt));for(i=t.Next;r.IntPoint.op_Equality(i.Pt,t.Pt)&&i!==t;)i=i.Next;var o=Math.abs(this.GetDx(t.Pt,i.Pt));return Math.max(n,a)===Math.max(s,o)&&Math.min(n,a)===Math.min(s,o)?this.Area(e)>0:n>=s&&n>=o||a>=s&&a>=o},r.Clipper.prototype.GetBottomPt=function(e){for(var t=null,i=e.Next;i!==e;)i.Pt.Y>e.Pt.Y?(e=i,t=null):i.Pt.Y===e.Pt.Y&&i.Pt.X<=e.Pt.X&&(i.Pt.X<e.Pt.X?(t=null,e=i):i.Next!==e&&i.Prev!==e&&(t=i)),i=i.Next;if(null!==t)for(;t!==i;)for(this.FirstIsBottomPt(i,t)||(e=t),t=t.Next;r.IntPoint.op_Inequality(t.Pt,e.Pt);)t=t.Next;return e},r.Clipper.prototype.GetLowermostRec=function(e,t){null===e.BottomPt&&(e.BottomPt=this.GetBottomPt(e.Pts)),null===t.BottomPt&&(t.BottomPt=this.GetBottomPt(t.Pts));var r=e.BottomPt,i=t.BottomPt;return r.Pt.Y>i.Pt.Y?e:r.Pt.Y<i.Pt.Y?t:r.Pt.X<i.Pt.X?e:r.Pt.X>i.Pt.X||r.Next===r?t:i.Next===i||this.FirstIsBottomPt(r,i)?e:t},r.Clipper.prototype.OutRec1RightOfOutRec2=function(e,t){do{if((e=e.FirstLeft)===t)return!0}while(null!==e);return!1},r.Clipper.prototype.GetOutRec=function(e){for(var t=this.m_PolyOuts[e];t!==this.m_PolyOuts[t.Idx];)t=this.m_PolyOuts[t.Idx];return t},r.Clipper.prototype.AppendPolygon=function(e,t){var i,n=this.m_PolyOuts[e.OutIdx],a=this.m_PolyOuts[t.OutIdx];i=this.OutRec1RightOfOutRec2(n,a)?a:this.OutRec1RightOfOutRec2(a,n)?n:this.GetLowermostRec(n,a);var s=n.Pts,o=s.Prev,l=a.Pts,h=l.Prev;e.Side===r.EdgeSide.esLeft?t.Side===r.EdgeSide.esLeft?(this.ReversePolyPtLinks(l),l.Next=s,s.Prev=l,o.Next=h,h.Prev=o,n.Pts=h):(h.Next=s,s.Prev=h,l.Prev=o,o.Next=l,n.Pts=l):t.Side===r.EdgeSide.esRight?(this.ReversePolyPtLinks(l),o.Next=h,h.Prev=o,l.Next=s,s.Prev=l):(o.Next=l,l.Prev=o,s.Prev=h,h.Next=s),n.BottomPt=null,i===a&&(a.FirstLeft!==n&&(n.FirstLeft=a.FirstLeft),n.IsHole=a.IsHole),a.Pts=null,a.BottomPt=null,a.FirstLeft=n;var c=e.OutIdx,u=t.OutIdx;e.OutIdx=-1,t.OutIdx=-1;for(var d=this.m_ActiveEdges;null!==d;){if(d.OutIdx===u){d.OutIdx=c,d.Side=e.Side;break}d=d.NextInAEL}a.Idx=n.Idx},r.Clipper.prototype.ReversePolyPtLinks=function(e){if(null!==e){var t,r;t=e;do{r=t.Next,t.Next=t.Prev,t.Prev=r,t=r}while(t!==e)}},r.Clipper.SwapSides=function(e,t){var r=e.Side;e.Side=t.Side,t.Side=r},r.Clipper.SwapPolyIndexes=function(e,t){var r=e.OutIdx;e.OutIdx=t.OutIdx,t.OutIdx=r},r.Clipper.prototype.IntersectEdges=function(e,t,i){var n=e.OutIdx>=0,a=t.OutIdx>=0;if(r.use_xyz&&this.SetZ(i,e,t),!r.use_lines||0!==e.WindDelta&&0!==t.WindDelta){if(e.PolyTyp===t.PolyTyp)if(this.IsEvenOddFillType(e)){var s=e.WindCnt;e.WindCnt=t.WindCnt,t.WindCnt=s}else e.WindCnt+t.WindDelta===0?e.WindCnt=-e.WindCnt:e.WindCnt+=t.WindDelta,t.WindCnt-e.WindDelta==0?t.WindCnt=-t.WindCnt:t.WindCnt-=e.WindDelta;else this.IsEvenOddFillType(t)?e.WindCnt2=0===e.WindCnt2?1:0:e.WindCnt2+=t.WindDelta,this.IsEvenOddFillType(e)?t.WindCnt2=0===t.WindCnt2?1:0:t.WindCnt2-=e.WindDelta;var o,l,h,c,u,d;switch(e.PolyTyp===r.PolyType.ptSubject?(o=this.m_SubjFillType,h=this.m_ClipFillType):(o=this.m_ClipFillType,h=this.m_SubjFillType),t.PolyTyp===r.PolyType.ptSubject?(l=this.m_SubjFillType,c=this.m_ClipFillType):(l=this.m_ClipFillType,c=this.m_SubjFillType),o){case r.PolyFillType.pftPositive:u=e.WindCnt;break;case r.PolyFillType.pftNegative:u=-e.WindCnt;break;default:u=Math.abs(e.WindCnt)}switch(l){case r.PolyFillType.pftPositive:d=t.WindCnt;break;case r.PolyFillType.pftNegative:d=-t.WindCnt;break;default:d=Math.abs(t.WindCnt)}if(n&&a)0!==u&&1!==u||0!==d&&1!==d||e.PolyTyp!==t.PolyTyp&&this.m_ClipType!==r.ClipType.ctXor?this.AddLocalMaxPoly(e,t,i):(this.AddOutPt(e,i),this.AddOutPt(t,i),r.Clipper.SwapSides(e,t),r.Clipper.SwapPolyIndexes(e,t));else if(n)(0===d||1===d)&&(this.AddOutPt(e,i),r.Clipper.SwapSides(e,t),r.Clipper.SwapPolyIndexes(e,t));else if(a)(0===u||1===u)&&(this.AddOutPt(t,i),r.Clipper.SwapSides(e,t),r.Clipper.SwapPolyIndexes(e,t));else if(!(0!==u&&1!==u||0!==d&&1!==d)){var p,f;switch(h){case r.PolyFillType.pftPositive:p=e.WindCnt2;break;case r.PolyFillType.pftNegative:p=-e.WindCnt2;break;default:p=Math.abs(e.WindCnt2)}switch(c){case r.PolyFillType.pftPositive:f=t.WindCnt2;break;case r.PolyFillType.pftNegative:f=-t.WindCnt2;break;default:f=Math.abs(t.WindCnt2)}if(e.PolyTyp!==t.PolyTyp)this.AddLocalMinPoly(e,t,i);else if(1===u&&1===d)switch(this.m_ClipType){case r.ClipType.ctIntersection:p>0&&f>0&&this.AddLocalMinPoly(e,t,i);break;case r.ClipType.ctUnion:p<=0&&f<=0&&this.AddLocalMinPoly(e,t,i);break;case r.ClipType.ctDifference:(e.PolyTyp===r.PolyType.ptClip&&p>0&&f>0||e.PolyTyp===r.PolyType.ptSubject&&p<=0&&f<=0)&&this.AddLocalMinPoly(e,t,i);break;case r.ClipType.ctXor:this.AddLocalMinPoly(e,t,i)}else r.Clipper.SwapSides(e,t)}}else{if(0===e.WindDelta&&0===t.WindDelta)return;e.PolyTyp===t.PolyTyp&&e.WindDelta!==t.WindDelta&&this.m_ClipType===r.ClipType.ctUnion?0===e.WindDelta?a&&(this.AddOutPt(e,i),n&&(e.OutIdx=-1)):n&&(this.AddOutPt(t,i),a&&(t.OutIdx=-1)):e.PolyTyp!==t.PolyTyp&&(0!==e.WindDelta||1!==Math.abs(t.WindCnt)||this.m_ClipType===r.ClipType.ctUnion&&0!==t.WindCnt2?0===t.WindDelta&&1===Math.abs(e.WindCnt)&&(this.m_ClipType!==r.ClipType.ctUnion||0===e.WindCnt2)&&(this.AddOutPt(t,i),a&&(t.OutIdx=-1)):(this.AddOutPt(e,i),n&&(e.OutIdx=-1)))}},r.Clipper.prototype.DeleteFromSEL=function(e){var t=e.PrevInSEL,r=e.NextInSEL;null===t&&null===r&&e!==this.m_SortedEdges||(null!==t?t.NextInSEL=r:this.m_SortedEdges=r,null!==r&&(r.PrevInSEL=t),e.NextInSEL=null,e.PrevInSEL=null)},r.Clipper.prototype.ProcessHorizontals=function(){for(var e={};this.PopEdgeFromSEL(e);)this.ProcessHorizontal(e.v)},r.Clipper.prototype.GetHorzDirection=function(e,t){e.Bot.X<e.Top.X?(t.Left=e.Bot.X,t.Right=e.Top.X,t.Dir=r.Direction.dLeftToRight):(t.Left=e.Top.X,t.Right=e.Bot.X,t.Dir=r.Direction.dRightToLeft)},r.Clipper.prototype.ProcessHorizontal=function(e){var t={Dir:null,Left:null,Right:null};this.GetHorzDirection(e,t);for(var i=t.Dir,n=t.Left,a=t.Right,s=0===e.WindDelta,o=e,l=null;null!==o.NextInLML&&r.ClipperBase.IsHorizontal(o.NextInLML);)o=o.NextInLML;null===o.NextInLML&&(l=this.GetMaximaPair(o));var h=this.m_Maxima;if(null!==h)if(i===r.Direction.dLeftToRight){for(;null!==h&&h.X<=e.Bot.X;)h=h.Next;null!==h&&h.X>=o.Top.X&&(h=null)}else{for(;null!==h.Next&&h.Next.X<e.Bot.X;)h=h.Next;h.X<=o.Top.X&&(h=null)}for(var c=null;;){for(var u=e===o,d=this.GetNextInAEL(e,i);null!==d;){if(null!==h)if(i===r.Direction.dLeftToRight)for(;null!==h&&h.X<d.Curr.X;)e.OutIdx>=0&&!s&&this.AddOutPt(e,new r.IntPoint2(h.X,e.Bot.Y)),h=h.Next;else for(;null!==h&&h.X>d.Curr.X;)e.OutIdx>=0&&!s&&this.AddOutPt(e,new r.IntPoint2(h.X,e.Bot.Y)),h=h.Prev;if(i===r.Direction.dLeftToRight&&d.Curr.X>a||i===r.Direction.dRightToLeft&&d.Curr.X<n||d.Curr.X===e.Top.X&&null!==e.NextInLML&&d.Dx<e.NextInLML.Dx)break;if(e.OutIdx>=0&&!s){r.use_xyz&&(i===r.Direction.dLeftToRight?this.SetZ(d.Curr,e,d):this.SetZ(d.Curr,d,e)),c=this.AddOutPt(e,d.Curr);for(var p=this.m_SortedEdges;null!==p;){if(p.OutIdx>=0&&this.HorzSegmentsOverlap(e.Bot.X,e.Top.X,p.Bot.X,p.Top.X)){var f=this.GetLastOutPt(p);this.AddJoin(f,c,p.Top)}p=p.NextInSEL}this.AddGhostJoin(c,e.Bot)}if(d===l&&u)return e.OutIdx>=0&&this.AddLocalMaxPoly(e,l,e.Top),this.DeleteFromAEL(e),void this.DeleteFromAEL(l);if(i===r.Direction.dLeftToRight){var m=new r.IntPoint2(d.Curr.X,e.Curr.Y);this.IntersectEdges(e,d,m)}else{m=new r.IntPoint2(d.Curr.X,e.Curr.Y);this.IntersectEdges(d,e,m)}var g=this.GetNextInAEL(d,i);this.SwapPositionsInAEL(e,d),d=g}if(null===e.NextInLML||!r.ClipperBase.IsHorizontal(e.NextInLML))break;(e=this.UpdateEdgeIntoAEL(e)).OutIdx>=0&&this.AddOutPt(e,e.Bot),t={Dir:i,Left:n,Right:a},this.GetHorzDirection(e,t),i=t.Dir,n=t.Left,a=t.Right}if(e.OutIdx>=0&&null===c){c=this.GetLastOutPt(e);for(p=this.m_SortedEdges;null!==p;){if(p.OutIdx>=0&&this.HorzSegmentsOverlap(e.Bot.X,e.Top.X,p.Bot.X,p.Top.X)){f=this.GetLastOutPt(p);this.AddJoin(f,c,p.Top)}p=p.NextInSEL}this.AddGhostJoin(c,e.Top)}if(null!==e.NextInLML)if(e.OutIdx>=0){if(c=this.AddOutPt(e,e.Top),0===(e=this.UpdateEdgeIntoAEL(e)).WindDelta)return;var v=e.PrevInAEL;g=e.NextInAEL;if(null!==v&&v.Curr.X===e.Bot.X&&v.Curr.Y===e.Bot.Y&&0===v.WindDelta&&v.OutIdx>=0&&v.Curr.Y>v.Top.Y&&r.ClipperBase.SlopesEqual3(e,v,this.m_UseFullRange)){f=this.AddOutPt(v,e.Bot);this.AddJoin(c,f,e.Top)}else if(null!==g&&g.Curr.X===e.Bot.X&&g.Curr.Y===e.Bot.Y&&0!==g.WindDelta&&g.OutIdx>=0&&g.Curr.Y>g.Top.Y&&r.ClipperBase.SlopesEqual3(e,g,this.m_UseFullRange)){f=this.AddOutPt(g,e.Bot);this.AddJoin(c,f,e.Top)}}else e=this.UpdateEdgeIntoAEL(e);else e.OutIdx>=0&&this.AddOutPt(e,e.Top),this.DeleteFromAEL(e)},r.Clipper.prototype.GetNextInAEL=function(e,t){return t===r.Direction.dLeftToRight?e.NextInAEL:e.PrevInAEL},r.Clipper.prototype.IsMinima=function(e){return null!==e&&e.Prev.NextInLML!==e&&e.Next.NextInLML!==e},r.Clipper.prototype.IsMaxima=function(e,t){return null!==e&&e.Top.Y===t&&null===e.NextInLML},r.Clipper.prototype.IsIntermediate=function(e,t){return e.Top.Y===t&&null!==e.NextInLML},r.Clipper.prototype.GetMaximaPair=function(e){return r.IntPoint.op_Equality(e.Next.Top,e.Top)&&null===e.Next.NextInLML?e.Next:r.IntPoint.op_Equality(e.Prev.Top,e.Top)&&null===e.Prev.NextInLML?e.Prev:null},r.Clipper.prototype.GetMaximaPairEx=function(e){var t=this.GetMaximaPair(e);return null===t||t.OutIdx===r.ClipperBase.Skip||t.NextInAEL===t.PrevInAEL&&!r.ClipperBase.IsHorizontal(t)?null:t},r.Clipper.prototype.ProcessIntersections=function(e){if(null===this.m_ActiveEdges)return!0;try{if(this.BuildIntersectList(e),0===this.m_IntersectList.length)return!0;if(1!==this.m_IntersectList.length&&!this.FixupIntersectionOrder())return!1;this.ProcessIntersectList()}catch(e){this.m_SortedEdges=null,this.m_IntersectList.length=0,r.Error("ProcessIntersections error")}return this.m_SortedEdges=null,!0},r.Clipper.prototype.BuildIntersectList=function(e){if(null!==this.m_ActiveEdges){var t=this.m_ActiveEdges;for(this.m_SortedEdges=t;null!==t;)t.PrevInSEL=t.PrevInAEL,t.NextInSEL=t.NextInAEL,t.Curr.X=r.Clipper.TopX(t,e),t=t.NextInAEL;for(var i=!0;i&&null!==this.m_SortedEdges;){for(i=!1,t=this.m_SortedEdges;null!==t.NextInSEL;){var n=t.NextInSEL,a=new r.IntPoint0;if(t.Curr.X>n.Curr.X){this.IntersectPoint(t,n,a),a.Y<e&&(a=new r.IntPoint2(r.Clipper.TopX(t,e),e));var s=new r.IntersectNode;s.Edge1=t,s.Edge2=n,s.Pt.X=a.X,s.Pt.Y=a.Y,r.use_xyz&&(s.Pt.Z=a.Z),this.m_IntersectList.push(s),this.SwapPositionsInSEL(t,n),i=!0}else t=n}if(null===t.PrevInSEL)break;t.PrevInSEL.NextInSEL=null}this.m_SortedEdges=null}},r.Clipper.prototype.EdgesAdjacent=function(e){return e.Edge1.NextInSEL===e.Edge2||e.Edge1.PrevInSEL===e.Edge2},r.Clipper.IntersectNodeSort=function(e,t){return t.Pt.Y-e.Pt.Y},r.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer),this.CopyAELToSEL();for(var e=this.m_IntersectList.length,t=0;t<e;t++){if(!this.EdgesAdjacent(this.m_IntersectList[t])){for(var r=t+1;r<e&&!this.EdgesAdjacent(this.m_IntersectList[r]);)r++;if(r===e)return!1;var i=this.m_IntersectList[t];this.m_IntersectList[t]=this.m_IntersectList[r],this.m_IntersectList[r]=i}this.SwapPositionsInSEL(this.m_IntersectList[t].Edge1,this.m_IntersectList[t].Edge2)}return!0},r.Clipper.prototype.ProcessIntersectList=function(){for(var e=0,t=this.m_IntersectList.length;e<t;e++){var r=this.m_IntersectList[e];this.IntersectEdges(r.Edge1,r.Edge2,r.Pt),this.SwapPositionsInAEL(r.Edge1,r.Edge2)}this.m_IntersectList.length=0};a.msie?r.Clipper.Round=function(e){return e<0?Math.ceil(e-.5):Math.round(e)}:a.chromium?r.Clipper.Round=function(e){return e<0?-Math.round(Math.abs(e)):Math.round(e)}:a.safari?r.Clipper.Round=function(e){return e<0?(e-=.5)<-2147483648?Math.ceil(e):0|e:(e+=.5)>2147483647?Math.floor(e):0|e}:r.Clipper.Round=function(e){return e<0?Math.ceil(e-.5):Math.floor(e+.5)},r.Clipper.TopX=function(e,t){return t===e.Top.Y?e.Top.X:e.Bot.X+r.Clipper.Round(e.Dx*(t-e.Bot.Y))},r.Clipper.prototype.IntersectPoint=function(e,t,i){var n,a;if(i.X=0,i.Y=0,e.Dx===t.Dx)return i.Y=e.Curr.Y,void(i.X=r.Clipper.TopX(e,i.Y));if(0===e.Delta.X)i.X=e.Bot.X,r.ClipperBase.IsHorizontal(t)?i.Y=t.Bot.Y:(a=t.Bot.Y-t.Bot.X/t.Dx,i.Y=r.Clipper.Round(i.X/t.Dx+a));else if(0===t.Delta.X)i.X=t.Bot.X,r.ClipperBase.IsHorizontal(e)?i.Y=e.Bot.Y:(n=e.Bot.Y-e.Bot.X/e.Dx,i.Y=r.Clipper.Round(i.X/e.Dx+n));else{n=e.Bot.X-e.Bot.Y*e.Dx;var s=((a=t.Bot.X-t.Bot.Y*t.Dx)-n)/(e.Dx-t.Dx);i.Y=r.Clipper.Round(s),Math.abs(e.Dx)<Math.abs(t.Dx)?i.X=r.Clipper.Round(e.Dx*s+n):i.X=r.Clipper.Round(t.Dx*s+a)}if(i.Y<e.Top.Y||i.Y<t.Top.Y){if(e.Top.Y>t.Top.Y)return i.Y=e.Top.Y,i.X=r.Clipper.TopX(t,e.Top.Y),i.X<e.Top.X;i.Y=t.Top.Y,Math.abs(e.Dx)<Math.abs(t.Dx)?i.X=r.Clipper.TopX(e,i.Y):i.X=r.Clipper.TopX(t,i.Y)}i.Y>e.Curr.Y&&(i.Y=e.Curr.Y,Math.abs(e.Dx)>Math.abs(t.Dx)?i.X=r.Clipper.TopX(t,i.Y):i.X=r.Clipper.TopX(e,i.Y))},r.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(e){for(var t=this.m_ActiveEdges;null!==t;){var i=this.IsMaxima(t,e);if(i){var n=this.GetMaximaPairEx(t);i=null===n||!r.ClipperBase.IsHorizontal(n)}if(i){this.StrictlySimple&&this.InsertMaxima(t.Top.X);var a=t.PrevInAEL;this.DoMaxima(t),t=null===a?this.m_ActiveEdges:a.NextInAEL}else{if(this.IsIntermediate(t,e)&&r.ClipperBase.IsHorizontal(t.NextInLML)?((t=this.UpdateEdgeIntoAEL(t)).OutIdx>=0&&this.AddOutPt(t,t.Bot),this.AddEdgeToSEL(t)):(t.Curr.X=r.Clipper.TopX(t,e),t.Curr.Y=e),r.use_xyz&&(t.Top.Y===e?t.Curr.Z=t.Top.Z:t.Bot.Y===e?t.Curr.Z=t.Bot.Z:t.Curr.Z=0),this.StrictlySimple){a=t.PrevInAEL;if(t.OutIdx>=0&&0!==t.WindDelta&&null!==a&&a.OutIdx>=0&&a.Curr.X===t.Curr.X&&0!==a.WindDelta){var s=new r.IntPoint1(t.Curr);r.use_xyz&&this.SetZ(s,a,t);var o=this.AddOutPt(a,s),l=this.AddOutPt(t,s);this.AddJoin(o,l,s)}}t=t.NextInAEL}}for(this.ProcessHorizontals(),this.m_Maxima=null,t=this.m_ActiveEdges;null!==t;){if(this.IsIntermediate(t,e)){o=null;t.OutIdx>=0&&(o=this.AddOutPt(t,t.Top));a=(t=this.UpdateEdgeIntoAEL(t)).PrevInAEL;var h=t.NextInAEL;if(null!==a&&a.Curr.X===t.Bot.X&&a.Curr.Y===t.Bot.Y&&null!==o&&a.OutIdx>=0&&a.Curr.Y===a.Top.Y&&r.ClipperBase.SlopesEqual5(t.Curr,t.Top,a.Curr,a.Top,this.m_UseFullRange)&&0!==t.WindDelta&&0!==a.WindDelta){l=this.AddOutPt(ePrev2,t.Bot);this.AddJoin(o,l,t.Top)}else if(null!==h&&h.Curr.X===t.Bot.X&&h.Curr.Y===t.Bot.Y&&null!==o&&h.OutIdx>=0&&h.Curr.Y===h.Top.Y&&r.ClipperBase.SlopesEqual5(t.Curr,t.Top,h.Curr,h.Top,this.m_UseFullRange)&&0!==t.WindDelta&&0!==h.WindDelta){l=this.AddOutPt(h,t.Bot);this.AddJoin(o,l,t.Top)}}t=t.NextInAEL}},r.Clipper.prototype.DoMaxima=function(e){var t=this.GetMaximaPairEx(e);if(null===t)return e.OutIdx>=0&&this.AddOutPt(e,e.Top),void this.DeleteFromAEL(e);for(var i=e.NextInAEL;null!==i&&i!==t;)this.IntersectEdges(e,i,e.Top),this.SwapPositionsInAEL(e,i),i=e.NextInAEL;-1===e.OutIdx&&-1===t.OutIdx?(this.DeleteFromAEL(e),this.DeleteFromAEL(t)):e.OutIdx>=0&&t.OutIdx>=0?(e.OutIdx>=0&&this.AddLocalMaxPoly(e,t,e.Top),this.DeleteFromAEL(e),this.DeleteFromAEL(t)):r.use_lines&&0===e.WindDelta?(e.OutIdx>=0&&(this.AddOutPt(e,e.Top),e.OutIdx=r.ClipperBase.Unassigned),this.DeleteFromAEL(e),t.OutIdx>=0&&(this.AddOutPt(t,e.Top),t.OutIdx=r.ClipperBase.Unassigned),this.DeleteFromAEL(t)):r.Error("DoMaxima error")},r.Clipper.ReversePaths=function(e){for(var t=0,r=e.length;t<r;t++)e[t].reverse()},r.Clipper.Orientation=function(e){return r.Clipper.Area(e)>=0},r.Clipper.prototype.PointCount=function(e){if(null===e)return 0;var t=0,r=e;do{t++,r=r.Next}while(r!==e);return t},r.Clipper.prototype.BuildResult=function(e){r.Clear(e);for(var t=0,i=this.m_PolyOuts.length;t<i;t++){var n=this.m_PolyOuts[t];if(null!==n.Pts){var a=n.Pts.Prev,s=this.PointCount(a);if(!(s<2)){for(var o=new Array(s),l=0;l<s;l++)o[l]=a.Pt,a=a.Prev;e.push(o)}}}},r.Clipper.prototype.BuildResult2=function(e){e.Clear();for(var t=0,i=this.m_PolyOuts.length;t<i;t++){var n=this.m_PolyOuts[t],a=this.PointCount(n.Pts);if(!(n.IsOpen&&a<2||!n.IsOpen&&a<3)){this.FixHoleLinkage(n);var s=new r.PolyNode;e.m_AllPolys.push(s),n.PolyNode=s,s.m_polygon.length=a;for(var o=n.Pts.Prev,l=0;l<a;l++)s.m_polygon[l]=o.Pt,o=o.Prev}}for(t=0,i=this.m_PolyOuts.length;t<i;t++){null!==(n=this.m_PolyOuts[t]).PolyNode&&(n.IsOpen?(n.PolyNode.IsOpen=!0,e.AddChild(n.PolyNode)):null!==n.FirstLeft&&null!==n.FirstLeft.PolyNode?n.FirstLeft.PolyNode.AddChild(n.PolyNode):e.AddChild(n.PolyNode))}},r.Clipper.prototype.FixupOutPolyline=function(e){for(var t=e.Pts,i=t.Prev;t!==i;)if(t=t.Next,r.IntPoint.op_Equality(t.Pt,t.Prev.Pt)){t===i&&(i=t.Prev);var n=t.Prev;n.Next=t.Next,t.Next.Prev=n,t=n}t===t.Prev&&(e.Pts=null)},r.Clipper.prototype.FixupOutPolygon=function(e){var t=null;e.BottomPt=null;for(var i=e.Pts,n=this.PreserveCollinear||this.StrictlySimple;;){if(i.Prev===i||i.Prev===i.Next)return void(e.Pts=null);if(r.IntPoint.op_Equality(i.Pt,i.Next.Pt)||r.IntPoint.op_Equality(i.Pt,i.Prev.Pt)||r.ClipperBase.SlopesEqual4(i.Prev.Pt,i.Pt,i.Next.Pt,this.m_UseFullRange)&&(!n||!this.Pt2IsBetweenPt1AndPt3(i.Prev.Pt,i.Pt,i.Next.Pt)))t=null,i.Prev.Next=i.Next,i.Next.Prev=i.Prev,i=i.Prev;else{if(i===t)break;null===t&&(t=i),i=i.Next}}e.Pts=i},r.Clipper.prototype.DupOutPt=function(e,t){var i=new r.OutPt;return i.Pt.X=e.Pt.X,i.Pt.Y=e.Pt.Y,r.use_xyz&&(i.Pt.Z=e.Pt.Z),i.Idx=e.Idx,t?(i.Next=e.Next,i.Prev=e,e.Next.Prev=i,e.Next=i):(i.Prev=e.Prev,i.Next=e,e.Prev.Next=i,e.Prev=i),i},r.Clipper.prototype.GetOverlap=function(e,t,r,i,n){return e<t?r<i?(n.Left=Math.max(e,r),n.Right=Math.min(t,i)):(n.Left=Math.max(e,i),n.Right=Math.min(t,r)):r<i?(n.Left=Math.max(t,r),n.Right=Math.min(e,i)):(n.Left=Math.max(t,i),n.Right=Math.min(e,r)),n.Left<n.Right},r.Clipper.prototype.JoinHorz=function(e,t,i,n,a,s){var o=e.Pt.X>t.Pt.X?r.Direction.dRightToLeft:r.Direction.dLeftToRight,l=i.Pt.X>n.Pt.X?r.Direction.dRightToLeft:r.Direction.dLeftToRight;if(o===l)return!1;if(o===r.Direction.dLeftToRight){for(;e.Next.Pt.X<=a.X&&e.Next.Pt.X>=e.Pt.X&&e.Next.Pt.Y===a.Y;)e=e.Next;s&&e.Pt.X!==a.X&&(e=e.Next),t=this.DupOutPt(e,!s),r.IntPoint.op_Inequality(t.Pt,a)&&((e=t).Pt.X=a.X,e.Pt.Y=a.Y,r.use_xyz&&(e.Pt.Z=a.Z),t=this.DupOutPt(e,!s))}else{for(;e.Next.Pt.X>=a.X&&e.Next.Pt.X<=e.Pt.X&&e.Next.Pt.Y===a.Y;)e=e.Next;!s&&e.Pt.X!==a.X&&(e=e.Next),t=this.DupOutPt(e,s),r.IntPoint.op_Inequality(t.Pt,a)&&((e=t).Pt.X=a.X,e.Pt.Y=a.Y,r.use_xyz&&(e.Pt.Z=a.Z),t=this.DupOutPt(e,s))}if(l===r.Direction.dLeftToRight){for(;i.Next.Pt.X<=a.X&&i.Next.Pt.X>=i.Pt.X&&i.Next.Pt.Y===a.Y;)i=i.Next;s&&i.Pt.X!==a.X&&(i=i.Next),n=this.DupOutPt(i,!s),r.IntPoint.op_Inequality(n.Pt,a)&&((i=n).Pt.X=a.X,i.Pt.Y=a.Y,r.use_xyz&&(i.Pt.Z=a.Z),n=this.DupOutPt(i,!s))}else{for(;i.Next.Pt.X>=a.X&&i.Next.Pt.X<=i.Pt.X&&i.Next.Pt.Y===a.Y;)i=i.Next;!s&&i.Pt.X!==a.X&&(i=i.Next),n=this.DupOutPt(i,s),r.IntPoint.op_Inequality(n.Pt,a)&&((i=n).Pt.X=a.X,i.Pt.Y=a.Y,r.use_xyz&&(i.Pt.Z=a.Z),n=this.DupOutPt(i,s))}return o===r.Direction.dLeftToRight===s?(e.Prev=i,i.Next=e,t.Next=n,n.Prev=t):(e.Next=i,i.Prev=e,t.Prev=n,n.Next=t),!0},r.Clipper.prototype.JoinPoints=function(e,t,i){var n=e.OutPt1,a=new r.OutPt,s=e.OutPt2,o=new r.OutPt,l=e.OutPt1.Pt.Y===e.OffPt.Y;if(l&&r.IntPoint.op_Equality(e.OffPt,e.OutPt1.Pt)&&r.IntPoint.op_Equality(e.OffPt,e.OutPt2.Pt)){if(t!==i)return!1;for(a=e.OutPt1.Next;a!==n&&r.IntPoint.op_Equality(a.Pt,e.OffPt);)a=a.Next;var h=a.Pt.Y>e.OffPt.Y;for(o=e.OutPt2.Next;o!==s&&r.IntPoint.op_Equality(o.Pt,e.OffPt);)o=o.Next;return h!==o.Pt.Y>e.OffPt.Y&&(h?(a=this.DupOutPt(n,!1),o=this.DupOutPt(s,!0),n.Prev=s,s.Next=n,a.Next=o,o.Prev=a,e.OutPt1=n,e.OutPt2=a,!0):(a=this.DupOutPt(n,!0),o=this.DupOutPt(s,!1),n.Next=s,s.Prev=n,a.Prev=o,o.Next=a,e.OutPt1=n,e.OutPt2=a,!0))}if(l){for(a=n;n.Prev.Pt.Y===n.Pt.Y&&n.Prev!==a&&n.Prev!==s;)n=n.Prev;for(;a.Next.Pt.Y===a.Pt.Y&&a.Next!==n&&a.Next!==s;)a=a.Next;if(a.Next===n||a.Next===s)return!1;for(o=s;s.Prev.Pt.Y===s.Pt.Y&&s.Prev!==o&&s.Prev!==a;)s=s.Prev;for(;o.Next.Pt.Y===o.Pt.Y&&o.Next!==s&&o.Next!==n;)o=o.Next;if(o.Next===s||o.Next===n)return!1;var c={Left:null,Right:null};if(!this.GetOverlap(n.Pt.X,a.Pt.X,s.Pt.X,o.Pt.X,c))return!1;var u,d=c.Left,p=c.Right,f=new r.IntPoint0;return n.Pt.X>=d&&n.Pt.X<=p?(f.X=n.Pt.X,f.Y=n.Pt.Y,r.use_xyz&&(f.Z=n.Pt.Z),u=n.Pt.X>a.Pt.X):s.Pt.X>=d&&s.Pt.X<=p?(f.X=s.Pt.X,f.Y=s.Pt.Y,r.use_xyz&&(f.Z=s.Pt.Z),u=s.Pt.X>o.Pt.X):a.Pt.X>=d&&a.Pt.X<=p?(f.X=a.Pt.X,f.Y=a.Pt.Y,r.use_xyz&&(f.Z=a.Pt.Z),u=a.Pt.X>n.Pt.X):(f.X=o.Pt.X,f.Y=o.Pt.Y,r.use_xyz&&(f.Z=o.Pt.Z),u=o.Pt.X>s.Pt.X),e.OutPt1=n,e.OutPt2=s,this.JoinHorz(n,a,s,o,f,u)}for(a=n.Next;r.IntPoint.op_Equality(a.Pt,n.Pt)&&a!==n;)a=a.Next;var m=a.Pt.Y>n.Pt.Y||!r.ClipperBase.SlopesEqual4(n.Pt,a.Pt,e.OffPt,this.m_UseFullRange);if(m){for(a=n.Prev;r.IntPoint.op_Equality(a.Pt,n.Pt)&&a!==n;)a=a.Prev;if(a.Pt.Y>n.Pt.Y||!r.ClipperBase.SlopesEqual4(n.Pt,a.Pt,e.OffPt,this.m_UseFullRange))return!1}for(o=s.Next;r.IntPoint.op_Equality(o.Pt,s.Pt)&&o!==s;)o=o.Next;var g=o.Pt.Y>s.Pt.Y||!r.ClipperBase.SlopesEqual4(s.Pt,o.Pt,e.OffPt,this.m_UseFullRange);if(g){for(o=s.Prev;r.IntPoint.op_Equality(o.Pt,s.Pt)&&o!==s;)o=o.Prev;if(o.Pt.Y>s.Pt.Y||!r.ClipperBase.SlopesEqual4(s.Pt,o.Pt,e.OffPt,this.m_UseFullRange))return!1}return a!==n&&o!==s&&a!==o&&(t!==i||m!==g)&&(m?(a=this.DupOutPt(n,!1),o=this.DupOutPt(s,!0),n.Prev=s,s.Next=n,a.Next=o,o.Prev=a,e.OutPt1=n,e.OutPt2=a,!0):(a=this.DupOutPt(n,!0),o=this.DupOutPt(s,!1),n.Next=s,s.Prev=n,a.Prev=o,o.Next=a,e.OutPt1=n,e.OutPt2=a,!0))},r.Clipper.GetBounds=function(e){for(var t=0,i=e.length;t<i&&0===e[t].length;)t++;if(t===i)return new r.IntRect(0,0,0,0);var n=new r.IntRect;for(n.left=e[t][0].X,n.right=n.left,n.top=e[t][0].Y,n.bottom=n.top;t<i;t++)for(var a=0,s=e[t].length;a<s;a++)e[t][a].X<n.left?n.left=e[t][a].X:e[t][a].X>n.right&&(n.right=e[t][a].X),e[t][a].Y<n.top?n.top=e[t][a].Y:e[t][a].Y>n.bottom&&(n.bottom=e[t][a].Y);return n},r.Clipper.prototype.GetBounds2=function(e){var t=e,i=new r.IntRect;for(i.left=e.Pt.X,i.right=e.Pt.X,i.top=e.Pt.Y,i.bottom=e.Pt.Y,e=e.Next;e!==t;)e.Pt.X<i.left&&(i.left=e.Pt.X),e.Pt.X>i.right&&(i.right=e.Pt.X),e.Pt.Y<i.top&&(i.top=e.Pt.Y),e.Pt.Y>i.bottom&&(i.bottom=e.Pt.Y),e=e.Next;return i},r.Clipper.PointInPolygon=function(e,t){var r=0,i=t.length;if(i<3)return 0;for(var n=t[0],a=1;a<=i;++a){var s=a===i?t[0]:t[a];if(s.Y===e.Y&&(s.X===e.X||n.Y===e.Y&&s.X>e.X==n.X<e.X))return-1;if(n.Y<e.Y!=s.Y<e.Y)if(n.X>=e.X)if(s.X>e.X)r=1-r;else{if(0===(o=(n.X-e.X)*(s.Y-e.Y)-(s.X-e.X)*(n.Y-e.Y)))return-1;o>0==s.Y>n.Y&&(r=1-r)}else if(s.X>e.X){var o;if(0===(o=(n.X-e.X)*(s.Y-e.Y)-(s.X-e.X)*(n.Y-e.Y)))return-1;o>0==s.Y>n.Y&&(r=1-r)}n=s}return r},r.Clipper.prototype.PointInPolygon=function(e,t){var r=0,i=t,n=e.X,a=e.Y,s=t.Pt.X,o=t.Pt.Y;do{var l=(t=t.Next).Pt.X,h=t.Pt.Y;if(h===a&&(l===n||o===a&&l>n==s<n))return-1;if(o<a!=h<a)if(s>=n)if(l>n)r=1-r;else{if(0===(c=(s-n)*(h-a)-(l-n)*(o-a)))return-1;c>0==h>o&&(r=1-r)}else if(l>n){var c;if(0===(c=(s-n)*(h-a)-(l-n)*(o-a)))return-1;c>0==h>o&&(r=1-r)}s=l,o=h}while(i!==t);return r},r.Clipper.prototype.Poly2ContainsPoly1=function(e,t){var r=e;do{var i=this.PointInPolygon(r.Pt,t);if(i>=0)return i>0;r=r.Next}while(r!==e);return!0},r.Clipper.prototype.FixupFirstLefts1=function(e,t){for(var i,n,a=0,s=this.m_PolyOuts.length;a<s;a++)i=this.m_PolyOuts[a],n=r.Clipper.ParseFirstLeft(i.FirstLeft),null!==i.Pts&&n===e&&this.Poly2ContainsPoly1(i.Pts,t.Pts)&&(i.FirstLeft=t)},r.Clipper.prototype.FixupFirstLefts2=function(e,t){for(var i,n,a=t.FirstLeft,s=0,o=this.m_PolyOuts.length;s<o;s++)null!==(i=this.m_PolyOuts[s]).Pts&&i!==t&&i!==e&&(((n=r.Clipper.ParseFirstLeft(i.FirstLeft))===a||n===e||n===t)&&(this.Poly2ContainsPoly1(i.Pts,e.Pts)?i.FirstLeft=e:this.Poly2ContainsPoly1(i.Pts,t.Pts)?i.FirstLeft=t:(i.FirstLeft===e||i.FirstLeft===t)&&(i.FirstLeft=a)))},r.Clipper.prototype.FixupFirstLefts3=function(e,t){for(var i,n,a=0,s=this.m_PolyOuts.length;a<s;a++)i=this.m_PolyOuts[a],n=r.Clipper.ParseFirstLeft(i.FirstLeft),null!==i.Pts&&n===e&&(i.FirstLeft=t)},r.Clipper.ParseFirstLeft=function(e){for(;null!==e&&null===e.Pts;)e=e.FirstLeft;return e},r.Clipper.prototype.JoinCommonEdges=function(){for(var e=0,t=this.m_Joins.length;e<t;e++){var r,i=this.m_Joins[e],n=this.GetOutRec(i.OutPt1.Idx),a=this.GetOutRec(i.OutPt2.Idx);if(null!==n.Pts&&null!==a.Pts&&!n.IsOpen&&!a.IsOpen)r=n===a?n:this.OutRec1RightOfOutRec2(n,a)?a:this.OutRec1RightOfOutRec2(a,n)?n:this.GetLowermostRec(n,a),this.JoinPoints(i,n,a)&&(n===a?(n.Pts=i.OutPt1,n.BottomPt=null,(a=this.CreateOutRec()).Pts=i.OutPt2,this.UpdateOutPtIdxs(a),this.Poly2ContainsPoly1(a.Pts,n.Pts)?(a.IsHole=!n.IsHole,a.FirstLeft=n,this.m_UsingPolyTree&&this.FixupFirstLefts2(a,n),(a.IsHole^this.ReverseSolution)==this.Area$1(a)>0&&this.ReversePolyPtLinks(a.Pts)):this.Poly2ContainsPoly1(n.Pts,a.Pts)?(a.IsHole=n.IsHole,n.IsHole=!a.IsHole,a.FirstLeft=n.FirstLeft,n.FirstLeft=a,this.m_UsingPolyTree&&this.FixupFirstLefts2(n,a),(n.IsHole^this.ReverseSolution)==this.Area$1(n)>0&&this.ReversePolyPtLinks(n.Pts)):(a.IsHole=n.IsHole,a.FirstLeft=n.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(n,a))):(a.Pts=null,a.BottomPt=null,a.Idx=n.Idx,n.IsHole=r.IsHole,r===a&&(n.FirstLeft=a.FirstLeft),a.FirstLeft=n,this.m_UsingPolyTree&&this.FixupFirstLefts3(a,n)))}},r.Clipper.prototype.UpdateOutPtIdxs=function(e){var t=e.Pts;do{t.Idx=e.Idx,t=t.Prev}while(t!==e.Pts)},r.Clipper.prototype.DoSimplePolygons=function(){for(var e=0;e<this.m_PolyOuts.length;){var t=this.m_PolyOuts[e++],i=t.Pts;if(null!==i&&!t.IsOpen)do{for(var n=i.Next;n!==t.Pts;){if(r.IntPoint.op_Equality(i.Pt,n.Pt)&&n.Next!==i&&n.Prev!==i){var a=i.Prev,s=n.Prev;i.Prev=s,s.Next=i,n.Prev=a,a.Next=n,t.Pts=i;var o=this.CreateOutRec();o.Pts=n,this.UpdateOutPtIdxs(o),this.Poly2ContainsPoly1(o.Pts,t.Pts)?(o.IsHole=!t.IsHole,o.FirstLeft=t,this.m_UsingPolyTree&&this.FixupFirstLefts2(o,t)):this.Poly2ContainsPoly1(t.Pts,o.Pts)?(o.IsHole=t.IsHole,t.IsHole=!o.IsHole,o.FirstLeft=t.FirstLeft,t.FirstLeft=o,this.m_UsingPolyTree&&this.FixupFirstLefts2(t,o)):(o.IsHole=t.IsHole,o.FirstLeft=t.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(t,o)),n=i}n=n.Next}i=i.Next}while(i!==t.Pts)}},r.Clipper.Area=function(e){if(!Array.isArray(e))return 0;var t=e.length;if(t<3)return 0;for(var r=0,i=0,n=t-1;i<t;++i)r+=(e[n].X+e[i].X)*(e[n].Y-e[i].Y),n=i;return.5*-r},r.Clipper.prototype.Area=function(e){var t=e;if(null===e)return 0;var r=0;do{r+=(e.Prev.Pt.X+e.Pt.X)*(e.Prev.Pt.Y-e.Pt.Y),e=e.Next}while(e!==t);return.5*r},r.Clipper.prototype.Area$1=function(e){return this.Area(e.Pts)},r.Clipper.SimplifyPolygon=function(e,t){var i=new Array,n=new r.Clipper(0);return n.StrictlySimple=!0,n.AddPath(e,r.PolyType.ptSubject,!0),n.Execute(r.ClipType.ctUnion,i,t,t),i},r.Clipper.SimplifyPolygons=function(e,t){void 0===t&&(t=r.PolyFillType.pftEvenOdd);var i=new Array,n=new r.Clipper(0);return n.StrictlySimple=!0,n.AddPaths(e,r.PolyType.ptSubject,!0),n.Execute(r.ClipType.ctUnion,i,t,t),i},r.Clipper.DistanceSqrd=function(e,t){var r=e.X-t.X,i=e.Y-t.Y;return r*r+i*i},r.Clipper.DistanceFromLineSqrd=function(e,t,r){var i=t.Y-r.Y,n=r.X-t.X,a=i*t.X+n*t.Y;return(a=i*e.X+n*e.Y-a)*a/(i*i+n*n)},r.Clipper.SlopesNearCollinear=function(e,t,i,n){return Math.abs(e.X-t.X)>Math.abs(e.Y-t.Y)?e.X>t.X==e.X<i.X?r.Clipper.DistanceFromLineSqrd(e,t,i)<n:t.X>e.X==t.X<i.X?r.Clipper.DistanceFromLineSqrd(t,e,i)<n:r.Clipper.DistanceFromLineSqrd(i,e,t)<n:e.Y>t.Y==e.Y<i.Y?r.Clipper.DistanceFromLineSqrd(e,t,i)<n:t.Y>e.Y==t.Y<i.Y?r.Clipper.DistanceFromLineSqrd(t,e,i)<n:r.Clipper.DistanceFromLineSqrd(i,e,t)<n},r.Clipper.PointsAreClose=function(e,t,r){var i=e.X-t.X,n=e.Y-t.Y;return i*i+n*n<=r},r.Clipper.ExcludeOp=function(e){var t=e.Prev;return t.Next=e.Next,e.Next.Prev=t,t.Idx=0,t},r.Clipper.CleanPolygon=function(e,t){void 0===t&&(t=1.415);var i=e.length;if(0===i)return new Array;for(var n=new Array(i),a=0;a<i;++a)n[a]=new r.OutPt;for(a=0;a<i;++a)n[a].Pt=e[a],n[a].Next=n[(a+1)%i],n[a].Next.Prev=n[a],n[a].Idx=0;for(var s=t*t,o=n[0];0===o.Idx&&o.Next!==o.Prev;)r.Clipper.PointsAreClose(o.Pt,o.Prev.Pt,s)?(o=r.Clipper.ExcludeOp(o),i--):r.Clipper.PointsAreClose(o.Prev.Pt,o.Next.Pt,s)?(r.Clipper.ExcludeOp(o.Next),o=r.Clipper.ExcludeOp(o),i-=2):r.Clipper.SlopesNearCollinear(o.Prev.Pt,o.Pt,o.Next.Pt,s)?(o=r.Clipper.ExcludeOp(o),i--):(o.Idx=1,o=o.Next);i<3&&(i=0);var l=new Array(i);for(a=0;a<i;++a)l[a]=new r.IntPoint1(o.Pt),o=o.Next;return n=null,l},r.Clipper.CleanPolygons=function(e,t){for(var i=new Array(e.length),n=0,a=e.length;n<a;n++)i[n]=r.Clipper.CleanPolygon(e[n],t);return i},r.Clipper.Minkowski=function(e,t,i,n){var a=n?1:0,s=e.length,o=t.length,l=new Array;if(i)for(var h=0;h<o;h++){for(var c=new Array(s),u=0,d=e.length,p=e[u];u<d;p=e[++u])c[u]=new r.IntPoint2(t[h].X+p.X,t[h].Y+p.Y);l.push(c)}else for(h=0;h<o;h++){for(c=new Array(s),u=0,d=e.length,p=e[u];u<d;p=e[++u])c[u]=new r.IntPoint2(t[h].X-p.X,t[h].Y-p.Y);l.push(c)}var f=new Array;for(h=0;h<o-1+a;h++)for(u=0;u<s;u++){var m=new Array;m.push(l[h%o][u%s]),m.push(l[(h+1)%o][u%s]),m.push(l[(h+1)%o][(u+1)%s]),m.push(l[h%o][(u+1)%s]),r.Clipper.Orientation(m)||m.reverse(),f.push(m)}return f},r.Clipper.MinkowskiSum=function(e,t,i){if(t[0]instanceof Array){for(var n=t,a=new r.Paths,s=new r.Clipper,o=0;o<n.length;++o){var l=r.Clipper.Minkowski(e,n[o],!0,i);if(s.AddPaths(l,r.PolyType.ptSubject,!0),i){var h=r.Clipper.TranslatePath(n[o],e[0]);s.AddPath(h,r.PolyType.ptClip,!0)}}return s.Execute(r.ClipType.ctUnion,a,r.PolyFillType.pftNonZero,r.PolyFillType.pftNonZero),a}h=t,n=r.Clipper.Minkowski(e,h,!0,i);return(s=new r.Clipper).AddPaths(n,r.PolyType.ptSubject,!0),s.Execute(r.ClipType.ctUnion,n,r.PolyFillType.pftNonZero,r.PolyFillType.pftNonZero),n},r.Clipper.TranslatePath=function(e,t){for(var i=new r.Path,n=0;n<e.length;n++)i.push(new r.IntPoint2(e[n].X+t.X,e[n].Y+t.Y));return i},r.Clipper.MinkowskiDiff=function(e,t){var i=r.Clipper.Minkowski(e,t,!1,!0),n=new r.Clipper;return n.AddPaths(i,r.PolyType.ptSubject,!0),n.Execute(r.ClipType.ctUnion,i,r.PolyFillType.pftNonZero,r.PolyFillType.pftNonZero),i},r.Clipper.PolyTreeToPaths=function(e){var t=new Array;return r.Clipper.AddPolyNodeToPaths(e,r.Clipper.NodeType.ntAny,t),t},r.Clipper.AddPolyNodeToPaths=function(e,t,i){var n=!0;switch(t){case r.Clipper.NodeType.ntOpen:return;case r.Clipper.NodeType.ntClosed:n=!e.IsOpen}e.m_polygon.length>0&&n&&i.push(e.m_polygon);for(var a=0,s=e.Childs(),o=s.length,l=s[a];a<o;l=s[++a])r.Clipper.AddPolyNodeToPaths(l,t,i)},r.Clipper.OpenPathsFromPolyTree=function(e){for(var t=new r.Paths,i=0,n=e.ChildCount();i<n;i++)e.Childs()[i].IsOpen&&t.push(e.Childs()[i].m_polygon);return t},r.Clipper.ClosedPathsFromPolyTree=function(e){var t=new r.Paths;return r.Clipper.AddPolyNodeToPaths(e,r.Clipper.NodeType.ntClosed,t),t},I(r.Clipper,r.ClipperBase),r.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2},r.ClipperOffset=function(e,t){void 0===e&&(e=2),void 0===t&&(t=r.ClipperOffset.def_arc_tolerance),this.m_destPolys=new r.Paths,this.m_srcPoly=new r.Path,this.m_destPoly=new r.Path,this.m_normals=new Array,this.m_delta=0,this.m_sinA=0,this.m_sin=0,this.m_cos=0,this.m_miterLim=0,this.m_StepsPerRad=0,this.m_lowest=new r.IntPoint0,this.m_polyNodes=new r.PolyNode,this.MiterLimit=e,this.ArcTolerance=t,this.m_lowest.X=-1},r.ClipperOffset.two_pi=6.28318530717959,r.ClipperOffset.def_arc_tolerance=.25,r.ClipperOffset.prototype.Clear=function(){r.Clear(this.m_polyNodes.Childs()),this.m_lowest.X=-1},r.ClipperOffset.Round=r.Clipper.Round,r.ClipperOffset.prototype.AddPath=function(e,t,i){var n=e.length-1;if(!(n<0)){var a=new r.PolyNode;if(a.m_jointype=t,a.m_endtype=i,i===r.EndType.etClosedLine||i===r.EndType.etClosedPolygon)for(;n>0&&r.IntPoint.op_Equality(e[0],e[n]);)n--;a.m_polygon.push(e[0]);for(var s=0,o=0,l=1;l<=n;l++)r.IntPoint.op_Inequality(a.m_polygon[s],e[l])&&(s++,a.m_polygon.push(e[l]),(e[l].Y>a.m_polygon[o].Y||e[l].Y===a.m_polygon[o].Y&&e[l].X<a.m_polygon[o].X)&&(o=s));if(!(i===r.EndType.etClosedPolygon&&s<2)&&(this.m_polyNodes.AddChild(a),i===r.EndType.etClosedPolygon))if(this.m_lowest.X<0)this.m_lowest=new r.IntPoint2(this.m_polyNodes.ChildCount()-1,o);else{var h=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y];(a.m_polygon[o].Y>h.Y||a.m_polygon[o].Y===h.Y&&a.m_polygon[o].X<h.X)&&(this.m_lowest=new r.IntPoint2(this.m_polyNodes.ChildCount()-1,o))}}},r.ClipperOffset.prototype.AddPaths=function(e,t,r){for(var i=0,n=e.length;i<n;i++)this.AddPath(e[i],t,r)},r.ClipperOffset.prototype.FixOrientations=function(){if(this.m_lowest.X>=0&&!r.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var e=0;e<this.m_polyNodes.ChildCount();e++){((t=this.m_polyNodes.Childs()[e]).m_endtype===r.EndType.etClosedPolygon||t.m_endtype===r.EndType.etClosedLine&&r.Clipper.Orientation(t.m_polygon))&&t.m_polygon.reverse()}else for(e=0;e<this.m_polyNodes.ChildCount();e++){var t;(t=this.m_polyNodes.Childs()[e]).m_endtype===r.EndType.etClosedLine&&!r.Clipper.Orientation(t.m_polygon)&&t.m_polygon.reverse()}},r.ClipperOffset.GetUnitNormal=function(e,t){var i=t.X-e.X,n=t.Y-e.Y;if(0===i&&0===n)return new r.DoublePoint2(0,0);var a=1/Math.sqrt(i*i+n*n);return i*=a,n*=a,new r.DoublePoint2(n,-i)},r.ClipperOffset.prototype.DoOffset=function(e){if(this.m_destPolys=new Array,this.m_delta=e,r.ClipperBase.near_zero(e))for(var t=0;t<this.m_polyNodes.ChildCount();t++){(a=this.m_polyNodes.Childs()[t]).m_endtype===r.EndType.etClosedPolygon&&this.m_destPolys.push(a.m_polygon)}else{var i;this.MiterLimit>2?this.m_miterLim=2/(this.MiterLimit*this.MiterLimit):this.m_miterLim=.5,i=this.ArcTolerance<=0?r.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(e)*r.ClipperOffset.def_arc_tolerance?Math.abs(e)*r.ClipperOffset.def_arc_tolerance:this.ArcTolerance;var n=3.14159265358979/Math.acos(1-i/Math.abs(e));this.m_sin=Math.sin(r.ClipperOffset.two_pi/n),this.m_cos=Math.cos(r.ClipperOffset.two_pi/n),this.m_StepsPerRad=n/r.ClipperOffset.two_pi,e<0&&(this.m_sin=-this.m_sin);for(t=0;t<this.m_polyNodes.ChildCount();t++){var a=this.m_polyNodes.Childs()[t];this.m_srcPoly=a.m_polygon;var s=this.m_srcPoly.length;if(!(0===s||e<=0&&(s<3||a.m_endtype!==r.EndType.etClosedPolygon))){if(this.m_destPoly=new Array,1===s){if(a.m_jointype===r.JoinType.jtRound)for(var o=1,l=0,h=1;h<=n;h++){this.m_destPoly.push(new r.IntPoint2(r.ClipperOffset.Round(this.m_srcPoly[0].X+o*e),r.ClipperOffset.Round(this.m_srcPoly[0].Y+l*e)));var c=o;o=o*this.m_cos-this.m_sin*l,l=c*this.m_sin+l*this.m_cos}else for(o=-1,l=-1,h=0;h<4;++h)this.m_destPoly.push(new r.IntPoint2(r.ClipperOffset.Round(this.m_srcPoly[0].X+o*e),r.ClipperOffset.Round(this.m_srcPoly[0].Y+l*e))),o<0?o=1:l<0?l=1:o=-1;this.m_destPolys.push(this.m_destPoly);continue}this.m_normals.length=0;for(h=0;h<s-1;h++)this.m_normals.push(r.ClipperOffset.GetUnitNormal(this.m_srcPoly[h],this.m_srcPoly[h+1]));if(a.m_endtype===r.EndType.etClosedLine||a.m_endtype===r.EndType.etClosedPolygon?this.m_normals.push(r.ClipperOffset.GetUnitNormal(this.m_srcPoly[s-1],this.m_srcPoly[0])):this.m_normals.push(new r.DoublePoint1(this.m_normals[s-2])),a.m_endtype===r.EndType.etClosedPolygon){var u=s-1;for(h=0;h<s;h++)u=this.OffsetPoint(h,u,a.m_jointype);this.m_destPolys.push(this.m_destPoly)}else if(a.m_endtype===r.EndType.etClosedLine){for(u=s-1,h=0;h<s;h++)u=this.OffsetPoint(h,u,a.m_jointype);this.m_destPolys.push(this.m_destPoly),this.m_destPoly=new Array;var d=this.m_normals[s-1];for(h=s-1;h>0;h--)this.m_normals[h]=new r.DoublePoint2(-this.m_normals[h-1].X,-this.m_normals[h-1].Y);this.m_normals[0]=new r.DoublePoint2(-d.X,-d.Y),u=0;for(h=s-1;h>=0;h--)u=this.OffsetPoint(h,u,a.m_jointype);this.m_destPolys.push(this.m_destPoly)}else{for(u=0,h=1;h<s-1;++h)u=this.OffsetPoint(h,u,a.m_jointype);var p;if(a.m_endtype===r.EndType.etOpenButt){h=s-1;p=new r.IntPoint2(r.ClipperOffset.Round(this.m_srcPoly[h].X+this.m_normals[h].X*e),r.ClipperOffset.Round(this.m_srcPoly[h].Y+this.m_normals[h].Y*e)),this.m_destPoly.push(p),p=new r.IntPoint2(r.ClipperOffset.Round(this.m_srcPoly[h].X-this.m_normals[h].X*e),r.ClipperOffset.Round(this.m_srcPoly[h].Y-this.m_normals[h].Y*e)),this.m_destPoly.push(p)}else{h=s-1;u=s-2,this.m_sinA=0,this.m_normals[h]=new r.DoublePoint2(-this.m_normals[h].X,-this.m_normals[h].Y),a.m_endtype===r.EndType.etOpenSquare?this.DoSquare(h,u):this.DoRound(h,u)}for(h=s-1;h>0;h--)this.m_normals[h]=new r.DoublePoint2(-this.m_normals[h-1].X,-this.m_normals[h-1].Y);this.m_normals[0]=new r.DoublePoint2(-this.m_normals[1].X,-this.m_normals[1].Y);for(h=(u=s-1)-1;h>0;--h)u=this.OffsetPoint(h,u,a.m_jointype);a.m_endtype===r.EndType.etOpenButt?(p=new r.IntPoint2(r.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*e),r.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*e)),this.m_destPoly.push(p),p=new r.IntPoint2(r.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*e),r.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*e)),this.m_destPoly.push(p)):(u=1,this.m_sinA=0,a.m_endtype===r.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1)),this.m_destPolys.push(this.m_destPoly)}}}}},r.ClipperOffset.prototype.Execute=function(){var e=arguments;if(e[0]instanceof r.PolyTree){var t=e[1];if((o=e[0]).Clear(),this.FixOrientations(),this.DoOffset(t),(s=new r.Clipper(0)).AddPaths(this.m_destPolys,r.PolyType.ptSubject,!0),t>0)s.Execute(r.ClipType.ctUnion,o,r.PolyFillType.pftPositive,r.PolyFillType.pftPositive);else{var i=r.Clipper.GetBounds(this.m_destPolys);if((l=new r.Path).push(new r.IntPoint2(i.left-10,i.bottom+10)),l.push(new r.IntPoint2(i.right+10,i.bottom+10)),l.push(new r.IntPoint2(i.right+10,i.top-10)),l.push(new r.IntPoint2(i.left-10,i.top-10)),s.AddPath(l,r.PolyType.ptSubject,!0),s.ReverseSolution=!0,s.Execute(r.ClipType.ctUnion,o,r.PolyFillType.pftNegative,r.PolyFillType.pftNegative),1===o.ChildCount()&&o.Childs()[0].ChildCount()>0){var n=o.Childs()[0];o.Childs()[0]=n.Childs()[0],o.Childs()[0].m_Parent=o;for(var a=1;a<n.ChildCount();a++)o.AddChild(n.Childs()[a])}else o.Clear()}}else{var s,o=e[0];t=e[1];if(r.Clear(o),this.FixOrientations(),this.DoOffset(t),(s=new r.Clipper(0)).AddPaths(this.m_destPolys,r.PolyType.ptSubject,!0),t>0)s.Execute(r.ClipType.ctUnion,o,r.PolyFillType.pftPositive,r.PolyFillType.pftPositive);else{var l;i=r.Clipper.GetBounds(this.m_destPolys);(l=new r.Path).push(new r.IntPoint2(i.left-10,i.bottom+10)),l.push(new r.IntPoint2(i.right+10,i.bottom+10)),l.push(new r.IntPoint2(i.right+10,i.top-10)),l.push(new r.IntPoint2(i.left-10,i.top-10)),s.AddPath(l,r.PolyType.ptSubject,!0),s.ReverseSolution=!0,s.Execute(r.ClipType.ctUnion,o,r.PolyFillType.pftNegative,r.PolyFillType.pftNegative),o.length>0&&o.splice(0,1)}}},r.ClipperOffset.prototype.OffsetPoint=function(e,t,i){if(this.m_sinA=this.m_normals[t].X*this.m_normals[e].Y-this.m_normals[e].X*this.m_normals[t].Y,Math.abs(this.m_sinA*this.m_delta)<1){if(this.m_normals[t].X*this.m_normals[e].X+this.m_normals[e].Y*this.m_normals[t].Y>0)return this.m_destPoly.push(new r.IntPoint2(r.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[t].X*this.m_delta),r.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[t].Y*this.m_delta))),t}else this.m_sinA>1?this.m_sinA=1:this.m_sinA<-1&&(this.m_sinA=-1);if(this.m_sinA*this.m_delta<0)this.m_destPoly.push(new r.IntPoint2(r.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[t].X*this.m_delta),r.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[t].Y*this.m_delta))),this.m_destPoly.push(new r.IntPoint1(this.m_srcPoly[e])),this.m_destPoly.push(new r.IntPoint2(r.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[e].X*this.m_delta),r.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[e].Y*this.m_delta)));else switch(i){case r.JoinType.jtMiter:var n=this.m_normals[e].X*this.m_normals[t].X+this.m_normals[e].Y*this.m_normals[t].Y+1;n>=this.m_miterLim?this.DoMiter(e,t,n):this.DoSquare(e,t);break;case r.JoinType.jtSquare:this.DoSquare(e,t);break;case r.JoinType.jtRound:this.DoRound(e,t)}return t=e},r.ClipperOffset.prototype.DoSquare=function(e,t){var i=Math.tan(Math.atan2(this.m_sinA,this.m_normals[t].X*this.m_normals[e].X+this.m_normals[t].Y*this.m_normals[e].Y)/4);this.m_destPoly.push(new r.IntPoint2(r.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_delta*(this.m_normals[t].X-this.m_normals[t].Y*i)),r.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_delta*(this.m_normals[t].Y+this.m_normals[t].X*i)))),this.m_destPoly.push(new r.IntPoint2(r.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_delta*(this.m_normals[e].X+this.m_normals[e].Y*i)),r.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_delta*(this.m_normals[e].Y-this.m_normals[e].X*i))))},r.ClipperOffset.prototype.DoMiter=function(e,t,i){var n=this.m_delta/i;this.m_destPoly.push(new r.IntPoint2(r.ClipperOffset.Round(this.m_srcPoly[e].X+(this.m_normals[t].X+this.m_normals[e].X)*n),r.ClipperOffset.Round(this.m_srcPoly[e].Y+(this.m_normals[t].Y+this.m_normals[e].Y)*n)))},r.ClipperOffset.prototype.DoRound=function(e,t){for(var i,n=Math.atan2(this.m_sinA,this.m_normals[t].X*this.m_normals[e].X+this.m_normals[t].Y*this.m_normals[e].Y),a=Math.max(r.Cast_Int32(r.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(n))),1),s=this.m_normals[t].X,o=this.m_normals[t].Y,l=0;l<a;++l)this.m_destPoly.push(new r.IntPoint2(r.ClipperOffset.Round(this.m_srcPoly[e].X+s*this.m_delta),r.ClipperOffset.Round(this.m_srcPoly[e].Y+o*this.m_delta))),i=s,s=s*this.m_cos-this.m_sin*o,o=i*this.m_sin+o*this.m_cos;this.m_destPoly.push(new r.IntPoint2(r.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[e].X*this.m_delta),r.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[e].Y*this.m_delta)))},r.Error=function(e){try{throw new Error(e)}catch(e){alert(e.message)}},r.JS={},r.JS.AreaOfPolygon=function(e,t){return t||(t=1),r.Clipper.Area(e)/(t*t)},r.JS.AreaOfPolygons=function(e,t){t||(t=1);for(var i=0,n=0;n<e.length;n++)i+=r.Clipper.Area(e[n]);return i/(t*t)},r.JS.BoundsOfPath=function(e,t){return r.JS.BoundsOfPaths([e],t)},r.JS.BoundsOfPaths=function(e,t){t||(t=1);var i=r.Clipper.GetBounds(e);return i.left/=t,i.bottom/=t,i.right/=t,i.top/=t,i},r.JS.Clean=function(e,t){if(!(e instanceof Array))return[];var i=e[0]instanceof Array;e=r.JS.Clone(e);if("number"!=typeof t||null===t)return r.Error("Delta is not a number in Clean()."),e;if(0===e.length||1===e.length&&0===e[0].length||t<0)return e;i||(e=[e]);for(var n,a,s,o,l,h,c,u=e.length,d=[],p=0;p<u;p++)if(0!==(n=(a=e[p]).length)){if(n<3){s=a,d.push(s);continue}for(s=a,o=t*t,l=a[0],h=1,c=1;c<n;c++)(a[c].X-l.X)*(a[c].X-l.X)+(a[c].Y-l.Y)*(a[c].Y-l.Y)<=o||(s[h]=a[c],l=a[c],h++);l=a[h-1],(a[0].X-l.X)*(a[0].X-l.X)+(a[0].Y-l.Y)*(a[0].Y-l.Y)<=o&&h--,h<n&&s.splice(h,n-h),s.length&&d.push(s)}return!i&&d.length?d=d[0]:i||0!==d.length?i&&0===d.length&&(d=[[]]):d=[],d},r.JS.Clone=function(e){if(!(e instanceof Array))return[];if(0===e.length)return[];if(1===e.length&&0===e[0].length)return[[]];var t=e[0]instanceof Array;t||(e=[e]);var r,i,n,a,s=e.length,o=new Array(s);for(i=0;i<s;i++){for(r=e[i].length,a=new Array(r),n=0;n<r;n++)a[n]={X:e[i][n].X,Y:e[i][n].Y};o[i]=a}return t||(o=o[0]),o},r.JS.Lighten=function(e,t){if(!(e instanceof Array))return[];if("number"!=typeof t||null===t)return r.Error("Tolerance is not a number in Lighten()."),r.JS.Clone(e);if(0===e.length||1===e.length&&0===e[0].length||t<0)return r.JS.Clone(e);var i=e[0]instanceof Array;i||(e=[e]);var n,a,s,o,l,h,c,u,d,p,f,m,g,v,y,b,x=e.length,_=t*t,w=[];for(n=0;n<x;n++)if(0!==(h=(s=e[n]).length)){for(o=0;o<1e6;o++){for(l=[],s[(h=s.length)-1].X!==s[0].X||s[h-1].Y!==s[0].Y?(f=1,s.push({X:s[0].X,Y:s[0].Y}),h=s.length):f=0,p=[],a=0;a<h-2;a++)c=s[a],d=s[a+1],u=s[a+2],y=c.X,b=c.Y,m=u.X-y,g=u.Y-b,(0!==m||0!==g)&&((v=((d.X-y)*m+(d.Y-b)*g)/(m*m+g*g))>1?(y=u.X,b=u.Y):v>0&&(y+=m*v,b+=g*v)),(m=d.X-y)*m+(g=d.Y-b)*g<=_&&(p[a+1]=1,a++);for(l.push({X:s[0].X,Y:s[0].Y}),a=1;a<h-1;a++)p[a]||l.push({X:s[a].X,Y:s[a].Y});if(l.push({X:s[h-1].X,Y:s[h-1].Y}),f&&s.pop(),!p.length)break;s=l}l[(h=l.length)-1].X===l[0].X&&l[h-1].Y===l[0].Y&&l.pop(),l.length>2&&w.push(l)}return i||(w=w[0]),void 0===w&&(w=[]),w},r.JS.PerimeterOfPath=function(e,t,r){if(void 0===e)return 0;var i,n,a=Math.sqrt,s=0,o=0,l=0,h=0,c=0,u=e.length;if(u<2)return 0;for(t&&(e[u]=e[0],u++);--u;)o=(i=e[u]).X,l=i.Y,s+=a((o-(h=(n=e[u-1]).X))*(o-h)+(l-(c=n.Y))*(l-c));return t&&e.pop(),s/r},r.JS.PerimeterOfPaths=function(e,t,i){i||(i=1);for(var n=0,a=0;a<e.length;a++)n+=r.JS.PerimeterOfPath(e[a],t,i);return n},r.JS.ScaleDownPath=function(e,t){var r,i;for(t||(t=1),r=e.length;r--;)(i=e[r]).X=i.X/t,i.Y=i.Y/t},r.JS.ScaleDownPaths=function(e,t){var r,i,n;for(t||(t=1),r=e.length;r--;)for(i=e[r].length;i--;)(n=e[r][i]).X=n.X/t,n.Y=n.Y/t},r.JS.ScaleUpPath=function(e,t){var r,i,n=Math.round;for(t||(t=1),r=e.length;r--;)(i=e[r]).X=n(i.X*t),i.Y=n(i.Y*t)},r.JS.ScaleUpPaths=function(e,t){var r,i,n,a=Math.round;for(t||(t=1),r=e.length;r--;)for(i=e[r].length;i--;)(n=e[r][i]).X=a(n.X*t),n.Y=a(n.Y*t)},r.ExPolygons=function(){return[]},r.ExPolygon=function(){this.outer=null,this.holes=null},r.JS.AddOuterPolyNodeToExPolygons=function(e,t){var i=new r.ExPolygon;i.outer=e.Contour();var n,a,s,o,l,h,c=e.Childs(),u=c.length;for(i.holes=new Array(u),s=0;s<u;s++)for(n=c[s],i.holes[s]=n.Contour(),o=0,h=(l=n.Childs()).length;o<h;o++)a=l[o],r.JS.AddOuterPolyNodeToExPolygons(a,t);t.push(i)},r.JS.ExPolygonsToPaths=function(e){var t,i,n,a,s=new r.Paths;for(t=0,n=e.length;t<n;t++)for(s.push(e[t].outer),i=0,a=e[t].holes.length;i<a;i++)s.push(e[t].holes[i]);return s},r.JS.PolyTreeToExPolygons=function(e){var t,i,n,a,s=new r.ExPolygons;for(i=0,a=(n=e.Childs()).length;i<a;i++)t=n[i],r.JS.AddOuterPolyNodeToExPolygons(t,s);return s}}()})),BAe=$((()=>{})),NAe=$((()=>{})),UAe=$((()=>{})),HAe=$((()=>{})),VAe=$((()=>{})),gRe=$(((exports,module)=>{var e,t;e=globalThis,t=()=>(()=>{"use strict";var __webpack_modules__=[,(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.VerbosityLevel=t.Util=t.UnknownErrorException=t.UnexpectedResponseException=t.TextRenderingMode=t.RenderingIntentFlag=t.PromiseCapability=t.PermissionFlag=t.PasswordResponses=t.PasswordException=t.PageActionEventType=t.OPS=t.MissingPDFException=t.MAX_IMAGE_SIZE_TO_CACHE=t.LINE_FACTOR=t.LINE_DESCENT_FACTOR=t.InvalidPDFException=t.ImageKind=t.IDENTITY_MATRIX=t.FormatError=t.FeatureTest=t.FONT_IDENTITY_MATRIX=t.DocumentActionEventType=t.CMapCompressionType=t.BaseException=t.BASELINE_FACTOR=t.AnnotationType=t.AnnotationReplyType=t.AnnotationMode=t.AnnotationFlag=t.AnnotationFieldFlag=t.AnnotationEditorType=t.AnnotationEditorPrefix=t.AnnotationEditorParamsType=t.AnnotationBorderStyleType=t.AnnotationActionEventType=t.AbortException=void 0,t.assert=function(e,t){e||s(t)},t.bytesToString=function(e){("object"!=typeof e||void 0===(null==e?void 0:e.length))&&s("Invalid argument for bytesToString");let t=e.length,r=8192;if(t<r)return String.fromCharCode.apply(null,e);let i=[];for(let n=0;n<t;n+=r){let a=Math.min(n+r,t),s=e.subarray(n,a);i.push(String.fromCharCode.apply(null,s))}return i.join("")},t.createValidAbsoluteUrl=function(e,t=null,r=null){if(!e)return null;try{if(r&&"string"==typeof e){if(r.addDefaultProtocol&&e.startsWith("www.")){let t=e.match(/\./g);(null==t?void 0:t.length)>=2&&(e=`http://${e}`)}if(r.tryConvertEncoding)try{e=d(e)}catch(e){}}let i=t?new URL(e,t):new URL(e);if(function(e){switch(null==e?void 0:e.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(i))return i}catch(e){}return null},t.getModificationDate=function(e=new Date){return[e.getUTCFullYear().toString(),(e.getUTCMonth()+1).toString().padStart(2,"0"),e.getUTCDate().toString().padStart(2,"0"),e.getUTCHours().toString().padStart(2,"0"),e.getUTCMinutes().toString().padStart(2,"0"),e.getUTCSeconds().toString().padStart(2,"0")].join("")},t.getVerbosityLevel=function(){return n},t.info=function(e){n>=i.INFOS&&console.log(`Info: ${e}`)},t.isArrayBuffer=function(e){return"object"==typeof e&&void 0!==(null==e?void 0:e.byteLength)},t.isArrayEqual=function(e,t){if(e.length!==t.length)return!1;for(let r=0,i=e.length;r<i;r++)if(e[r]!==t[r])return!1;return!0},t.normalizeUnicode=function(e){return p||(p=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,f=new Map([["ﬅ","ſt"]])),e.replaceAll(p,((e,t,r)=>t?t.normalize("NFKC"):f.get(r)))},t.objectFromMap=function(e){let t=Object.create(null);for(let[r,i]of e)t[r]=i;return t},t.objectSize=function(e){return Object.keys(e).length},t.setVerbosityLevel=function(e){Number.isInteger(e)&&(n=e)},t.shadow=o,t.string32=function(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)},t.stringToBytes=h,t.stringToPDFString=function(e){if(e[0]>="ï"){let t;if("þ"===e[0]&&"ÿ"===e[1]?t="utf-16be":"ÿ"===e[0]&&"þ"===e[1]?t="utf-16le":"ï"===e[0]&&"»"===e[1]&&"¿"===e[2]&&(t="utf-8"),t)try{let r=new TextDecoder(t,{fatal:!0}),i=h(e);return r.decode(i)}catch(e){a(`stringToPDFString: "${e}".`)}}let t=[];for(let r=0,i=e.length;r<i;r++){let i=u[e.charCodeAt(r)];t.push(i?String.fromCharCode(i):e.charAt(r))}return t.join("")},t.stringToUTF8String=d,t.unreachable=s,t.utf8StringToString=function(e){return unescape(encodeURIComponent(e))},t.warn=a,t.IDENTITY_MATRIX=[1,0,0,1,0,0],t.FONT_IDENTITY_MATRIX=[.001,0,0,.001,0,0],t.MAX_IMAGE_SIZE_TO_CACHE=1e7,t.LINE_FACTOR=1.35,t.LINE_DESCENT_FACTOR=.35,t.BASELINE_FACTOR=.25925925925925924,t.RenderingIntentFlag={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256},t.AnnotationMode={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},t.AnnotationEditorPrefix="pdfjs_internal_editor_",t.AnnotationEditorType={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15},t.AnnotationEditorParamsType={FREETEXT_SIZE:1,FREETEXT_COLOR:2,FREETEXT_OPACITY:3,INK_COLOR:11,INK_THICKNESS:12,INK_OPACITY:13},t.PermissionFlag={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},t.TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},t.ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},t.AnnotationType={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},t.AnnotationReplyType={GROUP:"Group",REPLY:"R"},t.AnnotationFlag={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512},t.AnnotationFieldFlag={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864},t.AnnotationBorderStyleType={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},t.AnnotationActionEventType={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"},t.DocumentActionEventType={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"},t.PageActionEventType={O:"PageOpen",C:"PageClose"};let i={ERRORS:0,WARNINGS:1,INFOS:5};t.VerbosityLevel=i,t.CMapCompressionType={NONE:0,BINARY:1},t.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},t.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let n=i.WARNINGS;function a(e){n>=i.WARNINGS&&console.log(`Warning: ${e}`)}function s(e){throw new Error(e)}function o(e,t,r,i=!1){return Object.defineProperty(e,t,{value:r,enumerable:!i,configurable:!0,writable:!1}),r}let l=function(){function e(t,r){this.constructor===e&&s("Cannot initialize BaseException."),this.message=t,this.name=r}return e.prototype=new Error,e.constructor=e,e}();function h(e){"string"!=typeof e&&s("Invalid argument for stringToBytes");let t=e.length,r=new Uint8Array(t);for(let i=0;i<t;++i)r[i]=255&e.charCodeAt(i);return r}t.BaseException=l,t.PasswordException=class extends l{constructor(e,t){super(e,"PasswordException"),this.code=t}},t.UnknownErrorException=class extends l{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}},t.InvalidPDFException=class extends l{constructor(e){super(e,"InvalidPDFException")}},t.MissingPDFException=class extends l{constructor(e){super(e,"MissingPDFException")}},t.UnexpectedResponseException=class extends l{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}},t.FormatError=class extends l{constructor(e){super(e,"FormatError")}},t.AbortException=class extends l{constructor(e){super(e,"AbortException")}},t.FeatureTest=class{static get isLittleEndian(){return o(this,"isLittleEndian",function(){let e=new Uint8Array(4);return e[0]=1,1===new Uint32Array(e.buffer,0,1)[0]}())}static get isEvalSupported(){return o(this,"isEvalSupported",function(){try{return new Function(""),!0}catch(e){return!1}}())}static get isOffscreenCanvasSupported(){return o(this,"isOffscreenCanvasSupported","undefined"!=typeof OffscreenCanvas)}static get platform(){return"undefined"==typeof navigator?o(this,"platform",{isWin:!1,isMac:!1}):o(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}};let c=[...Array(256).keys()].map((e=>e.toString(16).padStart(2,"0")));t.Util=class{static makeHexColor(e,t,r){return`#${c[e]}${c[t]}${c[r]}`}static scaleMinMax(e,t){let r;e[0]?(e[0]<0&&(r=t[0],t[0]=t[1],t[1]=r),t[0]*=e[0],t[1]*=e[0],e[3]<0&&(r=t[2],t[2]=t[3],t[3]=r),t[2]*=e[3],t[3]*=e[3]):(r=t[0],t[0]=t[2],t[2]=r,r=t[1],t[1]=t[3],t[3]=r,e[1]<0&&(r=t[2],t[2]=t[3],t[3]=r),t[2]*=e[1],t[3]*=e[1],e[2]<0&&(r=t[0],t[0]=t[1],t[1]=r),t[0]*=e[2],t[1]*=e[2]),t[0]+=e[4],t[1]+=e[4],t[2]+=e[5],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){return[e[0]*t[0]+e[1]*t[2]+t[4],e[0]*t[1]+e[1]*t[3]+t[5]]}static applyInverseTransform(e,t){let r=t[0]*t[3]-t[1]*t[2];return[(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/r,(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/r]}static getAxialAlignedBoundingBox(e,t){let r=this.applyTransform(e,t),i=this.applyTransform(e.slice(2,4),t),n=this.applyTransform([e[0],e[3]],t),a=this.applyTransform([e[2],e[1]],t);return[Math.min(r[0],i[0],n[0],a[0]),Math.min(r[1],i[1],n[1],a[1]),Math.max(r[0],i[0],n[0],a[0]),Math.max(r[1],i[1],n[1],a[1])]}static inverseTransform(e){let t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){let t=[e[0],e[2],e[1],e[3]],r=e[0]*t[0]+e[1]*t[2],i=e[0]*t[1]+e[1]*t[3],n=e[2]*t[0]+e[3]*t[2],a=e[2]*t[1]+e[3]*t[3],s=(r+a)/2,o=Math.sqrt(Ga(r+a,2)-4*(r*a-n*i))/2,l=s+o||1,h=s-o||1;return[Math.sqrt(l),Math.sqrt(h)]}static normalizeRect(e){let t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){let r=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(r>i)return null;let n=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return n>a?null:[r,n,i,a]}static bezierBoundingBox(e,t,r,i,n,a,s,o){let l,h,c,u,d,p,f,m,g=[],v=[[],[]];for(let v=0;v<2;++v)if(0===v?(h=6*e-12*r+6*n,l=-3*e+9*r-9*n+3*s,c=3*r-3*e):(h=6*t-12*i+6*a,l=-3*t+9*i-9*a+3*o,c=3*i-3*t),Math.abs(l)<1e-12){if(Math.abs(h)<1e-12)continue;u=-c/h,0<u&&u<1&&g.push(u)}else f=h*h-4*c*l,m=Math.sqrt(f),!(f<0)&&(d=(-h+m)/(2*l),0<d&&d<1&&g.push(d),p=(-h-m)/(2*l),0<p&&p<1&&g.push(p));let y,b=g.length,x=b;for(;b--;)u=g[b],y=1-u,v[0][b]=y*y*y*e+3*y*y*u*r+3*y*u*u*n+u*u*u*s,v[1][b]=y*y*y*t+3*y*y*u*i+3*y*u*u*a+u*u*u*o;return v[0][x]=e,v[1][x]=t,v[0][x+1]=s,v[1][x+1]=o,v[0].length=v[1].length=x+2,[Math.min(...v[0]),Math.min(...v[1]),Math.max(...v[0]),Math.max(...v[1])]}};let u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function d(e){return decodeURIComponent(escape(e))}r=new WeakMap,t.PromiseCapability=class{constructor(){at(this,r,!1),this.promise=new Promise(((e,t)=>{this.resolve=t=>{Bt(this,r,!0),e(t)},this.reject=e=>{Bt(this,r,!0),t(e)}}))}get settled(){return ce(this,r)}};let p=null,f=null},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var n,t,r,i,Zb,a,ID,l,c,u,h,d,f,p,g,s9,v,b,a9,_,M;Object.defineProperty(exports,"__esModule",{value:!0}),exports.build=exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_is_node=__w_pdfjs_require__(10),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_xfa_text=__w_pdfjs_require__(19);let DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_is_node.isNodeJS?__w_pdfjs_require__(20).NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;let DefaultCMapReaderFactory=_is_node.isNodeJS?__w_pdfjs_require__(20).NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;let DefaultFilterFactory=_is_node.isNodeJS?__w_pdfjs_require__(20).NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;let DefaultStandardFontDataFactory=_is_node.isNodeJS?__w_pdfjs_require__(20).NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory,createPDFNetworkStream;if(exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory,_is_node.isNodeJS){let{PDFNodeStream:e}=__w_pdfjs_require__(21);createPDFNetworkStream=t=>new e(t)}else{let{PDFNetworkStream:e}=__w_pdfjs_require__(24),{PDFFetchStream:t}=__w_pdfjs_require__(25);createPDFNetworkStream=r=>(0,_display_utils.isValidFetchUrl)(r.url)?new t(r):new e(r)}function getDocument(e){var t,r;if("string"==typeof e||e instanceof URL?e={url:e}:(0,_util.isArrayBuffer)(e)&&(e={data:e}),"object"!=typeof e)throw new Error("Invalid parameter in getDocument, need parameter object.");if(!e.url&&!e.data&&!e.range)throw new Error("Invalid parameter object: need either .data, .range or .url");let i=new PDFDocumentLoadingTask,{docId:n}=i,a=e.url?getUrlProp(e.url):null,s=e.data?getDataProp(e.data):null,o=e.httpHeaders||null,l=!0===e.withCredentials,h=null!=(t=e.password)?t:null,c=e.range instanceof PDFDataRangeTransport?e.range:null,u=Number.isInteger(e.rangeChunkSize)&&e.rangeChunkSize>0?e.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE,d=e.worker instanceof PDFWorker?e.worker:null,p=e.verbosity,f="string"!=typeof e.docBaseUrl||(0,_display_utils.isDataScheme)(e.docBaseUrl)?null:e.docBaseUrl,m="string"==typeof e.cMapUrl?e.cMapUrl:null,g=!1!==e.cMapPacked,v=e.CMapReaderFactory||DefaultCMapReaderFactory,y="string"==typeof e.standardFontDataUrl?e.standardFontDataUrl:null,b=e.StandardFontDataFactory||DefaultStandardFontDataFactory,x=!0!==e.stopAtErrors,_=Number.isInteger(e.maxImageSize)&&e.maxImageSize>-1?e.maxImageSize:-1,w=!1!==e.isEvalSupported,S="boolean"==typeof e.isOffscreenCanvasSupported?e.isOffscreenCanvasSupported:!_is_node.isNodeJS,T=Number.isInteger(e.canvasMaxAreaInBytes)?e.canvasMaxAreaInBytes:-1,M="boolean"==typeof e.disableFontFace?e.disableFontFace:_is_node.isNodeJS,E=!0===e.fontExtraProperties,A=!0===e.enableXfa,C=e.ownerDocument||globalThis.document,P=!0===e.disableRange,R=!0===e.disableStream,I=!0===e.disableAutoFetch,O=!0===e.pdfBug,L=c?c.length:null!=(r=e.length)?r:NaN,D="boolean"==typeof e.useSystemFonts?e.useSystemFonts:!_is_node.isNodeJS&&!M,k="boolean"==typeof e.useWorkerFetch?e.useWorkerFetch:v===_display_utils.DOMCMapReaderFactory&&b===_display_utils.DOMStandardFontDataFactory&&(0,_display_utils.isValidFetchUrl)(m,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(y,document.baseURI),F=e.canvasFactory||new DefaultCanvasFactory({ownerDocument:C}),N=e.filterFactory||new DefaultFilterFactory({docId:n,ownerDocument:C});(0,_util.setVerbosityLevel)(p);let U={canvasFactory:F,filterFactory:N};if(k||(U.cMapReaderFactory=new v({baseUrl:m,isCompressed:g}),U.standardFontDataFactory=new b({baseUrl:y})),!d){let e={verbosity:p,port:_worker_options.GlobalWorkerOptions.workerPort};d=e.port?PDFWorker.fromPort(e):new PDFWorker(e),i._worker=d}let B={docId:n,apiVersion:"3.8.162",data:s,password:h,disableAutoFetch:I,rangeChunkSize:u,length:L,docBaseUrl:f,enableXfa:A,evaluatorOptions:{maxImageSize:_,disableFontFace:M,ignoreErrors:x,isEvalSupported:w,isOffscreenCanvasSupported:S,canvasMaxAreaInBytes:T,fontExtraProperties:E,useSystemFonts:D,cMapUrl:k?m:null,standardFontDataUrl:k?y:null}},z={ignoreErrors:x,isEvalSupported:w,disableFontFace:M,fontExtraProperties:E,enableXfa:A,ownerDocument:C,disableAutoFetch:I,pdfBug:O,styleElement:null};return d.promise.then((function(){if(i.destroyed)throw new Error("Loading aborted");let e=_fetchDocument(d,B),t=new Promise((function(e){let t;c?t=new _transport_stream.PDFDataTransportStream({length:L,initialData:c.initialData,progressiveDone:c.progressiveDone,contentDispositionFilename:c.contentDispositionFilename,disableRange:P,disableStream:R},c):s||(t=createPDFNetworkStream({url:a,length:L,httpHeaders:o,withCredentials:l,rangeChunkSize:u,disableRange:P,disableStream:R})),e(t)}));return Promise.all([e,t]).then((function([e,t]){if(i.destroyed)throw new Error("Loading aborted");let r=new _message_handler.MessageHandler(n,e,d.port),a=new WorkerTransport(r,i,t,z,U);i._transport=a,r.send("Ready",null)}))})).catch(i._capability.reject),i}function _fetchDocument(e,t){return bt(this,null,(function*(){if(e.destroyed)throw new Error("Worker was destroyed");let r=yield e.messageHandler.sendWithPromise("GetDocRequest",t,t.data?[t.data.buffer]:null);if(e.destroyed)throw new Error("Worker was destroyed");return r}))}function getUrlProp(e){if(e instanceof URL)return e.href;try{return new URL(e,window.location).href}catch(t){if(_is_node.isNodeJS&&"string"==typeof e)return e}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(e){if(_is_node.isNodeJS&&"undefined"!=typeof Buffer&&e instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength)return e;if("string"==typeof e)return(0,_util.stringToBytes)(e);if("object"==typeof e&&!isNaN(null==e?void 0:e.length)||(0,_util.isArrayBuffer)(e))return new Uint8Array(e);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}let e=class{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId="d"+AM(e,n)._++,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}destroy(){return bt(this,null,(function*(){var e;this.destroyed=!0,yield null==(e=this._transport)?void 0:e.destroy(),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}))}},PDFDocumentLoadingTask=e;n=new WeakMap,at(PDFDocumentLoadingTask,n,0),exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(e,t,r=!1,i=null){this.length=e,this.initialData=t,this.progressiveDone=r,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(let r of this._rangeListeners)r(e,t)}onDataProgress(e,t){this._readyCapability.promise.then((()=>{for(let r of this._progressListeners)r(e,t)}))}onDataProgressiveRead(e){this._readyCapability.promise.then((()=>{for(let t of this._progressiveReadListeners)t(e)}))}onDataProgressiveDone(){this._readyCapability.promise.then((()=>{for(let e of this._progressiveDoneListeners)e()}))}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(e,n,s,o=!1){at(this,i),at(this,a),at(this,t,null),at(this,r,!1),this._pageIndex=e,this._pageInfo=n,this._transport=s,this._stats=o?new _display_utils.StatTimer:null,this._pdfBug=o,this.commonObjs=s.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:r=0,offsetY:i=0,dontFlip:n=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:e,rotation:t,offsetX:r,offsetY:i,dontFlip:n})}getAnnotations({intent:e="display"}={}){let t=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}getXfa(){return bt(this,null,(function*(){var e;return(null==(e=this._transport._htmlForXfa)?void 0:e.children[this._pageIndex])||null}))}render({canvasContext:e,viewport:t,intent:n="display",annotationMode:s=_util.AnnotationMode.ENABLE,transform:o=null,background:l=null,optionalContentConfigPromise:h=null,annotationCanvasMap:c=null,pageColors:u=null,printAnnotationStorage:d=null}){var p,f;null==(p=this._stats)||p.time("Overall");let m=this._transport.getRenderingIntent(n,s,d);Bt(this,r,!1),Et(this,a,ID).call(this),h||(h=this._transport.getOptionalContentConfig());let g=this._intentStates.get(m.cacheKey);g||(g=Object.create(null),this._intentStates.set(m.cacheKey,g)),g.streamReaderCancelTimeout&&(clearTimeout(g.streamReaderCancelTimeout),g.streamReaderCancelTimeout=null);let v=!!(m.renderingIntent&_util.RenderingIntentFlag.PRINT);g.displayReadyCapability||(g.displayReadyCapability=new _util.PromiseCapability,g.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},null==(f=this._stats)||f.time("Page Request"),this._pumpOperatorList(m));let y=e=>{var t,n;g.renderTasks.delete(b),(this._maybeCleanupAfterRender||v)&&Bt(this,r,!0),Et(this,i,Zb).call(this,!v),e?(b.capability.reject(e),this._abortOperatorList({intentState:g,reason:e instanceof Error?e:new Error(e)})):b.capability.resolve(),null==(t=this._stats)||t.timeEnd("Rendering"),null==(n=this._stats)||n.timeEnd("Overall")},b=new InternalRenderTask({callback:y,params:{canvasContext:e,viewport:t,transform:o,background:l},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:g.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!v,pdfBug:this._pdfBug,pageColors:u});(g.renderTasks||(g.renderTasks=new Set)).add(b);let x=b.task;return Promise.all([g.displayReadyCapability.promise,h]).then((([e,t])=>{var r;this.destroyed?y():(null==(r=this._stats)||r.time("Rendering"),b.initializeGraphics({transparency:e,optionalContentConfig:t}),b.operatorListChanged())})).catch(y),x}getOperatorList({intent:e="display",annotationMode:t=_util.AnnotationMode.ENABLE,printAnnotationStorage:r=null}={}){var i;let n,a=this._transport.getRenderingIntent(e,t,r,!0),s=this._intentStates.get(a.cacheKey);return s||(s=Object.create(null),this._intentStates.set(a.cacheKey,s)),s.opListReadCapability||(n=Object.create(null),n.operatorListChanged=function(){s.operatorList.lastChunk&&(s.opListReadCapability.resolve(s.operatorList),s.renderTasks.delete(n))},s.opListReadCapability=new _util.PromiseCapability,(s.renderTasks||(s.renderTasks=new Set)).add(n),s.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},null==(i=this._stats)||i.time("Page Request"),this._pumpOperatorList(a)),s.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===e,disableNormalization:!0===t},{highWaterMark:100,size:e=>e.items.length})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then((e=>_xfa_text.XfaText.textContent(e)));let t=this.streamTextContent(e);return new Promise((function(e,r){let i=t.getReader(),n={items:[],styles:Object.create(null)};!function t(){i.read().then((function({value:r,done:i}){i?e(n):(Object.assign(n.styles,r.styles),n.items.push(...r.items),t())}),r)}()}))}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let e=[];for(let t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(let r of t.renderTasks)e.push(r.completed),r.cancel();return this.objs.clear(),Bt(this,r,!1),Et(this,a,ID).call(this),Promise.all(e)}cleanup(e=!1){Bt(this,r,!0);let t=Et(this,i,Zb).call(this,!1);return e&&t&&this._stats&&(this._stats=new _display_utils.StatTimer),t}_startRenderPage(e,t){var r,i;let n=this._intentStates.get(t);n&&(null==(r=this._stats)||r.timeEnd("Page Request"),null==(i=n.displayReadyCapability)||i.resolve(e))}_renderPageChunk(e,t){for(let r=0,i=e.length;r<i;r++)t.operatorList.fnArray.push(e.fnArray[r]),t.operatorList.argsArray.push(e.argsArray[r]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(let e of t.renderTasks)e.operatorListChanged();e.lastChunk&&Et(this,i,Zb).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:r}){let{map:n,transfers:a}=r,s=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:n},a).getReader(),o=this._intentStates.get(t);o.streamReader=s;let l=()=>{s.read().then((({value:e,done:t})=>{t?o.streamReader=null:this._transport.destroyed||(this._renderPageChunk(e,o),l())}),(e=>{if(o.streamReader=null,!this._transport.destroyed){if(o.operatorList){o.operatorList.lastChunk=!0;for(let e of o.renderTasks)e.operatorListChanged();Et(this,i,Zb).call(this,!0)}if(o.displayReadyCapability)o.displayReadyCapability.reject(e);else{if(!o.opListReadCapability)throw e;o.opListReadCapability.reject(e)}}}))};l()}_abortOperatorList({intentState:e,reason:t,force:r=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!r){if(e.renderTasks.size>0)return;if(t instanceof _display_utils.RenderingCancelledException){let r=RENDERING_CANCELLED_TIMEOUT;return t.extraDelay>0&&t.extraDelay<1e3&&(r+=t.extraDelay),void(e.streamReaderCancelTimeout=setTimeout((()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})}),r))}}if(e.streamReader.cancel(new _util.AbortException(t.message)).catch((()=>{})),e.streamReader=null,!this._transport.destroyed){for(let[t,r]of this._intentStates)if(r===e){this._intentStates.delete(t);break}this.cleanup()}}}get stats(){return this._stats}}t=new WeakMap,r=new WeakMap,i=new WeakSet,Zb=function(e=!1){if(Et(this,a,ID).call(this),!ce(this,r)||this.destroyed)return!1;if(e)return Bt(this,t,setTimeout((()=>{Bt(this,t,null),Et(this,i,Zb).call(this,!1)}),DELAYED_CLEANUP_TIMEOUT)),!1;for(let{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),Bt(this,r,!1),!0},a=new WeakSet,ID=function(){ce(this,t)&&(clearTimeout(ce(this,t)),Bt(this,t,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){at(this,l,new Set),at(this,c,Promise.resolve())}postMessage(e,t){let r={data:structuredClone(e,t?{transfer:t}:null)};ce(this,c).then((()=>{for(let e of ce(this,l))e.call(this,r)}))}addEventListener(e,t){ce(this,l).add(t)}removeEventListener(e,t){ce(this,l).delete(t)}terminate(){ce(this,l).clear()}}l=new WeakMap,c=new WeakMap,exports.LoopbackPort=LoopbackPort;let PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};if(exports.PDFWorkerUtil=PDFWorkerUtil,_is_node.isNodeJS&&"function"==typeof sk)PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if("object"==typeof document){let e=null==(u=null==document?void 0:document.currentScript)?void 0:u.src;e&&(PDFWorkerUtil.fallbackWorkerSrc=e.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(e,t){let r;try{if(r=new URL(e),!r.origin||"null"===r.origin)return!1}catch(e){return!1}let i=new URL(t,r);return r.origin===i.origin},PDFWorkerUtil.createCDNWrapper=function(e){let t=`importScripts("${e}");`;return URL.createObjectURL(new Blob([t]))};let _PDFWorker=class{constructor({name:e=null,port:t=null,verbosity:r=(0,_util.getVerbosityLevel)()}={}){if(t&&ce(_PDFWorker,h).has(t))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=e,this.destroyed=!1,this.verbosity=r,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,t)return ce(_PDFWorker,h).set(t,this),void this._initializeFromPort(t);this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new _message_handler.MessageHandler("main","worker",e),this._messageHandler.on("ready",(function(){})),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:e}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,e)||(e=PDFWorkerUtil.createCDNWrapper(new URL(e,window.location).href));let t=new Worker(e),r=new _message_handler.MessageHandler("main","worker",t),i=()=>{t.removeEventListener("error",n),r.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},n=()=>{this._webWorker||i()};t.addEventListener("error",n),r.on("test",(e=>{t.removeEventListener("error",n),this.destroyed?i():e?(this._messageHandler=r,this._port=t,this._webWorker=t,this._readyCapability.resolve(),r.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),r.destroy(),t.terminate())})),r.on("ready",(e=>{if(t.removeEventListener("error",n),this.destroyed)i();else try{a()}catch(e){this._setupFakeWorker()}}));let a=()=>{let e=new Uint8Array;r.send("test",e,[e.buffer])};return void a()}catch(e){(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then((e=>{if(this.destroyed)return void this._readyCapability.reject(new Error("Worker was destroyed"));let t=new LoopbackPort;this._port=t;let r="fake"+PDFWorkerUtil.fakeWorkerId++,i=new _message_handler.MessageHandler(r+"_worker",r,t);e.setup(i,t);let n=new _message_handler.MessageHandler(r,r+"_worker",t);this._messageHandler=n,this._readyCapability.resolve(),n.send("configure",{verbosity:this.verbosity})})).catch((e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))}))}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),ce(_PDFWorker,h).delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(e){if(null==e||!e.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return ce(this,h).has(e.port)?ce(this,h).get(e.port):new _PDFWorker(e)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(null!==PDFWorkerUtil.fallbackWorkerSrc)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var e;try{return(null==(e=globalThis.pdfjsWorker)?void 0:e.WorkerMessageHandler)||null}catch(e){return null}}static get _setupFakeWorkerGlobal(){let loader=()=>bt(this,null,(function*(){let mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS&&"function"==typeof sk){let worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return yield(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler}));return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}},PDFWorker=_PDFWorker;h=new WeakMap,at(PDFWorker,h,new WeakMap),exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(e,t,r,i,n){at(this,g),at(this,d,new Map),at(this,f,new Map),at(this,p,new Map),this.messageHandler=e,this.loadingTask=t,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this._params=i,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=r,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(e,t=_util.AnnotationMode.ENABLE,r=null,i=!1){let n=_util.RenderingIntentFlag.DISPLAY,a=_annotation_storage.SerializableEmpty;switch(e){case"any":n=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":n=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${e}`)}switch(t){case _util.AnnotationMode.DISABLE:n+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:n+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:n+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,a=(n&_util.RenderingIntentFlag.PRINT&&r instanceof _annotation_storage.PrintAnnotationStorage?r:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${t}`)}return i&&(n+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:n,cacheKey:`${n}_${a.hash}`,annotationStorageSerializable:a}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));let e=[];for(let t of ce(this,f).values())e.push(t._destroy());ce(this,f).clear(),ce(this,p).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then((()=>{this.commonObjs.clear(),this.fontLoader.clear(),ce(this,d).clear(),this.filterFactory.destroy(),this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()}),this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:e,loadingTask:t}=this;e.on("GetReader",((e,t)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=e=>{this._lastProgress={loaded:e.loaded,total:e.total}},t.onPull=()=>{this._fullReader.read().then((function({value:e,done:r}){r?t.close():((0,_util.assert)(e instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(e),1,[e]))})).catch((e=>{t.error(e)}))},t.onCancel=e=>{this._fullReader.cancel(e),t.ready.catch((e=>{if(!this.destroyed)throw e}))}})),e.on("ReaderHeadersReady",(e=>{let r=new _util.PromiseCapability,i=this._fullReader;return i.headersReady.then((()=>{var e;(!i.isStreamingSupported||!i.isRangeSupported)&&(this._lastProgress&&(null==(e=t.onProgress)||e.call(t,this._lastProgress)),i.onProgress=e=>{var r;null==(r=t.onProgress)||r.call(t,{loaded:e.loaded,total:e.total})}),r.resolve({isStreamingSupported:i.isStreamingSupported,isRangeSupported:i.isRangeSupported,contentLength:i.contentLength})}),r.reject),r.promise})),e.on("GetRangeReader",((e,t)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let r=this._networkStream.getRangeReader(e.begin,e.end);r?(t.onPull=()=>{r.read().then((function({value:e,done:r}){r?t.close():((0,_util.assert)(e instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(e),1,[e]))})).catch((e=>{t.error(e)}))},t.onCancel=e=>{r.cancel(e),t.ready.catch((e=>{if(!this.destroyed)throw e}))}):t.close()})),e.on("GetDoc",(({pdfInfo:e})=>{this._numPages=e.numPages,this._htmlForXfa=e.htmlForXfa,delete e.htmlForXfa,t._capability.resolve(new PDFDocumentProxy(e,this))})),e.on("DocException",(function(e){let r;switch(e.name){case"PasswordException":r=new _util.PasswordException(e.message,e.code);break;case"InvalidPDFException":r=new _util.InvalidPDFException(e.message);break;case"MissingPDFException":r=new _util.MissingPDFException(e.message);break;case"UnexpectedResponseException":r=new _util.UnexpectedResponseException(e.message,e.status);break;case"UnknownErrorException":r=new _util.UnknownErrorException(e.message,e.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}t._capability.reject(r)})),e.on("PasswordRequest",(e=>{if(this._passwordCapability=new _util.PromiseCapability,t.onPassword){let r=e=>{e instanceof Error?this._passwordCapability.reject(e):this._passwordCapability.resolve({password:e})};try{t.onPassword(r,e.code)}catch(e){this._passwordCapability.reject(e)}}else this._passwordCapability.reject(new _util.PasswordException(e.message,e.code));return this._passwordCapability.promise})),e.on("DataLoaded",(e=>{var r;null==(r=t.onProgress)||r.call(t,{loaded:e.length,total:e.length}),this.downloadInfoCapability.resolve(e)})),e.on("StartRenderPage",(e=>{this.destroyed||ce(this,f).get(e.pageIndex)._startRenderPage(e.transparency,e.cacheKey)})),e.on("commonobj",(([t,r,i])=>{var n;if(!this.destroyed&&!this.commonObjs.has(t))switch(r){case"Font":let a=this._params;if("error"in i){let e=i.error;(0,_util.warn)(`Error during font loading: ${e}`),this.commonObjs.resolve(t,e);break}let s=a.pdfBug&&null!=(n=globalThis.FontInspector)&&n.enabled?(e,t)=>globalThis.FontInspector.fontAdded(e,t):null,o=new _font_loader.FontFaceObject(i,{isEvalSupported:a.isEvalSupported,disableFontFace:a.disableFontFace,ignoreErrors:a.ignoreErrors,inspectFont:s});this.fontLoader.bind(o).catch((r=>e.sendWithPromise("FontFallback",{id:t}))).finally((()=>{!a.fontExtraProperties&&o.data&&(o.data=null),this.commonObjs.resolve(t,o)}));break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(t,i);break;default:throw new Error(`Got unknown common object type ${r}`)}})),e.on("obj",(([e,t,r,i])=>{var n;if(this.destroyed)return;let a=ce(this,f).get(t);if(!a.objs.has(e))switch(r){case"Image":if(a.objs.resolve(e,i),i){let e;if(i.bitmap){let{width:t,height:r}=i;e=t*r*4}else e=(null==(n=i.data)?void 0:n.length)||0;e>_util.MAX_IMAGE_SIZE_TO_CACHE&&(a._maybeCleanupAfterRender=!0)}break;case"Pattern":a.objs.resolve(e,i);break;default:throw new Error(`Got unknown object type ${r}`)}})),e.on("DocProgress",(e=>{var r;this.destroyed||null==(r=t.onProgress)||r.call(t,{loaded:e.loaded,total:e.total})})),e.on("FetchBuiltInCMap",(e=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(e):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.")))),e.on("FetchStandardFontData",(e=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(e):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter."))))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var e,t;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:r,transfers:i}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:r,filename:null!=(t=null==(e=this._fullReader)?void 0:e.filename)?t:null},i).finally((()=>{this.annotationStorage.resetModified()}))}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));let t=e-1,r=ce(this,p).get(t);if(r)return r;let i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then((e=>{if(this.destroyed)throw new Error("Transport destroyed");let r=new PDFPageProxy(t,e,this,this._params.pdfBug);return ce(this,f).set(t,r),r}));return ce(this,p).set(t,i),i}getPageIndex(e){return"object"!=typeof e||null===e||!Number.isInteger(e.num)||e.num<0||!Number.isInteger(e.gen)||e.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen})}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return Et(this,g,s9).call(this,"GetFieldObjects")}hasJSActions(){return Et(this,g,s9).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return"string"!=typeof e?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then((e=>new _optional_content_config.OptionalContentConfig(e)))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let e="GetMetadata",t=ce(this,d).get(e);if(t)return t;let r=this.messageHandler.sendWithPromise(e,null).then((e=>{var t,r,i,n;return{info:e[0],metadata:e[1]?new _metadata.Metadata(e[1]):null,contentDispositionFilename:null!=(r=null==(t=this._fullReader)?void 0:t.filename)?r:null,contentLength:null!=(n=null==(i=this._fullReader)?void 0:i.contentLength)?n:null}}));return ce(this,d).set(e,r),r}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}startCleanup(e=!1){return bt(this,null,(function*(){if(!this.destroyed){yield this.messageHandler.sendWithPromise("Cleanup",null);for(let e of ce(this,f).values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),ce(this,d).clear(),this.filterFactory.destroy(!0)}}))}get loadingParams(){let{disableAutoFetch:e,enableXfa:t}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:e,enableXfa:t})}}d=new WeakMap,f=new WeakMap,p=new WeakMap,g=new WeakSet,s9=function(e,t=null){let r=ce(this,d).get(e);if(r)return r;let i=this.messageHandler.sendWithPromise(e,t);return ce(this,d).set(e,i),i};class PDFObjects{constructor(){at(this,b),at(this,v,Object.create(null))}get(e,t=null){if(t){let r=Et(this,b,a9).call(this,e);return r.capability.promise.then((()=>t(r.data))),null}let r=ce(this,v)[e];if(null==r||!r.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return r.data}has(e){let t=ce(this,v)[e];return(null==t?void 0:t.capability.settled)||!1}resolve(e,t=null){let r=Et(this,b,a9).call(this,e);r.data=t,r.capability.resolve()}clear(){var e;for(let t in ce(this,v)){let{data:r}=ce(this,v)[t];null==(e=null==r?void 0:r.bitmap)||e.close()}Bt(this,v,Object.create(null))}}v=new WeakMap,b=new WeakSet,a9=function(e){return ce(this,v)[e]||(ce(this,v)[e]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(e){at(this,_,null),Bt(this,_,e),this.onContinue=null}get promise(){return ce(this,_).capability.promise}cancel(e=0){ce(this,_).cancel(null,e)}get separateAnnots(){let{separateAnnots:e}=ce(this,_).operatorList;if(!e)return!1;let{annotationCanvasMap:t}=ce(this,_);return e.form||e.canvas&&(null==t?void 0:t.size)>0}}_=new WeakMap,exports.RenderTask=RenderTask;let S=class{constructor({callback:e,params:t,objs:r,commonObjs:i,annotationCanvasMap:n,operatorList:a,pageIndex:s,canvasFactory:o,filterFactory:l,useRequestAnimationFrame:h=!1,pdfBug:c=!1,pageColors:u=null}){this.callback=e,this.params=t,this.objs=r,this.commonObjs=i,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=s,this.canvasFactory=o,this.filterFactory=l,this._pdfBug=c,this.pageColors=u,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===h&&"undefined"!=typeof window,this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch((function(){}))}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var r,i;if(this.cancelled)return;if(this._canvas){if(ce(S,M).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");ce(S,M).add(this._canvas)}this._pdfBug&&null!=(r=globalThis.StepperManager)&&r.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:n,viewport:a,transform:s,background:o}=this.params;this.gfx=new _canvas.CanvasGraphics(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:s,viewport:a,transparency:e,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,null==(i=this.graphicsReadyCallback)||i.call(this)}cancel(e=null,t=0){var r;this.running=!1,this.cancelled=!0,null==(r=this.gfx)||r.endDrawing(),this._canvas&&ce(S,M).delete(this._canvas),this.callback(e||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){var e;this.graphicsReady?(null==(e=this.stepper)||e.updateOperatorList(this.operatorList),!this.running&&this._continue()):this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound)}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame((()=>{this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}_next(){return bt(this,null,(function*(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(this.pageColors),this._canvas&&ce(S,M).delete(this._canvas),this.callback())))}))}},InternalRenderTask=S;M=new WeakMap,at(InternalRenderTask,M,new WeakSet);let version="3.8.162";exports.version=version;let build="2c74323e3";exports.build=build},(e,t,r)=>{var i,n,a,s,o;Object.defineProperty(t,"__esModule",{value:!0}),t.SerializableEmpty=t.PrintAnnotationStorage=t.AnnotationStorage=void 0;var l=r(1),h=r(4),c=r(8);let u=Object.freeze({map:null,hash:"",transfers:void 0});t.SerializableEmpty=u;class d{constructor(){at(this,a),at(this,i,!1),at(this,n,new Map),this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){let r=ce(this,n).get(e);return void 0===r?t:Object.assign(t,r)}getRawValue(e){return ce(this,n).get(e)}remove(e){if(ce(this,n).delete(e),0===ce(this,n).size&&this.resetModified(),"function"==typeof this.onAnnotationEditor){for(let e of ce(this,n).values())if(e instanceof h.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(e,t){let r=ce(this,n).get(e),i=!1;if(void 0!==r)for(let[e,n]of Object.entries(t))r[e]!==n&&(i=!0,r[e]=n);else i=!0,ce(this,n).set(e,t);i&&Et(this,a,s).call(this),t instanceof h.AnnotationEditor&&"function"==typeof this.onAnnotationEditor&&this.onAnnotationEditor(t.constructor._type)}has(e){return ce(this,n).has(e)}getAll(){return ce(this,n).size>0?(0,l.objectFromMap)(ce(this,n)):null}setAll(e){for(let[t,r]of Object.entries(e))this.setValue(t,r)}get size(){return ce(this,n).size}resetModified(){ce(this,i)&&(Bt(this,i,!1),"function"==typeof this.onResetModified&&this.onResetModified())}get print(){return new p(this)}get serializable(){if(0===ce(this,n).size)return u;let e=new Map,t=new c.MurmurHash3_64,r=[];for(let[i,a]of ce(this,n)){let n=a instanceof h.AnnotationEditor?a.serialize():a;n&&(e.set(i,n),t.update(`${i}:${JSON.stringify(n)}`),n.bitmap&&r.push(n.bitmap))}return e.size>0?{map:e,hash:t.hexdigest(),transfers:r}:u}}i=new WeakMap,n=new WeakMap,a=new WeakSet,s=function(){ce(this,i)||(Bt(this,i,!0),"function"==typeof this.onSetModified&&this.onSetModified())},t.AnnotationStorage=d;class p extends d{constructor(e){super(),at(this,o,void 0);let{map:t,hash:r,transfers:i}=e.serializable,n=structuredClone(t,i?{transfer:i}:null);Bt(this,o,{map:n,hash:r,transfers:i})}get print(){(0,l.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return ce(this,o)}}o=new WeakMap,t.PrintAnnotationStorage=p},(e,t,r)=>{var i,n,a,s,o,l;Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationEditor=void 0;var h=r(5),c=r(1);let u=class{constructor(e){at(this,i,this.focusin.bind(this)),at(this,n,this.focusout.bind(this)),at(this,a,!1),at(this,s,!1),at(this,o,!1),Es(this,"_uiManager",null),at(this,l,u._zIndex++),this.constructor===u&&(0,c.unreachable)("Cannot initialize AnnotationEditor."),this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null;let{rotation:t,rawDims:{pageWidth:r,pageHeight:h,pageX:d,pageY:p}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[r,h],this.pageTranslation=[d,p];let[f,m]=this.parentDimensions;this.x=e.x/f,this.y=e.y/m,this.isAttachedToDOM=!1,this.deleted=!1}static get _defaultLineColor(){return(0,c.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){let t=new p({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=ce(this,l)}setParent(e){null!==e&&(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions),this.parent=e}focusin(e){ce(this,a)?Bt(this,a,!1):this.parent.setSelected(this)}focusout(e){var t;if(!this.isAttachedToDOM)return;let r=e.relatedTarget;null!=r&&r.closest(`#${this.id}`)||(e.preventDefault(),null!=(t=this.parent)&&t.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}dragstart(e){let t=this.parent.div.getBoundingClientRect();this.startX=e.clientX-t.x,this.startY=e.clientY-t.y,e.dataTransfer.setData("text/plain",this.id),e.dataTransfer.effectAllowed="move"}setAt(e,t,r,i){let[n,a]=this.parentDimensions;[r,i]=this.screenToPageTranslation(r,i),this.x=(e+r)/n,this.y=(t+i)/a,this.div.style.left=100*this.x+"%",this.div.style.top=100*this.y+"%"}translate(e,t){let[r,i]=this.parentDimensions;[e,t]=this.screenToPageTranslation(e,t),this.x+=e/r,this.y+=t/i,this.div.style.left=100*this.x+"%",this.div.style.top=100*this.y+"%"}screenToPageTranslation(e,t){switch(this.parentRotation){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{realScale:e}=this._uiManager.viewParameters,[t,r]=this.pageDimensions;return[t*e,r*e]}setDims(e,t){let[r,i]=this.parentDimensions;this.div.style.width=100*e/r+"%",this.div.style.height=100*t/i+"%"}fixDims(){let{style:e}=this.div,{height:t,width:r}=e,i=r.endsWith("%"),n=t.endsWith("%");if(i&&n)return;let[a,s]=this.parentDimensions;i||(e.width=100*parseFloat(r)/a+"%"),n||(e.height=100*parseFloat(t)/s+"%")}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",ce(this,i)),this.div.addEventListener("focusout",ce(this,n));let[e,t]=this.getInitialTranslation();return this.translate(e,t),(0,h.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(e){let{isMac:t}=c.FeatureTest.platform;0!==e.button||e.ctrlKey&&t?e.preventDefault():(e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this),Bt(this,a,!0))}getRect(e,t){let r=this.parentScale,[i,n]=this.pageDimensions,[a,s]=this.pageTranslation,o=e/r,l=t/r,h=this.x*i,c=this.y*n,u=this.width*i,d=this.height*n;switch(this.rotation){case 0:return[h+o+a,n-c-l-d+s,h+o+u+a,n-c-l+s];case 90:return[h+l+a,n-c+o+s,h+l+d+a,n-c+o+u+s];case 180:return[h-o-u+a,n-c+l+s,h-o+a,n-c+l+d+s];case 270:return[h-l-d+a,n-c-o-u+s,h-l+a,n-c-o+s];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){let[r,i,n,a]=e,s=n-r,o=a-i;switch(this.rotation){case 0:return[r,t-a,s,o];case 90:return[r,t-i,o,s];case 180:return[n,t-i,s,o];case 270:return[n,t-a,o,s];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){Bt(this,o,!0)}disableEditMode(){Bt(this,o,!1)}isInEditMode(){return ce(this,o)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var e,t;null==(e=this.div)||e.addEventListener("focusin",ce(this,i)),null==(t=this.div)||t.addEventListener("focusout",ce(this,n))}serialize(e=!1){(0,c.unreachable)("An editor must be serializable")}static deserialize(e,t,r){let i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:r});i.rotation=e.rotation;let[n,a]=i.pageDimensions,[s,o,l,h]=i.getRectInCurrentCoords(e.rect,a);return i.x=s/n,i.y=o/a,i.width=l/n,i.height=h/a,i}remove(){this.div.removeEventListener("focusin",ce(this,i)),this.div.removeEventListener("focusout",ce(this,n)),this.isEmpty()||this.commit(),this.parent.remove(this)}select(){var e;null==(e=this.div)||e.classList.add("selectedEditor")}unselect(){var e;null==(e=this.div)||e.classList.remove("selectedEditor")}updateParams(e,t){}disableEditing(){}enableEditing(){}get propertiesToUpdate(){return{}}get contentDiv(){return this.div}get isEditing(){return ce(this,s)}set isEditing(e){Bt(this,s,e),e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null)}},d=u;i=new WeakMap,n=new WeakMap,a=new WeakMap,s=new WeakMap,o=new WeakMap,l=new WeakMap,Es(d,"_colorManager",new h.ColorManager),Es(d,"_zIndex",1),t.AnnotationEditor=d;class p extends d{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(e,t,r)=>{var i,n,a,s,o,l,h,c,u,d,p,f,m,g,v,y,b,x,_,w,S,T,M,E,A,C,P,R,I,O,L,D,k,F,N,U,B,z,H,V,j,G,W,X,q,Y,$,Z,K,J,Q,ee,te;Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardManager=t.CommandManager=t.ColorManager=t.AnnotationEditorUIManager=void 0,t.bindEvents=function(e,t,r){for(let i of r)t.addEventListener(i,e[i].bind(e))},t.opacityToHex=function(e){return Math.round(Math.min(255,Math.max(1,255*e))).toString(16).padStart(2,"0")};var re=r(1),ie=r(6);class ne{constructor(){at(this,i,0)}getId(){return`${re.AnnotationEditorPrefix}${AM(this,i)._++}`}}i=new WeakMap;class ae{constructor(e=128){at(this,n,[]),at(this,a,!1),at(this,s,void 0),at(this,o,-1),Bt(this,s,e)}add({cmd:e,undo:t,mustExec:r,type:i=NaN,overwriteIfSameType:l=!1,keepUndo:h=!1}){if(r&&e(),ce(this,a))return;let c={cmd:e,undo:t,type:i};if(-1===ce(this,o))return ce(this,n).length>0&&(ce(this,n).length=0),Bt(this,o,0),void ce(this,n).push(c);if(l&&ce(this,n)[ce(this,o)].type===i)return h&&(c.undo=ce(this,n)[ce(this,o)].undo),void(ce(this,n)[ce(this,o)]=c);let u=ce(this,o)+1;u===ce(this,s)?ce(this,n).splice(0,1):(Bt(this,o,u),u<ce(this,n).length&&ce(this,n).splice(u)),ce(this,n).push(c)}undo(){-1!==ce(this,o)&&(Bt(this,a,!0),ce(this,n)[ce(this,o)].undo(),Bt(this,a,!1),Bt(this,o,ce(this,o)-1))}redo(){ce(this,o)<ce(this,n).length-1&&(Bt(this,o,ce(this,o)+1),Bt(this,a,!0),ce(this,n)[ce(this,o)].cmd(),Bt(this,a,!1))}hasSomethingToUndo(){return-1!==ce(this,o)}hasSomethingToRedo(){return ce(this,o)<ce(this,n).length-1}destroy(){Bt(this,n,null)}}n=new WeakMap,a=new WeakMap,s=new WeakMap,o=new WeakMap,t.CommandManager=ae;class se{constructor(e){at(this,l),this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:t}=re.FeatureTest.platform;for(let[r,i,n=!1]of e)for(let e of r){let r=e.startsWith("mac+");t&&r?(this.callbacks.set(e.slice(4),{callback:i,bubbles:n}),this.allKeys.add(e.split("+").at(-1))):!t&&!r&&(this.callbacks.set(e,{callback:i,bubbles:n}),this.allKeys.add(e.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;let r=this.callbacks.get(Et(this,l,h).call(this,t));if(!r)return;let{callback:i,bubbles:n}=r;i.bind(e)(),n||(t.stopPropagation(),t.preventDefault())}}l=new WeakSet,h=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);let t=this.buffer.join("+");return this.buffer.length=0,t},t.KeyboardManager=se;let oe=class{get _colors(){let e=new Map([["CanvasText",null],["Canvas",null]]);return(0,ie.getColorValues)(e),(0,re.shadow)(this,"_colors",e)}convert(e){let t=(0,ie.getRGB)(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(let[e,r]of this._colors)if(r.every(((e,r)=>e===t[r])))return oe._colorsMapping.get(e);return t}getHexCode(e){let t=this._colors.get(e);return t?re.Util.makeHexColor(...t):e}},le=oe;Es(le,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]])),t.ColorManager=le;let he=class{constructor(e,t,r){at(this,D),at(this,F),at(this,U),at(this,z),at(this,V),at(this,G),at(this,X),at(this,Y),at(this,Z),at(this,J),at(this,ee),at(this,c,null),at(this,u,new Map),at(this,d,new Map),at(this,p,null),at(this,f,new ae),at(this,m,0),at(this,g,new Set),at(this,v,null),at(this,y,new Set),at(this,b,null),at(this,x,new ne),at(this,_,!1),at(this,w,re.AnnotationEditorType.NONE),at(this,S,new Set),at(this,T,this.copy.bind(this)),at(this,M,this.cut.bind(this)),at(this,E,this.paste.bind(this)),at(this,A,this.keydown.bind(this)),at(this,C,this.onEditingAction.bind(this)),at(this,P,this.onPageChanging.bind(this)),at(this,R,this.onScaleChanging.bind(this)),at(this,I,this.onRotationChanging.bind(this)),at(this,O,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1}),at(this,L,null),Bt(this,L,e),Bt(this,b,t),ce(this,b)._on("editingaction",ce(this,C)),ce(this,b)._on("pagechanging",ce(this,P)),ce(this,b)._on("scalechanging",ce(this,R)),ce(this,b)._on("rotationchanging",ce(this,I)),Bt(this,p,r),this.viewParameters={realScale:ie.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){return(0,re.shadow)(this,"_keyboardManager",new se([[["ctrl+a","mac+meta+a"],he.prototype.selectAll],[["ctrl+z","mac+meta+z"],he.prototype.undo],[["ctrl+y","ctrl+shift+Z","mac+meta+shift+Z"],he.prototype.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete"],he.prototype.delete],[["Escape","mac+Escape"],he.prototype.unselectAll]]))}destroy(){Et(this,F,N).call(this),ce(this,b)._off("editingaction",ce(this,C)),ce(this,b)._off("pagechanging",ce(this,P)),ce(this,b)._off("scalechanging",ce(this,R)),ce(this,b)._off("rotationchanging",ce(this,I));for(let e of ce(this,d).values())e.destroy();ce(this,d).clear(),ce(this,u).clear(),ce(this,y).clear(),Bt(this,c,null),ce(this,S).clear(),ce(this,f).destroy()}onPageChanging({pageNumber:e}){Bt(this,m,e-1)}focusMainContainer(){ce(this,L).focus()}addShouldRescale(e){ce(this,y).add(e)}removeShouldRescale(e){ce(this,y).delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*ie.PixelsPerInch.PDF_TO_CSS_UNITS;for(let e of ce(this,y))e.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}addToAnnotationStorage(e){!e.isEmpty()&&ce(this,p)&&!ce(this,p).has(e.id)&&ce(this,p).setValue(e.id,e)}copy(e){if(e.preventDefault(),ce(this,c)&&ce(this,c).commitOrRemove(),!this.hasSelection)return;let t=[];for(let e of ce(this,S)){let r=e.serialize(!0);r&&t.push(r)}0!==t.length&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}paste(e){e.preventDefault();let t=e.clipboardData.getData("application/pdfjs");if(!t)return;try{t=JSON.parse(t)}catch(e){return void(0,re.warn)(`paste: "${e.message}".`)}if(!Array.isArray(t))return;this.unselectAll();let r=ce(this,d).get(ce(this,m));try{let e=[];for(let i of t){let t=r.deserialize(i);if(!t)return;e.push(t)}let i=()=>{for(let t of e)Et(this,Z,K).call(this,t);Et(this,ee,te).call(this,e)},n=()=>{for(let t of e)t.remove()};this.addCommands({cmd:i,undo:n,mustExec:!0})}catch(e){(0,re.warn)(`paste: "${e.message}".`)}}keydown(e){var t;null!=(t=this.getActive())&&t.shouldGetKeyboardEvents()||he._keyboardManager.exec(this,e)}onEditingAction(e){["undo","redo","delete","selectAll"].includes(e.name)&&this[e.name]()}setEditingState(e){e?(Et(this,D,k).call(this),Et(this,U,B).call(this),Et(this,V,j).call(this,{isEditing:ce(this,w)!==re.AnnotationEditorType.NONE,isEmpty:Et(this,J,Q).call(this),hasSomethingToUndo:ce(this,f).hasSomethingToUndo(),hasSomethingToRedo:ce(this,f).hasSomethingToRedo(),hasSelectedEditor:!1})):(Et(this,F,N).call(this),Et(this,z,H).call(this),Et(this,V,j).call(this,{isEditing:!1}))}registerEditorTypes(e){if(!ce(this,v)){Bt(this,v,e);for(let e of ce(this,v))Et(this,G,W).call(this,e.defaultPropertiesToUpdate)}}getId(){return ce(this,x).getId()}get currentLayer(){return ce(this,d).get(ce(this,m))}get currentPageIndex(){return ce(this,m)}addLayer(e){ce(this,d).set(e.pageIndex,e),ce(this,_)?e.enable():e.disable()}removeLayer(e){ce(this,d).delete(e.pageIndex)}updateMode(e){if(Bt(this,w,e),e===re.AnnotationEditorType.NONE)this.setEditingState(!1),Et(this,Y,$).call(this);else{this.setEditingState(!0),Et(this,X,q).call(this);for(let t of ce(this,d).values())t.updateMode(e)}}updateToolbar(e){e!==ce(this,w)&&ce(this,b).dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){if(ce(this,v)){for(let r of ce(this,S))r.updateParams(e,t);for(let r of ce(this,v))r.updateDefaultParams(e,t)}}getEditors(e){let t=[];for(let r of ce(this,u).values())r.pageIndex===e&&t.push(r);return t}getEditor(e){return ce(this,u).get(e)}addEditor(e){ce(this,u).set(e.id,e)}removeEditor(e){var t;ce(this,u).delete(e.id),this.unselect(e),(!e.annotationElementId||!ce(this,g).has(e.annotationElementId))&&(null==(t=ce(this,p))||t.remove(e.id))}addDeletedAnnotationElement(e){ce(this,g).add(e.annotationElementId),e.deleted=!0}isDeletedAnnotationElement(e){return ce(this,g).has(e)}removeDeletedAnnotationElement(e){ce(this,g).delete(e.annotationElementId),e.deleted=!1}setActiveEditor(e){ce(this,c)!==e&&(Bt(this,c,e),e&&Et(this,G,W).call(this,e.propertiesToUpdate))}toggleSelected(e){if(ce(this,S).has(e))return ce(this,S).delete(e),e.unselect(),void Et(this,V,j).call(this,{hasSelectedEditor:this.hasSelection});ce(this,S).add(e),e.select(),Et(this,G,W).call(this,e.propertiesToUpdate),Et(this,V,j).call(this,{hasSelectedEditor:!0})}setSelected(e){for(let t of ce(this,S))t!==e&&t.unselect();ce(this,S).clear(),ce(this,S).add(e),e.select(),Et(this,G,W).call(this,e.propertiesToUpdate),Et(this,V,j).call(this,{hasSelectedEditor:!0})}isSelected(e){return ce(this,S).has(e)}unselect(e){e.unselect(),ce(this,S).delete(e),Et(this,V,j).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==ce(this,S).size}undo(){ce(this,f).undo(),Et(this,V,j).call(this,{hasSomethingToUndo:ce(this,f).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:Et(this,J,Q).call(this)})}redo(){ce(this,f).redo(),Et(this,V,j).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:ce(this,f).hasSomethingToRedo(),isEmpty:Et(this,J,Q).call(this)})}addCommands(e){ce(this,f).add(e),Et(this,V,j).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:Et(this,J,Q).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;let e=[...ce(this,S)];this.addCommands({cmd:()=>{for(let t of e)t.remove()},undo:()=>{for(let t of e)Et(this,Z,K).call(this,t)},mustExec:!0})}commitOrRemove(){var e;null==(e=ce(this,c))||e.commitOrRemove()}selectAll(){for(let e of ce(this,S))e.commit();Et(this,ee,te).call(this,ce(this,u).values())}unselectAll(){if(ce(this,c))ce(this,c).commitOrRemove();else if(0!==ce(this,S).size){for(let e of ce(this,S))e.unselect();ce(this,S).clear(),Et(this,V,j).call(this,{hasSelectedEditor:!1})}}isActive(e){return ce(this,c)===e}getActive(){return ce(this,c)}getMode(){return ce(this,w)}},ue=he;c=new WeakMap,u=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,v=new WeakMap,y=new WeakMap,b=new WeakMap,x=new WeakMap,_=new WeakMap,w=new WeakMap,S=new WeakMap,T=new WeakMap,M=new WeakMap,E=new WeakMap,A=new WeakMap,C=new WeakMap,P=new WeakMap,R=new WeakMap,I=new WeakMap,O=new WeakMap,L=new WeakMap,D=new WeakSet,k=function(){ce(this,L).addEventListener("keydown",ce(this,A))},F=new WeakSet,N=function(){ce(this,L).removeEventListener("keydown",ce(this,A))},U=new WeakSet,B=function(){document.addEventListener("copy",ce(this,T)),document.addEventListener("cut",ce(this,M)),document.addEventListener("paste",ce(this,E))},z=new WeakSet,H=function(){document.removeEventListener("copy",ce(this,T)),document.removeEventListener("cut",ce(this,M)),document.removeEventListener("paste",ce(this,E))},V=new WeakSet,j=function(e){Object.entries(e).some((([e,t])=>ce(this,O)[e]!==t))&&ce(this,b).dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(ce(this,O),e)})},G=new WeakSet,W=function(e){ce(this,b).dispatch("annotationeditorparamschanged",{source:this,details:e})},X=new WeakSet,q=function(){if(!ce(this,_)){Bt(this,_,!0);for(let e of ce(this,d).values())e.enable()}},Y=new WeakSet,$=function(){if(this.unselectAll(),ce(this,_)){Bt(this,_,!1);for(let e of ce(this,d).values())e.disable()}},Z=new WeakSet,K=function(e){let t=ce(this,d).get(e.pageIndex);t?t.addOrRebuild(e):this.addEditor(e)},J=new WeakSet,Q=function(){if(0===ce(this,u).size)return!0;if(1===ce(this,u).size)for(let e of ce(this,u).values())return e.isEmpty();return!1},ee=new WeakSet,te=function(e){ce(this,S).clear();for(let t of e)t.isEmpty()||(ce(this,S).add(t),t.select());Et(this,V,j).call(this,{hasSelectedEditor:!0})},t.AnnotationEditorUIManager=ue},(e,t,r)=>{var i,n,a,s,o,l,h,c,u,d,p,f,m,g,v,y,b,x,_,w,S,T,M,E,A;Object.defineProperty(t,"__esModule",{value:!0}),t.StatTimer=t.RenderingCancelledException=t.PixelsPerInch=t.PageViewport=t.PDFDateString=t.DOMStandardFontDataFactory=t.DOMSVGFactory=t.DOMFilterFactory=t.DOMCanvasFactory=t.DOMCMapReaderFactory=t.AnnotationPrefix=void 0,t.deprecated=function(e){console.log("Deprecated API usage: "+e)},t.getColorValues=function(e){let t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(let r of e.keys()){t.style.color=r;let i=window.getComputedStyle(t).color;e.set(r,G(i))}t.remove()},t.getCurrentTransform=function(e){let{a:t,b:r,c:i,d:n,e:a,f:s}=e.getTransform();return[t,r,i,n,a,s]},t.getCurrentTransformInverse=function(e){let{a:t,b:r,c:i,d:n,e:a,f:s}=e.getTransform().invertSelf();return[t,r,i,n,a,s]},t.getFilenameFromUrl=function(e,t=!1){return t||([e]=e.split(/[#?]/,1)),e.substring(e.lastIndexOf("/")+1)},t.getPdfFilenameFromUrl=function(e,t="document.pdf"){if("string"!=typeof e)return t;if(V(e))return(0,P.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;let r=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(e),n=r.exec(i[1])||r.exec(i[2])||r.exec(i[3]);if(n&&(n=n[0],n.includes("%")))try{n=r.exec(decodeURIComponent(n))[0]}catch(e){}return n||t},t.getRGB=G,t.getXfaPageViewport=function(e,{scale:t=1,rotation:r=0}){let{width:i,height:n}=e.attributes.style,a=[0,0,parseInt(i),parseInt(n)];return new z({viewBox:a,scale:t,rotation:r})},t.isDataScheme=V,t.isPdfFile=function(e){return"string"==typeof e&&/\.pdf$/i.test(e)},t.isValidFetchUrl=j,t.loadScript=function(e,t=!1){return new Promise(((r,i)=>{let n=document.createElement("script");n.src=e,n.onload=function(e){t&&n.remove(),r(e)},n.onerror=function(){i(new Error(`Cannot load script at: ${n.src}`))},(document.head||document.documentElement).append(n)}))},t.setLayerDimensions=function(e,t,r=!1,i=!0){if(t instanceof z){let{pageWidth:i,pageHeight:n}=t.rawDims,{style:a}=e,s=`calc(var(--scale-factor) * ${i}px)`,o=`calc(var(--scale-factor) * ${n}px)`;r&&t.rotation%180!=0?(a.width=o,a.height=s):(a.width=s,a.height=o)}i&&e.setAttribute("data-main-rotation",t.rotation)};var C=r(7),P=r(1);let R="http://www.w3.org/2000/svg";t.AnnotationPrefix="pdfjs_internal_id_";let I,O=class{},L=O;Es(L,"CSS",96),Es(L,"PDF",72),Es(L,"PDF_TO_CSS_UNITS",O.CSS/O.PDF),t.PixelsPerInch=L;class D extends C.BaseFilterFactory{constructor({docId:e,ownerDocument:t=globalThis.document}={}){super(),at(this,f),at(this,g),at(this,y),at(this,x),at(this,w),at(this,T),at(this,E),at(this,i,void 0),at(this,n,void 0),at(this,a,void 0),at(this,s,void 0),at(this,o,void 0),at(this,l,void 0),at(this,h,void 0),at(this,c,void 0),at(this,u,void 0),at(this,d,void 0),at(this,p,0),Bt(this,a,e),Bt(this,s,t)}addFilter(e){if(!e)return"none";let t,r,i,n,s=ce(this,f,m).get(e);if(s)return s;if(1===e.length){let a=e[0],s=new Array(256);for(let e=0;e<256;e++)s[e]=a[e]/255;n=t=r=i=s.join(",")}else{let[a,s,o]=e,l=new Array(256),h=new Array(256),c=new Array(256);for(let e=0;e<256;e++)l[e]=a[e]/255,h[e]=s[e]/255,c[e]=o[e]/255;t=l.join(","),r=h.join(","),i=c.join(","),n=`${t}${r}${i}`}if(s=ce(this,f,m).get(n),s)return ce(this,f,m).set(e,s),s;let o=`g_${ce(this,a)}_transfer_map_${AM(this,p)._++}`,l=`url(#${o})`;ce(this,f,m).set(e,l),ce(this,f,m).set(n,l);let h=Et(this,x,_).call(this,o);return Et(this,T,M).call(this,t,r,i,h),l}addHCMFilter(e,t){var r;let i=`${e}-${t}`;if(ce(this,l)===i)return ce(this,h);if(Bt(this,l,i),Bt(this,h,"none"),null==(r=ce(this,o))||r.remove(),!e||!t)return ce(this,h);let n=Et(this,E,A).call(this,e);e=P.Util.makeHexColor(...n);let s=Et(this,E,A).call(this,t);if(t=P.Util.makeHexColor(...s),ce(this,g,v).style.color="","#000000"===e&&"#ffffff"===t||e===t)return ce(this,h);let u=new Array(256);for(let e=0;e<=255;e++){let t=e/255;u[e]=t<=.03928?t/12.92:Ga((t+.055)/1.055,2.4)}let d=u.join(","),p=`g_${ce(this,a)}_hcm_filter`,f=Bt(this,c,Et(this,x,_).call(this,p));Et(this,T,M).call(this,d,d,d,f),Et(this,y,b).call(this,f);let m=(e,t)=>{let r=n[e]/255,i=s[e]/255,a=new Array(t+1);for(let e=0;e<=t;e++)a[e]=r+e/t*(i-r);return a.join(",")};return Et(this,T,M).call(this,m(0,5),m(1,5),m(2,5),f),Bt(this,h,`url(#${p})`),ce(this,h)}addHighlightHCMFilter(e,t,r,i){var n;let s=`${e}-${t}-${r}-${i}`;if(ce(this,u)===s)return ce(this,d);if(Bt(this,u,s),Bt(this,d,"none"),null==(n=ce(this,c))||n.remove(),!e||!t)return ce(this,d);let[o,l]=[e,t].map(Et(this,E,A).bind(this)),h=Math.round(.2126*o[0]+.7152*o[1]+.0722*o[2]),p=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),[f,m]=[r,i].map(Et(this,E,A).bind(this));p<h&&([h,p,f,m]=[p,h,m,f]),ce(this,g,v).style.color="";let w=(e,t,r)=>{let i=new Array(256),n=(p-h)/r,a=e/255,s=(t-e)/(255*r),o=0;for(let e=0;e<=r;e++){let t=Math.round(h+e*n),r=a+e*s;for(let e=o;e<=t;e++)i[e]=r;o=t+1}for(let e=o;e<256;e++)i[e]=i[o-1];return i.join(",")},S=`g_${ce(this,a)}_hcm_highlight_filter`,C=Bt(this,c,Et(this,x,_).call(this,S));return Et(this,y,b).call(this,C),Et(this,T,M).call(this,w(f[0],m[0],5),w(f[1],m[1],5),w(f[2],m[2],5),C),Bt(this,d,`url(#${S})`),ce(this,d)}destroy(e=!1){e&&(ce(this,h)||ce(this,d))||(ce(this,n)&&(ce(this,n).parentNode.parentNode.remove(),Bt(this,n,null)),ce(this,i)&&(ce(this,i).clear(),Bt(this,i,null)),Bt(this,p,0))}}i=new WeakMap,n=new WeakMap,a=new WeakMap,s=new WeakMap,o=new WeakMap,l=new WeakMap,h=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakSet,m=function(){return ce(this,i)||Bt(this,i,new Map)},g=new WeakSet,v=function(){if(!ce(this,n)){let e=ce(this,s).createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;let r=ce(this,s).createElementNS(R,"svg");r.setAttribute("width",0),r.setAttribute("height",0),Bt(this,n,ce(this,s).createElementNS(R,"defs")),e.append(r),r.append(ce(this,n)),ce(this,s).body.append(e)}return ce(this,n)},y=new WeakSet,b=function(e){let t=ce(this,s).createElementNS(R,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)},x=new WeakSet,_=function(e){let t=ce(this,s).createElementNS(R,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),ce(this,g,v).append(t),t},w=new WeakSet,S=function(e,t,r){let i=ce(this,s).createElementNS(R,t);i.setAttribute("type","discrete"),i.setAttribute("tableValues",r),e.append(i)},T=new WeakSet,M=function(e,t,r,i){let n=ce(this,s).createElementNS(R,"feComponentTransfer");i.append(n),Et(this,w,S).call(this,n,"feFuncR",e),Et(this,w,S).call(this,n,"feFuncG",t),Et(this,w,S).call(this,n,"feFuncB",r)},E=new WeakSet,A=function(e){return ce(this,g,v).style.color=e,G(getComputedStyle(ce(this,g,v)).getPropertyValue("color"))},t.DOMFilterFactory=D;class k extends C.BaseCanvasFactory{constructor({ownerDocument:e=globalThis.document}={}){super(),this._document=e}_createCanvas(e,t){let r=this._document.createElement("canvas");return r.width=e,r.height=t,r}}function F(e,t=!1){return bt(this,null,(function*(){if(j(e,document.baseURI)){let r=yield fetch(e);if(!r.ok)throw new Error(r.statusText);return t?new Uint8Array(yield r.arrayBuffer()):(0,P.stringToBytes)(yield r.text())}return new Promise(((r,i)=>{let n=new XMLHttpRequest;n.open("GET",e,!0),t&&(n.responseType="arraybuffer"),n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE){if(200===n.status||0===n.status){let e;if(t&&n.response?e=new Uint8Array(n.response):!t&&n.responseText&&(e=(0,P.stringToBytes)(n.responseText)),e)return void r(e)}i(new Error(n.statusText))}},n.send(null)}))}))}t.DOMCanvasFactory=k;class N extends C.BaseCMapReaderFactory{_fetchData(e,t){return F(e,this.isCompressed).then((e=>({cMapData:e,compressionType:t})))}}t.DOMCMapReaderFactory=N;class U extends C.BaseStandardFontDataFactory{_fetchData(e){return F(e,!0)}}t.DOMStandardFontDataFactory=U;class B extends C.BaseSVGFactory{_createSVG(e){return document.createElementNS(R,e)}}t.DOMSVGFactory=B;class z{constructor({viewBox:e,scale:t,rotation:r,offsetX:i=0,offsetY:n=0,dontFlip:a=!1}){this.viewBox=e,this.scale=t,this.rotation=r,this.offsetX=i,this.offsetY=n;let s,o,l,h,c,u,d,p,f=(e[2]+e[0])/2,m=(e[3]+e[1])/2;switch((r%=360)<0&&(r+=360),r){case 180:s=-1,o=0,l=0,h=1;break;case 90:s=0,o=1,l=1,h=0;break;case 270:s=0,o=-1,l=-1,h=0;break;case 0:s=1,o=0,l=0,h=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(l=-l,h=-h),0===s?(c=Math.abs(m-e[1])*t+i,u=Math.abs(f-e[0])*t+n,d=(e[3]-e[1])*t,p=(e[2]-e[0])*t):(c=Math.abs(f-e[0])*t+i,u=Math.abs(m-e[1])*t+n,d=(e[2]-e[0])*t,p=(e[3]-e[1])*t),this.transform=[s*t,o*t,l*t,h*t,c-s*t*f-l*t*m,u-o*t*f-h*t*m],this.width=d,this.height=p}get rawDims(){let{viewBox:e}=this;return(0,P.shadow)(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:r=this.offsetX,offsetY:i=this.offsetY,dontFlip:n=!1}={}){return new z({viewBox:this.viewBox.slice(),scale:e,rotation:t,offsetX:r,offsetY:i,dontFlip:n})}convertToViewportPoint(e,t){return P.Util.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){let t=P.Util.applyTransform([e[0],e[1]],this.transform),r=P.Util.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],r[0],r[1]]}convertToPdfPoint(e,t){return P.Util.applyInverseTransform([e,t],this.transform)}}t.PageViewport=z;class H extends P.BaseException{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function V(e){let t=e.length,r=0;for(;r<t&&""===e[r].trim();)r++;return"data:"===e.substring(r,r+5).toLowerCase()}function j(e,t){try{let{protocol:r}=t?new URL(e,t):new URL(e);return"http:"===r||"https:"===r}catch(e){return!1}}function G(e){if(e.startsWith("#")){let t=parseInt(e.slice(1),16);return[(16711680&t)>>16,(65280&t)>>8,255&t]}return e.startsWith("rgb(")?e.slice(4,-1).split(",").map((e=>parseInt(e))):e.startsWith("rgba(")?e.slice(5,-1).split(",").map((e=>parseInt(e))).slice(0,3):((0,P.warn)(`Not a valid color format: "${e}"`),[0,0,0])}t.RenderingCancelledException=H,t.StatTimer=class{constructor(){Es(this,"started",Object.create(null)),Es(this,"times",[])}time(e){e in this.started&&(0,P.warn)(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||(0,P.warn)(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){let e=[],t=0;for(let{name:e}of this.times)t=Math.max(e.length,t);for(let{name:r,start:i,end:n}of this.times)e.push(`${r.padEnd(t)} ${n-i}ms\n`);return e.join("")}},t.PDFDateString=class{static toDateObject(e){if(!e||"string"!=typeof e)return null;I||(I=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));let t=I.exec(e);if(!t)return null;let r=parseInt(t[1],10),i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let n=parseInt(t[3],10);n=n>=1&&n<=31?n:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let s=parseInt(t[5],10);s=s>=0&&s<=59?s:0;let o=parseInt(t[6],10);o=o>=0&&o<=59?o:0;let l=t[7]||"Z",h=parseInt(t[8],10);h=h>=0&&h<=23?h:0;let c=parseInt(t[9],10)||0;return c=c>=0&&c<=59?c:0,"-"===l?(a+=h,s+=c):"+"===l&&(a-=h,s-=c),new Date(Date.UTC(r,i,n,a,s,o))}}},(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseStandardFontDataFactory=t.BaseSVGFactory=t.BaseFilterFactory=t.BaseCanvasFactory=t.BaseCMapReaderFactory=void 0;var i=r(1);class n{constructor(){this.constructor===n&&(0,i.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addHighlightHCMFilter(e,t,r,i){return"none"}destroy(e=!1){}}t.BaseFilterFactory=n;class a{constructor(){this.constructor===a&&(0,i.unreachable)("Cannot initialize BaseCanvasFactory.")}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");let r=this._createCanvas(e,t);return{canvas:r,context:r.getContext("2d")}}reset(e,t,r){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||r<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=r}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){(0,i.unreachable)("Abstract method `_createCanvas` called.")}}t.BaseCanvasFactory=a;class s{constructor({baseUrl:e=null,isCompressed:t=!0}){this.constructor===s&&(0,i.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=e,this.isCompressed=t}fetch(e){return bt(this,arguments,(function*({name:e}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!e)throw new Error("CMap name must be specified.");let t=this.baseUrl+e+(this.isCompressed?".bcmap":""),r=this.isCompressed?i.CMapCompressionType.BINARY:i.CMapCompressionType.NONE;return this._fetchData(t,r).catch((e=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)}))}))}_fetchData(e,t){(0,i.unreachable)("Abstract method `_fetchData` called.")}}t.BaseCMapReaderFactory=s;class o{constructor({baseUrl:e=null}){this.constructor===o&&(0,i.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=e}fetch(e){return bt(this,arguments,(function*({filename:e}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!e)throw new Error("Font filename must be specified.");let t=`${this.baseUrl}${e}`;return this._fetchData(t).catch((e=>{throw new Error(`Unable to load font data at: ${t}`)}))}))}_fetchData(e){(0,i.unreachable)("Abstract method `_fetchData` called.")}}t.BaseStandardFontDataFactory=o;class l{constructor(){this.constructor===l&&(0,i.unreachable)("Cannot initialize BaseSVGFactory.")}create(e,t,r=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");let i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),r||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if("string"!=typeof e)throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){(0,i.unreachable)("Abstract method `_createSVG` called.")}}t.BaseSVGFactory=l},(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MurmurHash3_64=void 0;var i=r(1);let n=3285377520,a=4294901760,s=65535;t.MurmurHash3_64=class{constructor(e){this.h1=e?4294967295&e:n,this.h2=e?4294967295&e:n}update(e){let t,r;if("string"==typeof e){t=new Uint8Array(2*e.length),r=0;for(let i=0,n=e.length;i<n;i++){let n=e.charCodeAt(i);n<=255?t[r++]=n:(t[r++]=n>>>8,t[r++]=255&n)}}else{if(!(0,i.isArrayBuffer)(e))throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");t=e.slice(),r=t.byteLength}let n=r>>2,o=r-4*n,l=new Uint32Array(t.buffer,0,n),h=0,c=0,u=this.h1,d=this.h2,p=3432918353,f=461845907,m=p&s,g=f&s;for(let e=0;e<n;e++)1&e?(h=l[e],h=h*p&a|h*m&s,h=h<<15|h>>>17,h=h*f&a|h*g&s,u^=h,u=u<<13|u>>>19,u=5*u+3864292196):(c=l[e],c=c*p&a|c*m&s,c=c<<15|c>>>17,c=c*f&a|c*g&s,d^=c,d=d<<13|d>>>19,d=5*d+3864292196);switch(h=0,o){case 3:h^=t[4*n+2]<<16;case 2:h^=t[4*n+1]<<8;case 1:h^=t[4*n],h=h*p&a|h*m&s,h=h<<15|h>>>17,h=h*f&a|h*g&s,1&n?u^=h:d^=h}this.h1=u,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=3981806797*e&a|36045*e&s,t=4283543511*t&a|(2950163797*(t<<16|e>>>16)&a)>>>16,e^=t>>>1,e=444984403*e&a|60499*e&s,t=3301882366*t&a|(3120437893*(t<<16|e>>>16)&a)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}},(e,t,r)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.FontLoader=t.FontFaceObject=void 0;var n=r(1),a=r(10);i=new WeakMap,t.FontLoader=class{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){at(this,i,new Set),this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(let e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),ce(this,i).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}loadSystemFont(e){return bt(this,null,(function*(){if(e&&!ce(this,i).has(e.loadedName)){if((0,n.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:t,src:r,style:a}=e,s=new FontFace(t,r,a);this.addNativeFontFace(s);try{yield s.load(),ce(this,i).add(t)}catch(t){(0,n.warn)(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(s)}return}(0,n.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}))}bind(e){return bt(this,null,(function*(){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo)return void(yield this.loadSystemFont(e.systemFontInfo));if(this.isFontLoadingAPISupported){let t=e.createNativeFontFace();if(t){this.addNativeFontFace(t);try{yield t.loaded}catch(r){throw(0,n.warn)(`Failed to load font '${t.family}': '${r}'.`),e.disableFontFace=!0,r}}return}let t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;yield new Promise((t=>{let r=this._queueLoadingCallback(t);this._prepareFontLoadEvent(e,r)}))}}))}get isFontLoadingAPISupported(){var e;let t=!(null==(e=this._document)||!e.fonts);return(0,n.shadow)(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){let e=!1;return(a.isNodeJS||"undefined"!=typeof navigator&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),(0,n.shadow)(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){let{loadingRequests:t}=this,r={done:!1,complete:function(){for((0,n.assert)(!r.done,"completeRequest() cannot be called twice."),r.done=!0;t.length>0&&t[0].done;){let e=t.shift();setTimeout(e.callback,0)}},callback:e};return t.push(r),r}get _loadTestFont(){let e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,n.shadow)(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function r(e,t){return e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|255&e.charCodeAt(t+3)}function i(e,t,r,i){return e.substring(0,t)+i+e.substring(t+r)}let a,s,o=this._document.createElement("canvas");o.width=1,o.height=1;let l=o.getContext("2d"),h=0,c=`lt${Date.now()}${this.loadTestFontId++}`,u=this._loadTestFont;u=i(u,976,c.length,c);let d=1482184792,p=r(u,16);for(a=0,s=c.length-3;a<s;a+=4)p=p-d+r(c,a)|0;a<c.length&&(p=p-d+r(c+"XXX",a)|0),u=i(u,16,4,(0,n.string32)(p));let f=`@font-face {font-family:"${c}";src:url(data:font/opentype;base64,${btoa(u)});}`;this.insertRule(f);let m=this._document.createElement("div");m.style.visibility="hidden",m.style.width=m.style.height="10px",m.style.position="absolute",m.style.top=m.style.left="0px";for(let t of[e.loadedName,c]){let e=this._document.createElement("span");e.textContent="Hi",e.style.fontFamily=t,m.append(e)}this._document.body.append(m),function e(t,r){if(++h>30)return(0,n.warn)("Load test font never loaded."),void r();l.font="30px "+t,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0?r():setTimeout(e.bind(null,t,r))}(c,(()=>{m.remove(),t.complete()}))}},t.FontFaceObject=class{constructor(e,{isEvalSupported:t=!0,disableFontFace:r=!1,ignoreErrors:i=!1,inspectFont:n=null}){this.compiledGlyphs=Object.create(null);for(let t in e)this[t]=e[t];this.isEvalSupported=!1!==t,this.disableFontFace=!0===r,this.ignoreErrors=!0===i,this._inspectFont=n}createNativeFontFace(){var e;if(!this.data||this.disableFontFace)return null;let t;if(this.cssFontInfo){let e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}else t=new FontFace(this.loadedName,this.data,{});return null==(e=this._inspectFont)||e.call(this,this),t}createFontFaceRule(){var e;if(!this.data||this.disableFontFace)return null;let t,r=(0,n.bytesToString)(this.data),i=`url(data:${this.mimetype};base64,${btoa(r)});`;if(this.cssFontInfo){let e=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(e+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${e}src:${i}}`}else t=`@font-face {font-family:"${this.loadedName}";src:${i}}`;return null==(e=this._inspectFont)||e.call(this,this,i),t}getPathGenerator(e,t){if(void 0!==this.compiledGlyphs[t])return this.compiledGlyphs[t];let r;try{r=e.get(this.loadedName+"_path_"+t)}catch(e){if(!this.ignoreErrors)throw e;return(0,n.warn)(`getPathGenerator - ignoring character: "${e}".`),this.compiledGlyphs[t]=function(e,t){}}if(this.isEvalSupported&&n.FeatureTest.isEvalSupported){let e=[];for(let t of r){let r=void 0!==t.args?t.args.join(","):"";e.push("c.",t.cmd,"(",r,");\n")}return this.compiledGlyphs[t]=new Function("c","size",e.join(""))}return this.compiledGlyphs[t]=function(e,t){for(let i of r)"scale"===i.cmd&&(i.args=[t,-t]),e[i.cmd].apply(e,i.args)}}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isNodeJS=void 0;let r=!("object"!=typeof process||process+""!="[object process]"||process.versions.nw||process.versions.electron&&process.type&&"browser"!==process.type);t.isNodeJS=r},(e,t,r)=>{var i,n,a,s;Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasGraphics=void 0;var o=r(1),l=r(6),h=r(12),c=r(13),u=r(10);let d=4096,p=16;class f{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,r){let i;return void 0!==this.cache[e]?(i=this.cache[e],this.canvasFactory.reset(i,t,r)):(i=this.canvasFactory.create(t,r),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(let e in this.cache){let t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function m(e,t,r,i,n,a,s,o,h,c){let[u,d,p,f,m,g]=(0,l.getCurrentTransform)(e);if(0===d&&0===p){let l=s*u+m,v=Math.round(l),y=o*f+g,b=Math.round(y),x=(s+h)*u+m,_=Math.abs(Math.round(x)-v)||1,w=(o+c)*f+g,S=Math.abs(Math.round(w)-b)||1;return e.setTransform(Math.sign(u),0,0,Math.sign(f),v,b),e.drawImage(t,r,i,n,a,0,0,_,S),e.setTransform(u,d,p,f,m,g),[_,S]}if(0===u&&0===f){let l=o*p+m,v=Math.round(l),y=s*d+g,b=Math.round(y),x=(o+c)*p+m,_=Math.abs(Math.round(x)-v)||1,w=(s+h)*d+g,S=Math.abs(Math.round(w)-b)||1;return e.setTransform(0,Math.sign(d),Math.sign(p),0,v,b),e.drawImage(t,r,i,n,a,0,0,S,_),e.setTransform(u,d,p,f,m,g),[S,_]}return e.drawImage(t,r,i,n,a,s,o,h,c),[Math.hypot(u,d)*h,Math.hypot(p,f)*c]}class g{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=o.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=o.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=o.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){let e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,r){[t,r]=o.Util.applyTransform([t,r],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,r),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,r)}updateRectMinMax(e,t){let r=o.Util.applyTransform(t,e),i=o.Util.applyTransform(t.slice(2),e);this.minX=Math.min(this.minX,r[0],i[0]),this.minY=Math.min(this.minY,r[1],i[1]),this.maxX=Math.max(this.maxX,r[0],i[0]),this.maxY=Math.max(this.maxY,r[1],i[1])}updateScalingPathMinMax(e,t){o.Util.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.maxX=Math.max(this.maxX,t[1]),this.minY=Math.min(this.minY,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,r,i,n,a,s,l,h,c){let u=o.Util.bezierBoundingBox(t,r,i,n,a,s,l,h);if(c)return c[0]=Math.min(c[0],u[0],u[2]),c[1]=Math.max(c[1],u[0],u[2]),c[2]=Math.min(c[2],u[1],u[3]),void(c[3]=Math.max(c[3],u[1],u[3]));this.updateRectMinMax(e,u)}getPathBoundingBox(e=h.PathType.FILL,t=null){let r=[this.minX,this.minY,this.maxX,this.maxY];if(e===h.PathType.STROKE){t||(0,o.unreachable)("Stroke bounding box must include transform.");let e=o.Util.singularValueDecompose2dScale(t),i=e[0]*this.lineWidth/2,n=e[1]*this.lineWidth/2;r[0]-=i,r[1]-=n,r[2]+=i,r[3]+=n}return r}updateClipFromPath(){let e=o.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=h.PathType.FILL,t=null){return o.Util.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function v(e,t){if("undefined"!=typeof ImageData&&t instanceof ImageData)return void e.putImageData(t,0,0);let r,i,n,a,s,l=t.height,h=t.width,c=l%p,u=(l-c)/p,d=0===c?u:u+1,f=e.createImageData(h,p),m=0,g=t.data,v=f.data;if(t.kind===o.ImageKind.GRAYSCALE_1BPP){let t=g.byteLength,s=new Uint32Array(v.buffer,0,v.byteLength>>2),l=s.length,y=h+7>>3,b=4294967295,x=o.FeatureTest.isLittleEndian?4278190080:255;for(i=0;i<d;i++){for(a=i<u?p:c,r=0,n=0;n<a;n++){let e=t-m,i=0,n=e>y?h:8*e-7,a=-8&n,o=0,l=0;for(;i<a;i+=8)l=g[m++],s[r++]=128&l?b:x,s[r++]=64&l?b:x,s[r++]=32&l?b:x,s[r++]=16&l?b:x,s[r++]=8&l?b:x,s[r++]=4&l?b:x,s[r++]=2&l?b:x,s[r++]=1&l?b:x;for(;i<n;i++)0===o&&(l=g[m++],o=128),s[r++]=l&o?b:x,o>>=1}for(;r<l;)s[r++]=0;e.putImageData(f,0,i*p)}}else if(t.kind===o.ImageKind.RGBA_32BPP){for(n=0,s=h*p*4,i=0;i<u;i++)v.set(g.subarray(m,m+s)),m+=s,e.putImageData(f,0,n),n+=p;i<d&&(s=h*c*4,v.set(g.subarray(m,m+s)),e.putImageData(f,0,n))}else{if(t.kind!==o.ImageKind.RGB_24BPP)throw new Error(`bad image kind: ${t.kind}`);for(a=p,s=h*a,i=0;i<d;i++){for(i>=u&&(a=c,s=h*a),r=0,n=s;n--;)v[r++]=g[m++],v[r++]=g[m++],v[r++]=g[m++],v[r++]=255;e.putImageData(f,0,i*p)}}}function y(e,t){if(t.bitmap)return void e.drawImage(t.bitmap,0,0);let r=t.height,i=t.width,n=r%p,a=(r-n)/p,s=0===n?a:a+1,o=e.createImageData(i,p),l=0,h=t.data,u=o.data;for(let t=0;t<s;t++){let r=t<a?p:n;({srcPos:l}=(0,c.convertBlackAndWhiteToRGBA)({src:h,srcPos:l,dest:u,width:i,height:r,nonBlackColor:0})),e.putImageData(o,0,t*p)}}function b(e,t){let r=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(let i of r)void 0!==e[i]&&(t[i]=e[i]);void 0!==e.setLineDash&&(t.setLineDash(e.getLineDash()),t.lineDashOffset=e.lineDashOffset)}function x(e){e.strokeStyle=e.fillStyle="#000000",e.fillRule="nonzero",e.globalAlpha=1,e.lineWidth=1,e.lineCap="butt",e.lineJoin="miter",e.miterLimit=10,e.globalCompositeOperation="source-over",e.font="10px sans-serif",void 0!==e.setLineDash&&(e.setLineDash([]),e.lineDashOffset=0),u.isNodeJS||(e.filter="none")}function _(e,t,r,i){let n=e.length;for(let a=3;a<n;a+=4){let n=e[a];if(0===n)e[a-3]=t,e[a-2]=r,e[a-1]=i;else if(n<255){let s=255-n;e[a-3]=e[a-3]*n+t*s>>8,e[a-2]=e[a-2]*n+r*s>>8,e[a-1]=e[a-1]*n+i*s>>8}}}function w(e,t,r){let i=e.length;for(let n=3;n<i;n+=4){let i=r?r[e[n]]:e[n];t[n]=t[n]*i*.00392156862745098|0}}function S(e,t,r){let i=e.length;for(let n=3;n<i;n+=4){let i=77*e[n-3]+152*e[n-2]+28*e[n-1];t[n]=r?t[n]*r[i>>8]>>8:t[n]*i>>16}}function T(e,t,r,i){let n=i[0],a=i[1],s=i[2]-n,o=i[3]-a;0===s||0===o||(function(e,t,r,i,n,a,s,o,l,h,c){let u,d=!!a,p=d?a[0]:0,f=d?a[1]:0,m=d?a[2]:0;u="Luminosity"===n?S:w;let g=Math.min(i,Math.ceil(1048576/r));for(let n=0;n<i;n+=g){let a=Math.min(g,i-n),v=e.getImageData(o-h,n+(l-c),r,a),y=t.getImageData(o,n+l,r,a);d&&_(v.data,p,f,m),u(v.data,y.data,s),t.putImageData(y,o,n+l)}}(t.context,r,s,o,t.subtype,t.backdrop,t.transferMap,n,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(r.canvas,0,0),e.restore())}function M(e,t){let r=o.Util.singularValueDecompose2dScale(e);r[0]=Math.fround(r[0]),r[1]=Math.fround(r[1]);let i=Math.fround((globalThis.devicePixelRatio||1)*l.PixelsPerInch.PDF_TO_CSS_UNITS);return void 0!==t?t:r[0]<=i||r[1]<=i}let E=["butt","round","square"],A=["miter","round","bevel"],C={},P={},R=class{constructor(e,t,r,n,s,{optionalContentConfig:o,markedContentStack:l=null},h,c){at(this,i),at(this,a),this.ctx=e,this.current=new g(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=r,this.canvasFactory=n,this.filterFactory=s,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=l||[],this.optionalContentConfig=o,this.cachedCanvases=new f(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=h,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return"string"==typeof e?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:r=!1,background:i=null}){let n=this.ctx.canvas.width,a=this.ctx.canvas.height,s=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,n,a),this.ctx.fillStyle=s,r){let e=this.cachedCanvases.getCanvas("transparent",n,a);this.compositeCtx=this.ctx,this.transparentCanvas=e.canvas,this.ctx=e.context,this.ctx.save(),this.ctx.transform(...(0,l.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),x(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=(0,l.getCurrentTransform)(this.ctx)}executeOperatorList(e,t,r,i){let n=e.argsArray,a=e.fnArray,s=t||0,l=n.length;if(l===s)return s;let h,c=l-s>10&&"function"==typeof r,u=c?Date.now()+15:0,d=0,p=this.commonObjs,f=this.objs;for(;;){if(void 0!==i&&s===i.nextBreakPoint)return i.breakIt(s,r),s;if(h=a[s],h!==o.OPS.dependency)this[h].apply(this,n[s]);else for(let e of n[s]){let t=e.startsWith("g_")?p:f;if(!t.has(e))return t.get(e,r),s}if(s++,s===l)return s;if(c&&++d>10){if(Date.now()>u)return r(),s;d=0}}}endDrawing(){Et(this,i,n).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let e of this._cachedBitmapsMap.values()){for(let t of e.values())"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),Et(this,a,s).call(this)}_scaleImage(e,t){let r,i,n=e.width,a=e.height,s=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),l=n,h=a,c="prescale1";for(;s>2&&l>1||o>2&&h>1;){let t=l,n=h;s>2&&l>1&&(t=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l/2),s/=l/t),o>2&&h>1&&(n=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h)/2,o/=h/n),r=this.cachedCanvases.getCanvas(c,t,n),i=r.context,i.clearRect(0,0,t,n),i.drawImage(e,0,0,l,h,0,0,t,n),e=r.canvas,l=t,h=n,c="prescale1"===c?"prescale2":"prescale1"}return{img:e,paintWidth:l,paintHeight:h}}_createMaskCanvas(e){let t,r,i,n,a=this.ctx,{width:s,height:c}=e,u=this.current.fillColor,d=this.current.patternFill,p=(0,l.getCurrentTransform)(a);if((e.bitmap||e.data)&&e.count>1){let n=e.bitmap||e.data.buffer;r=JSON.stringify(d?p:[p.slice(0,4),u]),t=this._cachedBitmapsMap.get(n),t||(t=new Map,this._cachedBitmapsMap.set(n,t));let a=t.get(r);if(a&&!d)return{canvas:a,offsetX:Math.round(Math.min(p[0],p[2])+p[4]),offsetY:Math.round(Math.min(p[1],p[3])+p[5])};i=a}i||(n=this.cachedCanvases.getCanvas("maskCanvas",s,c),y(n.context,e));let f=o.Util.transform(p,[1/s,0,0,-1/c,0,0]);f=o.Util.transform(f,[1,0,0,1,0,-c]);let g=o.Util.applyTransform([0,0],f),v=o.Util.applyTransform([s,c],f),b=o.Util.normalizeRect([g[0],g[1],v[0],v[1]]),x=Math.round(b[2]-b[0])||1,_=Math.round(b[3]-b[1])||1,w=this.cachedCanvases.getCanvas("fillCanvas",x,_),S=w.context,T=Math.min(g[0],v[0]),E=Math.min(g[1],v[1]);S.translate(-T,-E),S.transform(...f),i||(i=this._scaleImage(n.canvas,(0,l.getCurrentTransformInverse)(S)),i=i.img,t&&d&&t.set(r,i)),S.imageSmoothingEnabled=M((0,l.getCurrentTransform)(S),e.interpolate),m(S,i,0,0,i.width,i.height,0,0,s,c),S.globalCompositeOperation="source-in";let A=o.Util.transform((0,l.getCurrentTransformInverse)(S),[1,0,0,1,-T,-E]);return S.fillStyle=d?u.getPattern(a,this,A,h.PathType.FILL):u,S.fillRect(0,0,s,c),t&&!d&&(this.cachedCanvases.delete("fillCanvas"),t.set(r,w.canvas)),{canvas:w.canvas,offsetX:Math.round(T),offsetY:Math.round(E)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=E[e]}setLineJoin(e){this.ctx.lineJoin=A[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){let r=this.ctx;void 0!==r.setLineDash&&(r.setLineDash(e),r.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(let[t,r]of e)switch(t){case"LW":this.setLineWidth(r);break;case"LC":this.setLineCap(r);break;case"LJ":this.setLineJoin(r);break;case"ML":this.setMiterLimit(r);break;case"D":this.setDash(r[0],r[1]);break;case"RI":this.setRenderingIntent(r);break;case"FL":this.setFlatness(r);break;case"Font":this.setFont(r[0],r[1]);break;case"CA":this.current.strokeAlpha=r;break;case"ca":this.current.fillAlpha=r,this.ctx.globalAlpha=r;break;case"BM":this.ctx.globalCompositeOperation=r;break;case"SMask":this.current.activeSMask=r?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(r)}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let e=this.ctx.canvas.width,t=this.ctx.canvas.height,r="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(r,e,t);this.suspendedCtx=this.ctx,this.ctx=i.context;let n=this.ctx;n.setTransform(...(0,l.getCurrentTransform)(this.suspendedCtx)),b(this.suspendedCtx,n),function(e,t){if(e._removeMirroring)throw new Error("Context is already forwarding operations.");e.__originalSave=e.save,e.__originalRestore=e.restore,e.__originalRotate=e.rotate,e.__originalScale=e.scale,e.__originalTranslate=e.translate,e.__originalTransform=e.transform,e.__originalSetTransform=e.setTransform,e.__originalResetTransform=e.resetTransform,e.__originalClip=e.clip,e.__originalMoveTo=e.moveTo,e.__originalLineTo=e.lineTo,e.__originalBezierCurveTo=e.bezierCurveTo,e.__originalRect=e.rect,e.__originalClosePath=e.closePath,e.__originalBeginPath=e.beginPath,e._removeMirroring=()=>{e.save=e.__originalSave,e.restore=e.__originalRestore,e.rotate=e.__originalRotate,e.scale=e.__originalScale,e.translate=e.__originalTranslate,e.transform=e.__originalTransform,e.setTransform=e.__originalSetTransform,e.resetTransform=e.__originalResetTransform,e.clip=e.__originalClip,e.moveTo=e.__originalMoveTo,e.lineTo=e.__originalLineTo,e.bezierCurveTo=e.__originalBezierCurveTo,e.rect=e.__originalRect,e.closePath=e.__originalClosePath,e.beginPath=e.__originalBeginPath,delete e._removeMirroring},e.save=function(){t.save(),this.__originalSave()},e.restore=function(){t.restore(),this.__originalRestore()},e.translate=function(e,r){t.translate(e,r),this.__originalTranslate(e,r)},e.scale=function(e,r){t.scale(e,r),this.__originalScale(e,r)},e.transform=function(e,r,i,n,a,s){t.transform(e,r,i,n,a,s),this.__originalTransform(e,r,i,n,a,s)},e.setTransform=function(e,r,i,n,a,s){t.setTransform(e,r,i,n,a,s),this.__originalSetTransform(e,r,i,n,a,s)},e.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},e.rotate=function(e){t.rotate(e),this.__originalRotate(e)},e.clip=function(e){t.clip(e),this.__originalClip(e)},e.moveTo=function(e,r){t.moveTo(e,r),this.__originalMoveTo(e,r)},e.lineTo=function(e,r){t.lineTo(e,r),this.__originalLineTo(e,r)},e.bezierCurveTo=function(e,r,i,n,a,s){t.bezierCurveTo(e,r,i,n,a,s),this.__originalBezierCurveTo(e,r,i,n,a,s)},e.rect=function(e,r,i,n){t.rect(e,r,i,n),this.__originalRect(e,r,i,n)},e.closePath=function(){t.closePath(),this.__originalClosePath()},e.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}(n,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),b(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let t=this.current.activeSMask;T(this.suspendedCtx,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(b(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){0===this.stateStack.length&&this.inSMaskMode&&this.endSMaskMode(),0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),b(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,r,i,n,a){this.ctx.transform(e,t,r,i,n,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,r){let i,n,a=this.ctx,s=this.current,h=s.x,c=s.y,u=(0,l.getCurrentTransform)(a),d=0===u[0]&&0===u[3]||0===u[1]&&0===u[2],p=d?r.slice(0):null;for(let r=0,l=0,f=e.length;r<f;r++)switch(0|e[r]){case o.OPS.rectangle:h=t[l++],c=t[l++];let e=t[l++],r=t[l++],f=h+e,m=c+r;a.moveTo(h,c),0===e||0===r?a.lineTo(f,m):(a.lineTo(f,c),a.lineTo(f,m),a.lineTo(h,m)),d||s.updateRectMinMax(u,[h,c,f,m]),a.closePath();break;case o.OPS.moveTo:h=t[l++],c=t[l++],a.moveTo(h,c),d||s.updatePathMinMax(u,h,c);break;case o.OPS.lineTo:h=t[l++],c=t[l++],a.lineTo(h,c),d||s.updatePathMinMax(u,h,c);break;case o.OPS.curveTo:i=h,n=c,h=t[l+4],c=t[l+5],a.bezierCurveTo(t[l],t[l+1],t[l+2],t[l+3],h,c),s.updateCurvePathMinMax(u,i,n,t[l],t[l+1],t[l+2],t[l+3],h,c,p),l+=6;break;case o.OPS.curveTo2:i=h,n=c,a.bezierCurveTo(h,c,t[l],t[l+1],t[l+2],t[l+3]),s.updateCurvePathMinMax(u,i,n,h,c,t[l],t[l+1],t[l+2],t[l+3],p),h=t[l+2],c=t[l+3],l+=4;break;case o.OPS.curveTo3:i=h,n=c,h=t[l+2],c=t[l+3],a.bezierCurveTo(t[l],t[l+1],h,c,h,c),s.updateCurvePathMinMax(u,i,n,t[l],t[l+1],h,c,h,c,p),l+=4;break;case o.OPS.closePath:a.closePath()}d&&s.updateScalingPathMinMax(u,p),s.setCurrentPoint(h,c)}closePath(){this.ctx.closePath()}stroke(e=!0){let t=this.ctx,r=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&("object"==typeof r&&null!=r&&r.getPattern?(t.save(),t.strokeStyle=r.getPattern(t,this,(0,l.getCurrentTransformInverse)(t),h.PathType.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){let t=this.ctx,r=this.current.fillColor,i=!1;this.current.patternFill&&(t.save(),t.fillStyle=r.getPattern(t,this,(0,l.getCurrentTransformInverse)(t),h.PathType.FILL),i=!0);let n=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==n&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),i&&t.restore(),e&&this.consumePath(n)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=C}eoClip(){this.pendingClip=P}beginText(){this.current.textMatrix=o.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let e=this.pendingTextPaths,t=this.ctx;if(void 0!==e){t.save(),t.beginPath();for(let r of e)t.setTransform(...r.transform),t.translate(r.x,r.y),r.addToPath(t,r.fontSize);t.restore(),t.clip(),t.beginPath(),delete this.pendingTextPaths}else t.beginPath()}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var r;let i=this.commonObjs.get(e),n=this.current;if(!i)throw new Error(`Can't find font for ${e}`);if(n.fontMatrix=i.fontMatrix||o.FONT_IDENTITY_MATRIX,(0===n.fontMatrix[0]||0===n.fontMatrix[3])&&(0,o.warn)("Invalid font matrix for font "+e),t<0?(t=-t,n.fontDirection=-1):n.fontDirection=1,this.current.font=i,this.current.fontSize=t,i.isType3Font)return;let a=i.loadedName||"sans-serif",s=(null==(r=i.systemFontInfo)?void 0:r.css)||`"${a}", ${i.fallbackName}`,l="normal";i.black?l="900":i.bold&&(l="bold");let h=i.italic?"italic":"normal",c=t;t<16?c=16:t>100&&(c=100),this.current.fontSizeScale=t/c,this.ctx.font=`${h} ${l} ${c}px ${s}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,r,i,n,a){this.current.textMatrix=[e,t,r,i,n,a],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,r,i){let n,a=this.ctx,s=this.current,h=s.font,c=s.textRenderingMode,u=s.fontSize/s.fontSizeScale,d=c&o.TextRenderingMode.FILL_STROKE_MASK,p=!!(c&o.TextRenderingMode.ADD_TO_PATH_FLAG),f=s.patternFill&&!h.missingFile;(h.disableFontFace||p||f)&&(n=h.getPathGenerator(this.commonObjs,e)),h.disableFontFace||f?(a.save(),a.translate(t,r),a.beginPath(),n(a,u),i&&a.setTransform(...i),(d===o.TextRenderingMode.FILL||d===o.TextRenderingMode.FILL_STROKE)&&a.fill(),(d===o.TextRenderingMode.STROKE||d===o.TextRenderingMode.FILL_STROKE)&&a.stroke(),a.restore()):((d===o.TextRenderingMode.FILL||d===o.TextRenderingMode.FILL_STROKE)&&a.fillText(e,t,r),(d===o.TextRenderingMode.STROKE||d===o.TextRenderingMode.FILL_STROKE)&&a.strokeText(e,t,r)),p&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,l.getCurrentTransform)(a),x:t,y:r,fontSize:u,addToPath:n})}get isFontSubpixelAAEnabled(){let{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);let t=e.getImageData(0,0,10,10).data,r=!1;for(let e=3;e<t.length;e+=4)if(t[e]>0&&t[e]<255){r=!0;break}return(0,o.shadow)(this,"isFontSubpixelAAEnabled",r)}showText(e){let t=this.current,r=t.font;if(r.isType3Font)return this.showType3Text(e);let i=t.fontSize;if(0===i)return;let n,a=this.ctx,s=t.fontSizeScale,c=t.charSpacing,u=t.wordSpacing,d=t.fontDirection,p=t.textHScale*d,f=e.length,m=r.vertical,g=m?1:-1,v=r.defaultVMetrics,y=i*t.fontMatrix[0],b=t.textRenderingMode===o.TextRenderingMode.FILL&&!r.disableFontFace&&!t.patternFill;if(a.save(),a.transform(...t.textMatrix),a.translate(t.x,t.y+t.textRise),d>0?a.scale(p,-1):a.scale(p,1),t.patternFill){a.save();let e=t.fillColor.getPattern(a,this,(0,l.getCurrentTransformInverse)(a),h.PathType.FILL);n=(0,l.getCurrentTransform)(a),a.restore(),a.fillStyle=e}let x=t.lineWidth,_=t.textMatrixScale;if(0===_||0===x){let e=t.textRenderingMode&o.TextRenderingMode.FILL_STROKE_MASK;(e===o.TextRenderingMode.STROKE||e===o.TextRenderingMode.FILL_STROKE)&&(x=this.getSinglePixelWidth())}else x/=_;if(1!==s&&(a.scale(s,s),x/=s),a.lineWidth=x,r.isInvalidPDFjsFont){let r=[],i=0;for(let t of e)r.push(t.unicode),i+=t.width;return a.fillText(r.join(""),0,0),t.x+=i*y*p,a.restore(),void this.compose()}let w,S=0;for(w=0;w<f;++w){let t=e[w];if("number"==typeof t){S+=g*t*i/1e3;continue}let o,l,h,p=!1,f=(t.isSpace?u:0)+c,x=t.fontChar,_=t.accent,T=t.width;if(m){let e=t.vmetric||v,r=-(t.vmetric?e[1]:.5*T)*y,i=e[2]*y;T=e?-e[0]:T,o=r/s,l=(S+i)/s}else o=S/s,l=0;if(r.remeasure&&T>0){let e=1e3*a.measureText(x).width/i*s;if(T<e&&this.isFontSubpixelAAEnabled){let t=T/e;p=!0,a.save(),a.scale(t,1),o/=t}else T!==e&&(o+=(T-e)/2e3*i/s)}if(this.contentVisible&&(t.isInFont||r.missingFile))if(b&&!_)a.fillText(x,o,l);else if(this.paintChar(x,o,l,n),_){let e=o+i*_.offset.x/s,t=l-i*_.offset.y/s;this.paintChar(_.fontChar,e,t,n)}h=m?T*y-f*d:T*y+f*d,S+=h,p&&a.restore()}m?t.y-=S:t.x+=S*p,a.restore(),this.compose()}showType3Text(e){let t,r,i,n,a=this.ctx,s=this.current,l=s.font,h=s.fontSize,c=s.fontDirection,u=l.vertical?1:-1,d=s.charSpacing,p=s.wordSpacing,f=s.textHScale*c,m=s.fontMatrix||o.FONT_IDENTITY_MATRIX,g=e.length;if(s.textRenderingMode!==o.TextRenderingMode.INVISIBLE&&0!==h){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,a.save(),a.transform(...s.textMatrix),a.translate(s.x,s.y),a.scale(f,c),t=0;t<g;++t){if(r=e[t],"number"==typeof r){n=u*r*h/1e3,this.ctx.translate(n,0),s.x+=n*f;continue}let c=(r.isSpace?p:0)+d,g=l.charProcOperatorList[r.operatorListId];g?(this.contentVisible&&(this.processingType3=r,this.save(),a.scale(h,h),a.transform(...m),this.executeOperatorList(g),this.restore()),i=o.Util.applyTransform([r.width,0],m)[0]*h+c,a.translate(i,0),s.x+=i*f):(0,o.warn)(`Type3 character "${r.operatorListId}" is not available.`)}a.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,r,i,n,a){this.ctx.rect(r,i,n-r,a-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if("TilingPattern"===e[0]){let r=e[1],i=this.baseTransform||(0,l.getCurrentTransform)(this.ctx),n={createCanvasGraphics:e=>new R(e,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new h.TilingPattern(e,r,this.ctx,n,i)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,r){let i=o.Util.makeHexColor(e,t,r);this.ctx.strokeStyle=i,this.current.strokeColor=i}setFillRGBColor(e,t,r){let i=o.Util.makeHexColor(e,t,r);this.ctx.fillStyle=i,this.current.fillColor=i,this.current.patternFill=!1}_getPattern(e,t=null){let r;return this.cachedPatterns.has(e)?r=this.cachedPatterns.get(e):(r=(0,h.getShadingPattern)(this.getObject(e)),this.cachedPatterns.set(e,r)),t&&(r.matrix=t),r}shadingFill(e){if(!this.contentVisible)return;let t=this.ctx;this.save();let r=this._getPattern(e);t.fillStyle=r.getPattern(t,this,(0,l.getCurrentTransformInverse)(t),h.PathType.SHADING);let i=(0,l.getCurrentTransformInverse)(t);if(i){let{width:e,height:r}=t.canvas,[n,a,s,l]=o.Util.getAxialAlignedBoundingBox([0,0,e,r],i);this.ctx.fillRect(n,a,s-n,l-a)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,o.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,o.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(e)&&6===e.length&&this.transform(...e),this.baseTransform=(0,l.getCurrentTransform)(this.ctx),t)){let e=t[2]-t[0],r=t[3]-t[1];this.ctx.rect(t[0],t[1],e,r),this.current.updateRectMinMax((0,l.getCurrentTransform)(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let t=this.ctx;e.isolated||(0,o.info)("TODO: Support non-isolated groups."),e.knockout&&(0,o.warn)("Knockout groups not supported.");let r=(0,l.getCurrentTransform)(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let i=o.Util.getAxialAlignedBoundingBox(e.bbox,(0,l.getCurrentTransform)(t)),n=[0,0,t.canvas.width,t.canvas.height];i=o.Util.intersect(i,n)||[0,0,0,0];let a=Math.floor(i[0]),s=Math.floor(i[1]),h=Math.max(Math.ceil(i[2])-a,1),c=Math.max(Math.ceil(i[3])-s,1),u=1,p=1;h>d&&(u=h/d,h=d),c>d&&(p=c/d,c=d),this.current.startNewPathAndClipBox([0,0,h,c]);let f="groupAt"+this.groupLevel;e.smask&&(f+="_smask_"+this.smaskCounter++%2);let m=this.cachedCanvases.getCanvas(f,h,c),g=m.context;g.scale(1/u,1/p),g.translate(-a,-s),g.transform(...r),e.smask?this.smaskStack.push({canvas:m.canvas,context:g,offsetX:a,offsetY:s,scaleX:u,scaleY:p,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(a,s),t.scale(u,p),t.save()),b(t,g),this.ctx=g,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;let t=this.ctx,r=this.groupStack.pop();if(this.ctx=r,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let e=(0,l.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...e);let r=o.Util.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],e);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(e,t,r,a,s){if(Et(this,i,n).call(this),x(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(t)&&4===t.length){let i=t[2]-t[0],n=t[3]-t[1];if(s&&this.annotationCanvasMap){(r=r.slice())[4]-=t[0],r[5]-=t[1],(t=t.slice())[0]=t[1]=0,t[2]=i,t[3]=n;let[a,s]=o.Util.singularValueDecompose2dScale((0,l.getCurrentTransform)(this.ctx)),{viewportScale:h}=this,c=Math.ceil(i*this.outputScaleX*h),u=Math.ceil(n*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(c,u);let{canvas:d,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(e,d),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(a,0,0,-s,0,n*s),x(this.ctx)}else x(this.ctx),this.ctx.rect(t[0],t[1],i,n),this.ctx.clip(),this.endPath()}this.current=new g(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...r),this.transform(...a)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),Et(this,a,s).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;let t=e.count;(e=this.getObject(e.data,e)).count=t;let r=this.ctx,i=this.processingType3;if(i&&(void 0===i.compiled&&(i.compiled=function(e){let{width:t,height:r}=e;if(t>1e3||r>1e3)return null;let i,n,a,s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),o=t+1,l=new Uint8Array(o*(r+1)),h=t+7&-8,c=new Uint8Array(h*r),u=0;for(let t of e.data){let e=128;for(;e>0;)c[u++]=t&e?0:255,e>>=1}let d=0;for(u=0,0!==c[u]&&(l[0]=1,++d),n=1;n<t;n++)c[u]!==c[u+1]&&(l[n]=c[u]?2:1,++d),u++;for(0!==c[u]&&(l[n]=2,++d),i=1;i<r;i++){u=i*h,a=i*o,c[u-h]!==c[u]&&(l[a]=c[u]?1:8,++d);let e=(c[u]?4:0)+(c[u-h]?8:0);for(n=1;n<t;n++)e=(e>>2)+(c[u+1]?4:0)+(c[u-h+1]?8:0),s[e]&&(l[a+n]=s[e],++d),u++;if(c[u-h]!==c[u]&&(l[a+n]=c[u]?2:4,++d),d>1e3)return null}for(u=h*(r-1),a=i*o,0!==c[u]&&(l[a]=8,++d),n=1;n<t;n++)c[u]!==c[u+1]&&(l[a+n]=c[u]?4:8,++d),u++;if(0!==c[u]&&(l[a+n]=4,++d),d>1e3)return null;let p=new Int32Array([0,o,-1,0,-o,0,0,0,1]),f=new Path2D;for(i=0;d&&i<=r;i++){let e=i*o,r=e+t;for(;e<r&&!l[e];)e++;if(e===r)continue;f.moveTo(e%o,i);let n=e,a=l[e];do{let t=p[a];do{e+=t}while(!l[e]);let r=l[e];5!==r&&10!==r?(a=r,l[e]=0):(a=r&51*a>>4,l[e]&=a>>2|a<<2),f.lineTo(e%o,e/o|0),l[e]||--d}while(n!==e);--i}return c=null,l=null,function(e){e.save(),e.scale(1/t,-1/r),e.translate(0,-r),e.fill(f),e.beginPath(),e.restore()}}(e)),i.compiled))return void i.compiled(r);let n=this._createMaskCanvas(e),a=n.canvas;r.save(),r.setTransform(1,0,0,1,0,0),r.drawImage(a,n.offsetX,n.offsetY),r.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,r=0,i=0,n,a){if(!this.contentVisible)return;e=this.getObject(e.data,e);let s=this.ctx;s.save();let h=(0,l.getCurrentTransform)(s);s.transform(t,r,i,n,0,0);let c=this._createMaskCanvas(e);s.setTransform(1,0,0,1,c.offsetX-h[4],c.offsetY-h[5]);for(let e=0,l=a.length;e<l;e+=2){let l=o.Util.transform(h,[t,r,i,n,a[e],a[e+1]]),[u,d]=o.Util.applyTransform([0,0],l);s.drawImage(c.canvas,u,d)}s.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;let t=this.ctx,r=this.current.fillColor,i=this.current.patternFill;for(let n of e){let{data:e,width:a,height:s,transform:o}=n,c=this.cachedCanvases.getCanvas("maskCanvas",a,s),u=c.context;u.save(),y(u,this.getObject(e,n)),u.globalCompositeOperation="source-in",u.fillStyle=i?r.getPattern(u,this,(0,l.getCurrentTransformInverse)(t),h.PathType.FILL):r,u.fillRect(0,0,a,s),u.restore(),t.save(),t.transform(...o),t.scale(1,-1),m(t,c.canvas,0,0,a,s,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;let t=this.getObject(e);t?this.paintInlineImageXObject(t):(0,o.warn)("Dependent image isn't ready yet")}paintImageXObjectRepeat(e,t,r,i){if(!this.contentVisible)return;let n=this.getObject(e);if(!n)return void(0,o.warn)("Dependent image isn't ready yet");let a=n.width,s=n.height,l=[];for(let e=0,n=i.length;e<n;e+=2)l.push({transform:[t,0,0,r,i[e],i[e+1]],x:0,y:0,w:a,h:s});this.paintInlineImageXObjectGroup(n,l)}applyTransferMapsToCanvas(e){return"none"!==this.current.transferMaps&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if("none"===this.current.transferMaps)return e.bitmap;let{bitmap:t,width:r,height:i}=e,n=this.cachedCanvases.getCanvas("inlineImage",r,i),a=n.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",n.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;let t,r=e.width,i=e.height,n=this.ctx;if(this.save(),u.isNodeJS||(n.filter="none"),n.scale(1/r,-1/i),e.bitmap)t=this.applyTransferMapsToBitmap(e);else if("function"==typeof HTMLElement&&e instanceof HTMLElement||!e.data)t=e;else{let n=this.cachedCanvases.getCanvas("inlineImage",r,i).context;v(n,e),t=this.applyTransferMapsToCanvas(n)}let a=this._scaleImage(t,(0,l.getCurrentTransformInverse)(n));n.imageSmoothingEnabled=M((0,l.getCurrentTransform)(n),e.interpolate),m(n,a.img,0,0,a.paintWidth,a.paintHeight,0,-i,r,i),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;let r,i=this.ctx;if(e.bitmap)r=e.bitmap;else{let t=e.width,i=e.height,n=this.cachedCanvases.getCanvas("inlineImage",t,i).context;v(n,e),r=this.applyTransferMapsToCanvas(n)}for(let e of t)i.save(),i.transform(...e.transform),i.scale(1,-1),m(i,r,e.x,e.y,e.w,e.h,0,-1,1,1),i.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){"OC"===e?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){let t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);let r=this.ctx;this.pendingClip&&(t||(this.pendingClip===P?r.clip("evenodd"):r.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),r.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let e=(0,l.getCurrentTransform)(this.ctx);if(0===e[1]&&0===e[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{let t=Math.abs(e[0]*e[3]-e[2]*e[1]),r=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(r,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(-1===this._cachedScaleForStroking[0]){let e,t,{lineWidth:r}=this.current,{a:i,b:n,c:a,d:s}=this.ctx.getTransform();if(0===n&&0===a){let n=Math.abs(i),a=Math.abs(s);if(n===a)if(0===r)e=t=1/n;else{let i=n*r;e=t=i<1?1/i:1}else if(0===r)e=1/n,t=1/a;else{let i=n*r,s=a*r;e=i<1?1/i:1,t=s<1?1/s:1}}else{let o=Math.abs(i*s-n*a),l=Math.hypot(i,n),h=Math.hypot(a,s);if(0===r)e=h/o,t=l/o;else{let i=r*o;e=h>i?h/i:1,t=l>i?l/i:1}}this._cachedScaleForStroking[0]=e,this._cachedScaleForStroking[1]=t}return this._cachedScaleForStroking}rescaleAndStroke(e){let{ctx:t}=this,{lineWidth:r}=this.current,[i,n]=this.getScaleForStroking();if(t.lineWidth=r||1,1===i&&1===n)return void t.stroke();let a=t.getLineDash();if(e&&t.save(),t.scale(i,n),a.length>0){let e=Math.max(i,n);t.setLineDash(a.map((t=>t/e))),t.lineDashOffset/=e}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}},I=R;i=new WeakSet,n=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},a=new WeakSet,s=function(){if(this.pageColors){let e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==e){let t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},t.CanvasGraphics=I;for(let e in o.OPS)void 0!==I.prototype[e]&&(I.prototype[o.OPS[e]]=I.prototype[e])},(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TilingPattern=t.PathType=void 0,t.getShadingPattern=function(e){switch(e[0]){case"RadialAxial":return new l(e);case"Mesh":return new u(e);case"Dummy":return new d}throw new Error(`Unknown IR type: ${e[0]}`)};var i=r(1),n=r(6);let a={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function s(e,t){if(!t)return;let r=t[2]-t[0],i=t[3]-t[1],n=new Path2D;n.rect(t[0],t[1],r,i),e.clip(n)}t.PathType=a;class o{constructor(){this.constructor===o&&(0,i.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,i.unreachable)("Abstract method `getPattern` called.")}}class l extends o{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;"axial"===this._type?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let e of this._colorStops)t.addColorStop(e[0],e[1]);return t}getPattern(e,t,r,o){let l;if(o===a.STROKE||o===a.FILL){let a=t.current.getClippedPathBoundingBox(o,(0,n.getCurrentTransform)(e))||[0,0,0,0],h=Math.ceil(a[2]-a[0])||1,c=Math.ceil(a[3]-a[1])||1,u=t.cachedCanvases.getCanvas("pattern",h,c,!0),d=u.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-a[0],-a[1]),r=i.Util.transform(r,[1,0,0,1,a[0],a[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),s(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),l=e.createPattern(u.canvas,"no-repeat");let p=new DOMMatrix(r);l.setTransform(p)}else s(e,this._bbox),l=this._createGradient(e);return l}}function h(e,t,r,i,n,a,s,o){let l,h=t.coords,c=t.colors,u=e.data,d=4*e.width;h[r+1]>h[i+1]&&(l=r,r=i,i=l,l=a,a=s,s=l),h[i+1]>h[n+1]&&(l=i,i=n,n=l,l=s,s=o,o=l),h[r+1]>h[i+1]&&(l=r,r=i,i=l,l=a,a=s,s=l);let p=(h[r]+t.offsetX)*t.scaleX,f=(h[r+1]+t.offsetY)*t.scaleY,m=(h[i]+t.offsetX)*t.scaleX,g=(h[i+1]+t.offsetY)*t.scaleY,v=(h[n]+t.offsetX)*t.scaleX,y=(h[n+1]+t.offsetY)*t.scaleY;if(f>=y)return;let b,x,_,w,S,T,M,E,A=c[a],C=c[a+1],P=c[a+2],R=c[s],I=c[s+1],O=c[s+2],L=c[o],D=c[o+1],k=c[o+2],F=Math.round(f),N=Math.round(y);for(let e=F;e<=N;e++){if(e<g){let t;t=e<f?0:(f-e)/(f-g),b=p-(p-m)*t,x=A-(A-R)*t,_=C-(C-I)*t,w=P-(P-O)*t}else{let t;t=e>y?1:g===y?0:(g-e)/(g-y),b=m-(m-v)*t,x=R-(R-L)*t,_=I-(I-D)*t,w=O-(O-k)*t}let t;t=e<f?0:e>y?1:(f-e)/(f-y),S=p-(p-v)*t,T=A-(A-L)*t,M=C-(C-D)*t,E=P-(P-k)*t;let r=Math.round(Math.min(b,S)),i=Math.round(Math.max(b,S)),n=d*e+4*r;for(let e=r;e<=i;e++)t=(b-e)/(b-S),t<0?t=0:t>1&&(t=1),u[n++]=x-(x-T)*t|0,u[n++]=_-(_-M)*t|0,u[n++]=w-(w-E)*t|0,u[n++]=255}}function c(e,t,r){let i,n,a=t.coords,s=t.colors;switch(t.type){case"lattice":let o=t.verticesPerRow,l=Math.floor(a.length/o)-1,c=o-1;for(i=0;i<l;i++){let t=i*o;for(let i=0;i<c;i++,t++)h(e,r,a[t],a[t+1],a[t+o],s[t],s[t+1],s[t+o]),h(e,r,a[t+o+1],a[t+1],a[t+o],s[t+o+1],s[t+1],s[t+o])}break;case"triangles":for(i=0,n=a.length;i<n;i+=3)h(e,r,a[i],a[i+1],a[i+2],s[i],s[i+1],s[i+2]);break;default:throw new Error("illegal figure")}}class u extends o{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,r){let i=Math.floor(this._bounds[0]),n=Math.floor(this._bounds[1]),a=Math.ceil(this._bounds[2])-i,s=Math.ceil(this._bounds[3])-n,o=Math.min(Math.ceil(Math.abs(a*e[0]*1.1)),3e3),l=Math.min(Math.ceil(Math.abs(s*e[1]*1.1)),3e3),h=a/o,u=s/l,d={coords:this._coords,colors:this._colors,offsetX:-i,offsetY:-n,scaleX:1/h,scaleY:1/u},p=o+4,f=l+4,m=r.getCanvas("mesh",p,f,!1),g=m.context,v=g.createImageData(o,l);if(t){let e=v.data;for(let r=0,i=e.length;r<i;r+=4)e[r]=t[0],e[r+1]=t[1],e[r+2]=t[2],e[r+3]=255}for(let e of this._figures)c(v,e,d);return g.putImageData(v,2,2),{canvas:m.canvas,offsetX:i-2*h,offsetY:n-2*u,scaleX:h,scaleY:u}}getPattern(e,t,r,o){let l;if(s(e,this._bbox),o===a.SHADING)l=i.Util.singularValueDecompose2dScale((0,n.getCurrentTransform)(e));else if(l=i.Util.singularValueDecompose2dScale(t.baseTransform),this.matrix){let e=i.Util.singularValueDecompose2dScale(this.matrix);l=[l[0]*e[0],l[1]*e[1]]}let h=this._createMeshCanvas(l,o===a.SHADING?null:this._background,t.cachedCanvases);return o!==a.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(h.offsetX,h.offsetY),e.scale(h.scaleX,h.scaleY),e.createPattern(h.canvas,"no-repeat")}}class d extends o{getPattern(){return"hotpink"}}let p=1,f=2,m=class{constructor(e,t,r,i,n){this.operatorList=e[2],this.matrix=e[3]||[1,0,0,1,0,0],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=r,this.canvasGraphicsFactory=i,this.baseTransform=n}createPatternCanvas(e){let t=this.operatorList,r=this.bbox,a=this.xstep,s=this.ystep,o=this.paintType,l=this.tilingType,h=this.color,c=this.canvasGraphicsFactory;(0,i.info)("TilingType: "+l);let u=r[0],d=r[1],p=r[2],f=r[3],m=i.Util.singularValueDecompose2dScale(this.matrix),g=i.Util.singularValueDecompose2dScale(this.baseTransform),v=[m[0]*g[0],m[1]*g[1]],y=this.getSizeAndScale(a,this.ctx.canvas.width,v[0]),b=this.getSizeAndScale(s,this.ctx.canvas.height,v[1]),x=e.cachedCanvases.getCanvas("pattern",y.size,b.size,!0),_=x.context,w=c.createCanvasGraphics(_);w.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(w,o,h);let S=u,T=d,M=p,E=f;return u<0&&(S=0,M+=Math.abs(u)),d<0&&(T=0,E+=Math.abs(d)),_.translate(-y.scale*S,-b.scale*T),w.transform(y.scale,0,0,b.scale,0,0),_.save(),this.clipBbox(w,S,T,M,E),w.baseTransform=(0,n.getCurrentTransform)(w.ctx),w.executeOperatorList(t),w.endDrawing(),{canvas:x.canvas,scaleX:y.scale,scaleY:b.scale,offsetX:S,offsetY:T}}getSizeAndScale(e,t,r){e=Math.abs(e);let i=Math.max(m.MAX_PATTERN_SIZE,t),n=Math.ceil(e*r);return n>=i?n=i:r=n/e,{scale:r,size:n}}clipBbox(e,t,r,i,a){let s=i-t,o=a-r;e.ctx.rect(t,r,s,o),e.current.updateRectMinMax((0,n.getCurrentTransform)(e.ctx),[t,r,i,a]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,r){let n=e.ctx,a=e.current;switch(t){case p:let e=this.ctx;n.fillStyle=e.fillStyle,n.strokeStyle=e.strokeStyle,a.fillColor=e.fillStyle,a.strokeColor=e.strokeStyle;break;case f:let s=i.Util.makeHexColor(r[0],r[1],r[2]);n.fillStyle=s,n.strokeStyle=s,a.fillColor=s,a.strokeColor=s;break;default:throw new i.FormatError(`Unsupported paint type: ${t}`)}}getPattern(e,t,r,n){let s=r;n!==a.SHADING&&(s=i.Util.transform(s,t.baseTransform),this.matrix&&(s=i.Util.transform(s,this.matrix)));let o=this.createPatternCanvas(t),l=new DOMMatrix(s);l=l.translate(o.offsetX,o.offsetY),l=l.scale(1/o.scaleX,1/o.scaleY);let h=e.createPattern(o.canvas,"repeat");return h.setTransform(l),h}},g=m;Es(g,"MAX_PATTERN_SIZE",3e3),t.TilingPattern=g},(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertBlackAndWhiteToRGBA=n,t.convertToRGBA=function(e){switch(e.kind){case i.ImageKind.GRAYSCALE_1BPP:return n(e);case i.ImageKind.RGB_24BPP:return function({src:e,srcPos:t=0,dest:r,destPos:n=0,width:a,height:s}){let o=0,l=e.length>>2,h=new Uint32Array(e.buffer,t,l);if(i.FeatureTest.isLittleEndian){for(;o<l-2;o+=3,n+=4){let e=h[o],t=h[o+1],i=h[o+2];r[n]=4278190080|e,r[n+1]=e>>>24|t<<8|4278190080,r[n+2]=t>>>16|i<<16|4278190080,r[n+3]=i>>>8|4278190080}for(let t=4*o,i=e.length;t<i;t+=3)r[n++]=e[t]|e[t+1]<<8|e[t+2]<<16|4278190080}else{for(;o<l-2;o+=3,n+=4){let e=h[o],t=h[o+1],i=h[o+2];r[n]=255|e,r[n+1]=e<<24|t>>>8|255,r[n+2]=t<<16|i>>>16|255,r[n+3]=i<<8|255}for(let t=4*o,i=e.length;t<i;t+=3)r[n++]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|255}return{srcPos:t,destPos:n}}(e)}return null},t.grayToRGBA=function(e,t){if(i.FeatureTest.isLittleEndian)for(let r=0,i=e.length;r<i;r++)t[r]=65793*e[r]|4278190080;else for(let r=0,i=e.length;r<i;r++)t[r]=16843008*e[r]|255};var i=r(1);function n({src:e,srcPos:t=0,dest:r,width:n,height:a,nonBlackColor:s=4294967295,inverseDecode:o=!1}){let l=i.FeatureTest.isLittleEndian?4278190080:255,[h,c]=o?[s,l]:[l,s],u=n>>3,d=7&n,p=e.length;r=new Uint32Array(r.buffer);let f=0;for(let i=0;i<a;i++){for(let i=t+u;t<i;t++){let i=t<p?e[t]:255;r[f++]=128&i?c:h,r[f++]=64&i?c:h,r[f++]=32&i?c:h,r[f++]=16&i?c:h,r[f++]=8&i?c:h,r[f++]=4&i?c:h,r[f++]=2&i?c:h,r[f++]=1&i?c:h}if(0===d)continue;let i=t<p?e[t++]:255;for(let e=0;e<d;e++)r[f++]=i&1<<7-e?c:h}return{srcPos:t,destPos:f}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalWorkerOptions=void 0;let r=Object.create(null);t.GlobalWorkerOptions=r,r.workerPort=null,r.workerSrc=""},(e,t,r)=>{var i,n,a,s,o,l;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHandler=void 0;var h=r(1);let c=1,u=2,d=1,p=2,f=3,m=4,g=5,v=6,y=7,b=8;function x(e){switch(e instanceof Error||"object"==typeof e&&null!==e||(0,h.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),e.name){case"AbortException":return new h.AbortException(e.message);case"MissingPDFException":return new h.MissingPDFException(e.message);case"PasswordException":return new h.PasswordException(e.message,e.code);case"UnexpectedResponseException":return new h.UnexpectedResponseException(e.message,e.status);case"UnknownErrorException":return new h.UnknownErrorException(e.message,e.details);default:return new h.UnknownErrorException(e.message,e.toString())}}i=new WeakSet,n=function(e){let t=e.streamId,r=this.sourceName,i=e.sourceName,n=this.comObj,a=this,s=this.actionHandler[e.action],o={enqueue(e,a=1,s){if(this.isCancelled)return;let o=this.desiredSize;this.desiredSize-=a,o>0&&this.desiredSize<=0&&(this.sinkCapability=new h.PromiseCapability,this.ready=this.sinkCapability.promise),n.postMessage({sourceName:r,targetName:i,stream:m,streamId:t,chunk:e},s)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:r,targetName:i,stream:f,streamId:t}),delete a.streamSinks[t])},error(e){(0,h.assert)(e instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:r,targetName:i,stream:g,streamId:t,reason:x(e)}))},sinkCapability:new h.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};o.sinkCapability.resolve(),o.ready=o.sinkCapability.promise,this.streamSinks[t]=o,new Promise((function(t){t(s(e.data,o))})).then((function(){n.postMessage({sourceName:r,targetName:i,stream:b,streamId:t,success:!0})}),(function(e){n.postMessage({sourceName:r,targetName:i,stream:b,streamId:t,reason:x(e)})}))},a=new WeakSet,s=function(e){let t=e.streamId,r=this.sourceName,i=e.sourceName,n=this.comObj,a=this.streamControllers[t],s=this.streamSinks[t];switch(e.stream){case b:e.success?a.startCall.resolve():a.startCall.reject(x(e.reason));break;case y:e.success?a.pullCall.resolve():a.pullCall.reject(x(e.reason));break;case v:if(!s){n.postMessage({sourceName:r,targetName:i,stream:y,streamId:t,success:!0});break}s.desiredSize<=0&&e.desiredSize>0&&s.sinkCapability.resolve(),s.desiredSize=e.desiredSize,new Promise((function(e){var t;e(null==(t=s.onPull)?void 0:t.call(s))})).then((function(){n.postMessage({sourceName:r,targetName:i,stream:y,streamId:t,success:!0})}),(function(e){n.postMessage({sourceName:r,targetName:i,stream:y,streamId:t,reason:x(e)})}));break;case m:if((0,h.assert)(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case f:if((0,h.assert)(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),Et(this,o,l).call(this,a,t);break;case g:(0,h.assert)(a,"error should have stream controller"),a.controller.error(x(e.reason)),Et(this,o,l).call(this,a,t);break;case p:e.success?a.cancelCall.resolve():a.cancelCall.reject(x(e.reason)),Et(this,o,l).call(this,a,t);break;case d:if(!s)break;new Promise((function(t){var r;t(null==(r=s.onCancel)?void 0:r.call(s,x(e.reason)))})).then((function(){n.postMessage({sourceName:r,targetName:i,stream:p,streamId:t,success:!0})}),(function(e){n.postMessage({sourceName:r,targetName:i,stream:p,streamId:t,reason:x(e)})})),s.sinkCapability.reject(x(e.reason)),s.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},o=new WeakSet,l=function(e,t){return bt(this,null,(function*(){var r,i,n;yield Promise.allSettled([null==(r=e.startCall)?void 0:r.promise,null==(i=e.pullCall)?void 0:i.promise,null==(n=e.cancelCall)?void 0:n.promise]),delete this.streamControllers[t]}))},t.MessageHandler=class{constructor(e,t,r){at(this,i),at(this,a),at(this,o),this.sourceName=e,this.targetName=t,this.comObj=r,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=e=>{let t=e.data;if(t.targetName!==this.sourceName)return;if(t.stream)return void Et(this,a,s).call(this,t);if(t.callback){let e=t.callbackId,r=this.callbackCapabilities[e];if(!r)throw new Error(`Cannot resolve callback ${e}`);if(delete this.callbackCapabilities[e],t.callback===c)r.resolve(t.data);else{if(t.callback!==u)throw new Error("Unexpected callback case");r.reject(x(t.reason))}return}let o=this.actionHandler[t.action];if(!o)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){let e=this.sourceName,i=t.sourceName;new Promise((function(e){e(o(t.data))})).then((function(n){r.postMessage({sourceName:e,targetName:i,callback:c,callbackId:t.callbackId,data:n})}),(function(n){r.postMessage({sourceName:e,targetName:i,callback:u,callbackId:t.callbackId,reason:x(n)})}))}else t.streamId?Et(this,i,n).call(this,t):o(t.data)},r.addEventListener("message",this._onComObjOnMessage)}on(e,t){let r=this.actionHandler;if(r[e])throw new Error(`There is already an actionName called "${e}"`);r[e]=t}send(e,t,r){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},r)}sendWithPromise(e,t,r){let i=this.callbackId++,n=new h.PromiseCapability;this.callbackCapabilities[i]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},r)}catch(e){n.reject(e)}return n.promise}sendWithStream(e,t,r,i){let n=this.streamId++,a=this.sourceName,s=this.targetName,o=this.comObj;return new ReadableStream({start:r=>{let l=new h.PromiseCapability;return this.streamControllers[n]={controller:r,startCall:l,pullCall:null,cancelCall:null,isClosed:!1},o.postMessage({sourceName:a,targetName:s,action:e,streamId:n,data:t,desiredSize:r.desiredSize},i),l.promise},pull:e=>{let t=new h.PromiseCapability;return this.streamControllers[n].pullCall=t,o.postMessage({sourceName:a,targetName:s,stream:v,streamId:n,desiredSize:e.desiredSize}),t.promise},cancel:e=>{(0,h.assert)(e instanceof Error,"cancel must have a valid reason");let t=new h.PromiseCapability;return this.streamControllers[n].cancelCall=t,this.streamControllers[n].isClosed=!0,o.postMessage({sourceName:a,targetName:s,stream:d,streamId:n,reason:x(e)}),t.promise}},r)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}},(e,t,r)=>{var i,n;Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var a=r(1);i=new WeakMap,n=new WeakMap,t.Metadata=class{constructor({parsedData:e,rawData:t}){at(this,i,void 0),at(this,n,void 0),Bt(this,i,e),Bt(this,n,t)}getRaw(){return ce(this,n)}get(e){var t;return null!=(t=ce(this,i).get(e))?t:null}getAll(){return(0,a.objectFromMap)(ce(this,i))}has(e){return ce(this,i).has(e)}}},(e,t,r)=>{var i,n,a,s,o,l,h;Object.defineProperty(t,"__esModule",{value:!0}),t.OptionalContentConfig=void 0;var c=r(1),u=r(8);let d=Symbol("INTERNAL");class p{constructor(e,t){at(this,i,!0),this.name=e,this.intent=t}get visible(){return ce(this,i)}_setVisible(e,t){e!==d&&(0,c.unreachable)("Internal method `_setVisible` called."),Bt(this,i,t)}}i=new WeakMap,n=new WeakMap,a=new WeakMap,s=new WeakMap,o=new WeakMap,l=new WeakSet,h=function(e){let t=e.length;if(t<2)return!0;let r=e[0];for(let i=1;i<t;i++){let t,n=e[i];if(Array.isArray(n))t=Et(this,l,h).call(this,n);else{if(!ce(this,a).has(n))return(0,c.warn)(`Optional content group not found: ${n}`),!0;t=ce(this,a).get(n).visible}switch(r){case"And":if(!t)return!1;break;case"Or":if(t)return!0;break;case"Not":return!t;default:return!0}}return"And"===r},t.OptionalContentConfig=class{constructor(e){if(at(this,l),at(this,n,null),at(this,a,new Map),at(this,s,null),at(this,o,null),this.name=null,this.creator=null,null!==e){this.name=e.name,this.creator=e.creator,Bt(this,o,e.order);for(let t of e.groups)ce(this,a).set(t.id,new p(t.name,t.intent));if("OFF"===e.baseState)for(let e of ce(this,a).values())e._setVisible(d,!1);for(let t of e.on)ce(this,a).get(t)._setVisible(d,!0);for(let t of e.off)ce(this,a).get(t)._setVisible(d,!1);Bt(this,s,this.getHash())}}isVisible(e){if(0===ce(this,a).size)return!0;if(!e)return(0,c.warn)("Optional content group not defined."),!0;if("OCG"===e.type)return ce(this,a).has(e.id)?ce(this,a).get(e.id).visible:((0,c.warn)(`Optional content group not found: ${e.id}`),!0);if("OCMD"===e.type){if(e.expression)return Et(this,l,h).call(this,e.expression);if(!e.policy||"AnyOn"===e.policy){for(let t of e.ids){if(!ce(this,a).has(t))return(0,c.warn)(`Optional content group not found: ${t}`),!0;if(ce(this,a).get(t).visible)return!0}return!1}if("AllOn"===e.policy){for(let t of e.ids){if(!ce(this,a).has(t))return(0,c.warn)(`Optional content group not found: ${t}`),!0;if(!ce(this,a).get(t).visible)return!1}return!0}if("AnyOff"===e.policy){for(let t of e.ids){if(!ce(this,a).has(t))return(0,c.warn)(`Optional content group not found: ${t}`),!0;if(!ce(this,a).get(t).visible)return!0}return!1}if("AllOff"===e.policy){for(let t of e.ids){if(!ce(this,a).has(t))return(0,c.warn)(`Optional content group not found: ${t}`),!0;if(ce(this,a).get(t).visible)return!1}return!0}return(0,c.warn)(`Unknown optional content policy ${e.policy}.`),!0}return(0,c.warn)(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0){ce(this,a).has(e)?(ce(this,a).get(e)._setVisible(d,!!t),Bt(this,n,null)):(0,c.warn)(`Optional content group not found: ${e}`)}get hasInitialVisibility(){return this.getHash()===ce(this,s)}getOrder(){return ce(this,a).size?ce(this,o)?ce(this,o).slice():[...ce(this,a).keys()]:null}getGroups(){return ce(this,a).size>0?(0,c.objectFromMap)(ce(this,a)):null}getGroup(e){return ce(this,a).get(e)||null}getHash(){if(null!==ce(this,n))return ce(this,n);let e=new u.MurmurHash3_64;for(let[t,r]of ce(this,a))e.update(`${t}:${r.visible}`);return Bt(this,n,e.hexdigest())}}},(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFDataTransportStream=void 0;var i=r(1),n=r(6);t.PDFDataTransportStream=class{constructor({length:e,initialData:t,progressiveDone:r=!1,contentDispositionFilename:n=null,disableRange:a=!1,disableStream:s=!1},o){if((0,i.assert)(o,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=r,this._contentDispositionFilename=n,(null==t?void 0:t.length)>0){let e=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;this._queuedChunks.push(e)}this._pdfDataRangeTransport=o,this._isStreamingSupported=!s,this._isRangeSupported=!a,this._contentLength=e,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener(((e,t)=>{this._onReceiveData({begin:e,chunk:t})})),this._pdfDataRangeTransport.addProgressListener(((e,t)=>{this._onProgress({loaded:e,total:t})})),this._pdfDataRangeTransport.addProgressiveReadListener((e=>{this._onReceiveData({chunk:e})})),this._pdfDataRangeTransport.addProgressiveDoneListener((()=>{this._onProgressiveDone()})),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:e,chunk:t}){let r=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(void 0===e)this._fullRequestReader?this._fullRequestReader._enqueue(r):this._queuedChunks.push(r);else{let t=this._rangeReaders.some((function(t){return t._begin===e&&(t._enqueue(r),!0)}));(0,i.assert)(t,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e,t;return null!=(t=null==(e=this._fullRequestReader)?void 0:e._loaded)?t:0}_onProgress(e){var t,r,i,n;void 0===e.total?null==(r=null==(t=this._rangeReaders[0])?void 0:t.onProgress)||r.call(t,{loaded:e.loaded}):null==(n=null==(i=this._fullRequestReader)?void 0:i.onProgress)||n.call(i,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;null==(e=this._fullRequestReader)||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){let t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){(0,i.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let e=this._queuedChunks;return this._queuedChunks=null,new a(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let r=new s(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(r),r}cancelAllRequests(e){var t;null==(t=this._fullRequestReader)||t.cancel(e);for(let t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}};class a{constructor(e,t,r=!1,i=null){this._stream=e,this._done=r||!1,this._filename=(0,n.isPdfFile)(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(let e of this._queuedChunks)this._loaded+=e.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}read(){return bt(this,null,(function*(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=new i.PromiseCapability;return this._requests.push(e),e.promise}))}cancel(e){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class s{constructor(e,t,r){this._stream=e,this._begin=t,this._end=r,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(0===this._requests.length)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}read(){return bt(this,null,(function*(){if(this._queuedChunk){let e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};let e=new i.PromiseCapability;return this._requests.push(e),e.promise}))}cancel(e){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.XfaText=void 0;class r{static textContent(e){let t=[],i={items:t,styles:Object.create(null)};return function e(i){var n;if(!i)return;let a=null,s=i.name;if("#text"===s)a=i.value;else{if(!r.shouldBuildText(s))return;null!=(n=null==i?void 0:i.attributes)&&n.textContent?a=i.attributes.textContent:i.value&&(a=i.value)}if(null!==a&&t.push({str:a}),i.children)for(let t of i.children)e(t)}(e),i}static shouldBuildText(e){return!("textarea"===e||"input"===e||"option"===e||"select"===e)}}t.XfaText=r},(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NodeStandardFontDataFactory=t.NodeFilterFactory=t.NodeCanvasFactory=t.NodeCMapReaderFactory=void 0;var i=r(7);let n=function(e){return new Promise(((t,r)=>{y3().readFile(e,((e,i)=>{!e&&i?t(new Uint8Array(i)):r(new Error(e))}))}))};class a extends i.BaseFilterFactory{}t.NodeFilterFactory=a;class s extends i.BaseCanvasFactory{_createCanvas(e,t){return BAe().createCanvas(e,t)}}t.NodeCanvasFactory=s;class o extends i.BaseCMapReaderFactory{_fetchData(e,t){return n(e).then((e=>({cMapData:e,compressionType:t})))}}t.NodeCMapReaderFactory=o;class l extends i.BaseStandardFontDataFactory{_fetchData(e){return n(e)}}t.NodeStandardFontDataFactory=l},(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFNodeStream=void 0;var i=r(1),n=r(22);let a=y3(),s=NAe(),o=UAe(),l=HAe(),h=/^file:\/\/\/[a-zA-Z]:\//;t.PDFNodeStream=class{constructor(e){this.source=e,this.url=function(e){let t=l.parse(e);return"file:"===t.protocol||t.host?t:/^[a-z]:[/\\]/i.test(e)?l.parse(`file:///${e}`):(t.host||(t.protocol="file:"),t)}(e.url),this.isHttp="http:"===this.url.protocol||"https:"===this.url.protocol,this.isFsUrl="file:"===this.url.protocol,this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e,t;return null!=(t=null==(e=this._fullRequestReader)?void 0:e._loaded)?t:0}getFullReader(){return(0,i.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new m(this):new p(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let r=this.isFsUrl?new g(this,e,t):new f(this,e,t);return this._rangeRequestReaders.push(r),r}cancelAllRequests(e){var t;null==(t=this._fullRequestReader)||t.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}};class c{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;let t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=new i.PromiseCapability,this._headersCapability=new i.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){return bt(this,null,(function*(){var e;if(yield this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let t=this._readableStream.read();return null===t?(this._readCapability=new i.PromiseCapability,this.read()):(this._loaded+=t.length,null==(e=this.onProgress)||e.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}))}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",(()=>{this._readCapability.resolve()})),e.on("end",(()=>{e.destroy(),this._done=!0,this._readCapability.resolve()})),e.on("error",(e=>{this._error(e)})),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new i.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class u{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new i.PromiseCapability;let t=e.source;this._isStreamingSupported=!t.disableStream}get isStreamingSupported(){return this._isStreamingSupported}read(){return bt(this,null,(function*(){var e;if(yield this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let t=this._readableStream.read();return null===t?(this._readCapability=new i.PromiseCapability,this.read()):(this._loaded+=t.length,null==(e=this.onProgress)||e.call(this,{loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}))}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",(()=>{this._readCapability.resolve()})),e.on("end",(()=>{e.destroy(),this._done=!0,this._readCapability.resolve()})),e.on("error",(e=>{this._error(e)})),this._storedError&&this._readableStream.destroy(this._storedError)}}function d(e,t){return{protocol:e.protocol,auth:e.auth,host:e.hostname,port:e.port,path:e.path,method:"GET",headers:t}}class p extends c{constructor(e){super(e);let t=t=>{if(404===t.statusCode){let e=new i.MissingPDFException(`Missing PDF "${this._url}".`);return this._storedError=e,void this._headersCapability.reject(e)}this._headersCapability.resolve(),this._setReadableStream(t);let r=e=>this._readableStream.headers[e.toLowerCase()],{allowRangeRequests:a,suggestedLength:s}=(0,n.validateRangeRequestCapabilities)({getResponseHeader:r,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=s||this._contentLength,this._filename=(0,n.extractFilenameFromHeader)(r)};this._request=null,"http:"===this._url.protocol?this._request=s.request(d(this._url,e.httpHeaders),t):this._request=o.request(d(this._url,e.httpHeaders),t),this._request.on("error",(e=>{this._storedError=e,this._headersCapability.reject(e)})),this._request.end()}}class f extends u{constructor(e,t,r){super(e),this._httpHeaders={};for(let t in e.httpHeaders){let r=e.httpHeaders[t];void 0!==r&&(this._httpHeaders[t]=r)}this._httpHeaders.Range=`bytes=${t}-${r-1}`;let n=e=>{if(404!==e.statusCode)this._setReadableStream(e);else{let e=new i.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=e}};this._request=null,"http:"===this._url.protocol?this._request=s.request(d(this._url,this._httpHeaders),n):this._request=o.request(d(this._url,this._httpHeaders),n),this._request.on("error",(e=>{this._storedError=e})),this._request.end()}}class m extends c{constructor(e){super(e);let t=decodeURIComponent(this._url.path);h.test(this._url.href)&&(t=t.replace(/^\//,"")),a.lstat(t,((e,r)=>{if(e)return"ENOENT"===e.code&&(e=new i.MissingPDFException(`Missing PDF "${t}".`)),this._storedError=e,void this._headersCapability.reject(e);this._contentLength=r.size,this._setReadableStream(a.createReadStream(t)),this._headersCapability.resolve()}))}}class g extends u{constructor(e,t,r){super(e);let i=decodeURIComponent(this._url.path);h.test(this._url.href)&&(i=i.replace(/^\//,"")),this._setReadableStream(a.createReadStream(i,{start:t,end:r-1}))}}},(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createResponseStatusError=function(e,t){return 404===e||0===e&&t.startsWith("file:")?new i.MissingPDFException('Missing PDF "'+t+'".'):new i.UnexpectedResponseException(`Unexpected server response (${e}) while retrieving PDF "${t}".`,e)},t.extractFilenameFromHeader=function(e){let t=e("Content-Disposition");if(t){let e=(0,n.getFilenameFromContentDispositionHeader)(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch(e){}if((0,a.isPdfFile)(e))return e}return null},t.validateRangeRequestCapabilities=function({getResponseHeader:e,isHttp:t,rangeChunkSize:r,disableRange:i}){let n={allowRangeRequests:!1,suggestedLength:void 0},a=parseInt(e("Content-Length"),10);return!Number.isInteger(a)||(n.suggestedLength=a,a<=2*r)||i||!t||"bytes"!==e("Accept-Ranges")||"identity"!==(e("Content-Encoding")||"identity")||(n.allowRangeRequests=!0),n},t.validateResponseStatus=function(e){return 200===e||206===e};var i=r(1),n=r(23),a=r(6)},(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFilenameFromContentDispositionHeader=function(e){let t=!0,r=n("filename\\*","i").exec(e);if(r){r=r[1];let e=o(r);return e=unescape(e),e=l(e),e=h(e),s(e)}if(r=function(e){let t,r=[],i=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(t=i.exec(e));){let[,e,i,n]=t;if(e=parseInt(e,10),e in r){if(0===e)break}else r[e]=[i,n]}let a=[];for(let e=0;e<r.length&&e in r;++e){let[t,i]=r[e];i=o(i),t&&(i=unescape(i),0===e&&(i=l(i))),a.push(i)}return a.join("")}(e),r)return s(h(r));if(r=n("filename","i").exec(e),r){r=r[1];let e=o(r);return e=h(e),s(e)}function n(e,t){return new RegExp("(?:^|;)\\s*"+e+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',t)}function a(e,r){if(e){if(!/^[\x00-\xFF]+$/.test(r))return r;try{let n=new TextDecoder(e,{fatal:!0}),a=(0,i.stringToBytes)(r);r=n.decode(a),t=!1}catch(e){}}return r}function s(e){return t&&/[\x80-\xff]/.test(e)&&(e=a("utf-8",e),t&&(e=a("iso-8859-1",e))),e}function o(e){if(e.startsWith('"')){let t=e.slice(1).split('\\"');for(let e=0;e<t.length;++e){let r=t[e].indexOf('"');-1!==r&&(t[e]=t[e].slice(0,r),t.length=e+1),t[e]=t[e].replaceAll(/\\(.)/g,"$1")}e=t.join('"')}return e}function l(e){let t=e.indexOf("'");return-1===t?e:a(e.slice(0,t),e.slice(t+1).replace(/^[^']*'/,""))}function h(e){return!e.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(e)?e:e.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,(function(e,t,r,i){if("q"===r||"Q"===r)return a(t,i=(i=i.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,(function(e,t){return String.fromCharCode(parseInt(t,16))})));try{i=atob(i)}catch(e){}return a(t,i)}))}return""};var i=r(1)},(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFNetworkStream=void 0;var i=r(1),n=r(22);class a{constructor(e,t={}){this.url=e,this.isHttp=/^https?:/i.test(e),this.httpHeaders=this.isHttp&&t.httpHeaders||Object.create(null),this.withCredentials=t.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(e,t,r){let i={begin:e,end:t};for(let e in r)i[e]=r[e];return this.request(i)}requestFull(e){return this.request(e)}request(e){let t=new XMLHttpRequest,r=this.currXhrId++,i=this.pendingRequests[r]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(let e in this.httpHeaders){let r=this.httpHeaders[e];void 0!==r&&t.setRequestHeader(e,r)}return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=206):i.expectedStatus=200,t.responseType="arraybuffer",e.onError&&(t.onerror=function(r){e.onError(t.status)}),t.onreadystatechange=this.onStateChange.bind(this,r),t.onprogress=this.onProgress.bind(this,r),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),r}onProgress(e,t){var r;let i=this.pendingRequests[e];i&&(null==(r=i.onProgress)||r.call(i,t))}onStateChange(e,t){var r,n,a;let s=this.pendingRequests[e];if(!s)return;let o=s.xhr;if(o.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),4!==o.readyState||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],0===o.status&&this.isHttp)return void(null==(r=s.onError)||r.call(s,o.status));let l=o.status||200;if((200!==l||206!==s.expectedStatus)&&l!==s.expectedStatus)return void(null==(n=s.onError)||n.call(s,o.status));let h=function(e){let t=e.response;return"string"!=typeof t?t:(0,i.stringToBytes)(t).buffer}(o);if(206===l){let e=o.getResponseHeader("Content-Range"),t=/bytes (\d+)-(\d+)\/(\d+)/.exec(e);s.onDone({begin:parseInt(t[1],10),chunk:h})}else h?s.onDone({begin:0,chunk:h}):null==(a=s.onError)||a.call(s,o.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){let t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}t.PDFNetworkStream=class{constructor(e){this._source=e,this._manager=new a(e.url,{httpHeaders:e.httpHeaders,withCredentials:e.withCredentials}),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){let t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return(0,i.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new s(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){let r=new o(this._manager,e,t);return r.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(r),r}cancelAllRequests(e){var t;null==(t=this._fullRequestReader)||t.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}};class s{constructor(e,t){this._manager=e;let r={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._fullRequestId=e.requestFull(r),this._headersReceivedCapability=new i.PromiseCapability,this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let e=this._fullRequestId,t=this._manager.getRequestXhr(e),r=e=>t.getResponseHeader(e),{allowRangeRequests:i,suggestedLength:a}=(0,n.validateRangeRequestCapabilities)({getResponseHeader:r,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});i&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=(0,n.extractFilenameFromHeader)(r),this._isRangeSupported&&this._manager.abortRequest(e),this._headersReceivedCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=(0,n.createResponseStatusError)(e,this._url),this._headersReceivedCapability.reject(this._storedError);for(let e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;null==(t=this.onProgress)||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}read(){return bt(this,null,(function*(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=new i.PromiseCapability;return this._requests.push(e),e.promise}))}cancel(e){this._done=!0,this._headersReceivedCapability.reject(e);for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class o{constructor(e,t,r){this._manager=e;let i={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._requestId=e.requestRange(t,r,i),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var e;null==(e=this.onClosed)||e.call(this,this)}_onDone(e){let t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError=(0,n.createResponseStatusError)(e,this._url);for(let e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||null==(t=this.onProgress)||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}read(){return bt(this,null,(function*(){if(this._storedError)throw this._storedError;if(null!==this._queuedChunk){let e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};let e=new i.PromiseCapability;return this._requests.push(e),e.promise}))}cancel(e){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFFetchStream=void 0;var i=r(1),n=r(22);function a(e,t,r){return{method:"GET",headers:e,signal:r.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function s(e){let t=new Headers;for(let r in e){let i=e[r];void 0!==i&&t.append(r,i)}return t}function o(e){return e instanceof Uint8Array?e.buffer:e instanceof ArrayBuffer?e:((0,i.warn)(`getArrayBuffer - unexpected data format: ${e}`),new Uint8Array(e).buffer)}t.PDFFetchStream=class{constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e,t;return null!=(t=null==(e=this._fullRequestReader)?void 0:e._loaded)?t:0}getFullReader(){return(0,i.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new l(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let r=new h(this,e,t);return this._rangeRequestReaders.push(r),r}cancelAllRequests(e){var t;null==(t=this._fullRequestReader)||t.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}};class l{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;let t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=new i.PromiseCapability,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._headers=s(this._stream.httpHeaders);let r=t.url;fetch(r,a(this._headers,this._withCredentials,this._abortController)).then((e=>{if(!(0,n.validateResponseStatus)(e.status))throw(0,n.createResponseStatusError)(e.status,r);this._reader=e.body.getReader(),this._headersCapability.resolve();let t=t=>e.headers.get(t),{allowRangeRequests:a,suggestedLength:s}=(0,n.validateRangeRequestCapabilities)({getResponseHeader:t,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=s||this._contentLength,this._filename=(0,n.extractFilenameFromHeader)(t),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new i.AbortException("Streaming is disabled."))})).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){return bt(this,null,(function*(){var e;yield this._headersCapability.promise;let{value:t,done:r}=yield this._reader.read();return r?{value:t,done:r}:(this._loaded+=t.byteLength,null==(e=this.onProgress)||e.call(this,{loaded:this._loaded,total:this._contentLength}),{value:o(t),done:!1})}))}cancel(e){var t;null==(t=this._reader)||t.cancel(e),this._abortController.abort()}}class h{constructor(e,t,r){this._stream=e,this._reader=null,this._loaded=0;let o=e.source;this._withCredentials=o.withCredentials||!1,this._readCapability=new i.PromiseCapability,this._isStreamingSupported=!o.disableStream,this._abortController=new AbortController,this._headers=s(this._stream.httpHeaders),this._headers.append("Range",`bytes=${t}-${r-1}`);let l=o.url;fetch(l,a(this._headers,this._withCredentials,this._abortController)).then((e=>{if(!(0,n.validateResponseStatus)(e.status))throw(0,n.createResponseStatusError)(e.status,l);this._readCapability.resolve(),this._reader=e.body.getReader()})).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}read(){return bt(this,null,(function*(){var e;yield this._readCapability.promise;let{value:t,done:r}=yield this._reader.read();return r?{value:t,done:r}:(this._loaded+=t.byteLength,null==(e=this.onProgress)||e.call(this,{loaded:this._loaded}),{value:o(t),done:!1})}))}cancel(e){var t;null==(t=this._reader)||t.cancel(e),this._abortController.abort()}}},(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextLayerRenderTask=void 0,t.renderTextLayer=function(e){!e.textContentSource&&(e.textContent||e.textContentStream)&&((0,n.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),e.textContentSource=e.textContent||e.textContentStream);let{container:t,viewport:r}=e,i=getComputedStyle(t),a=i.getPropertyValue("visibility"),s=parseFloat(i.getPropertyValue("--scale-factor"));"visible"===a&&(!s||Math.abs(s-r.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");let o=new u(e);return o._render(),o},t.updateTextLayer=function({container:e,viewport:t,textDivs:r,textDivProperties:i,isOffscreenCanvasSupported:a,mustRotate:s=!0,mustRescale:o=!0}){if(s&&(0,n.setLayerDimensions)(e,{rotation:t.rotation}),o){let e=l(0,a),n={prevFontSize:null,prevFontFamily:null,div:null,scale:t.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:e};for(let e of r)n.properties=i.get(e),n.div=e,c(n)}};var i=r(1),n=r(6);let a=30,s=.8,o=new Map;function l(e,t){let r;if(t&&i.FeatureTest.isOffscreenCanvasSupported)r=new OffscreenCanvas(e,e).getContext("2d",{alpha:!1});else{let t=document.createElement("canvas");t.width=t.height=e,r=t.getContext("2d",{alpha:!1})}return r}function h(e,t,r){let n=document.createElement("span"),h={angle:0,canvasWidth:0,hasText:""!==t.str,hasEOL:t.hasEOL,fontSize:0};e._textDivs.push(n);let c=i.Util.transform(e._transform,t.transform),u=Math.atan2(c[1],c[0]),d=r[t.fontName];d.vertical&&(u+=Math.PI/2);let p,f,m=Math.hypot(c[2],c[3]),g=m*function(e,t){let r=o.get(e);if(r)return r;let i=l(a,t);i.font=`${a}px ${e}`;let n=i.measureText(""),h=n.fontBoundingBoxAscent,c=Math.abs(n.fontBoundingBoxDescent);if(h){let t=h/(h+c);return o.set(e,t),i.canvas.width=i.canvas.height=0,t}i.strokeStyle="red",i.clearRect(0,0,a,a),i.strokeText("g",0,0);let u=i.getImageData(0,0,a,a).data;c=0;for(let e=u.length-1-3;e>=0;e-=4)if(u[e]>0){c=Math.ceil(e/4/a);break}i.clearRect(0,0,a,a),i.strokeText("A",0,a),u=i.getImageData(0,0,a,a).data,h=0;for(let e=0,t=u.length;e<t;e+=4)if(u[e]>0){h=a-Math.floor(e/4/a);break}if(i.canvas.width=i.canvas.height=0,h){let t=h/(h+c);return o.set(e,t),t}return o.set(e,s),s}(d.fontFamily,e._isOffscreenCanvasSupported);0===u?(p=c[4],f=c[5]-g):(p=c[4]+g*Math.sin(u),f=c[5]-g*Math.cos(u));let v="calc(var(--scale-factor)*",y=n.style;e._container===e._rootContainer?(y.left=`${(100*p/e._pageWidth).toFixed(2)}%`,y.top=`${(100*f/e._pageHeight).toFixed(2)}%`):(y.left=`${v}${p.toFixed(2)}px)`,y.top=`${v}${f.toFixed(2)}px)`),y.fontSize=`${v}${m.toFixed(2)}px)`,y.fontFamily=d.fontFamily,h.fontSize=m,n.setAttribute("role","presentation"),n.textContent=t.str,n.dir=t.dir,e._fontInspectorEnabled&&(n.dataset.fontName=t.fontName),0!==u&&(h.angle=u*(180/Math.PI));let b=!1;if(t.str.length>1)b=!0;else if(" "!==t.str&&t.transform[0]!==t.transform[3]){let e=Math.abs(t.transform[0]),r=Math.abs(t.transform[3]);e!==r&&Math.max(e,r)/Math.min(e,r)>1.5&&(b=!0)}b&&(h.canvasWidth=d.vertical?t.height:t.width),e._textDivProperties.set(n,h),e._isReadableStream&&e._layoutText(n)}function c(e){let{div:t,scale:r,properties:i,ctx:n,prevFontSize:a,prevFontFamily:s}=e,{style:o}=t,l="";if(0!==i.canvasWidth&&i.hasText){let{fontFamily:h}=o,{canvasWidth:c,fontSize:u}=i;(a!==u||s!==h)&&(n.font=`${u*r}px ${h}`,e.prevFontSize=u,e.prevFontFamily=h);let{width:d}=n.measureText(t.textContent);d>0&&(l=`scaleX(${c*r/d})`)}0!==i.angle&&(l=`rotate(${i.angle}deg) ${l}`),l.length>0&&(o.transform=l)}class u{constructor({textContentSource:e,container:t,viewport:r,textDivs:a,textDivProperties:s,textContentItemsStr:o,isOffscreenCanvasSupported:h}){var c;this._textContentSource=e,this._isReadableStream=e instanceof ReadableStream,this._container=this._rootContainer=t,this._textDivs=a||[],this._textContentItemsStr=o||[],this._isOffscreenCanvasSupported=h,this._fontInspectorEnabled=!(null==(c=globalThis.FontInspector)||!c.enabled),this._reader=null,this._textDivProperties=s||new WeakMap,this._canceled=!1,this._capability=new i.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:r.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:l(0,h)};let{pageWidth:u,pageHeight:d,pageX:p,pageY:f}=r.rawDims;this._transform=[1,0,0,-1,-p,f+d],this._pageWidth=u,this._pageHeight=d,(0,n.setLayerDimensions)(t,r),this._capability.promise.finally((()=>{this._layoutTextParams=null})).catch((()=>{}))}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new i.AbortException("TextLayer task cancelled.")).catch((()=>{})),this._reader=null),this._capability.reject(new i.AbortException("TextLayer task cancelled."))}_processItems(e,t){for(let r of e)if(void 0!==r.str)this._textContentItemsStr.push(r.str),h(this,r,t);else if("beginMarkedContentProps"===r.type||"beginMarkedContent"===r.type){let e=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),null!==r.id&&this._container.setAttribute("id",`${r.id}`),e.append(this._container)}else"endMarkedContent"===r.type&&(this._container=this._container.parentNode)}_layoutText(e){let t=this._layoutTextParams.properties=this._textDivProperties.get(e);if(this._layoutTextParams.div=e,c(this._layoutTextParams),t.hasText&&this._container.append(e),t.hasEOL){let e=document.createElement("br");e.setAttribute("role","presentation"),this._container.append(e)}}_render(){let e=new i.PromiseCapability,t=Object.create(null);if(this._isReadableStream){let r=()=>{this._reader.read().then((({value:i,done:n})=>{n?e.resolve():(Object.assign(t,i.styles),this._processItems(i.items,t),r())}),e.reject)};this._reader=this._textContentSource.getReader(),r()}else{if(!this._textContentSource)throw new Error('No "textContentSource" parameter specified.');{let{items:t,styles:r}=this._textContentSource;this._processItems(t,r),e.resolve()}}e.promise.then((()=>{t=null,function(e){if(e._canceled)return;let t=e._textDivs,r=e._capability;if(t.length>1e5)r.resolve();else{if(!e._isReadableStream)for(let r of t)e._layoutText(r);r.resolve()}}(this)}),this._capability.reject)}}t.TextLayerRenderTask=u},(e,t,r)=>{var i,n,a,s,o,l,h,c,u,d,p,f,m,g,v,y,b,x;Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationEditorLayer=void 0;var _=r(1),w=r(4),S=r(5),T=r(28),M=r(33),E=r(6);let A=class{constructor(e){at(this,p),at(this,m),at(this,v),at(this,b),at(this,i,void 0),at(this,n,!1),at(this,a,null),at(this,s,this.pointerup.bind(this)),at(this,o,this.pointerdown.bind(this)),at(this,l,new Map),at(this,h,!1),at(this,c,!1),at(this,u,!1),at(this,d,void 0),A._initialized||(A._initialized=!0,T.FreeTextEditor.initialize(e.l10n),M.InkEditor.initialize(e.l10n)),e.uiManager.registerEditorTypes([T.FreeTextEditor,M.InkEditor]),Bt(this,d,e.uiManager),this.pageIndex=e.pageIndex,this.div=e.div,Bt(this,i,e.accessibilityManager),Bt(this,a,e.annotationLayer),this.viewport=e.viewport,ce(this,d).addLayer(this)}get isEmpty(){return 0===ce(this,l).size}updateToolbar(e){ce(this,d).updateToolbar(e)}updateMode(e=ce(this,d).getMode()){Et(this,b,x).call(this),e===_.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),ce(this,d).unselectAll(),e!==_.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",e===_.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",e===_.AnnotationEditorType.INK),this.div.hidden=!1)}addInkEditorIfNeeded(e){if(e||ce(this,d).getMode()===_.AnnotationEditorType.INK){if(!e)for(let e of ce(this,l).values())if(e.isEmpty())return void e.setInBackground();Et(this,v,y).call(this,{offsetX:0,offsetY:0}).setInBackground()}}setEditingState(e){ce(this,d).setEditingState(e)}addCommands(e){ce(this,d).addCommands(e)}enable(){this.div.style.pointerEvents="auto";let e=new Set;for(let t of ce(this,l).values())t.enableEditing(),t.annotationElementId&&e.add(t.annotationElementId);if(!ce(this,a))return;let t=ce(this,a).getEditableAnnotations();for(let r of t){if(r.hide(),ce(this,d).isDeletedAnnotationElement(r.data.id)||e.has(r.data.id))continue;let t=this.deserialize(r);t&&(this.addOrRebuild(t),t.enableEditing())}}disable(){var e;Bt(this,u,!0),this.div.style.pointerEvents="none";let t=new Set;for(let r of ce(this,l).values())r.disableEditing(),r.annotationElementId&&null===r.serialize()?(null==(e=this.getEditableAnnotation(r.annotationElementId))||e.show(),r.remove()):t.add(r.annotationElementId);if(ce(this,a)){let e=ce(this,a).getEditableAnnotations();for(let r of e){let{id:e}=r.data;t.has(e)||ce(this,d).isDeletedAnnotationElement(e)||r.show()}}Et(this,b,x).call(this),this.isEmpty&&(this.div.hidden=!0),Bt(this,u,!1)}getEditableAnnotation(e){var t;return(null==(t=ce(this,a))?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){ce(this,d).getActive()!==e&&ce(this,d).setActiveEditor(e)}enableClick(){this.div.addEventListener("pointerdown",ce(this,o)),this.div.addEventListener("pointerup",ce(this,s))}disableClick(){this.div.removeEventListener("pointerdown",ce(this,o)),this.div.removeEventListener("pointerup",ce(this,s))}attach(e){ce(this,l).set(e.id,e);let{annotationElementId:t}=e;t&&ce(this,d).isDeletedAnnotationElement(t)&&ce(this,d).removeDeletedAnnotationElement(e)}detach(e){var t;ce(this,l).delete(e.id),null==(t=ce(this,i))||t.removePointerInTextLayer(e.contentDiv),!ce(this,u)&&e.annotationElementId&&ce(this,d).addDeletedAnnotationElement(e)}remove(e){this.detach(e),ce(this,d).removeEditor(e),e.div.style.display="none",setTimeout((()=>{e.div.style.display="",e.div.remove(),e.isAttachedToDOM=!1,document.activeElement===document.body&&ce(this,d).focusMainContainer()}),0),ce(this,c)||this.addInkEditorIfNeeded(!1)}add(e){if(Et(this,p,f).call(this,e),ce(this,d).addEditor(e),this.attach(e),!e.isAttachedToDOM){let t=e.render();this.div.append(t),e.isAttachedToDOM=!0}this.moveEditorInDOM(e),e.onceAdded(),ce(this,d).addToAnnotationStorage(e)}moveEditorInDOM(e){var t;null==(t=ce(this,i))||t.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?e.rebuild():this.add(e)}getNextId(){return ce(this,d).getId()}deserialize(e){var t;switch(null!=(t=e.annotationType)?t:e.annotationEditorType){case _.AnnotationEditorType.FREETEXT:return T.FreeTextEditor.deserialize(e,this,ce(this,d));case _.AnnotationEditorType.INK:return M.InkEditor.deserialize(e,this,ce(this,d))}return null}setSelected(e){ce(this,d).setSelected(e)}toggleSelected(e){ce(this,d).toggleSelected(e)}isSelected(e){return ce(this,d).isSelected(e)}unselect(e){ce(this,d).unselect(e)}pointerup(e){let{isMac:t}=_.FeatureTest.platform;if(!(0!==e.button||e.ctrlKey&&t)&&e.target===this.div&&ce(this,h)){if(Bt(this,h,!1),!ce(this,n))return void Bt(this,n,!0);Et(this,v,y).call(this,e)}}pointerdown(e){let{isMac:t}=_.FeatureTest.platform;if(0!==e.button||e.ctrlKey&&t||e.target!==this.div)return;Bt(this,h,!0);let r=ce(this,d).getActive();Bt(this,n,!r||r.isEmpty())}drop(e){let t=e.dataTransfer.getData("text/plain"),r=ce(this,d).getEditor(t);if(!r)return;e.preventDefault(),e.dataTransfer.dropEffect="move",Et(this,p,f).call(this,r);let i=this.div.getBoundingClientRect(),n=e.clientX-i.x,a=e.clientY-i.y;r.translate(n-r.startX,a-r.startY),this.moveEditorInDOM(r),r.div.focus()}dragover(e){e.preventDefault()}destroy(){var e,t;(null==(e=ce(this,d).getActive())?void 0:e.parent)===this&&ce(this,d).setActiveEditor(null);for(let e of ce(this,l).values())null==(t=ce(this,i))||t.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,ce(this,l).clear(),ce(this,d).removeLayer(this)}render({viewport:e}){this.viewport=e,(0,E.setLayerDimensions)(this.div,e),(0,S.bindEvents)(this,this.div,["dragover","drop"]);for(let e of ce(this,d).getEditors(this.pageIndex))this.add(e);this.updateMode()}update({viewport:e}){ce(this,d).commitOrRemove(),this.viewport=e,(0,E.setLayerDimensions)(this.div,{rotation:e.rotation}),this.updateMode()}get pageDimensions(){let{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}},C=A;i=new WeakMap,n=new WeakMap,a=new WeakMap,s=new WeakMap,o=new WeakMap,l=new WeakMap,h=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakMap,p=new WeakSet,f=function(e){var t;e.parent!==this&&(e.annotationElementId&&(ce(this,d).addDeletedAnnotationElement(e.annotationElementId),w.AnnotationEditor.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),null==(t=e.parent)||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))},m=new WeakSet,g=function(e){switch(ce(this,d).getMode()){case _.AnnotationEditorType.FREETEXT:return new T.FreeTextEditor(e);case _.AnnotationEditorType.INK:return new M.InkEditor(e)}return null},v=new WeakSet,y=function(e){let t=this.getNextId(),r=Et(this,m,g).call(this,{parent:this,id:t,x:e.offsetX,y:e.offsetY,uiManager:ce(this,d)});return r&&this.add(r),r},b=new WeakSet,x=function(){Bt(this,c,!0);for(let e of ce(this,l).values())e.isEmpty()&&e.remove();Bt(this,c,!1)},Es(C,"_initialized",!1),t.AnnotationEditorLayer=C},(e,t,r)=>{var i,n,a,s,o,l,h,c,u,d,p,f,m,g,v,y,b,x,_,w,S,T,M;Object.defineProperty(t,"__esModule",{value:!0}),t.FreeTextEditor=void 0;var E=r(1),A=r(5),C=r(4),P=r(29);let R=class extends C.AnnotationEditor{constructor(e){super(Ii(on({},e),{name:"freeTextEditor"})),at(this,d),at(this,f),at(this,g),at(this,y),at(this,x),at(this,w),at(this,T),at(this,i,this.editorDivBlur.bind(this)),at(this,n,this.editorDivFocus.bind(this)),at(this,a,this.editorDivInput.bind(this)),at(this,s,this.editorDivKeydown.bind(this)),at(this,o,void 0),at(this,l,""),at(this,h,`${this.id}-editor`),at(this,c,void 0),at(this,u,null),Bt(this,o,e.color||R._defaultColor||C.AnnotationEditor._defaultLineColor),Bt(this,c,e.fontSize||R._defaultFontSize)}static get _keyboardManager(){return(0,E.shadow)(this,"_keyboardManager",new A.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],R.prototype.commitOrRemove,!0],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],R.prototype.commitOrRemove]]))}static initialize(e){this._l10nPromise=new Map(["free_text2_default_content","editor_free_text2_aria_label"].map((t=>[t,e.get(t)])));let t=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(t.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case E.AnnotationEditorParamsType.FREETEXT_SIZE:R._defaultFontSize=t;break;case E.AnnotationEditorParamsType.FREETEXT_COLOR:R._defaultColor=t}}updateParams(e,t){switch(e){case E.AnnotationEditorParamsType.FREETEXT_SIZE:Et(this,d,p).call(this,t);break;case E.AnnotationEditorParamsType.FREETEXT_COLOR:Et(this,f,m).call(this,t)}}static get defaultPropertiesToUpdate(){return[[E.AnnotationEditorParamsType.FREETEXT_SIZE,R._defaultFontSize],[E.AnnotationEditorParamsType.FREETEXT_COLOR,R._defaultColor||C.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[E.AnnotationEditorParamsType.FREETEXT_SIZE,ce(this,c)],[E.AnnotationEditorParamsType.FREETEXT_COLOR,ce(this,o)]]}getInitialTranslation(){let e=this.parentScale;return[-R._internalPadding*e,-(R._internalPadding+ce(this,c))*e]}rebuild(){super.rebuild(),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(E.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",ce(this,s)),this.editorDiv.addEventListener("focus",ce(this,n)),this.editorDiv.addEventListener("blur",ce(this,i)),this.editorDiv.addEventListener("input",ce(this,a)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",ce(this,h)),this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",ce(this,s)),this.editorDiv.removeEventListener("focus",ce(this,n)),this.editorDiv.removeEventListener("blur",ce(this,i)),this.editorDiv.removeEventListener("input",ce(this,a)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(e){super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){this.width?Et(this,T,M).call(this):(this.enableEditMode(),this.editorDiv.focus())}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing"),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let e=ce(this,l),t=Bt(this,l,Et(this,g,v).call(this).trimEnd());if(e===t)return;let r=e=>{Bt(this,l,e),e?(Et(this,x,_).call(this),this.rebuild(),Et(this,y,b).call(this)):this.remove()};this.addCommands({cmd:()=>{r(t)},undo:()=>{r(e)},mustExec:!1}),Et(this,y,b).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}dblclick(e){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&"Enter"===e.key&&(this.enableEditMode(),this.editorDiv.focus())}editorDivKeydown(e){R._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",ce(this,h)),this.enableEditing(),R._l10nPromise.get("editor_free_text2_aria_label").then((e=>{var t;return null==(t=this.editorDiv)?void 0:t.setAttribute("aria-label",e)})),R._l10nPromise.get("free_text2_default_content").then((e=>{var t;return null==(t=this.editorDiv)?void 0:t.setAttribute("default-content",e)})),this.editorDiv.contentEditable=!0;let{style:r}=this.editorDiv;if(r.fontSize=`calc(${ce(this,c)}px * var(--scale-factor))`,r.color=ce(this,o),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,A.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){let[r,i]=this.parentDimensions;if(this.annotationElementId){let[n]=this.getInitialTranslation();this.setAt(e*r,t*i,n,n)}else this.setAt(e*r,t*i,this.width*r,this.height*i);Et(this,x,_).call(this),this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(e,t,r){let i=null;if(e instanceof P.FreeTextAnnotationElement){let{data:{defaultAppearanceData:{fontSize:t,fontColor:r},rect:n,rotation:a,id:s},textContent:o,parent:{page:{pageNumber:l}}}=e;if(!o||0===o.length)return null;i=e={annotationType:E.AnnotationEditorType.FREETEXT,color:Array.from(r),fontSize:t,value:o.join("\n"),pageIndex:l-1,rect:n,rotation:a,id:s,deleted:!1}}let n=super.deserialize(e,t,r);return Bt(n,c,e.fontSize),Bt(n,o,E.Util.makeHexColor(...e.color)),Bt(n,l,e.value),n.annotationElementId=e.id||null,Bt(n,u,i),n}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};let t=R._internalPadding*this.parentScale,r=this.getRect(t,t),i=C.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:ce(this,o)),n={annotationType:E.AnnotationEditorType.FREETEXT,color:i,fontSize:ce(this,c),value:ce(this,l),pageIndex:this.pageIndex,rect:r,rotation:this.rotation};return e?n:this.annotationElementId&&!Et(this,w,S).call(this,n)?null:(n.id=this.annotationElementId,n)}},I=R;i=new WeakMap,n=new WeakMap,a=new WeakMap,s=new WeakMap,o=new WeakMap,l=new WeakMap,h=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakSet,p=function(e){let t=e=>{this.editorDiv.style.fontSize=`calc(${e}px * var(--scale-factor))`,this.translate(0,-(e-ce(this,c))*this.parentScale),Bt(this,c,e),Et(this,y,b).call(this)},r=ce(this,c);this.addCommands({cmd:()=>{t(e)},undo:()=>{t(r)},mustExec:!0,type:E.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},f=new WeakSet,m=function(e){let t=ce(this,o);this.addCommands({cmd:()=>{Bt(this,o,this.editorDiv.style.color=e)},undo:()=>{Bt(this,o,this.editorDiv.style.color=t)},mustExec:!0,type:E.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},g=new WeakSet,v=function(){let e=this.editorDiv.getElementsByTagName("div");if(0===e.length)return this.editorDiv.innerText;let t=[];for(let r of e)t.push(r.innerText.replace(/\r\n?|\n/,""));return t.join("\n")},y=new WeakSet,b=function(){let e,[t,r]=this.parentDimensions;if(this.isAttachedToDOM)e=this.div.getBoundingClientRect();else{let{currentLayer:t,div:r}=this,i=r.style.display;r.style.display="hidden",t.div.append(this.div),e=r.getBoundingClientRect(),r.remove(),r.style.display=i}this.width=e.width/t,this.height=e.height/r},x=new WeakSet,_=function(){if(this.editorDiv.replaceChildren(),ce(this,l))for(let e of ce(this,l).split("\n")){let t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}},w=new WeakSet,S=function(e){let{value:t,fontSize:r,color:i,rect:n,pageIndex:a}=ce(this,u);return e.value!==t||e.fontSize!==r||e.rect.some(((e,t)=>Math.abs(e-n[t])>=1))||e.color.some(((e,t)=>e!==i[t]))||e.pageIndex!==a},T=new WeakSet,M=function(e=!1){if(!this.annotationElementId)return;if(Et(this,y,b).call(this),!e&&(0===this.width||0===this.height))return void setTimeout((()=>Et(this,T,M).call(this,!0)),0);let t=R._internalPadding*this.parentScale;ce(this,u).rect=this.getRect(t,t)},Es(I,"_freeTextDefaultContent",""),Es(I,"_l10nPromise"),Es(I,"_internalPadding",0),Es(I,"_defaultColor",null),Es(I,"_defaultFontSize",10),Es(I,"_type","freetext"),t.FreeTextEditor=I},(e,t,r)=>{var i,n,a,s,o,l,h,c,u,d,p,f,m,g,v,y,b,x,_,w,S,T,M,E,A,C,P,R,I,O,L,D,k,F,N,U,B,z,H;Object.defineProperty(t,"__esModule",{value:!0}),t.InkAnnotationElement=t.FreeTextAnnotationElement=t.AnnotationLayer=void 0;var V=r(1),j=r(6),G=r(3),W=r(30),X=r(31);let q=1e3,Y=new WeakSet;function $(e){return{width:e[2]-e[0],height:e[3]-e[1]}}class Z{static create(e){switch(e.data.annotationType){case V.AnnotationType.LINK:return new J(e);case V.AnnotationType.TEXT:return new Q(e);case V.AnnotationType.WIDGET:switch(e.data.fieldType){case"Tx":return new te(e);case"Btn":return e.data.radioButton?new ne(e):e.data.checkBox?new ie(e):new ae(e);case"Ch":return new se(e);case"Sig":return new re(e)}return new ee(e);case V.AnnotationType.POPUP:return new oe(e);case V.AnnotationType.FREETEXT:return new he(e);case V.AnnotationType.LINE:return new ue(e);case V.AnnotationType.SQUARE:return new de(e);case V.AnnotationType.CIRCLE:return new pe(e);case V.AnnotationType.POLYLINE:return new fe(e);case V.AnnotationType.CARET:return new ge(e);case V.AnnotationType.INK:return new ve(e);case V.AnnotationType.POLYGON:return new me(e);case V.AnnotationType.HIGHLIGHT:return new ye(e);case V.AnnotationType.UNDERLINE:return new be(e);case V.AnnotationType.SQUIGGLY:return new xe(e);case V.AnnotationType.STRIKEOUT:return new _e(e);case V.AnnotationType.STAMP:return new we(e);case V.AnnotationType.FILEATTACHMENT:return new Se(e);default:return new K(e)}}}class K{constructor(e,{isRenderable:t=!1,ignoreBorder:r=!1,createQuadrilaterals:i=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(r)),i&&(this.quadrilaterals=this._createQuadrilaterals(r))}_createContainer(e){let{data:t,parent:{page:r,viewport:i}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",t.id),n.style.zIndex=this.parent.zIndex++,this.data.popupRef&&n.setAttribute("aria-haspopup","dialog"),t.noRotate&&n.classList.add("norotate");let{pageWidth:a,pageHeight:s,pageX:o,pageY:l}=i.rawDims;if(!t.rect||this instanceof oe){let{rotation:e}=t;return!t.hasOwnCanvas&&0!==e&&this.setRotation(e,n),n}let{width:h,height:c}=$(t.rect),u=V.Util.normalizeRect([t.rect[0],r.view[3]-t.rect[1]+r.view[1],t.rect[2],r.view[3]-t.rect[3]+r.view[1]]);if(!e&&t.borderStyle.width>0){n.style.borderWidth=`${t.borderStyle.width}px`;let e=t.borderStyle.horizontalCornerRadius,r=t.borderStyle.verticalCornerRadius;if(e>0||r>0){let t=`calc(${e}px * var(--scale-factor)) / calc(${r}px * var(--scale-factor))`;n.style.borderRadius=t}else if(this instanceof ne){let e=`calc(${h}px * var(--scale-factor)) / calc(${c}px * var(--scale-factor))`;n.style.borderRadius=e}switch(t.borderStyle.style){case V.AnnotationBorderStyleType.SOLID:n.style.borderStyle="solid";break;case V.AnnotationBorderStyleType.DASHED:n.style.borderStyle="dashed";break;case V.AnnotationBorderStyleType.BEVELED:(0,V.warn)("Unimplemented border style: beveled");break;case V.AnnotationBorderStyleType.INSET:(0,V.warn)("Unimplemented border style: inset");break;case V.AnnotationBorderStyleType.UNDERLINE:n.style.borderBottomStyle="solid"}let i=t.borderColor||null;i?n.style.borderColor=V.Util.makeHexColor(0|i[0],0|i[1],0|i[2]):n.style.borderWidth=0}n.style.left=100*(u[0]-o)/a+"%",n.style.top=100*(u[1]-l)/s+"%";let{rotation:d}=t;return t.hasOwnCanvas||0===d?(n.style.width=100*h/a+"%",n.style.height=100*c/s+"%"):this.setRotation(d,n),n}setRotation(e,t=this.container){let r,i,{pageWidth:n,pageHeight:a}=this.parent.viewport.rawDims,{width:s,height:o}=$(this.data.rect);e%180==0?(r=100*s/n,i=100*o/a):(r=100*o/n,i=100*s/a),t.style.width=`${r}%`,t.style.height=`${i}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){let e=(e,t,r)=>{let i=r.detail[e];r.target.style[t]=W.ColorConverters[`${i[0]}_HTML`](i.slice(1))};return(0,V.shadow)(this,"_commonActions",{display:e=>{let t=e.detail.display%2==1;this.container.style.visibility=t?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:t,print:0===e.detail.display||3===e.detail.display})},print:e=>{this.annotationStorage.setValue(this.data.id,{print:e.detail.print})},hidden:e=>{this.container.style.visibility=e.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:e.detail.hidden})},focus:e=>{setTimeout((()=>e.target.focus({preventScroll:!1})),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.detail.readonly?e.target.setAttribute("readonly",""):e.target.removeAttribute("readonly")},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:e=>{let t=e.detail.rotation;this.setRotation(t),this.annotationStorage.setValue(this.data.id,{rotation:t})}})}_dispatchEventFromSandbox(e,t){let r=this._commonActions;for(let i of Object.keys(t.detail)){let n=e[i]||r[i];null==n||n(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;let t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;let r=this._commonActions;for(let[i,n]of Object.entries(t)){let a=r[i];a&&(a({detail:{[i]:n},target:e}),delete t[i])}}_createQuadrilaterals(e=!1){if(!this.data.quadPoints)return null;let t=[],r=this.data.rect,i=null;for(let r of this.data.quadPoints)this.data.rect=[r[2].x,r[2].y,r[1].x,r[1].y],t.push(this._createContainer(e)),i||(i=this.data.rect);return this.data.rect=r,this.firstQuadRect=i,t}_createPopup(){let{container:e,data:t}=this;e.setAttribute("aria-haspopup","dialog");let r=new oe({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:this.firstQuadRect||t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation},parent:this.parent,elements:[this]});this.parent.div.append(r.render())}_renderQuadrilaterals(e){for(let t of this.quadrilaterals)t.classList.add(e);return this.quadrilaterals}render(){(0,V.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){let r=[];if(this._fieldObjects){let i=this._fieldObjects[e];if(i)for(let{page:e,id:n,exportValues:a}of i){if(-1===e||n===t)continue;let i="string"==typeof a?a:null,s=document.querySelector(`[data-element-id="${n}"]`);!s||Y.has(s)?r.push({id:n,exportValue:i,domElement:s}):(0,V.warn)(`_getElementsByName - element not allowed: ${n}`)}return r}for(let i of document.getElementsByName(e)){let{exportValue:e}=i,n=i.getAttribute("data-element-id");n!==t&&Y.has(i)&&r.push({id:n,exportValue:e,domElement:i})}return r}show(){var e;this.container&&(this.container.hidden=!1),null==(e=this.popup)||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),null==(e=this.popup)||e.forceHide()}getElementsToTriggerPopup(){return this.quadrilaterals||this.container}addHighlightArea(){let e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(let t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}}class J extends K{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!(null==t||!t.ignoreBorder),createQuadrilaterals:!0}),at(this,i),at(this,a),this.isTooltipOnly=e.data.isTooltipOnly}render(){let{data:e,linkService:t}=this,r=document.createElement("a");r.setAttribute("data-element-id",e.id);let i=!1;return e.url?(t.addLinkAttributes(r,e.url,e.newWindow),i=!0):e.action?(this._bindNamedAction(r,e.action),i=!0):e.attachment?(this._bindAttachment(r,e.attachment),i=!0):e.setOCGState?(Et(this,a,s).call(this,r,e.setOCGState),i=!0):e.dest?(this._bindLink(r,e.dest),i=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(r,e),i=!0),e.resetForm?(this._bindResetFormAction(r,e.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(r,""),i=!0)),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map(((e,t)=>{let i=0===t?r:r.cloneNode();return e.append(i),e})):(this.container.classList.add("linkAnnotation"),i&&this.container.append(r),this.container)}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||""===t)&&Et(this,i,n).call(this)}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),Et(this,i,n).call(this)}_bindAttachment(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>{var e;return null==(e=this.downloadManager)||e.openOrDownloadData(this.container,t.content,t.filename),!1},Et(this,i,n).call(this)}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");let r=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let i of Object.keys(t.actions)){let n=r.get(i);n&&(e[n]=()=>{var e;return null==(e=this.linkService.eventBus)||e.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:i}}),!1})}e.onclick||(e.onclick=()=>!1),Et(this,i,n).call(this)}_bindResetFormAction(e,t){let r=e.onclick;if(r||(e.href=this.linkService.getAnchorUrl("")),Et(this,i,n).call(this),!this._fieldObjects)return(0,V.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(r||(e.onclick=()=>!1));e.onclick=()=>{var e;null==r||r();let{fields:i,refs:n,include:a}=t,s=[];if(0!==i.length||0!==n.length){let e=new Set(n);for(let t of i){let r=this._fieldObjects[t]||[];for(let{id:t}of r)e.add(t)}for(let t of Object.values(this._fieldObjects))for(let r of t)e.has(r.id)===a&&s.push(r)}else for(let e of Object.values(this._fieldObjects))s.push(...e);let o=this.annotationStorage,l=[];for(let e of s){let{id:t}=e;switch(l.push(t),e.type){case"text":{let r=e.defaultValue||"";o.setValue(t,{value:r});break}case"checkbox":case"radiobutton":{let r=e.defaultValue===e.exportValues;o.setValue(t,{value:r});break}case"combobox":case"listbox":{let r=e.defaultValue||"";o.setValue(t,{value:r});break}default:continue}let r=document.querySelector(`[data-element-id="${t}"]`);r&&(Y.has(r)?r.dispatchEvent(new Event("resetform")):(0,V.warn)(`_bindResetFormAction - element not allowed: ${t}`))}return this.enableScripting&&(null==(e=this.linkService.eventBus)||e.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:l,name:"ResetForm"}})),!1}}}i=new WeakSet,n=function(){this.container.setAttribute("data-internal-link","")},a=new WeakSet,s=function(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),Et(this,i,n).call(this)};class Q extends K{constructor(e){var t,r,i;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(r=e.data.contentsObj)&&r.str||null!=(i=e.data.richText)&&i.str)})}render(){this.container.classList.add("textAnnotation");let e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.alt="[{{type}} Annotation]",e.dataset.l10nId="text_annotation_type",e.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.popupRef||this._createPopup(),this.container.append(e),this.container}}class ee extends K{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&("CANVAS"===(null==(t=e.previousSibling)?void 0:t.nodeName)&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){let{isWin:t,isMac:r}=V.FeatureTest.platform;return t&&e.ctrlKey||r&&e.metaKey}_setEventListener(e,t,r,i){t.includes("mouse")?e.addEventListener(t,(e=>{var t;null==(t=this.linkService.eventBus)||t.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:i(e),shift:e.shiftKey,modifier:this._getKeyModifier(e)}})})):e.addEventListener(t,(e=>{var t;null==(t=this.linkService.eventBus)||t.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:i(e)}})}))}_setEventListeners(e,t,r){var i;for(let[n,a]of t)("Action"===a||null!=(i=this.data.actions)&&i[a])&&this._setEventListener(e,n,a,r)}_setBackgroundColor(e){let t=this.data.backgroundColor||null;e.style.backgroundColor=null===t?"transparent":V.Util.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){let t,{fontColor:r}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||9,n=e.style,a=e=>Math.round(10*e)/10;if(this.data.multiLine){let e=Math.abs(this.data.rect[3]-this.data.rect[1]-2),r=e/(Math.round(e/(V.LINE_FACTOR*i))||1);t=Math.min(i,a(r/V.LINE_FACTOR))}else{let e=Math.abs(this.data.rect[3]-this.data.rect[1]-2);t=Math.min(i,a(e/V.LINE_FACTOR))}n.fontSize=`calc(${t}px * var(--scale-factor))`,n.color=V.Util.makeHexColor(r[0],r[1],r[2]),null!==this.data.textAlignment&&(n.textAlign=["left","center","right"][this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class te extends ee{constructor(e){super(e,{isRenderable:e.renderForms||!e.data.hasAppearance&&!!e.data.fieldValue})}setPropertyOnSiblings(e,t,r,i){let n=this.annotationStorage;for(let a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=r),n.setValue(a.id,{[i]:r})}render(){var e,t;let r=this.annotationStorage,i=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){let a=r.getValue(i,{value:this.data.fieldValue}),s=a.value||"",o=r.getValue(i,{charLimit:this.data.maxLen}).charLimit;o&&s.length>o&&(s=s.slice(0,o));let l=a.formattedValue||(null==(e=this.data.textContent)?void 0:e.join("\n"))||null;l&&this.data.comb&&(l=l.replaceAll(/\s+/g,""));let h={userValue:s,formattedValue:l,lastCommittedValue:null,commitKey:1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=null!=l?l:s,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type="text",n.setAttribute("value",null!=l?l:s),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Y.add(n),n.setAttribute("data-element-id",i),n.disabled=this.data.readOnly,n.name=this.data.baseFieldName||this.data.fieldName,n.tabIndex=q,this._setRequired(n,this.data.required),o&&(n.maxLength=o),n.addEventListener("input",(e=>{r.setValue(i,{value:e.target.value}),this.setPropertyOnSiblings(n,"value",e.target.value,"value"),h.formattedValue=null})),n.addEventListener("resetform",(e=>{var t;let r=null!=(t=this.data.defaultFieldValue)?t:"";n.value=h.userValue=r,h.formattedValue=null}));let c=e=>{let{formattedValue:t}=h;null!=t&&(e.target.value=t),e.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",(e=>{let{target:t}=e;h.userValue&&(t.value=h.userValue),h.lastCommittedValue=t.value,h.commitKey=1})),n.addEventListener("updatefromsandbox",(e=>{this.showElementAndHideCanvas(e.target);let t={value(e){var t;h.userValue=null!=(t=e.detail.value)?t:"",r.setValue(i,{value:h.userValue.toString()}),e.target.value=h.userValue},formattedValue(e){let{formattedValue:t}=e.detail;h.formattedValue=t,null!=t&&e.target!==document.activeElement&&(e.target.value=t),r.setValue(i,{formattedValue:t})},selRange(e){e.target.setSelectionRange(...e.detail.selRange)},charLimit:e=>{var t;let{charLimit:n}=e.detail,{target:a}=e;if(0===n)return void a.removeAttribute("maxLength");a.setAttribute("maxLength",n);let s=h.userValue;!s||s.length<=n||(s=s.slice(0,n),a.value=h.userValue=s,r.setValue(i,{value:s}),null==(t=this.linkService.eventBus)||t.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i,name:"Keystroke",value:s,willCommit:!0,commitKey:1,selStart:a.selectionStart,selEnd:a.selectionEnd}}))}};this._dispatchEventFromSandbox(t,e)})),n.addEventListener("keydown",(e=>{var t;h.commitKey=1;let r=-1;if("Escape"===e.key?r=0:"Enter"!==e.key||this.data.multiLine?"Tab"===e.key&&(h.commitKey=3):r=2,-1===r)return;let{value:n}=e.target;h.lastCommittedValue!==n&&(h.lastCommittedValue=n,h.userValue=n,null==(t=this.linkService.eventBus)||t.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i,name:"Keystroke",value:n,willCommit:!0,commitKey:r,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}))}));let e=c;c=null,n.addEventListener("blur",(t=>{var r;if(!t.relatedTarget)return;let{value:n}=t.target;h.userValue=n,h.lastCommittedValue!==n&&(null==(r=this.linkService.eventBus)||r.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i,name:"Keystroke",value:n,willCommit:!0,commitKey:h.commitKey,selStart:t.target.selectionStart,selEnd:t.target.selectionEnd}})),e(t)})),null!=(t=this.data.actions)&&t.Keystroke&&n.addEventListener("beforeinput",(e=>{var t;h.lastCommittedValue=null;let{data:r,target:n}=e,{value:a,selectionStart:s,selectionEnd:o}=n,l=s,c=o;switch(e.inputType){case"deleteWordBackward":{let e=a.substring(0,s).match(/\w*[^\w]*$/);e&&(l-=e[0].length);break}case"deleteWordForward":{let e=a.substring(s).match(/^[^\w]*\w*/);e&&(c+=e[0].length);break}case"deleteContentBackward":s===o&&(l-=1);break;case"deleteContentForward":s===o&&(c+=1)}e.preventDefault(),null==(t=this.linkService.eventBus)||t.dispatch("dispatcheventinsandbox",{source:this,detail:{id:i,name:"Keystroke",value:a,change:r||"",willCommit:!1,selStart:l,selEnd:c}})})),this._setEventListeners(n,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.value))}if(c&&n.addEventListener("blur",c),this.data.comb){let e=(this.data.rect[2]-this.data.rect[0])/o;n.classList.add("comb"),n.style.letterSpacing=`calc(${e}px * var(--scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell";return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class re extends ee{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class ie extends ee{constructor(e){super(e,{isRenderable:e.renderForms})}render(){let e=this.annotationStorage,t=this.data,r=t.id,i=e.getValue(r,{value:t.exportValue===t.fieldValue}).value;"string"==typeof i&&(i="Off"!==i,e.setValue(r,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let n=document.createElement("input");return Y.add(n),n.setAttribute("data-element-id",r),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=t.baseFieldName||t.fieldName,i&&n.setAttribute("checked",!0),n.setAttribute("exportValue",t.exportValue),n.tabIndex=q,n.addEventListener("change",(i=>{let{name:n,checked:a}=i.target;for(let i of this._getElementsByName(n,r)){let r=a&&i.exportValue===t.exportValue;i.domElement&&(i.domElement.checked=r),e.setValue(i.id,{value:r})}e.setValue(r,{value:a})})),n.addEventListener("resetform",(e=>{let r=t.defaultFieldValue||"Off";e.target.checked=r===t.exportValue})),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",(t=>{let i={value(t){t.target.checked="Off"!==t.detail.value,e.setValue(r,{value:t.target.checked})}};this._dispatchEventFromSandbox(i,t)})),this._setEventListeners(n,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.checked))),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class ne extends ee{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let e=this.annotationStorage,t=this.data,r=t.id,i=e.getValue(r,{value:t.fieldValue===t.buttonValue}).value;"string"==typeof i&&(i=i!==t.buttonValue,e.setValue(r,{value:i}));let n=document.createElement("input");if(Y.add(n),n.setAttribute("data-element-id",r),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=t.baseFieldName||t.fieldName,i&&n.setAttribute("checked",!0),n.tabIndex=q,n.addEventListener("change",(t=>{let{name:i,checked:n}=t.target;for(let t of this._getElementsByName(i,r))e.setValue(t.id,{value:!1});e.setValue(r,{value:n})})),n.addEventListener("resetform",(e=>{let r=t.defaultFieldValue;e.target.checked=null!=r&&r===t.buttonValue})),this.enableScripting&&this.hasJSActions){let i=t.buttonValue;n.addEventListener("updatefromsandbox",(t=>{let n={value:t=>{let n=i===t.detail.value;for(let i of this._getElementsByName(t.target.name)){let t=n&&i.id===r;i.domElement&&(i.domElement.checked=t),e.setValue(i.id,{value:t})}}};this._dispatchEventFromSandbox(n,t)})),this._setEventListeners(n,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.checked))}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class ae extends J{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){let e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(e.title=this.data.alternativeText);let t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",(e=>{this._dispatchEventFromSandbox({},e)}))),e}}class se extends ee{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let e=this.annotationStorage,t=this.data.id,r=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");Y.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.baseFieldName||this.data.fieldName,i.tabIndex=q;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",(e=>{let t=this.data.defaultFieldValue;for(let e of i.options)e.selected=e.value===t}));for(let e of this.data.options){let t=document.createElement("option");t.textContent=e.displayValue,t.value=e.exportValue,r.value.includes(e.exportValue)&&(t.setAttribute("selected",!0),n=!1),i.append(t)}let a=null;if(n){let e=document.createElement("option");e.value=" ",e.setAttribute("hidden",!0),e.setAttribute("selected",!0),i.prepend(e),a=()=>{e.remove(),i.removeEventListener("input",a),a=null},i.addEventListener("input",a)}let s=e=>{let t=e?"value":"textContent",{options:r,multiple:n}=i;return n?Array.prototype.filter.call(r,(e=>e.selected)).map((e=>e[t])):-1===r.selectedIndex?null:r[r.selectedIndex][t]},o=s(!1),l=e=>{let t=e.target.options;return Array.prototype.map.call(t,(e=>({displayValue:e.textContent,exportValue:e.value})))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",(r=>{let n={value(r){null==a||a();let n=r.detail.value,l=new Set(Array.isArray(n)?n:[n]);for(let e of i.options)e.selected=l.has(e.value);e.setValue(t,{value:s(!0)}),o=s(!1)},multipleSelection(e){i.multiple=!0},remove(r){let n=i.options,a=r.detail.remove;n[a].selected=!1,i.remove(a),n.length>0&&-1===Array.prototype.findIndex.call(n,(e=>e.selected))&&(n[0].selected=!0),e.setValue(t,{value:s(!0),items:l(r)}),o=s(!1)},clear(r){for(;0!==i.length;)i.remove(0);e.setValue(t,{value:null,items:[]}),o=s(!1)},insert(r){let{index:n,displayValue:a,exportValue:h}=r.detail.insert,c=i.children[n],u=document.createElement("option");u.textContent=a,u.value=h,c?c.before(u):i.append(u),e.setValue(t,{value:s(!0),items:l(r)}),o=s(!1)},items(r){let{items:n}=r.detail;for(;0!==i.length;)i.remove(0);for(let e of n){let{displayValue:t,exportValue:r}=e,n=document.createElement("option");n.textContent=t,n.value=r,i.append(n)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:s(!0),items:l(r)}),o=s(!1)},indices(r){let i=new Set(r.detail.indices);for(let e of r.target.options)e.selected=i.has(e.index);e.setValue(t,{value:s(!0)}),o=s(!1)},editable(e){e.target.disabled=!e.detail.editable}};this._dispatchEventFromSandbox(n,r)})),i.addEventListener("input",(r=>{var i;let n=s(!0);e.setValue(t,{value:n}),r.preventDefault(),null==(i=this.linkService.eventBus)||i.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:o,changeEx:n,willCommit:!1,commitKey:1,keyDown:!1}})})),this._setEventListeners(i,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],(e=>e.target.value))):i.addEventListener("input",(function(r){e.setValue(t,{value:s(!0)})})),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class oe extends K{constructor(e){var t,r,i;let{data:n,elements:a}=e;super(e,{isRenderable:!!(null!=(t=n.titleObj)&&t.str||null!=(r=n.contentsObj)&&r.str||null!=(i=n.richText)&&i.str)}),this.elements=a}render(){this.container.classList.add("popupAnnotation");let e=new le({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(let r of this.elements)r.popup=e,t.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",t.join(",")),this.container}}class le{constructor({container:e,color:t,elements:r,titleObj:i,modificationDate:n,contentsObj:a,richText:s,parent:P,rect:R,parentRect:I,open:O}){at(this,S),at(this,M),at(this,A),at(this,o,null),at(this,l,Et(this,A,C).bind(this)),at(this,h,Et(this,M,E).bind(this)),at(this,c,Et(this,S,T).bind(this)),at(this,u,null),at(this,d,null),at(this,p,null),at(this,f,null),at(this,m,null),at(this,g,null),at(this,v,!1),at(this,y,null),at(this,b,null),at(this,x,null),at(this,_,null),at(this,w,!1),Bt(this,d,e),Bt(this,_,i),Bt(this,p,a),Bt(this,x,s),Bt(this,m,P),Bt(this,u,t),Bt(this,b,R),Bt(this,g,I),Bt(this,f,r);let L=j.PDFDateString.toDateObject(n);L&&Bt(this,o,P.l10n.get("annotation_date_string",{date:L.toLocaleDateString(),time:L.toLocaleTimeString()})),this.trigger=r.flatMap((e=>e.getElementsToTriggerPopup()));for(let e of this.trigger)e.addEventListener("click",ce(this,c)),e.addEventListener("mouseenter",ce(this,h)),e.addEventListener("mouseleave",ce(this,l));ce(this,d).hidden=!0,O&&Et(this,S,T).call(this)}render(){if(ce(this,y))return;let{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:r,pageX:i,pageY:n}}}=ce(this,m),a=Bt(this,y,document.createElement("div"));if(a.className="popup",ce(this,u)){let e=a.style.outlineColor=V.Util.makeHexColor(...ce(this,u));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?a.style.backgroundColor=`color-mix(in srgb, ${e} 30%, white)`:a.style.backgroundColor=V.Util.makeHexColor(...ce(this,u).map((e=>Math.floor(.7*(255-e)+e))))}let s=document.createElement("span");s.className="header";let l=document.createElement("h1");if(s.append(l),({dir:l.dir,str:l.textContent}=ce(this,_)),a.append(s),ce(this,o)){let e=document.createElement("span");e.classList.add("popupDate"),ce(this,o).then((t=>{e.textContent=t})),s.append(e)}let h=ce(this,p),c=ce(this,x);if(null==c||!c.str||null!=h&&h.str&&h.str!==c.str){let e=this._formatContents(h);a.append(e)}else X.XfaLayer.render({xfaHtml:c.html,intent:"richText",div:a}),a.lastChild.classList.add("richText","popupContent");let v=!!ce(this,g),w=ce(this,v?g:b);for(let e of ce(this,f))if(!w||null!==V.Util.intersect(e.data.rect,w)){w=e.data.rect,v=!0;break}let S=V.Util.normalizeRect([w[0],e[3]-w[1]+e[1],w[2],e[3]-w[3]+e[1]]),T=v?w[2]-w[0]+5:0,M=S[0]+T,E=S[1],{style:A}=ce(this,d);A.left=100*(M-i)/t+"%",A.top=100*(E-n)/r+"%",ce(this,d).append(a)}_formatContents({str:e,dir:t}){let r=document.createElement("p");r.classList.add("popupContent"),r.dir=t;let i=e.split(/(?:\r\n?|\n)/);for(let e=0,t=i.length;e<t;++e){let n=i[e];r.append(document.createTextNode(n)),e<t-1&&r.append(document.createElement("br"))}return r}forceHide(){Bt(this,w,this.isVisible),ce(this,w)&&(ce(this,d).hidden=!0)}maybeShow(){ce(this,w)&&(Bt(this,w,!1),ce(this,d).hidden=!1)}get isVisible(){return!1===ce(this,d).hidden}}o=new WeakMap,l=new WeakMap,h=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,v=new WeakMap,y=new WeakMap,b=new WeakMap,x=new WeakMap,_=new WeakMap,w=new WeakMap,S=new WeakSet,T=function(){Bt(this,v,!ce(this,v)),ce(this,v)?(Et(this,M,E).call(this),ce(this,d).addEventListener("click",ce(this,c))):(Et(this,A,C).call(this),ce(this,d).removeEventListener("click",ce(this,c)))},M=new WeakSet,E=function(){ce(this,y)||this.render(),this.isVisible?ce(this,v)&&ce(this,d).classList.add("focused"):(ce(this,d).hidden=!1,ce(this,d).style.zIndex=parseInt(ce(this,d).style.zIndex)+1e3)},A=new WeakSet,C=function(){ce(this,d).classList.remove("focused"),!ce(this,v)&&(ce(this,d).hidden=!0,ce(this,d).style.zIndex=parseInt(ce(this,d).style.zIndex)-1e3)};class he extends K{constructor(e){var t,r,i;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(r=e.data.contentsObj)&&r.str||null!=(i=e.data.richText)&&i.str),ignoreBorder:!0}),this.textContent=e.data.textContent,this.annotationEditorType=V.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(let t of this.textContent){let r=document.createElement("span");r.textContent=t,e.append(r)}this.container.append(e)}return this.data.popupRef||this._createPopup(),this.container}}t.FreeTextAnnotationElement=he;class ue extends K{constructor(e){var t,r,i;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(r=e.data.contentsObj)&&r.str||null!=(i=e.data.richText)&&i.str),ignoreBorder:!0}),at(this,P,null)}render(){this.container.classList.add("lineAnnotation");let e=this.data,{width:t,height:r}=$(e.rect),i=this.svgFactory.create(t,r,!0),n=Bt(this,P,this.svgFactory.createElement("svg:line"));return n.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),n.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),n.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),n.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),n.setAttribute("stroke-width",e.borderStyle.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),i.append(n),this.container.append(i),e.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return ce(this,P)}addHighlightArea(){this.container.classList.add("highlightArea")}}P=new WeakMap;class de extends K{constructor(e){var t,r,i;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(r=e.data.contentsObj)&&r.str||null!=(i=e.data.richText)&&i.str),ignoreBorder:!0}),at(this,R,null)}render(){this.container.classList.add("squareAnnotation");let e=this.data,{width:t,height:r}=$(e.rect),i=this.svgFactory.create(t,r,!0),n=e.borderStyle.width,a=Bt(this,R,this.svgFactory.createElement("svg:rect"));return a.setAttribute("x",n/2),a.setAttribute("y",n/2),a.setAttribute("width",t-n),a.setAttribute("height",r-n),a.setAttribute("stroke-width",n||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),i.append(a),this.container.append(i),e.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return ce(this,R)}addHighlightArea(){this.container.classList.add("highlightArea")}}R=new WeakMap;class pe extends K{constructor(e){var t,r,i;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(r=e.data.contentsObj)&&r.str||null!=(i=e.data.richText)&&i.str),ignoreBorder:!0}),at(this,I,null)}render(){this.container.classList.add("circleAnnotation");let e=this.data,{width:t,height:r}=$(e.rect),i=this.svgFactory.create(t,r,!0),n=e.borderStyle.width,a=Bt(this,I,this.svgFactory.createElement("svg:ellipse"));return a.setAttribute("cx",t/2),a.setAttribute("cy",r/2),a.setAttribute("rx",t/2-n/2),a.setAttribute("ry",r/2-n/2),a.setAttribute("stroke-width",n||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),i.append(a),this.container.append(i),e.popupRef||this._createPopup(),this.container}getElementsToTriggerPopup(){return ce(this,I)}addHighlightArea(){this.container.classList.add("highlightArea")}}I=new WeakMap;class fe extends K{constructor(e){var t,r,i;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(r=e.data.contentsObj)&&r.str||null!=(i=e.data.richText)&&i.str),ignoreBorder:!0}),at(this,O,null),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let e=this.data,{width:t,height:r}=$(e.rect),i=this.svgFactory.create(t,r,!0),n=[];for(let t of e.vertices){let r=t.x-e.rect[0],i=e.rect[3]-t.y;n.push(r+","+i)}n=n.join(" ");let a=Bt(this,O,this.svgFactory.createElement(this.svgElementName));return a.setAttribute("points",n),a.setAttribute("stroke-width",e.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),i.append(a),this.container.append(i),e.popupRef||this._createPopup(a,e),this.container}getElementsToTriggerPopup(){return ce(this,O)}addHighlightArea(){this.container.classList.add("highlightArea")}}O=new WeakMap;class me extends fe{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class ge extends K{constructor(e){var t,r,i;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(r=e.data.contentsObj)&&r.str||null!=(i=e.data.richText)&&i.str),ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),this.data.popupRef||this._createPopup(),this.container}}class ve extends K{constructor(e){var t,r,i;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(r=e.data.contentsObj)&&r.str||null!=(i=e.data.richText)&&i.str),ignoreBorder:!0}),at(this,L,[]),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=V.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);let e=this.data,{width:t,height:r}=$(e.rect),i=this.svgFactory.create(t,r,!0);for(let t of e.inkLists){let r=[];for(let i of t){let t=i.x-e.rect[0],n=e.rect[3]-i.y;r.push(`${t},${n}`)}r=r.join(" ");let n=this.svgFactory.createElement(this.svgElementName);ce(this,L).push(n),n.setAttribute("points",r),n.setAttribute("stroke-width",e.borderStyle.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),e.popupRef||this._createPopup(n,e),i.append(n)}return this.container.append(i),this.container}getElementsToTriggerPopup(){return ce(this,L)}addHighlightArea(){this.container.classList.add("highlightArea")}}L=new WeakMap,t.InkAnnotationElement=ve;class ye extends K{constructor(e){var t,r,i;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(r=e.data.contentsObj)&&r.str||null!=(i=e.data.richText)&&i.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.classList.add("highlightAnnotation"),this.container)}}class be extends K{constructor(e){var t,r,i;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(r=e.data.contentsObj)&&r.str||null!=(i=e.data.richText)&&i.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.classList.add("underlineAnnotation"),this.container)}}class xe extends K{constructor(e){var t,r,i;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(r=e.data.contentsObj)&&r.str||null!=(i=e.data.richText)&&i.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.classList.add("squigglyAnnotation"),this.container)}}class _e extends K{constructor(e){var t,r,i;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(r=e.data.contentsObj)&&r.str||null!=(i=e.data.richText)&&i.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.popupRef||this._createPopup(),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.classList.add("strikeoutAnnotation"),this.container)}}class we extends K{constructor(e){var t,r,i;super(e,{isRenderable:!!(e.data.popupRef||null!=(t=e.data.titleObj)&&t.str||null!=(r=e.data.contentsObj)&&r.str||null!=(i=e.data.richText)&&i.str),ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),this.data.popupRef||this._createPopup(),this.container}}class Se extends K{constructor(e){var t;super(e,{isRenderable:!0}),at(this,D,null);let{filename:r,content:i}=this.data.file;this.filename=(0,j.getFilenameFromUrl)(r,!0),this.content=i,null==(t=this.linkService.eventBus)||t.dispatch("fileattachmentannotation",{source:this,filename:r,content:i})}render(){var e,t;let r;return this.container.classList.add("fileAttachmentAnnotation"),this.data.hasAppearance?r=document.createElement("div"):(r=document.createElement("img"),r.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(this.data.name)?"paperclip":"pushpin"}.svg`),r.classList.add("popupTriggerArea"),r.addEventListener("dblclick",this._download.bind(this)),Bt(this,D,r),!this.data.popupRef&&(null!=(e=this.data.titleObj)&&e.str||null!=(t=this.data.contentsObj)&&t.str||this.data.richText)&&this._createPopup(),this.container.append(r),this.container}getElementsToTriggerPopup(){return ce(this,D)}addHighlightArea(){this.container.classList.add("highlightArea")}_download(){var e;null==(e=this.downloadManager)||e.openOrDownloadData(this.container,this.content,this.filename)}}D=new WeakMap,k=new WeakMap,F=new WeakMap,N=new WeakMap,U=new WeakSet,B=function(e,t){var r;let i=e.firstChild||e;i.id=`${j.AnnotationPrefix}${t}`,this.div.append(e),null==(r=ce(this,k))||r.moveElementInDOM(this.div,e,i,!1)},z=new WeakSet,H=function(){if(!ce(this,F))return;let e=this.div;for(let[t,r]of ce(this,F)){let i=e.querySelector(`[data-annotation-id="${t}"]`);if(!i)continue;let{firstChild:n}=i;n?"CANVAS"===n.nodeName?n.replaceWith(r):n.before(r):i.append(r)}ce(this,F).clear()},t.AnnotationLayer=class{constructor({div:e,accessibilityManager:t,annotationCanvasMap:i,l10n:n,page:a,viewport:s}){at(this,U),at(this,z),at(this,k,null),at(this,F,null),at(this,N,new Map),this.div=e,Bt(this,k,t),Bt(this,F,i),this.l10n=n,this.page=a,this.viewport=s,this.zIndex=0;let{NullL10n:o}=r(32);this.l10n||(this.l10n=o)}render(e){return bt(this,null,(function*(){let{annotations:t}=e,r=this.div;(0,j.setLayerDimensions)(r,this.viewport);let i=new Map,n={data:null,layer:r,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:!1!==e.renderForms,svgFactory:new j.DOMSVGFactory,annotationStorage:e.annotationStorage||new G.AnnotationStorage,enableScripting:!0===e.enableScripting,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(let e of t){if(e.noHTML)continue;let t=e.annotationType===V.AnnotationType.POPUP;if(t){let t=i.get(e.id);if(!t)continue;n.elements=t}else{let{width:t,height:r}=$(e.rect);if(t<=0||r<=0)continue}n.data=e;let r=Z.create(n);if(!r.isRenderable)continue;if(!t&&e.popupRef){let t=i.get(e.popupRef);t?t.push(r):i.set(e.popupRef,[r])}r.annotationEditorType>0&&ce(this,N).set(r.data.id,r);let a=r.render();if(e.hidden&&(a.style.visibility="hidden"),Array.isArray(a))for(let t of a)Et(this,U,B).call(this,t,e.id);else Et(this,U,B).call(this,a,e.id)}Et(this,z,H).call(this),yield this.l10n.translate(r)}))}update({viewport:e}){let t=this.div;this.viewport=e,(0,j.setLayerDimensions)(t,{rotation:e.rotation}),Et(this,z,H).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(ce(this,N).values())}getEditableAnnotation(e){return ce(this,N).get(e)}}},(e,t)=>{function r(e){return Math.floor(255*Math.max(0,Math.min(1,e))).toString(16).padStart(2,"0")}Object.defineProperty(t,"__esModule",{value:!0}),t.ColorConverters=void 0,t.ColorConverters=class{static CMYK_G([e,t,r,i]){return["G",1-Math.min(1,.3*e+.59*r+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_HTML([e]){let t=r(e);return`#${t}${t}${t}`}static RGB_G([e,t,r]){return["G",.3*e+.59*t+.11*r]}static RGB_HTML([e,t,i]){return`#${r(e)}${r(t)}${r(i)}`}static T_HTML(){return"#00000000"}static CMYK_RGB([e,t,r,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,r+i),1-Math.min(1,t+i)]}static CMYK_HTML(e){let t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,r]){let i=1-e,n=1-t,a=1-r;return["CMYK",i,n,a,Math.min(i,n,a)]}}},(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.XfaLayer=void 0;var i=r(19);t.XfaLayer=class{static setupStorage(e,t,r,i,n){let a=i.getValue(t,{value:null});switch(r.name){case"textarea":if(null!==a.value&&(e.textContent=a.value),"print"===n)break;e.addEventListener("input",(e=>{i.setValue(t,{value:e.target.value})}));break;case"input":if("radio"===r.attributes.type||"checkbox"===r.attributes.type){if(a.value===r.attributes.xfaOn?e.setAttribute("checked",!0):a.value===r.attributes.xfaOff&&e.removeAttribute("checked"),"print"===n)break;e.addEventListener("change",(e=>{i.setValue(t,{value:e.target.checked?e.target.getAttribute("xfaOn"):e.target.getAttribute("xfaOff")})}))}else{if(null!==a.value&&e.setAttribute("value",a.value),"print"===n)break;e.addEventListener("input",(e=>{i.setValue(t,{value:e.target.value})}))}break;case"select":if(null!==a.value)for(let e of r.children)e.attributes.value===a.value&&(e.attributes.selected=!0);e.addEventListener("input",(e=>{let r=e.target.options,n=-1===r.selectedIndex?"":r[r.selectedIndex].value;i.setValue(t,{value:n})}))}}static setAttributes({html:e,element:t,storage:r=null,intent:i,linkService:n}){let{attributes:a}=t,s=e instanceof HTMLAnchorElement;"radio"===a.type&&(a.name=`${a.name}-${i}`);for(let[t,r]of Object.entries(a))if(null!=r)switch(t){case"class":r.length&&e.setAttribute(t,r.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",r);break;case"style":Object.assign(e.style,r);break;case"textContent":e.textContent=r;break;default:(!s||"href"!==t&&"newWindow"!==t)&&e.setAttribute(t,r)}s&&n.addLinkAttributes(e,a.href,a.newWindow),r&&a.dataId&&this.setupStorage(e,a.dataId,t,r)}static render(e){var t;let r=e.annotationStorage,n=e.linkService,a=e.xfaHtml,s=e.intent||"display",o=document.createElement(a.name);a.attributes&&this.setAttributes({html:o,element:a,intent:s,linkService:n});let l=[[a,-1,o]],h=e.div;if(h.append(o),e.viewport){let t=`matrix(${e.viewport.transform.join(",")})`;h.style.transform=t}"richText"!==s&&h.setAttribute("class","xfaLayer xfaFont");let c=[];for(;l.length>0;){let[e,a,o]=l.at(-1);if(a+1===e.children.length){l.pop();continue}let h=e.children[++l.at(-1)[1]];if(null===h)continue;let u,{name:d}=h;if("#text"!==d){if(u=null!=(t=null==h?void 0:h.attributes)&&t.xmlns?document.createElementNS(h.attributes.xmlns,d):document.createElement(d),o.append(u),h.attributes&&this.setAttributes({html:u,element:h,storage:r,intent:s,linkService:n}),h.children&&h.children.length>0)l.push([h,-1,u]);else if(h.value){let e=document.createTextNode(h.value);i.XfaText.shouldBuildText(d)&&c.push(e),u.append(e)}}else{let e=document.createTextNode(h.value);c.push(e),o.append(e)}}for(let e of h.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))e.setAttribute("readOnly",!0);return{textDivs:c}}static update(e){let t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NullL10n=void 0,t.getL10nFallback=i;let r={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image"};function i(e,t){switch(e){case"find_match_count":e=`find_match_count[${1===t.total?"one":"other"}]`;break;case"find_match_count_limit":e=`find_match_count_limit[${1===t.limit?"one":"other"}]`}return r[e]||""}r.print_progress_percent="{{progress}}%";let n={getLanguage(){return bt(this,null,(function*(){return"en-us"}))},getDirection(){return bt(this,null,(function*(){return"ltr"}))},get(e){return bt(this,arguments,(function*(e,t=null,r=i(e,t)){return function(e,t){return t?e.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,((e,r)=>r in t?t[r]:"{{"+r+"}}")):e}(r,t)}))},translate(e){return bt(this,null,(function*(){}))}};t.NullL10n=n},(e,t,r)=>{var i,n,a,s,o,l,h,c,u,d,p,f,m,g,v,y,b,x,_,w,S,T,M,E,A,C,P,R,I,O,L,D,k,F,N,U,B,z,H,V,j,G,W,X,q,Y,$,Z,K,J,Q,ee,te,re,ie,ne,ae,se,oe,le,he,ue,de,pe,fe,me,ge,ve,ye,be;Object.defineProperty(t,"__esModule",{value:!0}),t.InkEditor=void 0;var xe=r(1),_e=r(4),we=r(29),Se=r(5);let Te=16,Me=class extends _e.AnnotationEditor{constructor(e){super(Ii(on({},e),{name:"inkEditor"})),at(this,b),at(this,_),at(this,S),at(this,M),at(this,A),at(this,P),at(this,I),at(this,L),at(this,k),at(this,N),at(this,B),at(this,H),at(this,j),at(this,W),at(this,q),at(this,$),at(this,K),at(this,Q),at(this,te),at(this,he),at(this,de),at(this,fe),at(this,ge),at(this,ye),at(this,i,0),at(this,n,0),at(this,a,0),at(this,s,this.canvasContextMenu.bind(this)),at(this,o,this.canvasPointermove.bind(this)),at(this,l,this.canvasPointerleave.bind(this)),at(this,h,this.canvasPointerup.bind(this)),at(this,c,this.canvasPointerdown.bind(this)),at(this,u,new Path2D),at(this,d,!1),at(this,p,!1),at(this,f,!1),at(this,m,null),at(this,g,0),at(this,v,0),at(this,y,null),this.color=e.color||null,this.thickness=e.thickness||null,this.opacity=e.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0}static initialize(e){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink2_aria_label"].map((t=>[t,e.get(t)])))}static updateDefaultParams(e,t){switch(e){case xe.AnnotationEditorParamsType.INK_THICKNESS:Me._defaultThickness=t;break;case xe.AnnotationEditorParamsType.INK_COLOR:Me._defaultColor=t;break;case xe.AnnotationEditorParamsType.INK_OPACITY:Me._defaultOpacity=t/100}}updateParams(e,t){switch(e){case xe.AnnotationEditorParamsType.INK_THICKNESS:Et(this,b,x).call(this,t);break;case xe.AnnotationEditorParamsType.INK_COLOR:Et(this,_,w).call(this,t);break;case xe.AnnotationEditorParamsType.INK_OPACITY:Et(this,S,T).call(this,t)}}static get defaultPropertiesToUpdate(){return[[xe.AnnotationEditorParamsType.INK_THICKNESS,Me._defaultThickness],[xe.AnnotationEditorParamsType.INK_COLOR,Me._defaultColor||_e.AnnotationEditor._defaultLineColor],[xe.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*Me._defaultOpacity)]]}get propertiesToUpdate(){var e;return[[xe.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||Me._defaultThickness],[xe.AnnotationEditorParamsType.INK_COLOR,this.color||Me._defaultColor||_e.AnnotationEditor._defaultLineColor],[xe.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(null!=(e=this.opacity)?e:Me._defaultOpacity))]]}rebuild(){super.rebuild(),null!==this.div&&(this.canvas||(Et(this,q,Y).call(this),Et(this,$,Z).call(this)),this.isAttachedToDOM||(this.parent.add(this),Et(this,K,J).call(this)),Et(this,ge,ve).call(this))}remove(){null!==this.canvas&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,ce(this,m).disconnect(),Bt(this,m,null),super.remove())}setParent(e){!this.parent&&e?this._uiManager.removeShouldRescale(this):this.parent&&null===e&&this._uiManager.addShouldRescale(this),super.setParent(e)}onScaleChanging(){let[e,t]=this.parentDimensions,r=this.width*e,i=this.height*t;this.setDimensions(r,i)}enableEditMode(){ce(this,d)||null===this.canvas||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",ce(this,c)))}disableEditMode(){!this.isInEditMode()||null===this.canvas||(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",ce(this,c)))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return 0===this.paths.length||1===this.paths.length&&0===this.paths[0].length}commit(){ce(this,d)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),Bt(this,d,!0),this.div.classList.add("disabled"),Et(this,ge,ve).call(this,!0),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus({preventScroll:!0}))}focusin(e){super.focusin(e),this.enableEditMode()}canvasPointerdown(e){0!==e.button||!this.isInEditMode()||ce(this,d)||(this.setInForeground(),e.preventDefault(),"mouse"!==e.type&&this.div.focus(),Et(this,P,R).call(this,e.offsetX,e.offsetY))}canvasContextMenu(e){e.preventDefault()}canvasPointermove(e){e.preventDefault(),Et(this,I,O).call(this,e.offsetX,e.offsetY)}canvasPointerup(e){e.preventDefault(),Et(this,W,X).call(this,e)}canvasPointerleave(e){Et(this,W,X).call(this,e)}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),Me._l10nPromise.get("editor_ink2_aria_label").then((e=>{var t;return null==(t=this.div)?void 0:t.setAttribute("aria-label",e)}));let[r,i,n,a]=Et(this,M,E).call(this);if(this.setAt(r,i,0,0),this.setDims(n,a),Et(this,q,Y).call(this),this.width){let[r,i]=this.parentDimensions;this.setAt(e*r,t*i,this.width*r,this.height*i),Bt(this,f,!0),Et(this,K,J).call(this),this.setDims(this.width*r,this.height*i),Et(this,j,G).call(this),Et(this,ye,be).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return Et(this,$,Z).call(this),this.div}setDimensions(e,t){let r=Math.round(e),n=Math.round(t);if(ce(this,g)===r&&ce(this,v)===n)return;Bt(this,g,r),Bt(this,v,n),this.canvas.style.visibility="hidden",ce(this,i)&&Math.abs(ce(this,i)-e/t)>.01&&(t=Math.ceil(e/ce(this,i)),this.setDims(e,t));let[a,s]=this.parentDimensions;this.width=e/a,this.height=t/s,ce(this,d)&&Et(this,Q,ee).call(this,e,t),Et(this,K,J).call(this),Et(this,j,G).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(e,t,r){var s,o,l;if(e instanceof we.InkAnnotationElement)return null;let h=super.deserialize(e,t,r);h.thickness=e.thickness,h.color=xe.Util.makeHexColor(...e.color),h.opacity=e.opacity;let[c,u]=h.pageDimensions,p=h.width*c,f=h.height*u,m=h.parentScale,y=e.thickness/2;Bt(h,i,p/f),Bt(h,d,!0),Bt(h,g,Math.round(p)),Bt(h,v,Math.round(f));let{paths:b,rect:x,rotation:_}=e;for(let{bezier:e}of b){e=Et(s=Me,oe,le).call(s,e,x,_);let t=[];h.paths.push(t);let r=m*(e[0]-y),i=m*(e[1]-y);for(let n=2,a=e.length;n<a;n+=6){let a=m*(e[n]-y),s=m*(e[n+1]-y),o=m*(e[n+2]-y),l=m*(e[n+3]-y),h=m*(e[n+4]-y),c=m*(e[n+5]-y);t.push([[r,i],[a,s],[o,l],[h,c]]),r=h,i=c}let n=Et(this,ie,ne).call(this,t);h.bezierPath2D.push(n)}let w=Et(o=h,de,pe).call(o);return Bt(h,a,Math.max(Te,w[2]-w[0])),Bt(h,n,Math.max(Te,w[3]-w[1])),Et(l=h,Q,ee).call(l,p,f),h}serialize(){if(this.isEmpty())return null;let e=this.getRect(0,0),t=_e.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:xe.AnnotationEditorType.INK,color:t,thickness:this.thickness,opacity:this.opacity,paths:Et(this,he,ue).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,e),pageIndex:this.pageIndex,rect:e,rotation:this.rotation}}},Ee=Me;i=new WeakMap,n=new WeakMap,a=new WeakMap,s=new WeakMap,o=new WeakMap,l=new WeakMap,h=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,v=new WeakMap,y=new WeakMap,b=new WeakSet,x=function(e){let t=this.thickness;this.addCommands({cmd:()=>{this.thickness=e,Et(this,ge,ve).call(this)},undo:()=>{this.thickness=t,Et(this,ge,ve).call(this)},mustExec:!0,type:xe.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},_=new WeakSet,w=function(e){let t=this.color;this.addCommands({cmd:()=>{this.color=e,Et(this,j,G).call(this)},undo:()=>{this.color=t,Et(this,j,G).call(this)},mustExec:!0,type:xe.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},S=new WeakSet,T=function(e){e/=100;let t=this.opacity;this.addCommands({cmd:()=>{this.opacity=e,Et(this,j,G).call(this)},undo:()=>{this.opacity=t,Et(this,j,G).call(this)},mustExec:!0,type:xe.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},M=new WeakSet,E=function(){let{parentRotation:e,parentDimensions:[t,r]}=this;switch(e){case 90:return[0,r,r,t];case 180:return[t,r,t,r];case 270:return[t,0,r,t];default:return[0,0,t,r]}},A=new WeakSet,C=function(){let{ctx:e,color:t,opacity:r,thickness:i,parentScale:n,scaleFactor:a}=this;e.lineWidth=i*n/a,e.lineCap="round",e.lineJoin="round",e.miterLimit=10,e.strokeStyle=`${t}${(0,Se.opacityToHex)(r)}`},P=new WeakSet,R=function(e,t){this.canvas.addEventListener("contextmenu",ce(this,s)),this.canvas.addEventListener("pointerleave",ce(this,l)),this.canvas.addEventListener("pointermove",ce(this,o)),this.canvas.addEventListener("pointerup",ce(this,h)),this.canvas.removeEventListener("pointerdown",ce(this,c)),this.isEditing=!0,ce(this,f)||(Bt(this,f,!0),Et(this,K,J).call(this),this.thickness||(this.thickness=Me._defaultThickness),this.color||(this.color=Me._defaultColor||_e.AnnotationEditor._defaultLineColor),null!=this.opacity||(this.opacity=Me._defaultOpacity)),this.currentPath.push([e,t]),Bt(this,p,!1),Et(this,A,C).call(this),Bt(this,y,(()=>{Et(this,N,U).call(this),ce(this,y)&&window.requestAnimationFrame(ce(this,y))})),window.requestAnimationFrame(ce(this,y))},I=new WeakSet,O=function(e,t){let[r,i]=this.currentPath.at(-1);if(this.currentPath.length>1&&e===r&&t===i)return;let n=this.currentPath,a=ce(this,u);if(n.push([e,t]),Bt(this,p,!0),n.length<=2)return a.moveTo(...n[0]),void a.lineTo(e,t);3===n.length&&(Bt(this,u,a=new Path2D),a.moveTo(...n[0])),Et(this,B,z).call(this,a,...n.at(-3),...n.at(-2),e,t)},L=new WeakSet,D=function(){if(0===this.currentPath.length)return;let e=this.currentPath.at(-1);ce(this,u).lineTo(...e)},k=new WeakSet,F=function(e,t){let r;if(Bt(this,y,null),e=Math.min(Math.max(e,0),this.canvas.width),t=Math.min(Math.max(t,0),this.canvas.height),Et(this,I,O).call(this,e,t),Et(this,L,D).call(this),1!==this.currentPath.length)r=Et(this,H,V).call(this);else{let i=[e,t];r=[[i,i.slice(),i.slice(),i]]}let i=ce(this,u),n=this.currentPath;this.currentPath=[],Bt(this,u,new Path2D),this.addCommands({cmd:()=>{this.allRawPaths.push(n),this.paths.push(r),this.bezierPath2D.push(i),this.rebuild()},undo:()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),0===this.paths.length?this.remove():(this.canvas||(Et(this,q,Y).call(this),Et(this,$,Z).call(this)),Et(this,ge,ve).call(this))},mustExec:!0})},N=new WeakSet,U=function(){if(!ce(this,p))return;Bt(this,p,!1);Math.ceil(this.thickness*this.parentScale);let e=this.currentPath.slice(-3),t=e.map((e=>e[0])),r=e.map((e=>e[1])),{ctx:i}=(Math.min(...t),Math.max(...t),Math.min(...r),Math.max(...r),this);i.save(),i.clearRect(0,0,this.canvas.width,this.canvas.height);for(let e of this.bezierPath2D)i.stroke(e);i.stroke(ce(this,u)),i.restore()},B=new WeakSet,z=function(e,t,r,i,n,a,s){let o=(t+i)/2,l=(r+n)/2,h=(i+a)/2,c=(n+s)/2;e.bezierCurveTo(o+2*(i-o)/3,l+2*(n-l)/3,h+2*(i-h)/3,c+2*(n-c)/3,h,c)},H=new WeakSet,V=function(){let e=this.currentPath;if(e.length<=2)return[[e[0],e[0],e.at(-1),e.at(-1)]];let t,r=[],[i,n]=e[0];for(t=1;t<e.length-2;t++){let[a,s]=e[t],[o,l]=e[t+1],h=(a+o)/2,c=(s+l)/2,u=[i+2*(a-i)/3,n+2*(s-n)/3],d=[h+2*(a-h)/3,c+2*(s-c)/3];r.push([[i,n],u,d,[h,c]]),[i,n]=[h,c]}let[a,s]=e[t],[o,l]=e[t+1],h=[i+2*(a-i)/3,n+2*(s-n)/3],c=[o+2*(a-o)/3,l+2*(s-l)/3];return r.push([[i,n],h,c,[o,l]]),r},j=new WeakSet,G=function(){if(this.isEmpty())return void Et(this,te,re).call(this);Et(this,A,C).call(this);let{canvas:e,ctx:t}=this;t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),Et(this,te,re).call(this);for(let e of this.bezierPath2D)t.stroke(e)},W=new WeakSet,X=function(e){this.canvas.removeEventListener("pointerleave",ce(this,l)),this.canvas.removeEventListener("pointermove",ce(this,o)),this.canvas.removeEventListener("pointerup",ce(this,h)),this.canvas.addEventListener("pointerdown",ce(this,c)),setTimeout((()=>{this.canvas.removeEventListener("contextmenu",ce(this,s))}),10),Et(this,k,F).call(this,e.offsetX,e.offsetY),this.addToAnnotationStorage(),this.setInBackground()},q=new WeakSet,Y=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",Me._l10nPromise.get("editor_ink_canvas_aria_label").then((e=>{var t;return null==(t=this.canvas)?void 0:t.setAttribute("aria-label",e)})),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},$=new WeakSet,Z=function(){Bt(this,m,new ResizeObserver((e=>{let t=e[0].contentRect;t.width&&t.height&&this.setDimensions(t.width,t.height)}))),ce(this,m).observe(this.div)},K=new WeakSet,J=function(){if(!ce(this,f))return;let[e,t]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*e),this.canvas.height=Math.ceil(this.height*t),Et(this,te,re).call(this)},Q=new WeakSet,ee=function(e,t){let r=Et(this,fe,me).call(this),i=(e-r)/ce(this,a),s=(t-r)/ce(this,n);this.scaleFactor=Math.min(i,s)},te=new WeakSet,re=function(){let e=Et(this,fe,me).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+e,this.translationY*this.scaleFactor+e)},ie=new WeakSet,ne=function(e){let t=new Path2D;for(let r=0,i=e.length;r<i;r++){let[i,n,a,s]=e[r];0===r&&t.moveTo(...i),t.bezierCurveTo(n[0],n[1],a[0],a[1],s[0],s[1])}return t},ae=new WeakSet,se=function(e,t,r){let[i,n,a,s]=t;switch(r){case 0:for(let t=0,r=e.length;t<r;t+=2)e[t]+=i,e[t+1]=s-e[t+1];break;case 90:for(let t=0,r=e.length;t<r;t+=2){let r=e[t];e[t]=e[t+1]+i,e[t+1]=r+n}break;case 180:for(let t=0,r=e.length;t<r;t+=2)e[t]=a-e[t],e[t+1]+=n;break;case 270:for(let t=0,r=e.length;t<r;t+=2){let r=e[t];e[t]=a-e[t+1],e[t+1]=s-r}break;default:throw new Error("Invalid rotation")}return e},oe=new WeakSet,le=function(e,t,r){let[i,n,a,s]=t;switch(r){case 0:for(let t=0,r=e.length;t<r;t+=2)e[t]-=i,e[t+1]=s-e[t+1];break;case 90:for(let t=0,r=e.length;t<r;t+=2){let r=e[t];e[t]=e[t+1]-n,e[t+1]=r-i}break;case 180:for(let t=0,r=e.length;t<r;t+=2)e[t]=a-e[t],e[t+1]-=n;break;case 270:for(let t=0,r=e.length;t<r;t+=2){let r=e[t];e[t]=s-e[t+1],e[t+1]=a-r}break;default:throw new Error("Invalid rotation")}return e},he=new WeakSet,ue=function(e,t,r,i){var n,a;let s=[],o=this.thickness/2,l=e*t+o,h=e*r+o;for(let t of this.paths){let r=[],o=[];for(let i=0,n=t.length;i<n;i++){let[a,s,c,u]=t[i],d=e*a[0]+l,p=e*a[1]+h,f=e*s[0]+l,m=e*s[1]+h,g=e*c[0]+l,v=e*c[1]+h,y=e*u[0]+l,b=e*u[1]+h;0===i&&(r.push(d,p),o.push(d,p)),r.push(f,m,g,v,y,b),o.push(f,m),i===n-1&&o.push(y,b)}s.push({bezier:Et(n=Me,ae,se).call(n,r,i,this.rotation),points:Et(a=Me,ae,se).call(a,o,i,this.rotation)})}return s},de=new WeakSet,pe=function(){let e=1/0,t=-1/0,r=1/0,i=-1/0;for(let n of this.paths)for(let[a,s,o,l]of n){let n=xe.Util.bezierBoundingBox(...a,...s,...o,...l);e=Math.min(e,n[0]),r=Math.min(r,n[1]),t=Math.max(t,n[2]),i=Math.max(i,n[3])}return[e,r,t,i]},fe=new WeakSet,me=function(){return ce(this,d)?Math.ceil(this.thickness*this.parentScale):0},ge=new WeakSet,ve=function(e=!1){if(this.isEmpty())return;if(!ce(this,d))return void Et(this,j,G).call(this);let t=Et(this,de,pe).call(this),r=Et(this,fe,me).call(this);Bt(this,a,Math.max(Te,t[2]-t[0])),Bt(this,n,Math.max(Te,t[3]-t[1]));let s=Math.ceil(r+ce(this,a)*this.scaleFactor),o=Math.ceil(r+ce(this,n)*this.scaleFactor),[l,h]=this.parentDimensions;this.width=s/l,this.height=o/h,Bt(this,i,s/o),Et(this,ye,be).call(this);let c=this.translationX,u=this.translationY;this.translationX=-t[0],this.translationY=-t[1],Et(this,K,J).call(this),Et(this,j,G).call(this),Bt(this,g,s),Bt(this,v,o),this.setDims(s,o);let p=e?r/this.scaleFactor/2:0;this.translate(c-this.translationX-p,u-this.translationY-p)},ye=new WeakSet,be=function(){let{style:e}=this.div;ce(this,i)>=1?(e.minHeight="16px",e.minWidth=`${Math.round(ce(this,i)*Te)}px`):(e.minWidth="16px",e.minHeight=`${Math.round(Te/ce(this,i))}px`)},at(Ee,ie),at(Ee,ae),at(Ee,oe),Es(Ee,"_defaultColor",null),Es(Ee,"_defaultOpacity",1),Es(Ee,"_defaultThickness",1),Es(Ee,"_l10nPromise"),Es(Ee,"_type","ink"),t.InkEditor=Ee},(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SVGGraphics=void 0;var i=r(6),n=r(1),a=r(10);let s="normal",o="normal",l="#000000",h=["butt","round","square"],c=["miter","round","bevel"],u=function(e,t="",r=!1){if(URL.createObjectURL&&"undefined"!=typeof Blob&&!r)return URL.createObjectURL(new Blob([e],{type:t}));let i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=`data:${t};base64,`;for(let t=0,r=e.length;t<r;t+=3){let a=255&e[t],s=255&e[t+1],o=255&e[t+2];n+=i[a>>2]+i[(3&a)<<4|s>>4]+i[t+1<r?(15&s)<<2|o>>6:64]+i[t+2<r?63&o:64]}return n},d=function(){let e=new Uint8Array([137,80,78,71,13,10,26,10]),t=new Int32Array(256);for(let e=0;e<256;e++){let r=e;for(let e=0;e<8;e++)r=1&r?3988292384^r>>1&2147483647:r>>1&2147483647;t[e]=r}function r(e,r,i,n){let a=n,s=r.length;i[a]=s>>24&255,i[a+1]=s>>16&255,i[a+2]=s>>8&255,i[a+3]=255&s,a+=4,i[a]=255&e.charCodeAt(0),i[a+1]=255&e.charCodeAt(1),i[a+2]=255&e.charCodeAt(2),i[a+3]=255&e.charCodeAt(3),a+=4,i.set(r,a),a+=r.length;let o=function(e,r,i){let n=-1;for(let a=r;a<i;a++){let r=255&(n^e[a]);n=n>>>8^t[r]}return-1^n}(i,n+4,a);i[a]=o>>24&255,i[a+1]=o>>16&255,i[a+2]=o>>8&255,i[a+3]=255&o}function i(e){let t=e.length,r=65535,i=Math.ceil(t/r),n=new Uint8Array(2+t+5*i+4),a=0;n[a++]=120,n[a++]=156;let s=0;for(;t>r;)n[a++]=0,n[a++]=255,n[a++]=255,n[a++]=0,n[a++]=0,n.set(e.subarray(s,s+r),a),a+=r,s+=r,t-=r;n[a++]=1,n[a++]=255&t,n[a++]=t>>8&255,n[a++]=255&~t,n[a++]=(65535&~t)>>8&255,n.set(e.subarray(s),a),a+=e.length-s;let o=function(e,t,r){let i=1,n=0;for(let a=t;a<r;++a)i=(i+(255&e[a]))%65521,n=(n+i)%65521;return n<<16|i}(e,0,e.length);return n[a++]=o>>24&255,n[a++]=o>>16&255,n[a++]=o>>8&255,n[a++]=255&o,n}function s(t,s,o,l){let h,c,d,p=t.width,f=t.height,m=t.data;switch(s){case n.ImageKind.GRAYSCALE_1BPP:c=0,h=1,d=p+7>>3;break;case n.ImageKind.RGB_24BPP:c=2,h=8,d=3*p;break;case n.ImageKind.RGBA_32BPP:c=6,h=8,d=4*p;break;default:throw new Error("invalid format")}let g=new Uint8Array((1+d)*f),v=0,y=0;for(let e=0;e<f;++e)g[v++]=0,g.set(m.subarray(y,y+d),v),y+=d,v+=d;if(s===n.ImageKind.GRAYSCALE_1BPP&&l){v=0;for(let e=0;e<f;e++){v++;for(let e=0;e<d;e++)g[v++]^=255}}let b=new Uint8Array([p>>24&255,p>>16&255,p>>8&255,255&p,f>>24&255,f>>16&255,f>>8&255,255&f,h,c,0,0,0]),x=function(e){if(!a.isNodeJS)return i(e);try{let t;t=parseInt(process.versions.node)>=8?e:Buffer.from(e);let r=VAe().deflateSync(t,{level:9});return r instanceof Uint8Array?r:new Uint8Array(r)}catch(e){(0,n.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+e)}return i(e)}(g),_=e.length+36+b.length+x.length,w=new Uint8Array(_),S=0;return w.set(e,S),S+=e.length,r("IHDR",b,w,S),S+=12+b.length,r("IDATA",x,w,S),S+=12+x.length,r("IEND",new Uint8Array(0),w,S),u(w,"image/png",o)}return function(e,t,r){return s(e,void 0===e.kind?n.ImageKind.GRAYSCALE_1BPP:e.kind,t,r)}}();class p{constructor(){this.fontSizeScale=1,this.fontWeight=o,this.fontSize=0,this.textMatrix=n.IDENTITY_MATRIX,this.fontMatrix=n.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=n.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=l,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(e,t){this.x=e,this.y=t}}function f(e){if(Number.isInteger(e))return e.toString();let t=e.toFixed(10),r=t.length-1;if("0"!==t[r])return t;do{r--}while("0"===t[r]);return t.substring(0,"."===t[r]?r:r+1)}function m(e){if(0===e[4]&&0===e[5]){if(0===e[1]&&0===e[2])return 1===e[0]&&1===e[3]?"":`scale(${f(e[0])} ${f(e[3])})`;if(e[0]===e[3]&&e[1]===-e[2])return`rotate(${f(180*Math.acos(e[0])/Math.PI)})`}else if(1===e[0]&&0===e[1]&&0===e[2]&&1===e[3])return`translate(${f(e[4])} ${f(e[5])})`;return`matrix(${f(e[0])} ${f(e[1])} ${f(e[2])} ${f(e[3])} ${f(e[4])} ${f(e[5])})`}let g=0,v=0,y=0;t.SVGGraphics=class{constructor(e,t,r=!1){(0,i.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new i.DOMSVGFactory,this.current=new p,this.transformMatrix=n.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=e,this.objs=t,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!r,this._operatorIdMapping=[];for(let e in n.OPS)this._operatorIdMapping[n.OPS[e]]=e}getObject(e,t=null){return"string"==typeof e?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}save(){this.transformStack.push(this.transformMatrix);let e=this.current;this.extraStack.push(e),this.current=e.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(e){this.save(),this.executeOpTree(e),this.restore()}loadDependencies(e){let t=e.fnArray,r=e.argsArray;for(let e=0,i=t.length;e<i;e++)if(t[e]===n.OPS.dependency)for(let t of r[e]){let e=t.startsWith("g_")?this.commonObjs:this.objs,r=new Promise((r=>{e.get(t,r)}));this.current.dependencies.push(r)}return Promise.all(this.current.dependencies)}transform(e,t,r,i,a,s){let o=[e,t,r,i,a,s];this.transformMatrix=n.Util.transform(this.transformMatrix,o),this.tgrp=null}getSVG(e,t){this.viewport=t;let r=this._initialize(t);return this.loadDependencies(e).then((()=>(this.transformMatrix=n.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(e)),r)))}convertOpList(e){let t=this._operatorIdMapping,r=e.argsArray,i=e.fnArray,n=[];for(let e=0,a=i.length;e<a;e++){let a=i[e];n.push({fnId:a,fn:t[a],args:r[e]})}return function(e){let t=[],r=[];for(let i of e)"save"!==i.fn?"restore"===i.fn?t=r.pop():t.push(i):(t.push({fnId:92,fn:"group",items:[]}),r.push(t),t=t.at(-1).items);return t}(n)}executeOpTree(e){for(let t of e){let e=t.fn,r=t.fnId,i=t.args;switch(0|r){case n.OPS.beginText:this.beginText();break;case n.OPS.dependency:break;case n.OPS.setLeading:this.setLeading(i);break;case n.OPS.setLeadingMoveText:this.setLeadingMoveText(i[0],i[1]);break;case n.OPS.setFont:this.setFont(i);break;case n.OPS.showText:case n.OPS.showSpacedText:this.showText(i[0]);break;case n.OPS.endText:this.endText();break;case n.OPS.moveText:this.moveText(i[0],i[1]);break;case n.OPS.setCharSpacing:this.setCharSpacing(i[0]);break;case n.OPS.setWordSpacing:this.setWordSpacing(i[0]);break;case n.OPS.setHScale:this.setHScale(i[0]);break;case n.OPS.setTextMatrix:this.setTextMatrix(i[0],i[1],i[2],i[3],i[4],i[5]);break;case n.OPS.setTextRise:this.setTextRise(i[0]);break;case n.OPS.setTextRenderingMode:this.setTextRenderingMode(i[0]);break;case n.OPS.setLineWidth:this.setLineWidth(i[0]);break;case n.OPS.setLineJoin:this.setLineJoin(i[0]);break;case n.OPS.setLineCap:this.setLineCap(i[0]);break;case n.OPS.setMiterLimit:this.setMiterLimit(i[0]);break;case n.OPS.setFillRGBColor:this.setFillRGBColor(i[0],i[1],i[2]);break;case n.OPS.setStrokeRGBColor:this.setStrokeRGBColor(i[0],i[1],i[2]);break;case n.OPS.setStrokeColorN:this.setStrokeColorN(i);break;case n.OPS.setFillColorN:this.setFillColorN(i);break;case n.OPS.shadingFill:this.shadingFill(i[0]);break;case n.OPS.setDash:this.setDash(i[0],i[1]);break;case n.OPS.setRenderingIntent:this.setRenderingIntent(i[0]);break;case n.OPS.setFlatness:this.setFlatness(i[0]);break;case n.OPS.setGState:this.setGState(i[0]);break;case n.OPS.fill:this.fill();break;case n.OPS.eoFill:this.eoFill();break;case n.OPS.stroke:this.stroke();break;case n.OPS.fillStroke:this.fillStroke();break;case n.OPS.eoFillStroke:this.eoFillStroke();break;case n.OPS.clip:this.clip("nonzero");break;case n.OPS.eoClip:this.clip("evenodd");break;case n.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case n.OPS.paintImageXObject:this.paintImageXObject(i[0]);break;case n.OPS.paintInlineImageXObject:this.paintInlineImageXObject(i[0]);break;case n.OPS.paintImageMaskXObject:this.paintImageMaskXObject(i[0]);break;case n.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(i[0],i[1]);break;case n.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case n.OPS.closePath:this.closePath();break;case n.OPS.closeStroke:this.closeStroke();break;case n.OPS.closeFillStroke:this.closeFillStroke();break;case n.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case n.OPS.nextLine:this.nextLine();break;case n.OPS.transform:this.transform(i[0],i[1],i[2],i[3],i[4],i[5]);break;case n.OPS.constructPath:this.constructPath(i[0],i[1]);break;case n.OPS.endPath:this.endPath();break;case 92:this.group(t.items);break;default:(0,n.warn)(`Unimplemented operator ${e}`)}}}setWordSpacing(e){this.current.wordSpacing=e}setCharSpacing(e){this.current.charSpacing=e}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(e,t,r,i,n,a){let s=this.current;s.textMatrix=s.lineMatrix=[e,t,r,i,n,a],s.textMatrixScale=Math.hypot(e,t),s.x=s.lineX=0,s.y=s.lineY=0,s.xcoords=[],s.ycoords=[],s.tspan=this.svgFactory.createElement("svg:tspan"),s.tspan.setAttributeNS(null,"font-family",s.fontFamily),s.tspan.setAttributeNS(null,"font-size",`${f(s.fontSize)}px`),s.tspan.setAttributeNS(null,"y",f(-s.y)),s.txtElement=this.svgFactory.createElement("svg:text"),s.txtElement.append(s.tspan)}beginText(){let e=this.current;e.x=e.lineX=0,e.y=e.lineY=0,e.textMatrix=n.IDENTITY_MATRIX,e.lineMatrix=n.IDENTITY_MATRIX,e.textMatrixScale=1,e.tspan=this.svgFactory.createElement("svg:tspan"),e.txtElement=this.svgFactory.createElement("svg:text"),e.txtgrp=this.svgFactory.createElement("svg:g"),e.xcoords=[],e.ycoords=[]}moveText(e,t){let r=this.current;r.x=r.lineX+=e,r.y=r.lineY+=t,r.xcoords=[],r.ycoords=[],r.tspan=this.svgFactory.createElement("svg:tspan"),r.tspan.setAttributeNS(null,"font-family",r.fontFamily),r.tspan.setAttributeNS(null,"font-size",`${f(r.fontSize)}px`),r.tspan.setAttributeNS(null,"y",f(-r.y))}showText(e){let t=this.current,r=t.font,i=t.fontSize;if(0===i)return;let a=t.fontSizeScale,h=t.charSpacing,c=t.wordSpacing,u=t.fontDirection,d=t.textHScale*u,p=r.vertical,g=p?1:-1,v=r.defaultVMetrics,y=i*t.fontMatrix[0],b=0;for(let n of e){if(null===n){b+=u*c;continue}if("number"==typeof n){b+=g*n*i/1e3;continue}let e,s,o,l=(n.isSpace?c:0)+h,d=n.fontChar,f=n.width;if(p){let t,r=n.vmetric||v;t=n.vmetric?r[1]:.5*f,t=-t*y;let i=r[2]*y;f=r?-r[0]:f,e=t/a,s=(b+i)/a}else e=b/a,s=0;(n.isInFont||r.missingFile)&&(t.xcoords.push(t.x+e),p&&t.ycoords.push(-t.y+s),t.tspan.textContent+=d),o=p?f*y-l*u:f*y+l*u,b+=o}t.tspan.setAttributeNS(null,"x",t.xcoords.map(f).join(" ")),p?t.tspan.setAttributeNS(null,"y",t.ycoords.map(f).join(" ")):t.tspan.setAttributeNS(null,"y",f(-t.y)),p?t.y-=b:t.x+=b*d,t.tspan.setAttributeNS(null,"font-family",t.fontFamily),t.tspan.setAttributeNS(null,"font-size",`${f(t.fontSize)}px`),t.fontStyle!==s&&t.tspan.setAttributeNS(null,"font-style",t.fontStyle),t.fontWeight!==o&&t.tspan.setAttributeNS(null,"font-weight",t.fontWeight);let x=t.textRenderingMode&n.TextRenderingMode.FILL_STROKE_MASK;if(x===n.TextRenderingMode.FILL||x===n.TextRenderingMode.FILL_STROKE?(t.fillColor!==l&&t.tspan.setAttributeNS(null,"fill",t.fillColor),t.fillAlpha<1&&t.tspan.setAttributeNS(null,"fill-opacity",t.fillAlpha)):t.textRenderingMode===n.TextRenderingMode.ADD_TO_PATH?t.tspan.setAttributeNS(null,"fill","transparent"):t.tspan.setAttributeNS(null,"fill","none"),x===n.TextRenderingMode.STROKE||x===n.TextRenderingMode.FILL_STROKE){let e=1/(t.textMatrixScale||1);this._setStrokeAttributes(t.tspan,e)}let _=t.textMatrix;0!==t.textRise&&(_=_.slice(),_[5]+=t.textRise),t.txtElement.setAttributeNS(null,"transform",`${m(_)} scale(${f(d)}, -1)`),t.txtElement.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),t.txtElement.append(t.tspan),t.txtgrp.append(t.txtElement),this._ensureTransformGroup().append(t.txtElement)}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}addFontStyle(e){if(!e.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));let t=u(e.data,e.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${e.loadedName}"; src: url(${t}); }\n`}setFont(e){let t=this.current,r=this.commonObjs.get(e[0]),i=e[1];t.font=r,this.embedFonts&&!r.missingFile&&!this.embeddedFonts[r.loadedName]&&(this.addFontStyle(r),this.embeddedFonts[r.loadedName]=r),t.fontMatrix=r.fontMatrix||n.FONT_IDENTITY_MATRIX;let a="normal";r.black?a="900":r.bold&&(a="bold");let s=r.italic?"italic":"normal";i<0?(i=-i,t.fontDirection=-1):t.fontDirection=1,t.fontSize=i,t.fontFamily=r.loadedName,t.fontWeight=a,t.fontStyle=s,t.tspan=this.svgFactory.createElement("svg:tspan"),t.tspan.setAttributeNS(null,"y",f(-t.y)),t.xcoords=[],t.ycoords=[]}endText(){var e;let t=this.current;t.textRenderingMode&n.TextRenderingMode.ADD_TO_PATH_FLAG&&null!=(e=t.txtElement)&&e.hasChildNodes()&&(t.element=t.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(e){e>0&&(this.current.lineWidth=e)}setLineCap(e){this.current.lineCap=h[e]}setLineJoin(e){this.current.lineJoin=c[e]}setMiterLimit(e){this.current.miterLimit=e}setStrokeAlpha(e){this.current.strokeAlpha=e}setStrokeRGBColor(e,t,r){this.current.strokeColor=n.Util.makeHexColor(e,t,r)}setFillAlpha(e){this.current.fillAlpha=e}setFillRGBColor(e,t,r){this.current.fillColor=n.Util.makeHexColor(e,t,r),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(e){this.current.strokeColor=this._makeColorN_Pattern(e)}setFillColorN(e){this.current.fillColor=this._makeColorN_Pattern(e)}shadingFill(e){let{width:t,height:r}=this.viewport,i=n.Util.inverseTransform(this.transformMatrix),[a,s,o,l]=n.Util.getAxialAlignedBoundingBox([0,0,t,r],i),h=this.svgFactory.createElement("svg:rect");h.setAttributeNS(null,"x",a),h.setAttributeNS(null,"y",s),h.setAttributeNS(null,"width",o-a),h.setAttributeNS(null,"height",l-s),h.setAttributeNS(null,"fill",this._makeShadingPattern(e)),this.current.fillAlpha<1&&h.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(h)}_makeColorN_Pattern(e){return"TilingPattern"===e[0]?this._makeTilingPattern(e):this._makeShadingPattern(e)}_makeTilingPattern(e){let t=e[1],r=e[2],i=e[3]||n.IDENTITY_MATRIX,[a,s,o,l]=e[4],h=e[5],c=e[6],u=e[7],d="shading"+y++,[p,f,m,g]=n.Util.normalizeRect([...n.Util.applyTransform([a,s],i),...n.Util.applyTransform([o,l],i)]),[v,b]=n.Util.singularValueDecompose2dScale(i),x=h*v,_=c*b,w=this.svgFactory.createElement("svg:pattern");w.setAttributeNS(null,"id",d),w.setAttributeNS(null,"patternUnits","userSpaceOnUse"),w.setAttributeNS(null,"width",x),w.setAttributeNS(null,"height",_),w.setAttributeNS(null,"x",`${p}`),w.setAttributeNS(null,"y",`${f}`);let S=this.svg,T=this.transformMatrix,M=this.current.fillColor,E=this.current.strokeColor,A=this.svgFactory.create(m-p,g-f);if(this.svg=A,this.transformMatrix=i,2===u){let e=n.Util.makeHexColor(...t);this.current.fillColor=e,this.current.strokeColor=e}return this.executeOpTree(this.convertOpList(r)),this.svg=S,this.transformMatrix=T,this.current.fillColor=M,this.current.strokeColor=E,w.append(A.childNodes[0]),this.defs.append(w),`url(#${d})`}_makeShadingPattern(e){switch("string"==typeof e&&(e=this.objs.get(e)),e[0]){case"RadialAxial":let t,r="shading"+y++,i=e[3];switch(e[1]){case"axial":let i=e[4],n=e[5];t=this.svgFactory.createElement("svg:linearGradient"),t.setAttributeNS(null,"id",r),t.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),t.setAttributeNS(null,"x1",i[0]),t.setAttributeNS(null,"y1",i[1]),t.setAttributeNS(null,"x2",n[0]),t.setAttributeNS(null,"y2",n[1]);break;case"radial":let a=e[4],s=e[5],o=e[6],l=e[7];t=this.svgFactory.createElement("svg:radialGradient"),t.setAttributeNS(null,"id",r),t.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),t.setAttributeNS(null,"cx",s[0]),t.setAttributeNS(null,"cy",s[1]),t.setAttributeNS(null,"r",l),t.setAttributeNS(null,"fx",a[0]),t.setAttributeNS(null,"fy",a[1]),t.setAttributeNS(null,"fr",o);break;default:throw new Error(`Unknown RadialAxial type: ${e[1]}`)}for(let e of i){let r=this.svgFactory.createElement("svg:stop");r.setAttributeNS(null,"offset",e[0]),r.setAttributeNS(null,"stop-color",e[1]),t.append(r)}return this.defs.append(t),`url(#${r})`;case"Mesh":return(0,n.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${e[0]}`)}}setDash(e,t){this.current.dashArray=e,this.current.dashPhase=t}constructPath(e,t){let r=this.current,i=r.x,a=r.y,s=[],o=0;for(let r of e)switch(0|r){case n.OPS.rectangle:i=t[o++],a=t[o++];let e=i+t[o++],r=a+t[o++];s.push("M",f(i),f(a),"L",f(e),f(a),"L",f(e),f(r),"L",f(i),f(r),"Z");break;case n.OPS.moveTo:i=t[o++],a=t[o++],s.push("M",f(i),f(a));break;case n.OPS.lineTo:i=t[o++],a=t[o++],s.push("L",f(i),f(a));break;case n.OPS.curveTo:i=t[o+4],a=t[o+5],s.push("C",f(t[o]),f(t[o+1]),f(t[o+2]),f(t[o+3]),f(i),f(a)),o+=6;break;case n.OPS.curveTo2:s.push("C",f(i),f(a),f(t[o]),f(t[o+1]),f(t[o+2]),f(t[o+3])),i=t[o+2],a=t[o+3],o+=4;break;case n.OPS.curveTo3:i=t[o+2],a=t[o+3],s.push("C",f(t[o]),f(t[o+1]),f(i),f(a),f(i),f(a)),o+=4;break;case n.OPS.closePath:s.push("Z")}s=s.join(" "),r.path&&e.length>0&&e[0]!==n.OPS.rectangle&&e[0]!==n.OPS.moveTo?s=r.path.getAttributeNS(null,"d")+s:(r.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(r.path)),r.path.setAttributeNS(null,"d",s),r.path.setAttributeNS(null,"fill","none"),r.element=r.path,r.setCurrentPoint(i,a)}endPath(){let e=this.current;if(e.path=null,!this.pendingClip)return;if(!e.element)return void(this.pendingClip=null);let t="clippath"+g++,r=this.svgFactory.createElement("svg:clipPath");r.setAttributeNS(null,"id",t),r.setAttributeNS(null,"transform",m(this.transformMatrix));let i=e.element.cloneNode(!0);if("evenodd"===this.pendingClip?i.setAttributeNS(null,"clip-rule","evenodd"):i.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,r.append(i),this.defs.append(r),e.activeClipUrl){e.clipGroup=null;for(let e of this.extraStack)e.clipGroup=null;r.setAttributeNS(null,"clip-path",e.activeClipUrl)}e.activeClipUrl=`url(#${t})`,this.tgrp=null}clip(e){this.pendingClip=e}closePath(){let e=this.current;if(e.path){let t=`${e.path.getAttributeNS(null,"d")}Z`;e.path.setAttributeNS(null,"d",t)}}setLeading(e){this.current.leading=-e}setTextRise(e){this.current.textRise=e}setTextRenderingMode(e){this.current.textRenderingMode=e}setHScale(e){this.current.textHScale=e/100}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(let[t,r]of e)switch(t){case"LW":this.setLineWidth(r);break;case"LC":this.setLineCap(r);break;case"LJ":this.setLineJoin(r);break;case"ML":this.setMiterLimit(r);break;case"D":this.setDash(r[0],r[1]);break;case"RI":this.setRenderingIntent(r);break;case"FL":this.setFlatness(r);break;case"Font":this.setFont(r);break;case"CA":this.setStrokeAlpha(r);break;case"ca":this.setFillAlpha(r);break;default:(0,n.warn)(`Unimplemented graphic state operator ${t}`)}}fill(){let e=this.current;e.element&&(e.element.setAttributeNS(null,"fill",e.fillColor),e.element.setAttributeNS(null,"fill-opacity",e.fillAlpha),this.endPath())}stroke(){let e=this.current;e.element&&(this._setStrokeAttributes(e.element),e.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(e,t=1){let r=this.current,i=r.dashArray;1!==t&&i.length>0&&(i=i.map((function(e){return t*e}))),e.setAttributeNS(null,"stroke",r.strokeColor),e.setAttributeNS(null,"stroke-opacity",r.strokeAlpha),e.setAttributeNS(null,"stroke-miterlimit",f(r.miterLimit)),e.setAttributeNS(null,"stroke-linecap",r.lineCap),e.setAttributeNS(null,"stroke-linejoin",r.lineJoin),e.setAttributeNS(null,"stroke-width",f(t*r.lineWidth)+"px"),e.setAttributeNS(null,"stroke-dasharray",i.map(f).join(" ")),e.setAttributeNS(null,"stroke-dashoffset",f(t*r.dashPhase)+"px")}eoFill(){var e;null==(e=this.current.element)||e.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var e;null==(e=this.current.element)||e.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){let e=this.svgFactory.createElement("svg:rect");e.setAttributeNS(null,"x","0"),e.setAttributeNS(null,"y","0"),e.setAttributeNS(null,"width","1px"),e.setAttributeNS(null,"height","1px"),e.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(e)}paintImageXObject(e){let t=this.getObject(e);t?this.paintInlineImageXObject(t):(0,n.warn)(`Dependent image with object ID ${e} is not ready yet`)}paintInlineImageXObject(e,t){let r=e.width,i=e.height,n=d(e,this.forceDataSchema,!!t),a=this.svgFactory.createElement("svg:rect");a.setAttributeNS(null,"x","0"),a.setAttributeNS(null,"y","0"),a.setAttributeNS(null,"width",f(r)),a.setAttributeNS(null,"height",f(i)),this.current.element=a,this.clip("nonzero");let s=this.svgFactory.createElement("svg:image");s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),s.setAttributeNS(null,"x","0"),s.setAttributeNS(null,"y",f(-i)),s.setAttributeNS(null,"width",f(r)+"px"),s.setAttributeNS(null,"height",f(i)+"px"),s.setAttributeNS(null,"transform",`scale(${f(1/r)} ${f(-1/i)})`),t?t.append(s):this._ensureTransformGroup().append(s)}paintImageMaskXObject(e){let t=this.getObject(e.data,e);if(t.bitmap)return void(0,n.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");let r=this.current,i=t.width,a=t.height,s=r.fillColor;r.maskId="mask"+v++;let o=this.svgFactory.createElement("svg:mask");o.setAttributeNS(null,"id",r.maskId);let l=this.svgFactory.createElement("svg:rect");l.setAttributeNS(null,"x","0"),l.setAttributeNS(null,"y","0"),l.setAttributeNS(null,"width",f(i)),l.setAttributeNS(null,"height",f(a)),l.setAttributeNS(null,"fill",s),l.setAttributeNS(null,"mask",`url(#${r.maskId})`),this.defs.append(o),this._ensureTransformGroup().append(l),this.paintInlineImageXObject(t,o)}paintFormXObjectBegin(e,t){if(Array.isArray(e)&&6===e.length&&this.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t){let e=t[2]-t[0],r=t[3]-t[1],i=this.svgFactory.createElement("svg:rect");i.setAttributeNS(null,"x",t[0]),i.setAttributeNS(null,"y",t[1]),i.setAttributeNS(null,"width",f(e)),i.setAttributeNS(null,"height",f(r)),this.current.element=i,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(e){let t=this.svgFactory.create(e.width,e.height),r=this.svgFactory.createElement("svg:defs");t.append(r),this.defs=r;let i=this.svgFactory.createElement("svg:g");return i.setAttributeNS(null,"transform",m(e.transform)),t.append(i),this.svg=i,t}_ensureClipGroup(){if(!this.current.clipGroup){let e=this.svgFactory.createElement("svg:g");e.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(e),this.current.clipGroup=e}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",m(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}}],__webpack_module_cache__={};function __w_pdfjs_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__w_pdfjs_require__),r.exports}var __webpack_exports__={};return(()=>{var e=__webpack_exports__;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"AbortException",{enumerable:!0,get:function(){return t.AbortException}}),Object.defineProperty(e,"AnnotationEditorLayer",{enumerable:!0,get:function(){return a.AnnotationEditorLayer}}),Object.defineProperty(e,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return t.AnnotationEditorParamsType}}),Object.defineProperty(e,"AnnotationEditorType",{enumerable:!0,get:function(){return t.AnnotationEditorType}}),Object.defineProperty(e,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return s.AnnotationEditorUIManager}}),Object.defineProperty(e,"AnnotationLayer",{enumerable:!0,get:function(){return o.AnnotationLayer}}),Object.defineProperty(e,"AnnotationMode",{enumerable:!0,get:function(){return t.AnnotationMode}}),Object.defineProperty(e,"CMapCompressionType",{enumerable:!0,get:function(){return t.CMapCompressionType}}),Object.defineProperty(e,"FeatureTest",{enumerable:!0,get:function(){return t.FeatureTest}}),Object.defineProperty(e,"GlobalWorkerOptions",{enumerable:!0,get:function(){return l.GlobalWorkerOptions}}),Object.defineProperty(e,"ImageKind",{enumerable:!0,get:function(){return t.ImageKind}}),Object.defineProperty(e,"InvalidPDFException",{enumerable:!0,get:function(){return t.InvalidPDFException}}),Object.defineProperty(e,"MissingPDFException",{enumerable:!0,get:function(){return t.MissingPDFException}}),Object.defineProperty(e,"OPS",{enumerable:!0,get:function(){return t.OPS}}),Object.defineProperty(e,"PDFDataRangeTransport",{enumerable:!0,get:function(){return r.PDFDataRangeTransport}}),Object.defineProperty(e,"PDFDateString",{enumerable:!0,get:function(){return i.PDFDateString}}),Object.defineProperty(e,"PDFWorker",{enumerable:!0,get:function(){return r.PDFWorker}}),Object.defineProperty(e,"PasswordResponses",{enumerable:!0,get:function(){return t.PasswordResponses}}),Object.defineProperty(e,"PermissionFlag",{enumerable:!0,get:function(){return t.PermissionFlag}}),Object.defineProperty(e,"PixelsPerInch",{enumerable:!0,get:function(){return i.PixelsPerInch}}),Object.defineProperty(e,"PromiseCapability",{enumerable:!0,get:function(){return t.PromiseCapability}}),Object.defineProperty(e,"RenderingCancelledException",{enumerable:!0,get:function(){return i.RenderingCancelledException}}),e.SVGGraphics=void 0,Object.defineProperty(e,"UnexpectedResponseException",{enumerable:!0,get:function(){return t.UnexpectedResponseException}}),Object.defineProperty(e,"Util",{enumerable:!0,get:function(){return t.Util}}),Object.defineProperty(e,"VerbosityLevel",{enumerable:!0,get:function(){return t.VerbosityLevel}}),Object.defineProperty(e,"XfaLayer",{enumerable:!0,get:function(){return h.XfaLayer}}),Object.defineProperty(e,"build",{enumerable:!0,get:function(){return r.build}}),Object.defineProperty(e,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return t.createValidAbsoluteUrl}}),Object.defineProperty(e,"getDocument",{enumerable:!0,get:function(){return r.getDocument}}),Object.defineProperty(e,"getFilenameFromUrl",{enumerable:!0,get:function(){return i.getFilenameFromUrl}}),Object.defineProperty(e,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return i.getPdfFilenameFromUrl}}),Object.defineProperty(e,"getXfaPageViewport",{enumerable:!0,get:function(){return i.getXfaPageViewport}}),Object.defineProperty(e,"isDataScheme",{enumerable:!0,get:function(){return i.isDataScheme}}),Object.defineProperty(e,"isPdfFile",{enumerable:!0,get:function(){return i.isPdfFile}}),Object.defineProperty(e,"loadScript",{enumerable:!0,get:function(){return i.loadScript}}),Object.defineProperty(e,"normalizeUnicode",{enumerable:!0,get:function(){return t.normalizeUnicode}}),Object.defineProperty(e,"renderTextLayer",{enumerable:!0,get:function(){return n.renderTextLayer}}),Object.defineProperty(e,"setLayerDimensions",{enumerable:!0,get:function(){return i.setLayerDimensions}}),Object.defineProperty(e,"shadow",{enumerable:!0,get:function(){return t.shadow}}),Object.defineProperty(e,"updateTextLayer",{enumerable:!0,get:function(){return n.updateTextLayer}}),Object.defineProperty(e,"version",{enumerable:!0,get:function(){return r.version}});var t=__w_pdfjs_require__(1),r=__w_pdfjs_require__(2),i=__w_pdfjs_require__(6),n=__w_pdfjs_require__(26),a=__w_pdfjs_require__(27),s=__w_pdfjs_require__(5),o=__w_pdfjs_require__(29),l=__w_pdfjs_require__(14),h=__w_pdfjs_require__(31);let c=__w_pdfjs_require__(34).SVGGraphics;e.SVGGraphics=c})(),__webpack_exports__})(),"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("pdfjs-dist/build/pdf",[],t):"object"==typeof exports?exports["pdfjs-dist/build/pdf"]=t():e["pdfjs-dist/build/pdf"]=e.pdfjsLib=t()}));!function(){if("undefined"!=typeof document&&!document.getElementById("87efd63860b7fffddb9a61e9ba84f3331c5b3d323974c5c14d209ee46aea41bf")){var e=document.createElement("style");e.id="87efd63860b7fffddb9a61e9ba84f3331c5b3d323974c5c14d209ee46aea41bf",e.textContent='@import"https://at.alicdn.com/t/c/font_2809422_kipm6ycaet.css";@import"https://at.alicdn.com/t/c/font_2802048_dc945363jlf.css";.model-layout-switch-bar{position:absolute;bottom:0;width:100%;height:24px;background:#ffffff;opacity:.7;display:flex;font-size:14px;line-height:1;overflow-x:scroll;overflow-y:hidden;z-index:1}.model-layout-switch-bar .model-layout-switch-bar-content{white-space:nowrap}.model-layout-switch-bar .model-layout-switch-bar-content .model-layout-switch-item{position:relative;display:inline-block;padding:3px 10px 0;color:#000;height:22px;cursor:pointer;transform:translate(0)}.model-layout-switch-bar .model-layout-switch-bar-content .model-layout-switch-item:before{content:"";position:absolute;inset:0;z-index:-1;background:#fff;border:1px solid #000;border-top:0px}.model-layout-switch-bar .model-layout-switch-bar-content .model-layout-switch-item:hover{color:#8080f0}.model-layout-switch-bar .model-layout-switch-bar-content .model-layout-switch-item:nth-child(n+2){margin-left:-1px}.model-layout-switch-bar .model-layout-switch-bar-content .model-layout-switch-item.activate{color:#fff!important}.model-layout-switch-bar .model-layout-switch-bar-content .model-layout-switch-item.activate:before{background:#212830!important}.model-layout-switch-bar.hidden{display:none}.model-layout-switch-bar::-webkit-scrollbar{display:none}.pop-panel{z-index:99999999;top:calc(70% - 100px);left:calc(90% - 160px);position:absolute;background:#ffffff;color:#333;border-radius:4px;width:160px;box-shadow:0 12px 48px 16px #00000008,0 9px 28px #0000000d,0 6px 16px -8px #00000014}.pop-panel .pop-panel-header{font-size:16px;font-weight:bolder;padding:16px 24px 8px;color:#333;border-bottom:1px solid #EFEFEF;cursor:move;user-select:none}.pop-panel .pop-panel-body{display:flex;flex-direction:row;justify-content:space-between;align-items:center;padding:16px 24px}.pop-panel .pop-panel-body .pop-panel-item{display:inline-block;cursor:pointer;margin-right:16px;font-size:16px}.pop-panel .pop-panel-body .pop-panel-item .x-viewer-icon{font-size:24px}.pop-panel .pop-panel-body .pop-panel-item:last-child{margin-right:0}.pop-panel .pop-panel-body .pop-panel-item:hover,.pop-panel .pop-panel-body .pop-panel-item.active{color:#2c7be5}.pop-panel .pop-panel-body .pop-panel-item.disable{color:#999;cursor:not-allowed}.follow-tooltip{z-index:99999999;position:absolute;left:-500px;padding:6px;background:rgba(25,25,25,.3);color:#fffc;font-size:12px;border-radius:2px}#axisGizmo{width:100px;height:100px;position:absolute;display:block;bottom:1px;left:10px;background:#ffffff00}.bottom-bar{position:absolute;bottom:0;right:0;display:flex;color:#666;z-index:3;overflow:hidden;user-select:none}.bottom-bar i{font-size:18px;padding:3px;align-self:center;opacity:.4;cursor:pointer;line-height:1}.bottom-bar i:hover,.bottom-bar i.active{color:#2c7be5;opacity:1}.bottom-bar .fps{width:4rem}.bottom-bar span{align-self:center;padding:4px;font-size:14px}#x-viewer-threejs-statistics-tooltip,#x-viewer-threejs-tips-tooltip,#x-viewer-threejs-cameraCfg-tooltip{position:absolute;right:5px;bottom:30px;background:#666666;color:#fff;padding:8px 8px 5px;font-size:.8rem;border-radius:4px;z-index:3;opacity:.9;user-select:none}#x-viewer-threejs-statistics-tooltip p,#x-viewer-threejs-tips-tooltip p,#x-viewer-threejs-cameraCfg-tooltip p{padding-bottom:3px;margin:3px}#x-viewer-threejs-statistics-tooltip p span,#x-viewer-threejs-tips-tooltip p span,#x-viewer-threejs-cameraCfg-tooltip p span{float:left;margin-right:10px}.layer-manager{position:absolute;top:30px;left:20px;width:330px;height:600px;max-height:90%;border-radius:4px;box-shadow:1px 3px 10px #0006;background-color:#ffffffe6;color:#000;z-index:2;overflow:hidden;user-select:none}.layer-manager:hover{background-color:#fffffff2}.layer-manager input[type=checkbox]{width:16px;height:16px;cursor:pointer}.layer-manager input[type=color]{width:30px;height:16px;border:0;padding:0;background-color:#0000;overflow:hidden}.layer-manager ::-webkit-color-swatch{position:relative;margin-top:-5px;width:40px;height:16px}.layer-manager .header{display:flex;align-items:center;padding-left:6px;width:100%;height:40px;border-bottom:1px solid #ccc;cursor:move;font-size:16px}.layer-manager .header .close{position:absolute;right:8px;cursor:pointer;padding:10px}.layer-manager .header .close:hover{font-weight:700}.layer-manager .layer-list{width:100%;height:calc(100% - 40px);padding:0;margin:0;border-bottom:1px solid #ccc;overflow-y:scroll}.layer-manager .layer-list-item{display:flex;align-items:center;padding:6px;border-bottom:1px solid #ccc;white-space:nowrap}.layer-manager .layer-list-item:hover{background-color:#f0f8ff}.layer-manager .popup-layer-color{display:inline-block;margin-left:5px;width:20px;font-size:12px}.layer-manager .item-color{margin-left:8px;font-size:12px;border:1px solid black;width:18px;height:16px;min-width:18px}.layer-manager .item-layer-name{display:inline-block;margin-left:10px;padding:1px 0;width:280px;font-size:12px;text-overflow:ellipsis;overflow:hidden}.layer-manager .popup-freeze{margin-right:5px;color:#ccc;font-size:12px;width:50px}#navCube{width:135px;height:135px;position:absolute;bottom:10px;right:10px;z-index:1;pointer-events:none;cursor:pointer}#navCube:hover{opacity:1}.css3d-navcube .navcube-plane{backface-visibility:hidden;z-index:1;transition:all .2s}.css3d-navcube .navcube-plane.outer{opacity:.7;background:linear-gradient(-45deg,transparent 15px,#efefef 0) bottom right,linear-gradient(-135deg,transparent 15px,#efefef 0) top right,linear-gradient(135deg,transparent 15px,#efefef 0) top left,linear-gradient(45deg,transparent 15px,#efefef 0) bottom left;background-size:70% 70%;background-repeat:no-repeat}.css3d-navcube .navcube-plane.inner{margin:2px;font-size:30px;text-align:center;line-height:100px;background:linear-gradient(-45deg,transparent 14px,#2c7be5 0) bottom right,linear-gradient(-135deg,transparent 14px,#2c7be5 0) top right,linear-gradient(135deg,transparent 14px,#2c7be5 0) top left,linear-gradient(45deg,transparent 14px,#2c7be5 0) bottom left;background-size:70% 70%;background-repeat:no-repeat}.css3d-navcube .navcube-plane:hover{opacity:1!important}.css3d-navcube .navcube-edge{opacity:0;z-index:2;transition:all .2s}.css3d-navcube .navcube-edge:hover{opacity:1!important}.css3d-navcube .navcube-corner{opacity:.7;backface-visibility:hidden;box-sizing:content-box;transform-origin:50% 33%;top:4px;z-index:3;transition:all .2s}.css3d-navcube .navcube-corner-plane{opacity:0;backface-visibility:hidden;transform-origin:bottom;top:-6.5px;z-index:3;transition:all .2s}.css3d-navcube .highlight{opacity:1}#x-viewer-overview-map{width:200px;height:200px;top:10px;left:10px;position:absolute;z-index:1;border:1px #50505090 solid;background-color:#80808030}.statsOutput{position:absolute;opacity:.6;top:1px;left:1px}.toolbar{position:absolute;display:flex;box-sizing:border-box;height:68px;left:50%;bottom:40px;padding:8px 20px;box-shadow:1px 3px 10px #0006;border-radius:4px;background:rgba(255,255,255,.8);transform:translate(-50%);align-items:center;z-index:10;user-select:none}.toolbar .toolbar-group{display:flex;padding:0 2px;box-sizing:border-box}.toolbar .toolbar-group-division{width:1px;background-color:#999c;height:60%}.toolbar .toolbar-menu{display:flex;box-sizing:border-box;flex-direction:column;word-break:break-word;width:50px;height:50px;padding:3px 1px;margin:0 2px;transition:all .3s;cursor:pointer;color:#666;border-radius:4px}.toolbar .toolbar-menu.active{color:#2c7be5}.toolbar .toolbar-menu .icon{width:24px;height:24px;margin:auto;font-size:24px;line-height:normal}.toolbar .toolbar-menu span{display:block;width:100%;margin:auto;font-size:12px;text-align:center;user-select:none}.toolbar .toolbar-menu-active{color:#2c7be5;background-color:#fffc}.toolbar .toolbar-parent-menu{position:relative}.toolbar .toolbar-parent-menu-active .toolbar-sub-menu{display:block}.toolbar .toolbar-parent-menu-active .toolbar-sub-menu-list{background:rgba(255,255,255,.8)}.toolbar .toolbar-parent-menu:after{content:"";position:absolute;box-sizing:border-box;width:0;height:0;right:2px;top:2px;border-width:4px;border-style:solid;border-top-color:#666;border-right-color:#666;border-bottom-color:transparent;border-left-color:transparent;border-radius:1px}.toolbar .toolbar-sub-menu{display:none;position:absolute;min-width:50px;bottom:100%;box-shadow:1px 3px 10px #0006}.toolbar .toolbar-sub-menu .toolbar-sub-menu-list{margin-bottom:2px;border-radius:4px}.toolbar .toolbar-sub-menu .toolbar-sub-menu-list .toolbar-menu{margin:0}@media screen and (max-width:768px){.toolbar .toolbar-menu{width:30px;height:30px;margin:0}.toolbar .toolbar-menu .icon+span{display:none}.toolbar .toolbar-parent-menu:after{top:1px;right:0}.toolbar .toolbar-sub-menu{min-width:30px}}#x-viewer-viewCube{width:150px;height:150px;position:absolute;bottom:10px;right:10px;z-index:1}.context-menu{position:absolute;box-sizing:border-box;background-color:#fff;width:200px;padding:2px;border-radius:2px;box-shadow:0 4px 8px #0003,0 6px 20px #00000030;cursor:pointer;z-index:2}.context-menu ul{list-style:none;padding:0}.context-menu ul:last-child li{border-bottom:0px}.context-menu li{height:2rem;padding:.5rem;box-sizing:border-box}.context-menu li:hover{background-color:#d3d3d3}.context-menu li.disabled{color:#ccc;cursor:not-allowed}.context-menu li:last-child{border-bottom:1px solid #000}.progress-bar{z-index:3;bottom:20%;left:25%;position:absolute;color:#ffffffa0;width:50%;user-select:none;font-size:14px}.progress-bar.hidden{display:none}.progress-bar .progress-bar-item{width:100%;text-align:center;padding:2px}.x-spinner{display:flex;flex-flow:row nowrap;align-items:center;justify-content:space-between;width:2em;position:absolute;pointer-events:none;top:50%;left:50%;transform:translate(-50%,-50%);font-size:14px}.x-spinner.hidden{display:none}.x-spinner span{width:.3em;height:1em;background-color:#3cefff}.x-spinner span:nth-of-type(1){animation:grow 1s -.45s ease-in-out infinite}.x-spinner span:nth-of-type(2){animation:grow 1s -.3s ease-in-out infinite}.x-spinner span:nth-of-type(3){animation:grow 1s -.15s ease-in-out infinite}.x-spinner span:nth-of-type(4){animation:grow 1s ease-in-out infinite}@keyframes grow{0%,to{transform:scaleY(1)}50%{transform:scaleY(2)}}.anchor{position:absolute;top:0;left:0;opacity:0;width:20px;height:20px;transform:translate(-50%,-50%);pointer-events:none;user-select:none;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAAXNSR0IArs4c6QAADjRJREFUeF7tXQnQttUYvq4Zxr5MqBgaihRlKakUU7SYSBQljUhaxijtso2MTCrRn8YoldKIUlIIJRplSyKyqzGyJDSDLGHmMtfvvOb19n7fe7Zn+/7nnnnn+/7/O8t9zrne+5xzn3sh1hCS9GUA20UO9xqS20eWHXQxDpr7BOZHAMyfrBEA8+dllAAJX65BFB0lwCgBxjPAHAyMW8C4BQxCghczOW4B4xYwbgHjFjDqAWYxMJ4BxjNA8fY6iAbGM8B4BhjPAGvKGUDSYwA8FcAmAJ4EYOPw8/6R4upvAH4I4Efh580AbiJ5W2T9wRRbEWcASTuFBX/a1KLfq/Iq/HsKDN8NgLiych+tNzdYAEh6JoAXAdgtLHrrkwfAkuEyAJeTvL4LBkr7HBQAJK0fFtwLH/u0WzpHsfWvMRAMCJK3xlbqutwgACDplVMLf++uJ21B//+aAsL5PecVvQaApB0BHA3AP4dIVwE4maR/9pJ6CYBwij8GwOt7OWvpTJ0O4KQ+3iJ6BwBJXnQvvq9yK4l8hTQIDIbeUG8AsALEfeyi9mpb6AUAJL0bwBtjZ3CFlDuR5LFdj6VzAEi6EMCeXU9ER/1fRHKvjvpe3W1nAJC0NoDPAnhGwxNwF4DbZz6/m/q3u183fNaZ+n3yfw9smL8bALyA5B0N9zO3+U4AIMmL/gUAazU0aKtor/CH5M9K+pD0BAC7hI9Vzk3QnQB2JmkwtEqtA0DS7gAuqTxKn7C96F8EcBXJP1Zuf3Vzkh4WdBI7ADAYat9U9iD5ySZ4X6rNVgEg6TAA76s4wKsBnBa+6X6saY0k+bHJkuFQAM+r2PHhJE+t2N6yTbUGAEkHADiz0sBu8sKTPKdSe0XNSHpNAIKfoGvQgSQ/VKOhRW20AoDwcvfNRcxE/P034Rvvxf97RPnWiki6XwCBJcKjKnS8ZRsvjI0DILzg3VI4IX5gsahf1Ud16vTYghr7DQEMpQ9XGzT9stgoACQ9BMD3Cw9LlhyvI3ljIYharS5pMwAfALBlQcc+3G5K8k8FbXR3BpDkE+1LCpj3+/o+JH2XHxxJsg7ho8FwJZf/S0n65tQINSYBJH0QwEEFXJ9F0gfHwZMkH+heWzCQM0geXFB/yaqNAEDS8QDeUsDwsSRPLKjfu6qS/NbhN49cehfJt+ZWXqpedQCEV70SY8ltSX619kD70J6kbQBcV8DLTrWNS5oAgBc/y4KHZHV+Cia7saqSlNm4tZxV1dFVJzwYc7w/c3BPJPnTzLqDqiZpQwA/yWT6kJpGJdUAEO6/Ft05+vFdSX4mc0IGWU3SCwF8OoN5Xw23qaUPqQkAf/NzbPiOJPnejIkYfBVJRwA4JWMgp5M8JKPePapUAUDBwa+x602NyWmjjYLrcpUDYS0A5Bz87Ky5C8l/tDHRs31IesTUdnUbyd93xMd9g+1CalzCKgfCYgAEp42PJE6edftbtaXeDWrZ59ryJiz6owHcZ4bnuwH8CoD3WFsqfall/r4BIPXtYF+SRc4nNQBwMYA9EgFwCsmjEuskFZe0c7A1tAuZXcpyyC5edvmy7Z4tmBojSe8BcGRiB5eQfGlinf8rXgSA8NL340Tk+knX3/5GXK0l+U3ehievLpmYOXXPBXAqSdsiVKdwi7IUSHlKtiTdqOTFsBQAhwNIPcE3ouaVZN9/q0q9+H6bb4Jsg2BrneNJOoZAVcpUFx9BMtvKqhQAKVE3PFn+9mxd25hD0tMB+PHJLuNtkF3BDyb5nZqdBaOSr4dYB7FNF4W1zQZAppXP/rXNuCS9HMDHYmercrm9SX68ZpvBvOzsxDazrYdKAJD64nc1SVvTViNJbwdwXLUG8xo6juQ78qrOryXJ1s0phqbZL4UlALClj2PwxNJuJG3gUYXCKf/zVRorb+RZJC26q5AkB8Bw5JFYupnkprGFp8tlASBD8/dbAOuRrGK6XeFZNWeuFtV5HMlfLCoU8/dgcv5LAI+MKR/KZGkGcwHg+6rvrbF0Acl9YgsvVy5c8+z1k3JdqtH1ojasDfWj1j8XFYz5uySbkr0ipmwocxTJ5HeFXAD4TvyqBOaq2blL8jaya0LfbRY9geSba3SY4UdxHslk3UcuAL4NwFavsbRODefHgifUWD5Ly1lP4GtusbIoOM/aiTWWbiS5eWzhSblkAEiy6PVeF6u3vpbkc1IZm1e+59/+Ccvnktyv0ni/AuDZkW1ZK/hYkta0RlMOAGySlKIXr6L5G8C3f3rSn1/j7SBDM2gP4yR7zBwApKp/Nybp94IiknQBgL2LGmmvctZ+PMuepI1CuNpYzpPVwjkAsJbKzpAxdBfJB8UUXK6MJLfxawDFbZXyElnf9gXrRZZdtpikvwCIDVJxDsn9U/rNAYBdtWJ17j8n6QALRSRpXwDnFTXSfuUqyiFJDnDx+Ej2ryeZ5IrGEEc/sv3VxbYA8IDICteRjD3ELNlkBRezSHarFnsbSavLi0jStQC2jWzkrwC+FVl2dTEDINdGPaafi0m+LKbggi2gSR5L2VuqftEr3aRRSZ8AUGT0sdwAmwZAsfWqpAcDaMw7tqnVB3ALyVjRvZz0y7W2jhpa0wAoFoOSbL/XiPVQ1AzlF7qbpA0+i0iSjVzeWdTIMpWbBsABJM8qYV6SM378oKSNDuuuXWptLMlexY2Fi2kaAMUeP5K2BvC1DhexpOvNSy2Lm1aAjQAoWd7Fddd4AIxbQKHDydC3gPEQuFhKLFti6IfA8RpYDoBBXwNHRVA5ABpXBNm2P4X8DhCbgLGWKjjVPCplPE2VPZpkitncXD4SVcF2VklKX5fzGGRdc2yI91qPQQ4112oQ5QqoKL4BmIfEx6AbSPqtJppyAGBPYKdxi6Faz8F+DrXnrgNPDoFuJblBDUYTn4PPJ+mX02jKAYDTnJwQ3QOwYWnM/vBNSAFeAnuNFE1+l5/HRchVkBI36U0kk0LR5QAgNbbNYSRXlU5z0xqxUv5m6tcyCXPM4ZTQ8cma1xwAOAiU/eZjkzNfSdK++sW0BhqF2vYyNiycnW7WT3W7TwZAEMc2e35Kwoo+vEYWjwFIgZpm4c5O8oeEOf4eyeR8BbkASL2WVfOi7bkUqOkYkur1nOV9lQsA5/M9KQGdZ5MsCZb8v64kbQXgcwAemtB/G0V9/96+VuAISX5GTzHwPIbkyakDzQVAqm+ADTq8P9VyDrXPnKVQn2izWgEjgnOoz1kpQTeTfQI8eVkACOeArt3DHSjRWUT6QNW2uDC3/XYPD0yOASL+C701NkCE3wRSE0E1ESLGV8yuAkVUue9Pi7DBhIgJUqAvQaIch/+iFmMG2AFzz9p5DQYVJCoAINVP0NWqOIvObvwhcIStZ5uOHeAI3zZ0KXYBnzOGnKwiyf6A0/1mHwIDAByBs2+BIq2qPrABIHjhz2wqrP0gA0UGEPQ1VKyB4Ouif+Y6ldox03kMrGRpNJ/BIEPFBgD4abi3waKDZ7HtCV6ckMLuUgCfAuCUbQZBoxSCWQ8zWHQAQU64eN8gdmg7J2BwNbO7mT8T+wK7nv3ZH5L+2RqF3IKOC5jk1RuypMc+FC05nqIzwKTVjLBxk6qXk9yttdnuYUeSHA/Qip9UygoLN9tJFQAEKZBrvbpiEkSmrmBBQslia+sJrzUBYL11btKoRq6GqQvSZvmM+D8T9vqZNCpIASeNyk0bt2ITRs6575ckkOxn2rip80DOgXB19TFx5EIZVCVP0HQv1baACgfCSRMrNoFkYcJIz0+Vg1+jAAhbgS1TrdbMpWTjxtyO2qpXwZztRJK2yK5K1SXAlCS4MCRtymV4xSSULEgQOZk7J63aK3cil6vXGACCJEjxIprH5xnOAdRVbsHSCZfkEDE26z6ooK1kb5+UvpoGwNoh0uVaKUzNlPWTs0Oh31jQRutVg3rXvoGpCSGneb0TgCOt3tHUABoFQJAC9iNMil03Z7AOhGzzr1Wpdu9NTdxS7YZXPTt0HJoQUHup5rYgeUOTY2gcAAEEuwO4pMJAbIhhIJxWO/NYKW/BmMOL7k+NZBZ7kGzcIbYVAAQQOJ9fdn67mQWyMYZBcE7pwtWoH8y4vPDJjhlL9H84yRSXsOxhtAaAAIIDbFSRze09K14dJMIVtUzOY3kLptu7hG98SoavRV1Uy66yqCP/vVUABBDkGJMuGouTUvmw6Dy/lzV1aApZPPx66XzEPtylJHVaNAb/PTv/X0zj88q0DoAAApuSebFSHB9SxugAy84AbjAU5SoIMfu96M48Xhz4eolB+IFnu5IcwCmTM122EwAEENgY48MJVjq5Y7wLwO0zH+fimfyf2103fNaZ+n3yf7Gx+nP5s/XRfiQ7iYfcGQAmsyXJOX9LFCW5E9+HemeQPLhLRjoHQJAGqV5GXc5Zrb6z073WYqCTQ+BSzAezMnsd71hzgD1s6yoAJ5P0z86pFxJgehYk2ajkmAYPiF1Nug96J5E8vSsGenMLWDQBQZ1qEBgMK4G86F783uU96J0EmJEG3g6GvC30StwPRgLMMirJzie+i9t8OjZjaVeSww9Xzm9sHcT5XTER22+vJcAcIFiBNAGCtXF9Iiu2Jgvv6B6DoEEBYGZ7sErZEsGA2KSj2b7Z33QvPMmkGL0d8XuPbgcLgDlnBYet23TqU3ursGh3WJzJx2HZenGVKwHTigDAnK3C7/GWCk8OPye/xya8dAJGJ6ryN9yf1b+nZuYuWZi26q5IAMybvJAhNfbcUCXpY1uLWNLPCID5szcCoARVfaw7SoD5qzJKgFEC9PH7Wp+nUQKMEiAlpN14Bqj/Hey2xVECjBJglABzMDAeAsdDYLeiua3exy1g3ALGLWDcAlY7dMTQGnML+A8qtnUcTFYqYAAAAABJRU5ErkJggg==) no-repeat center center;background-size:100% 100%;background-blend-mode:lighten;filter:invert(61%) sepia(87%) saturate(845%) hue-rotate(120deg) brightness(94%) contrast(101%);transition:opacity .5s ease-in-out}.anchor.active{opacity:1}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(360deg)}}\n',document.head.appendChild(e)}}();var SDe=fetch;window.fetch=(...e)=>Promise.resolve(SDe(...e));var y1r=ra(DX(),1),b1r=ra(Pme(),1),x1r=ra(Ime(),1),Kt={};fX(Kt,{ACESFilmicToneMapping:()=>D0e,AddEquation:()=>jo,AddOperation:()=>C0e,AdditiveAnimationBlendMode:()=>Y4,AdditiveBlending:()=>du,AlphaFormat:()=>N0e,AlwaysCompare:()=>Q0e,AlwaysDepth:()=>_0e,AlwaysStencilFunc:()=>H6,AmbientLight:()=>$o,AnimationAction:()=>H2,AnimationClip:()=>Yo,AnimationLoader:()=>p4,AnimationMixer:()=>M4,AnimationObjectGroup:()=>S4,AnimationUtils:()=>Uyt,ArcCurve:()=>Ng,ArrayCamera:()=>y2,ArrowHelper:()=>yu,AttachedBindMode:()=>g6,Audio:()=>N2,AudioAnalyser:()=>T4,AudioContext:()=>V_,AudioListener:()=>E4,AudioLoader:()=>b4,AxesHelper:()=>H4,BackSide:()=>ws,BasicDepthPacking:()=>j0e,BasicShadowMap:()=>wft,BatchedMesh:()=>E2,Bone:()=>cc,BooleanKeyframeTrack:()=>Qd,Box2:()=>ts,Box3:()=>Vt,Box3Helper:()=>N4,BoxGeometry:()=>lc,BoxHelper:()=>B4,BufferAttribute:()=>fr,BufferGeometry:()=>Nt,BufferGeometryLoader:()=>n1,ByteType:()=>F0e,Cache:()=>Gg,Camera:()=>kg,CameraHelper:()=>s1,CanvasTexture:()=>Zd,CapsuleGeometry:()=>Wy,CatmullRomCurve3:()=>_2,CineonToneMapping:()=>O0e,CircleGeometry:()=>Xy,ClampToEdgeWrapping:()=>pi,Clock:()=>mc,Color:()=>dt,ColorKeyframeTrack:()=>F_,ColorManagement:()=>vi,CompressedArrayTexture:()=>l4,CompressedCubeTexture:()=>c4,CompressedTexture:()=>bh,CompressedTextureLoader:()=>B_,ConeGeometry:()=>Yy,ConstantAlphaFactor:()=>b0e,ConstantColorFactor:()=>v0e,CubeCamera:()=>g2,CubeReflectionMapping:()=>qd,CubeRefractionMapping:()=>xp,CubeTexture:()=>Fg,CubeTextureLoader:()=>N_,CubeUVReflectionMapping:()=>c1,CubicBezierCurve:()=>R_,CubicBezierCurve3:()=>T2,CubicInterpolant:()=>O2,CullFaceBack:()=>h6,CullFaceFront:()=>l0e,CullFaceFrontBack:()=>Tft,CullFaceNone:()=>o0e,Curve:()=>To,CurvePath:()=>M2,CustomBlending:()=>Yg,CustomToneMapping:()=>L0e,CylinderGeometry:()=>gu,Cylindrical:()=>I4,Data3DTexture:()=>w_,DataArrayTexture:()=>Vy,DataTexture:()=>_o,DataTextureLoader:()=>tf,DataUtils:()=>nf,DecrementStencilOp:()=>Dft,DecrementWrapStencilOp:()=>kft,DefaultLoadingManager:()=>Zo,DepthFormat:()=>bp,DepthStencilFormat:()=>pu,DepthTexture:()=>Xd,DetachedBindMode:()=>k0e,DirectionalLight:()=>ya,DirectionalLightHelper:()=>i1,DiscreteInterpolant:()=>D2,DisplayP3ColorSpace:()=>X2,DodecahedronGeometry:()=>$y,DoubleSide:()=>ln,DstAlphaFactor:()=>o1,DstColorFactor:()=>l1,DynamicCopyUsage:()=>Zft,DynamicDrawUsage:()=>qft,DynamicReadUsage:()=>Xft,EdgesGeometry:()=>_h,EllipseCurve:()=>Kd,EqualCompare:()=>$0e,EqualDepth:()=>w0e,EqualStencilFunc:()=>Uft,EquirectangularReflectionMapping:()=>Og,EquirectangularRefractionMapping:()=>p_,Euler:()=>tn,EventDispatcher:()=>mu,ExtrudeGeometry:()=>va,FileLoader:()=>Hn,Float16BufferAttribute:()=>$6,Float32BufferAttribute:()=>zt,Float64BufferAttribute:()=>Z6,FloatType:()=>Us,Fog:()=>vh,FogExp2:()=>Gy,FramebufferTexture:()=>o4,FrontSide:()=>zi,Frustum:()=>Ml,GLBufferAttribute:()=>C4,GLSL1:()=>Jft,GLSL3:()=>V6,GreaterCompare:()=>Z0e,GreaterDepth:()=>M0e,GreaterEqualCompare:()=>J0e,GreaterEqualDepth:()=>S0e,GreaterEqualStencilFunc:()=>Gft,GreaterStencilFunc:()=>Vft,GridHelper:()=>z_,Group:()=>Xr,HalfFloatType:()=>Cn,HemisphereLight:()=>Mh,HemisphereLightHelper:()=>k4,IcosahedronGeometry:()=>Zy,ImageBitmapLoader:()=>H_,ImageLoader:()=>qg,ImageUtils:()=>T_,IncrementStencilOp:()=>Oft,IncrementWrapStencilOp:()=>Lft,InstancedBufferAttribute:()=>Ja,InstancedBufferGeometry:()=>B2,InstancedInterleavedBuffer:()=>R4,InstancedMesh:()=>ls,Int16BufferAttribute:()=>Y6,Int32BufferAttribute:()=>Lg,Int8BufferAttribute:()=>W6,IntType:()=>z4,InterleavedBuffer:()=>$d,InterleavedBufferAttribute:()=>Xo,Interpolant:()=>Jd,InterpolateDiscrete:()=>jd,InterpolateLinear:()=>gh,InterpolateSmooth:()=>u2,InvertStencilOp:()=>Fft,KeepStencilOp:()=>wg,KeyframeTrack:()=>Rl,LOD:()=>x2,LatheGeometry:()=>Hg,Layers:()=>Ep,LessCompare:()=>Y0e,LessDepth:()=>T0e,LessEqualCompare:()=>K4,LessEqualDepth:()=>f_,LessEqualStencilFunc:()=>Hft,LessStencilFunc:()=>Nft,Light:()=>fc,LightProbe:()=>F2,Line:()=>jn,Line3:()=>La,LineBasicMaterial:()=>Yr,LineCurve:()=>C_,LineCurve3:()=>w2,LineDashedMaterial:()=>wh,LineLoop:()=>jy,LineSegments:()=>Wn,LinearDisplayP3ColorSpace:()=>W_,LinearEncoding:()=>Z4,LinearFilter:()=>wn,LinearInterpolant:()=>k_,LinearMipMapLinearFilter:()=>Cft,LinearMipMapNearestFilter:()=>Rft,LinearMipmapLinearFilter:()=>ia,LinearMipmapNearestFilter:()=>rf,LinearSRGBColorSpace:()=>Hi,LinearToneMapping:()=>P0e,LinearTransfer:()=>y_,Loader:()=>Mn,LoaderUtils:()=>oa,LoadingManager:()=>Sh,LoopOnce:()=>z0e,LoopPingPong:()=>q0e,LoopRepeat:()=>G0e,LuminanceAlphaFormat:()=>U0e,LuminanceFormat:()=>q2,MOUSE:()=>Eft,Material:()=>qn,MaterialLoader:()=>r1,MathUtils:()=>Tr,Matrix3:()=>Wr,Matrix4:()=>lt,MaxEquation:()=>m6,Mesh:()=>Ht,MeshBasicMaterial:()=>Mr,MeshDepthMaterial:()=>Yd,MeshDistanceMaterial:()=>A_,MeshLambertMaterial:()=>Th,MeshMatcapMaterial:()=>I2,MeshNormalMaterial:()=>Tp,MeshPhongMaterial:()=>Da,MeshPhysicalMaterial:()=>Qa,MeshStandardMaterial:()=>Ss,MeshToonMaterial:()=>P2,MinEquation:()=>p6,MirroredRepeatWrapping:()=>fu,MixOperation:()=>R0e,MultiplyBlending:()=>f6,MultiplyOperation:()=>G_,NearestFilter:()=>ni,NearestMipMapLinearFilter:()=>Aft,NearestMipMapNearestFilter:()=>Mft,NearestMipmapLinearFilter:()=>hu,NearestMipmapNearestFilter:()=>mh,NeverCompare:()=>X0e,NeverDepth:()=>E0e,NeverStencilFunc:()=>Bft,NoBlending:()=>Oi,NoColorSpace:()=>Oa,NoToneMapping:()=>Gd,NormalAnimationBlendMode:()=>j2,NormalBlending:()=>Pg,NotEqualCompare:()=>K0e,NotEqualDepth:()=>A0e,NotEqualStencilFunc:()=>zft,NumberKeyframeTrack:()=>dc,Object3D:()=>yr,ObjectLoader:()=>y4,ObjectSpaceNormalMap:()=>W0e,OctahedronGeometry:()=>zg,OneFactor:()=>h0e,OneMinusConstantAlphaFactor:()=>x0e,OneMinusConstantColorFactor:()=>y0e,OneMinusDstAlphaFactor:()=>p0e,OneMinusDstColorFactor:()=>m0e,OneMinusSrcAlphaFactor:()=>d2,OneMinusSrcColorFactor:()=>f0e,OrthographicCamera:()=>Gi,P3Primaries:()=>x_,PCFShadowMap:()=>V4,PCFSoftShadowMap:()=>a1,PMREMGenerator:()=>Wd,Path:()=>xh,PerspectiveCamera:()=>ci,Plane:()=>ii,PlaneGeometry:()=>vs,PlaneHelper:()=>U4,PointLight:()=>Cl,PointLightHelper:()=>L4,Points:()=>Di,PointsMaterial:()=>Ai,PolarGridHelper:()=>F4,PolyhedronGeometry:()=>Eh,PositionalAudio:()=>_4,PropertyBinding:()=>hn,PropertyMixer:()=>U2,QuadraticBezierCurve:()=>P_,QuadraticBezierCurve3:()=>I_,Quaternion:()=>dn,QuaternionKeyframeTrack:()=>eo,QuaternionLinearInterpolant:()=>L2,RED_GREEN_RGTC2_Format:()=>N6,RED_RGTC1_Format:()=>V0e,REVISION:()=>V2,RGBADepthPacking:()=>W2,RGBAFormat:()=>gs,RGBAIntegerFormat:()=>X4,RGBA_ASTC_10x10_Format:()=>L6,RGBA_ASTC_10x5_Format:()=>I6,RGBA_ASTC_10x6_Format:()=>O6,RGBA_ASTC_10x8_Format:()=>D6,RGBA_ASTC_12x10_Format:()=>k6,RGBA_ASTC_12x12_Format:()=>F6,RGBA_ASTC_4x4_Format:()=>T6,RGBA_ASTC_5x4_Format:()=>w6,RGBA_ASTC_5x5_Format:()=>S6,RGBA_ASTC_6x5_Format:()=>M6,RGBA_ASTC_6x6_Format:()=>A6,RGBA_ASTC_8x5_Format:()=>R6,RGBA_ASTC_8x6_Format:()=>C6,RGBA_ASTC_8x8_Format:()=>P6,RGBA_BPTC_Format:()=>c2,RGBA_ETC2_EAC_Format:()=>_6,RGBA_PVRTC_2BPPV1_Format:()=>x6,RGBA_PVRTC_4BPPV1_Format:()=>b6,RGBA_S3TC_DXT1_Format:()=>l2,RGBA_S3TC_DXT3_Format:()=>ky,RGBA_S3TC_DXT5_Format:()=>Fy,RGB_BPTC_SIGNED_Format:()=>m_,RGB_BPTC_UNSIGNED_Format:()=>g_,RGB_ETC1_Format:()=>q_,RGB_ETC2_Format:()=>E6,RGB_PVRTC_2BPPV1_Format:()=>y6,RGB_PVRTC_4BPPV1_Format:()=>v6,RGB_S3TC_DXT1_Format:()=>Ly,RGFormat:()=>H0e,RGIntegerFormat:()=>W4,RawShaderMaterial:()=>C2,Ray:()=>Za,Raycaster:()=>vu,Rec709Primaries:()=>b_,RectAreaLight:()=>t1,RedFormat:()=>u1,RedIntegerFormat:()=>j4,ReinhardToneMapping:()=>I0e,RenderTarget:()=>m2,RepeatWrapping:()=>ui,ReplaceStencilOp:()=>Ift,ReverseSubtractEquation:()=>u0e,RingGeometry:()=>Ky,SIGNED_RED_GREEN_RGTC2_Format:()=>U6,SIGNED_RED_RGTC1_Format:()=>B6,SRGBColorSpace:()=>Zr,SRGBTransfer:()=>es,Scene:()=>Xi,ShaderChunk:()=>zr,ShaderLib:()=>Ia,ShaderMaterial:()=>xr,ShadowMaterial:()=>R2,Shape:()=>Ys,ShapeGeometry:()=>hc,ShapePath:()=>Xg,ShapeUtils:()=>$s,ShortType:()=>B0e,Skeleton:()=>uc,SkeletonHelper:()=>D4,SkinnedMesh:()=>yh,Source:()=>uu,Sphere:()=>Sn,SphereGeometry:()=>Al,Spherical:()=>Wg,SphericalHarmonics3:()=>k2,SplineCurve:()=>Ug,SpotLight:()=>pc,SpotLightHelper:()=>O4,Sprite:()=>qy,SpriteMaterial:()=>Bg,SrcAlphaFactor:()=>h2,SrcAlphaSaturateFactor:()=>g0e,SrcColorFactor:()=>d0e,StaticCopyUsage:()=>$ft,StaticDrawUsage:()=>E_,StaticReadUsage:()=>Wft,StereoCamera:()=>x4,StreamCopyUsage:()=>Kft,StreamDrawUsage:()=>jft,StreamReadUsage:()=>Yft,StringKeyframeTrack:()=>ef,SubtractEquation:()=>c0e,SubtractiveBlending:()=>d6,TOUCH:()=>_ft,TangentSpaceNormalMap:()=>Sp,TetrahedronGeometry:()=>Jy,Texture:()=>bi,TextureLoader:()=>Ds,TorusGeometry:()=>_p,TorusKnotGeometry:()=>Qy,Triangle:()=>yi,TriangleFanDrawMode:()=>h1,TriangleStripDrawMode:()=>j_,TrianglesDrawMode:()=>$4,TubeGeometry:()=>e1,TwoPassDoubleSide:()=>Sft,UVMapping:()=>z2,Uint16BufferAttribute:()=>Dg,Uint32BufferAttribute:()=>M_,Uint8BufferAttribute:()=>S_,Uint8ClampedBufferAttribute:()=>X6,Uniform:()=>jg,UniformsGroup:()=>A4,UniformsLib:()=>hr,UniformsUtils:()=>xi,UnsignedByteType:()=>wl,UnsignedInt248Type:()=>oc,UnsignedIntType:()=>zd,UnsignedShort4444Type:()=>G4,UnsignedShort5551Type:()=>q4,UnsignedShortType:()=>G2,VSMShadowMap:()=>fh,Vector2:()=>Te,Vector3:()=>F,Vector4:()=>Fn,VectorKeyframeTrack:()=>wo,VideoTexture:()=>a4,WebGL1Renderer:()=>b2,WebGL3DRenderTarget:()=>q6,WebGLArrayRenderTarget:()=>G6,WebGLCoordinateSystem:()=>cu,WebGLCubeRenderTarget:()=>v2,WebGLMultipleRenderTargets:()=>j6,WebGLRenderTarget:()=>yn,WebGLRenderer:()=>Ka,WebGLUtils:()=>uve,WebGPUCoordinateSystem:()=>Uy,WireframeGeometry:()=>A2,WrapAroundEnding:()=>v_,ZeroCurvatureEnding:()=>Ag,ZeroFactor:()=>wp,ZeroSlopeEnding:()=>Rg,ZeroStencilOp:()=>Pft,_SRGBAFormat:()=>f2,createCanvasElement:()=>tve,sRGBEncoding:()=>ph});var V2="159",Eft={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},_ft={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},o0e=0,h6=1,l0e=2,Tft=3,wft=0,V4=1,a1=2,fh=3,zi=0,ws=1,ln=2,Sft=2,Oi=0,Pg=1,du=2,d6=3,f6=4,Yg=5,jo=100,c0e=101,u0e=102,p6=103,m6=104,wp=200,h0e=201,d0e=202,f0e=203,h2=204,d2=205,o1=206,p0e=207,l1=208,m0e=209,g0e=210,v0e=211,y0e=212,b0e=213,x0e=214,E0e=0,_0e=1,T0e=2,f_=3,w0e=4,S0e=5,M0e=6,A0e=7,G_=0,R0e=1,C0e=2,Gd=0,P0e=1,I0e=2,O0e=3,D0e=4,L0e=5,g6="attached",k0e="detached",z2=300,qd=301,xp=302,Og=303,p_=304,c1=306,ui=1e3,pi=1001,fu=1002,ni=1003,mh=1004,Mft=1004,hu=1005,Aft=1005,wn=1006,rf=1007,Rft=1007,ia=1008,Cft=1008,wl=1009,F0e=1010,B0e=1011,G2=1012,z4=1013,zd=1014,Us=1015,Cn=1016,G4=1017,q4=1018,oc=1020,N0e=1021,gs=1023,q2=1024,U0e=1025,bp=1026,pu=1027,u1=1028,j4=1029,H0e=1030,W4=1031,X4=1033,Ly=33776,l2=33777,ky=33778,Fy=33779,v6=35840,y6=35841,b6=35842,x6=35843,q_=36196,E6=37492,_6=37496,T6=37808,w6=37809,S6=37810,M6=37811,A6=37812,R6=37813,C6=37814,P6=37815,I6=37816,O6=37817,D6=37818,L6=37819,k6=37820,F6=37821,c2=36492,m_=36494,g_=36495,V0e=36283,B6=36284,N6=36285,U6=36286,z0e=2200,G0e=2201,q0e=2202,jd=2300,gh=2301,u2=2302,Ag=2400,Rg=2401,v_=2402,j2=2500,Y4=2501,$4=0,j_=1,h1=2,Z4=3e3,ph=3001,j0e=3200,W2=3201,Sp=0,W0e=1,Oa="",Zr="srgb",Hi="srgb-linear",X2="display-p3",W_="display-p3-linear",y_="linear",es="srgb",b_="rec709",x_="p3",Pft=0,wg=7680,Ift=7681,Oft=7682,Dft=7683,Lft=34055,kft=34056,Fft=5386,Bft=512,Nft=513,Uft=514,Hft=515,Vft=516,zft=517,Gft=518,H6=519,X0e=512,Y0e=513,$0e=514,K4=515,Z0e=516,K0e=517,J0e=518,Q0e=519,E_=35044,qft=35048,jft=35040,Wft=35045,Xft=35049,Yft=35041,$ft=35046,Zft=35050,Kft=35042,Jft="100",V6="300 es",f2=1035,cu=2e3,Uy=2001,mu=class{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});let r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;let r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;let r=this._listeners[e];if(void 0!==r){let e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;let t=this._listeners[e.type];if(void 0!==t){e.target=this;let r=t.slice(0);for(let t=0,i=r.length;t<i;t++)r[t].call(this,e);e.target=null}}},Xa=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Ome=1234567,Ig=Math.PI/180,Hy=180/Math.PI;function Sl(){let e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Xa[255&e]+Xa[e>>8&255]+Xa[e>>16&255]+Xa[e>>24&255]+"-"+Xa[255&t]+Xa[t>>8&255]+"-"+Xa[t>>16&15|64]+Xa[t>>24&255]+"-"+Xa[63&r|128]+Xa[r>>8&255]+"-"+Xa[r>>16&255]+Xa[r>>24&255]+Xa[255&i]+Xa[i>>8&255]+Xa[i>>16&255]+Xa[i>>24&255]).toLowerCase()}function Os(e,t,r){return Math.max(t,Math.min(r,e))}function J4(e,t){return(e%t+t)%t}function Qft(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)}function ept(e,t,r){return e!==t?(r-e)/(t-e):0}function l_(e,t,r){return(1-r)*e+r*t}function tpt(e,t,r,i){return l_(e,t,1-Math.exp(-r*i))}function rpt(e,t=1){return t-Math.abs(J4(e,2*t)-t)}function npt(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)}function ipt(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)}function spt(e,t){return e+Math.floor(Math.random()*(t-e+1))}function apt(e,t){return e+Math.random()*(t-e)}function opt(e){return e*(.5-Math.random())}function lpt(e){void 0!==e&&(Ome=e);let t=Ome+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296}function cpt(e){return e*Ig}function upt(e){return e*Hy}function z6(e){return 0==(e&e-1)&&0!==e}function hpt(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function p2(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function dpt(e,t,r,i,n){let a=Math.cos,s=Math.sin,o=a(r/2),l=s(r/2),h=a((t+i)/2),c=s((t+i)/2),u=a((t-i)/2),d=s((t-i)/2),p=a((i-t)/2),f=s((i-t)/2);switch(n){case"XYX":e.set(o*c,l*u,l*d,o*h);break;case"YZY":e.set(l*d,o*c,l*u,o*h);break;case"ZXZ":e.set(l*u,l*d,o*c,o*h);break;case"XZX":e.set(o*c,l*f,l*p,o*h);break;case"YXY":e.set(l*p,o*c,l*f,o*h);break;case"ZYZ":e.set(l*f,l*p,o*c,o*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function Wo(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function On(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}var Tr={DEG2RAD:Ig,RAD2DEG:Hy,generateUUID:Sl,clamp:Os,euclideanModulo:J4,mapLinear:Qft,inverseLerp:ept,lerp:l_,damp:tpt,pingpong:rpt,smoothstep:npt,smootherstep:ipt,randInt:spt,randFloat:apt,randFloatSpread:opt,seededRandom:lpt,degToRad:cpt,radToDeg:upt,isPowerOfTwo:z6,ceilPowerOfTwo:hpt,floorPowerOfTwo:p2,setQuaternionFromProperEuler:dpt,normalize:On,denormalize:Wo},Te=class{constructor(e=0,t=0){Te.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;let r=this.dot(e)/t;return Math.acos(Os(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let r=Math.cos(t),i=Math.sin(t),n=this.x-e.x,a=this.y-e.y;return this.x=n*r-a*i+e.x,this.y=n*i+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Wr=class{constructor(e,t,r,i,n,a,s,o,l){Wr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,r,i,n,a,s,o,l)}set(e,t,r,i,n,a,s,o,l){let h=this.elements;return h[0]=e,h[1]=i,h[2]=s,h[3]=t,h[4]=n,h[5]=o,h[6]=r,h[7]=a,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let r=e.elements,i=t.elements,n=this.elements,a=r[0],s=r[3],o=r[6],l=r[1],h=r[4],c=r[7],u=r[2],d=r[5],p=r[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],b=i[7],x=i[2],_=i[5],w=i[8];return n[0]=a*f+s*v+o*x,n[3]=a*m+s*y+o*_,n[6]=a*g+s*b+o*w,n[1]=l*f+h*v+c*x,n[4]=l*m+h*y+c*_,n[7]=l*g+h*b+c*w,n[2]=u*f+d*v+p*x,n[5]=u*m+d*y+p*_,n[8]=u*g+d*b+p*w,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],h=e[8];return t*a*h-t*s*l-r*n*h+r*s*o+i*n*l-i*a*o}invert(){let e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],h=e[8],c=h*a-s*l,u=s*o-h*n,d=l*n-a*o,p=t*c+r*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return e[0]=c*f,e[1]=(i*l-h*r)*f,e[2]=(s*r-i*a)*f,e[3]=u*f,e[4]=(h*t-i*o)*f,e[5]=(i*n-s*t)*f,e[6]=d*f,e[7]=(r*o-l*t)*f,e[8]=(a*t-r*n)*f,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,n,a,s){let o=Math.cos(n),l=Math.sin(n);return this.set(r*o,r*l,-r*(o*a+l*s)+a+e,-i*l,i*o,-i*(-l*a+o*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(C5.makeScale(e,t)),this}rotate(e){return this.premultiply(C5.makeRotation(-e)),this}translate(e,t){return this.premultiply(C5.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,r=e.elements;for(let e=0;e<9;e++)if(t[e]!==r[e])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){let r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return(new this.constructor).fromArray(this.elements)}},C5=new Wr;function eve(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var fpt={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Iy(e,t){return new fpt[e](t)}function __(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function tve(){let e=__("canvas");return e.style.display="block",e}var Dme={};function c_(e){e in Dme||(Dme[e]=!0,console.warn(e))}var Lme=(new Wr).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),kme=(new Wr).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),gC={[Hi]:{transfer:y_,primaries:b_,toReference:e=>e,fromReference:e=>e},[Zr]:{transfer:es,primaries:b_,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[W_]:{transfer:y_,primaries:x_,toReference:e=>e.applyMatrix3(kme),fromReference:e=>e.applyMatrix3(Lme)},[X2]:{transfer:es,primaries:x_,toReference:e=>e.convertSRGBToLinear().applyMatrix3(kme),fromReference:e=>e.applyMatrix3(Lme).convertLinearToSRGB()}},ppt=new Set([Hi,W_]),vi={enabled:!0,_workingColorSpace:Hi,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(e){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!e},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!ppt.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,r){if(!1===this.enabled||t===r||!t||!r)return e;let i=gC[t].toReference;return(0,gC[r].fromReference)(i(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return gC[e].primaries},getTransfer:function(e){return e===Oa?y_:gC[e].transfer}};function By(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function P5(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var uy,T_=class{static getDataURL(e){if(/^data:/i.test(e.src)||"undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===uy&&(uy=__("canvas")),uy.width=e.width,uy.height=e.height;let r=uy.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=uy}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){let t=__("canvas");t.width=e.width,t.height=e.height;let r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);let i=r.getImageData(0,0,e.width,e.height),n=i.data;for(let e=0;e<n.length;e++)n[e]=255*By(n[e]/255);return r.putImageData(i,0,0),t}if(e.data){let t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*By(t[e]/255)):t[e]=By(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},mpt=0,uu=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:mpt++}),this.uuid=Sl(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];let r={uuid:this.uuid,url:""},i=this.data;if(null!==i){let e;if(Array.isArray(i)){e=[];for(let t=0,r=i.length;t<r;t++)i[t].isDataTexture?e.push(I5(i[t].image)):e.push(I5(i[t]))}else e=I5(i);r.url=e}return t||(e.images[this.uuid]=r),r}};function I5(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?T_.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var gpt=0,bi=class extends mu{constructor(e=bi.DEFAULT_IMAGE,t=bi.DEFAULT_MAPPING,r=pi,i=pi,n=wn,a=ia,s=gs,o=wl,l=bi.DEFAULT_ANISOTROPY,h=Oa){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:gpt++}),this.uuid=Sl(),this.name="",this.source=new uu(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=n,this.minFilter=a,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=o,this.offset=new Te(0,0),this.repeat=new Te(1,1),this.center=new Te(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Wr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof h?this.colorSpace=h:(c_("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=h===ph?Zr:Oa),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];let r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==z2)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ui:e.x=e.x-Math.floor(e.x);break;case pi:e.x=e.x<0?0:1;break;case fu:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ui:e.y=e.y-Math.floor(e.y);break;case pi:e.y=e.y<0?0:1;break;case fu:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return c_("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Zr?ph:Z4}set encoding(e){c_("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===ph?Zr:Oa}};bi.DEFAULT_IMAGE=null,bi.DEFAULT_MAPPING=z2,bi.DEFAULT_ANISOTROPY=1;var Fn=class{constructor(e=0,t=0,r=0,i=1){Fn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,r=this.y,i=this.z,n=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*i+a[12]*n,this.y=a[1]*t+a[5]*r+a[9]*i+a[13]*n,this.z=a[2]*t+a[6]*r+a[10]*i+a[14]*n,this.w=a[3]*t+a[7]*r+a[11]*i+a[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,n,a=e.elements,s=a[0],o=a[4],l=a[8],h=a[1],c=a[5],u=a[9],d=a[2],p=a[6],f=a[10];if(Math.abs(o-h)<.01&&Math.abs(l-d)<.01&&Math.abs(u-p)<.01){if(Math.abs(o+h)<.1&&Math.abs(l+d)<.1&&Math.abs(u+p)<.1&&Math.abs(s+c+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let e=(s+1)/2,a=(c+1)/2,m=(f+1)/2,g=(o+h)/4,v=(l+d)/4,y=(u+p)/4;return e>a&&e>m?e<.01?(r=0,i=.707106781,n=.707106781):(r=Math.sqrt(e),i=g/r,n=v/r):a>m?a<.01?(r=.707106781,i=0,n=.707106781):(i=Math.sqrt(a),r=g/i,n=y/i):m<.01?(r=.707106781,i=.707106781,n=0):(n=Math.sqrt(m),r=v/n,i=y/n),this.set(r,i,n,t),this}let m=Math.sqrt((p-u)*(p-u)+(l-d)*(l-d)+(h-o)*(h-o));return Math.abs(m)<.001&&(m=1),this.x=(p-u)/m,this.y=(l-d)/m,this.z=(h-o)/m,this.w=Math.acos((s+c+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},m2=class extends mu{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Fn(0,0,e,t),this.scissorTest=!1,this.viewport=new Fn(0,0,e,t);let i={width:e,height:t,depth:1};void 0!==r.encoding&&(c_("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),r.colorSpace=r.encoding===ph?Zr:Oa),r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:wn,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},r),this.texture=new bi(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps,this.texture.internalFormat=r.internalFormat,this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}setSize(e,t,r=1){(this.width!==e||this.height!==t||this.depth!==r)&&(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new uu(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},yn=class extends m2{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}},Vy=class extends bi{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=ni,this.minFilter=ni,this.wrapR=pi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},G6=class extends yn{constructor(e=1,t=1,r=1,i={}){super(e,t,i),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new Vy(null,e,t,r),this.texture.isRenderTargetTexture=!0}},w_=class extends bi{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=ni,this.minFilter=ni,this.wrapR=pi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},q6=class extends yn{constructor(e=1,t=1,r=1,i={}){super(e,t,i),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new w_(null,e,t,r),this.texture.isRenderTargetTexture=!0}},j6=class extends yn{constructor(e=1,t=1,r=1,i={}){super(e,t,i),this.isWebGLMultipleRenderTargets=!0;let n=this.texture;this.texture=[];for(let e=0;e<r;e++)this.texture[e]=n.clone(),this.texture[e].isRenderTargetTexture=!0}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,n=this.texture.length;i<n;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=r;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,r=e.texture.length;t<r;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},dn=class{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,n,a,s){let o=r[i+0],l=r[i+1],h=r[i+2],c=r[i+3],u=n[a+0],d=n[a+1],p=n[a+2],f=n[a+3];if(0===s)return e[t+0]=o,e[t+1]=l,e[t+2]=h,void(e[t+3]=c);if(1===s)return e[t+0]=u,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(c!==f||o!==u||l!==d||h!==p){let e=1-s,t=o*u+l*d+h*p+c*f,r=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){let n=Math.sqrt(i),a=Math.atan2(n,t*r);e=Math.sin(e*a)/n,s=Math.sin(s*a)/n}let n=s*r;if(o=o*e+u*n,l=l*e+d*n,h=h*e+p*n,c=c*e+f*n,e===1-s){let e=1/Math.sqrt(o*o+l*l+h*h+c*c);o*=e,l*=e,h*=e,c*=e}}e[t]=o,e[t+1]=l,e[t+2]=h,e[t+3]=c}static multiplyQuaternionsFlat(e,t,r,i,n,a){let s=r[i],o=r[i+1],l=r[i+2],h=r[i+3],c=n[a],u=n[a+1],d=n[a+2],p=n[a+3];return e[t]=s*p+h*c+o*d-l*u,e[t+1]=o*p+h*u+l*c-s*d,e[t+2]=l*p+h*d+s*u-o*c,e[t+3]=h*p-s*c-o*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let r=e._x,i=e._y,n=e._z,a=e._order,s=Math.cos,o=Math.sin,l=s(r/2),h=s(i/2),c=s(n/2),u=o(r/2),d=o(i/2),p=o(n/2);switch(a){case"XYZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"YXZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"ZXY":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"ZYX":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"YZX":this._x=u*h*c+l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c-u*d*p;break;case"XZY":this._x=u*h*c-l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,r=t[0],i=t[4],n=t[8],a=t[1],s=t[5],o=t[9],l=t[2],h=t[6],c=t[10],u=r+s+c;if(u>0){let e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(h-o)*e,this._y=(n-l)*e,this._z=(a-i)*e}else if(r>s&&r>c){let e=2*Math.sqrt(1+r-s-c);this._w=(h-o)/e,this._x=.25*e,this._y=(i+a)/e,this._z=(n+l)/e}else if(s>c){let e=2*Math.sqrt(1+s-r-c);this._w=(n-l)/e,this._x=(i+a)/e,this._y=.25*e,this._z=(o+h)/e}else{let e=2*Math.sqrt(1+c-r-s);this._w=(a-i)/e,this._x=(n+l)/e,this._y=(o+h)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Os(this.dot(e),-1,1)))}rotateTowards(e,t){let r=this.angleTo(e);if(0===r)return this;let i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let r=e._x,i=e._y,n=e._z,a=e._w,s=t._x,o=t._y,l=t._z,h=t._w;return this._x=r*h+a*s+i*l-n*o,this._y=i*h+a*o+n*s-r*l,this._z=n*h+a*l+r*o-i*s,this._w=a*h-r*s-i*o-n*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);let r=this._x,i=this._y,n=this._z,a=this._w,s=a*e._w+r*e._x+i*e._y+n*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=a,this._x=r,this._y=i,this._z=n,this;let o=1-s*s;if(o<=Number.EPSILON){let e=1-t;return this._w=e*a+t*this._w,this._x=e*r+t*this._x,this._y=e*i+t*this._y,this._z=e*n+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),h=Math.atan2(l,s),c=Math.sin((1-t)*h)/l,u=Math.sin(t*h)/l;return this._w=a*c+this._w*u,this._x=r*c+this._x*u,this._y=i*c+this._y*u,this._z=n*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){let e=Math.random(),t=Math.sqrt(1-e),r=Math.sqrt(e),i=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(t*Math.cos(i),r*Math.sin(n),r*Math.cos(n),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},F=class{constructor(e=0,t=0,r=0){F.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return void 0===r&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Fme.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Fme.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*i,this.y=n[1]*t+n[4]*r+n[7]*i,this.z=n[2]*t+n[5]*r+n[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,r=this.y,i=this.z,n=e.elements,a=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*a,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*a,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*a,this}applyQuaternion(e){let t=this.x,r=this.y,i=this.z,n=e.x,a=e.y,s=e.z,o=e.w,l=2*(a*i-s*r),h=2*(s*t-n*i),c=2*(n*r-a*t);return this.x=t+o*l+a*c-s*h,this.y=r+o*h+s*l-n*c,this.z=i+o*c+n*h-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i,this.y=n[1]*t+n[5]*r+n[9]*i,this.z=n[2]*t+n[6]*r+n[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let r=e.x,i=e.y,n=e.z,a=t.x,s=t.y,o=t.z;return this.x=i*o-n*s,this.y=n*a-r*o,this.z=r*s-i*a,this}projectOnVector(e){let t=e.lengthSq();if(0===t)return this.set(0,0,0);let r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return O5.copy(this).projectOnVector(e),this.sub(O5)}reflect(e){return this.sub(O5.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;let r=this.dot(e)/t;return Math.acos(Os(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){let i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,r=Math.sqrt(1-Ga(e,2));return this.x=r*Math.cos(t),this.y=r*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},O5=new F,Fme=new dn,Vt=class{constructor(e=new F(1/0,1/0,1/0),t=new F(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(au.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(au.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let r=au.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let r=e.geometry;if(void 0!==r){let i=r.getAttribute("position");if(!0===t&&void 0!==i&&!0!==e.isInstancedMesh)for(let t=0,r=i.count;t<r;t++)!0===e.isMesh?e.getVertexPosition(t,au):au.fromBufferAttribute(i,t),au.applyMatrix4(e.matrixWorld),this.expandByPoint(au);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),vC.copy(e.boundingBox)):(null===r.boundingBox&&r.computeBoundingBox(),vC.copy(r.boundingBox)),vC.applyMatrix4(e.matrixWorld),this.union(vC)}let i=e.children;for(let e=0,r=i.length;e<r;e++)this.expandByObject(i[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,au),au.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter($E),yC.subVectors(this.max,$E),hy.subVectors(e.a,$E),dy.subVectors(e.b,$E),fy.subVectors(e.c,$E),dp.subVectors(dy,hy),fp.subVectors(fy,dy),pg.subVectors(hy,fy);let t=[0,-dp.z,dp.y,0,-fp.z,fp.y,0,-pg.z,pg.y,dp.z,0,-dp.x,fp.z,0,-fp.x,pg.z,0,-pg.x,-dp.y,dp.x,0,-fp.y,fp.x,0,-pg.y,pg.x,0];return!(!D5(t,hy,dy,fy,yC)||(t=[1,0,0,0,1,0,0,0,1],!D5(t,hy,dy,fy,yC)))&&(bC.crossVectors(dp,fp),t=[bC.x,bC.y,bC.z],D5(t,hy,dy,fy,yC))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,au).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(au).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(kd[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),kd[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),kd[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),kd[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),kd[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),kd[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),kd[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),kd[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(kd)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},kd=[new F,new F,new F,new F,new F,new F,new F,new F],au=new F,vC=new Vt,hy=new F,dy=new F,fy=new F,dp=new F,fp=new F,pg=new F,$E=new F,yC=new F,bC=new F,mg=new F;function D5(e,t,r,i,n){for(let a=0,s=e.length-3;a<=s;a+=3){mg.fromArray(e,a);let s=n.x*Math.abs(mg.x)+n.y*Math.abs(mg.y)+n.z*Math.abs(mg.z),o=t.dot(mg),l=r.dot(mg),h=i.dot(mg);if(Math.max(-Math.max(o,l,h),Math.min(o,l,h))>s)return!1}return!0}var vpt=new Vt,ZE=new F,L5=new F,Sn=class{constructor(e=new F,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let r=this.center;void 0!==t?r.copy(t):vpt.setFromPoints(e).getCenter(r);let i=0;for(let t=0,n=e.length;t<n;t++)i=Math.max(i,r.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;ZE.subVectors(e,this.center);let t=ZE.lengthSq();if(t>this.radius*this.radius){let e=Math.sqrt(t),r=.5*(e-this.radius);this.center.addScaledVector(ZE,r/e),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(L5.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(ZE.copy(e.center).add(L5)),this.expandByPoint(ZE.copy(e.center).sub(L5))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}},Fd=new F,k5=new F,xC=new F,pp=new F,F5=new F,EC=new F,B5=new F,Za=class{constructor(e=new F,t=new F(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Fd)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=Fd.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Fd.copy(this.origin).addScaledVector(this.direction,t),Fd.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){k5.copy(e).add(t).multiplyScalar(.5),xC.copy(t).sub(e).normalize(),pp.copy(this.origin).sub(k5);let n,a,s,o,l=.5*e.distanceTo(t),h=-this.direction.dot(xC),c=pp.dot(this.direction),u=-pp.dot(xC),d=pp.lengthSq(),p=Math.abs(1-h*h);if(p>0)if(n=h*u-c,a=h*c-u,o=l*p,n>=0)if(a>=-o)if(a<=o){let e=1/p;n*=e,a*=e,s=n*(n+h*a+2*c)+a*(h*n+a+2*u)+d}else a=l,n=Math.max(0,-(h*a+c)),s=-n*n+a*(a+2*u)+d;else a=-l,n=Math.max(0,-(h*a+c)),s=-n*n+a*(a+2*u)+d;else a<=-o?(n=Math.max(0,-(-h*l+c)),a=n>0?-l:Math.min(Math.max(-l,-u),l),s=-n*n+a*(a+2*u)+d):a<=o?(n=0,a=Math.min(Math.max(-l,-u),l),s=a*(a+2*u)+d):(n=Math.max(0,-(h*l+c)),a=n>0?l:Math.min(Math.max(-l,-u),l),s=-n*n+a*(a+2*u)+d);else a=h>0?-l:l,n=Math.max(0,-(h*a+c)),s=-n*n+a*(a+2*u)+d;return r&&r.copy(this.origin).addScaledVector(this.direction,n),i&&i.copy(k5).addScaledVector(xC,a),s}intersectSphere(e,t){Fd.subVectors(e.center,this.origin);let r=Fd.dot(this.direction),i=Fd.dot(Fd)-r*r,n=e.radius*e.radius;if(i>n)return null;let a=Math.sqrt(n-i),s=r-a,o=r+a;return o<0?null:s<0?this.at(o,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;let r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){let r=this.distanceToPlane(e);return null===r?null:this.at(r,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,n,a,s,o,l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return l>=0?(r=(e.min.x-u.x)*l,i=(e.max.x-u.x)*l):(r=(e.max.x-u.x)*l,i=(e.min.x-u.x)*l),h>=0?(n=(e.min.y-u.y)*h,a=(e.max.y-u.y)*h):(n=(e.max.y-u.y)*h,a=(e.min.y-u.y)*h),r>a||n>i||((n>r||isNaN(r))&&(r=n),(a<i||isNaN(i))&&(i=a),c>=0?(s=(e.min.z-u.z)*c,o=(e.max.z-u.z)*c):(s=(e.max.z-u.z)*c,o=(e.min.z-u.z)*c),r>o||s>i)||((s>r||r!=r)&&(r=s),(o<i||i!=i)&&(i=o),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return null!==this.intersectBox(e,Fd)}intersectTriangle(e,t,r,i,n){F5.subVectors(t,e),EC.subVectors(r,e),B5.crossVectors(F5,EC);let a,s=this.direction.dot(B5);if(s>0){if(i)return null;a=1}else{if(!(s<0))return null;a=-1,s=-s}pp.subVectors(this.origin,e);let o=a*this.direction.dot(EC.crossVectors(pp,EC));if(o<0)return null;let l=a*this.direction.dot(F5.cross(pp));if(l<0||o+l>s)return null;let h=-a*pp.dot(B5);return h<0?null:this.at(h/s,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}},lt=class{constructor(e,t,r,i,n,a,s,o,l,h,c,u,d,p,f,m){lt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,r,i,n,a,s,o,l,h,c,u,d,p,f,m)}set(e,t,r,i,n,a,s,o,l,h,c,u,d,p,f,m){let g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=i,g[1]=n,g[5]=a,g[9]=s,g[13]=o,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new lt).fromArray(this.elements)}copy(e){let t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){let t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,r=e.elements,i=1/py.setFromMatrixColumn(e,0).length(),n=1/py.setFromMatrixColumn(e,1).length(),a=1/py.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*n,t[5]=r[5]*n,t[6]=r[6]*n,t[7]=0,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,r=e.x,i=e.y,n=e.z,a=Math.cos(r),s=Math.sin(r),o=Math.cos(i),l=Math.sin(i),h=Math.cos(n),c=Math.sin(n);if("XYZ"===e.order){let e=a*h,r=a*c,i=s*h,n=s*c;t[0]=o*h,t[4]=-o*c,t[8]=l,t[1]=r+i*l,t[5]=e-n*l,t[9]=-s*o,t[2]=n-e*l,t[6]=i+r*l,t[10]=a*o}else if("YXZ"===e.order){let e=o*h,r=o*c,i=l*h,n=l*c;t[0]=e+n*s,t[4]=i*s-r,t[8]=a*l,t[1]=a*c,t[5]=a*h,t[9]=-s,t[2]=r*s-i,t[6]=n+e*s,t[10]=a*o}else if("ZXY"===e.order){let e=o*h,r=o*c,i=l*h,n=l*c;t[0]=e-n*s,t[4]=-a*c,t[8]=i+r*s,t[1]=r+i*s,t[5]=a*h,t[9]=n-e*s,t[2]=-a*l,t[6]=s,t[10]=a*o}else if("ZYX"===e.order){let e=a*h,r=a*c,i=s*h,n=s*c;t[0]=o*h,t[4]=i*l-r,t[8]=e*l+n,t[1]=o*c,t[5]=n*l+e,t[9]=r*l-i,t[2]=-l,t[6]=s*o,t[10]=a*o}else if("YZX"===e.order){let e=a*o,r=a*l,i=s*o,n=s*l;t[0]=o*h,t[4]=n-e*c,t[8]=i*c+r,t[1]=c,t[5]=a*h,t[9]=-s*h,t[2]=-l*h,t[6]=r*c+i,t[10]=e-n*c}else if("XZY"===e.order){let e=a*o,r=a*l,i=s*o,n=s*l;t[0]=o*h,t[4]=-c,t[8]=l*h,t[1]=e*c+n,t[5]=a*h,t[9]=r*c-i,t[2]=i*c-r,t[6]=s*h,t[10]=n*c+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(ypt,e,bpt)}lookAt(e,t,r){let i=this.elements;return _l.subVectors(e,t),0===_l.lengthSq()&&(_l.z=1),_l.normalize(),mp.crossVectors(r,_l),0===mp.lengthSq()&&(1===Math.abs(r.z)?_l.x+=1e-4:_l.z+=1e-4,_l.normalize(),mp.crossVectors(r,_l)),mp.normalize(),_C.crossVectors(_l,mp),i[0]=mp.x,i[4]=_C.x,i[8]=_l.x,i[1]=mp.y,i[5]=_C.y,i[9]=_l.y,i[2]=mp.z,i[6]=_C.z,i[10]=_l.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let r=e.elements,i=t.elements,n=this.elements,a=r[0],s=r[4],o=r[8],l=r[12],h=r[1],c=r[5],u=r[9],d=r[13],p=r[2],f=r[6],m=r[10],g=r[14],v=r[3],y=r[7],b=r[11],x=r[15],_=i[0],w=i[4],S=i[8],T=i[12],M=i[1],E=i[5],A=i[9],C=i[13],P=i[2],R=i[6],I=i[10],O=i[14],L=i[3],D=i[7],k=i[11],F=i[15];return n[0]=a*_+s*M+o*P+l*L,n[4]=a*w+s*E+o*R+l*D,n[8]=a*S+s*A+o*I+l*k,n[12]=a*T+s*C+o*O+l*F,n[1]=h*_+c*M+u*P+d*L,n[5]=h*w+c*E+u*R+d*D,n[9]=h*S+c*A+u*I+d*k,n[13]=h*T+c*C+u*O+d*F,n[2]=p*_+f*M+m*P+g*L,n[6]=p*w+f*E+m*R+g*D,n[10]=p*S+f*A+m*I+g*k,n[14]=p*T+f*C+m*O+g*F,n[3]=v*_+y*M+b*P+x*L,n[7]=v*w+y*E+b*R+x*D,n[11]=v*S+y*A+b*I+x*k,n[15]=v*T+y*C+b*O+x*F,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],a=e[1],s=e[5],o=e[9],l=e[13],h=e[2],c=e[6],u=e[10],d=e[14];return e[3]*(+n*o*c-i*l*c-n*s*u+r*l*u+i*s*d-r*o*d)+e[7]*(+t*o*d-t*l*u+n*a*u-i*a*d+i*l*h-n*o*h)+e[11]*(+t*l*c-t*s*d-n*a*c+r*a*d+n*s*h-r*l*h)+e[15]*(-i*s*h-t*o*c+t*s*u+i*a*c-r*a*u+r*o*h)}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(e,t,r){let i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){let e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],h=e[8],c=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=c*m*l-f*u*l+f*o*d-s*m*d-c*o*g+s*u*g,y=p*u*l-h*m*l-p*o*d+a*m*d+h*o*g-a*u*g,b=h*f*l-p*c*l+p*s*d-a*f*d-h*s*g+a*c*g,x=p*c*o-h*f*o-p*s*u+a*f*u+h*s*m-a*c*m,_=t*v+r*y+i*b+n*x;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let w=1/_;return e[0]=v*w,e[1]=(f*u*n-c*m*n-f*i*d+r*m*d+c*i*g-r*u*g)*w,e[2]=(s*m*n-f*o*n+f*i*l-r*m*l-s*i*g+r*o*g)*w,e[3]=(c*o*n-s*u*n-c*i*l+r*u*l+s*i*d-r*o*d)*w,e[4]=y*w,e[5]=(h*m*n-p*u*n+p*i*d-t*m*d-h*i*g+t*u*g)*w,e[6]=(p*o*n-a*m*n-p*i*l+t*m*l+a*i*g-t*o*g)*w,e[7]=(a*u*n-h*o*n+h*i*l-t*u*l-a*i*d+t*o*d)*w,e[8]=b*w,e[9]=(p*c*n-h*f*n-p*r*d+t*f*d+h*r*g-t*c*g)*w,e[10]=(a*f*n-p*s*n+p*r*l-t*f*l-a*r*g+t*s*g)*w,e[11]=(h*s*n-a*c*n-h*r*l+t*c*l+a*r*d-t*s*d)*w,e[12]=x*w,e[13]=(h*f*i-p*c*i+p*r*u-t*f*u-h*r*m+t*c*m)*w,e[14]=(p*s*i-a*f*i-p*r*o+t*f*o+a*r*m-t*s*m)*w,e[15]=(a*c*i-h*s*i+h*r*o-t*c*o-a*r*u+t*s*u)*w,this}scale(e){let t=this.elements,r=e.x,i=e.y,n=e.z;return t[0]*=r,t[4]*=i,t[8]*=n,t[1]*=r,t[5]*=i,t[9]*=n,t[2]*=r,t[6]*=i,t[10]*=n,t[3]*=r,t[7]*=i,t[11]*=n,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let r=Math.cos(t),i=Math.sin(t),n=1-r,a=e.x,s=e.y,o=e.z,l=n*a,h=n*s;return this.set(l*a+r,l*s-i*o,l*o+i*s,0,l*s+i*o,h*s+r,h*o-i*a,0,l*o-i*s,h*o+i*a,n*o*o+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,n,a){return this.set(1,r,n,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){let i=this.elements,n=t._x,a=t._y,s=t._z,o=t._w,l=n+n,h=a+a,c=s+s,u=n*l,d=n*h,p=n*c,f=a*h,m=a*c,g=s*c,v=o*l,y=o*h,b=o*c,x=r.x,_=r.y,w=r.z;return i[0]=(1-(f+g))*x,i[1]=(d+b)*x,i[2]=(p-y)*x,i[3]=0,i[4]=(d-b)*_,i[5]=(1-(u+g))*_,i[6]=(m+v)*_,i[7]=0,i[8]=(p+y)*w,i[9]=(m-v)*w,i[10]=(1-(u+f))*w,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){let i=this.elements,n=py.set(i[0],i[1],i[2]).length(),a=py.set(i[4],i[5],i[6]).length(),s=py.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),e.x=i[12],e.y=i[13],e.z=i[14],ou.copy(this);let o=1/n,l=1/a,h=1/s;return ou.elements[0]*=o,ou.elements[1]*=o,ou.elements[2]*=o,ou.elements[4]*=l,ou.elements[5]*=l,ou.elements[6]*=l,ou.elements[8]*=h,ou.elements[9]*=h,ou.elements[10]*=h,t.setFromRotationMatrix(ou),r.x=n,r.y=a,r.z=s,this}makePerspective(e,t,r,i,n,a,s=cu){let o,l,h=this.elements,c=2*n/(t-e),u=2*n/(r-i),d=(t+e)/(t-e),p=(r+i)/(r-i);if(s===cu)o=-(a+n)/(a-n),l=-2*a*n/(a-n);else{if(s!==Uy)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);o=-a/(a-n),l=-a*n/(a-n)}return h[0]=c,h[4]=0,h[8]=d,h[12]=0,h[1]=0,h[5]=u,h[9]=p,h[13]=0,h[2]=0,h[6]=0,h[10]=o,h[14]=l,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(e,t,r,i,n,a,s=cu){let o,l,h=this.elements,c=1/(t-e),u=1/(r-i),d=1/(a-n),p=(t+e)*c,f=(r+i)*u;if(s===cu)o=(a+n)*d,l=-2*d;else{if(s!==Uy)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);o=n*d,l=-1*d}return h[0]=2*c,h[4]=0,h[8]=0,h[12]=-p,h[1]=0,h[5]=2*u,h[9]=0,h[13]=-f,h[2]=0,h[6]=0,h[10]=l,h[14]=-o,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(e){let t=this.elements,r=e.elements;for(let e=0;e<16;e++)if(t[e]!==r[e])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){let r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}},py=new F,ou=new lt,ypt=new F(0,0,0),bpt=new F(1,1,1),mp=new F,_C=new F,_l=new F,Bme=new lt,Nme=new dn,tn=class{constructor(e=0,t=0,r=0,i=tn.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){let i=e.elements,n=i[0],a=i[4],s=i[8],o=i[1],l=i[5],h=i[9],c=i[2],u=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(Os(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-a,n)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Os(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,n),this._z=0);break;case"ZXY":this._x=Math.asin(Os(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(o,n));break;case"ZYX":this._y=Math.asin(-Os(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(Os(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-Os(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(s,n)):(this._x=Math.atan2(-h,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===r&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return Bme.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Bme,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Nme.setFromEuler(this),this.setFromQuaternion(Nme,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};tn.DEFAULT_ORDER="XYZ";var Ep=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}},xpt=0,Ume=new F,my=new dn,Bd=new lt,TC=new F,KE=new F,Ept=new F,_pt=new dn,Hme=new F(1,0,0),Vme=new F(0,1,0),zme=new F(0,0,1),Tpt={type:"added"},wpt={type:"removed"},yr=class extends mu{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:xpt++}),this.uuid=Sl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=yr.DEFAULT_UP.clone();let e=new F,t=new tn,r=new dn,i=new F(1,1,1);t._onChange((function(){r.setFromEuler(t,!1)})),r._onChange((function(){t.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new lt},normalMatrix:{value:new Wr}}),this.matrix=new lt,this.matrixWorld=new lt,this.matrixAutoUpdate=yr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=yr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Ep,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return my.setFromAxisAngle(e,t),this.quaternion.multiply(my),this}rotateOnWorldAxis(e,t){return my.setFromAxisAngle(e,t),this.quaternion.premultiply(my),this}rotateX(e){return this.rotateOnAxis(Hme,e)}rotateY(e){return this.rotateOnAxis(Vme,e)}rotateZ(e){return this.rotateOnAxis(zme,e)}translateOnAxis(e,t){return Ume.copy(e).applyQuaternion(this.quaternion),this.position.add(Ume.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Hme,e)}translateY(e){return this.translateOnAxis(Vme,e)}translateZ(e){return this.translateOnAxis(zme,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Bd.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?TC.copy(e):TC.set(e,t,r);let i=this.parent;this.updateWorldMatrix(!0,!1),KE.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Bd.lookAt(KE,TC,this.up):Bd.lookAt(TC,KE,this.up),this.quaternion.setFromRotationMatrix(Bd),i&&(Bd.extractRotation(i.matrixWorld),my.setFromRotationMatrix(Bd),this.quaternion.premultiply(my.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Tpt)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}let t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(wpt)),this}removeFromParent(){let e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Bd.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Bd.multiply(e.parent.matrixWorld)),e.applyMatrix4(Bd),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){let i=this.children[r].getObjectByProperty(e,t);if(void 0!==i)return i}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);let i=this.children;for(let n=0,a=i.length;n<a;n++)i[n].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(KE,e,Ept),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(KE,_pt,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);let t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){let t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let r=0,i=t.length;r<i;r++){let i=t[r];(!0===i.matrixWorldAutoUpdate||!0===e)&&i.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let r=this.parent;if(!0===e&&null!==r&&!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){let e=this.children;for(let t=0,r=e.length;t<r;t++){let r=e[t];!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=void 0===e||"string"==typeof e,r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});let i={};function n(t,r){return void 0===t[r.uuid]&&(t[r.uuid]=r.toJSON(e)),r.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map((e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()}))),i.maxGeometryCount=this._maxGeometryCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=n(e.geometries,this.geometry);let t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){let r=t.shapes;if(Array.isArray(r))for(let t=0,i=r.length;t<i;t++){let i=r[t];n(e.shapes,i)}else n(e.shapes,r)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(n(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){let t=[];for(let r=0,i=this.material.length;r<i;r++)t.push(n(e.materials,this.material[r]));i.material=t}else i.material=n(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){let r=this.animations[t];i.animations.push(n(e.animations,r))}}if(t){let t=a(e.geometries),i=a(e.materials),n=a(e.textures),s=a(e.images),o=a(e.shapes),l=a(e.skeletons),h=a(e.animations),c=a(e.nodes);t.length>0&&(r.geometries=t),i.length>0&&(r.materials=i),n.length>0&&(r.textures=n),s.length>0&&(r.images=s),o.length>0&&(r.shapes=o),l.length>0&&(r.skeletons=l),h.length>0&&(r.animations=h),c.length>0&&(r.nodes=c)}return r.object=i,r;function a(e){let t=[];for(let r in e){let i=e[r];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){let r=e.children[t];this.add(r.clone())}return this}};yr.DEFAULT_UP=new F(0,1,0),yr.DEFAULT_MATRIX_AUTO_UPDATE=!0,yr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var lu=new F,Nd=new F,N5=new F,Ud=new F,gy=new F,vy=new F,Gme=new F,U5=new F,H5=new F,V5=new F,wC=!1,yi=class{constructor(e=new F,t=new F,r=new F){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),lu.subVectors(e,t),i.cross(lu);let n=i.lengthSq();return n>0?i.multiplyScalar(1/Math.sqrt(n)):i.set(0,0,0)}static getBarycoord(e,t,r,i,n){lu.subVectors(i,t),Nd.subVectors(r,t),N5.subVectors(e,t);let a=lu.dot(lu),s=lu.dot(Nd),o=lu.dot(N5),l=Nd.dot(Nd),h=Nd.dot(N5),c=a*l-s*s;if(0===c)return n.set(-2,-1,-1);let u=1/c,d=(l*o-s*h)*u,p=(a*h-s*o)*u;return n.set(1-d-p,p,d)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,Ud),Ud.x>=0&&Ud.y>=0&&Ud.x+Ud.y<=1}static getUV(e,t,r,i,n,a,s,o){return!1===wC&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),wC=!0),this.getInterpolation(e,t,r,i,n,a,s,o)}static getInterpolation(e,t,r,i,n,a,s,o){return this.getBarycoord(e,t,r,i,Ud),o.setScalar(0),o.addScaledVector(n,Ud.x),o.addScaledVector(a,Ud.y),o.addScaledVector(s,Ud.z),o}static isFrontFacing(e,t,r,i){return lu.subVectors(r,t),Nd.subVectors(e,t),lu.cross(Nd).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return lu.subVectors(this.c,this.b),Nd.subVectors(this.a,this.b),.5*lu.cross(Nd).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return yi.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return yi.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,r,i,n){return!1===wC&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),wC=!0),yi.getInterpolation(e,this.a,this.b,this.c,t,r,i,n)}getInterpolation(e,t,r,i,n){return yi.getInterpolation(e,this.a,this.b,this.c,t,r,i,n)}containsPoint(e){return yi.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return yi.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let r,i,n=this.a,a=this.b,s=this.c;gy.subVectors(a,n),vy.subVectors(s,n),U5.subVectors(e,n);let o=gy.dot(U5),l=vy.dot(U5);if(o<=0&&l<=0)return t.copy(n);H5.subVectors(e,a);let h=gy.dot(H5),c=vy.dot(H5);if(h>=0&&c<=h)return t.copy(a);let u=o*c-h*l;if(u<=0&&o>=0&&h<=0)return r=o/(o-h),t.copy(n).addScaledVector(gy,r);V5.subVectors(e,s);let d=gy.dot(V5),p=vy.dot(V5);if(p>=0&&d<=p)return t.copy(s);let f=d*l-o*p;if(f<=0&&l>=0&&p<=0)return i=l/(l-p),t.copy(n).addScaledVector(vy,i);let m=h*p-d*c;if(m<=0&&c-h>=0&&d-p>=0)return Gme.subVectors(s,a),i=(c-h)/(c-h+(d-p)),t.copy(a).addScaledVector(Gme,i);let g=1/(m+f+u);return r=f*g,i=u*g,t.copy(n).addScaledVector(gy,r).addScaledVector(vy,i)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},rve={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},gp={h:0,s:0,l:0},SC={h:0,s:0,l:0};function z5(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}var dt=class{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(void 0===t&&void 0===r){let t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Zr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,vi.toWorkingColorSpace(this,t),this}setRGB(e,t,r,i=vi.workingColorSpace){return this.r=e,this.g=t,this.b=r,vi.toWorkingColorSpace(this,i),this}setHSL(e,t,r,i=vi.workingColorSpace){if(e=J4(e,1),t=Os(t,0,1),r=Os(r,0,1),0===t)this.r=this.g=this.b=r;else{let i=r<=.5?r*(1+t):r+t-r*t,n=2*r-i;this.r=z5(n,i,e+1/3),this.g=z5(n,i,e),this.b=z5(n,i,e-1/3)}return vi.toWorkingColorSpace(this,i),this}setStyle(e,t=Zr){function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let n,a=i[1],s=i[2];switch(a){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,t);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,t);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){let r=i[1],n=r.length;if(3===n)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(6===n)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Zr){let r=rve[e.toLowerCase()];return void 0!==r?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=By(e.r),this.g=By(e.g),this.b=By(e.b),this}copyLinearToSRGB(e){return this.r=P5(e.r),this.g=P5(e.g),this.b=P5(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Zr){return vi.fromWorkingColorSpace(Ya.copy(this),e),65536*Math.round(Os(255*Ya.r,0,255))+256*Math.round(Os(255*Ya.g,0,255))+Math.round(Os(255*Ya.b,0,255))}getHexString(e=Zr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=vi.workingColorSpace){vi.fromWorkingColorSpace(Ya.copy(this),t);let r,i,n=Ya.r,a=Ya.g,s=Ya.b,o=Math.max(n,a,s),l=Math.min(n,a,s),h=(l+o)/2;if(l===o)r=0,i=0;else{let e=o-l;switch(i=h<=.5?e/(o+l):e/(2-o-l),o){case n:r=(a-s)/e+(a<s?6:0);break;case a:r=(s-n)/e+2;break;case s:r=(n-a)/e+4}r/=6}return e.h=r,e.s=i,e.l=h,e}getRGB(e,t=vi.workingColorSpace){return vi.fromWorkingColorSpace(Ya.copy(this),t),e.r=Ya.r,e.g=Ya.g,e.b=Ya.b,e}getStyle(e=Zr){vi.fromWorkingColorSpace(Ya.copy(this),e);let t=Ya.r,r=Ya.g,i=Ya.b;return e!==Zr?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*r)},${Math.round(255*i)})`}offsetHSL(e,t,r){return this.getHSL(gp),this.setHSL(gp.h+e,gp.s+t,gp.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(gp),e.getHSL(SC);let r=l_(gp.h,SC.h,t),i=l_(gp.s,SC.s,t),n=l_(gp.l,SC.l,t);return this.setHSL(r,i,n),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){let t=this.r,r=this.g,i=this.b,n=e.elements;return this.r=n[0]*t+n[3]*r+n[6]*i,this.g=n[1]*t+n[4]*r+n[7]*i,this.b=n[2]*t+n[5]*r+n[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}},Ya=new dt;dt.NAMES=rve;var Spt=0,qn=class extends mu{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Spt++}),this.uuid=Sl(),this.name="",this.type="Material",this.blending=Pg,this.side=zi,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=h2,this.blendDst=d2,this.blendEquation=jo,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new dt(0,0,0),this.blendAlpha=0,this.depthFunc=f_,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=H6,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=wg,this.stencilZFail=wg,this.stencilZPass=wg,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(let t in e){let r=e[t];if(void 0===r){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}let i=this[t];void 0!==i?i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}toJSON(e){let t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});let r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function i(e){let t=[];for(let r in e){let i=e[r];delete i.metadata,t.push(i)}return t}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),void 0!==this.sheen&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(r.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(r.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(r.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(r.combine=this.combine)),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(r.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(r.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(r.size=this.size),null!==this.shadowSide&&(r.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Pg&&(r.blending=this.blending),this.side!==zi&&(r.side=this.side),!0===this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=!0),this.blendSrc!==h2&&(r.blendSrc=this.blendSrc),this.blendDst!==d2&&(r.blendDst=this.blendDst),this.blendEquation!==jo&&(r.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(r.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(r.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==f_&&(r.depthFunc=this.depthFunc),!1===this.depthTest&&(r.depthTest=this.depthTest),!1===this.depthWrite&&(r.depthWrite=this.depthWrite),!1===this.colorWrite&&(r.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==H6&&(r.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(r.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==wg&&(r.stencilFail=this.stencilFail),this.stencilZFail!==wg&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==wg&&(r.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(r.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.alphaHash&&(r.alphaHash=!0),!0===this.alphaToCoverage&&(r.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=!0),!0===this.forceSinglePass&&(r.forceSinglePass=!0),!0===this.wireframe&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(r.flatShading=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),!1===this.fog&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData),t){let t=i(e.textures),n=i(e.images);t.length>0&&(r.textures=t),n.length>0&&(r.images=n)}return r}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,r=null;if(null!==t){let e=t.length;r=new Array(e);for(let i=0;i!==e;++i)r[i]=t[i].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}},Mr=class extends qn{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new dt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=G_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},Vd=Mpt();function Mpt(){let e=new ArrayBuffer(4),t=new Float32Array(e),r=new Uint32Array(e),i=new Uint32Array(512),n=new Uint32Array(512);for(let e=0;e<256;++e){let t=e-127;t<-27?(i[e]=0,i[256|e]=32768,n[e]=24,n[256|e]=24):t<-14?(i[e]=1024>>-t-14,i[256|e]=1024>>-t-14|32768,n[e]=-t-1,n[256|e]=-t-1):t<=15?(i[e]=t+15<<10,i[256|e]=t+15<<10|32768,n[e]=13,n[256|e]=13):t<128?(i[e]=31744,i[256|e]=64512,n[e]=24,n[256|e]=24):(i[e]=31744,i[256|e]=64512,n[e]=13,n[256|e]=13)}let a=new Uint32Array(2048),s=new Uint32Array(64),o=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,r=0;for(;!(8388608&t);)t<<=1,r-=8388608;t&=-8388609,r+=947912704,a[e]=t|r}for(let e=1024;e<2048;++e)a[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)s[e]=e<<23;s[31]=1199570944,s[32]=2147483648;for(let e=33;e<63;++e)s[e]=2147483648+(e-32<<23);s[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(o[e]=1024);return{floatView:t,uint32View:r,baseTable:i,shiftTable:n,mantissaTable:a,exponentTable:s,offsetTable:o}}function qo(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Os(e,-65504,65504),Vd.floatView[0]=e;let t=Vd.uint32View[0],r=t>>23&511;return Vd.baseTable[r]+((8388607&t)>>Vd.shiftTable[r])}function a_(e){let t=e>>10;return Vd.uint32View[0]=Vd.mantissaTable[Vd.offsetTable[t]+(1023&e)]+Vd.exponentTable[t],Vd.floatView[0]}var nf={toHalfFloat:qo,fromHalfFloat:a_},Xs=new F,MC=new Te,fr=class{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=r,this.usage=E_,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Us,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return console.warn('THREE.BufferAttribute: "updateRange" is deprecated and removed in r169. Use "addUpdateRange()" instead.'),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,n=this.itemSize;i<n;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,r=this.count;t<r;t++)MC.fromBufferAttribute(this,t),MC.applyMatrix3(e),this.setXY(t,MC.x,MC.y);else if(3===this.itemSize)for(let t=0,r=this.count;t<r;t++)Xs.fromBufferAttribute(this,t),Xs.applyMatrix3(e),this.setXYZ(t,Xs.x,Xs.y,Xs.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)Xs.fromBufferAttribute(this,t),Xs.applyMatrix4(e),this.setXYZ(t,Xs.x,Xs.y,Xs.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)Xs.fromBufferAttribute(this,t),Xs.applyNormalMatrix(e),this.setXYZ(t,Xs.x,Xs.y,Xs.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)Xs.fromBufferAttribute(this,t),Xs.transformDirection(e),this.setXYZ(t,Xs.x,Xs.y,Xs.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=Wo(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=On(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Wo(t,this.array)),t}setX(e,t){return this.normalized&&(t=On(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Wo(t,this.array)),t}setY(e,t){return this.normalized&&(t=On(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Wo(t,this.array)),t}setZ(e,t){return this.normalized&&(t=On(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Wo(t,this.array)),t}setW(e,t){return this.normalized&&(t=On(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=On(t,this.array),r=On(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=On(t,this.array),r=On(r,this.array),i=On(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,n){return e*=this.itemSize,this.normalized&&(t=On(t,this.array),r=On(r,this.array),i=On(i,this.array),n=On(n,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==E_&&(e.usage=this.usage),e}},W6=class extends fr{constructor(e,t,r){super(new Int8Array(e),t,r)}},S_=class extends fr{constructor(e,t,r){super(new Uint8Array(e),t,r)}},X6=class extends fr{constructor(e,t,r){super(new Uint8ClampedArray(e),t,r)}},Y6=class extends fr{constructor(e,t,r){super(new Int16Array(e),t,r)}},Dg=class extends fr{constructor(e,t,r){super(new Uint16Array(e),t,r)}},Lg=class extends fr{constructor(e,t,r){super(new Int32Array(e),t,r)}},M_=class extends fr{constructor(e,t,r){super(new Uint32Array(e),t,r)}},$6=class extends fr{constructor(e,t,r){super(new Uint16Array(e),t,r),this.isFloat16BufferAttribute=!0}getX(e){let t=a_(this.array[e*this.itemSize]);return this.normalized&&(t=Wo(t,this.array)),t}setX(e,t){return this.normalized&&(t=On(t,this.array)),this.array[e*this.itemSize]=qo(t),this}getY(e){let t=a_(this.array[e*this.itemSize+1]);return this.normalized&&(t=Wo(t,this.array)),t}setY(e,t){return this.normalized&&(t=On(t,this.array)),this.array[e*this.itemSize+1]=qo(t),this}getZ(e){let t=a_(this.array[e*this.itemSize+2]);return this.normalized&&(t=Wo(t,this.array)),t}setZ(e,t){return this.normalized&&(t=On(t,this.array)),this.array[e*this.itemSize+2]=qo(t),this}getW(e){let t=a_(this.array[e*this.itemSize+3]);return this.normalized&&(t=Wo(t,this.array)),t}setW(e,t){return this.normalized&&(t=On(t,this.array)),this.array[e*this.itemSize+3]=qo(t),this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=On(t,this.array),r=On(r,this.array)),this.array[e+0]=qo(t),this.array[e+1]=qo(r),this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=On(t,this.array),r=On(r,this.array),i=On(i,this.array)),this.array[e+0]=qo(t),this.array[e+1]=qo(r),this.array[e+2]=qo(i),this}setXYZW(e,t,r,i,n){return e*=this.itemSize,this.normalized&&(t=On(t,this.array),r=On(r,this.array),i=On(i,this.array),n=On(n,this.array)),this.array[e+0]=qo(t),this.array[e+1]=qo(r),this.array[e+2]=qo(i),this.array[e+3]=qo(n),this}},zt=class extends fr{constructor(e,t,r){super(new Float32Array(e),t,r)}},Z6=class extends fr{constructor(e,t,r){super(new Float64Array(e),t,r)}},Apt=0,ac=new lt,G5=new yr,yy=new F,Tl=new Vt,JE=new Vt,ga=new F,Nt=class extends mu{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Apt++}),this.uuid=Sl(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(eve(e)?M_:Dg)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);let r=this.attributes.normal;if(void 0!==r){let t=(new Wr).getNormalMatrix(e);r.applyNormalMatrix(t),r.needsUpdate=!0}let i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return ac.makeRotationFromQuaternion(e),this.applyMatrix4(ac),this}rotateX(e){return ac.makeRotationX(e),this.applyMatrix4(ac),this}rotateY(e){return ac.makeRotationY(e),this.applyMatrix4(ac),this}rotateZ(e){return ac.makeRotationZ(e),this.applyMatrix4(ac),this}translate(e,t,r){return ac.makeTranslation(e,t,r),this.applyMatrix4(ac),this}scale(e,t,r){return ac.makeScale(e,t,r),this.applyMatrix4(ac),this}lookAt(e){return G5.lookAt(e),G5.updateMatrix(),this.applyMatrix4(G5.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(yy).negate(),this.translate(yy.x,yy.y,yy.z),this}setFromPoints(e){let t=[];for(let r=0,i=e.length;r<i;r++){let i=e[r];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new zt(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Vt);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new F(-1/0,-1/0,-1/0),new F(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){let r=t[e];Tl.setFromBufferAttribute(r),this.morphTargetsRelative?(ga.addVectors(this.boundingBox.min,Tl.min),this.boundingBox.expandByPoint(ga),ga.addVectors(this.boundingBox.max,Tl.max),this.boundingBox.expandByPoint(ga)):(this.boundingBox.expandByPoint(Tl.min),this.boundingBox.expandByPoint(Tl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Sn);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new F,1/0);if(e){let r=this.boundingSphere.center;if(Tl.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){let r=t[e];JE.setFromBufferAttribute(r),this.morphTargetsRelative?(ga.addVectors(Tl.min,JE.min),Tl.expandByPoint(ga),ga.addVectors(Tl.max,JE.max),Tl.expandByPoint(ga)):(Tl.expandByPoint(JE.min),Tl.expandByPoint(JE.max))}Tl.getCenter(r);let i=0;for(let t=0,n=e.count;t<n;t++)ga.fromBufferAttribute(e,t),i=Math.max(i,r.distanceToSquared(ga));if(t)for(let n=0,a=t.length;n<a;n++){let a=t[n],s=this.morphTargetsRelative;for(let t=0,n=a.count;t<n;t++)ga.fromBufferAttribute(a,t),s&&(yy.fromBufferAttribute(e,t),ga.add(yy)),i=Math.max(i,r.distanceToSquared(ga))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");let r=e.array,i=t.position.array,n=t.normal.array,a=t.uv.array,s=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new fr(new Float32Array(4*s),4));let o=this.getAttribute("tangent").array,l=[],h=[];for(let e=0;e<s;e++)l[e]=new F,h[e]=new F;let c=new F,u=new F,d=new F,p=new Te,f=new Te,m=new Te,g=new F,v=new F;function y(e,t,r){c.fromArray(i,3*e),u.fromArray(i,3*t),d.fromArray(i,3*r),p.fromArray(a,2*e),f.fromArray(a,2*t),m.fromArray(a,2*r),u.sub(c),d.sub(c),f.sub(p),m.sub(p);let n=1/(f.x*m.y-m.x*f.y);isFinite(n)&&(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(n),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(n),l[e].add(g),l[t].add(g),l[r].add(g),h[e].add(v),h[t].add(v),h[r].add(v))}let b=this.groups;0===b.length&&(b=[{start:0,count:r.length}]);for(let e=0,t=b.length;e<t;++e){let t=b[e],i=t.start;for(let e=i,n=i+t.count;e<n;e+=3)y(r[e+0],r[e+1],r[e+2])}let x=new F,_=new F,w=new F,S=new F;function T(e){w.fromArray(n,3*e),S.copy(w);let t=l[e];x.copy(t),x.sub(w.multiplyScalar(w.dot(t))).normalize(),_.crossVectors(S,t);let r=_.dot(h[e])<0?-1:1;o[4*e]=x.x,o[4*e+1]=x.y,o[4*e+2]=x.z,o[4*e+3]=r}for(let e=0,t=b.length;e<t;++e){let t=b[e],i=t.start;for(let e=i,n=i+t.count;e<n;e+=3)T(r[e+0]),T(r[e+1]),T(r[e+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(void 0!==t){let r=this.getAttribute("normal");if(void 0===r)r=new fr(new Float32Array(3*t.count),3),this.setAttribute("normal",r);else for(let e=0,t=r.count;e<t;e++)r.setXYZ(e,0,0,0);let i=new F,n=new F,a=new F,s=new F,o=new F,l=new F,h=new F,c=new F;if(e)for(let u=0,d=e.count;u<d;u+=3){let d=e.getX(u+0),p=e.getX(u+1),f=e.getX(u+2);i.fromBufferAttribute(t,d),n.fromBufferAttribute(t,p),a.fromBufferAttribute(t,f),h.subVectors(a,n),c.subVectors(i,n),h.cross(c),s.fromBufferAttribute(r,d),o.fromBufferAttribute(r,p),l.fromBufferAttribute(r,f),s.add(h),o.add(h),l.add(h),r.setXYZ(d,s.x,s.y,s.z),r.setXYZ(p,o.x,o.y,o.z),r.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,s=t.count;e<s;e+=3)i.fromBufferAttribute(t,e+0),n.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),h.subVectors(a,n),c.subVectors(i,n),h.cross(c),r.setXYZ(e+0,h.x,h.y,h.z),r.setXYZ(e+1,h.x,h.y,h.z),r.setXYZ(e+2,h.x,h.y,h.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){let e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)ga.fromBufferAttribute(e,t),ga.normalize(),e.setXYZ(t,ga.x,ga.y,ga.z)}toNonIndexed(){function e(e,t){let r=e.array,i=e.itemSize,n=e.normalized,a=new r.constructor(t.length*i),s=0,o=0;for(let n=0,l=t.length;n<l;n++){s=e.isInterleavedBufferAttribute?t[n]*e.data.stride+e.offset:t[n]*i;for(let e=0;e<i;e++)a[o++]=r[s++]}return new fr(a,i,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new Nt,r=this.index.array,i=this.attributes;for(let n in i){let a=e(i[n],r);t.setAttribute(n,a)}let n=this.morphAttributes;for(let i in n){let a=[],s=n[i];for(let t=0,i=s.length;t<i;t++){let i=e(s[t],r);a.push(i)}t.morphAttributes[i]=a}t.morphTargetsRelative=this.morphTargetsRelative;let a=this.groups;for(let e=0,r=a.length;e<r;e++){let r=a[e];t.addGroup(r.start,r.count,r.materialIndex)}return t}toJSON(){let e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){let t=this.parameters;for(let r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};let t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let r=this.attributes;for(let t in r){let i=r[t];e.data.attributes[t]=i.toJSON(e.data)}let i={},n=!1;for(let t in this.morphAttributes){let r=this.morphAttributes[t],a=[];for(let t=0,i=r.length;t<i;t++){let i=r[t];a.push(i.toJSON(e.data))}a.length>0&&(i[t]=a,n=!0)}n&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);let a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));let s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let r=e.index;null!==r&&this.setIndex(r.clone(t));let i=e.attributes;for(let e in i){let r=i[e];this.setAttribute(e,r.clone(t))}let n=e.morphAttributes;for(let e in n){let r=[],i=n[e];for(let e=0,n=i.length;e<n;e++)r.push(i[e].clone(t));this.morphAttributes[e]=r}this.morphTargetsRelative=e.morphTargetsRelative;let a=e.groups;for(let e=0,t=a.length;e<t;e++){let t=a[e];this.addGroup(t.start,t.count,t.materialIndex)}let s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());let o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}},qme=new lt,gg=new Za,AC=new Sn,jme=new F,by=new F,xy=new F,Ey=new F,q5=new F,RC=new F,CC=new Te,PC=new Te,IC=new Te,Wme=new F,Xme=new F,Yme=new F,OC=new F,DC=new F,Ht=class extends yr{constructor(e=new Nt,t=new Mr){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){let t=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){let r=this.geometry,i=r.attributes.position,n=r.morphAttributes.position,a=r.morphTargetsRelative;t.fromBufferAttribute(i,e);let s=this.morphTargetInfluences;if(n&&s){RC.set(0,0,0);for(let r=0,i=n.length;r<i;r++){let i=s[r],o=n[r];0!==i&&(q5.fromBufferAttribute(o,e),a?RC.addScaledVector(q5,i):RC.addScaledVector(q5.sub(t),i))}t.add(RC)}return t}raycast(e,t){let r=this.geometry,i=this.material,n=this.matrixWorld;void 0!==i&&(null===r.boundingSphere&&r.computeBoundingSphere(),AC.copy(r.boundingSphere),AC.applyMatrix4(n),gg.copy(e.ray).recast(e.near),(!1!==AC.containsPoint(gg.origin)||!(null===gg.intersectSphere(AC,jme)||gg.origin.distanceToSquared(jme)>Ga(e.far-e.near,2)))&&(qme.copy(n).invert(),gg.copy(e.ray).applyMatrix4(qme),(null===r.boundingBox||!1!==gg.intersectsBox(r.boundingBox))&&this._computeIntersections(e,t,gg)))}_computeIntersections(e,t,r){let i,n=this.geometry,a=this.material,s=n.index,o=n.attributes.position,l=n.attributes.uv,h=n.attributes.uv1,c=n.attributes.normal,u=n.groups,d=n.drawRange;if(null!==s)if(Array.isArray(a))for(let n=0,o=u.length;n<o;n++){let o=u[n],p=a[o.materialIndex];for(let n=Math.max(o.start,d.start),a=Math.min(s.count,Math.min(o.start+o.count,d.start+d.count));n<a;n+=3){i=LC(this,p,e,r,l,h,c,s.getX(n),s.getX(n+1),s.getX(n+2)),i&&(i.faceIndex=Math.floor(n/3),i.face.materialIndex=o.materialIndex,t.push(i))}}else{for(let n=Math.max(0,d.start),o=Math.min(s.count,d.start+d.count);n<o;n+=3){i=LC(this,a,e,r,l,h,c,s.getX(n),s.getX(n+1),s.getX(n+2)),i&&(i.faceIndex=Math.floor(n/3),t.push(i))}}else if(void 0!==o)if(Array.isArray(a))for(let n=0,s=u.length;n<s;n++){let s=u[n],p=a[s.materialIndex];for(let n=Math.max(s.start,d.start),a=Math.min(o.count,Math.min(s.start+s.count,d.start+d.count));n<a;n+=3){i=LC(this,p,e,r,l,h,c,n,n+1,n+2),i&&(i.faceIndex=Math.floor(n/3),i.face.materialIndex=s.materialIndex,t.push(i))}}else{for(let n=Math.max(0,d.start),s=Math.min(o.count,d.start+d.count);n<s;n+=3){i=LC(this,a,e,r,l,h,c,n,n+1,n+2),i&&(i.faceIndex=Math.floor(n/3),t.push(i))}}}};function Rpt(e,t,r,i,n,a,s,o){let l;if(l=t.side===ws?i.intersectTriangle(s,a,n,!0,o):i.intersectTriangle(n,a,s,t.side===zi,o),null===l)return null;DC.copy(o),DC.applyMatrix4(e.matrixWorld);let h=r.ray.origin.distanceTo(DC);return h<r.near||h>r.far?null:{distance:h,point:DC.clone(),object:e}}function LC(e,t,r,i,n,a,s,o,l,h){e.getVertexPosition(o,by),e.getVertexPosition(l,xy),e.getVertexPosition(h,Ey);let c=Rpt(e,t,r,i,by,xy,Ey,OC);if(c){n&&(CC.fromBufferAttribute(n,o),PC.fromBufferAttribute(n,l),IC.fromBufferAttribute(n,h),c.uv=yi.getInterpolation(OC,by,xy,Ey,CC,PC,IC,new Te)),a&&(CC.fromBufferAttribute(a,o),PC.fromBufferAttribute(a,l),IC.fromBufferAttribute(a,h),c.uv1=yi.getInterpolation(OC,by,xy,Ey,CC,PC,IC,new Te),c.uv2=c.uv1),s&&(Wme.fromBufferAttribute(s,o),Xme.fromBufferAttribute(s,l),Yme.fromBufferAttribute(s,h),c.normal=yi.getInterpolation(OC,by,xy,Ey,Wme,Xme,Yme,new F),c.normal.dot(i.direction)>0&&c.normal.multiplyScalar(-1));let e={a:o,b:l,c:h,normal:new F,materialIndex:0};yi.getNormal(by,xy,Ey,e.normal),c.face=e}return c}var lc=class extends Nt{constructor(e=1,t=1,r=1,i=1,n=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:a};let s=this;i=Math.floor(i),n=Math.floor(n),a=Math.floor(a);let o=[],l=[],h=[],c=[],u=0,d=0;function p(e,t,r,i,n,a,p,f,m,g,v){let y=a/m,b=p/g,x=a/2,_=p/2,w=f/2,S=m+1,T=g+1,M=0,E=0,A=new F;for(let a=0;a<T;a++){let s=a*b-_;for(let o=0;o<S;o++){let u=o*y-x;A[e]=u*i,A[t]=s*n,A[r]=w,l.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[r]=f>0?1:-1,h.push(A.x,A.y,A.z),c.push(o/m),c.push(1-a/g),M+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){let r=u+t+S*e,i=u+t+S*(e+1),n=u+(t+1)+S*(e+1),a=u+(t+1)+S*e;o.push(r,i,a),o.push(i,n,a),E+=6}s.addGroup(d,E,v),d+=E,u+=M}p("z","y","x",-1,-1,r,t,e,a,n,0),p("z","y","x",1,-1,r,t,-e,a,n,1),p("x","z","y",1,1,e,r,t,i,a,2),p("x","z","y",1,-1,e,r,-t,i,a,3),p("x","y","z",1,-1,e,t,r,i,n,4),p("x","y","z",-1,-1,e,t,-r,i,n,5),this.setIndex(o),this.setAttribute("position",new zt(l,3)),this.setAttribute("normal",new zt(h,3)),this.setAttribute("uv",new zt(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new lc(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function zy(e){let t={};for(let r in e){t[r]={};for(let i in e[r]){let n=e[r][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[r][i]=null):t[r][i]=n.clone():Array.isArray(n)?t[r][i]=n.slice():t[r][i]=n}}return t}function Eo(e){let t={};for(let r=0;r<e.length;r++){let i=zy(e[r]);for(let e in i)t[e]=i[e]}return t}function Cpt(e){let t=[];for(let r=0;r<e.length;r++)t.push(e[r].clone());return t}function nve(e){return null===e.getRenderTarget()?e.outputColorSpace:vi.workingColorSpace}var xi={clone:zy,merge:Eo},Ppt="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",Ipt="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",xr=class extends qn{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Ppt,this.fragmentShader=Ipt,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=zy(e.uniforms),this.uniformsGroups=Cpt(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let r in this.uniforms){let i=this.uniforms[r].value;i&&i.isTexture?t.uniforms[r]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[r]={type:"m4",value:i.toArray()}:t.uniforms[r]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;let r={};for(let e in this.extensions)!0===this.extensions[e]&&(r[e]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}},kg=class extends yr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new lt,this.projectionMatrix=new lt,this.projectionMatrixInverse=new lt,this.coordinateSystem=cu}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}},ci=class extends kg{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=2*Hy*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(.5*Ig*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Hy*Math.atan(Math.tan(.5*Ig*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,i,n,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(.5*Ig*this.fov)/this.zoom,r=2*t,i=this.aspect*r,n=-.5*i,a=this.view;if(null!==this.view&&this.view.enabled){let e=a.fullWidth,s=a.fullHeight;n+=a.offsetX*i/e,t-=a.offsetY*r/s,i*=a.width/e,r*=a.height/s}let s=this.filmOffset;0!==s&&(n+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+i,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},_y=-90,Ty=1,g2=class extends yr{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;let i=new ci(_y,Ty,e,t);i.layers=this.layers,this.add(i);let n=new ci(_y,Ty,e,t);n.layers=this.layers,this.add(n);let a=new ci(_y,Ty,e,t);a.layers=this.layers,this.add(a);let s=new ci(_y,Ty,e,t);s.layers=this.layers,this.add(s);let o=new ci(_y,Ty,e,t);o.layers=this.layers,this.add(o);let l=new ci(_y,Ty,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){let e=this.coordinateSystem,t=this.children.concat(),[r,i,n,a,s,o]=t;for(let e of t)this.remove(e);if(e===cu)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),n.up.set(0,0,-1),n.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(e!==Uy)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),n.up.set(0,0,1),n.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(let e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();let{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());let[n,a,s,o,l,h]=this.children,c=e.getRenderTarget(),u=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;let f=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,n),e.setRenderTarget(r,1,i),e.render(t,a),e.setRenderTarget(r,2,i),e.render(t,s),e.setRenderTarget(r,3,i),e.render(t,o),e.setRenderTarget(r,4,i),e.render(t,l),r.texture.generateMipmaps=f,e.setRenderTarget(r,5,i),e.render(t,h),e.setRenderTarget(c,u,d),e.xr.enabled=p,r.texture.needsPMREMUpdate=!0}},Fg=class extends bi{constructor(e,t,r,i,n,a,s,o,l,h){super(e=void 0!==e?e:[],t=void 0!==t?t:qd,r,i,n,a,s,o,l,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},v2=class extends yn{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];void 0!==t.encoding&&(c_("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===ph?Zr:Oa),this.texture=new Fg(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:wn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let r={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new lc(5,5,5),n=new xr({name:"CubemapFromEquirect",uniforms:zy(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:ws,blending:Oi});n.uniforms.tEquirect.value=t;let a=new Ht(i,n),s=t.minFilter;return t.minFilter===ia&&(t.minFilter=wn),new g2(1,10,this).update(e,a),t.minFilter=s,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,r,i){let n=e.getRenderTarget();for(let n=0;n<6;n++)e.setRenderTarget(this,n),e.clear(t,r,i);e.setRenderTarget(n)}},j5=new F,Opt=new F,Dpt=new Wr,ii=class{constructor(e=new F(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){let i=j5.subVectors(r,t).cross(Opt.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){let r=e.delta(j5),i=this.normal.dot(r);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;let n=-(e.start.dot(this.normal)+this.constant)/i;return n<0||n>1?null:t.copy(e.start).addScaledVector(r,n)}intersectsLine(e){let t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let r=t||Dpt.getNormalMatrix(e),i=this.coplanarPoint(j5).applyMatrix4(e),n=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}},vg=new Sn,kC=new F,Ml=class{constructor(e=new ii,t=new ii,r=new ii,i=new ii,n=new ii,a=new ii){this.planes=[e,t,r,i,n,a]}set(e,t,r,i,n,a){let s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(r),s[3].copy(i),s[4].copy(n),s[5].copy(a),this}copy(e){let t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=cu){let r=this.planes,i=e.elements,n=i[0],a=i[1],s=i[2],o=i[3],l=i[4],h=i[5],c=i[6],u=i[7],d=i[8],p=i[9],f=i[10],m=i[11],g=i[12],v=i[13],y=i[14],b=i[15];if(r[0].setComponents(o-n,u-l,m-d,b-g).normalize(),r[1].setComponents(o+n,u+l,m+d,b+g).normalize(),r[2].setComponents(o+a,u+h,m+p,b+v).normalize(),r[3].setComponents(o-a,u-h,m-p,b-v).normalize(),r[4].setComponents(o-s,u-c,m-f,b-y).normalize(),t===cu)r[5].setComponents(o+s,u+c,m+f,b+y).normalize();else{if(t!==Uy)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);r[5].setComponents(s,c,f,y).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),vg.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{let t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),vg.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(vg)}intersectsSprite(e){return vg.center.set(0,0,0),vg.radius=.7071067811865476,vg.applyMatrix4(e.matrixWorld),this.intersectsSphere(vg)}intersectsSphere(e){let t=this.planes,r=e.center,i=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){let t=this.planes;for(let r=0;r<6;r++){let i=t[r];if(kC.x=i.normal.x>0?e.max.x:e.min.x,kC.y=i.normal.y>0?e.max.y:e.min.y,kC.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(kC)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}};function ive(){let e=null,t=!1,r=null,i=null;function n(t,a){r(t,a),i=e.requestAnimationFrame(n)}return{start:function(){!0!==t&&null!==r&&(i=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){r=e},setContext:function(t){e=t}}}function Lpt(e,t){let r=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);let r=i.get(t);r&&(e.deleteBuffer(r.buffer),i.delete(t))},update:function(t,n){if(t.isGLBufferAttribute){let e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);let a=i.get(t);if(void 0===a)i.set(t,function(t,i){let n,a=t.array,s=t.usage,o=a.byteLength,l=e.createBuffer();if(e.bindBuffer(i,l),e.bufferData(i,a,s),t.onUploadCallback(),a instanceof Float32Array)n=e.FLOAT;else if(a instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!r)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");n=e.HALF_FLOAT}else n=e.UNSIGNED_SHORT;else if(a instanceof Int16Array)n=e.SHORT;else if(a instanceof Uint32Array)n=e.UNSIGNED_INT;else if(a instanceof Int32Array)n=e.INT;else if(a instanceof Int8Array)n=e.BYTE;else if(a instanceof Uint8Array)n=e.UNSIGNED_BYTE;else{if(!(a instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+a);n=e.UNSIGNED_BYTE}return{buffer:l,type:n,bytesPerElement:a.BYTES_PER_ELEMENT,version:t.version,size:o}}(t,n));else if(a.version<t.version){if(a.size!==t.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");(function(t,i,n){let a=i.array,s=i._updateRange,o=i.updateRanges;if(e.bindBuffer(n,t),-1===s.count&&0===o.length&&e.bufferSubData(n,0,a),0!==o.length){for(let t=0,i=o.length;t<i;t++){let i=o[t];r?e.bufferSubData(n,i.start*a.BYTES_PER_ELEMENT,a,i.start,i.count):e.bufferSubData(n,i.start*a.BYTES_PER_ELEMENT,a.subarray(i.start,i.start+i.count))}i.clearUpdateRanges()}-1!==s.count&&(r?e.bufferSubData(n,s.offset*a.BYTES_PER_ELEMENT,a,s.offset,s.count):e.bufferSubData(n,s.offset*a.BYTES_PER_ELEMENT,a.subarray(s.offset,s.offset+s.count)),s.count=-1),i.onUploadCallback()})(a.buffer,t,n),a.version=t.version}}}}var vs=class extends Nt{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};let n=e/2,a=t/2,s=Math.floor(r),o=Math.floor(i),l=s+1,h=o+1,c=e/s,u=t/o,d=[],p=[],f=[],m=[];for(let e=0;e<h;e++){let t=e*u-a;for(let r=0;r<l;r++){let i=r*c-n;p.push(i,-t,0),f.push(0,0,1),m.push(r/s),m.push(1-e/o)}}for(let e=0;e<o;e++)for(let t=0;t<s;t++){let r=t+l*e,i=t+l*(e+1),n=t+1+l*(e+1),a=t+1+l*e;d.push(r,i,a),d.push(i,n,a)}this.setIndex(d),this.setAttribute("position",new zt(p,3)),this.setAttribute("normal",new zt(f,3)),this.setAttribute("uv",new zt(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new vs(e.width,e.height,e.widthSegments,e.heightSegments)}},kpt="#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",Fpt="#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",Bpt="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",Npt="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",Upt="#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",Hpt="#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",Vpt="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",zpt="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",Gpt="#ifdef USE_BATCHING\n\tattribute float batchId;\n\tuniform highp sampler2D batchingTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",qpt="#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",jpt="vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",Wpt="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",Xpt="float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",Ypt="#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",$pt="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",Zpt="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",Kpt="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",Jpt="#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",Qpt="#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",emt="#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",tmt="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",rmt="#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",nmt="#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",imt="#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",smt="#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",amt="vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",omt="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",lmt="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",cmt="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",umt="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",hmt="gl_FragColor = linearToOutputTexel( gl_FragColor );",dmt="\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",fmt="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",pmt="#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",mmt="#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",gmt="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",vmt="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",ymt="#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",bmt="#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",xmt="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",Emt="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",_mt="#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",Tmt="#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",wmt="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",Smt="LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",Mmt="varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",Amt="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",Rmt="#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",Cmt="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",Pmt="varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",Imt="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",Omt="varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",Dmt="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",Lmt="struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",kmt="\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",Fmt="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",Bmt="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",Nmt="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",Umt="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",Hmt="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",Vmt="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",zmt="#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",Gmt="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",qmt="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",jmt="#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",Wmt="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",Xmt="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",Ymt="#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",$mt="#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",Zmt="#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",Kmt="#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",Jmt="float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",Qmt="#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",egt="#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",tgt="#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",rgt="#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",ngt="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",igt="#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",sgt="#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",agt="#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",ogt="#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",lgt="#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",cgt="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",ugt="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",hgt="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dgt="#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",fgt="#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",pgt="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",mgt="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",ggt="#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",vgt="#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",ygt="#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",bgt="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",xgt="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",Egt="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",_gt="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",Tgt="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",wgt="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",Sgt="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",Mgt="#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",Agt="#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",Rgt="#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",Cgt="#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",Pgt="#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",Igt="#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",Ogt="#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",Dgt="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",Lgt="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",kgt="uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",Fgt="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",Bgt="#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",Ngt="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",Ugt="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",Hgt="#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",Vgt="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",zgt="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",Ggt="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",qgt="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",jgt="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",Wgt="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",Xgt="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",Ygt="#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",$gt="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Zgt="#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",Kgt="#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",Jgt="#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",Qgt="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",e0t="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",t0t="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",r0t="#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",n0t="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",i0t="#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",s0t="#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",a0t="#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",o0t="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",l0t="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",c0t="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",u0t="#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",h0t="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",d0t="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",f0t="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",zr={alphahash_fragment:kpt,alphahash_pars_fragment:Fpt,alphamap_fragment:Bpt,alphamap_pars_fragment:Npt,alphatest_fragment:Upt,alphatest_pars_fragment:Hpt,aomap_fragment:Vpt,aomap_pars_fragment:zpt,batching_pars_vertex:Gpt,batching_vertex:qpt,begin_vertex:jpt,beginnormal_vertex:Wpt,bsdfs:Xpt,iridescence_fragment:Ypt,bumpmap_pars_fragment:$pt,clipping_planes_fragment:Zpt,clipping_planes_pars_fragment:Kpt,clipping_planes_pars_vertex:Jpt,clipping_planes_vertex:Qpt,color_fragment:emt,color_pars_fragment:tmt,color_pars_vertex:rmt,color_vertex:nmt,common:imt,cube_uv_reflection_fragment:smt,defaultnormal_vertex:amt,displacementmap_pars_vertex:omt,displacementmap_vertex:lmt,emissivemap_fragment:cmt,emissivemap_pars_fragment:umt,colorspace_fragment:hmt,colorspace_pars_fragment:dmt,envmap_fragment:fmt,envmap_common_pars_fragment:pmt,envmap_pars_fragment:mmt,envmap_pars_vertex:gmt,envmap_physical_pars_fragment:Rmt,envmap_vertex:vmt,fog_vertex:ymt,fog_pars_vertex:bmt,fog_fragment:xmt,fog_pars_fragment:Emt,gradientmap_pars_fragment:_mt,lightmap_fragment:Tmt,lightmap_pars_fragment:wmt,lights_lambert_fragment:Smt,lights_lambert_pars_fragment:Mmt,lights_pars_begin:Amt,lights_toon_fragment:Cmt,lights_toon_pars_fragment:Pmt,lights_phong_fragment:Imt,lights_phong_pars_fragment:Omt,lights_physical_fragment:Dmt,lights_physical_pars_fragment:Lmt,lights_fragment_begin:kmt,lights_fragment_maps:Fmt,lights_fragment_end:Bmt,logdepthbuf_fragment:Nmt,logdepthbuf_pars_fragment:Umt,logdepthbuf_pars_vertex:Hmt,logdepthbuf_vertex:Vmt,map_fragment:zmt,map_pars_fragment:Gmt,map_particle_fragment:qmt,map_particle_pars_fragment:jmt,metalnessmap_fragment:Wmt,metalnessmap_pars_fragment:Xmt,morphcolor_vertex:Ymt,morphnormal_vertex:$mt,morphtarget_pars_vertex:Zmt,morphtarget_vertex:Kmt,normal_fragment_begin:Jmt,normal_fragment_maps:Qmt,normal_pars_fragment:egt,normal_pars_vertex:tgt,normal_vertex:rgt,normalmap_pars_fragment:ngt,clearcoat_normal_fragment_begin:igt,clearcoat_normal_fragment_maps:sgt,clearcoat_pars_fragment:agt,iridescence_pars_fragment:ogt,opaque_fragment:lgt,packing:cgt,premultiplied_alpha_fragment:ugt,project_vertex:hgt,dithering_fragment:dgt,dithering_pars_fragment:fgt,roughnessmap_fragment:pgt,roughnessmap_pars_fragment:mgt,shadowmap_pars_fragment:ggt,shadowmap_pars_vertex:vgt,shadowmap_vertex:ygt,shadowmask_pars_fragment:bgt,skinbase_vertex:xgt,skinning_pars_vertex:Egt,skinning_vertex:_gt,skinnormal_vertex:Tgt,specularmap_fragment:wgt,specularmap_pars_fragment:Sgt,tonemapping_fragment:Mgt,tonemapping_pars_fragment:Agt,transmission_fragment:Rgt,transmission_pars_fragment:Cgt,uv_pars_fragment:Pgt,uv_pars_vertex:Igt,uv_vertex:Ogt,worldpos_vertex:Dgt,background_vert:Lgt,background_frag:kgt,backgroundCube_vert:Fgt,backgroundCube_frag:Bgt,cube_vert:Ngt,cube_frag:Ugt,depth_vert:Hgt,depth_frag:Vgt,distanceRGBA_vert:zgt,distanceRGBA_frag:Ggt,equirect_vert:qgt,equirect_frag:jgt,linedashed_vert:Wgt,linedashed_frag:Xgt,meshbasic_vert:Ygt,meshbasic_frag:$gt,meshlambert_vert:Zgt,meshlambert_frag:Kgt,meshmatcap_vert:Jgt,meshmatcap_frag:Qgt,meshnormal_vert:e0t,meshnormal_frag:t0t,meshphong_vert:r0t,meshphong_frag:n0t,meshphysical_vert:i0t,meshphysical_frag:s0t,meshtoon_vert:a0t,meshtoon_frag:o0t,points_vert:l0t,points_frag:c0t,shadow_vert:u0t,shadow_frag:h0t,sprite_vert:d0t,sprite_frag:f0t},hr={common:{diffuse:{value:new dt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Wr},alphaMap:{value:null},alphaMapTransform:{value:new Wr},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Wr}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Wr}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Wr}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Wr},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Wr},normalScale:{value:new Te(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Wr},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Wr}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Wr}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Wr}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new dt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new dt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Wr},alphaTest:{value:0},uvTransform:{value:new Wr}},sprite:{diffuse:{value:new dt(16777215)},opacity:{value:1},center:{value:new Te(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Wr},alphaMap:{value:null},alphaMapTransform:{value:new Wr},alphaTest:{value:0}}},Ia={basic:{uniforms:Eo([hr.common,hr.specularmap,hr.envmap,hr.aomap,hr.lightmap,hr.fog]),vertexShader:zr.meshbasic_vert,fragmentShader:zr.meshbasic_frag},lambert:{uniforms:Eo([hr.common,hr.specularmap,hr.envmap,hr.aomap,hr.lightmap,hr.emissivemap,hr.bumpmap,hr.normalmap,hr.displacementmap,hr.fog,hr.lights,{emissive:{value:new dt(0)}}]),vertexShader:zr.meshlambert_vert,fragmentShader:zr.meshlambert_frag},phong:{uniforms:Eo([hr.common,hr.specularmap,hr.envmap,hr.aomap,hr.lightmap,hr.emissivemap,hr.bumpmap,hr.normalmap,hr.displacementmap,hr.fog,hr.lights,{emissive:{value:new dt(0)},specular:{value:new dt(1118481)},shininess:{value:30}}]),vertexShader:zr.meshphong_vert,fragmentShader:zr.meshphong_frag},standard:{uniforms:Eo([hr.common,hr.envmap,hr.aomap,hr.lightmap,hr.emissivemap,hr.bumpmap,hr.normalmap,hr.displacementmap,hr.roughnessmap,hr.metalnessmap,hr.fog,hr.lights,{emissive:{value:new dt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:zr.meshphysical_vert,fragmentShader:zr.meshphysical_frag},toon:{uniforms:Eo([hr.common,hr.aomap,hr.lightmap,hr.emissivemap,hr.bumpmap,hr.normalmap,hr.displacementmap,hr.gradientmap,hr.fog,hr.lights,{emissive:{value:new dt(0)}}]),vertexShader:zr.meshtoon_vert,fragmentShader:zr.meshtoon_frag},matcap:{uniforms:Eo([hr.common,hr.bumpmap,hr.normalmap,hr.displacementmap,hr.fog,{matcap:{value:null}}]),vertexShader:zr.meshmatcap_vert,fragmentShader:zr.meshmatcap_frag},points:{uniforms:Eo([hr.points,hr.fog]),vertexShader:zr.points_vert,fragmentShader:zr.points_frag},dashed:{uniforms:Eo([hr.common,hr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:zr.linedashed_vert,fragmentShader:zr.linedashed_frag},depth:{uniforms:Eo([hr.common,hr.displacementmap]),vertexShader:zr.depth_vert,fragmentShader:zr.depth_frag},normal:{uniforms:Eo([hr.common,hr.bumpmap,hr.normalmap,hr.displacementmap,{opacity:{value:1}}]),vertexShader:zr.meshnormal_vert,fragmentShader:zr.meshnormal_frag},sprite:{uniforms:Eo([hr.sprite,hr.fog]),vertexShader:zr.sprite_vert,fragmentShader:zr.sprite_frag},background:{uniforms:{uvTransform:{value:new Wr},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:zr.background_vert,fragmentShader:zr.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:zr.backgroundCube_vert,fragmentShader:zr.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:zr.cube_vert,fragmentShader:zr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:zr.equirect_vert,fragmentShader:zr.equirect_frag},distanceRGBA:{uniforms:Eo([hr.common,hr.displacementmap,{referencePosition:{value:new F},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:zr.distanceRGBA_vert,fragmentShader:zr.distanceRGBA_frag},shadow:{uniforms:Eo([hr.lights,hr.fog,{color:{value:new dt(0)},opacity:{value:1}}]),vertexShader:zr.shadow_vert,fragmentShader:zr.shadow_frag}};Ia.physical={uniforms:Eo([Ia.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Wr},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Wr},clearcoatNormalScale:{value:new Te(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Wr},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Wr},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Wr},sheen:{value:0},sheenColor:{value:new dt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Wr},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Wr},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Wr},transmissionSamplerSize:{value:new Te},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Wr},attenuationDistance:{value:0},attenuationColor:{value:new dt(0)},specularColor:{value:new dt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Wr},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Wr},anisotropyVector:{value:new Te},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Wr}}]),vertexShader:zr.meshphysical_vert,fragmentShader:zr.meshphysical_frag};var FC={r:0,b:0,g:0};function p0t(e,t,r,i,n,a,s){let o,l,h=new dt(0),c=!0===a?0:1,u=null,d=0,p=null;function f(t,r){t.getRGB(FC,nve(e)),i.buffers.color.setClear(FC.r,FC.g,FC.b,r,s)}return{getClearColor:function(){return h},setClearColor:function(e,t=1){h.set(e),c=t,f(h,c)},getClearAlpha:function(){return c},setClearAlpha:function(e){c=e,f(h,c)},render:function(a,m){let g=!1,v=!0===m.isScene?m.background:null;v&&v.isTexture&&(v=(m.backgroundBlurriness>0?r:t).get(v)),null===v?f(h,c):v&&v.isColor&&(f(v,1),g=!0);let y=e.xr.getEnvironmentBlendMode();"additive"===y?i.buffers.color.setClear(0,0,0,1,s):"alpha-blend"===y&&i.buffers.color.setClear(0,0,0,0,s),(e.autoClear||g)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),v&&(v.isCubeTexture||v.mapping===c1)?(void 0===l&&(l=new Ht(new lc(1,1,1),new xr({name:"BackgroundCubeMaterial",uniforms:zy(Ia.backgroundCube.uniforms),vertexShader:Ia.backgroundCube.vertexShader,fragmentShader:Ia.backgroundCube.fragmentShader,side:ws,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(l)),l.material.uniforms.envMap.value=v,l.material.uniforms.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,l.material.toneMapped=vi.getTransfer(v.colorSpace)!==es,(u!==v||d!==v.version||p!==e.toneMapping)&&(l.material.needsUpdate=!0,u=v,d=v.version,p=e.toneMapping),l.layers.enableAll(),a.unshift(l,l.geometry,l.material,0,0,null)):v&&v.isTexture&&(void 0===o&&(o=new Ht(new vs(2,2),new xr({name:"BackgroundMaterial",uniforms:zy(Ia.background.uniforms),vertexShader:Ia.background.vertexShader,fragmentShader:Ia.background.fragmentShader,side:zi,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=v,o.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,o.material.toneMapped=vi.getTransfer(v.colorSpace)!==es,!0===v.matrixAutoUpdate&&v.updateMatrix(),o.material.uniforms.uvTransform.value.copy(v.matrix),(u!==v||d!==v.version||p!==e.toneMapping)&&(o.material.needsUpdate=!0,u=v,d=v.version,p=e.toneMapping),o.layers.enableAll(),a.unshift(o,o.geometry,o.material,0,0,null))}}}function m0t(e,t,r,i){let n=e.getParameter(e.MAX_VERTEX_ATTRIBS),a=i.isWebGL2?null:t.get("OES_vertex_array_object"),s=i.isWebGL2||null!==a,o={},l=p(null),h=l,c=!1;function u(t){return i.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function d(t){return i.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function p(e){let t=[],r=[],i=[];for(let e=0;e<n;e++)t[e]=0,r[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:r,attributeDivisors:i,object:e,attributes:{},index:null}}function f(){let e=h.newAttributes;for(let t=0,r=e.length;t<r;t++)e[t]=0}function m(e){g(e,0)}function g(r,n){let a=h.newAttributes,s=h.enabledAttributes,o=h.attributeDivisors;a[r]=1,0===s[r]&&(e.enableVertexAttribArray(r),s[r]=1),o[r]!==n&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,n),o[r]=n)}function v(){let t=h.newAttributes,r=h.enabledAttributes;for(let i=0,n=r.length;i<n;i++)r[i]!==t[i]&&(e.disableVertexAttribArray(i),r[i]=0)}function y(t,r,i,n,a,s,o){!0===o?e.vertexAttribIPointer(t,r,i,a,s):e.vertexAttribPointer(t,r,i,n,a,s)}function b(){x(),c=!0,h!==l&&(h=l,u(h.object))}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(n,l,d,b,x){let _=!1;if(s){let t=function(t,r,n){let s=!0===n.wireframe,l=o[t.id];void 0===l&&(l={},o[t.id]=l);let h=l[r.id];void 0===h&&(h={},l[r.id]=h);let c=h[s];return void 0===c&&(c=p(i.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),h[s]=c),c}(b,d,l);h!==t&&(h=t,u(h.object)),_=function(e,t,r,i){let n=h.attributes,a=t.attributes,s=0,o=r.getAttributes();for(let t in o)if(o[t].location>=0){let r=n[t],i=a[t];if(void 0===i&&("instanceMatrix"===t&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(i=e.instanceColor)),void 0===r||r.attribute!==i||i&&r.data!==i.data)return!0;s++}return h.attributesNum!==s||h.index!==i}(n,b,d,x),_&&function(e,t,r,i){let n={},a=t.attributes,s=0,o=r.getAttributes();for(let t in o)if(o[t].location>=0){let r=a[t];void 0===r&&("instanceMatrix"===t&&e.instanceMatrix&&(r=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(r=e.instanceColor));let i={};i.attribute=r,r&&r.data&&(i.data=r.data),n[t]=i,s++}h.attributes=n,h.attributesNum=s,h.index=i}(n,b,d,x)}else{let e=!0===l.wireframe;(h.geometry!==b.id||h.program!==d.id||h.wireframe!==e)&&(h.geometry=b.id,h.program=d.id,h.wireframe=e,_=!0)}null!==x&&r.update(x,e.ELEMENT_ARRAY_BUFFER),(_||c)&&(c=!1,function(n,a,s,o){if(!1===i.isWebGL2&&(n.isInstancedMesh||o.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();let l=o.attributes,h=s.getAttributes(),c=a.defaultAttributeValues;for(let t in h){let a=h[t];if(a.location>=0){let s=l[t];if(void 0===s&&("instanceMatrix"===t&&n.instanceMatrix&&(s=n.instanceMatrix),"instanceColor"===t&&n.instanceColor&&(s=n.instanceColor)),void 0!==s){let t=s.normalized,l=s.itemSize,h=r.get(s);if(void 0===h)continue;let c=h.buffer,u=h.type,d=h.bytesPerElement,p=!0===i.isWebGL2&&(u===e.INT||u===e.UNSIGNED_INT||s.gpuType===z4);if(s.isInterleavedBufferAttribute){let r=s.data,i=r.stride,h=s.offset;if(r.isInstancedInterleavedBuffer){for(let e=0;e<a.locationSize;e++)g(a.location+e,r.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=r.meshPerAttribute*r.count)}else for(let e=0;e<a.locationSize;e++)m(a.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<a.locationSize;e++)y(a.location+e,l/a.locationSize,u,t,i*d,(h+l/a.locationSize*e)*d,p)}else{if(s.isInstancedBufferAttribute){for(let e=0;e<a.locationSize;e++)g(a.location+e,s.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let e=0;e<a.locationSize;e++)m(a.location+e);e.bindBuffer(e.ARRAY_BUFFER,c);for(let e=0;e<a.locationSize;e++)y(a.location+e,l/a.locationSize,u,t,l*d,l/a.locationSize*e*d,p)}}else if(void 0!==c){let r=c[t];if(void 0!==r)switch(r.length){case 2:e.vertexAttrib2fv(a.location,r);break;case 3:e.vertexAttrib3fv(a.location,r);break;case 4:e.vertexAttrib4fv(a.location,r);break;default:e.vertexAttrib1fv(a.location,r)}}}}v()}(n,l,d,b),null!==x&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.get(x).buffer))},reset:b,resetDefaultState:x,dispose:function(){b();for(let e in o){let t=o[e];for(let e in t){let r=t[e];for(let e in r)d(r[e].object),delete r[e];delete t[e]}delete o[e]}},releaseStatesOfGeometry:function(e){if(void 0===o[e.id])return;let t=o[e.id];for(let e in t){let r=t[e];for(let e in r)d(r[e].object),delete r[e];delete t[e]}delete o[e.id]},releaseStatesOfProgram:function(e){for(let t in o){let r=o[t];if(void 0===r[e.id])continue;let i=r[e.id];for(let e in i)d(i[e].object),delete i[e];delete r[e.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:v}}function g0t(e,t,r,i){let n,a=i.isWebGL2;this.setMode=function(e){n=e},this.render=function(t,i){e.drawArrays(n,t,i),r.update(i,n,1)},this.renderInstances=function(i,s,o){if(0===o)return;let l,h;if(a)l=e,h="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[h](n,i,s,o),r.update(s,n,o)},this.renderMultiDraw=function(e,i,a){if(0===a)return;let s=t.get("WEBGL_multi_draw");if(null===s)for(let t=0;t<a;t++)this.render(e[t],i[t]);else{s.multiDrawArraysWEBGL(n,e,0,i,0,a);let t=0;for(let e=0;e<a;e++)t+=i[e];r.update(t,n,1)}}}function v0t(e,t,r){let i;function n(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let a="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name,s=void 0!==r.precision?r.precision:"highp",o=n(s);o!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",o,"instead."),s=o);let l=a||t.has("WEBGL_draw_buffers"),h=!0===r.logarithmicDepthBuffer,c=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),u=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_TEXTURE_SIZE),p=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),v=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),y=u>0,b=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){let r=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:n,precision:s,logarithmicDepthBuffer:h,maxTextures:c,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:b,floatVertexTextures:y&&b,maxSamples:a?e.getParameter(e.MAX_SAMPLES):0}}function y0t(e){let t=this,r=null,i=0,n=!1,a=!1,s=new ii,o=new Wr,l={value:null,needsUpdate:!1};function h(e,r,i,n){let a=null!==e?e.length:0,h=null;if(0!==a){if(h=l.value,!0!==n||null===h){let t=i+4*a,n=r.matrixWorldInverse;o.getNormalMatrix(n),(null===h||h.length<t)&&(h=new Float32Array(t));for(let t=0,r=i;t!==a;++t,r+=4)s.copy(e[t]).applyMatrix4(n,o),s.normal.toArray(h,r),h[r+3]=s.constant}l.value=h,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,h}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){let r=0!==e.length||t||0!==i||n;return n=t,i=e.length,r},this.beginShadows=function(){a=!0,h(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){r=h(e,t,0)},this.setState=function(s,o,c){let u=s.clippingPlanes,d=s.clipIntersection,p=s.clipShadows,f=e.get(s);if(!n||null===u||0===u.length||a&&!p)a?h(null):(l.value!==r&&(l.value=r,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0);else{let e=a?0:i,t=4*e,n=f.clippingState||null;l.value=n,n=h(u,o,t,c);for(let e=0;e!==t;++e)n[e]=r[e];f.clippingState=n,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function b0t(e){let t=new WeakMap;function r(e,t){return t===Og?e.mapping=qd:t===p_&&(e.mapping=xp),e}function i(e){let r=e.target;r.removeEventListener("dispose",i);let n=t.get(r);void 0!==n&&(t.delete(r),n.dispose())}return{get:function(n){if(n&&n.isTexture){let a=n.mapping;if(a===Og||a===p_){if(t.has(n)){return r(t.get(n).texture,n.mapping)}{let a=n.image;if(a&&a.height>0){let s=new v2(a.height/2);return s.fromEquirectangularTexture(e,n),t.set(n,s),n.addEventListener("dispose",i),r(s.texture,n.mapping)}return null}}}return n},dispose:function(){t=new WeakMap}}}var Gi=class extends kg{constructor(e=-1,t=1,r=1,i=-1,n=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=n,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,n,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2,n=r-e,a=r+e,s=i+t,o=i-t;if(null!==this.view&&this.view.enabled){let e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=e*this.view.offsetX,a=n+e*this.view.width,s-=t*this.view.offsetY,o=s-t*this.view.height}this.projectionMatrix.makeOrthographic(n,a,s,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}},Oy=4,$me=[.125,.215,.35,.446,.526,.582],Mg=20,W5=new Gi,Zme=new dt,X5=null,Y5=0,$5=0,Sg=(1+Math.sqrt(5))/2,wy=1/Sg,Kme=[new F(1,1,1),new F(-1,1,1),new F(1,1,-1),new F(-1,1,-1),new F(0,Sg,wy),new F(0,Sg,-wy),new F(wy,0,Sg),new F(-wy,0,Sg),new F(Sg,wy,0),new F(-Sg,wy,0)],Wd=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100){X5=this._renderer.getRenderTarget(),Y5=this._renderer.getActiveCubeFace(),$5=this._renderer.getActiveMipmapLevel(),this._setSize(256);let n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(e,r,i,n),t>0&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=ege(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Qme(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(X5,Y5,$5),e.scissorTest=!1,BC(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===qd||e.mapping===xp?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),X5=this._renderer.getRenderTarget(),Y5=this._renderer.getActiveCubeFace(),$5=this._renderer.getActiveMipmapLevel();let r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:wn,minFilter:wn,generateMipmaps:!1,type:Cn,format:gs,colorSpace:Hi,depthBuffer:!1},i=Jme(e,t,r);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Jme(e,t,r);let{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=x0t(i)),this._blurMaterial=E0t(i,e,t)}return i}_compileMaterial(e){let t=new Ht(this._lodPlanes[0],e);this._renderer.compile(t,W5)}_sceneToCubeUV(e,t,r,i){let n=new ci(90,1,t,r),a=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,h=o.toneMapping;o.getClearColor(Zme),o.toneMapping=Gd,o.autoClear=!1;let c=new Mr({name:"PMREM.Background",side:ws,depthWrite:!1,depthTest:!1}),u=new Ht(new lc,c),d=!1,p=e.background;p?p.isColor&&(c.color.copy(p),e.background=null,d=!0):(c.color.copy(Zme),d=!0);for(let t=0;t<6;t++){let r=t%3;0===r?(n.up.set(0,a[t],0),n.lookAt(s[t],0,0)):1===r?(n.up.set(0,0,a[t]),n.lookAt(0,s[t],0)):(n.up.set(0,a[t],0),n.lookAt(0,0,s[t]));let l=this._cubeSize;BC(i,r*l,t>2?l:0,l,l),o.setRenderTarget(i),d&&o.render(u,n),o.render(e,n)}u.geometry.dispose(),u.material.dispose(),o.toneMapping=h,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){let r=this._renderer,i=e.mapping===qd||e.mapping===xp;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=ege()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Qme());let n=i?this._cubemapMaterial:this._equirectMaterial,a=new Ht(this._lodPlanes[0],n);n.uniforms.envMap.value=e;let s=this._cubeSize;BC(t,0,0,3*s,2*s),r.setRenderTarget(t),r.render(a,W5)}_applyPMREM(e){let t=this._renderer,r=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){let r=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),i=Kme[(t-1)%Kme.length];this._blur(e,t-1,t,r,i)}t.autoClear=r}_blur(e,t,r,i,n){let a=this._pingPongRenderTarget;this._halfBlur(e,a,t,r,i,"latitudinal",n),this._halfBlur(a,e,r,r,i,"longitudinal",n)}_halfBlur(e,t,r,i,n,a,s){let o=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");let h=new Ht(this._lodPlanes[i],l),c=l.uniforms,u=this._sizeLods[r]-1,d=isFinite(n)?Math.PI/(2*u):2*Math.PI/(2*Mg-1),p=n/d,f=isFinite(n)?1+Math.floor(3*p):Mg;f>Mg&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${f} samples when the maximum is set to ${Mg}`);let m=[],g=0;for(let e=0;e<Mg;++e){let t=e/p,r=Math.exp(-t*t/2);m.push(r),0===e?g+=r:e<f&&(g+=2*r)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;c.envMap.value=e.texture,c.samples.value=f,c.weights.value=m,c.latitudinal.value="latitudinal"===a,s&&(c.poleAxis.value=s);let{_lodMax:v}=this;c.dTheta.value=d,c.mipInt.value=v-r;let y=this._sizeLods[i];BC(t,3*y*(i>v-Oy?i-v+Oy:0),4*(this._cubeSize-y),3*y,2*y),o.setRenderTarget(t),o.render(h,W5)}};function x0t(e){let t=[],r=[],i=[],n=e,a=e-Oy+1+$me.length;for(let s=0;s<a;s++){let a=Math.pow(2,n);r.push(a);let o=1/a;s>e-Oy?o=$me[s-e+Oy-1]:0===s&&(o=0),i.push(o);let l=1/(a-2),h=-l,c=1+l,u=[h,h,c,h,c,c,h,h,c,c,h,c],d=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*d),y=new Float32Array(m*p*d),b=new Float32Array(g*p*d);for(let e=0;e<d;e++){let t=e%3*2/3-1,r=e>2?0:-1,i=[t,r,0,t+2/3,r,0,t+2/3,r+1,0,t,r,0,t+2/3,r+1,0,t,r+1,0];v.set(i,f*p*e),y.set(u,m*p*e);let n=[e,e,e,e,e,e];b.set(n,g*p*e)}let x=new Nt;x.setAttribute("position",new fr(v,f)),x.setAttribute("uv",new fr(y,m)),x.setAttribute("faceIndex",new fr(b,g)),t.push(x),n>Oy&&n--}return{lodPlanes:t,sizeLods:r,sigmas:i}}function Jme(e,t,r){let i=new yn(e,t,r);return i.texture.mapping=c1,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function BC(e,t,r,i,n){e.viewport.set(t,r,i,n),e.scissor.set(t,r,i,n)}function E0t(e,t,r){let i=new Float32Array(Mg),n=new F(0,1,0);return new xr({name:"SphericalGaussianBlur",defines:{n:Mg,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/r,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:Q4(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:Oi,depthTest:!1,depthWrite:!1})}function Qme(){return new xr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Q4(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:Oi,depthTest:!1,depthWrite:!1})}function ege(){return new xr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Q4(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:Oi,depthTest:!1,depthWrite:!1})}function Q4(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function _0t(e){let t=new WeakMap,r=null;function i(e){let r=e.target;r.removeEventListener("dispose",i);let n=t.get(r);void 0!==n&&(t.delete(r),n.dispose())}return{get:function(n){if(n&&n.isTexture){let a=n.mapping,s=a===Og||a===p_,o=a===qd||a===xp;if(s||o){if(n.isRenderTargetTexture&&!0===n.needsPMREMUpdate){n.needsPMREMUpdate=!1;let i=t.get(n);return null===r&&(r=new Wd(e)),i=s?r.fromEquirectangular(n,i):r.fromCubemap(n,i),t.set(n,i),i.texture}if(t.has(n))return t.get(n).texture;{let a=n.image;if(s&&a&&a.height>0||o&&a&&function(e){let t=0,r=6;for(let i=0;i<r;i++)void 0!==e[i]&&t++;return t===r}(a)){null===r&&(r=new Wd(e));let a=s?r.fromEquirectangular(n):r.fromCubemap(n);return t.set(n,a),n.addEventListener("dispose",i),a.texture}return null}}}return n},dispose:function(){t=new WeakMap,null!==r&&(r.dispose(),r=null)}}}function T0t(e){let t={};function r(r){if(void 0!==t[r])return t[r];let i;switch(r){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(r)}return t[r]=i,i}return{has:function(e){return null!==r(e)},init:function(e){e.isWebGL2?r("EXT_color_buffer_float"):(r("WEBGL_depth_texture"),r("OES_texture_float"),r("OES_texture_half_float"),r("OES_texture_half_float_linear"),r("OES_standard_derivatives"),r("OES_element_index_uint"),r("OES_vertex_array_object"),r("ANGLE_instanced_arrays")),r("OES_texture_float_linear"),r("EXT_color_buffer_half_float"),r("WEBGL_multisampled_render_to_texture")},get:function(e){let t=r(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function w0t(e,t,r,i){let n={},a=new WeakMap;function s(e){let o=e.target;null!==o.index&&t.remove(o.index);for(let e in o.attributes)t.remove(o.attributes[e]);for(let e in o.morphAttributes){let r=o.morphAttributes[e];for(let e=0,i=r.length;e<i;e++)t.remove(r[e])}o.removeEventListener("dispose",s),delete n[o.id];let l=a.get(o);l&&(t.remove(l),a.delete(o)),i.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,r.memory.geometries--}function o(e){let r=[],i=e.index,n=e.attributes.position,s=0;if(null!==i){let e=i.array;s=i.version;for(let t=0,i=e.length;t<i;t+=3){let i=e[t+0],n=e[t+1],a=e[t+2];r.push(i,n,n,a,a,i)}}else{if(void 0===n)return;{let e=n.array;s=n.version;for(let t=0,i=e.length/3-1;t<i;t+=3){let e=t+0,i=t+1,n=t+2;r.push(e,i,i,n,n,e)}}}let o=new(eve(r)?M_:Dg)(r,1);o.version=s;let l=a.get(e);l&&t.remove(l),a.set(e,o)}return{get:function(e,t){return!0===n[t.id]||(t.addEventListener("dispose",s),n[t.id]=!0,r.memory.geometries++),t},update:function(r){let i=r.attributes;for(let r in i)t.update(i[r],e.ARRAY_BUFFER);let n=r.morphAttributes;for(let r in n){let i=n[r];for(let r=0,n=i.length;r<n;r++)t.update(i[r],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){let t=a.get(e);if(t){let r=e.index;null!==r&&t.version<r.version&&o(e)}else o(e);return a.get(e)}}}function S0t(e,t,r,i){let n,a,s,o=i.isWebGL2;this.setMode=function(e){n=e},this.setIndex=function(e){a=e.type,s=e.bytesPerElement},this.render=function(t,i){e.drawElements(n,i,a,t*s),r.update(i,n,1)},this.renderInstances=function(i,l,h){if(0===h)return;let c,u;if(o)c=e,u="drawElementsInstanced";else if(c=t.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[u](n,l,a,i*s,h),r.update(l,n,h)},this.renderMultiDraw=function(e,i,o){if(0===o)return;let l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<o;t++)this.render(e[t]/s,i[t]);else{l.multiDrawElementsWEBGL(n,i,0,a,e,0,o);let t=0;for(let e=0;e<o;e++)t+=i[e];r.update(t,n,1)}}}function M0t(e){let t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(r,i,n){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=n*(r/3);break;case e.LINES:t.lines+=n*(r/2);break;case e.LINE_STRIP:t.lines+=n*(r-1);break;case e.LINE_LOOP:t.lines+=n*r;break;case e.POINTS:t.points+=n*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function A0t(e,t){return e[0]-t[0]}function R0t(e,t){return Math.abs(t[1])-Math.abs(e[1])}function C0t(e,t,r){let i={},n=new Float32Array(8),a=new WeakMap,s=new Fn,o=[];for(let e=0;e<8;e++)o[e]=[e,0];return{update:function(l,h,c){let u=l.morphTargetInfluences;if(!0===t.isWebGL2){let i=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,n=void 0!==i?i.length:0,o=a.get(h);if(void 0===o||o.count!==n){let e=function(){v.dispose(),a.delete(h),h.removeEventListener("dispose",e)};void 0!==o&&o.texture.dispose();let r=void 0!==h.morphAttributes.position,i=void 0!==h.morphAttributes.normal,l=void 0!==h.morphAttributes.color,c=h.morphAttributes.position||[],u=h.morphAttributes.normal||[],d=h.morphAttributes.color||[],p=0;!0===r&&(p=1),!0===i&&(p=2),!0===l&&(p=3);let f=h.attributes.position.count*p,m=1;f>t.maxTextureSize&&(m=Math.ceil(f/t.maxTextureSize),f=t.maxTextureSize);let g=new Float32Array(f*m*4*n),v=new Vy(g,f,m,n);v.type=Us,v.needsUpdate=!0;let y=4*p;for(let e=0;e<n;e++){let t=c[e],n=u[e],a=d[e],o=f*m*4*e;for(let e=0;e<t.count;e++){let h=e*y;!0===r&&(s.fromBufferAttribute(t,e),g[o+h+0]=s.x,g[o+h+1]=s.y,g[o+h+2]=s.z,g[o+h+3]=0),!0===i&&(s.fromBufferAttribute(n,e),g[o+h+4]=s.x,g[o+h+5]=s.y,g[o+h+6]=s.z,g[o+h+7]=0),!0===l&&(s.fromBufferAttribute(a,e),g[o+h+8]=s.x,g[o+h+9]=s.y,g[o+h+10]=s.z,g[o+h+11]=4===a.itemSize?s.w:1)}}o={count:n,texture:v,size:new Te(f,m)},a.set(h,o),h.addEventListener("dispose",e)}let l=0;for(let e=0;e<u.length;e++)l+=u[e];let d=h.morphTargetsRelative?1:1-l;c.getUniforms().setValue(e,"morphTargetBaseInfluence",d),c.getUniforms().setValue(e,"morphTargetInfluences",u),c.getUniforms().setValue(e,"morphTargetsTexture",o.texture,r),c.getUniforms().setValue(e,"morphTargetsTextureSize",o.size)}else{let t=void 0===u?0:u.length,r=i[h.id];if(void 0===r||r.length!==t){r=[];for(let e=0;e<t;e++)r[e]=[e,0];i[h.id]=r}for(let e=0;e<t;e++){let t=r[e];t[0]=e,t[1]=u[e]}r.sort(R0t);for(let e=0;e<8;e++)e<t&&r[e][1]?(o[e][0]=r[e][0],o[e][1]=r[e][1]):(o[e][0]=Number.MAX_SAFE_INTEGER,o[e][1]=0);o.sort(A0t);let a=h.morphAttributes.position,s=h.morphAttributes.normal,l=0;for(let e=0;e<8;e++){let t=o[e],r=t[0],i=t[1];r!==Number.MAX_SAFE_INTEGER&&i?(a&&h.getAttribute("morphTarget"+e)!==a[r]&&h.setAttribute("morphTarget"+e,a[r]),s&&h.getAttribute("morphNormal"+e)!==s[r]&&h.setAttribute("morphNormal"+e,s[r]),n[e]=i,l+=i):(a&&!0===h.hasAttribute("morphTarget"+e)&&h.deleteAttribute("morphTarget"+e),s&&!0===h.hasAttribute("morphNormal"+e)&&h.deleteAttribute("morphNormal"+e),n[e]=0)}let d=h.morphTargetsRelative?1:1-l;c.getUniforms().setValue(e,"morphTargetBaseInfluence",d),c.getUniforms().setValue(e,"morphTargetInfluences",n)}}}}function P0t(e,t,r,i){let n=new WeakMap;function a(e){let t=e.target;t.removeEventListener("dispose",a),r.remove(t.instanceMatrix),null!==t.instanceColor&&r.remove(t.instanceColor)}return{update:function(s){let o=i.render.frame,l=s.geometry,h=t.get(s,l);if(n.get(h)!==o&&(t.update(h),n.set(h,o)),s.isInstancedMesh&&(!1===s.hasEventListener("dispose",a)&&s.addEventListener("dispose",a),n.get(s)!==o&&(r.update(s.instanceMatrix,e.ARRAY_BUFFER),null!==s.instanceColor&&r.update(s.instanceColor,e.ARRAY_BUFFER),n.set(s,o))),s.isSkinnedMesh){let e=s.skeleton;n.get(e)!==o&&(e.update(),n.set(e,o))}return h},dispose:function(){n=new WeakMap}}}var Xd=class extends bi{constructor(e,t,r,i,n,a,s,o,l,h){if((h=void 0!==h?h:bp)!==bp&&h!==pu)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&h===bp&&(r=zd),void 0===r&&h===pu&&(r=oc),super(null,i,n,a,s,o,h,r,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==s?s:ni,this.minFilter=void 0!==o?o:ni,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){let t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}},sve=new bi,ave=new Xd(1,1);ave.compareFunction=K4;var ove=new Vy,lve=new w_,cve=new Fg,tge=[],rge=[],nge=new Float32Array(16),ige=new Float32Array(9),sge=new Float32Array(4);function d1(e,t,r){let i=e[0];if(i<=0||i>0)return e;let n=t*r,a=tge[n];if(void 0===a&&(a=new Float32Array(n),tge[n]=a),0!==t){i.toArray(a,0);for(let i=1,n=0;i!==t;++i)n+=r,e[i].toArray(a,n)}return a}function sa(e,t){if(e.length!==t.length)return!1;for(let r=0,i=e.length;r<i;r++)if(e[r]!==t[r])return!1;return!0}function aa(e,t){for(let r=0,i=t.length;r<i;r++)e[r]=t[r]}function Y2(e,t){let r=rge[t];void 0===r&&(r=new Int32Array(t),rge[t]=r);for(let i=0;i!==t;++i)r[i]=e.allocateTextureUnit();return r}function I0t(e,t){let r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function O0t(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(sa(r,t))return;e.uniform2fv(this.addr,t),aa(r,t)}}function D0t(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(void 0!==t.r)(r[0]!==t.r||r[1]!==t.g||r[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(sa(r,t))return;e.uniform3fv(this.addr,t),aa(r,t)}}function L0t(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z||r[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(sa(r,t))return;e.uniform4fv(this.addr,t),aa(r,t)}}function k0t(e,t){let r=this.cache,i=t.elements;if(void 0===i){if(sa(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),aa(r,t)}else{if(sa(r,i))return;sge.set(i),e.uniformMatrix2fv(this.addr,!1,sge),aa(r,i)}}function F0t(e,t){let r=this.cache,i=t.elements;if(void 0===i){if(sa(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),aa(r,t)}else{if(sa(r,i))return;ige.set(i),e.uniformMatrix3fv(this.addr,!1,ige),aa(r,i)}}function B0t(e,t){let r=this.cache,i=t.elements;if(void 0===i){if(sa(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),aa(r,t)}else{if(sa(r,i))return;nge.set(i),e.uniformMatrix4fv(this.addr,!1,nge),aa(r,i)}}function N0t(e,t){let r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function U0t(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(sa(r,t))return;e.uniform2iv(this.addr,t),aa(r,t)}}function H0t(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else{if(sa(r,t))return;e.uniform3iv(this.addr,t),aa(r,t)}}function V0t(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z||r[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(sa(r,t))return;e.uniform4iv(this.addr,t),aa(r,t)}}function z0t(e,t){let r=this.cache;r[0]!==t&&(e.uniform1ui(this.addr,t),r[0]=t)}function G0t(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(sa(r,t))return;e.uniform2uiv(this.addr,t),aa(r,t)}}function q0t(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else{if(sa(r,t))return;e.uniform3uiv(this.addr,t),aa(r,t)}}function j0t(e,t){let r=this.cache;if(void 0!==t.x)(r[0]!==t.x||r[1]!==t.y||r[2]!==t.z||r[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(sa(r,t))return;e.uniform4uiv(this.addr,t),aa(r,t)}}function W0t(e,t,r){let i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n);let a=this.type===e.SAMPLER_2D_SHADOW?ave:sve;r.setTexture2D(t||a,n)}function X0t(e,t,r){let i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture3D(t||lve,n)}function Y0t(e,t,r){let i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTextureCube(t||cve,n)}function $0t(e,t,r){let i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture2DArray(t||ove,n)}function Z0t(e){switch(e){case 5126:return I0t;case 35664:return O0t;case 35665:return D0t;case 35666:return L0t;case 35674:return k0t;case 35675:return F0t;case 35676:return B0t;case 5124:case 35670:return N0t;case 35667:case 35671:return U0t;case 35668:case 35672:return H0t;case 35669:case 35673:return V0t;case 5125:return z0t;case 36294:return G0t;case 36295:return q0t;case 36296:return j0t;case 35678:case 36198:case 36298:case 36306:case 35682:return W0t;case 35679:case 36299:case 36307:return X0t;case 35680:case 36300:case 36308:case 36293:return Y0t;case 36289:case 36303:case 36311:case 36292:return $0t}}function K0t(e,t){e.uniform1fv(this.addr,t)}function J0t(e,t){let r=d1(t,this.size,2);e.uniform2fv(this.addr,r)}function Q0t(e,t){let r=d1(t,this.size,3);e.uniform3fv(this.addr,r)}function evt(e,t){let r=d1(t,this.size,4);e.uniform4fv(this.addr,r)}function tvt(e,t){let r=d1(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,r)}function rvt(e,t){let r=d1(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,r)}function nvt(e,t){let r=d1(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,r)}function ivt(e,t){e.uniform1iv(this.addr,t)}function svt(e,t){e.uniform2iv(this.addr,t)}function avt(e,t){e.uniform3iv(this.addr,t)}function ovt(e,t){e.uniform4iv(this.addr,t)}function lvt(e,t){e.uniform1uiv(this.addr,t)}function cvt(e,t){e.uniform2uiv(this.addr,t)}function uvt(e,t){e.uniform3uiv(this.addr,t)}function hvt(e,t){e.uniform4uiv(this.addr,t)}function dvt(e,t,r){let i=this.cache,n=t.length,a=Y2(r,n);sa(i,a)||(e.uniform1iv(this.addr,a),aa(i,a));for(let e=0;e!==n;++e)r.setTexture2D(t[e]||sve,a[e])}function fvt(e,t,r){let i=this.cache,n=t.length,a=Y2(r,n);sa(i,a)||(e.uniform1iv(this.addr,a),aa(i,a));for(let e=0;e!==n;++e)r.setTexture3D(t[e]||lve,a[e])}function pvt(e,t,r){let i=this.cache,n=t.length,a=Y2(r,n);sa(i,a)||(e.uniform1iv(this.addr,a),aa(i,a));for(let e=0;e!==n;++e)r.setTextureCube(t[e]||cve,a[e])}function mvt(e,t,r){let i=this.cache,n=t.length,a=Y2(r,n);sa(i,a)||(e.uniform1iv(this.addr,a),aa(i,a));for(let e=0;e!==n;++e)r.setTexture2DArray(t[e]||ove,a[e])}function gvt(e){switch(e){case 5126:return K0t;case 35664:return J0t;case 35665:return Q0t;case 35666:return evt;case 35674:return tvt;case 35675:return rvt;case 35676:return nvt;case 5124:case 35670:return ivt;case 35667:case 35671:return svt;case 35668:case 35672:return avt;case 35669:case 35673:return ovt;case 5125:return lvt;case 36294:return cvt;case 36295:return uvt;case 36296:return hvt;case 35678:case 36198:case 36298:case 36306:case 35682:return dvt;case 35679:case 36299:case 36307:return fvt;case 35680:case 36300:case 36308:case 36293:return pvt;case 36289:case 36303:case 36311:case 36292:return mvt}}var K6=class{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=Z0t(t.type)}},J6=class{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=gvt(t.type)}},Q6=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){let i=this.seq;for(let n=0,a=i.length;n!==a;++n){let a=i[n];a.setValue(e,t[a.id],r)}}},Z5=/(\w+)(\])?(\[|\.)?/g;function age(e,t){e.seq.push(t),e.map[t.id]=t}function vvt(e,t,r){let i=e.name,n=i.length;for(Z5.lastIndex=0;;){let a=Z5.exec(i),s=Z5.lastIndex,o=a[1],l="]"===a[2],h=a[3];if(l&&(o|=0),void 0===h||"["===h&&s+2===n){age(r,void 0===h?new K6(o,e,t):new J6(o,e,t));break}{let e=r.map[o];void 0===e&&(e=new Q6(o),age(r,e)),r=e}}}var Ny=class{constructor(e,t){this.seq=[],this.map={};let r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){let r=e.getActiveUniform(t,i);vvt(r,e.getUniformLocation(t,r.name),this)}}setValue(e,t,r,i){let n=this.map[t];void 0!==n&&n.setValue(e,r,i)}setOptional(e,t,r){let i=t[r];void 0!==i&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let n=0,a=t.length;n!==a;++n){let a=t[n],s=r[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,i)}}static seqWithValue(e,t){let r=[];for(let i=0,n=e.length;i!==n;++i){let n=e[i];n.id in t&&r.push(n)}return r}};function oge(e,t,r){let i=e.createShader(t);return e.shaderSource(i,r),e.compileShader(i),i}var yvt=37297,bvt=0;function xvt(e,t){let r=e.split("\n"),i=[],n=Math.max(t-6,0),a=Math.min(t+6,r.length);for(let e=n;e<a;e++){let n=e+1;i.push(`${n===t?">":" "} ${n}: ${r[e]}`)}return i.join("\n")}function Evt(e){let t,r=vi.getPrimaries(vi.workingColorSpace),i=vi.getPrimaries(e);switch(r===i?t="":r===x_&&i===b_?t="LinearDisplayP3ToLinearSRGB":r===b_&&i===x_&&(t="LinearSRGBToLinearDisplayP3"),e){case Hi:case W_:return[t,"LinearTransferOETF"];case Zr:case X2:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[t,"LinearTransferOETF"]}}function lge(e,t,r){let i=e.getShaderParameter(t,e.COMPILE_STATUS),n=e.getShaderInfoLog(t).trim();if(i&&""===n)return"";let a=/ERROR: 0:(\d+)/.exec(n);if(a){let i=parseInt(a[1]);return r.toUpperCase()+"\n\n"+n+"\n\n"+xvt(e.getShaderSource(t),i)}return n}function _vt(e,t){let r=Evt(t);return`vec4 ${e}( vec4 value ) { return ${r[0]}( ${r[1]}( value ) ); }`}function Tvt(e,t){let r;switch(t){case P0e:r="Linear";break;case I0e:r="Reinhard";break;case O0e:r="OptimizedCineon";break;case D0e:r="ACESFilmic";break;case L0e:r="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),r="Linear"}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function wvt(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(o_).join("\n")}function Svt(e){let t=[];for(let r in e){let i=e[r];!1!==i&&t.push("#define "+r+" "+i)}return t.join("\n")}function Mvt(e,t){let r={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){let i=e.getActiveAttrib(t,n),a=i.name,s=1;i.type===e.FLOAT_MAT2&&(s=2),i.type===e.FLOAT_MAT3&&(s=3),i.type===e.FLOAT_MAT4&&(s=4),r[a]={type:i.type,location:e.getAttribLocation(t,a),locationSize:s}}return r}function o_(e){return""!==e}function cge(e,t){let r=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,r).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function uge(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Avt=/^[ \t]*#include +<([\w\d./]+)>/gm;function e4(e){return e.replace(Avt,Cvt)}var Rvt=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function Cvt(e,t){let r=zr[t];if(void 0===r){let e=Rvt.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");r=zr[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return e4(r)}var Pvt=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function hge(e){return e.replace(Pvt,Ivt)}function Ivt(e,t,r,i){let n="";for(let e=parseInt(t);e<parseInt(r);e++)n+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return n}function dge(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Ovt(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===V4?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===a1?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===fh&&(t="SHADOWMAP_TYPE_VSM"),t}function Dvt(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case qd:case xp:t="ENVMAP_TYPE_CUBE";break;case c1:t="ENVMAP_TYPE_CUBE_UV"}return t}function Lvt(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap&&e.envMapMode===xp)t="ENVMAP_MODE_REFRACTION";return t}function kvt(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case G_:t="ENVMAP_BLENDING_MULTIPLY";break;case R0e:t="ENVMAP_BLENDING_MIX";break;case C0e:t="ENVMAP_BLENDING_ADD"}return t}function Fvt(e){let t=e.envMapCubeUVHeight;if(null===t)return null;let r=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,r),112)),texelHeight:i,maxMip:r}}function Bvt(e,t,r,i){let n,a,s=e.getContext(),o=r.defines,l=r.vertexShader,h=r.fragmentShader,c=Ovt(r),u=Dvt(r),d=Lvt(r),p=kvt(r),f=Fvt(r),m=r.isWebGL2?"":wvt(r),g=Svt(o),v=s.createProgram(),y=r.glslVersion?"#version "+r.glslVersion+"\n":"";r.isRawShaderMaterial?(n=["#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,g].filter(o_).join("\n"),n.length>0&&(n+="\n"),a=[m,"#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,g].filter(o_).join("\n"),a.length>0&&(a+="\n")):(n=[dge(r),"#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,g,r.batching?"#define USE_BATCHING":"",r.instancing?"#define USE_INSTANCING":"",r.instancingColor?"#define USE_INSTANCING_COLOR":"",r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+d:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",r.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",r.displacementMap?"#define USE_DISPLACEMENTMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.anisotropy?"#define USE_ANISOTROPY":"",r.anisotropyMap?"#define USE_ANISOTROPYMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",r.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",r.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.alphaHash?"#define USE_ALPHAHASH":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",r.mapUv?"#define MAP_UV "+r.mapUv:"",r.alphaMapUv?"#define ALPHAMAP_UV "+r.alphaMapUv:"",r.lightMapUv?"#define LIGHTMAP_UV "+r.lightMapUv:"",r.aoMapUv?"#define AOMAP_UV "+r.aoMapUv:"",r.emissiveMapUv?"#define EMISSIVEMAP_UV "+r.emissiveMapUv:"",r.bumpMapUv?"#define BUMPMAP_UV "+r.bumpMapUv:"",r.normalMapUv?"#define NORMALMAP_UV "+r.normalMapUv:"",r.displacementMapUv?"#define DISPLACEMENTMAP_UV "+r.displacementMapUv:"",r.metalnessMapUv?"#define METALNESSMAP_UV "+r.metalnessMapUv:"",r.roughnessMapUv?"#define ROUGHNESSMAP_UV "+r.roughnessMapUv:"",r.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+r.anisotropyMapUv:"",r.clearcoatMapUv?"#define CLEARCOATMAP_UV "+r.clearcoatMapUv:"",r.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+r.clearcoatNormalMapUv:"",r.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+r.clearcoatRoughnessMapUv:"",r.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+r.iridescenceMapUv:"",r.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+r.iridescenceThicknessMapUv:"",r.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+r.sheenColorMapUv:"",r.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+r.sheenRoughnessMapUv:"",r.specularMapUv?"#define SPECULARMAP_UV "+r.specularMapUv:"",r.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+r.specularColorMapUv:"",r.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+r.specularIntensityMapUv:"",r.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+r.transmissionMapUv:"",r.thicknessMapUv?"#define THICKNESSMAP_UV "+r.thicknessMapUv:"",r.vertexTangents&&!1===r.flatShading?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUv1s?"#define USE_UV1":"",r.vertexUv2s?"#define USE_UV2":"",r.vertexUv3s?"#define USE_UV3":"",r.pointsUvs?"#define USE_POINTS_UV":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.morphColors&&r.isWebGL2?"#define USE_MORPHCOLORS":"",r.morphTargetsCount>0&&r.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",r.morphTargetsCount>0&&r.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+r.morphTextureStride:"",r.morphTargetsCount>0&&r.isWebGL2?"#define MORPHTARGETS_COUNT "+r.morphTargetsCount:"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+c:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.numLightProbes>0?"#define USE_LIGHT_PROBES":"",r.useLegacyLights?"#define LEGACY_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(o_).join("\n"),a=[m,dge(r),"#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,g,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+u:"",r.envMap?"#define "+d:"",r.envMap?"#define "+p:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",r.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.anisotropy?"#define USE_ANISOTROPY":"",r.anisotropyMap?"#define USE_ANISOTROPYMAP":"",r.clearcoat?"#define USE_CLEARCOAT":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.iridescence?"#define USE_IRIDESCENCE":"",r.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",r.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",r.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.alphaTest?"#define USE_ALPHATEST":"",r.alphaHash?"#define USE_ALPHAHASH":"",r.sheen?"#define USE_SHEEN":"",r.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.vertexTangents&&!1===r.flatShading?"#define USE_TANGENT":"",r.vertexColors||r.instancingColor?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUv1s?"#define USE_UV1":"",r.vertexUv2s?"#define USE_UV2":"",r.vertexUv3s?"#define USE_UV3":"",r.pointsUvs?"#define USE_POINTS_UV":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+c:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.numLightProbes>0?"#define USE_LIGHT_PROBES":"",r.useLegacyLights?"#define LEGACY_LIGHTS":"",r.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",r.toneMapping!==Gd?"#define TONE_MAPPING":"",r.toneMapping!==Gd?zr.tonemapping_pars_fragment:"",r.toneMapping!==Gd?Tvt("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.opaque?"#define OPAQUE":"",zr.colorspace_pars_fragment,_vt("linearToOutputTexel",r.outputColorSpace),r.useDepthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(o_).join("\n")),l=e4(l),l=cge(l,r),l=uge(l,r),h=e4(h),h=cge(h,r),h=uge(h,r),l=hge(l),h=hge(h),r.isWebGL2&&!0!==r.isRawShaderMaterial&&(y="#version 300 es\n",n=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+n,a=["precision mediump sampler2DArray;","#define varying in",r.glslVersion===V6?"":"layout(location = 0) out highp vec4 pc_fragColor;",r.glslVersion===V6?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);let b,x,_=y+n+l,w=y+a+h,S=oge(s,s.VERTEX_SHADER,_),T=oge(s,s.FRAGMENT_SHADER,w);function M(t){if(e.debug.checkShaderErrors){let r=s.getProgramInfoLog(v).trim(),i=s.getShaderInfoLog(S).trim(),o=s.getShaderInfoLog(T).trim(),l=!0,h=!0;if(!1===s.getProgramParameter(v,s.LINK_STATUS))if(l=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(s,v,S,T);else{let e=lge(s,S,"vertex"),t=lge(s,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(v,s.VALIDATE_STATUS)+"\n\nProgram Info Log: "+r+"\n"+e+"\n"+t)}else""!==r?console.warn("THREE.WebGLProgram: Program Info Log:",r):(""===i||""===o)&&(h=!1);h&&(t.diagnostics={runnable:l,programLog:r,vertexShader:{log:i,prefix:n},fragmentShader:{log:o,prefix:a}})}s.deleteShader(S),s.deleteShader(T),b=new Ny(s,v),x=Mvt(s,v)}s.attachShader(v,S),s.attachShader(v,T),void 0!==r.index0AttributeName?s.bindAttribLocation(v,0,r.index0AttributeName):!0===r.morphTargets&&s.bindAttribLocation(v,0,"position"),s.linkProgram(v),this.getUniforms=function(){return void 0===b&&M(this),b},this.getAttributes=function(){return void 0===x&&M(this),x};let E=!1===r.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===E&&(E=s.getProgramParameter(v,yvt)),E},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(v),this.program=void 0},this.type=r.shaderType,this.name=r.shaderName,this.id=bvt++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=S,this.fragmentShader=T,this}var Nvt=0,t4=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),n=this._getShaderStage(r),a=this._getShaderCacheForMaterial(e);return!1===a.has(i)&&(a.add(i),i.usedTimes++),!1===a.has(n)&&(a.add(n),n.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,r=t.get(e);return void 0===r&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){let t=this.shaderCache,r=t.get(e);return void 0===r&&(r=new r4(e),t.set(e,r)),r}},r4=class{constructor(e){this.id=Nvt++,this.code=e,this.usedTimes=0}};function Uvt(e,t,r,i,n,a,s){let o=new Ep,l=new t4,h=[],c=n.isWebGL2,u=n.logarithmicDepthBuffer,d=n.vertexTextures,p=n.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return 0===e?"uv":`uv${e}`}return{getParameters:function(a,o,h,g,v){let y=g.fog,b=v.geometry,x=a.isMeshStandardMaterial?g.environment:null,_=(a.isMeshStandardMaterial?r:t).get(a.envMap||x),w=_&&_.mapping===c1?_.image.height:null,S=f[a.type];null!==a.precision&&(p=n.getMaxPrecision(a.precision),p!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",p,"instead."));let T,M,E,A,C=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,P=void 0!==C?C.length:0,R=0;if(void 0!==b.morphAttributes.position&&(R=1),void 0!==b.morphAttributes.normal&&(R=2),void 0!==b.morphAttributes.color&&(R=3),S){let e=Ia[S];T=e.vertexShader,M=e.fragmentShader}else T=a.vertexShader,M=a.fragmentShader,l.update(a),E=l.getVertexShaderID(a),A=l.getFragmentShaderID(a);let I=e.getRenderTarget(),O=!0===v.isInstancedMesh,L=!0===v.isBatchedMesh,D=!!a.map,k=!!a.matcap,F=!!_,N=!!a.aoMap,U=!!a.lightMap,B=!!a.bumpMap,z=!!a.normalMap,H=!!a.displacementMap,V=!!a.emissiveMap,j=!!a.metalnessMap,G=!!a.roughnessMap,W=a.anisotropy>0,X=a.clearcoat>0,q=a.iridescence>0,Y=a.sheen>0,$=a.transmission>0,Z=W&&!!a.anisotropyMap,K=X&&!!a.clearcoatMap,J=X&&!!a.clearcoatNormalMap,Q=X&&!!a.clearcoatRoughnessMap,ee=q&&!!a.iridescenceMap,te=q&&!!a.iridescenceThicknessMap,re=Y&&!!a.sheenColorMap,ie=Y&&!!a.sheenRoughnessMap,ne=!!a.specularMap,ae=!!a.specularColorMap,se=!!a.specularIntensityMap,oe=$&&!!a.transmissionMap,le=$&&!!a.thicknessMap,he=!!a.gradientMap,ce=!!a.alphaMap,ue=a.alphaTest>0,de=!!a.alphaHash,pe=!!a.extensions,fe=!!b.attributes.uv1,me=!!b.attributes.uv2,ge=!!b.attributes.uv3,ve=Gd;return a.toneMapped&&(null===I||!0===I.isXRRenderTarget)&&(ve=e.toneMapping),{isWebGL2:c,shaderID:S,shaderType:a.type,shaderName:a.name,vertexShader:T,fragmentShader:M,defines:a.defines,customVertexShaderID:E,customFragmentShaderID:A,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:p,batching:L,instancing:O,instancingColor:O&&null!==v.instanceColor,supportsVertexTextures:d,outputColorSpace:null===I?e.outputColorSpace:!0===I.isXRRenderTarget?I.texture.colorSpace:Hi,map:D,matcap:k,envMap:F,envMapMode:F&&_.mapping,envMapCubeUVHeight:w,aoMap:N,lightMap:U,bumpMap:B,normalMap:z,displacementMap:d&&H,emissiveMap:V,normalMapObjectSpace:z&&a.normalMapType===W0e,normalMapTangentSpace:z&&a.normalMapType===Sp,metalnessMap:j,roughnessMap:G,anisotropy:W,anisotropyMap:Z,clearcoat:X,clearcoatMap:K,clearcoatNormalMap:J,clearcoatRoughnessMap:Q,iridescence:q,iridescenceMap:ee,iridescenceThicknessMap:te,sheen:Y,sheenColorMap:re,sheenRoughnessMap:ie,specularMap:ne,specularColorMap:ae,specularIntensityMap:se,transmission:$,transmissionMap:oe,thicknessMap:le,gradientMap:he,opaque:!1===a.transparent&&a.blending===Pg,alphaMap:ce,alphaTest:ue,alphaHash:de,combine:a.combine,mapUv:D&&m(a.map.channel),aoMapUv:N&&m(a.aoMap.channel),lightMapUv:U&&m(a.lightMap.channel),bumpMapUv:B&&m(a.bumpMap.channel),normalMapUv:z&&m(a.normalMap.channel),displacementMapUv:H&&m(a.displacementMap.channel),emissiveMapUv:V&&m(a.emissiveMap.channel),metalnessMapUv:j&&m(a.metalnessMap.channel),roughnessMapUv:G&&m(a.roughnessMap.channel),anisotropyMapUv:Z&&m(a.anisotropyMap.channel),clearcoatMapUv:K&&m(a.clearcoatMap.channel),clearcoatNormalMapUv:J&&m(a.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Q&&m(a.clearcoatRoughnessMap.channel),iridescenceMapUv:ee&&m(a.iridescenceMap.channel),iridescenceThicknessMapUv:te&&m(a.iridescenceThicknessMap.channel),sheenColorMapUv:re&&m(a.sheenColorMap.channel),sheenRoughnessMapUv:ie&&m(a.sheenRoughnessMap.channel),specularMapUv:ne&&m(a.specularMap.channel),specularColorMapUv:ae&&m(a.specularColorMap.channel),specularIntensityMapUv:se&&m(a.specularIntensityMap.channel),transmissionMapUv:oe&&m(a.transmissionMap.channel),thicknessMapUv:le&&m(a.thicknessMap.channel),alphaMapUv:ce&&m(a.alphaMap.channel),vertexTangents:!!b.attributes.tangent&&(z||W),vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,vertexUv1s:fe,vertexUv2s:me,vertexUv3s:ge,pointsUvs:!0===v.isPoints&&!!b.attributes.uv&&(D||ce),fog:!!y,useFog:!0===a.fog,fogExp2:y&&y.isFogExp2,flatShading:!0===a.flatShading,sizeAttenuation:!0===a.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:P,morphTextureStride:R,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&h.length>0,shadowMapType:e.shadowMap.type,toneMapping:ve,useLegacyLights:e._useLegacyLights,decodeVideoTexture:D&&!0===a.map.isVideoTexture&&vi.getTransfer(a.map.colorSpace)===es,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===ln,flipSided:a.side===ws,useDepthPacking:a.depthPacking>=0,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionDerivatives:pe&&!0===a.extensions.derivatives,extensionFragDepth:pe&&!0===a.extensions.fragDepth,extensionDrawBuffers:pe&&!0===a.extensions.drawBuffers,extensionShaderTextureLOD:pe&&!0===a.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||i.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){let r=[];if(t.shaderID?r.push(t.shaderID):(r.push(t.customVertexShaderID),r.push(t.customFragmentShaderID)),void 0!==t.defines)for(let e in t.defines)r.push(e),r.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(r,t),function(e,t){o.disableAll(),t.isWebGL2&&o.enable(0),t.supportsVertexTextures&&o.enable(1),t.instancing&&o.enable(2),t.instancingColor&&o.enable(3),t.matcap&&o.enable(4),t.envMap&&o.enable(5),t.normalMapObjectSpace&&o.enable(6),t.normalMapTangentSpace&&o.enable(7),t.clearcoat&&o.enable(8),t.iridescence&&o.enable(9),t.alphaTest&&o.enable(10),t.vertexColors&&o.enable(11),t.vertexAlphas&&o.enable(12),t.vertexUv1s&&o.enable(13),t.vertexUv2s&&o.enable(14),t.vertexUv3s&&o.enable(15),t.vertexTangents&&o.enable(16),t.anisotropy&&o.enable(17),t.alphaHash&&o.enable(18),t.batching&&o.enable(19),e.push(o.mask),o.disableAll(),t.fog&&o.enable(0),t.useFog&&o.enable(1),t.flatShading&&o.enable(2),t.logarithmicDepthBuffer&&o.enable(3),t.skinning&&o.enable(4),t.morphTargets&&o.enable(5),t.morphNormals&&o.enable(6),t.morphColors&&o.enable(7),t.premultipliedAlpha&&o.enable(8),t.shadowMapEnabled&&o.enable(9),t.useLegacyLights&&o.enable(10),t.doubleSided&&o.enable(11),t.flipSided&&o.enable(12),t.useDepthPacking&&o.enable(13),t.dithering&&o.enable(14),t.transmission&&o.enable(15),t.sheen&&o.enable(16),t.opaque&&o.enable(17),t.pointsUvs&&o.enable(18),t.decodeVideoTexture&&o.enable(19),e.push(o.mask)}(r,t),r.push(e.outputColorSpace)),r.push(t.customProgramCacheKey),r.join()},getUniforms:function(e){let t,r=f[e.type];if(r){let e=Ia[r];t=xi.clone(e.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,r){let i;for(let e=0,t=h.length;e<t;e++){let t=h[e];if(t.cacheKey===r){i=t,++i.usedTimes;break}}return void 0===i&&(i=new Bvt(e,r,t,a),h.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){let t=h.indexOf(e);h[t]=h[h.length-1],h.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:h,dispose:function(){l.dispose()}}}function Hvt(){let e=new WeakMap;return{get:function(t){let r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function(t){e.delete(t)},update:function(t,r,i){e.get(t)[r]=i},dispose:function(){e=new WeakMap}}}function Vvt(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function fge(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function pge(){let e=[],t=0,r=[],i=[],n=[];function a(r,i,n,a,s,o){let l=e[t];return void 0===l?(l={id:r.id,object:r,geometry:i,material:n,groupOrder:a,renderOrder:r.renderOrder,z:s,group:o},e[t]=l):(l.id=r.id,l.object=r,l.geometry=i,l.material=n,l.groupOrder=a,l.renderOrder=r.renderOrder,l.z=s,l.group=o),t++,l}return{opaque:r,transmissive:i,transparent:n,init:function(){t=0,r.length=0,i.length=0,n.length=0},push:function(e,t,s,o,l,h){let c=a(e,t,s,o,l,h);s.transmission>0?i.push(c):!0===s.transparent?n.push(c):r.push(c)},unshift:function(e,t,s,o,l,h){let c=a(e,t,s,o,l,h);s.transmission>0?i.unshift(c):!0===s.transparent?n.unshift(c):r.unshift(c)},finish:function(){for(let r=t,i=e.length;r<i;r++){let t=e[r];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){r.length>1&&r.sort(e||Vvt),i.length>1&&i.sort(t||fge),n.length>1&&n.sort(t||fge)}}}function zvt(){let e=new WeakMap;return{get:function(t,r){let i,n=e.get(t);return void 0===n?(i=new pge,e.set(t,[i])):r>=n.length?(i=new pge,n.push(i)):i=n[r],i},dispose:function(){e=new WeakMap}}}function Gvt(){let e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let r;switch(t.type){case"DirectionalLight":r={direction:new F,color:new dt};break;case"SpotLight":r={position:new F,direction:new F,color:new dt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":r={position:new F,color:new dt,distance:0,decay:0};break;case"HemisphereLight":r={direction:new F,skyColor:new dt,groundColor:new dt};break;case"RectAreaLight":r={color:new dt,position:new F,halfWidth:new F,halfHeight:new F}}return e[t.id]=r,r}}}function qvt(){let e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let r;switch(t.type){case"DirectionalLight":case"SpotLight":r={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Te};break;case"PointLight":r={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Te,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=r,r}}}var jvt=0;function Wvt(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Xvt(e,t){let r=new Gvt,i=qvt(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)n.probe.push(new F);let a=new F,s=new lt,o=new lt;return{setup:function(a,s){let o=0,l=0,h=0;for(let e=0;e<9;e++)n.probe[e].set(0,0,0);let c=0,u=0,d=0,p=0,f=0,m=0,g=0,v=0,y=0,b=0,x=0;a.sort(Wvt);let _=!0===s?Math.PI:1;for(let e=0,t=a.length;e<t;e++){let t=a[e],s=t.color,w=t.intensity,S=t.distance,T=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)o+=s.r*w*_,l+=s.g*w*_,h+=s.b*w*_;else if(t.isLightProbe){for(let e=0;e<9;e++)n.probe[e].addScaledVector(t.sh.coefficients[e],w);x++}else if(t.isDirectionalLight){let e=r.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*_),t.castShadow){let e=t.shadow,r=i.get(t);r.shadowBias=e.bias,r.shadowNormalBias=e.normalBias,r.shadowRadius=e.radius,r.shadowMapSize=e.mapSize,n.directionalShadow[c]=r,n.directionalShadowMap[c]=T,n.directionalShadowMatrix[c]=t.shadow.matrix,m++}n.directional[c]=e,c++}else if(t.isSpotLight){let e=r.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(s).multiplyScalar(w*_),e.distance=S,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,n.spot[d]=e;let a=t.shadow;if(t.map&&(n.spotLightMap[y]=t.map,y++,a.updateMatrices(t),t.castShadow&&b++),n.spotLightMatrix[d]=a.matrix,t.castShadow){let e=i.get(t);e.shadowBias=a.bias,e.shadowNormalBias=a.normalBias,e.shadowRadius=a.radius,e.shadowMapSize=a.mapSize,n.spotShadow[d]=e,n.spotShadowMap[d]=T,v++}d++}else if(t.isRectAreaLight){let e=r.get(t);e.color.copy(s).multiplyScalar(w),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),n.rectArea[p]=e,p++}else if(t.isPointLight){let e=r.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*_),e.distance=t.distance,e.decay=t.decay,t.castShadow){let e=t.shadow,r=i.get(t);r.shadowBias=e.bias,r.shadowNormalBias=e.normalBias,r.shadowRadius=e.radius,r.shadowMapSize=e.mapSize,r.shadowCameraNear=e.camera.near,r.shadowCameraFar=e.camera.far,n.pointShadow[u]=r,n.pointShadowMap[u]=T,n.pointShadowMatrix[u]=t.shadow.matrix,g++}n.point[u]=e,u++}else if(t.isHemisphereLight){let e=r.get(t);e.skyColor.copy(t.color).multiplyScalar(w*_),e.groundColor.copy(t.groundColor).multiplyScalar(w*_),n.hemi[f]=e,f++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(n.rectAreaLTC1=hr.LTC_FLOAT_1,n.rectAreaLTC2=hr.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(n.rectAreaLTC1=hr.LTC_HALF_1,n.rectAreaLTC2=hr.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=o,n.ambient[1]=l,n.ambient[2]=h;let w=n.hash;(w.directionalLength!==c||w.pointLength!==u||w.spotLength!==d||w.rectAreaLength!==p||w.hemiLength!==f||w.numDirectionalShadows!==m||w.numPointShadows!==g||w.numSpotShadows!==v||w.numSpotMaps!==y||w.numLightProbes!==x)&&(n.directional.length=c,n.spot.length=d,n.rectArea.length=p,n.point.length=u,n.hemi.length=f,n.directionalShadow.length=m,n.directionalShadowMap.length=m,n.pointShadow.length=g,n.pointShadowMap.length=g,n.spotShadow.length=v,n.spotShadowMap.length=v,n.directionalShadowMatrix.length=m,n.pointShadowMatrix.length=g,n.spotLightMatrix.length=v+y-b,n.spotLightMap.length=y,n.numSpotLightShadowsWithMaps=b,n.numLightProbes=x,w.directionalLength=c,w.pointLength=u,w.spotLength=d,w.rectAreaLength=p,w.hemiLength=f,w.numDirectionalShadows=m,w.numPointShadows=g,w.numSpotShadows=v,w.numSpotMaps=y,w.numLightProbes=x,n.version=jvt++)},setupView:function(e,t){let r=0,i=0,l=0,h=0,c=0,u=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){let d=e[t];if(d.isDirectionalLight){let e=n.directional[r];e.direction.setFromMatrixPosition(d.matrixWorld),a.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(u),r++}else if(d.isSpotLight){let e=n.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),e.direction.setFromMatrixPosition(d.matrixWorld),a.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(u),l++}else if(d.isRectAreaLight){let e=n.rectArea[h];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),o.identity(),s.copy(d.matrixWorld),s.premultiply(u),o.extractRotation(s),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),h++}else if(d.isPointLight){let e=n.point[i];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),i++}else if(d.isHemisphereLight){let e=n.hemi[c];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(u),c++}}},state:n}}function mge(e,t){let r=new Xvt(e,t),i=[],n=[];return{init:function(){i.length=0,n.length=0},state:{lightsArray:i,shadowsArray:n,lights:r},setupLights:function(e){r.setup(i,e)},setupLightsView:function(e){r.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){n.push(e)}}}function Yvt(e,t){let r=new WeakMap;return{get:function(i,n=0){let a,s=r.get(i);return void 0===s?(a=new mge(e,t),r.set(i,[a])):n>=s.length?(a=new mge(e,t),s.push(a)):a=s[n],a},dispose:function(){r=new WeakMap}}}var Yd=class extends qn{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=j0e,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},A_=class extends qn{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},$vt="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",Zvt="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function Kvt(e,t,r){let i=new Ml,n=new Te,a=new Te,s=new Fn,o=new Yd({depthPacking:W2}),l=new A_,h={},c=r.maxTextureSize,u={[zi]:ws,[ws]:zi,[ln]:ln},d=new xr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Te},radius:{value:4}},vertexShader:$vt,fragmentShader:Zvt}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let f=new Nt;f.setAttribute("position",new fr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let m=new Ht(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=V4;let v=this.type;function y(r,i){let a=t.update(m);d.defines.VSM_SAMPLES!==r.blurSamples&&(d.defines.VSM_SAMPLES=r.blurSamples,p.defines.VSM_SAMPLES=r.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===r.mapPass&&(r.mapPass=new yn(n.x,n.y)),d.uniforms.shadow_pass.value=r.map.texture,d.uniforms.resolution.value=r.mapSize,d.uniforms.radius.value=r.radius,e.setRenderTarget(r.mapPass),e.clear(),e.renderBufferDirect(i,null,a,d,m,null),p.uniforms.shadow_pass.value=r.mapPass.texture,p.uniforms.resolution.value=r.mapSize,p.uniforms.radius.value=r.radius,e.setRenderTarget(r.map),e.clear(),e.renderBufferDirect(i,null,a,p,m,null)}function b(t,r,i,n){let a=null,s=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==s)a=s;else if(a=!0===i.isPointLight?l:o,e.localClippingEnabled&&!0===r.clipShadows&&Array.isArray(r.clippingPlanes)&&0!==r.clippingPlanes.length||r.displacementMap&&0!==r.displacementScale||r.alphaMap&&r.alphaTest>0||r.map&&r.alphaTest>0){let e=a.uuid,t=r.uuid,i=h[e];void 0===i&&(i={},h[e]=i);let n=i[t];void 0===n&&(n=a.clone(),i[t]=n),a=n}if(a.visible=r.visible,a.wireframe=r.wireframe,a.side=n===fh?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:u[r.side],a.alphaMap=r.alphaMap,a.alphaTest=r.alphaTest,a.map=r.map,a.clipShadows=r.clipShadows,a.clippingPlanes=r.clippingPlanes,a.clipIntersection=r.clipIntersection,a.displacementMap=r.displacementMap,a.displacementScale=r.displacementScale,a.displacementBias=r.displacementBias,a.wireframeLinewidth=r.wireframeLinewidth,a.linewidth=r.linewidth,!0===i.isPointLight&&!0===a.isMeshDistanceMaterial){e.properties.get(a).light=i}return a}function x(r,n,a,s,o){if(!1===r.visible)return;if(r.layers.test(n.layers)&&(r.isMesh||r.isLine||r.isPoints)&&(r.castShadow||r.receiveShadow&&o===fh)&&(!r.frustumCulled||i.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,r.matrixWorld);let i=t.update(r),l=r.material;if(Array.isArray(l)){let t=i.groups;for(let h=0,c=t.length;h<c;h++){let c=t[h],u=l[c.materialIndex];if(u&&u.visible){let t=b(r,u,s,o);r.onBeforeShadow(e,r,n,a,i,t,c),e.renderBufferDirect(a,null,i,t,r,c),r.onAfterShadow(e,r,n,a,i,t,c)}}}else if(l.visible){let t=b(r,l,s,o);r.onBeforeShadow(e,r,n,a,i,t,null),e.renderBufferDirect(a,null,i,t,r,null),r.onAfterShadow(e,r,n,a,i,t,null)}}let l=r.children;for(let e=0,t=l.length;e<t;e++)x(l[e],n,a,s,o)}this.render=function(t,r,o){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===t.length)return;let l=e.getRenderTarget(),h=e.getActiveCubeFace(),u=e.getActiveMipmapLevel(),d=e.state;d.setBlending(Oi),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);let p=v!==fh&&this.type===fh,f=v===fh&&this.type!==fh;for(let l=0,h=t.length;l<h;l++){let h=t[l],u=h.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",h,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;n.copy(u.mapSize);let m=u.getFrameExtents();if(n.multiply(m),a.copy(u.mapSize),(n.x>c||n.y>c)&&(n.x>c&&(a.x=Math.floor(c/m.x),n.x=a.x*m.x,u.mapSize.x=a.x),n.y>c&&(a.y=Math.floor(c/m.y),n.y=a.y*m.y,u.mapSize.y=a.y)),null===u.map||!0===p||!0===f){let e=this.type!==fh?{minFilter:ni,magFilter:ni}:{};null!==u.map&&u.map.dispose(),u.map=new yn(n.x,n.y,e),u.map.texture.name=h.name+".shadowMap",u.camera.updateProjectionMatrix()}e.setRenderTarget(u.map),e.clear();let g=u.getViewportCount();for(let e=0;e<g;e++){let t=u.getViewport(e);s.set(a.x*t.x,a.y*t.y,a.x*t.z,a.y*t.w),d.viewport(s),u.updateMatrices(h,e),i=u.getFrustum(),x(r,o,u.camera,h,this.type)}!0!==u.isPointLightShadow&&this.type===fh&&y(u,o),u.needsUpdate=!1}v=this.type,g.needsUpdate=!1,e.setRenderTarget(l,h,u)}}function Jvt(e,t,r){let i=r.isWebGL2;let n=new function(){let t=!1,r=new Fn,i=null,n=new Fn(0,0,0,0);return{setMask:function(r){i!==r&&!t&&(e.colorMask(r,r,r,r),i=r)},setLocked:function(e){t=e},setClear:function(t,i,a,s,o){!0===o&&(t*=s,i*=s,a*=s),r.set(t,i,a,s),!1===n.equals(r)&&(e.clearColor(t,i,a,s),n.copy(r))},reset:function(){t=!1,i=null,n.set(-1,0,0,0)}}},a=new function(){let t=!1,r=null,i=null,n=null;return{setTest:function(t){t?V(e.DEPTH_TEST):j(e.DEPTH_TEST)},setMask:function(i){r!==i&&!t&&(e.depthMask(i),r=i)},setFunc:function(t){if(i!==t){switch(t){case E0e:e.depthFunc(e.NEVER);break;case _0e:e.depthFunc(e.ALWAYS);break;case T0e:e.depthFunc(e.LESS);break;case f_:e.depthFunc(e.LEQUAL);break;case w0e:e.depthFunc(e.EQUAL);break;case S0e:e.depthFunc(e.GEQUAL);break;case M0e:e.depthFunc(e.GREATER);break;case A0e:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}i=t}},setLocked:function(e){t=e},setClear:function(t){n!==t&&(e.clearDepth(t),n=t)},reset:function(){t=!1,r=null,i=null,n=null}}},s=new function(){let t=!1,r=null,i=null,n=null,a=null,s=null,o=null,l=null,h=null;return{setTest:function(r){t||(r?V(e.STENCIL_TEST):j(e.STENCIL_TEST))},setMask:function(i){r!==i&&!t&&(e.stencilMask(i),r=i)},setFunc:function(t,r,s){(i!==t||n!==r||a!==s)&&(e.stencilFunc(t,r,s),i=t,n=r,a=s)},setOp:function(t,r,i){(s!==t||o!==r||l!==i)&&(e.stencilOp(t,r,i),s=t,o=r,l=i)},setLocked:function(e){t=e},setClear:function(t){h!==t&&(e.clearStencil(t),h=t)},reset:function(){t=!1,r=null,i=null,n=null,a=null,s=null,o=null,l=null,h=null}}},o=new WeakMap,l=new WeakMap,h={},c={},u=new WeakMap,d=[],p=null,f=!1,m=null,g=null,v=null,y=null,b=null,x=null,_=null,w=new dt(0,0,0),S=0,T=!1,M=null,E=null,A=null,C=null,P=null,R=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),I=!1,O=0,L=e.getParameter(e.VERSION);-1!==L.indexOf("WebGL")?(O=parseFloat(/^WebGL (\d)/.exec(L)[1]),I=O>=1):-1!==L.indexOf("OpenGL ES")&&(O=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),I=O>=2);let D=null,k={},F=e.getParameter(e.SCISSOR_BOX),N=e.getParameter(e.VIEWPORT),U=(new Fn).fromArray(F),B=(new Fn).fromArray(N);function z(t,r,n,a){let s=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let o=0;o<n;o++)!i||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(r+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,s):e.texImage3D(r,0,e.RGBA,1,1,a,0,e.RGBA,e.UNSIGNED_BYTE,s);return o}let H={};function V(t){!0!==h[t]&&(e.enable(t),h[t]=!0)}function j(t){!1!==h[t]&&(e.disable(t),h[t]=!1)}H[e.TEXTURE_2D]=z(e.TEXTURE_2D,e.TEXTURE_2D,1),H[e.TEXTURE_CUBE_MAP]=z(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),i&&(H[e.TEXTURE_2D_ARRAY]=z(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),H[e.TEXTURE_3D]=z(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),n.setClear(0,0,0,1),a.setClear(1),s.setClear(0),V(e.DEPTH_TEST),a.setFunc(f_),q(!1),Y(h6),V(e.CULL_FACE),X(Oi);let G={[jo]:e.FUNC_ADD,[c0e]:e.FUNC_SUBTRACT,[u0e]:e.FUNC_REVERSE_SUBTRACT};if(i)G[p6]=e.MIN,G[m6]=e.MAX;else{let e=t.get("EXT_blend_minmax");null!==e&&(G[p6]=e.MIN_EXT,G[m6]=e.MAX_EXT)}let W={[wp]:e.ZERO,[h0e]:e.ONE,[d0e]:e.SRC_COLOR,[h2]:e.SRC_ALPHA,[g0e]:e.SRC_ALPHA_SATURATE,[l1]:e.DST_COLOR,[o1]:e.DST_ALPHA,[f0e]:e.ONE_MINUS_SRC_COLOR,[d2]:e.ONE_MINUS_SRC_ALPHA,[m0e]:e.ONE_MINUS_DST_COLOR,[p0e]:e.ONE_MINUS_DST_ALPHA,[v0e]:e.CONSTANT_COLOR,[y0e]:e.ONE_MINUS_CONSTANT_COLOR,[b0e]:e.CONSTANT_ALPHA,[x0e]:e.ONE_MINUS_CONSTANT_ALPHA};function X(t,r,i,n,a,s,o,l,h,c){if(t!==Oi){if(!1===f&&(V(e.BLEND),f=!0),t===Yg)a=a||r,s=s||i,o=o||n,(r!==g||a!==b)&&(e.blendEquationSeparate(G[r],G[a]),g=r,b=a),(i!==v||n!==y||s!==x||o!==_)&&(e.blendFuncSeparate(W[i],W[n],W[s],W[o]),v=i,y=n,x=s,_=o),(!1===l.equals(w)||h!==S)&&(e.blendColor(l.r,l.g,l.b,h),w.copy(l),S=h),m=t,T=!1;else if(t!==m||c!==T){if((g!==jo||b!==jo)&&(e.blendEquation(e.FUNC_ADD),g=jo,b=jo),c)switch(t){case Pg:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case du:e.blendFunc(e.ONE,e.ONE);break;case d6:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case f6:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case Pg:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case du:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case d6:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case f6:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}v=null,y=null,x=null,_=null,w.set(0,0,0),S=0,m=t,T=c}}else!0===f&&(j(e.BLEND),f=!1)}function q(t){M!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),M=t)}function Y(t){t!==o0e?(V(e.CULL_FACE),t!==E&&(t===h6?e.cullFace(e.BACK):t===l0e?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):j(e.CULL_FACE),E=t}function $(t,r,i){t?(V(e.POLYGON_OFFSET_FILL),(C!==r||P!==i)&&(e.polygonOffset(r,i),C=r,P=i)):j(e.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:a,stencil:s},enable:V,disable:j,bindFramebuffer:function(t,r){return c[t]!==r&&(e.bindFramebuffer(t,r),c[t]=r,i&&(t===e.DRAW_FRAMEBUFFER&&(c[e.FRAMEBUFFER]=r),t===e.FRAMEBUFFER&&(c[e.DRAW_FRAMEBUFFER]=r)),!0)},drawBuffers:function(i,n){let a=d,s=!1;if(i)if(a=u.get(n),void 0===a&&(a=[],u.set(n,a)),i.isWebGLMultipleRenderTargets){let t=i.texture;if(a.length!==t.length||a[0]!==e.COLOR_ATTACHMENT0){for(let r=0,i=t.length;r<i;r++)a[r]=e.COLOR_ATTACHMENT0+r;a.length=t.length,s=!0}}else a[0]!==e.COLOR_ATTACHMENT0&&(a[0]=e.COLOR_ATTACHMENT0,s=!0);else a[0]!==e.BACK&&(a[0]=e.BACK,s=!0);s&&(r.isWebGL2?e.drawBuffers(a):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(a))},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:X,setMaterial:function(t,r){t.side===ln?j(e.CULL_FACE):V(e.CULL_FACE);let i=t.side===ws;r&&(i=!i),q(i),t.blending===Pg&&!1===t.transparent?X(Oi):X(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),n.setMask(t.colorWrite);let o=t.stencilWrite;s.setTest(o),o&&(s.setMask(t.stencilWriteMask),s.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),s.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),$(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?V(e.SAMPLE_ALPHA_TO_COVERAGE):j(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:q,setCullFace:Y,setLineWidth:function(t){t!==A&&(I&&e.lineWidth(t),A=t)},setPolygonOffset:$,setScissorTest:function(t){t?V(e.SCISSOR_TEST):j(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+R-1),D!==t&&(e.activeTexture(t),D=t)},bindTexture:function(t,r,i){void 0===i&&(i=null===D?e.TEXTURE0+R-1:D);let n=k[i];void 0===n&&(n={type:void 0,texture:void 0},k[i]=n),(n.type!==t||n.texture!==r)&&(D!==i&&(e.activeTexture(i),D=i),e.bindTexture(t,r||H[t]),n.type=t,n.texture=r)},unbindTexture:function(){let t=k[D];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,r){let i=l.get(r);void 0===i&&(i=new WeakMap,l.set(r,i));let n=i.get(t);void 0===n&&(n=e.getUniformBlockIndex(r,t.name),i.set(t,n))},uniformBlockBinding:function(t,r){let i=l.get(r).get(t);o.get(r)!==i&&(e.uniformBlockBinding(r,i,t.__bindingPointIndex),o.set(r,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===U.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),U.copy(t))},viewport:function(t){!1===B.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),B.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===i&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),h={},D=null,k={},c={},u=new WeakMap,d=[],p=null,f=!1,m=null,g=null,v=null,y=null,b=null,x=null,_=null,w=new dt(0,0,0),S=0,T=!1,M=null,E=null,A=null,C=null,P=null,U.set(0,0,e.canvas.width,e.canvas.height),B.set(0,0,e.canvas.width,e.canvas.height),n.reset(),a.reset(),s.reset()}}}function Qvt(e,t,r,i,n,a,s){let o,l=n.isWebGL2,h=n.maxTextures,c=n.maxCubemapSize,u=n.maxTextureSize,d=n.maxSamples,p=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,f="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap,g=new WeakMap,v=!1;try{v="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function y(e,t){return v?new OffscreenCanvas(e,t):__("canvas")}function b(e,t,r,i){let n=1;if((e.width>i||e.height>i)&&(n=i/Math.max(e.width,e.height)),n<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){let i=t?p2:Math.floor,a=i(n*e.width),s=i(n*e.height);void 0===o&&(o=y(a,s));let l=r?y(a,s):o;return l.width=a,l.height=s,l.getContext("2d").drawImage(e,0,0,a,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+s+")."),l}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function x(e){return z6(e.width)&&z6(e.height)}function _(e,t){return e.generateMipmaps&&t&&e.minFilter!==ni&&e.minFilter!==wn}function w(t){e.generateMipmap(t)}function S(r,i,n,a,s=!1){if(!1===l)return i;if(null!==r){if(void 0!==e[r])return e[r];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+r+"'")}let o=i;if(i===e.RED&&(n===e.FLOAT&&(o=e.R32F),n===e.HALF_FLOAT&&(o=e.R16F),n===e.UNSIGNED_BYTE&&(o=e.R8)),i===e.RED_INTEGER&&(n===e.UNSIGNED_BYTE&&(o=e.R8UI),n===e.UNSIGNED_SHORT&&(o=e.R16UI),n===e.UNSIGNED_INT&&(o=e.R32UI),n===e.BYTE&&(o=e.R8I),n===e.SHORT&&(o=e.R16I),n===e.INT&&(o=e.R32I)),i===e.RG&&(n===e.FLOAT&&(o=e.RG32F),n===e.HALF_FLOAT&&(o=e.RG16F),n===e.UNSIGNED_BYTE&&(o=e.RG8)),i===e.RGBA){let t=s?y_:vi.getTransfer(a);n===e.FLOAT&&(o=e.RGBA32F),n===e.HALF_FLOAT&&(o=e.RGBA16F),n===e.UNSIGNED_BYTE&&(o=t===es?e.SRGB8_ALPHA8:e.RGBA8),n===e.UNSIGNED_SHORT_4_4_4_4&&(o=e.RGBA4),n===e.UNSIGNED_SHORT_5_5_5_1&&(o=e.RGB5_A1)}return(o===e.R16F||o===e.R32F||o===e.RG16F||o===e.RG32F||o===e.RGBA16F||o===e.RGBA32F)&&t.get("EXT_color_buffer_float"),o}function T(e,t,r){return!0===_(e,r)||e.isFramebufferTexture&&e.minFilter!==ni&&e.minFilter!==wn?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function M(t){return t===ni||t===mh||t===hu?e.NEAREST:e.LINEAR}function E(e){let t=e.target;t.removeEventListener("dispose",E),function(e){let t=i.get(e);if(void 0===t.__webglInit)return;let r=e.source,n=g.get(r);if(n){let i=n[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&C(e),0===Object.keys(n).length&&g.delete(r)}i.remove(e)}(t),t.isVideoTexture&&m.delete(t)}function A(t){let r=t.target;r.removeEventListener("dispose",A),function(t){let r=t.texture,n=i.get(t),a=i.get(r);if(void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),s.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(n.__webglFramebuffer[t]))for(let r=0;r<n.__webglFramebuffer[t].length;r++)e.deleteFramebuffer(n.__webglFramebuffer[t][r]);else e.deleteFramebuffer(n.__webglFramebuffer[t]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[t])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,n=r.length;t<n;t++){let n=i.get(r[t]);n.__webglTexture&&(e.deleteTexture(n.__webglTexture),s.memory.textures--),i.remove(r[t])}i.remove(r),i.remove(t)}(r)}function C(t){let r=i.get(t);e.deleteTexture(r.__webglTexture);let n=t.source;delete g.get(n)[r.__cacheKey],s.memory.textures--}let P=0;function R(t,n){let a=i.get(t);if(t.isVideoTexture&&function(e){let t=s.render.frame;m.get(e)!==t&&(m.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&a.__version!==t.version){let e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void F(a,t,n);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.bindTexture(e.TEXTURE_2D,a.__webglTexture,e.TEXTURE0+n)}let I={[ui]:e.REPEAT,[pi]:e.CLAMP_TO_EDGE,[fu]:e.MIRRORED_REPEAT},O={[ni]:e.NEAREST,[mh]:e.NEAREST_MIPMAP_NEAREST,[hu]:e.NEAREST_MIPMAP_LINEAR,[wn]:e.LINEAR,[rf]:e.LINEAR_MIPMAP_NEAREST,[ia]:e.LINEAR_MIPMAP_LINEAR},L={[X0e]:e.NEVER,[Q0e]:e.ALWAYS,[Y0e]:e.LESS,[K4]:e.LEQUAL,[$0e]:e.EQUAL,[J0e]:e.GEQUAL,[Z0e]:e.GREATER,[K0e]:e.NOTEQUAL};function D(r,a,s){if(s?(e.texParameteri(r,e.TEXTURE_WRAP_S,I[a.wrapS]),e.texParameteri(r,e.TEXTURE_WRAP_T,I[a.wrapT]),(r===e.TEXTURE_3D||r===e.TEXTURE_2D_ARRAY)&&e.texParameteri(r,e.TEXTURE_WRAP_R,I[a.wrapR]),e.texParameteri(r,e.TEXTURE_MAG_FILTER,O[a.magFilter]),e.texParameteri(r,e.TEXTURE_MIN_FILTER,O[a.minFilter])):(e.texParameteri(r,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(r,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),(r===e.TEXTURE_3D||r===e.TEXTURE_2D_ARRAY)&&e.texParameteri(r,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),(a.wrapS!==pi||a.wrapT!==pi)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(r,e.TEXTURE_MAG_FILTER,M(a.magFilter)),e.texParameteri(r,e.TEXTURE_MIN_FILTER,M(a.minFilter)),a.minFilter!==ni&&a.minFilter!==wn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),a.compareFunction&&(e.texParameteri(r,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(r,e.TEXTURE_COMPARE_FUNC,L[a.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){let s=t.get("EXT_texture_filter_anisotropic");if(a.magFilter===ni||a.minFilter!==hu&&a.minFilter!==ia||a.type===Us&&!1===t.has("OES_texture_float_linear")||!1===l&&a.type===Cn&&!1===t.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||i.get(a).__currentAnisotropy)&&(e.texParameterf(r,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,n.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy)}}function k(t,r){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",E));let n=r.source,a=g.get(n);void 0===a&&(a={},g.set(n,a));let o=function(e){let t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(r);if(o!==t.__cacheKey){void 0===a[o]&&(a[o]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,i=!0),a[o].usedTimes++;let n=a[t.__cacheKey];void 0!==n&&(a[t.__cacheKey].usedTimes--,0===n.usedTimes&&C(r)),t.__cacheKey=o,t.__webglTexture=a[o].texture}return i}function F(t,n,s){let o=e.TEXTURE_2D;(n.isDataArrayTexture||n.isCompressedArrayTexture)&&(o=e.TEXTURE_2D_ARRAY),n.isData3DTexture&&(o=e.TEXTURE_3D);let h=k(t,n),c=n.source;r.bindTexture(o,t.__webglTexture,e.TEXTURE0+s);let d=i.get(c);if(c.version!==d.__version||!0===h){r.activeTexture(e.TEXTURE0+s);let t=vi.getPrimaries(vi.workingColorSpace),i=n.colorSpace===Oa?null:vi.getPrimaries(n.colorSpace),p=n.colorSpace===Oa||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,n.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,n.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,p);let f=function(e){return!l&&(e.wrapS!==pi||e.wrapT!==pi||e.minFilter!==ni&&e.minFilter!==wn)}(n)&&!1===x(n.image),m=b(n.image,f,!1,u);m=V(n,m);let g=x(m)||l,v=a.convert(n.format,n.colorSpace),y=a.convert(n.type),M=S(n.internalFormat,v,y,n.colorSpace,n.isVideoTexture);D(o,n,g);let E,A=n.mipmaps,C=l&&!0!==n.isVideoTexture&&M!==q_,P=void 0===d.__version||!0===h,R=T(n,m,g);if(n.isDepthTexture)M=e.DEPTH_COMPONENT,l?M=n.type===Us?e.DEPTH_COMPONENT32F:n.type===zd?e.DEPTH_COMPONENT24:n.type===oc?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:n.type===Us&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===bp&&M===e.DEPTH_COMPONENT&&n.type!==G2&&n.type!==zd&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=zd,y=a.convert(n.type)),n.format===pu&&M===e.DEPTH_COMPONENT&&(M=e.DEPTH_STENCIL,n.type!==oc&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=oc,y=a.convert(n.type))),P&&(C?r.texStorage2D(e.TEXTURE_2D,1,M,m.width,m.height):r.texImage2D(e.TEXTURE_2D,0,M,m.width,m.height,0,v,y,null));else if(n.isDataTexture)if(A.length>0&&g){C&&P&&r.texStorage2D(e.TEXTURE_2D,R,M,A[0].width,A[0].height);for(let t=0,i=A.length;t<i;t++)E=A[t],C?r.texSubImage2D(e.TEXTURE_2D,t,0,0,E.width,E.height,v,y,E.data):r.texImage2D(e.TEXTURE_2D,t,M,E.width,E.height,0,v,y,E.data);n.generateMipmaps=!1}else C?(P&&r.texStorage2D(e.TEXTURE_2D,R,M,m.width,m.height),r.texSubImage2D(e.TEXTURE_2D,0,0,0,m.width,m.height,v,y,m.data)):r.texImage2D(e.TEXTURE_2D,0,M,m.width,m.height,0,v,y,m.data);else if(n.isCompressedTexture)if(n.isCompressedArrayTexture){C&&P&&r.texStorage3D(e.TEXTURE_2D_ARRAY,R,M,A[0].width,A[0].height,m.depth);for(let t=0,i=A.length;t<i;t++)E=A[t],n.format!==gs?null!==v?C?r.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,E.width,E.height,m.depth,v,E.data,0,0):r.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,M,E.width,E.height,m.depth,0,E.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):C?r.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,E.width,E.height,m.depth,v,y,E.data):r.texImage3D(e.TEXTURE_2D_ARRAY,t,M,E.width,E.height,m.depth,0,v,y,E.data)}else{C&&P&&r.texStorage2D(e.TEXTURE_2D,R,M,A[0].width,A[0].height);for(let t=0,i=A.length;t<i;t++)E=A[t],n.format!==gs?null!==v?C?r.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,E.width,E.height,v,E.data):r.compressedTexImage2D(e.TEXTURE_2D,t,M,E.width,E.height,0,E.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):C?r.texSubImage2D(e.TEXTURE_2D,t,0,0,E.width,E.height,v,y,E.data):r.texImage2D(e.TEXTURE_2D,t,M,E.width,E.height,0,v,y,E.data)}else if(n.isDataArrayTexture)C?(P&&r.texStorage3D(e.TEXTURE_2D_ARRAY,R,M,m.width,m.height,m.depth),r.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,m.width,m.height,m.depth,v,y,m.data)):r.texImage3D(e.TEXTURE_2D_ARRAY,0,M,m.width,m.height,m.depth,0,v,y,m.data);else if(n.isData3DTexture)C?(P&&r.texStorage3D(e.TEXTURE_3D,R,M,m.width,m.height,m.depth),r.texSubImage3D(e.TEXTURE_3D,0,0,0,0,m.width,m.height,m.depth,v,y,m.data)):r.texImage3D(e.TEXTURE_3D,0,M,m.width,m.height,m.depth,0,v,y,m.data);else if(n.isFramebufferTexture){if(P)if(C)r.texStorage2D(e.TEXTURE_2D,R,M,m.width,m.height);else{let t=m.width,i=m.height;for(let n=0;n<R;n++)r.texImage2D(e.TEXTURE_2D,n,M,t,i,0,v,y,null),t>>=1,i>>=1}}else if(A.length>0&&g){C&&P&&r.texStorage2D(e.TEXTURE_2D,R,M,A[0].width,A[0].height);for(let t=0,i=A.length;t<i;t++)E=A[t],C?r.texSubImage2D(e.TEXTURE_2D,t,0,0,v,y,E):r.texImage2D(e.TEXTURE_2D,t,M,v,y,E);n.generateMipmaps=!1}else C?(P&&r.texStorage2D(e.TEXTURE_2D,R,M,m.width,m.height),r.texSubImage2D(e.TEXTURE_2D,0,0,0,v,y,m)):r.texImage2D(e.TEXTURE_2D,0,M,v,y,m);_(n,g)&&w(o),d.__version=c.version,n.onUpdate&&n.onUpdate(n)}t.__version=n.version}function N(t,n,s,o,l,h){let c=a.convert(s.format,s.colorSpace),u=a.convert(s.type),d=S(s.internalFormat,c,u,s.colorSpace);if(!i.get(n).__hasExternalTextures){let t=Math.max(1,n.width>>h),i=Math.max(1,n.height>>h);l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?r.texImage3D(l,h,d,t,i,n.depth,0,c,u,null):r.texImage2D(l,h,d,t,i,0,c,u,null)}r.bindFramebuffer(e.FRAMEBUFFER,t),H(n)?p.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,o,l,i.get(s).__webglTexture,0,z(n)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,o,l,i.get(s).__webglTexture,h),r.bindFramebuffer(e.FRAMEBUFFER,null)}function U(t,r,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),r.depthBuffer&&!r.stencilBuffer){let n=!0===l?e.DEPTH_COMPONENT24:e.DEPTH_COMPONENT16;if(i||H(r)){let t=r.depthTexture;t&&t.isDepthTexture&&(t.type===Us?n=e.DEPTH_COMPONENT32F:t.type===zd&&(n=e.DEPTH_COMPONENT24));let i=z(r);H(r)?p.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,i,n,r.width,r.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,i,n,r.width,r.height)}else e.renderbufferStorage(e.RENDERBUFFER,n,r.width,r.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(r.depthBuffer&&r.stencilBuffer){let n=z(r);i&&!1===H(r)?e.renderbufferStorageMultisample(e.RENDERBUFFER,n,e.DEPTH24_STENCIL8,r.width,r.height):H(r)?p.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,n,e.DEPTH24_STENCIL8,r.width,r.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{let t=!0===r.isWebGLMultipleRenderTargets?r.texture:[r.texture];for(let n=0;n<t.length;n++){let s=t[n],o=a.convert(s.format,s.colorSpace),l=a.convert(s.type),h=S(s.internalFormat,o,l,s.colorSpace),c=z(r);i&&!1===H(r)?e.renderbufferStorageMultisample(e.RENDERBUFFER,c,h,r.width,r.height):H(r)?p.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,c,h,r.width,r.height):e.renderbufferStorage(e.RENDERBUFFER,h,r.width,r.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function B(t){let n=i.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!n.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(r.bindFramebuffer(e.FRAMEBUFFER,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(n.depthTexture).__webglTexture||n.depthTexture.image.width!==n.width||n.depthTexture.image.height!==n.height)&&(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),R(n.depthTexture,0);let a=i.get(n.depthTexture).__webglTexture,s=z(n);if(n.depthTexture.format===bp)H(n)?p.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0);else{if(n.depthTexture.format!==pu)throw new Error("Unknown depthTexture format");H(n)?p.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0,s):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0)}}(n.__webglFramebuffer,t)}else if(a){n.__webglDepthbuffer=[];for(let i=0;i<6;i++)r.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer[i]),n.__webglDepthbuffer[i]=e.createRenderbuffer(),U(n.__webglDepthbuffer[i],t,!1)}else r.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),U(n.__webglDepthbuffer,t,!1);r.bindFramebuffer(e.FRAMEBUFFER,null)}function z(e){return Math.min(d,e.samples)}function H(e){let r=i.get(e);return l&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==r.__useRenderToTexture}function V(e,r){let i=e.colorSpace,n=e.format,a=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===f2||i!==Hi&&i!==Oa&&(vi.getTransfer(i)===es?!1===l?!0===t.has("EXT_sRGB")&&n===gs?(e.format=f2,e.minFilter=wn,e.generateMipmaps=!1):r=T_.sRGBToLinear(r):(n!==gs||a!==wl)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",i)),r}this.allocateTextureUnit=function(){let e=P;return e>=h&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+h),P+=1,e},this.resetTextureUnits=function(){P=0},this.setTexture2D=R,this.setTexture2DArray=function(t,n){let a=i.get(t);t.version>0&&a.__version!==t.version?F(a,t,n):r.bindTexture(e.TEXTURE_2D_ARRAY,a.__webglTexture,e.TEXTURE0+n)},this.setTexture3D=function(t,n){let a=i.get(t);t.version>0&&a.__version!==t.version?F(a,t,n):r.bindTexture(e.TEXTURE_3D,a.__webglTexture,e.TEXTURE0+n)},this.setTextureCube=function(t,n){let s=i.get(t);t.version>0&&s.__version!==t.version?function(t,n,s){if(6!==n.image.length)return;let o=k(t,n),h=n.source;r.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+s);let u=i.get(h);if(h.version!==u.__version||!0===o){r.activeTexture(e.TEXTURE0+s);let t=vi.getPrimaries(vi.workingColorSpace),i=n.colorSpace===Oa?null:vi.getPrimaries(n.colorSpace),d=n.colorSpace===Oa||t===i?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,n.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,n.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);let p=n.isCompressedTexture||n.image[0].isCompressedTexture,f=n.image[0]&&n.image[0].isDataTexture,m=[];for(let e=0;e<6;e++)m[e]=p||f?f?n.image[e].image:n.image[e]:b(n.image[e],!1,!0,c),m[e]=V(n,m[e]);let g,v=m[0],y=x(v)||l,M=a.convert(n.format,n.colorSpace),E=a.convert(n.type),A=S(n.internalFormat,M,E,n.colorSpace),C=l&&!0!==n.isVideoTexture,P=void 0===u.__version||!0===o,R=T(n,v,y);if(D(e.TEXTURE_CUBE_MAP,n,y),p){C&&P&&r.texStorage2D(e.TEXTURE_CUBE_MAP,R,A,v.width,v.height);for(let t=0;t<6;t++){g=m[t].mipmaps;for(let i=0;i<g.length;i++){let a=g[i];n.format!==gs?null!==M?C?r.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,a.width,a.height,M,a.data):r.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,A,a.width,a.height,0,a.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):C?r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,0,0,a.width,a.height,M,E,a.data):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i,A,a.width,a.height,0,M,E,a.data)}}}else{g=n.mipmaps,C&&P&&(g.length>0&&R++,r.texStorage2D(e.TEXTURE_CUBE_MAP,R,A,m[0].width,m[0].height));for(let t=0;t<6;t++)if(f){C?r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,m[t].width,m[t].height,M,E,m[t].data):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,A,m[t].width,m[t].height,0,M,E,m[t].data);for(let i=0;i<g.length;i++){let n=g[i].image[t].image;C?r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,n.width,n.height,M,E,n.data):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,A,n.width,n.height,0,M,E,n.data)}}else{C?r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,M,E,m[t]):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,A,M,E,m[t]);for(let i=0;i<g.length;i++){let n=g[i];C?r.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,0,0,M,E,n.image[t]):r.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,A,M,E,n.image[t])}}}_(n,y)&&w(e.TEXTURE_CUBE_MAP),u.__version=h.version,n.onUpdate&&n.onUpdate(n)}t.__version=n.version}(s,t,n):r.bindTexture(e.TEXTURE_CUBE_MAP,s.__webglTexture,e.TEXTURE0+n)},this.rebindTextures=function(t,r,n){let a=i.get(t);void 0!==r&&N(a.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==n&&B(t)},this.setupRenderTarget=function(t){let o=t.texture,h=i.get(t),c=i.get(o);t.addEventListener("dispose",A),!0!==t.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=e.createTexture()),c.__version=o.version,s.memory.textures++);let u=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=x(t)||l;if(u){h.__webglFramebuffer=[];for(let t=0;t<6;t++)if(l&&o.mipmaps&&o.mipmaps.length>0){h.__webglFramebuffer[t]=[];for(let r=0;r<o.mipmaps.length;r++)h.__webglFramebuffer[t][r]=e.createFramebuffer()}else h.__webglFramebuffer[t]=e.createFramebuffer()}else{if(l&&o.mipmaps&&o.mipmaps.length>0){h.__webglFramebuffer=[];for(let t=0;t<o.mipmaps.length;t++)h.__webglFramebuffer[t]=e.createFramebuffer()}else h.__webglFramebuffer=e.createFramebuffer();if(d)if(n.drawBuffers){let r=t.texture;for(let t=0,n=r.length;t<n;t++){let n=i.get(r[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(l&&t.samples>0&&!1===H(t)){let i=d?o:[o];h.__webglMultisampledFramebuffer=e.createFramebuffer(),h.__webglColorRenderbuffer=[],r.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer);for(let r=0;r<i.length;r++){let n=i[r];h.__webglColorRenderbuffer[r]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,h.__webglColorRenderbuffer[r]);let s=a.convert(n.format,n.colorSpace),o=a.convert(n.type),l=S(n.internalFormat,s,o,n.colorSpace,!0===t.isXRRenderTarget),c=z(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,c,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+r,e.RENDERBUFFER,h.__webglColorRenderbuffer[r])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(h.__webglDepthRenderbuffer=e.createRenderbuffer(),U(h.__webglDepthRenderbuffer,t,!0)),r.bindFramebuffer(e.FRAMEBUFFER,null)}}if(u){r.bindTexture(e.TEXTURE_CUBE_MAP,c.__webglTexture),D(e.TEXTURE_CUBE_MAP,o,p);for(let r=0;r<6;r++)if(l&&o.mipmaps&&o.mipmaps.length>0)for(let i=0;i<o.mipmaps.length;i++)N(h.__webglFramebuffer[r][i],t,o,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+r,i);else N(h.__webglFramebuffer[r],t,o,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0);_(o,p)&&w(e.TEXTURE_CUBE_MAP),r.unbindTexture()}else if(d){let n=t.texture;for(let a=0,s=n.length;a<s;a++){let s=n[a],o=i.get(s);r.bindTexture(e.TEXTURE_2D,o.__webglTexture),D(e.TEXTURE_2D,s,p),N(h.__webglFramebuffer,t,s,e.COLOR_ATTACHMENT0+a,e.TEXTURE_2D,0),_(s,p)&&w(e.TEXTURE_2D)}r.unbindTexture()}else{let i=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l?i=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),r.bindTexture(i,c.__webglTexture),D(i,o,p),l&&o.mipmaps&&o.mipmaps.length>0)for(let r=0;r<o.mipmaps.length;r++)N(h.__webglFramebuffer[r],t,o,e.COLOR_ATTACHMENT0,i,r);else N(h.__webglFramebuffer,t,o,e.COLOR_ATTACHMENT0,i,0);_(o,p)&&w(i),r.unbindTexture()}t.depthBuffer&&B(t)},this.updateRenderTargetMipmap=function(t){let n=x(t)||l,a=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,o=a.length;s<o;s++){let o=a[s];if(_(o,n)){let n=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,a=i.get(o).__webglTexture;r.bindTexture(n,a),w(n),r.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(l&&t.samples>0&&!1===H(t)){let n=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],a=t.width,s=t.height,o=e.COLOR_BUFFER_BIT,l=[],h=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=i.get(t),u=!0===t.isWebGLMultipleRenderTargets;if(u)for(let t=0;t<n.length;t++)r.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),r.bindFramebuffer(e.FRAMEBUFFER,c.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);r.bindFramebuffer(e.READ_FRAMEBUFFER,c.__webglMultisampledFramebuffer),r.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglFramebuffer);for(let r=0;r<n.length;r++){l.push(e.COLOR_ATTACHMENT0+r),t.depthBuffer&&l.push(h);let d=void 0!==c.__ignoreDepthValues&&c.__ignoreDepthValues;if(!1===d&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),u&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,c.__webglColorRenderbuffer[r]),!0===d&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[h]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[h])),u){let t=i.get(n[r]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,a,s,0,0,a,s,o,e.NEAREST),f&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(r.bindFramebuffer(e.READ_FRAMEBUFFER,null),r.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),u)for(let t=0;t<n.length;t++){r.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,c.__webglColorRenderbuffer[t]);let a=i.get(n[t]).__webglTexture;r.bindFramebuffer(e.FRAMEBUFFER,c.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,a,0)}r.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=B,this.setupFrameBufferTexture=N,this.useMultisampledRTT=H}function uve(e,t,r){let i=r.isWebGL2;return{convert:function(r,n=Oa){let a,s=vi.getTransfer(n);if(r===wl)return e.UNSIGNED_BYTE;if(r===G4)return e.UNSIGNED_SHORT_4_4_4_4;if(r===q4)return e.UNSIGNED_SHORT_5_5_5_1;if(r===F0e)return e.BYTE;if(r===B0e)return e.SHORT;if(r===G2)return e.UNSIGNED_SHORT;if(r===z4)return e.INT;if(r===zd)return e.UNSIGNED_INT;if(r===Us)return e.FLOAT;if(r===Cn)return i?e.HALF_FLOAT:(a=t.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null);if(r===N0e)return e.ALPHA;if(r===gs)return e.RGBA;if(r===q2)return e.LUMINANCE;if(r===U0e)return e.LUMINANCE_ALPHA;if(r===bp)return e.DEPTH_COMPONENT;if(r===pu)return e.DEPTH_STENCIL;if(r===f2)return a=t.get("EXT_sRGB"),null!==a?a.SRGB_ALPHA_EXT:null;if(r===u1)return e.RED;if(r===j4)return e.RED_INTEGER;if(r===H0e)return e.RG;if(r===W4)return e.RG_INTEGER;if(r===X4)return e.RGBA_INTEGER;if(r===Ly||r===l2||r===ky||r===Fy)if(s===es){if(a=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===a)return null;if(r===Ly)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===l2)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===ky)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===Fy)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=t.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(r===Ly)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===l2)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===ky)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===Fy)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(r===v6||r===y6||r===b6||r===x6){if(a=t.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(r===v6)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===y6)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===b6)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===x6)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(r===q_)return a=t.get("WEBGL_compressed_texture_etc1"),null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===E6||r===_6){if(a=t.get("WEBGL_compressed_texture_etc"),null===a)return null;if(r===E6)return s===es?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(r===_6)return s===es?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(r===T6||r===w6||r===S6||r===M6||r===A6||r===R6||r===C6||r===P6||r===I6||r===O6||r===D6||r===L6||r===k6||r===F6){if(a=t.get("WEBGL_compressed_texture_astc"),null===a)return null;if(r===T6)return s===es?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===w6)return s===es?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===S6)return s===es?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===M6)return s===es?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===A6)return s===es?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===R6)return s===es?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===C6)return s===es?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===P6)return s===es?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===I6)return s===es?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===O6)return s===es?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===D6)return s===es?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===L6)return s===es?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===k6)return s===es?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===F6)return s===es?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(r===c2||r===m_||r===g_){if(a=t.get("EXT_texture_compression_bptc"),null===a)return null;if(r===c2)return s===es?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===m_)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===g_)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(r===V0e||r===B6||r===N6||r===U6){if(a=t.get("EXT_texture_compression_rgtc"),null===a)return null;if(r===c2)return a.COMPRESSED_RED_RGTC1_EXT;if(r===B6)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===N6)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===U6)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return r===oc?i?e.UNSIGNED_INT_24_8:(a=t.get("WEBGL_depth_texture"),null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[r]?e[r]:null}}}var y2=class extends ci{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},Xr=class extends yr{constructor(){super(),this.isGroup=!0,this.type="Group"}},eyt={type:"move"},u_=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Xr,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Xr,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new F,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new F),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Xr,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new F,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new F),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,r){let i=null,n=null,a=null,s=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){a=!0;for(let i of e.hand.values()){let e=t.getJointPose(i,r),n=this._getHandJoint(l,i);null!==e&&(n.matrix.fromArray(e.transform.matrix),n.matrix.decompose(n.position,n.rotation,n.scale),n.matrixWorldNeedsUpdate=!0,n.jointRadius=e.radius),n.visible=null!==e}let i=l.joints["index-finger-tip"],n=l.joints["thumb-tip"],s=i.position.distanceTo(n.position),o=.02,h=.005;l.inputState.pinching&&s>o+h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=o-h&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(n=t.getPose(e.gripSpace,r),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1));null!==s&&(i=t.getPose(e.targetRaySpace,r),null===i&&null!==n&&(i=n),null!==i&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(eyt)))}return null!==s&&(s.visible=null!==i),null!==o&&(o.visible=null!==n),null!==l&&(l.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){let r=new Xr;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}},n4=class extends mu{constructor(e,t){super();let r=this,i=null,n=1,a=null,s="local-floor",o=1,l=null,h=null,c=null,u=null,d=null,p=null,f=t.getContextAttributes(),m=null,g=null,v=[],y=[],b=new Te,x=null,_=new ci;_.layers.enable(1),_.viewport=new Fn;let w=new ci;w.layers.enable(2),w.viewport=new Fn;let S=[_,w],T=new y2;T.layers.enable(1),T.layers.enable(2);let M=null,E=null;function A(e){let t=y.indexOf(e.inputSource);if(-1===t)return;let r=v[t];void 0!==r&&(r.update(e.inputSource,e.frame,l||a),r.dispatchEvent({type:e.type,data:e.inputSource}))}function C(){i.removeEventListener("select",A),i.removeEventListener("selectstart",A),i.removeEventListener("selectend",A),i.removeEventListener("squeeze",A),i.removeEventListener("squeezestart",A),i.removeEventListener("squeezeend",A),i.removeEventListener("end",C),i.removeEventListener("inputsourceschange",P);for(let e=0;e<v.length;e++){let t=y[e];null!==t&&(y[e]=null,v[e].disconnect(t))}M=null,E=null,e.setRenderTarget(m),d=null,u=null,c=null,i=null,g=null,D.stop(),r.isPresenting=!1,e.setPixelRatio(x),e.setSize(b.width,b.height,!1),r.dispatchEvent({type:"sessionend"})}function P(e){for(let t=0;t<e.removed.length;t++){let r=e.removed[t],i=y.indexOf(r);i>=0&&(y[i]=null,v[i].disconnect(r))}for(let t=0;t<e.added.length;t++){let r=e.added[t],i=y.indexOf(r);if(-1===i){for(let e=0;e<v.length;e++){if(e>=y.length){y.push(r),i=e;break}if(null===y[e]){y[e]=r,i=e;break}}if(-1===i)break}let n=v[i];n&&n.connect(r)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=v[e];return void 0===t&&(t=new u_,v[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=v[e];return void 0===t&&(t=new u_,v[e]=t),t.getGripSpace()},this.getHand=function(e){let t=v[e];return void 0===t&&(t=new u_,v[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){n=e,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return c},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=function(h){return bt(this,null,(function*(){if(i=h,null!==i){if(m=e.getRenderTarget(),i.addEventListener("select",A),i.addEventListener("selectstart",A),i.addEventListener("selectend",A),i.addEventListener("squeeze",A),i.addEventListener("squeezestart",A),i.addEventListener("squeezeend",A),i.addEventListener("end",C),i.addEventListener("inputsourceschange",P),!0!==f.xrCompatible&&(yield t.makeXRCompatible()),x=e.getPixelRatio(),e.getSize(b),void 0===i.renderState.layers||!1===e.capabilities.isWebGL2){let r={antialias:void 0!==i.renderState.layers||f.antialias,alpha:!0,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(i,t,r),i.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),g=new yn(d.framebufferWidth,d.framebufferHeight,{format:gs,type:wl,colorSpace:e.outputColorSpace,stencilBuffer:f.stencil})}else{let r=null,a=null,s=null;f.depth&&(s=f.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,r=f.stencil?pu:bp,a=f.stencil?oc:zd);let o={colorFormat:t.RGBA8,depthFormat:s,scaleFactor:n};c=new XRWebGLBinding(i,t),u=c.createProjectionLayer(o),i.updateRenderState({layers:[u]}),e.setPixelRatio(1),e.setSize(u.textureWidth,u.textureHeight,!1),g=new yn(u.textureWidth,u.textureHeight,{format:gs,type:wl,depthTexture:new Xd(u.textureWidth,u.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,r),stencilBuffer:f.stencil,colorSpace:e.outputColorSpace,samples:f.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=u.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(o),l=null,a=yield i.requestReferenceSpace(s),D.setContext(i),D.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}}))},this.getEnvironmentBlendMode=function(){if(null!==i)return i.environmentBlendMode};let R=new F,I=new F;function O(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;T.near=w.near=_.near=e.near,T.far=w.far=_.far=e.far,(M!==T.near||E!==T.far)&&(i.updateRenderState({depthNear:T.near,depthFar:T.far}),M=T.near,E=T.far);let t=e.parent,r=T.cameras;O(T,t);for(let e=0;e<r.length;e++)O(r[e],t);2===r.length?function(e,t,r){R.setFromMatrixPosition(t.matrixWorld),I.setFromMatrixPosition(r.matrixWorld);let i=R.distanceTo(I),n=t.projectionMatrix.elements,a=r.projectionMatrix.elements,s=n[14]/(n[10]-1),o=n[14]/(n[10]+1),l=(n[9]+1)/n[5],h=(n[9]-1)/n[5],c=(n[8]-1)/n[0],u=(a[8]+1)/a[0],d=s*c,p=s*u,f=i/(-c+u),m=f*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();let g=s+f,v=o+f,y=d-m,b=p+(i-m),x=l*o/v*g,_=h*o/v*g;e.projectionMatrix.makePerspective(y,b,x,_,g,v),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}(T,_,w):T.projectionMatrix.copy(_.projectionMatrix),function(e,t,r){null===r?e.matrix.copy(t.matrixWorld):(e.matrix.copy(r.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld)),e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*Hy*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,T,t)},this.getCamera=function(){return T},this.getFoveation=function(){if(null!==u||null!==d)return o},this.setFoveation=function(e){o=e,null!==u&&(u.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)};let L=null;let D=new ive;D.setAnimationLoop((function(t,i){if(h=i.getViewerPose(l||a),p=i,null!==h){let t=h.views;null!==d&&(e.setRenderTargetFramebuffer(g,d.framebuffer),e.setRenderTarget(g));let r=!1;t.length!==T.cameras.length&&(T.cameras.length=0,r=!0);for(let i=0;i<t.length;i++){let n=t[i],a=null;if(null!==d)a=d.getViewport(n);else{let t=c.getViewSubImage(u,n);a=t.viewport,0===i&&(e.setRenderTargetTextures(g,t.colorTexture,u.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}let s=S[i];void 0===s&&(s=new ci,s.layers.enable(i),s.viewport=new Fn,S[i]=s),s.matrix.fromArray(n.transform.matrix),s.matrix.decompose(s.position,s.quaternion,s.scale),s.projectionMatrix.fromArray(n.projectionMatrix),s.projectionMatrixInverse.copy(s.projectionMatrix).invert(),s.viewport.set(a.x,a.y,a.width,a.height),0===i&&(T.matrix.copy(s.matrix),T.matrix.decompose(T.position,T.quaternion,T.scale)),!0===r&&T.cameras.push(s)}}for(let e=0;e<v.length;e++){let t=y[e],r=v[e];null!==t&&void 0!==r&&r.update(t,i,l||a)}L&&L(t,i),i.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:i}),p=null})),this.setAnimationLoop=function(e){L=e},this.dispose=function(){}}};function tyt(e,t){function r(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function i(i,n){i.opacity.value=n.opacity,n.color&&i.diffuse.value.copy(n.color),n.emissive&&i.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(i.map.value=n.map,r(n.map,i.mapTransform)),n.alphaMap&&(i.alphaMap.value=n.alphaMap,r(n.alphaMap,i.alphaMapTransform)),n.bumpMap&&(i.bumpMap.value=n.bumpMap,r(n.bumpMap,i.bumpMapTransform),i.bumpScale.value=n.bumpScale,n.side===ws&&(i.bumpScale.value*=-1)),n.normalMap&&(i.normalMap.value=n.normalMap,r(n.normalMap,i.normalMapTransform),i.normalScale.value.copy(n.normalScale),n.side===ws&&i.normalScale.value.negate()),n.displacementMap&&(i.displacementMap.value=n.displacementMap,r(n.displacementMap,i.displacementMapTransform),i.displacementScale.value=n.displacementScale,i.displacementBias.value=n.displacementBias),n.emissiveMap&&(i.emissiveMap.value=n.emissiveMap,r(n.emissiveMap,i.emissiveMapTransform)),n.specularMap&&(i.specularMap.value=n.specularMap,r(n.specularMap,i.specularMapTransform)),n.alphaTest>0&&(i.alphaTest.value=n.alphaTest);let a=t.get(n).envMap;if(a&&(i.envMap.value=a,i.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,i.reflectivity.value=n.reflectivity,i.ior.value=n.ior,i.refractionRatio.value=n.refractionRatio),n.lightMap){i.lightMap.value=n.lightMap;let t=!0===e._useLegacyLights?Math.PI:1;i.lightMapIntensity.value=n.lightMapIntensity*t,r(n.lightMap,i.lightMapTransform)}n.aoMap&&(i.aoMap.value=n.aoMap,i.aoMapIntensity.value=n.aoMapIntensity,r(n.aoMap,i.aoMapTransform))}return{refreshFogUniforms:function(t,r){r.color.getRGB(t.fogColor.value,nve(e)),r.isFog?(t.fogNear.value=r.near,t.fogFar.value=r.far):r.isFogExp2&&(t.fogDensity.value=r.density)},refreshMaterialUniforms:function(e,n,a,s,o){n.isMeshBasicMaterial||n.isMeshLambertMaterial?i(e,n):n.isMeshToonMaterial?(i(e,n),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,n)):n.isMeshPhongMaterial?(i(e,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,n)):n.isMeshStandardMaterial?(i(e,n),function(e,i){e.metalness.value=i.metalness,i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap,r(i.metalnessMap,e.metalnessMapTransform)),e.roughness.value=i.roughness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap,r(i.roughnessMap,e.roughnessMapTransform)),t.get(i).envMap&&(e.envMapIntensity.value=i.envMapIntensity)}(e,n),n.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,r(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,r(t.sheenRoughnessMap,e.sheenRoughnessMapTransform))),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,r(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,r(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,r(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),t.side===ws&&e.clearcoatNormalScale.value.negate())),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,r(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,r(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform))),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,r(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,r(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,r(t.anisotropyMap,e.anisotropyMapTransform))),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,r(t.specularColorMap,e.specularColorMapTransform)),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,r(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,n,o)):n.isMeshMatcapMaterial?(i(e,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,n)):n.isMeshDepthMaterial?i(e,n):n.isMeshDistanceMaterial?(i(e,n),function(e,r){let i=t.get(r).light;e.referencePosition.value.setFromMatrixPosition(i.matrixWorld),e.nearDistance.value=i.shadow.camera.near,e.farDistance.value=i.shadow.camera.far}(e,n)):n.isMeshNormalMaterial?i(e,n):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,r(t.map,e.mapTransform))}(e,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,n)):n.isPointsMaterial?function(e,t,i,n){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*n,t.map&&(e.map.value=t.map,r(t.map,e.uvTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,r(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,n,a,s):n.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,r(t.map,e.mapTransform)),t.alphaMap&&(e.alphaMap.value=t.alphaMap,r(t.alphaMap,e.alphaMapTransform)),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,n):n.isShadowMaterial?(e.color.value.copy(n.color),e.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function ryt(e,t,r,i){let n={},a={},s=[],o=r.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e,t,r){let i=e.value;if(void 0===r[t]){if("number"==typeof i)r[t]=i;else{let e=Array.isArray(i)?i:[i],n=[];for(let t=0;t<e.length;t++)n.push(e[t].clone());r[t]=n}return!0}if("number"==typeof i){if(r[t]!==i)return r[t]=i,!0}else{let e=Array.isArray(r[t])?r[t]:[r[t]],n=Array.isArray(i)?i:[i];for(let t=0;t<e.length;t++){let r=e[t];if(!1===r.equals(n[t]))return r.copy(n[t]),!0}}return!1}function h(e){let t={boundary:0,storage:0};return"number"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function c(t){let r=t.target;r.removeEventListener("dispose",c);let i=s.indexOf(r.__bindingPointIndex);s.splice(i,1),e.deleteBuffer(n[r.id]),delete n[r.id],delete a[r.id]}return{bind:function(e,t){let r=t.program;i.uniformBlockBinding(e,r)},update:function(r,u){let d=n[r.id];void 0===d&&(function(e){let t=e.uniforms,r=0,i=16,n=0;for(let e=0,a=t.length;e<a;e++){let a=t[e],s={boundary:0,storage:0},o=Array.isArray(a.value)?a.value:[a.value];for(let e=0,t=o.length;e<t;e++){let t=h(o[e]);s.boundary+=t.boundary,s.storage+=t.storage}if(a.__data=new Float32Array(s.storage/Float32Array.BYTES_PER_ELEMENT),a.__offset=r,e>0){n=r%i,0!==n&&i-n-s.boundary<0&&(r+=i-n,a.__offset=r)}r+=s.storage}n=r%i,n>0&&(r+=i-n),e.__size=r,e.__cache={}}(r),d=function(t){let r=function(){for(let e=0;e<o;e++)if(-1===s.indexOf(e))return s.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=r;let i=e.createBuffer(),n=t.__size,a=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,n,a),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,r,i),i}(r),n[r.id]=d,r.addEventListener("dispose",c));let p=u.program;i.updateUBOMapping(r,p);let f=t.render.frame;a[r.id]!==f&&(function(t){let r=n[t.id],i=t.uniforms,a=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,r);for(let t=0,r=i.length;t<r;t++){let r=i[t];if(!0===l(r,t,a)){let t=r.__offset,i=Array.isArray(r.value)?r.value:[r.value],n=0;for(let a=0;a<i.length;a++){let s=i[a],o=h(s);"number"==typeof s?(r.__data[0]=s,e.bufferSubData(e.UNIFORM_BUFFER,t+n,r.__data)):s.isMatrix3?(r.__data[0]=s.elements[0],r.__data[1]=s.elements[1],r.__data[2]=s.elements[2],r.__data[3]=s.elements[0],r.__data[4]=s.elements[3],r.__data[5]=s.elements[4],r.__data[6]=s.elements[5],r.__data[7]=s.elements[0],r.__data[8]=s.elements[6],r.__data[9]=s.elements[7],r.__data[10]=s.elements[8],r.__data[11]=s.elements[0]):(s.toArray(r.__data,n),n+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,r.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(r),a[r.id]=f)},dispose:function(){for(let t in n)e.deleteBuffer(n[t]);s=[],n={},a={}}}}var Ka=class{constructor(e={}){let t,{canvas:r=tve(),context:i=null,depth:n=!0,stencil:a=!0,alpha:s=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:h=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1}=e;this.isWebGLRenderer=!0,t=null!==i?i.getContextAttributes().alpha:s;let d=new Uint32Array(4),p=new Int32Array(4),f=null,m=null,g=[],v=[];this.domElement=r,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Zr,this._useLegacyLights=!1,this.toneMapping=Gd,this.toneMappingExposure=1;let y=this,b=!1,x=0,_=0,w=null,S=-1,T=null,M=new Fn,E=new Fn,A=null,C=new dt(0),P=0,R=r.width,I=r.height,O=1,L=null,D=null,k=new Fn(0,0,R,I),N=new Fn(0,0,R,I),U=!1,B=new Ml,z=!1,H=!1,V=null,j=new lt,G=new Te,W=new F,X={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function q(){return null===w?O:1}let Y,$,Z,K,J,Q,ee,te,re,ie,ne,ae,se,oe,le,he,ce,ue,de,pe,fe,me,ge,ve,ye=i;function be(e,t){for(let i=0;i<e.length;i++){let n=e[i],a=r.getContext(n,t);if(null!==a)return a}return null}try{let e={alpha:!0,depth:n,stencil:a,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:h,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in r&&r.setAttribute("data-engine",`three.js r${V2}`),r.addEventListener("webglcontextlost",we,!1),r.addEventListener("webglcontextrestored",Se,!1),r.addEventListener("webglcontextcreationerror",Me,!1),null===ye){let t=["webgl2","webgl","experimental-webgl"];if(!0===y.isWebGL1Renderer&&t.shift(),ye=be(t,e),null===ye)throw be(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&ye instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===ye.getShaderPrecisionFormat&&(ye.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function xe(){Y=new T0t(ye),$=new v0t(ye,Y,e),Y.init($),me=new uve(ye,Y,$),Z=new Jvt(ye,Y,$),K=new M0t(ye),J=new Hvt,Q=new Qvt(ye,Y,Z,J,$,me,K),ee=new b0t(y),te=new _0t(y),re=new Lpt(ye,$),ge=new m0t(ye,Y,re,$),ie=new w0t(ye,re,K,ge),ne=new P0t(ye,ie,re,K),de=new C0t(ye,$,Q),he=new y0t(J),ae=new Uvt(y,ee,te,Y,$,ge,he),se=new tyt(y,J),oe=new zvt,le=new Yvt(Y,$),ue=new p0t(y,ee,te,Z,ne,t,l),ce=new Kvt(y,ne,$),ve=new ryt(ye,K,$,Z),pe=new g0t(ye,Y,K,$),fe=new S0t(ye,Y,K,$),K.programs=ae.programs,y.capabilities=$,y.extensions=Y,y.properties=J,y.renderLists=oe,y.shadowMap=ce,y.state=Z,y.info=K}xe();let _e=new n4(y,ye);function we(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function Se(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;let e=K.autoReset,t=ce.enabled,r=ce.autoUpdate,i=ce.needsUpdate,n=ce.type;xe(),K.autoReset=e,ce.enabled=t,ce.autoUpdate=r,ce.needsUpdate=i,ce.type=n}function Me(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function Ee(e){let t=e.target;t.removeEventListener("dispose",Ee),function(e){(function(e){let t=J.get(e).programs;void 0!==t&&(t.forEach((function(e){ae.releaseProgram(e)})),e.isShaderMaterial&&ae.releaseShaderCache(e))})(e),J.remove(e)}(t)}function Ae(e,t,r){!0===e.transparent&&e.side===ln&&!1===e.forceSinglePass?(e.side=ws,e.needsUpdate=!0,Fe(e,t,r),e.side=zi,e.needsUpdate=!0,Fe(e,t,r),e.side=ln):Fe(e,t,r)}this.xr=_e,this.getContext=function(){return ye},this.getContextAttributes=function(){return ye.getContextAttributes()},this.forceContextLoss=function(){let e=Y.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){let e=Y.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return O},this.setPixelRatio=function(e){void 0!==e&&(O=e,this.setSize(R,I,!1))},this.getSize=function(e){return e.set(R,I)},this.setSize=function(e,t,i=!0){_e.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(R=e,I=t,r.width=Math.floor(e*O),r.height=Math.floor(t*O),!0===i&&(r.style.width=e+"px",r.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(R*O,I*O).floor()},this.setDrawingBufferSize=function(e,t,i){R=e,I=t,O=i,r.width=Math.floor(e*i),r.height=Math.floor(t*i),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(M)},this.getViewport=function(e){return e.copy(k)},this.setViewport=function(e,t,r,i){e.isVector4?k.set(e.x,e.y,e.z,e.w):k.set(e,t,r,i),Z.viewport(M.copy(k).multiplyScalar(O).floor())},this.getScissor=function(e){return e.copy(N)},this.setScissor=function(e,t,r,i){e.isVector4?N.set(e.x,e.y,e.z,e.w):N.set(e,t,r,i),Z.scissor(E.copy(N).multiplyScalar(O).floor())},this.getScissorTest=function(){return U},this.setScissorTest=function(e){Z.setScissorTest(U=e)},this.setOpaqueSort=function(e){L=e},this.setTransparentSort=function(e){D=e},this.getClearColor=function(e){return e.copy(ue.getClearColor())},this.setClearColor=function(){ue.setClearColor.apply(ue,arguments)},this.getClearAlpha=function(){return ue.getClearAlpha()},this.setClearAlpha=function(){ue.setClearAlpha.apply(ue,arguments)},this.clear=function(e=!0,t=!0,r=!0){let i=0;if(e){let e=!1;if(null!==w){let t=w.texture.format;e=t===X4||t===W4||t===j4}if(e){let e=w.texture.type,t=e===wl||e===zd||e===G2||e===oc||e===G4||e===q4,r=ue.getClearColor(),i=ue.getClearAlpha(),n=r.r,a=r.g,s=r.b;t?(d[0]=n,d[1]=a,d[2]=s,d[3]=i,ye.clearBufferuiv(ye.COLOR,0,d)):(p[0]=n,p[1]=a,p[2]=s,p[3]=i,ye.clearBufferiv(ye.COLOR,0,p))}else i|=ye.COLOR_BUFFER_BIT}t&&(i|=ye.DEPTH_BUFFER_BIT),r&&(i|=ye.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ye.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){r.removeEventListener("webglcontextlost",we,!1),r.removeEventListener("webglcontextrestored",Se,!1),r.removeEventListener("webglcontextcreationerror",Me,!1),oe.dispose(),le.dispose(),J.dispose(),ee.dispose(),te.dispose(),ne.dispose(),ge.dispose(),ve.dispose(),ae.dispose(),_e.dispose(),_e.removeEventListener("sessionstart",Pe),_e.removeEventListener("sessionend",Re),V&&(V.dispose(),V=null),Ie.stop()},this.renderBufferDirect=function(e,t,r,i,n,a){null===t&&(t=X);let s=n.isMesh&&n.matrixWorld.determinant()<0,o=function(e,t,r,i,n){!0!==t.isScene&&(t=X),Q.resetTextureUnits();let a=t.fog,s=i.isMeshStandardMaterial?t.environment:null,o=null===w?y.outputColorSpace:!0===w.isXRRenderTarget?w.texture.colorSpace:Hi,l=(i.isMeshStandardMaterial?te:ee).get(i.envMap||s),h=!0===i.vertexColors&&!!r.attributes.color&&4===r.attributes.color.itemSize,c=!!r.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),u=!!r.morphAttributes.position,d=!!r.morphAttributes.normal,p=!!r.morphAttributes.color,f=Gd;i.toneMapped&&(null===w||!0===w.isXRRenderTarget)&&(f=y.toneMapping);let g=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,v=void 0!==g?g.length:0,b=J.get(i),x=m.state.lights;if(!0===z&&(!0===H||e!==T)){let t=e===T&&i.id===S;he.setState(i,e,t)}let _=!1;i.version===b.__version?(b.needsLights&&b.lightsStateVersion!==x.state.version||b.outputColorSpace!==o||n.isBatchedMesh&&!1===b.batching||!n.isBatchedMesh&&!0===b.batching||n.isInstancedMesh&&!1===b.instancing||!n.isInstancedMesh&&!0===b.instancing||n.isSkinnedMesh&&!1===b.skinning||!n.isSkinnedMesh&&!0===b.skinning||n.isInstancedMesh&&!0===b.instancingColor&&null===n.instanceColor||n.isInstancedMesh&&!1===b.instancingColor&&null!==n.instanceColor||b.envMap!==l||!0===i.fog&&b.fog!==a||void 0!==b.numClippingPlanes&&(b.numClippingPlanes!==he.numPlanes||b.numIntersection!==he.numIntersection)||b.vertexAlphas!==h||b.vertexTangents!==c||b.morphTargets!==u||b.morphNormals!==d||b.morphColors!==p||b.toneMapping!==f||!0===$.isWebGL2&&b.morphTargetsCount!==v)&&(_=!0):(_=!0,b.__version=i.version);let M=b.currentProgram;!0===_&&(M=Fe(i,t,n));let E=!1,A=!1,C=!1,P=M.getUniforms(),R=b.uniforms;if(Z.useProgram(M.program)&&(E=!0,A=!0,C=!0),i.id!==S&&(S=i.id,A=!0),E||T!==e){P.setValue(ye,"projectionMatrix",e.projectionMatrix),P.setValue(ye,"viewMatrix",e.matrixWorldInverse);let t=P.map.cameraPosition;void 0!==t&&t.setValue(ye,W.setFromMatrixPosition(e.matrixWorld)),$.logarithmicDepthBuffer&&P.setValue(ye,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&P.setValue(ye,"isOrthographic",!0===e.isOrthographicCamera),T!==e&&(T=e,A=!0,C=!0)}if(n.isSkinnedMesh){P.setOptional(ye,n,"bindMatrix"),P.setOptional(ye,n,"bindMatrixInverse");let e=n.skeleton;e&&($.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),P.setValue(ye,"boneTexture",e.boneTexture,Q)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}n.isBatchedMesh&&(P.setOptional(ye,n,"batchingTexture"),P.setValue(ye,"batchingTexture",n._matricesTexture,Q));let L=r.morphAttributes;if((void 0!==L.position||void 0!==L.normal||void 0!==L.color&&!0===$.isWebGL2)&&de.update(n,r,M),(A||b.receiveShadow!==n.receiveShadow)&&(b.receiveShadow=n.receiveShadow,P.setValue(ye,"receiveShadow",n.receiveShadow)),i.isMeshGouraudMaterial&&null!==i.envMap&&(R.envMap.value=l,R.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),A&&(P.setValue(ye,"toneMappingExposure",y.toneMappingExposure),b.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(R,C),a&&!0===i.fog&&se.refreshFogUniforms(R,a),se.refreshMaterialUniforms(R,i,O,I,V),Ny.upload(ye,Ne(b),R,Q)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Ny.upload(ye,Ne(b),R,Q),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&P.setValue(ye,"center",n.center),P.setValue(ye,"modelViewMatrix",n.modelViewMatrix),P.setValue(ye,"normalMatrix",n.normalMatrix),P.setValue(ye,"modelMatrix",n.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){let e=i.uniformsGroups;for(let t=0,r=e.length;t<r;t++)if($.isWebGL2){let r=e[t];ve.update(r,M),ve.bind(r,M)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return M}(e,t,r,i,n);Z.setMaterial(i,s);let l=r.index,h=1;if(!0===i.wireframe){if(l=ie.getWireframeAttribute(r),void 0===l)return;h=2}let c=r.drawRange,u=r.attributes.position,d=c.start*h,p=(c.start+c.count)*h;null!==a&&(d=Math.max(d,a.start*h),p=Math.min(p,(a.start+a.count)*h)),null!==l?(d=Math.max(d,0),p=Math.min(p,l.count)):null!=u&&(d=Math.max(d,0),p=Math.min(p,u.count));let f=p-d;if(f<0||f===1/0)return;ge.setup(n,i,o,r,l);let g,v=pe;if(null!==l&&(g=re.get(l),v=fe,v.setIndex(g)),n.isMesh)!0===i.wireframe?(Z.setLineWidth(i.wireframeLinewidth*q()),v.setMode(ye.LINES)):v.setMode(ye.TRIANGLES);else if(n.isLine){let e=i.linewidth;void 0===e&&(e=1),Z.setLineWidth(e*q()),n.isLineSegments?v.setMode(ye.LINES):n.isLineLoop?v.setMode(ye.LINE_LOOP):v.setMode(ye.LINE_STRIP)}else n.isPoints?v.setMode(ye.POINTS):n.isSprite&&v.setMode(ye.TRIANGLES);if(n.isBatchedMesh)v.renderMultiDraw(n._multiDrawStarts,n._multiDrawCounts,n._multiDrawCount);else if(n.isInstancedMesh)v.renderInstances(d,f,n.count);else if(r.isInstancedBufferGeometry){let e=void 0!==r._maxInstanceCount?r._maxInstanceCount:1/0,t=Math.min(r.instanceCount,e);v.renderInstances(d,f,t)}else v.render(d,f)},this.compile=function(e,t,r=null){null===r&&(r=e),m=le.get(r),m.init(),v.push(m),r.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),e!==r&&e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(m.pushLight(e),e.castShadow&&m.pushShadow(e))})),m.setupLights(y._useLegacyLights);let i=new Set;return e.traverse((function(e){let t=e.material;if(t)if(Array.isArray(t))for(let n=0;n<t.length;n++){let a=t[n];Ae(a,r,e),i.add(a)}else Ae(t,r,e),i.add(t)})),v.pop(),m=null,i},this.compileAsync=function(e,t,r=null){let i=this.compile(e,t,r);return new Promise((t=>{function r(){i.forEach((function(e){J.get(e).currentProgram.isReady()&&i.delete(e)})),0!==i.size?setTimeout(r,10):t(e)}null!==Y.get("KHR_parallel_shader_compile")?r():setTimeout(r,10)}))};let Ce=null;function Pe(){Ie.stop()}function Re(){Ie.start()}let Ie=new ive;function Oe(e,t,r,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)r=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)m.pushLight(e),e.castShadow&&m.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||B.intersectsSprite(e)){i&&W.setFromMatrixPosition(e.matrixWorld).applyMatrix4(j);let t=ne.update(e),n=e.material;n.visible&&f.push(e,t,n,r,W.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||B.intersectsObject(e))){let t=ne.update(e),n=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),W.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),W.copy(t.boundingSphere.center)),W.applyMatrix4(e.matrixWorld).applyMatrix4(j)),Array.isArray(n)){let i=t.groups;for(let a=0,s=i.length;a<s;a++){let s=i[a],o=n[s.materialIndex];o&&o.visible&&f.push(e,t,o,r,W.z,s)}}else n.visible&&f.push(e,t,n,r,W.z,null)}let n=e.children;for(let e=0,a=n.length;e<a;e++)Oe(n[e],t,r,i)}function Le(e,t,r,i){let n=e.opaque,a=e.transmissive,s=e.transparent;m.setupLightsView(r),!0===z&&he.setGlobalState(y.clippingPlanes,r),a.length>0&&function(e,t,r,i){if(null!==(!0===r.isScene?r.overrideMaterial:null))return;let n=$.isWebGL2;null===V&&(V=new yn(1,1,{generateMipmaps:!0,type:Y.has("EXT_color_buffer_half_float")?Cn:wl,minFilter:ia,samples:n?4:0})),y.getDrawingBufferSize(G),n?V.setSize(G.x,G.y):V.setSize(p2(G.x),p2(G.y));let a=y.getRenderTarget();y.setRenderTarget(V),y.getClearColor(C),P=y.getClearAlpha(),P<1&&y.setClearColor(16777215,.5),y.clear();let s=y.toneMapping;y.toneMapping=Gd,De(e,r,i),Q.updateMultisampleRenderTarget(V),Q.updateRenderTargetMipmap(V);let o=!1;for(let e=0,n=t.length;e<n;e++){let n=t[e],a=n.object,s=n.geometry,l=n.material,h=n.group;if(l.side===ln&&a.layers.test(i.layers)){let e=l.side;l.side=ws,l.needsUpdate=!0,ke(a,r,i,s,l,h),l.side=e,l.needsUpdate=!0,o=!0}}!0===o&&(Q.updateMultisampleRenderTarget(V),Q.updateRenderTargetMipmap(V)),y.setRenderTarget(a),y.setClearColor(C,P),y.toneMapping=s}(n,a,t,r),i&&Z.viewport(M.copy(i)),n.length>0&&De(n,t,r),a.length>0&&De(a,t,r),s.length>0&&De(s,t,r),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1)}function De(e,t,r){let i=!0===t.isScene?t.overrideMaterial:null;for(let n=0,a=e.length;n<a;n++){let a=e[n],s=a.object,o=a.geometry,l=null===i?a.material:i,h=a.group;s.layers.test(r.layers)&&ke(s,t,r,o,l,h)}}function ke(e,t,r,i,n,a){e.onBeforeRender(y,t,r,i,n,a),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),n.onBeforeRender(y,t,r,i,e,a),!0===n.transparent&&n.side===ln&&!1===n.forceSinglePass?(n.side=ws,n.needsUpdate=!0,y.renderBufferDirect(r,t,i,n,e,a),n.side=zi,n.needsUpdate=!0,y.renderBufferDirect(r,t,i,n,e,a),n.side=ln):y.renderBufferDirect(r,t,i,n,e,a),e.onAfterRender(y,t,r,i,n,a)}function Fe(e,t,r){!0!==t.isScene&&(t=X);let i=J.get(e),n=m.state.lights,a=m.state.shadowsArray,s=n.state.version,o=ae.getParameters(e,n.state,a,t,r),l=ae.getProgramCacheKey(o),h=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?te:ee).get(e.envMap||i.environment),void 0===h&&(e.addEventListener("dispose",Ee),h=new Map,i.programs=h);let c=h.get(l);if(void 0!==c){if(i.currentProgram===c&&i.lightsStateVersion===s)return Ue(e,o),c}else o.uniforms=ae.getUniforms(e),e.onBuild(r,o,y),e.onBeforeCompile(o,y),c=ae.acquireProgram(o,l),h.set(l,c),i.uniforms=o.uniforms;let u=i.uniforms;return(!e.isShaderMaterial&&!e.isRawShaderMaterial||!0===e.clipping)&&(u.clippingPlanes=he.uniform),Ue(e,o),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=s,i.needsLights&&(u.ambientLightColor.value=n.state.ambient,u.lightProbe.value=n.state.probe,u.directionalLights.value=n.state.directional,u.directionalLightShadows.value=n.state.directionalShadow,u.spotLights.value=n.state.spot,u.spotLightShadows.value=n.state.spotShadow,u.rectAreaLights.value=n.state.rectArea,u.ltc_1.value=n.state.rectAreaLTC1,u.ltc_2.value=n.state.rectAreaLTC2,u.pointLights.value=n.state.point,u.pointLightShadows.value=n.state.pointShadow,u.hemisphereLights.value=n.state.hemi,u.directionalShadowMap.value=n.state.directionalShadowMap,u.directionalShadowMatrix.value=n.state.directionalShadowMatrix,u.spotShadowMap.value=n.state.spotShadowMap,u.spotLightMatrix.value=n.state.spotLightMatrix,u.spotLightMap.value=n.state.spotLightMap,u.pointShadowMap.value=n.state.pointShadowMap,u.pointShadowMatrix.value=n.state.pointShadowMatrix),i.currentProgram=c,i.uniformsList=null,c}function Ne(e){if(null===e.uniformsList){let t=e.currentProgram.getUniforms();e.uniformsList=Ny.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Ue(e,t){let r=J.get(e);r.outputColorSpace=t.outputColorSpace,r.batching=t.batching,r.instancing=t.instancing,r.instancingColor=t.instancingColor,r.skinning=t.skinning,r.morphTargets=t.morphTargets,r.morphNormals=t.morphNormals,r.morphColors=t.morphColors,r.morphTargetsCount=t.morphTargetsCount,r.numClippingPlanes=t.numClippingPlanes,r.numIntersection=t.numClipIntersection,r.vertexAlphas=t.vertexAlphas,r.vertexTangents=t.vertexTangents,r.toneMapping=t.toneMapping}Ie.setAnimationLoop((function(e){Ce&&Ce(e)})),"undefined"!=typeof self&&Ie.setContext(self),this.setAnimationLoop=function(e){Ce=e,_e.setAnimationLoop(e),null===e?Ie.stop():Ie.start()},_e.addEventListener("sessionstart",Pe),_e.addEventListener("sessionend",Re),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===b)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===_e.enabled&&!0===_e.isPresenting&&(!0===_e.cameraAutoUpdate&&_e.updateCamera(t),t=_e.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,w),m=le.get(e,v.length),m.init(),v.push(m),j.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),B.setFromProjectionMatrix(j),H=this.localClippingEnabled,z=he.init(this.clippingPlanes,H),f=oe.get(e,g.length),f.init(),g.push(f),Oe(e,t,0,y.sortObjects),f.finish(),!0===y.sortObjects&&f.sort(L,D),this.info.render.frame++,!0===z&&he.beginShadows();let r=m.state.shadowsArray;if(ce.render(r,e,t),!0===z&&he.endShadows(),!0===this.info.autoReset&&this.info.reset(),ue.render(f,e),m.setupLights(y._useLegacyLights),t.isArrayCamera){let r=t.cameras;for(let t=0,i=r.length;t<i;t++){let i=r[t];Le(f,e,i,i.viewport)}}else Le(f,e,t);null!==w&&(Q.updateMultisampleRenderTarget(w),Q.updateRenderTargetMipmap(w)),!0===e.isScene&&e.onAfterRender(y,e,t),ge.resetDefaultState(),S=-1,T=null,v.pop(),m=v.length>0?v[v.length-1]:null,g.pop(),f=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return x},this.getActiveMipmapLevel=function(){return _},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(e,t,r){J.get(e.texture).__webglTexture=t,J.get(e.depthTexture).__webglTexture=r;let i=J.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===r,i.__autoAllocateDepthBuffer||!0===Y.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){let r=J.get(e);r.__webglFramebuffer=t,r.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,r=0){w=e,x=t,_=r;let i=!0,n=null,a=!1,s=!1;if(e){let o=J.get(e);void 0!==o.__useDefaultFramebuffer?(Z.bindFramebuffer(ye.FRAMEBUFFER,null),i=!1):void 0===o.__webglFramebuffer?Q.setupRenderTarget(e):o.__hasExternalTextures&&Q.rebindTextures(e,J.get(e.texture).__webglTexture,J.get(e.depthTexture).__webglTexture);let l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(s=!0);let h=J.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(n=Array.isArray(h[t])?h[t][r]:h[t],a=!0):n=$.isWebGL2&&e.samples>0&&!1===Q.useMultisampledRTT(e)?J.get(e).__webglMultisampledFramebuffer:Array.isArray(h)?h[r]:h,M.copy(e.viewport),E.copy(e.scissor),A=e.scissorTest}else M.copy(k).multiplyScalar(O).floor(),E.copy(N).multiplyScalar(O).floor(),A=U;if(Z.bindFramebuffer(ye.FRAMEBUFFER,n)&&$.drawBuffers&&i&&Z.drawBuffers(e,n),Z.viewport(M),Z.scissor(E),Z.setScissorTest(A),a){let i=J.get(e.texture);ye.framebufferTexture2D(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,ye.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.__webglTexture,r)}else if(s){let i=J.get(e.texture),n=t||0;ye.framebufferTextureLayer(ye.FRAMEBUFFER,ye.COLOR_ATTACHMENT0,i.__webglTexture,r||0,n)}S=-1},this.readRenderTargetPixels=function(e,t,r,i,n,a,s){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=J.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(o=o[s]),o){Z.bindFramebuffer(ye.FRAMEBUFFER,o);try{let s=e.texture,o=s.format,l=s.type;if(o!==gs&&me.convert(o)!==ye.getParameter(ye.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");let h=l===Cn&&(Y.has("EXT_color_buffer_half_float")||$.isWebGL2&&Y.has("EXT_color_buffer_float"));if(!(l===wl||me.convert(l)===ye.getParameter(ye.IMPLEMENTATION_COLOR_READ_TYPE)||l===Us&&($.isWebGL2||Y.has("OES_texture_float")||Y.has("WEBGL_color_buffer_float"))||h))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&r>=0&&r<=e.height-n&&ye.readPixels(t,r,i,n,me.convert(o),me.convert(l),a)}finally{let e=null!==w?J.get(w).__webglFramebuffer:null;Z.bindFramebuffer(ye.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,r=0){let i=Math.pow(2,-r),n=Math.floor(t.image.width*i),a=Math.floor(t.image.height*i);Q.setTexture2D(t,0),ye.copyTexSubImage2D(ye.TEXTURE_2D,r,0,0,e.x,e.y,n,a),Z.unbindTexture()},this.copyTextureToTexture=function(e,t,r,i=0){let n=t.image.width,a=t.image.height,s=me.convert(r.format),o=me.convert(r.type);Q.setTexture2D(r,0),ye.pixelStorei(ye.UNPACK_FLIP_Y_WEBGL,r.flipY),ye.pixelStorei(ye.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),ye.pixelStorei(ye.UNPACK_ALIGNMENT,r.unpackAlignment),t.isDataTexture?ye.texSubImage2D(ye.TEXTURE_2D,i,e.x,e.y,n,a,s,o,t.image.data):t.isCompressedTexture?ye.compressedTexSubImage2D(ye.TEXTURE_2D,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,s,t.mipmaps[0].data):ye.texSubImage2D(ye.TEXTURE_2D,i,e.x,e.y,s,o,t.image),0===i&&r.generateMipmaps&&ye.generateMipmap(ye.TEXTURE_2D),Z.unbindTexture()},this.copyTextureToTexture3D=function(e,t,r,i,n=0){if(y.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");let a,s=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,l=e.max.z-e.min.z+1,h=me.convert(i.format),c=me.convert(i.type);if(i.isData3DTexture)Q.setTexture3D(i,0),a=ye.TEXTURE_3D;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Q.setTexture2DArray(i,0),a=ye.TEXTURE_2D_ARRAY}ye.pixelStorei(ye.UNPACK_FLIP_Y_WEBGL,i.flipY),ye.pixelStorei(ye.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),ye.pixelStorei(ye.UNPACK_ALIGNMENT,i.unpackAlignment);let u=ye.getParameter(ye.UNPACK_ROW_LENGTH),d=ye.getParameter(ye.UNPACK_IMAGE_HEIGHT),p=ye.getParameter(ye.UNPACK_SKIP_PIXELS),f=ye.getParameter(ye.UNPACK_SKIP_ROWS),m=ye.getParameter(ye.UNPACK_SKIP_IMAGES),g=r.isCompressedTexture?r.mipmaps[0]:r.image;ye.pixelStorei(ye.UNPACK_ROW_LENGTH,g.width),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,g.height),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,e.min.x),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,e.min.y),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,e.min.z),r.isDataTexture||r.isData3DTexture?ye.texSubImage3D(a,n,t.x,t.y,t.z,s,o,l,h,c,g.data):r.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ye.compressedTexSubImage3D(a,n,t.x,t.y,t.z,s,o,l,h,g.data)):ye.texSubImage3D(a,n,t.x,t.y,t.z,s,o,l,h,c,g),ye.pixelStorei(ye.UNPACK_ROW_LENGTH,u),ye.pixelStorei(ye.UNPACK_IMAGE_HEIGHT,d),ye.pixelStorei(ye.UNPACK_SKIP_PIXELS,p),ye.pixelStorei(ye.UNPACK_SKIP_ROWS,f),ye.pixelStorei(ye.UNPACK_SKIP_IMAGES,m),0===n&&i.generateMipmaps&&ye.generateMipmap(a),Z.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?Q.setTextureCube(e,0):e.isData3DTexture?Q.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?Q.setTexture2DArray(e,0):Q.setTexture2D(e,0),Z.unbindTexture()},this.resetState=function(){x=0,_=0,w=null,Z.reset(),ge.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return cu}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;let t=this.getContext();t.drawingBufferColorSpace=e===X2?"display-p3":"srgb",t.unpackColorSpace=vi.workingColorSpace===W_?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Zr?ph:Z4}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===ph?Zr:Hi}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}},b2=class extends Ka{};b2.prototype.isWebGL1Renderer=!0;var Gy=class{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new dt(e),this.density=t}clone(){return new Gy(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}},vh=class{constructor(e,t=1,r=1e3){this.isFog=!0,this.name="",this.color=new dt(e),this.near=t,this.far=r}clone(){return new vh(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}},Xi=class extends yr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}},$d=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=E_,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=Sl()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}get updateRange(){return console.warn('THREE.InterleavedBuffer: "updateRange" is deprecated and removed in r169. Use "addUpdateRange()" instead.'),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let i=0,n=this.stride;i<n;i++)this.array[e+i]=t.array[r+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Sl()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Sl()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},xo=new F,Xo=class{constructor(e,t,r,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)xo.fromBufferAttribute(this,t),xo.applyMatrix4(e),this.setXYZ(t,xo.x,xo.y,xo.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)xo.fromBufferAttribute(this,t),xo.applyNormalMatrix(e),this.setXYZ(t,xo.x,xo.y,xo.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)xo.fromBufferAttribute(this,t),xo.transformDirection(e),this.setXYZ(t,xo.x,xo.y,xo.z);return this}setX(e,t){return this.normalized&&(t=On(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=On(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=On(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=On(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Wo(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Wo(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Wo(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Wo(t,this.array)),t}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=On(t,this.array),r=On(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=On(t,this.array),r=On(r,this.array),i=On(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this}setXYZW(e,t,r,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=On(t,this.array),r=On(r,this.array),i=On(i,this.array),n=On(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=n,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let r=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[r+t])}return new fr(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Xo(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let r=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[r+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},Bg=class extends qn{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new dt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}},Sy,QE=new F,My=new F,Ay=new F,Ry=new Te,e_=new Te,hve=new lt,NC=new F,t_=new F,UC=new F,gge=new Te,K5=new Te,vge=new Te,qy=class extends yr{constructor(e=new Bg){if(super(),this.isSprite=!0,this.type="Sprite",void 0===Sy){Sy=new Nt;let e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new $d(e,5);Sy.setIndex([0,1,2,0,2,3]),Sy.setAttribute("position",new Xo(t,3,0,!1)),Sy.setAttribute("uv",new Xo(t,2,3,!1))}this.geometry=Sy,this.material=e,this.center=new Te(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),My.setFromMatrixScale(this.matrixWorld),hve.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ay.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&My.multiplyScalar(-Ay.z);let r,i,n=this.material.rotation;0!==n&&(i=Math.cos(n),r=Math.sin(n));let a=this.center;HC(NC.set(-.5,-.5,0),Ay,a,My,r,i),HC(t_.set(.5,-.5,0),Ay,a,My,r,i),HC(UC.set(.5,.5,0),Ay,a,My,r,i),gge.set(0,0),K5.set(1,0),vge.set(1,1);let s=e.ray.intersectTriangle(NC,t_,UC,!1,QE);if(null===s&&(HC(t_.set(-.5,.5,0),Ay,a,My,r,i),K5.set(0,1),s=e.ray.intersectTriangle(NC,UC,t_,!1,QE),null===s))return;let o=e.ray.origin.distanceTo(QE);o<e.near||o>e.far||t.push({distance:o,point:QE.clone(),uv:yi.getInterpolation(QE,NC,t_,UC,gge,K5,vge,new Te),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}};function HC(e,t,r,i,n,a){Ry.subVectors(e,r).addScalar(.5).multiply(i),void 0!==n?(e_.x=a*Ry.x-n*Ry.y,e_.y=n*Ry.x+a*Ry.y):e_.copy(Ry),e.copy(t),e.x+=e_.x,e.y+=e_.y,e.applyMatrix4(hve)}var VC=new F,yge=new F,x2=class extends yr{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);let t=e.levels;for(let e=0,r=t.length;e<r;e++){let r=t[e];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,r=0){t=Math.abs(t);let i,n=this.levels;for(i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,hysteresis:r,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){let t=this.levels;if(t.length>0){let r,i;for(r=1,i=t.length;r<i;r++){let i=t[r].distance;if(t[r].object.visible&&(i-=i*t[r].hysteresis),e<i)break}return t[r-1].object}return null}raycast(e,t){if(this.levels.length>0){VC.setFromMatrixPosition(this.matrixWorld);let r=e.ray.origin.distanceTo(VC);this.getObjectForDistance(r).raycast(e,t)}}update(e){let t=this.levels;if(t.length>1){VC.setFromMatrixPosition(e.matrixWorld),yge.setFromMatrixPosition(this.matrixWorld);let r,i,n=VC.distanceTo(yge)/e.zoom;for(t[0].object.visible=!0,r=1,i=t.length;r<i;r++){let e=t[r].distance;if(t[r].object.visible&&(e-=e*t[r].hysteresis),!(n>=e))break;t[r-1].object.visible=!1,t[r].object.visible=!0}for(this._currentLevel=r-1;r<i;r++)t[r].object.visible=!1}}toJSON(e){let t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];let r=this.levels;for(let e=0,i=r.length;e<i;e++){let i=r[e];t.object.levels.push({object:i.object.uuid,distance:i.distance,hysteresis:i.hysteresis})}return t}},bge=new F,xge=new Fn,Ege=new Fn,nyt=new F,_ge=new lt,zC=new F,J5=new Sn,Tge=new lt,Q5=new Za,yh=class extends Ht{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=g6,this.bindMatrix=new lt,this.bindMatrixInverse=new lt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){let e=this.geometry;null===this.boundingBox&&(this.boundingBox=new Vt),this.boundingBox.makeEmpty();let t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,zC),this.boundingBox.expandByPoint(zC)}computeBoundingSphere(){let e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Sn),this.boundingSphere.makeEmpty();let t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,zC),this.boundingSphere.expandByPoint(zC)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){let r=this.material,i=this.matrixWorld;void 0!==r&&(null===this.boundingSphere&&this.computeBoundingSphere(),J5.copy(this.boundingSphere),J5.applyMatrix4(i),!1!==e.ray.intersectsSphere(J5)&&(Tge.copy(i).invert(),Q5.copy(e.ray).applyMatrix4(Tge),(null===this.boundingBox||!1!==Q5.intersectsBox(this.boundingBox))&&this._computeIntersections(e,t,Q5)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let e=new Fn,t=this.geometry.attributes.skinWeight;for(let r=0,i=t.count;r<i;r++){e.fromBufferAttribute(t,r);let i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===g6?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===k0e?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){let r=this.skeleton,i=this.geometry;xge.fromBufferAttribute(i.attributes.skinIndex,e),Ege.fromBufferAttribute(i.attributes.skinWeight,e),bge.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){let i=Ege.getComponent(e);if(0!==i){let n=xge.getComponent(e);_ge.multiplyMatrices(r.bones[n].matrixWorld,r.boneInverses[n]),t.addScaledVector(nyt.copy(bge).applyMatrix4(_ge),i)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}},cc=class extends yr{constructor(){super(),this.isBone=!0,this.type="Bone"}},_o=class extends bi{constructor(e=null,t=1,r=1,i,n,a,s,o,l=ni,h=ni,c,u){super(null,a,s,o,l,h,i,n,c,u),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},wge=new lt,iyt=new lt,uc=class{constructor(e=[],t=[]){this.uuid=Sl(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new lt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let t=new lt;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){let e=this.bones,t=this.boneInverses,r=this.boneMatrices,i=this.boneTexture;for(let i=0,n=e.length;i<n;i++){let n=e[i]?e[i].matrixWorld:iyt;wge.multiplyMatrices(n,t[i]),wge.toArray(r,16*i)}null!==i&&(i.needsUpdate=!0)}clone(){return new uc(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let r=new _o(t,e,e,gs,Us);return r.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=r,this}getBoneByName(e){for(let t=0,r=this.bones.length;t<r;t++){let r=this.bones[t];if(r.name===e)return r}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let r=0,i=e.bones.length;r<i;r++){let i=e.bones[r],n=t[i];void 0===n&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),n=new cc),this.bones.push(n),this.boneInverses.push((new lt).fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){let e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,r=this.boneInverses;for(let i=0,n=t.length;i<n;i++){let n=t[i];e.bones.push(n.uuid);let a=r[i];e.boneInverses.push(a.toArray())}return e}},Ja=class extends fr{constructor(e,t,r,i=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},Cy=new lt,Sge=new lt,GC=[],Mge=new Vt,syt=new lt,r_=new Ht,n_=new Sn,ls=class extends Ht{constructor(e,t,r){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Ja(new Float32Array(16*r),16),this.instanceColor=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<r;e++)this.setMatrixAt(e,syt)}computeBoundingBox(){let e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new Vt),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,Cy),Mge.copy(e.boundingBox).applyMatrix4(Cy),this.boundingBox.union(Mge)}computeBoundingSphere(){let e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new Sn),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,Cy),n_.copy(e.boundingSphere).applyMatrix4(Cy),this.boundingSphere.union(n_)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){let r=this.matrixWorld,i=this.count;if(r_.geometry=this.geometry,r_.material=this.material,void 0!==r_.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),n_.copy(this.boundingSphere),n_.applyMatrix4(r),!1!==e.ray.intersectsSphere(n_)))for(let n=0;n<i;n++){this.getMatrixAt(n,Cy),Sge.multiplyMatrices(r,Cy),r_.matrixWorld=Sge,r_.raycast(e,GC);for(let e=0,r=GC.length;e<r;e++){let r=GC[e];r.instanceId=n,r.object=this,t.push(r)}GC.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Ja(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}};function ayt(e,t){return e.z-t.z}function oyt(e,t){return t.z-e.z}var i4=class{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t){let r=this.pool,i=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1});let n=r[this.index];i.push(n),this.index++,n.start=e.start,n.count=e.count,n.z=t}reset(){this.list.length=0,this.index=0}},Py="batchId",vp=new lt,Age=new lt,lyt=new lt,Rge=new lt,e6=new Ml,qC=new Vt,yg=new Sn,i_=new F,t6=new i4,$a=new Ht,jC=[];function cyt(e,t,r=0){let i=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){let n=e.count;for(let a=0;a<n;a++)for(let n=0;n<i;n++)t.setComponent(a+r,n,e.getComponent(a,n))}else t.array.set(e.array,r*i);t.needsUpdate=!0}var E2=class extends Ht{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,t,r=2*t,i){super(new Nt,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=t,this._maxIndexCount=r,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let e=Math.sqrt(4*this._maxGeometryCount);e=4*Math.ceil(e/4),e=Math.max(e,4);let t=new Float32Array(e*e*4),r=new _o(t,e,e,gs,Us);this._matricesTexture=r}_initializeGeometry(e){let t=this.geometry,r=this._maxVertexCount,i=this._maxGeometryCount,n=this._maxIndexCount;if(!1===this._geometryInitialized){for(let i in e.attributes){let n=e.getAttribute(i),{array:a,itemSize:s,normalized:o}=n,l=new a.constructor(r*s),h=new n.constructor(l,s,o);h.setUsage(n.usage),t.setAttribute(i,h)}if(null!==e.getIndex()){let e=r>65536?new Uint32Array(n):new Uint16Array(n);t.setIndex(new fr(e,1))}let a=i>65536?new Uint32Array(r):new Uint16Array(r);t.setAttribute(Py,new fr(a,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(Py))throw new Error(`BatchedMesh: Geometry cannot use attribute "${Py}"`);let t=this.geometry;if(Boolean(e.getIndex())!==Boolean(t.getIndex()))throw new Error('BatchedMesh: All geometries must consistently have "index".');for(let r in t.attributes){if(r===Py)continue;if(!e.hasAttribute(r))throw new Error(`BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);let i=e.getAttribute(r),n=t.getAttribute(r);if(i.itemSize!==n.itemSize||i.normalized!==n.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Vt);let e=this._geometryCount,t=this.boundingBox,r=this._active;t.makeEmpty();for(let i=0;i<e;i++)!1!==r[i]&&(this.getMatrixAt(i,vp),this.getBoundingBoxAt(i,qC).applyMatrix4(vp),t.union(qC))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Sn);let e=this._geometryCount,t=this.boundingSphere,r=this._active;t.makeEmpty();for(let i=0;i<e;i++)!1!==r[i]&&(this.getMatrixAt(i,vp),this.getBoundingSphereAt(i,yg).applyMatrix4(vp),t.union(yg))}addGeometry(e,t=-1,r=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");let i={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1},n=null,a=this._reservedRanges,s=this._drawRanges,o=this._bounds;0!==this._geometryCount&&(n=a[a.length-1]),i.vertexCount=-1===t?e.getAttribute("position").count:t,i.vertexStart=null===n?0:n.vertexStart+n.vertexCount;let l=e.getIndex(),h=null!==l;if(h&&(i.indexCount=-1===r?l.count:r,i.indexStart=null===n?0:n.indexStart+n.indexCount),-1!==i.indexStart&&i.indexStart+i.indexCount>this._maxIndexCount||i.vertexStart+i.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");let c=this._visibility,u=this._active,d=this._matricesTexture,p=this._matricesTexture.image.data;c.push(!0),u.push(!0);let f=this._geometryCount;this._geometryCount++,lyt.toArray(p,16*f),d.needsUpdate=!0,a.push(i),s.push({start:h?i.indexStart:i.vertexStart,count:-1}),o.push({boxInitialized:!1,box:new Vt,sphereInitialized:!1,sphere:new Sn});let m=this.geometry.getAttribute(Py);for(let e=0;e<i.vertexCount;e++)m.setX(i.vertexStart+e,f);return m.needsUpdate=!0,this.setGeometryAt(f,e),f}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);let r=this.geometry,i=null!==r.getIndex(),n=r.getIndex(),a=t.getIndex(),s=this._reservedRanges[e];if(i&&a.count>s.indexCount||t.attributes.position.count>s.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");let o=s.vertexStart,l=s.vertexCount;for(let e in r.attributes){if(e===Py)continue;let i=t.getAttribute(e),n=r.getAttribute(e);cyt(i,n,o);let a=i.itemSize;for(let e=i.count,t=l;e<t;e++){let t=o+e;for(let e=0;e<a;e++)n.setComponent(t,e,0)}n.needsUpdate=!0}if(i){let e=s.indexStart;for(let t=0;t<a.count;t++)n.setX(e+t,o+a.getX(t));for(let t=a.count,r=s.indexCount;t<r;t++)n.setX(e+t,o);n.needsUpdate=!0}let h=this._bounds[e];null!==t.boundingBox?(h.box.copy(t.boundingBox),h.boxInitialized=!0):h.boxInitialized=!1,null!==t.boundingSphere?(h.sphere.copy(t.boundingSphere),h.sphereInitialized=!0):h.sphereInitialized=!1;let c=this._drawRanges[e],u=t.getAttribute("position");return c.count=i?a.count:u.count,this._visibilityChanged=!0,e}deleteGeometry(e){let t=this._active;return e>=t.length||!1===t[e]||(t[e]=!1,this._visibilityChanged=!0),this}getBoundingBoxAt(e,t){if(!1===this._active[e])return this;let r=this._bounds[e],i=r.box,n=this.geometry;if(!1===r.boxInitialized){i.makeEmpty();let t=n.index,a=n.attributes.position,s=this._drawRanges[e];for(let e=s.start,r=s.start+s.count;e<r;e++){let r=e;t&&(r=t.getX(r)),i.expandByPoint(i_.fromBufferAttribute(a,r))}r.boxInitialized=!0}return t.copy(i),t}getBoundingSphereAt(e,t){if(!1===this._active[e])return this;let r=this._bounds[e],i=r.sphere,n=this.geometry;if(!1===r.sphereInitialized){i.makeEmpty(),this.getBoundingBoxAt(e,qC),qC.getCenter(i.center);let t=n.index,a=n.attributes.position,s=this._drawRanges[e],o=0;for(let e=s.start,r=s.start+s.count;e<r;e++){let r=e;t&&(r=t.getX(r)),i_.fromBufferAttribute(a,r),o=Math.max(o,i.center.distanceToSquared(i_))}i.radius=Math.sqrt(o),r.sphereInitialized=!0}return t.copy(i),t}setMatrixAt(e,t){let r=this._active,i=this._matricesTexture,n=this._matricesTexture.image.data;return e>=this._geometryCount||!1===r[e]||(t.toArray(n,16*e),i.needsUpdate=!0),this}getMatrixAt(e,t){let r=this._active,i=this._matricesTexture.image.data;return e>=this._geometryCount||!1===r[e]?null:t.fromArray(i,16*e)}setVisibleAt(e,t){let r=this._visibility,i=this._active;return e>=this._geometryCount||!1===i[e]||r[e]===t||(r[e]=t,this._visibilityChanged=!0),this}getVisibleAt(e){let t=this._visibility,r=this._active;return!(e>=this._geometryCount||!1===r[e])&&t[e]}raycast(e,t){let r=this._visibility,i=this._active,n=this._drawRanges,a=this._geometryCount,s=this.matrixWorld,o=this.geometry;$a.material=this.material,$a.geometry.index=o.index,$a.geometry.attributes=o.attributes,null===$a.geometry.boundingBox&&($a.geometry.boundingBox=new Vt),null===$a.geometry.boundingSphere&&($a.geometry.boundingSphere=new Sn);for(let o=0;o<a;o++){if(!r[o]||!i[o])continue;let a=n[o];$a.geometry.setDrawRange(a.start,a.count),this.getMatrixAt(o,$a.matrixWorld).premultiply(s),this.getBoundingBoxAt(o,$a.geometry.boundingBox),this.getBoundingSphereAt(o,$a.geometry.boundingSphere),$a.raycast(e,jC);for(let e=0,r=jC.length;e<r;e++){let r=jC[e];r.object=this,r.batchId=o,t.push(r)}jC.length=0}$a.material=null,$a.geometry.index=null,$a.geometry.attributes={},$a.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map((e=>on({},e))),this._reservedRanges=e._reservedRanges.map((e=>on({},e))),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map((e=>({boxInitialized:e.boxInitialized,box:e.box.clone(),sphereInitialized:e.sphereInitialized,sphere:e.sphere.clone()}))),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(e,t,r,i,n){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;let a=i.getIndex(),s=null===a?1:a.array.BYTES_PER_ELEMENT,o=this._visibility,l=this._multiDrawStarts,h=this._multiDrawCounts,c=this._drawRanges,u=this.perObjectFrustumCulled;u&&(Rge.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),e6.setFromProjectionMatrix(Rge,e.isWebGPURenderer?Uy:cu));let d=0;if(this.sortObjects){Age.copy(this.matrixWorld).invert(),i_.setFromMatrixPosition(r.matrixWorld).applyMatrix4(Age);for(let e=0,t=o.length;e<t;e++)if(o[e]){this.getMatrixAt(e,vp),this.getBoundingSphereAt(e,yg).applyMatrix4(vp);let t=!1;if(u&&(t=!e6.intersectsSphere(yg)),!t){let t=i_.distanceTo(yg.center);t6.push(c[e],t)}}let e=t6.list,t=this.customSort;null===t?e.sort(n.transparent?oyt:ayt):t.call(this,e,r);for(let t=0,r=e.length;t<r;t++){let r=e[t];l[d]=r.start*s,h[d]=r.count,d++}t6.reset()}else for(let e=0,t=o.length;e<t;e++)if(o[e]){let t=!1;if(u&&(this.getMatrixAt(e,vp),this.getBoundingSphereAt(e,yg).applyMatrix4(vp),t=!e6.intersectsSphere(yg)),!t){let t=c[e];l[d]=t.start*s,h[d]=t.count,d++}}this._multiDrawCount=d,this._visibilityChanged=!1}onBeforeShadow(e,t,r,i,n,a){this.onBeforeRender(e,null,i,n,a)}},Yr=class extends qn{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new dt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},Cge=new F,Pge=new F,Ige=new lt,r6=new Za,WC=new Sn,jn=class extends yr{constructor(e=new Nt,t=new Yr){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,r=[0];for(let e=1,i=t.count;e<i;e++)Cge.fromBufferAttribute(t,e-1),Pge.fromBufferAttribute(t,e),r[e]=r[e-1],r[e]+=Cge.distanceTo(Pge);e.setAttribute("lineDistance",new zt(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let r=this.geometry,i=this.matrixWorld,n=e.params.Line.threshold,a=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),WC.copy(r.boundingSphere),WC.applyMatrix4(i),WC.radius+=n,!1===e.ray.intersectsSphere(WC))return;Ige.copy(i).invert(),r6.copy(e.ray).applyMatrix4(Ige);let s=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=new F,h=new F,c=new F,u=new F,d=this.isLineSegments?2:1,p=r.index,f=r.attributes.position;if(null!==p){for(let r=Math.max(0,a.start),i=Math.min(p.count,a.start+a.count)-1;r<i;r+=d){let i=p.getX(r),n=p.getX(r+1);if(l.fromBufferAttribute(f,i),h.fromBufferAttribute(f,n),r6.distanceSqToSegment(l,h,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);let a=e.ray.origin.distanceTo(u);a<e.near||a>e.far||t.push({distance:a,point:c.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}else{for(let r=Math.max(0,a.start),i=Math.min(f.count,a.start+a.count)-1;r<i;r+=d){if(l.fromBufferAttribute(f,r),h.fromBufferAttribute(f,r+1),r6.distanceSqToSegment(l,h,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);let i=e.ray.origin.distanceTo(u);i<e.near||i>e.far||t.push({distance:i,point:c.clone().applyMatrix4(this.matrixWorld),index:r,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){let t=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}},Oge=new F,Dge=new F,Wn=class extends jn{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,r=[];for(let e=0,i=t.count;e<i;e+=2)Oge.fromBufferAttribute(t,e),Dge.fromBufferAttribute(t,e+1),r[e]=0===e?0:r[e-1],r[e+1]=r[e]+Oge.distanceTo(Dge);e.setAttribute("lineDistance",new zt(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},jy=class extends jn{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}},Ai=class extends qn{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new dt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}},Lge=new lt,s4=new Za,XC=new Sn,YC=new F,Di=class extends yr{constructor(e=new Nt,t=new Ai){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){let r=this.geometry,i=this.matrixWorld,n=e.params.Points.threshold,a=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),XC.copy(r.boundingSphere),XC.applyMatrix4(i),XC.radius+=n,!1===e.ray.intersectsSphere(XC))return;Lge.copy(i).invert(),s4.copy(e.ray).applyMatrix4(Lge);let s=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=r.index,h=r.attributes.position;if(null!==l){for(let r=Math.max(0,a.start),n=Math.min(l.count,a.start+a.count);r<n;r++){let n=l.getX(r);YC.fromBufferAttribute(h,n),kge(YC,n,o,i,e,t,this)}}else{for(let r=Math.max(0,a.start),n=Math.min(h.count,a.start+a.count);r<n;r++)YC.fromBufferAttribute(h,r),kge(YC,r,o,i,e,t,this)}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){let t=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}};function kge(e,t,r,i,n,a,s){let o=s4.distanceSqToPoint(e);if(o<r){let r=new F;s4.closestPointToPoint(e,r),r.applyMatrix4(i);let l=n.ray.origin.distanceTo(r);if(l<n.near||l>n.far)return;a.push({distance:l,distanceToRay:Math.sqrt(o),point:r,index:t,face:null,object:s})}}var a4=class extends bi{constructor(e,t,r,i,n,a,s,o,l){super(e,t,r,i,n,a,s,o,l),this.isVideoTexture=!0,this.minFilter=void 0!==a?a:wn,this.magFilter=void 0!==n?n:wn,this.generateMipmaps=!1;let h=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){h.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;"requestVideoFrameCallback"in e==!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},o4=class extends bi{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=ni,this.minFilter=ni,this.generateMipmaps=!1,this.needsUpdate=!0}},bh=class extends bi{constructor(e,t,r,i,n,a,s,o,l,h,c,u){super(null,a,s,o,l,h,i,n,c,u),this.isCompressedTexture=!0,this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}},l4=class extends bh{constructor(e,t,r,i,n,a){super(e,t,r,n,a),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=pi}},c4=class extends bh{constructor(e,t,r){super(void 0,e[0].width,e[0].height,t,r,qd),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}},Zd=class extends bi{constructor(e,t,r,i,n,a,s,o,l){super(e,t,r,i,n,a,s,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},To=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){let t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){let t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t,r=[],i=this.getPoint(0),n=0;r.push(0);for(let a=1;a<=e;a++)t=this.getPoint(a/e),n+=t.distanceTo(i),r.push(n),i=t;return this.cacheArcLengths=r,r}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let r,i=this.getLengths(),n=0,a=i.length;r=t||e*i[a-1];let s,o=0,l=a-1;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),s=i[n]-r,s<0)o=n+1;else{if(!(s>0)){l=n;break}l=n-1}if(n=l,i[n]===r)return n/(a-1);let h=i[n];return(n+(r-h)/(i[n+1]-h))/(a-1)}getTangent(e,t){let r=e-1e-4,i=e+1e-4;r<0&&(r=0),i>1&&(i=1);let n=this.getPoint(r),a=this.getPoint(i),s=t||(n.isVector2?new Te:new F);return s.copy(a).sub(n).normalize(),s}getTangentAt(e,t){let r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t){let r=new F,i=[],n=[],a=[],s=new F,o=new lt;for(let t=0;t<=e;t++){let r=t/e;i[t]=this.getTangentAt(r,new F)}n[0]=new F,a[0]=new F;let l=Number.MAX_VALUE,h=Math.abs(i[0].x),c=Math.abs(i[0].y),u=Math.abs(i[0].z);h<=l&&(l=h,r.set(1,0,0)),c<=l&&(l=c,r.set(0,1,0)),u<=l&&r.set(0,0,1),s.crossVectors(i[0],r).normalize(),n[0].crossVectors(i[0],s),a[0].crossVectors(i[0],n[0]);for(let t=1;t<=e;t++){if(n[t]=n[t-1].clone(),a[t]=a[t-1].clone(),s.crossVectors(i[t-1],i[t]),s.length()>Number.EPSILON){s.normalize();let e=Math.acos(Os(i[t-1].dot(i[t]),-1,1));n[t].applyMatrix4(o.makeRotationAxis(s,e))}a[t].crossVectors(i[t],n[t])}if(!0===t){let t=Math.acos(Os(n[0].dot(n[e]),-1,1));t/=e,i[0].dot(s.crossVectors(n[0],n[e]))>0&&(t=-t);for(let r=1;r<=e;r++)n[r].applyMatrix4(o.makeRotationAxis(i[r],t*r)),a[r].crossVectors(i[r],n[r])}return{tangents:i,normals:n,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},Kd=class extends To{constructor(e=0,t=0,r=1,i=1,n=0,a=2*Math.PI,s=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=a,this.aClockwise=s,this.aRotation=o}getPoint(e,t){let r=t||new Te,i=2*Math.PI,n=this.aEndAngle-this.aStartAngle,a=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=i;for(;n>i;)n-=i;n<Number.EPSILON&&(n=a?0:i),!0===this.aClockwise&&!a&&(n===i?n=-i:n-=i);let s=this.aStartAngle+e*n,o=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){let e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),r=o-this.aX,i=l-this.aY;o=r*e-i*t+this.aX,l=r*t+i*e+this.aY}return r.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},Ng=class extends Kd{constructor(e,t,r,i,n,a){super(e,t,r,r,i,n,a),this.isArcCurve=!0,this.type="ArcCurve"}};function eV(){let e=0,t=0,r=0,i=0;function n(n,a,s,o){e=n,t=s,r=-3*n+3*a-2*s-o,i=2*n-2*a+s+o}return{initCatmullRom:function(e,t,r,i,a){n(t,r,a*(r-e),a*(i-t))},initNonuniformCatmullRom:function(e,t,r,i,a,s,o){let l=(t-e)/a-(r-e)/(a+s)+(r-t)/s,h=(r-t)/s-(i-t)/(s+o)+(i-r)/o;l*=s,h*=s,n(t,r,l,h)},calc:function(n){let a=n*n;return e+t*n+r*a+i*(a*n)}}}var $C=new F,n6=new eV,i6=new eV,s6=new eV,_2=class extends To{constructor(e=[],t=!1,r="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=i}getPoint(e,t=new F){let r,i,n=t,a=this.points,s=a.length,o=(s-(this.closed?0:1))*e,l=Math.floor(o),h=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/s)+1)*s:0===h&&l===s-1&&(l=s-2,h=1),this.closed||l>0?r=a[(l-1)%s]:($C.subVectors(a[0],a[1]).add(a[0]),r=$C);let c=a[l%s],u=a[(l+1)%s];if(this.closed||l+2<s?i=a[(l+2)%s]:($C.subVectors(a[s-1],a[s-2]).add(a[s-1]),i=$C),"centripetal"===this.curveType||"chordal"===this.curveType){let e="chordal"===this.curveType?.5:.25,t=Math.pow(r.distanceToSquared(c),e),n=Math.pow(c.distanceToSquared(u),e),a=Math.pow(u.distanceToSquared(i),e);n<1e-4&&(n=1),t<1e-4&&(t=n),a<1e-4&&(a=n),n6.initNonuniformCatmullRom(r.x,c.x,u.x,i.x,t,n,a),i6.initNonuniformCatmullRom(r.y,c.y,u.y,i.y,t,n,a),s6.initNonuniformCatmullRom(r.z,c.z,u.z,i.z,t,n,a)}else"catmullrom"===this.curveType&&(n6.initCatmullRom(r.x,c.x,u.x,i.x,this.tension),i6.initCatmullRom(r.y,c.y,u.y,i.y,this.tension),s6.initCatmullRom(r.z,c.z,u.z,i.z,this.tension));return n.set(n6.calc(h),i6.calc(h),s6.calc(h)),n}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){let r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){let r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){let r=e.points[t];this.points.push((new F).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};function Fge(e,t,r,i,n){let a=.5*(i-t),s=.5*(n-r),o=e*e;return(2*r-2*i+a+s)*(e*o)+(-3*r+3*i-2*a-s)*o+a*e+r}function uyt(e,t){let r=1-e;return r*r*t}function hyt(e,t){return 2*(1-e)*e*t}function dyt(e,t){return e*e*t}function h_(e,t,r,i){return uyt(e,t)+hyt(e,r)+dyt(e,i)}function fyt(e,t){let r=1-e;return r*r*r*t}function pyt(e,t){let r=1-e;return 3*r*r*e*t}function myt(e,t){return 3*(1-e)*e*e*t}function gyt(e,t){return e*e*e*t}function d_(e,t,r,i,n){return fyt(e,t)+pyt(e,r)+myt(e,i)+gyt(e,n)}var R_=class extends To{constructor(e=new Te,t=new Te,r=new Te,i=new Te){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new Te){let r=t,i=this.v0,n=this.v1,a=this.v2,s=this.v3;return r.set(d_(e,i.x,n.x,a.x,s.x),d_(e,i.y,n.y,a.y,s.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},T2=class extends To{constructor(e=new F,t=new F,r=new F,i=new F){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new F){let r=t,i=this.v0,n=this.v1,a=this.v2,s=this.v3;return r.set(d_(e,i.x,n.x,a.x,s.x),d_(e,i.y,n.y,a.y,s.y),d_(e,i.z,n.z,a.z,s.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},C_=class extends To{constructor(e=new Te,t=new Te){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Te){let r=t;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Te){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},w2=class extends To{constructor(e=new F,t=new F){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new F){let r=t;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new F){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},P_=class extends To{constructor(e=new Te,t=new Te,r=new Te){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new Te){let r=t,i=this.v0,n=this.v1,a=this.v2;return r.set(h_(e,i.x,n.x,a.x),h_(e,i.y,n.y,a.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},I_=class extends To{constructor(e=new F,t=new F,r=new F){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new F){let r=t,i=this.v0,n=this.v1,a=this.v2;return r.set(h_(e,i.x,n.x,a.x),h_(e,i.y,n.y,a.y),h_(e,i.z,n.z,a.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Ug=class extends To{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Te){let r=t,i=this.points,n=(i.length-1)*e,a=Math.floor(n),s=n-a,o=i[0===a?a:a-1],l=i[a],h=i[a>i.length-2?i.length-1:a+1],c=i[a>i.length-3?i.length-1:a+2];return r.set(Fge(s,o.x,l.x,h.x,c.x),Fge(s,o.y,l.y,h.y,c.y)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){let r=e.points[t];this.points.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){let r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){let r=e.points[t];this.points.push((new Te).fromArray(r))}return this}},S2=Object.freeze({__proto__:null,ArcCurve:Ng,CatmullRomCurve3:_2,CubicBezierCurve:R_,CubicBezierCurve3:T2,EllipseCurve:Kd,LineCurve:C_,LineCurve3:w2,QuadraticBezierCurve:P_,QuadraticBezierCurve3:I_,SplineCurve:Ug}),M2=class extends To{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){let r=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new S2[r](t,e))}return this}getPoint(e,t){let r=e*this.getLength(),i=this.getCurveLengths(),n=0;for(;n<i.length;){if(i[n]>=r){let e=i[n]-r,a=this.curves[n],s=a.getLength(),o=0===s?0:1-e/s;return a.getPointAt(o,t)}n++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let r=0,i=this.curves.length;r<i;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t,r=[];for(let i=0,n=this.curves;i<n.length;i++){let a=n[i],s=a.isEllipseCurve?2*e:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,o=a.getPoints(s);for(let e=0;e<o.length;e++){let i=o[e];t&&t.equals(i)||(r.push(i),t=i)}}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r}copy(e){super.copy(e),this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){let r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,r=this.curves.length;t<r;t++){let r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){let r=e.curves[t];this.curves.push((new S2[r.type]).fromJSON(r))}return this}},xh=class extends M2{constructor(e){super(),this.type="Path",this.currentPoint=new Te,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let r=new C_(this.currentPoint.clone(),new Te(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,i){let n=new P_(this.currentPoint.clone(),new Te(e,t),new Te(r,i));return this.curves.push(n),this.currentPoint.set(r,i),this}bezierCurveTo(e,t,r,i,n,a){let s=new R_(this.currentPoint.clone(),new Te(e,t),new Te(r,i),new Te(n,a));return this.curves.push(s),this.currentPoint.set(n,a),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),r=new Ug(t);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,i,n,a){let s=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+s,t+o,r,i,n,a),this}absarc(e,t,r,i,n,a){return this.absellipse(e,t,r,r,i,n,a),this}ellipse(e,t,r,i,n,a,s,o){let l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+l,t+h,r,i,n,a,s,o),this}absellipse(e,t,r,i,n,a,s,o){let l=new Kd(e,t,r,i,n,a,s,o);if(this.curves.length>0){let e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);let h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},Hg=class extends Nt{constructor(e=[new Te(0,-.5),new Te(.5,0),new Te(0,.5)],t=12,r=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},t=Math.floor(t),i=Os(i,0,2*Math.PI);let n=[],a=[],s=[],o=[],l=[],h=1/t,c=new F,u=new Te,d=new F,p=new F,f=new F,m=0,g=0;for(let t=0;t<=e.length-1;t++)switch(t){case 0:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,d.x=1*g,d.y=-m,d.z=0*g,f.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(f.x,f.y,f.z);break;default:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,d.x=1*g,d.y=-m,d.z=0*g,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),o.push(d.x,d.y,d.z),f.copy(p)}for(let n=0;n<=t;n++){let d=r+n*h*i,p=Math.sin(d),f=Math.cos(d);for(let r=0;r<=e.length-1;r++){c.x=e[r].x*p,c.y=e[r].y,c.z=e[r].x*f,a.push(c.x,c.y,c.z),u.x=n/t,u.y=r/(e.length-1),s.push(u.x,u.y);let i=o[3*r+0]*p,h=o[3*r+1],d=o[3*r+0]*f;l.push(i,h,d)}}for(let r=0;r<t;r++)for(let t=0;t<e.length-1;t++){let i=t+r*e.length,a=i,s=i+e.length,o=i+e.length+1,l=i+1;n.push(a,s,l),n.push(o,l,s)}this.setIndex(n),this.setAttribute("position",new zt(a,3)),this.setAttribute("uv",new zt(s,2)),this.setAttribute("normal",new zt(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Hg(e.points,e.segments,e.phiStart,e.phiLength)}},Wy=class extends Hg{constructor(e=1,t=1,r=4,i=8){let n=new xh;n.absarc(0,-t/2,e,1.5*Math.PI,0),n.absarc(0,t/2,e,0,.5*Math.PI),super(n.getPoints(r),i),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:r,radialSegments:i}}static fromJSON(e){return new Wy(e.radius,e.length,e.capSegments,e.radialSegments)}},Xy=class extends Nt{constructor(e=1,t=32,r=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},t=Math.max(3,t);let n=[],a=[],s=[],o=[],l=new F,h=new Te;a.push(0,0,0),s.push(0,0,1),o.push(.5,.5);for(let n=0,c=3;n<=t;n++,c+=3){let u=r+n/t*i;l.x=e*Math.cos(u),l.y=e*Math.sin(u),a.push(l.x,l.y,l.z),s.push(0,0,1),h.x=(a[c]/e+1)/2,h.y=(a[c+1]/e+1)/2,o.push(h.x,h.y)}for(let e=1;e<=t;e++)n.push(e,e+1,0);this.setIndex(n),this.setAttribute("position",new zt(a,3)),this.setAttribute("normal",new zt(s,3)),this.setAttribute("uv",new zt(o,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xy(e.radius,e.segments,e.thetaStart,e.thetaLength)}},gu=class extends Nt{constructor(e=1,t=1,r=1,i=32,n=1,a=!1,s=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:n,openEnded:a,thetaStart:s,thetaLength:o};let l=this;i=Math.floor(i),n=Math.floor(n);let h=[],c=[],u=[],d=[],p=0,f=[],m=r/2,g=0;function v(r){let n=p,a=new Te,f=new F,v=0,y=!0===r?e:t,b=!0===r?1:-1;for(let e=1;e<=i;e++)c.push(0,m*b,0),u.push(0,b,0),d.push(.5,.5),p++;let x=p;for(let e=0;e<=i;e++){let t=e/i*o+s,r=Math.cos(t),n=Math.sin(t);f.x=y*n,f.y=m*b,f.z=y*r,c.push(f.x,f.y,f.z),u.push(0,b,0),a.x=.5*r+.5,a.y=.5*n*b+.5,d.push(a.x,a.y),p++}for(let e=0;e<i;e++){let t=n+e,i=x+e;!0===r?h.push(i,i+1,t):h.push(i+1,i,t),v+=3}l.addGroup(g,v,!0===r?1:2),g+=v}(function(){let a=new F,v=new F,y=0,b=(t-e)/r;for(let l=0;l<=n;l++){let h=[],g=l/n,y=g*(t-e)+e;for(let e=0;e<=i;e++){let t=e/i,n=t*o+s,l=Math.sin(n),f=Math.cos(n);v.x=y*l,v.y=-g*r+m,v.z=y*f,c.push(v.x,v.y,v.z),a.set(l,b,f).normalize(),u.push(a.x,a.y,a.z),d.push(t,1-g),h.push(p++)}f.push(h)}for(let e=0;e<i;e++)for(let t=0;t<n;t++){let r=f[t][e],i=f[t+1][e],n=f[t+1][e+1],a=f[t][e+1];h.push(r,i,a),h.push(i,n,a),y+=6}l.addGroup(g,y,0),g+=y})(),!1===a&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(h),this.setAttribute("position",new zt(c,3)),this.setAttribute("normal",new zt(u,3)),this.setAttribute("uv",new zt(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new gu(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},Yy=class extends gu{constructor(e=1,t=1,r=32,i=1,n=!1,a=0,s=2*Math.PI){super(0,e,t,r,i,n,a,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:n,thetaStart:a,thetaLength:s}}static fromJSON(e){return new Yy(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},Eh=class extends Nt{constructor(e=[],t=[],r=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i};let n=[],a=[];function s(e,t,r,i){let n=i+1,a=[];for(let i=0;i<=n;i++){a[i]=[];let s=e.clone().lerp(r,i/n),o=t.clone().lerp(r,i/n),l=n-i;for(let e=0;e<=l;e++)a[i][e]=0===e&&i===n?s:s.clone().lerp(o,e/l)}for(let e=0;e<n;e++)for(let t=0;t<2*(n-e)-1;t++){let r=Math.floor(t/2);t%2==0?(o(a[e][r+1]),o(a[e+1][r]),o(a[e][r])):(o(a[e][r+1]),o(a[e+1][r+1]),o(a[e+1][r]))}}function o(e){n.push(e.x,e.y,e.z)}function l(t,r){let i=3*t;r.x=e[i+0],r.y=e[i+1],r.z=e[i+2]}function h(e,t,r,i){i<0&&1===e.x&&(a[t]=e.x-1),0===r.x&&0===r.z&&(a[t]=i/2/Math.PI+.5)}function c(e){return Math.atan2(e.z,-e.x)}function u(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(function(e){let r=new F,i=new F,n=new F;for(let a=0;a<t.length;a+=3)l(t[a+0],r),l(t[a+1],i),l(t[a+2],n),s(r,i,n,e)})(i),function(e){let t=new F;for(let r=0;r<n.length;r+=3)t.x=n[r+0],t.y=n[r+1],t.z=n[r+2],t.normalize().multiplyScalar(e),n[r+0]=t.x,n[r+1]=t.y,n[r+2]=t.z}(r),function(){let e=new F;for(let t=0;t<n.length;t+=3){e.x=n[t+0],e.y=n[t+1],e.z=n[t+2];let r=c(e)/2/Math.PI+.5,i=u(e)/Math.PI+.5;a.push(r,1-i)}(function(){let e=new F,t=new F,r=new F,i=new F,s=new Te,o=new Te,l=new Te;for(let u=0,d=0;u<n.length;u+=9,d+=6){e.set(n[u+0],n[u+1],n[u+2]),t.set(n[u+3],n[u+4],n[u+5]),r.set(n[u+6],n[u+7],n[u+8]),s.set(a[d+0],a[d+1]),o.set(a[d+2],a[d+3]),l.set(a[d+4],a[d+5]),i.copy(e).add(t).add(r).divideScalar(3);let p=c(i);h(s,d+0,e,p),h(o,d+2,t,p),h(l,d+4,r,p)}})(),function(){for(let e=0;e<a.length;e+=6){let t=a[e+0],r=a[e+2],i=a[e+4],n=Math.max(t,r,i),s=Math.min(t,r,i);n>.9&&s<.1&&(t<.2&&(a[e+0]+=1),r<.2&&(a[e+2]+=1),i<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new zt(n,3)),this.setAttribute("normal",new zt(n.slice(),3)),this.setAttribute("uv",new zt(a,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Eh(e.vertices,e.indices,e.radius,e.details)}},$y=class extends Eh{constructor(e=1,t=0){let r=(1+Math.sqrt(5))/2,i=1/r;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new $y(e.radius,e.detail)}},ZC=new F,KC=new F,a6=new F,JC=new yi,_h=class extends Nt{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){let r=Math.pow(10,4),i=Math.cos(Ig*t),n=e.getIndex(),a=e.getAttribute("position"),s=n?n.count:a.count,o=[0,0,0],l=["a","b","c"],h=new Array(3),c={},u=[];for(let e=0;e<s;e+=3){n?(o[0]=n.getX(e),o[1]=n.getX(e+1),o[2]=n.getX(e+2)):(o[0]=e,o[1]=e+1,o[2]=e+2);let{a:t,b:s,c:d}=JC;if(t.fromBufferAttribute(a,o[0]),s.fromBufferAttribute(a,o[1]),d.fromBufferAttribute(a,o[2]),JC.getNormal(a6),h[0]=`${Math.round(t.x*r)},${Math.round(t.y*r)},${Math.round(t.z*r)}`,h[1]=`${Math.round(s.x*r)},${Math.round(s.y*r)},${Math.round(s.z*r)}`,h[2]=`${Math.round(d.x*r)},${Math.round(d.y*r)},${Math.round(d.z*r)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let e=0;e<3;e++){let t=(e+1)%3,r=h[e],n=h[t],a=JC[l[e]],s=JC[l[t]],d=`${r}_${n}`,p=`${n}_${r}`;p in c&&c[p]?(a6.dot(c[p].normal)<=i&&(u.push(a.x,a.y,a.z),u.push(s.x,s.y,s.z)),c[p]=null):d in c||(c[d]={index0:o[e],index1:o[t],normal:a6.clone()})}}for(let e in c)if(c[e]){let{index0:t,index1:r}=c[e];ZC.fromBufferAttribute(a,t),KC.fromBufferAttribute(a,r),u.push(ZC.x,ZC.y,ZC.z),u.push(KC.x,KC.y,KC.z)}this.setAttribute("position",new zt(u,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}},Ys=class extends xh{constructor(e){super(e),this.uuid=Sl(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let r=0,i=this.holes.length;r<i;r++)t[r]=this.holes[r].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){let r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,r=this.holes.length;t<r;t++){let r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){let r=e.holes[t];this.holes.push((new xh).fromJSON(r))}return this}},vyt={triangulate:function(e,t,r=2){let i,n,a,s,o,l,h,c=t&&t.length,u=c?t[0]*r:e.length,d=dve(e,0,u,r,!0),p=[];if(!d||d.next===d.prev)return p;if(c&&(d=_yt(e,t,d,r)),e.length>80*r){i=a=e[0],n=s=e[1];for(let t=r;t<u;t+=r)o=e[t],l=e[t+1],o<i&&(i=o),l<n&&(n=l),o>a&&(a=o),l>s&&(s=l);h=Math.max(a-i,s-n),h=0!==h?32767/h:0}return O_(d,p,r,i,n,h,0),p}};function dve(e,t,r,i,n){let a,s;if(n===Dyt(e,t,r,i)>0)for(a=t;a<r;a+=i)s=Bge(a,e[a],e[a+1],s);else for(a=r-i;a>=t;a-=i)s=Bge(a,e[a],e[a+1],s);return s&&$2(s,s.next)&&(L_(s),s=s.next),s}function Vg(e,t){if(!e)return e;t||(t=e);let r,i=e;do{if(r=!1,i.steiner||!$2(i,i.next)&&0!==Ts(i.prev,i,i.next))i=i.next;else{if(L_(i),i=t=i.prev,i===i.next)break;r=!0}}while(r||i!==t);return t}function O_(e,t,r,i,n,a,s){if(!e)return;!s&&a&&Ayt(e,i,n,a);let o,l,h=e;for(;e.prev!==e.next;)if(o=e.prev,l=e.next,a?byt(e,i,n,a):yyt(e))t.push(o.i/r|0),t.push(e.i/r|0),t.push(l.i/r|0),L_(e),e=l.next,h=l.next;else if((e=l)===h){s?1===s?O_(e=xyt(Vg(e),t,r),t,r,i,n,a,2):2===s&&Eyt(e,t,r,i,n,a):O_(Vg(e),t,r,i,n,a,1);break}}function yyt(e){let t=e.prev,r=e,i=e.next;if(Ts(t,r,i)>=0)return!1;let n=t.x,a=r.x,s=i.x,o=t.y,l=r.y,h=i.y,c=n<a?n<s?n:s:a<s?a:s,u=o<l?o<h?o:h:l<h?l:h,d=n>a?n>s?n:s:a>s?a:s,p=o>l?o>h?o:h:l>h?l:h,f=i.next;for(;f!==t;){if(f.x>=c&&f.x<=d&&f.y>=u&&f.y<=p&&Dy(n,o,a,l,s,h,f.x,f.y)&&Ts(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function byt(e,t,r,i){let n=e.prev,a=e,s=e.next;if(Ts(n,a,s)>=0)return!1;let o=n.x,l=a.x,h=s.x,c=n.y,u=a.y,d=s.y,p=o<l?o<h?o:h:l<h?l:h,f=c<u?c<d?c:d:u<d?u:d,m=o>l?o>h?o:h:l>h?l:h,g=c>u?c>d?c:d:u>d?u:d,v=u4(p,f,t,r,i),y=u4(m,g,t,r,i),b=e.prevZ,x=e.nextZ;for(;b&&b.z>=v&&x&&x.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==n&&b!==s&&Dy(o,c,l,u,h,d,b.x,b.y)&&Ts(b.prev,b,b.next)>=0||(b=b.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==n&&x!==s&&Dy(o,c,l,u,h,d,x.x,x.y)&&Ts(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;b&&b.z>=v;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==n&&b!==s&&Dy(o,c,l,u,h,d,b.x,b.y)&&Ts(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==n&&x!==s&&Dy(o,c,l,u,h,d,x.x,x.y)&&Ts(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function xyt(e,t,r){let i=e;do{let n=i.prev,a=i.next.next;!$2(n,a)&&fve(n,i,i.next,a)&&D_(n,a)&&D_(a,n)&&(t.push(n.i/r|0),t.push(i.i/r|0),t.push(a.i/r|0),L_(i),L_(i.next),i=e=a),i=i.next}while(i!==e);return Vg(i)}function Eyt(e,t,r,i,n,a){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&Pyt(s,e)){let o=pve(s,e);return s=Vg(s,s.next),o=Vg(o,o.next),O_(s,t,r,i,n,a,0),void O_(o,t,r,i,n,a,0)}e=e.next}s=s.next}while(s!==e)}function _yt(e,t,r,i){let n,a,s,o,l,h=[];for(n=0,a=t.length;n<a;n++)s=t[n]*i,o=n<a-1?t[n+1]*i:e.length,l=dve(e,s,o,i,!1),l===l.next&&(l.steiner=!0),h.push(Cyt(l));for(h.sort(Tyt),n=0;n<h.length;n++)r=wyt(h[n],r);return r}function Tyt(e,t){return e.x-t.x}function wyt(e,t){let r=Syt(e,t);if(!r)return t;let i=pve(r,e);return Vg(i,i.next),Vg(r,r.next)}function Syt(e,t){let r,i=t,n=-1/0,a=e.x,s=e.y;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){let e=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=a&&e>n&&(n=e,r=i.x<i.next.x?i:i.next,e===a))return r}i=i.next}while(i!==t);if(!r)return null;let o,l=r,h=r.x,c=r.y,u=1/0;i=r;do{a>=i.x&&i.x>=h&&a!==i.x&&Dy(s<c?a:n,s,h,c,s<c?n:a,s,i.x,i.y)&&(o=Math.abs(s-i.y)/(a-i.x),D_(i,e)&&(o<u||o===u&&(i.x>r.x||i.x===r.x&&Myt(r,i)))&&(r=i,u=o)),i=i.next}while(i!==l);return r}function Myt(e,t){return Ts(e.prev,e,t.prev)<0&&Ts(t.next,e,e.next)<0}function Ayt(e,t,r,i){let n=e;do{0===n.z&&(n.z=u4(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,Ryt(n)}function Ryt(e){let t,r,i,n,a,s,o,l,h=1;do{for(r=e,e=null,a=null,s=0;r;){for(s++,i=r,o=0,t=0;t<h&&(o++,i=i.nextZ,i);t++);for(l=h;o>0||l>0&&i;)0!==o&&(0===l||!i||r.z<=i.z)?(n=r,r=r.nextZ,o--):(n=i,i=i.nextZ,l--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;r=i}a.nextZ=null,h*=2}while(s>1);return e}function u4(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Cyt(e){let t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function Dy(e,t,r,i,n,a,s,o){return(n-s)*(t-o)>=(e-s)*(a-o)&&(e-s)*(i-o)>=(r-s)*(t-o)&&(r-s)*(a-o)>=(n-s)*(i-o)}function Pyt(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!Iyt(e,t)&&(D_(e,t)&&D_(t,e)&&Oyt(e,t)&&(Ts(e.prev,e,t.prev)||Ts(e,t.prev,t))||$2(e,t)&&Ts(e.prev,e,e.next)>0&&Ts(t.prev,t,t.next)>0)}function Ts(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function $2(e,t){return e.x===t.x&&e.y===t.y}function fve(e,t,r,i){let n=e2(Ts(e,t,r)),a=e2(Ts(e,t,i)),s=e2(Ts(r,i,e)),o=e2(Ts(r,i,t));return!!(n!==a&&s!==o||0===n&&QC(e,r,t)||0===a&&QC(e,i,t)||0===s&&QC(r,e,i)||0===o&&QC(r,t,i))}function QC(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function e2(e){return e>0?1:e<0?-1:0}function Iyt(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&fve(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function D_(e,t){return Ts(e.prev,e,e.next)<0?Ts(e,t,e.next)>=0&&Ts(e,e.prev,t)>=0:Ts(e,t,e.prev)<0||Ts(e,e.next,t)<0}function Oyt(e,t){let r=e,i=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}function pve(e,t){let r=new h4(e.i,e.x,e.y),i=new h4(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}function Bge(e,t,r,i){let n=new h4(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function L_(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function h4(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Dyt(e,t,r,i){let n=0;for(let a=t,s=r-i;a<r;a+=i)n+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return n}var $s=class{static area(e){let t=e.length,r=0;for(let i=t-1,n=0;n<t;i=n++)r+=e[i].x*e[n].y-e[n].x*e[i].y;return.5*r}static isClockWise(e){return $s.area(e)<0}static triangulateShape(e,t){let r=[],i=[],n=[];Nge(e),Uge(r,e);let a=e.length;t.forEach(Nge);for(let e=0;e<t.length;e++)i.push(a),a+=t[e].length,Uge(r,t[e]);let s=vyt.triangulate(r,i);for(let e=0;e<s.length;e+=3)n.push(s.slice(e,e+3));return n}};function Nge(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Uge(e,t){for(let r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}var va=class extends Nt{constructor(e=new Ys([new Te(.5,.5),new Te(-.5,.5),new Te(-.5,-.5),new Te(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];let r=this,i=[],n=[];for(let t=0,r=e.length;t<r;t++){a(e[t])}function a(e){let a,s,o,l,h,c=[],u=void 0!==t.curveSegments?t.curveSegments:12,d=void 0!==t.steps?t.steps:1,p=void 0!==t.depth?t.depth:1,f=void 0===t.bevelEnabled||t.bevelEnabled,m=void 0!==t.bevelThickness?t.bevelThickness:.2,g=void 0!==t.bevelSize?t.bevelSize:m-.1,v=void 0!==t.bevelOffset?t.bevelOffset:0,y=void 0!==t.bevelSegments?t.bevelSegments:3,b=t.extrudePath,x=void 0!==t.UVGenerator?t.UVGenerator:Lyt,_=!1;b&&(a=b.getSpacedPoints(d),_=!0,f=!1,s=b.computeFrenetFrames(d,!1),o=new F,l=new F,h=new F),f||(y=0,m=0,g=0,v=0);let w=e.extractPoints(u),S=w.shape,T=w.holes;if(!$s.isClockWise(S)){S=S.reverse();for(let e=0,t=T.length;e<t;e++){let t=T[e];$s.isClockWise(t)&&(T[e]=t.reverse())}}let M=$s.triangulateShape(S,T),E=S;for(let e=0,t=T.length;e<t;e++){let t=T[e];S=S.concat(t)}function A(e,t,r){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().addScaledVector(t,r)}let C=S.length,P=M.length;function R(e,t,r){let i,n,a,s=e.x-t.x,o=e.y-t.y,l=r.x-e.x,h=r.y-e.y,c=s*s+o*o,u=s*h-o*l;if(Math.abs(u)>Number.EPSILON){let u=Math.sqrt(c),d=Math.sqrt(l*l+h*h),p=t.x-o/u,f=t.y+s/u,m=((r.x-h/d-p)*h-(r.y+l/d-f)*l)/(s*h-o*l);i=p+s*m-e.x,n=f+o*m-e.y;let g=i*i+n*n;if(g<=2)return new Te(i,n);a=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?l>Number.EPSILON&&(e=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(h)&&(e=!0),e?(i=-o,n=s,a=Math.sqrt(c)):(i=s,n=o,a=Math.sqrt(c/2))}return new Te(i/a,n/a)}let I=[];for(let e=0,t=E.length,r=t-1,i=e+1;e<t;e++,r++,i++)r===t&&(r=0),i===t&&(i=0),I[e]=R(E[e],E[r],E[i]);let O,L=[],D=I.concat();for(let e=0,t=T.length;e<t;e++){let t=T[e];O=[];for(let e=0,r=t.length,i=r-1,n=e+1;e<r;e++,i++,n++)i===r&&(i=0),n===r&&(n=0),O[e]=R(t[e],t[i],t[n]);L.push(O),D=D.concat(O)}for(let e=0;e<y;e++){let t=e/y,r=m*Math.cos(t*Math.PI/2),i=g*Math.sin(t*Math.PI/2)+v;for(let e=0,t=E.length;e<t;e++){let t=A(E[e],I[e],i);U(t.x,t.y,-r)}for(let e=0,t=T.length;e<t;e++){let t=T[e];O=L[e];for(let e=0,n=t.length;e<n;e++){let n=A(t[e],O[e],i);U(n.x,n.y,-r)}}}let k=g+v;for(let e=0;e<C;e++){let t=f?A(S[e],D[e],k):S[e];_?(l.copy(s.normals[0]).multiplyScalar(t.x),o.copy(s.binormals[0]).multiplyScalar(t.y),h.copy(a[0]).add(l).add(o),U(h.x,h.y,h.z)):U(t.x,t.y,0)}for(let e=1;e<=d;e++)for(let t=0;t<C;t++){let r=f?A(S[t],D[t],k):S[t];_?(l.copy(s.normals[e]).multiplyScalar(r.x),o.copy(s.binormals[e]).multiplyScalar(r.y),h.copy(a[e]).add(l).add(o),U(h.x,h.y,h.z)):U(r.x,r.y,p/d*e)}for(let e=y-1;e>=0;e--){let t=e/y,r=m*Math.cos(t*Math.PI/2),i=g*Math.sin(t*Math.PI/2)+v;for(let e=0,t=E.length;e<t;e++){let t=A(E[e],I[e],i);U(t.x,t.y,p+r)}for(let e=0,t=T.length;e<t;e++){let t=T[e];O=L[e];for(let e=0,n=t.length;e<n;e++){let n=A(t[e],O[e],i);_?U(n.x,n.y+a[d-1].y,a[d-1].x+r):U(n.x,n.y,p+r)}}}function N(e,t){let r=e.length;for(;--r>=0;){let i=r,n=r-1;n<0&&(n=e.length-1);for(let e=0,r=d+2*y;e<r;e++){let r=C*e,a=C*(e+1);z(t+i+r,t+n+r,t+n+a,t+i+a)}}}function U(e,t,r){c.push(e),c.push(t),c.push(r)}function B(e,t,n){H(e),H(t),H(n);let a=i.length/3,s=x.generateTopUV(r,i,a-3,a-2,a-1);V(s[0]),V(s[1]),V(s[2])}function z(e,t,n,a){H(e),H(t),H(a),H(t),H(n),H(a);let s=i.length/3,o=x.generateSideWallUV(r,i,s-6,s-3,s-2,s-1);V(o[0]),V(o[1]),V(o[3]),V(o[1]),V(o[2]),V(o[3])}function H(e){i.push(c[3*e+0]),i.push(c[3*e+1]),i.push(c[3*e+2])}function V(e){n.push(e.x),n.push(e.y)}(function(){let e=i.length/3;if(f){let e=0,t=C*e;for(let e=0;e<P;e++){let r=M[e];B(r[2]+t,r[1]+t,r[0]+t)}e=d+2*y,t=C*e;for(let e=0;e<P;e++){let r=M[e];B(r[0]+t,r[1]+t,r[2]+t)}}else{for(let e=0;e<P;e++){let t=M[e];B(t[2],t[1],t[0])}for(let e=0;e<P;e++){let t=M[e];B(t[0]+C*d,t[1]+C*d,t[2]+C*d)}}r.addGroup(e,i.length/3-e,0)})(),function(){let e=i.length/3,t=0;N(E,t),t+=E.length;for(let e=0,r=T.length;e<r;e++){let r=T[e];N(r,t),t+=r.length}r.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new zt(i,3)),this.setAttribute("uv",new zt(n,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return kyt(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){let r=[];for(let i=0,n=e.shapes.length;i<n;i++){let n=t[e.shapes[i]];r.push(n)}let i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new S2[i.type]).fromJSON(i)),new va(r,e.options)}},Lyt={generateTopUV:function(e,t,r,i,n){let a=t[3*r],s=t[3*r+1],o=t[3*i],l=t[3*i+1],h=t[3*n],c=t[3*n+1];return[new Te(a,s),new Te(o,l),new Te(h,c)]},generateSideWallUV:function(e,t,r,i,n,a){let s=t[3*r],o=t[3*r+1],l=t[3*r+2],h=t[3*i],c=t[3*i+1],u=t[3*i+2],d=t[3*n],p=t[3*n+1],f=t[3*n+2],m=t[3*a],g=t[3*a+1],v=t[3*a+2];return Math.abs(o-c)<Math.abs(s-h)?[new Te(s,1-l),new Te(h,1-u),new Te(d,1-f),new Te(m,1-v)]:[new Te(o,1-l),new Te(c,1-u),new Te(p,1-f),new Te(g,1-v)]}};function kyt(e,t,r){if(r.shapes=[],Array.isArray(e))for(let t=0,i=e.length;t<i;t++){let i=e[t];r.shapes.push(i.uuid)}else r.shapes.push(e.uuid);return r.options=Object.assign({},t),void 0!==t.extrudePath&&(r.options.extrudePath=t.extrudePath.toJSON()),r}var Zy=class extends Eh{constructor(e=1,t=0){let r=(1+Math.sqrt(5))/2;super([-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Zy(e.radius,e.detail)}},zg=class extends Eh{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new zg(e.radius,e.detail)}},Ky=class extends Nt{constructor(e=.5,t=1,r=32,i=1,n=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:n,thetaLength:a},r=Math.max(3,r);let s=[],o=[],l=[],h=[],c=e,u=(t-e)/(i=Math.max(1,i)),d=new F,p=new Te;for(let e=0;e<=i;e++){for(let e=0;e<=r;e++){let i=n+e/r*a;d.x=c*Math.cos(i),d.y=c*Math.sin(i),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,h.push(p.x,p.y)}c+=u}for(let e=0;e<i;e++){let t=e*(r+1);for(let e=0;e<r;e++){let i=e+t,n=i,a=i+r+1,o=i+r+2,l=i+1;s.push(n,a,l),s.push(a,o,l)}}this.setIndex(s),this.setAttribute("position",new zt(o,3)),this.setAttribute("normal",new zt(l,3)),this.setAttribute("uv",new zt(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ky(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}},hc=class extends Nt{constructor(e=new Ys([new Te(0,.5),new Te(-.5,-.5),new Te(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};let r=[],i=[],n=[],a=[],s=0,o=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(s,o,t),s+=o,o=0;function l(e){let s=i.length/3,l=e.extractPoints(t),h=l.shape,c=l.holes;!1===$s.isClockWise(h)&&(h=h.reverse());for(let e=0,t=c.length;e<t;e++){let t=c[e];!0===$s.isClockWise(t)&&(c[e]=t.reverse())}let u=$s.triangulateShape(h,c);for(let e=0,t=c.length;e<t;e++){let t=c[e];h=h.concat(t)}for(let e=0,t=h.length;e<t;e++){let t=h[e];i.push(t.x,t.y,0),n.push(0,0,1),a.push(t.x,t.y)}for(let e=0,t=u.length;e<t;e++){let t=u[e],i=t[0]+s,n=t[1]+s,a=t[2]+s;r.push(i,n,a),o+=3}}this.setIndex(r),this.setAttribute("position",new zt(i,3)),this.setAttribute("normal",new zt(n,3)),this.setAttribute("uv",new zt(a,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return Fyt(this.parameters.shapes,e)}static fromJSON(e,t){let r=[];for(let i=0,n=e.shapes.length;i<n;i++){let n=t[e.shapes[i]];r.push(n)}return new hc(r,e.curveSegments)}};function Fyt(e,t){if(t.shapes=[],Array.isArray(e))for(let r=0,i=e.length;r<i;r++){let i=e[r];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}var Al=class extends Nt{constructor(e=1,t=32,r=16,i=0,n=2*Math.PI,a=0,s=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:n,thetaStart:a,thetaLength:s},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));let o=Math.min(a+s,Math.PI),l=0,h=[],c=new F,u=new F,d=[],p=[],f=[],m=[];for(let d=0;d<=r;d++){let g=[],v=d/r,y=0;0===d&&0===a?y=.5/t:d===r&&o===Math.PI&&(y=-.5/t);for(let r=0;r<=t;r++){let o=r/t;c.x=-e*Math.cos(i+o*n)*Math.sin(a+v*s),c.y=e*Math.cos(a+v*s),c.z=e*Math.sin(i+o*n)*Math.sin(a+v*s),p.push(c.x,c.y,c.z),u.copy(c).normalize(),f.push(u.x,u.y,u.z),m.push(o+y,1-v),g.push(l++)}h.push(g)}for(let e=0;e<r;e++)for(let i=0;i<t;i++){let t=h[e][i+1],n=h[e][i],s=h[e+1][i],l=h[e+1][i+1];(0!==e||a>0)&&d.push(t,n,l),(e!==r-1||o<Math.PI)&&d.push(n,s,l)}this.setIndex(d),this.setAttribute("position",new zt(p,3)),this.setAttribute("normal",new zt(f,3)),this.setAttribute("uv",new zt(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Al(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},Jy=class extends Eh{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Jy(e.radius,e.detail)}},_p=class extends Nt{constructor(e=1,t=.4,r=12,i=48,n=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:n},r=Math.floor(r),i=Math.floor(i);let a=[],s=[],o=[],l=[],h=new F,c=new F,u=new F;for(let a=0;a<=r;a++)for(let d=0;d<=i;d++){let p=d/i*n,f=a/r*Math.PI*2;c.x=(e+t*Math.cos(f))*Math.cos(p),c.y=(e+t*Math.cos(f))*Math.sin(p),c.z=t*Math.sin(f),s.push(c.x,c.y,c.z),h.x=e*Math.cos(p),h.y=e*Math.sin(p),u.subVectors(c,h).normalize(),o.push(u.x,u.y,u.z),l.push(d/i),l.push(a/r)}for(let e=1;e<=r;e++)for(let t=1;t<=i;t++){let r=(i+1)*e+t-1,n=(i+1)*(e-1)+t-1,s=(i+1)*(e-1)+t,o=(i+1)*e+t;a.push(r,n,o),a.push(n,s,o)}this.setIndex(a),this.setAttribute("position",new zt(s,3)),this.setAttribute("normal",new zt(o,3)),this.setAttribute("uv",new zt(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _p(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}},Qy=class extends Nt{constructor(e=1,t=.4,r=64,i=8,n=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:n,q:a},r=Math.floor(r),i=Math.floor(i);let s=[],o=[],l=[],h=[],c=new F,u=new F,d=new F,p=new F,f=new F,m=new F,g=new F;for(let s=0;s<=r;++s){let y=s/r*n*Math.PI*2;v(y,n,a,e,d),v(y+.01,n,a,e,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=i;++e){let n=e/i*Math.PI*2,a=-t*Math.cos(n),p=t*Math.sin(n);c.x=d.x+(a*g.x+p*f.x),c.y=d.y+(a*g.y+p*f.y),c.z=d.z+(a*g.z+p*f.z),o.push(c.x,c.y,c.z),u.subVectors(c,d).normalize(),l.push(u.x,u.y,u.z),h.push(s/r),h.push(e/i)}}for(let e=1;e<=r;e++)for(let t=1;t<=i;t++){let r=(i+1)*(e-1)+(t-1),n=(i+1)*e+(t-1),a=(i+1)*e+t,o=(i+1)*(e-1)+t;s.push(r,n,o),s.push(n,a,o)}function v(e,t,r,i,n){let a=Math.cos(e),s=Math.sin(e),o=r/t*e,l=Math.cos(o);n.x=i*(2+l)*.5*a,n.y=i*(2+l)*s*.5,n.z=i*Math.sin(o)*.5}this.setIndex(s),this.setAttribute("position",new zt(o,3)),this.setAttribute("normal",new zt(l,3)),this.setAttribute("uv",new zt(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Qy(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}},e1=class extends Nt{constructor(e=new I_(new F(-1,-1,0),new F(-1,1,0),new F(1,1,0)),t=64,r=1,i=8,n=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:i,closed:n};let a=e.computeFrenetFrames(t,n);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;let s=new F,o=new F,l=new Te,h=new F,c=[],u=[],d=[],p=[];function f(n){h=e.getPointAt(n/t,h);let l=a.normals[n],d=a.binormals[n];for(let e=0;e<=i;e++){let t=e/i*Math.PI*2,n=Math.sin(t),a=-Math.cos(t);o.x=a*l.x+n*d.x,o.y=a*l.y+n*d.y,o.z=a*l.z+n*d.z,o.normalize(),u.push(o.x,o.y,o.z),s.x=h.x+r*o.x,s.y=h.y+r*o.y,s.z=h.z+r*o.z,c.push(s.x,s.y,s.z)}}(function(){for(let e=0;e<t;e++)f(e);f(!1===n?t:0),function(){for(let e=0;e<=t;e++)for(let r=0;r<=i;r++)l.x=e/t,l.y=r/i,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=i;t++){let r=(i+1)*(e-1)+(t-1),n=(i+1)*e+(t-1),a=(i+1)*e+t,s=(i+1)*(e-1)+t;p.push(r,n,s),p.push(n,a,s)}}()})(),this.setIndex(p),this.setAttribute("position",new zt(c,3)),this.setAttribute("normal",new zt(u,3)),this.setAttribute("uv",new zt(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){let e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new e1((new S2[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}},A2=class extends Nt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){let t=[],r=new Set,i=new F,n=new F;if(null!==e.index){let a=e.attributes.position,s=e.index,o=e.groups;0===o.length&&(o=[{start:0,count:s.count,materialIndex:0}]);for(let e=0,l=o.length;e<l;++e){let l=o[e],h=l.start;for(let e=h,o=h+l.count;e<o;e+=3)for(let o=0;o<3;o++){let l=s.getX(e+o),h=s.getX(e+(o+1)%3);i.fromBufferAttribute(a,l),n.fromBufferAttribute(a,h),!0===Hge(i,n,r)&&(t.push(i.x,i.y,i.z),t.push(n.x,n.y,n.z))}}}else{let a=e.attributes.position;for(let e=0,s=a.count/3;e<s;e++)for(let s=0;s<3;s++){let o=3*e+s,l=3*e+(s+1)%3;i.fromBufferAttribute(a,o),n.fromBufferAttribute(a,l),!0===Hge(i,n,r)&&(t.push(i.x,i.y,i.z),t.push(n.x,n.y,n.z))}}this.setAttribute("position",new zt(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}};function Hge(e,t,r){let i=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==r.has(i)&&!0!==r.has(n)&&(r.add(i),r.add(n),!0)}var Vge=Object.freeze({__proto__:null,BoxGeometry:lc,CapsuleGeometry:Wy,CircleGeometry:Xy,ConeGeometry:Yy,CylinderGeometry:gu,DodecahedronGeometry:$y,EdgesGeometry:_h,ExtrudeGeometry:va,IcosahedronGeometry:Zy,LatheGeometry:Hg,OctahedronGeometry:zg,PlaneGeometry:vs,PolyhedronGeometry:Eh,RingGeometry:Ky,ShapeGeometry:hc,SphereGeometry:Al,TetrahedronGeometry:Jy,TorusGeometry:_p,TorusKnotGeometry:Qy,TubeGeometry:e1,WireframeGeometry:A2}),R2=class extends qn{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new dt(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}},C2=class extends xr{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}},Ss=class extends qn{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new dt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Sp,this.normalScale=new Te(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}},Qa=class extends Ss{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Te(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Os(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new dt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new dt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new dt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}},Da=class extends qn{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new dt(16777215),this.specular=new dt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Sp,this.normalScale=new Te(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=G_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}},P2=class extends qn{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new dt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Sp,this.normalScale=new Te(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},Tp=class extends qn{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Sp,this.normalScale=new Te(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}},Th=class extends qn{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new dt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new dt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Sp,this.normalScale=new Te(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=G_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}},I2=class extends qn{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new dt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Sp,this.normalScale=new Te(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}},wh=class extends Yr{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}};function Cg(e,t,r){return!e||!r&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function mve(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function gve(e){let t=e.length,r=new Array(t);for(let e=0;e!==t;++e)r[e]=e;return r.sort((function(t,r){return e[t]-e[r]})),r}function d4(e,t,r){let i=e.length,n=new e.constructor(i);for(let a=0,s=0;s!==i;++a){let i=r[a]*t;for(let r=0;r!==t;++r)n[s++]=e[i+r]}return n}function tV(e,t,r,i){let n=1,a=e[0];for(;void 0!==a&&void 0===a[i];)a=e[n++];if(void 0===a)return;let s=a[i];if(void 0!==s)if(Array.isArray(s))do{s=a[i],void 0!==s&&(t.push(a.time),r.push.apply(r,s)),a=e[n++]}while(void 0!==a);else if(void 0!==s.toArray)do{s=a[i],void 0!==s&&(t.push(a.time),s.toArray(r,r.length)),a=e[n++]}while(void 0!==a);else do{s=a[i],void 0!==s&&(t.push(a.time),r.push(s)),a=e[n++]}while(void 0!==a)}function Byt(e,t,r,i,n=30){let a=e.clone();a.name=t;let s=[];for(let e=0;e<a.tracks.length;++e){let t=a.tracks[e],o=t.getValueSize(),l=[],h=[];for(let e=0;e<t.times.length;++e){let a=t.times[e]*n;if(!(a<r||a>=i)){l.push(t.times[e]);for(let r=0;r<o;++r)h.push(t.values[e*o+r])}}0!==l.length&&(t.times=Cg(l,t.times.constructor),t.values=Cg(h,t.values.constructor),s.push(t))}a.tracks=s;let o=1/0;for(let e=0;e<a.tracks.length;++e)o>a.tracks[e].times[0]&&(o=a.tracks[e].times[0]);for(let e=0;e<a.tracks.length;++e)a.tracks[e].shift(-1*o);return a.resetDuration(),a}function Nyt(e,t=0,r=e,i=30){i<=0&&(i=30);let n=r.tracks.length,a=t/i;for(let t=0;t<n;++t){let i=r.tracks[t],n=i.ValueTypeName;if("bool"===n||"string"===n)continue;let s=e.tracks.find((function(e){return e.name===i.name&&e.ValueTypeName===n}));if(void 0===s)continue;let o=0,l=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let h=0,c=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=c/3);let u,d=i.times.length-1;if(a<=i.times[0]){let e=o,t=l-o;u=i.values.slice(e,t)}else if(a>=i.times[d]){let e=d*l+o,t=e+l-o;u=i.values.slice(e,t)}else{let e=i.createInterpolant(),t=o,r=l-o;e.evaluate(a),u=e.resultBuffer.slice(t,r)}"quaternion"===n&&(new dn).fromArray(u).normalize().conjugate().toArray(u);let p=s.times.length;for(let e=0;e<p;++e){let t=e*c+h;if("quaternion"===n)dn.multiplyQuaternionsFlat(s.values,t,u,0,s.values,t);else{let e=c-2*h;for(let r=0;r<e;++r)s.values[t+r]-=u[r]}}}return e.blendMode=Y4,e}var Uyt={convertArray:Cg,isTypedArray:mve,getKeyframeOrder:gve,sortedArray:d4,flattenJSON:tV,subclip:Byt,makeClipAdditive:Nyt},Jd=class{constructor(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,r=this._cachedIndex,i=t[r],n=t[r-1];e:{t:{let a;r:{i:if(!(e<i)){for(let a=r+2;;){if(void 0===i){if(e<n)break i;return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===a)break;if(n=i,i=t[++r],e<i)break t}a=t.length;break r}if(e>=n)break e;{let s=t[1];e<s&&(r=2,n=s);for(let a=r-2;;){if(void 0===n)return this._cachedIndex=0,this.copySampleValue_(0);if(r===a)break;if(i=n,n=t[--r-1],e>=n)break t}a=r,r=0}}for(;r<a;){let i=r+a>>>1;e<t[i]?a=i:r=i+1}if(i=t[r],n=t[r-1],void 0===n)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,n,i)}return this.interpolate_(r,n,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i;for(let e=0;e!==i;++e)t[e]=r[n+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},O2=class extends Jd{constructor(e,t,r,i){super(e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Ag,endingEnd:Ag}}intervalChanged_(e,t,r){let i=this.parameterPositions,n=e-2,a=e+1,s=i[n],o=i[a];if(void 0===s)switch(this.getSettings_().endingStart){case Rg:n=e,s=2*t-r;break;case v_:n=i.length-2,s=t+i[n]-i[n+1];break;default:n=e,s=r}if(void 0===o)switch(this.getSettings_().endingEnd){case Rg:a=e,o=2*r-t;break;case v_:a=1,o=r+i[1]-i[0];break;default:a=e-1,o=t}let l=.5*(r-t),h=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(o-r),this._offsetPrev=n*h,this._offsetNext=a*h}interpolate_(e,t,r,i){let n=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,h=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(r-t)/(i-t),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,b=d*m-d*f;for(let e=0;e!==s;++e)n[e]=g*a[h+e]+v*a[l+e]+y*a[o+e]+b*a[c+e];return n}},k_=class extends Jd{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){let n=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,h=(r-t)/(i-t),c=1-h;for(let e=0;e!==s;++e)n[e]=a[l+e]*c+a[o+e]*h;return n}},D2=class extends Jd{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e){return this.copySampleValue_(e-1)}},Rl=class{constructor(e,t,r,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Cg(t,this.TimeBufferType),this.values=Cg(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){let t,r=e.constructor;if(r.toJSON!==this.toJSON)t=r.toJSON(e);else{t={name:e.name,times:Cg(e.times,Array),values:Cg(e.values,Array)};let r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}InterpolantFactoryMethodDiscrete(e){return new D2(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new k_(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new O2(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case jd:t=this.InterpolantFactoryMethodDiscrete;break;case gh:t=this.InterpolantFactoryMethodLinear;break;case u2:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){let t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return jd;case this.InterpolantFactoryMethodLinear:return gh;case this.InterpolantFactoryMethodSmooth:return u2}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){let t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]+=e}return this}scale(e){if(1!==e){let t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]*=e}return this}trim(e,t){let r=this.times,i=r.length,n=0,a=i-1;for(;n!==i&&r[n]<e;)++n;for(;-1!==a&&r[a]>t;)--a;if(++a,0!==n||a!==i){n>=a&&(a=Math.max(a,1),n=a-1);let e=this.getValueSize();this.times=r.slice(n,a),this.values=this.values.slice(n*e,a*e)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let r=this.times,i=this.values,n=r.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let t=0;t!==n;t++){let i=r[t];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,i),e=!1;break}if(null!==a&&a>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,i,a),e=!1;break}a=i}if(void 0!==i&&mve(i))for(let t=0,r=i.length;t!==r;++t){let r=i[t];if(isNaN(r)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,r),e=!1;break}}return e}optimize(){let e=this.times.slice(),t=this.values.slice(),r=this.getValueSize(),i=this.getInterpolation()===u2,n=e.length-1,a=1;for(let s=1;s<n;++s){let n=!1,o=e[s];if(o!==e[s+1]&&(1!==s||o!==e[0]))if(i)n=!0;else{let e=s*r,i=e-r,a=e+r;for(let s=0;s!==r;++s){let r=t[e+s];if(r!==t[i+s]||r!==t[a+s]){n=!0;break}}}if(n){if(s!==a){e[a]=e[s];let i=s*r,n=a*r;for(let e=0;e!==r;++e)t[n+e]=t[i+e]}++a}}if(n>0){e[a]=e[n];for(let e=n*r,i=a*r,s=0;s!==r;++s)t[i+s]=t[e+s];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*r)):(this.times=e,this.values=t),this}clone(){let e=this.times.slice(),t=this.values.slice(),r=new(0,this.constructor)(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}};Rl.prototype.TimeBufferType=Float32Array,Rl.prototype.ValueBufferType=Float32Array,Rl.prototype.DefaultInterpolation=gh;var Qd=class extends Rl{};Qd.prototype.ValueTypeName="bool",Qd.prototype.ValueBufferType=Array,Qd.prototype.DefaultInterpolation=jd,Qd.prototype.InterpolantFactoryMethodLinear=void 0,Qd.prototype.InterpolantFactoryMethodSmooth=void 0;var F_=class extends Rl{};F_.prototype.ValueTypeName="color";var dc=class extends Rl{};dc.prototype.ValueTypeName="number";var L2=class extends Jd{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){let n=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=(r-t)/(i-t),l=e*s;for(let e=l+s;l!==e;l+=4)dn.slerpFlat(n,0,a,l-s,a,l,o);return n}},eo=class extends Rl{InterpolantFactoryMethodLinear(e){return new L2(this.times,this.values,this.getValueSize(),e)}};eo.prototype.ValueTypeName="quaternion",eo.prototype.DefaultInterpolation=gh,eo.prototype.InterpolantFactoryMethodSmooth=void 0;var ef=class extends Rl{};ef.prototype.ValueTypeName="string",ef.prototype.ValueBufferType=Array,ef.prototype.DefaultInterpolation=jd,ef.prototype.InterpolantFactoryMethodLinear=void 0,ef.prototype.InterpolantFactoryMethodSmooth=void 0;var wo=class extends Rl{};wo.prototype.ValueTypeName="vector";var Yo=class{constructor(e,t=-1,r,i=j2){this.name=e,this.tracks=r,this.duration=t,this.blendMode=i,this.uuid=Sl(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],r=e.tracks,i=1/(e.fps||1);for(let e=0,n=r.length;e!==n;++e)t.push(Vyt(r[e]).scale(i));let n=new this(e.name,e.duration,t,e.blendMode);return n.uuid=e.uuid,n}static toJSON(e){let t=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,i=r.length;e!==i;++e)t.push(Rl.toJSON(r[e]));return i}static CreateFromMorphTargetSequence(e,t,r,i){let n=t.length,a=[];for(let e=0;e<n;e++){let s=[],o=[];s.push((e+n-1)%n,e,(e+1)%n),o.push(0,1,0);let l=gve(s);s=d4(s,1,l),o=d4(o,1,l),!i&&0===s[0]&&(s.push(n),o.push(o[0])),a.push(new dc(".morphTargetInfluences["+t[e].name+"]",s,o).scale(1/r))}return new this(e,-1,a)}static findByName(e,t){let r=e;if(!Array.isArray(e)){let t=e;r=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<r.length;e++)if(r[e].name===t)return r[e];return null}static CreateClipsFromMorphTargetSequences(e,t,r){let i={},n=/^([\w-]*?)([\d]+)$/;for(let t=0,r=e.length;t<r;t++){let r=e[t],a=r.name.match(n);if(a&&a.length>1){let e=a[1],t=i[e];t||(i[e]=t=[]),t.push(r)}}let a=[];for(let e in i)a.push(this.CreateFromMorphTargetSequence(e,i[e],t,r));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let r=function(e,t,r,i,n){if(0!==r.length){let a=[],s=[];tV(r,a,s,i),0!==a.length&&n.push(new e(t,a,s))}},i=[],n=e.name||"default",a=e.fps||30,s=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let e=0;e<l.length;e++){let n=l[e].keys;if(n&&0!==n.length)if(n[0].morphTargets){let e,t={};for(e=0;e<n.length;e++)if(n[e].morphTargets)for(let r=0;r<n[e].morphTargets.length;r++)t[n[e].morphTargets[r]]=-1;for(let r in t){let t=[],a=[];for(let i=0;i!==n[e].morphTargets.length;++i){let i=n[e];t.push(i.time),a.push(i.morphTarget===r?1:0)}i.push(new dc(".morphTargetInfluence["+r+"]",t,a))}o=t.length*a}else{let a=".bones["+t[e].name+"]";r(wo,a+".position",n,"pos",i),r(eo,a+".quaternion",n,"rot",i),r(wo,a+".scale",n,"scl",i)}}return 0===i.length?null:new this(n,o,i,s)}resetDuration(){let e=0;for(let t=0,r=this.tracks.length;t!==r;++t){let r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function Hyt(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return dc;case"vector":case"vector2":case"vector3":case"vector4":return wo;case"color":return F_;case"quaternion":return eo;case"bool":case"boolean":return Qd;case"string":return ef}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function Vyt(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=Hyt(e.type);if(void 0===e.times){let t=[],r=[];tV(e.keys,t,r,"value"),e.times=t,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var Gg={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Sh=class{constructor(e,t,r){let i,n=this,a=!1,s=0,o=0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){o++,!1===a&&void 0!==n.onStart&&n.onStart(e,s,o),a=!0},this.itemEnd=function(e){s++,void 0!==n.onProgress&&n.onProgress(e,s,o),s===o&&(a=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){let t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,r=l.length;t<r;t+=2){let r=l[t],i=l[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return i}return null}}},Zo=new Sh,Mn=class{constructor(e){this.manager=void 0!==e?e:Zo,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let r=this;return new Promise((function(i,n){r.load(e,i,t,n)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}};Mn.DEFAULT_MATERIAL_NAME="__DEFAULT";var Hd={},f4=class extends Error{constructor(e,t){super(e),this.response=t}},Hn=class extends Mn{constructor(e){super(e)}load(e,t,r,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let n=Gg.get(e);if(void 0!==n)return this.manager.itemStart(e),setTimeout((()=>{t&&t(n),this.manager.itemEnd(e)}),0),n;if(void 0!==Hd[e])return void Hd[e].push({onLoad:t,onProgress:r,onError:i});Hd[e]=[],Hd[e].push({onLoad:t,onProgress:r,onError:i});let a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,o=this.responseType;fetch(a).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;let r=Hd[e],i=t.body.getReader(),n=t.headers.get("Content-Length")||t.headers.get("X-File-Size"),a=n?parseInt(n):0,s=0!==a,o=0,l=new ReadableStream({start(e){!function t(){i.read().then((({done:i,value:n})=>{if(i)e.close();else{o+=n.byteLength;let i=new ProgressEvent("progress",{lengthComputable:s,loaded:o,total:a});for(let e=0,t=r.length;e<t;e++){let t=r[e];t.onProgress&&t.onProgress(i)}e.enqueue(n),t()}}))}()}});return new Response(l)}throw new f4(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)})).then((e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,s)));case"json":return e.json();default:if(void 0===s)return e.text();{let t=/charset="?([^;"\s]*)"?/i.exec(s),r=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(r);return e.arrayBuffer().then((e=>i.decode(e)))}}})).then((t=>{Gg.add(e,t);let r=Hd[e];delete Hd[e];for(let e=0,i=r.length;e<i;e++){let i=r[e];i.onLoad&&i.onLoad(t)}})).catch((t=>{let r=Hd[e];if(void 0===r)throw this.manager.itemError(e),t;delete Hd[e];for(let e=0,i=r.length;e<i;e++){let i=r[e];i.onError&&i.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},p4=class extends Mn{constructor(e){super(e)}load(e,t,r,i){let n=this,a=new Hn(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(r){try{t(n.parse(JSON.parse(r)))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}}),r,i)}parse(e){let t=[];for(let r=0;r<e.length;r++){let i=Yo.parse(e[r]);t.push(i)}return t}},B_=class extends Mn{constructor(e){super(e)}load(e,t,r,i){let n=this,a=[],s=new bh,o=new Hn(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(n.withCredentials);let l=0;function h(h){o.load(e[h],(function(e){let r=n.parse(e,!0);a[h]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},l+=1,6===l&&(1===r.mipmapCount&&(s.minFilter=wn),s.image=a,s.format=r.format,s.needsUpdate=!0,t&&t(s))}),r,i)}if(Array.isArray(e))for(let t=0,r=e.length;t<r;++t)h(t);else o.load(e,(function(e){let r=n.parse(e,!0);if(r.isCubemap){let e=r.mipmaps.length/r.mipmapCount;for(let t=0;t<e;t++){a[t]={mipmaps:[]};for(let e=0;e<r.mipmapCount;e++)a[t].mipmaps.push(r.mipmaps[t*r.mipmapCount+e]),a[t].format=r.format,a[t].width=r.width,a[t].height=r.height}s.image=a}else s.image.width=r.width,s.image.height=r.height,s.mipmaps=r.mipmaps;1===r.mipmapCount&&(s.minFilter=wn),s.format=r.format,s.needsUpdate=!0,t&&t(s)}),r,i);return s}},qg=class extends Mn{constructor(e){super(e)}load(e,t,r,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let n=this,a=Gg.get(e);if(void 0!==a)return n.manager.itemStart(e),setTimeout((function(){t&&t(a),n.manager.itemEnd(e)}),0),a;let s=__("img");function o(){h(),Gg.add(e,this),t&&t(this),n.manager.itemEnd(e)}function l(t){h(),i&&i(t),n.manager.itemError(e),n.manager.itemEnd(e)}function h(){s.removeEventListener("load",o,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",o,!1),s.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),n.manager.itemStart(e),s.src=e,s}},N_=class extends Mn{constructor(e){super(e)}load(e,t,r,i){let n=new Fg;n.colorSpace=Zr;let a=new qg(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let s=0;function o(r){a.load(e[r],(function(e){n.images[r]=e,s++,6===s&&(n.needsUpdate=!0,t&&t(n))}),void 0,i)}for(let t=0;t<e.length;++t)o(t);return n}},tf=class extends Mn{constructor(e){super(e)}load(e,t,r,i){let n=this,a=new _o,s=new Hn(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(n.withCredentials),s.load(e,(function(e){let r;try{r=n.parse(e)}catch(e){if(void 0===i)return void console.error(e);i(e)}void 0!==r.image?a.image=r.image:void 0!==r.data&&(a.image.width=r.width,a.image.height=r.height,a.image.data=r.data),a.wrapS=void 0!==r.wrapS?r.wrapS:pi,a.wrapT=void 0!==r.wrapT?r.wrapT:pi,a.magFilter=void 0!==r.magFilter?r.magFilter:wn,a.minFilter=void 0!==r.minFilter?r.minFilter:wn,a.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.colorSpace?a.colorSpace=r.colorSpace:void 0!==r.encoding&&(a.encoding=r.encoding),void 0!==r.flipY&&(a.flipY=r.flipY),void 0!==r.format&&(a.format=r.format),void 0!==r.type&&(a.type=r.type),void 0!==r.mipmaps&&(a.mipmaps=r.mipmaps,a.minFilter=ia),1===r.mipmapCount&&(a.minFilter=wn),void 0!==r.generateMipmaps&&(a.generateMipmaps=r.generateMipmaps),a.needsUpdate=!0,t&&t(a,r)}),r,i),a}},Ds=class extends Mn{constructor(e){super(e)}load(e,t,r,i){let n=new bi,a=new qg(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(e){n.image=e,n.needsUpdate=!0,void 0!==t&&t(n)}),r,i),n}},fc=class extends yr{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new dt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}},Mh=class extends fc{constructor(e,t,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(yr.DEFAULT_UP),this.updateMatrix(),this.groundColor=new dt(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},o6=new lt,zge=new F,Gge=new F,U_=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Te(512,512),this.map=null,this.mapPass=null,this.matrix=new lt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ml,this._frameExtents=new Te(1,1),this._viewportCount=1,this._viewports=[new Fn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,r=this.matrix;zge.setFromMatrixPosition(e.matrixWorld),t.position.copy(zge),Gge.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Gge),t.updateMatrixWorld(),o6.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o6),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(o6)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){let e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},m4=class extends U_{constructor(){super(new ci(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,r=2*Hy*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;(r!==t.fov||i!==t.aspect||n!==t.far)&&(t.fov=r,t.aspect=i,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},pc=class extends fc{constructor(e,t,r=0,i=Math.PI/3,n=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(yr.DEFAULT_UP),this.updateMatrix(),this.target=new yr,this.distance=r,this.angle=i,this.penumbra=n,this.decay=a,this.map=null,this.shadow=new m4}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},qge=new lt,s_=new F,l6=new F,g4=class extends U_{constructor(){super(new ci(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Te(4,2),this._viewportCount=6,this._viewports=[new Fn(2,1,1,1),new Fn(0,1,1,1),new Fn(3,1,1,1),new Fn(1,1,1,1),new Fn(3,0,1,1),new Fn(1,0,1,1)],this._cubeDirections=[new F(1,0,0),new F(-1,0,0),new F(0,0,1),new F(0,0,-1),new F(0,1,0),new F(0,-1,0)],this._cubeUps=[new F(0,1,0),new F(0,1,0),new F(0,1,0),new F(0,1,0),new F(0,0,1),new F(0,0,-1)]}updateMatrices(e,t=0){let r=this.camera,i=this.matrix,n=e.distance||r.far;n!==r.far&&(r.far=n,r.updateProjectionMatrix()),s_.setFromMatrixPosition(e.matrixWorld),r.position.copy(s_),l6.copy(r.position),l6.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(l6),r.updateMatrixWorld(),i.makeTranslation(-s_.x,-s_.y,-s_.z),qge.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(qge)}},Cl=class extends fc{constructor(e,t,r=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new g4}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},v4=class extends U_{constructor(){super(new Gi(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},ya=class extends fc{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(yr.DEFAULT_UP),this.updateMatrix(),this.target=new yr,this.shadow=new v4}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},$o=class extends fc{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}},t1=class extends fc{constructor(e,t,r=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){let t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}},k2=class{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new F)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){let r=e.x,i=e.y,n=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*i),t.addScaledVector(a[2],.488603*n),t.addScaledVector(a[3],.488603*r),t.addScaledVector(a[4],r*i*1.092548),t.addScaledVector(a[5],i*n*1.092548),t.addScaledVector(a[6],.315392*(3*n*n-1)),t.addScaledVector(a[7],r*n*1.092548),t.addScaledVector(a[8],.546274*(r*r-i*i)),t}getIrradianceAt(e,t){let r=e.x,i=e.y,n=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*i),t.addScaledVector(a[2],1.023328*n),t.addScaledVector(a[3],1.023328*r),t.addScaledVector(a[4],.858086*r*i),t.addScaledVector(a[5],.858086*i*n),t.addScaledVector(a[6],.743125*n*n-.247708),t.addScaledVector(a[7],.858086*r*n),t.addScaledVector(a[8],.429043*(r*r-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){let r=this.coefficients;for(let i=0;i<9;i++)r[i].fromArray(e,t+3*i);return this}toArray(e=[],t=0){let r=this.coefficients;for(let i=0;i<9;i++)r[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){let r=e.x,i=e.y,n=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*n,t[3]=.488603*r,t[4]=1.092548*r*i,t[5]=1.092548*i*n,t[6]=.315392*(3*n*n-1),t[7]=1.092548*r*n,t[8]=.546274*(r*r-i*i)}},F2=class extends fc{constructor(e=new k2,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){let t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}},r1=class extends Mn{constructor(e){super(e),this.textures={}}load(e,t,r,i){let n=this,a=new Hn(n.manager);a.setPath(n.path),a.setRequestHeader(n.requestHeader),a.setWithCredentials(n.withCredentials),a.load(e,(function(r){try{t(n.parse(JSON.parse(r)))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}}),r,i)}parse(e){let t=this.textures;function r(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}let i=r1.createMaterialFromType(e.type);if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=e.sheen),void 0!==e.sheenColor&&(i.sheenColor=(new dt).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(i.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular),void 0!==e.specularIntensity&&(i.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(i.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(i.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.thickness&&(i.thickness=e.thickness),void 0!==e.attenuationDistance&&(i.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(i.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(i.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.shadowSide&&(i.shadowSide=e.shadowSide),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(i.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(i.depthFunc=e.depthFunc),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(i.blendSrc=e.blendSrc),void 0!==e.blendDst&&(i.blendDst=e.blendDst),void 0!==e.blendEquation&&(i.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(i.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(i.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(i.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==i.blendColor&&i.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(i.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),void 0!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.alphaToCoverage&&(i.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(i.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(i.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(let t in e.uniforms){let n=e.uniforms[t];switch(i.uniforms[t]={},n.type){case"t":i.uniforms[t].value=r(n.value);break;case"c":i.uniforms[t].value=(new dt).setHex(n.value);break;case"v2":i.uniforms[t].value=(new Te).fromArray(n.value);break;case"v3":i.uniforms[t].value=(new F).fromArray(n.value);break;case"v4":i.uniforms[t].value=(new Fn).fromArray(n.value);break;case"m3":i.uniforms[t].value=(new Wr).fromArray(n.value);break;case"m4":i.uniforms[t].value=(new lt).fromArray(n.value);break;default:i.uniforms[t].value=n.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(i.glslVersion=e.glslVersion),void 0!==e.extensions)for(let t in e.extensions)i.extensions[t]=e.extensions[t];if(void 0!==e.lights&&(i.lights=e.lights),void 0!==e.clipping&&(i.clipping=e.clipping),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=r(e.map)),void 0!==e.matcap&&(i.matcap=r(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=r(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=r(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=r(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),i.normalScale=(new Te).fromArray(t)}return void 0!==e.displacementMap&&(i.displacementMap=r(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=r(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=r(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=r(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=r(e.specularMap)),void 0!==e.specularIntensityMap&&(i.specularIntensityMap=r(e.specularIntensityMap)),void 0!==e.specularColorMap&&(i.specularColorMap=r(e.specularColorMap)),void 0!==e.envMap&&(i.envMap=r(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=r(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=r(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=r(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=r(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=r(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Te).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(i.iridescenceMap=r(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(i.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(i.transmissionMap=r(e.transmissionMap)),void 0!==e.thicknessMap&&(i.thicknessMap=r(e.thicknessMap)),void 0!==e.anisotropyMap&&(i.anisotropyMap=r(e.anisotropyMap)),void 0!==e.sheenColorMap&&(i.sheenColorMap=r(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(i.sheenRoughnessMap=r(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new{ShadowMaterial:R2,SpriteMaterial:Bg,RawShaderMaterial:C2,ShaderMaterial:xr,PointsMaterial:Ai,MeshPhysicalMaterial:Qa,MeshStandardMaterial:Ss,MeshPhongMaterial:Da,MeshToonMaterial:P2,MeshNormalMaterial:Tp,MeshLambertMaterial:Th,MeshDepthMaterial:Yd,MeshDistanceMaterial:A_,MeshBasicMaterial:Mr,MeshMatcapMaterial:I2,LineDashedMaterial:wh,LineBasicMaterial:Yr,Material:qn}[e]}},oa=class{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let r=0,i=e.length;r<i;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){let t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}},B2=class extends Nt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},n1=class extends Mn{constructor(e){super(e)}load(e,t,r,i){let n=this,a=new Hn(n.manager);a.setPath(n.path),a.setRequestHeader(n.requestHeader),a.setWithCredentials(n.withCredentials),a.load(e,(function(r){try{t(n.parse(JSON.parse(r)))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}}),r,i)}parse(e){let t={},r={};function i(e,i){if(void 0!==t[i])return t[i];let n=e.interleavedBuffers[i],a=function(e,t){if(void 0!==r[t])return r[t];let i=e.arrayBuffers[t],n=new Uint32Array(i).buffer;return r[t]=n,n}(e,n.buffer),s=Iy(n.type,a),o=new $d(s,n.stride);return o.uuid=n.uuid,t[i]=o,o}let n=e.isInstancedBufferGeometry?new B2:new Nt,a=e.data.index;if(void 0!==a){let e=Iy(a.type,a.array);n.setIndex(new fr(e,1))}let s=e.data.attributes;for(let t in s){let r,a=s[t];if(a.isInterleavedBufferAttribute){let t=i(e.data,a.data);r=new Xo(t,a.itemSize,a.offset,a.normalized)}else{let e=Iy(a.type,a.array);r=new(a.isInstancedBufferAttribute?Ja:fr)(e,a.itemSize,a.normalized)}void 0!==a.name&&(r.name=a.name),void 0!==a.usage&&r.setUsage(a.usage),n.setAttribute(t,r)}let o=e.data.morphAttributes;if(o)for(let t in o){let r=o[t],a=[];for(let t=0,n=r.length;t<n;t++){let n,s=r[t];if(s.isInterleavedBufferAttribute){let t=i(e.data,s.data);n=new Xo(t,s.itemSize,s.offset,s.normalized)}else{let e=Iy(s.type,s.array);n=new fr(e,s.itemSize,s.normalized)}void 0!==s.name&&(n.name=s.name),a.push(n)}n.morphAttributes[t]=a}e.data.morphTargetsRelative&&(n.morphTargetsRelative=!0);let l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){let t=l[e];n.addGroup(t.start,t.count,t.materialIndex)}let h=e.data.boundingSphere;if(void 0!==h){let e=new F;void 0!==h.center&&e.fromArray(h.center),n.boundingSphere=new Sn(e,h.radius)}return e.name&&(n.name=e.name),e.userData&&(n.userData=e.userData),n}},y4=class extends Mn{constructor(e){super(e)}load(e,t,r,i){let n=this,a=""===this.path?oa.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;let s=new Hn(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(r){let a=null;try{a=JSON.parse(r)}catch(t){return void 0!==i&&i(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}let s=a.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())return void 0!==i&&i(new Error("THREE.ObjectLoader: Can't load "+e)),void console.error("THREE.ObjectLoader: Can't load "+e);n.parse(a,t)}),r,i)}loadAsync(e,t){return bt(this,null,(function*(){let r=""===this.path?oa.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;let i=new Hn(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);let n=yield i.loadAsync(e,t),a=JSON.parse(n),s=a.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return yield this.parseAsync(a)}))}parse(e,t){let r=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),n=this.parseGeometries(e.geometries,i),a=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),s=this.parseTextures(e.textures,a),o=this.parseMaterials(e.materials,s),l=this.parseObject(e.object,n,o,s,r),h=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,h),void 0!==t){let e=!1;for(let t in a)if(a[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}parseAsync(e){return bt(this,null,(function*(){let t=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),n=yield this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,n),s=this.parseMaterials(e.materials,a),o=this.parseObject(e.object,i,s,a,t),l=this.parseSkeletons(e.skeletons,o);return this.bindSkeletons(o,l),o}))}parseShapes(e){let t={};if(void 0!==e)for(let r=0,i=e.length;r<i;r++){let i=(new Ys).fromJSON(e[r]);t[i.uuid]=i}return t}parseSkeletons(e,t){let r={},i={};if(t.traverse((function(e){e.isBone&&(i[e.uuid]=e)})),void 0!==e)for(let t=0,n=e.length;t<n;t++){let n=(new uc).fromJSON(e[t],i);r[n.uuid]=n}return r}parseGeometries(e,t){let r={};if(void 0!==e){let i=new n1;for(let n=0,a=e.length;n<a;n++){let a,s=e[n];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":a=i.parse(s);break;default:s.type in Vge?a=Vge[s.type].fromJSON(s,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${s.type}"`)}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.userData&&(a.userData=s.userData),r[s.uuid]=a}}return r}parseMaterials(e,t){let r={},i={};if(void 0!==e){let n=new r1;n.setTextures(t);for(let t=0,a=e.length;t<a;t++){let a=e[t];void 0===r[a.uuid]&&(r[a.uuid]=n.parse(a)),i[a.uuid]=r[a.uuid]}}return i}parseAnimations(e){let t={};if(void 0!==e)for(let r=0;r<e.length;r++){let i=e[r],n=Yo.parse(i);t[n.uuid]=n}return t}parseImages(e,t){let r,i=this,n={};function a(e){if("string"==typeof e){let t=e;return function(e){return i.manager.itemStart(e),r.load(e,(function(){i.manager.itemEnd(e)}),void 0,(function(){i.manager.itemError(e),i.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:i.resourcePath+t)}return e.data?{data:Iy(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){let i=new Sh(t);r=new qg(i),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){let r=e[t],i=r.url;if(Array.isArray(i)){let e=[];for(let t=0,r=i.length;t<r;t++){let r=a(i[t]);null!==r&&(r instanceof HTMLImageElement?e.push(r):e.push(new _o(r.data,r.width,r.height)))}n[r.uuid]=new uu(e)}else{let e=a(r.url);n[r.uuid]=new uu(e)}}}return n}parseImagesAsync(e){return bt(this,null,(function*(){let t,r=this,i={};function n(e){return bt(this,null,(function*(){if("string"==typeof e){let i=e,n=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(i)?i:r.resourcePath+i;return yield t.loadAsync(n)}return e.data?{data:Iy(e.type,e.data),width:e.width,height:e.height}:null}))}if(void 0!==e&&e.length>0){t=new qg(this.manager),t.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){let r=e[t],a=r.url;if(Array.isArray(a)){let e=[];for(let t=0,r=a.length;t<r;t++){let r=a[t],i=yield n(r);null!==i&&(i instanceof HTMLImageElement?e.push(i):e.push(new _o(i.data,i.width,i.height)))}i[r.uuid]=new uu(e)}else{let e=yield n(r.url);i[r.uuid]=new uu(e)}}}return i}))}parseTextures(e,t){function r(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}let i={};if(void 0!==e)for(let n=0,a=e.length;n<a;n++){let a=e[n];void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===t[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);let s,o=t[a.image],l=o.data;Array.isArray(l)?(s=new Fg,6===l.length&&(s.needsUpdate=!0)):(s=l&&l.data?new _o:new bi,l&&(s.needsUpdate=!0)),s.source=o,s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.mapping&&(s.mapping=r(a.mapping,zyt)),void 0!==a.channel&&(s.channel=a.channel),void 0!==a.offset&&s.offset.fromArray(a.offset),void 0!==a.repeat&&s.repeat.fromArray(a.repeat),void 0!==a.center&&s.center.fromArray(a.center),void 0!==a.rotation&&(s.rotation=a.rotation),void 0!==a.wrap&&(s.wrapS=r(a.wrap[0],jge),s.wrapT=r(a.wrap[1],jge)),void 0!==a.format&&(s.format=a.format),void 0!==a.internalFormat&&(s.internalFormat=a.internalFormat),void 0!==a.type&&(s.type=a.type),void 0!==a.colorSpace&&(s.colorSpace=a.colorSpace),void 0!==a.encoding&&(s.encoding=a.encoding),void 0!==a.minFilter&&(s.minFilter=r(a.minFilter,Wge)),void 0!==a.magFilter&&(s.magFilter=r(a.magFilter,Wge)),void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy),void 0!==a.flipY&&(s.flipY=a.flipY),void 0!==a.generateMipmaps&&(s.generateMipmaps=a.generateMipmaps),void 0!==a.premultiplyAlpha&&(s.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(s.unpackAlignment=a.unpackAlignment),void 0!==a.compareFunction&&(s.compareFunction=a.compareFunction),void 0!==a.userData&&(s.userData=a.userData),i[a.uuid]=s}return i}parseObject(e,t,r,i,n){let a,s,o;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function h(e){if(void 0!==e){if(Array.isArray(e)){let t=[];for(let i=0,n=e.length;i<n;i++){let n=e[i];void 0===r[n]&&console.warn("THREE.ObjectLoader: Undefined material",n),t.push(r[n])}return t}return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}}function c(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),i[e]}switch(e.type){case"Scene":a=new Xi,void 0!==e.background&&(Number.isInteger(e.background)?a.background=new dt(e.background):a.background=c(e.background)),void 0!==e.environment&&(a.environment=c(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?a.fog=new vh(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(a.fog=new Gy(e.fog.color,e.fog.density)),""!==e.fog.name&&(a.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(a.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(a.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":a=new ci(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(a.focus=e.focus),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.filmGauge&&(a.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(a.filmOffset=e.filmOffset),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new Gi(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new $o(e.color,e.intensity);break;case"DirectionalLight":a=new ya(e.color,e.intensity);break;case"PointLight":a=new Cl(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new t1(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new pc(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":a=new Mh(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=(new F2).fromJSON(e);break;case"SkinnedMesh":s=l(e.geometry),o=h(e.material),a=new yh(s,o),void 0!==e.bindMode&&(a.bindMode=e.bindMode),void 0!==e.bindMatrix&&a.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(a.skeleton=e.skeleton);break;case"Mesh":s=l(e.geometry),o=h(e.material),a=new Ht(s,o);break;case"InstancedMesh":s=l(e.geometry),o=h(e.material);let t=e.count,r=e.instanceMatrix,i=e.instanceColor;a=new ls(s,o,t),a.instanceMatrix=new Ja(new Float32Array(r.array),16),void 0!==i&&(a.instanceColor=new Ja(new Float32Array(i.array),i.itemSize));break;case"BatchedMesh":s=l(e.geometry),o=h(e.material),a=new E2(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,o),a.geometry=s,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._visibility=e.visibility,a._active=e.active,a._bounds=e.bounds.map((e=>{let t=new Vt;t.min.fromArray(e.boxMin),t.max.fromArray(e.boxMax);let r=new Sn;return r.radius=e.sphereRadius,r.center.fromArray(e.sphereCenter),{boxInitialized:e.boxInitialized,box:t,sphereInitialized:e.sphereInitialized,sphere:r}})),a._maxGeometryCount=e.maxGeometryCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._geometryCount=e.geometryCount,a._matricesTexture=c(e.matricesTexture.uuid);break;case"LOD":a=new x2;break;case"Line":a=new jn(l(e.geometry),h(e.material));break;case"LineLoop":a=new jy(l(e.geometry),h(e.material));break;case"LineSegments":a=new Wn(l(e.geometry),h(e.material));break;case"PointCloud":case"Points":a=new Di(l(e.geometry),h(e.material));break;case"Sprite":a=new qy(h(e.material));break;case"Group":a=new Xr;break;case"Bone":a=new cc;break;default:a=new yr}if(a.uuid=e.uuid,void 0!==e.name&&(a.name=e.name),void 0!==e.matrix?(a.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==e.position&&a.position.fromArray(e.position),void 0!==e.rotation&&a.rotation.fromArray(e.rotation),void 0!==e.quaternion&&a.quaternion.fromArray(e.quaternion),void 0!==e.scale&&a.scale.fromArray(e.scale)),void 0!==e.up&&a.up.fromArray(e.up),void 0!==e.castShadow&&(a.castShadow=e.castShadow),void 0!==e.receiveShadow&&(a.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(a.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(a.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(a.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&a.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(a.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.frustumCulled&&(a.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(a.renderOrder=e.renderOrder),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.layers&&(a.layers.mask=e.layers),void 0!==e.children){let s=e.children;for(let e=0;e<s.length;e++)a.add(this.parseObject(s[e],t,r,i,n))}if(void 0!==e.animations){let t=e.animations;for(let e=0;e<t.length;e++){let r=t[e];a.animations.push(n[r])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(a.autoUpdate=e.autoUpdate);let t=e.levels;for(let e=0;e<t.length;e++){let r=t[e],i=a.getObjectByProperty("uuid",r.object);void 0!==i&&a.addLevel(i,r.distance,r.hysteresis)}}return a}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){let r=t[e.skeleton];void 0===r?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(r,e.bindMatrix)}}))}},zyt={UVMapping:z2,CubeReflectionMapping:qd,CubeRefractionMapping:xp,EquirectangularReflectionMapping:Og,EquirectangularRefractionMapping:p_,CubeUVReflectionMapping:c1},jge={RepeatWrapping:ui,ClampToEdgeWrapping:pi,MirroredRepeatWrapping:fu},Wge={NearestFilter:ni,NearestMipmapNearestFilter:mh,NearestMipmapLinearFilter:hu,LinearFilter:wn,LinearMipmapNearestFilter:rf,LinearMipmapLinearFilter:ia},H_=class extends Mn{constructor(e){super(e),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,r,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let n=this,a=Gg.get(e);if(void 0!==a)return n.manager.itemStart(e),setTimeout((function(){t&&t(a),n.manager.itemEnd(e)}),0),a;let s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader,fetch(e,s).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(n.options,{colorSpaceConversion:"none"}))})).then((function(r){Gg.add(e,r),t&&t(r),n.manager.itemEnd(e)})).catch((function(t){i&&i(t),n.manager.itemError(e),n.manager.itemEnd(e)})),n.manager.itemStart(e)}},t2,V_=class{static getContext(){return void 0===t2&&(t2=new(window.AudioContext||window.webkitAudioContext)),t2}static setContext(e){t2=e}},b4=class extends Mn{constructor(e){super(e)}load(e,t,r,i){let n=this,a=new Hn(this.manager);function s(t){i?i(t):console.error(t),n.manager.itemError(e)}a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(e){try{let r=e.slice(0);V_.getContext().decodeAudioData(r,(function(e){t(e)})).catch(s)}catch(e){s(e)}}),r,i)}},Xge=new lt,Yge=new lt,bg=new lt,x4=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ci,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ci,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){let t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,bg.copy(e.projectionMatrix);let r,i,n=t.eyeSep/2,a=n*t.near/t.focus,s=t.near*Math.tan(Ig*t.fov*.5)/t.zoom;Yge.elements[12]=-n,Xge.elements[12]=n,r=-s*t.aspect+a,i=s*t.aspect+a,bg.elements[0]=2*t.near/(i-r),bg.elements[8]=(i+r)/(i-r),this.cameraL.projectionMatrix.copy(bg),r=-s*t.aspect-a,i=s*t.aspect-a,bg.elements[0]=2*t.near/(i-r),bg.elements[8]=(i+r)/(i-r),this.cameraR.projectionMatrix.copy(bg)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Yge),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Xge)}},mc=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=$ge(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=$ge();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function $ge(){return("undefined"==typeof performance?Date:performance).now()}var xg=new F,Zge=new dn,Gyt=new F,Eg=new F,E4=class extends yr{constructor(){super(),this.type="AudioListener",this.context=V_.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new mc}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);let t=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(xg,Zge,Gyt),Eg.set(0,0,-1).applyQuaternion(Zge),t.positionX){let e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(xg.x,e),t.positionY.linearRampToValueAtTime(xg.y,e),t.positionZ.linearRampToValueAtTime(xg.z,e),t.forwardX.linearRampToValueAtTime(Eg.x,e),t.forwardY.linearRampToValueAtTime(Eg.y,e),t.forwardZ.linearRampToValueAtTime(Eg.z,e),t.upX.linearRampToValueAtTime(r.x,e),t.upY.linearRampToValueAtTime(r.y,e),t.upZ.linearRampToValueAtTime(r.z,e)}else t.setPosition(xg.x,xg.y,xg.z),t.setOrientation(Eg.x,Eg.y,Eg.z,r.x,r.y,r.z)}},N2=class extends yr{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;let t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}},_g=new F,Kge=new dn,qyt=new F,Tg=new F,_4=class extends N2{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(_g,Kge,qyt),Tg.set(0,0,1).applyQuaternion(Kge);let t=this.panner;if(t.positionX){let e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(_g.x,e),t.positionY.linearRampToValueAtTime(_g.y,e),t.positionZ.linearRampToValueAtTime(_g.z,e),t.orientationX.linearRampToValueAtTime(Tg.x,e),t.orientationY.linearRampToValueAtTime(Tg.y,e),t.orientationZ.linearRampToValueAtTime(Tg.z,e)}else t.setPosition(_g.x,_g.y,_g.z),t.setOrientation(Tg.x,Tg.y,Tg.z)}},T4=class{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0,t=this.getFrequencyData();for(let r=0;r<t.length;r++)e+=t[r];return e/t.length}},U2=class{constructor(e,t,r){let i,n,a;switch(this.binding=e,this.valueSize=r,t){case"quaternion":i=this._slerp,n=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":i=this._select,n=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:i=this._lerp,n=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=n,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let r=this.buffer,i=this.valueSize,n=e*i+i,a=this.cumulativeWeight;if(0===a){for(let e=0;e!==i;++e)r[n+e]=r[e];a=t}else{a+=t;let e=t/a;this._mixBufferRegion(r,n,0,e,i)}this.cumulativeWeight=a}accumulateAdditive(e){let t=this.buffer,r=this.valueSize,i=r*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,r=this.buffer,i=e*t+t,n=this.cumulativeWeight,a=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){let e=t*this._origIndex;this._mixBufferRegion(r,i,e,1-n,t)}a>0&&this._mixBufferRegionAdditive(r,i,this._addIndex*t,1,t);for(let e=t,n=t+t;e!==n;++e)if(r[e]!==r[e+t]){s.setValue(r,i);break}}saveOriginalState(){let e=this.binding,t=this.buffer,r=this.valueSize,i=r*this._origIndex;e.getValue(t,i);for(let e=r,n=i;e!==n;++e)t[e]=t[i+e%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let r=e;r<t;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[t+r]=this.buffer[e+r]}_select(e,t,r,i,n){if(i>=.5)for(let i=0;i!==n;++i)e[t+i]=e[r+i]}_slerp(e,t,r,i){dn.slerpFlat(e,t,e,t,e,r,i)}_slerpAdditive(e,t,r,i,n){let a=this._workIndex*n;dn.multiplyQuaternionsFlat(e,a,e,t,e,r),dn.slerpFlat(e,t,e,t,e,a,i)}_lerp(e,t,r,i,n){let a=1-i;for(let s=0;s!==n;++s){let n=t+s;e[n]=e[n]*a+e[r+s]*i}}_lerpAdditive(e,t,r,i,n){for(let a=0;a!==n;++a){let n=t+a;e[n]=e[n]+e[r+a]*i}}},rV="\\[\\]\\.:\\/",jyt=new RegExp("["+rV+"]","g"),nV="[^"+rV+"]",Wyt="[^"+rV.replace("\\.","")+"]",Xyt=/((?:WC+[\/:])*)/.source.replace("WC",nV),Yyt=/(WCOD+)?/.source.replace("WCOD",Wyt),$yt=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",nV),Zyt=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",nV),Kyt=new RegExp("^"+Xyt+Yyt+$yt+Zyt+"$"),Jyt=["material","materials","bones","map"],w4=class{constructor(e,t,r){let i=r||hn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();let r=this._targetGroup.nCachedObjects_,i=this._bindings[r];void 0!==i&&i.getValue(e,t)}setValue(e,t){let r=this._bindings;for(let i=this._targetGroup.nCachedObjects_,n=r.length;i!==n;++i)r[i].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}},hn=class{constructor(e,t,r){this.path=t,this.parsedPath=r||hn.parseTrackName(t),this.node=hn.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return e&&e.isAnimationObjectGroup?new hn.Composite(e,t,r):new hn(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(jyt,"")}static parseTrackName(e){let t=Kyt.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){let e=r.nodeName.substring(i+1);-1!==Jyt.indexOf(e)&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=e)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){let r=e.skeleton.getBoneByName(t);if(void 0!==r)return r}if(e.children){let r=function(e){for(let i=0;i<e.length;i++){let n=e[i];if(n.name===t||n.uuid===t)return n;let a=r(n.children);if(a)return a}return null},i=r(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let r=this.resolvedProperty;for(let i=0,n=r.length;i!==n;++i)e[t++]=r[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let r=this.resolvedProperty;for(let i=0,n=r.length;i!==n;++i)r[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let r=this.resolvedProperty;for(let i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let r=this.resolvedProperty;for(let i=0,n=r.length;i!==n;++i)r[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,r=t.objectName,i=t.propertyName,n=t.propertyIndex;if(e||(e=hn.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(r){let i=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}let a=e[i];if(void 0===a){let r=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+r+"."+i+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[n]&&(n=e.morphTargetDictionary[n])}o=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=n}else void 0!==a.fromArray&&void 0!==a.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(o=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};hn.Composite=w4,hn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},hn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},hn.prototype.GetterByBindingType=[hn.prototype._getValue_direct,hn.prototype._getValue_array,hn.prototype._getValue_arrayElement,hn.prototype._getValue_toArray],hn.prototype.SetterByBindingTypeAndVersioning=[[hn.prototype._setValue_direct,hn.prototype._setValue_direct_setNeedsUpdate,hn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[hn.prototype._setValue_array,hn.prototype._setValue_array_setNeedsUpdate,hn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[hn.prototype._setValue_arrayElement,hn.prototype._setValue_arrayElement_setNeedsUpdate,hn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[hn.prototype._setValue_fromArray,hn.prototype._setValue_fromArray_setNeedsUpdate,hn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var S4=class{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Sl(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;let e={};this._indicesByUUID=e;for(let t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};let t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){let e,t=this._objects,r=this._indicesByUUID,i=this._paths,n=this._parsedPaths,a=this._bindings,s=a.length,o=t.length,l=this.nCachedObjects_;for(let h=0,c=arguments.length;h!==c;++h){let c=arguments[h],u=c.uuid,d=r[u];if(void 0===d){d=o++,r[u]=d,t.push(c);for(let e=0,t=s;e!==t;++e)a[e].push(new hn(c,i[e],n[e]))}else if(d<l){e=t[d];let o=--l,h=t[o];r[h.uuid]=d,t[d]=h,r[u]=o,t[o]=c;for(let e=0,t=s;e!==t;++e){let t=a[e],r=t[o],s=t[d];t[d]=r,void 0===s&&(s=new hn(c,i[e],n[e])),t[o]=s}}else t[d]!==e&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){let e=this._objects,t=this._indicesByUUID,r=this._bindings,i=r.length,n=this.nCachedObjects_;for(let a=0,s=arguments.length;a!==s;++a){let s=arguments[a],o=s.uuid,l=t[o];if(void 0!==l&&l>=n){let a=n++,h=e[a];t[h.uuid]=l,e[l]=h,t[o]=a,e[a]=s;for(let e=0,t=i;e!==t;++e){let t=r[e],i=t[a],n=t[l];t[l]=i,t[a]=n}}}this.nCachedObjects_=n}uncache(){let e=this._objects,t=this._indicesByUUID,r=this._bindings,i=r.length,n=this.nCachedObjects_,a=e.length;for(let s=0,o=arguments.length;s!==o;++s){let o=arguments[s].uuid,l=t[o];if(void 0!==l)if(delete t[o],l<n){let s=--n,o=e[s],h=--a,c=e[h];t[o.uuid]=l,e[l]=o,t[c.uuid]=s,e[s]=c,e.pop();for(let e=0,t=i;e!==t;++e){let t=r[e],i=t[s],n=t[h];t[l]=i,t[s]=n,t.pop()}}else{let n=--a,s=e[n];n>0&&(t[s.uuid]=l),e[l]=s,e.pop();for(let e=0,t=i;e!==t;++e){let t=r[e];t[l]=t[n],t.pop()}}}this.nCachedObjects_=n}subscribe_(e,t){let r=this._bindingsIndicesByPath,i=r[e],n=this._bindings;if(void 0!==i)return n[i];let a=this._paths,s=this._parsedPaths,o=this._objects,l=o.length,h=this.nCachedObjects_,c=new Array(l);i=n.length,r[e]=i,a.push(e),s.push(t),n.push(c);for(let r=h,i=o.length;r!==i;++r){let i=o[r];c[r]=new hn(i,e,t)}return c}unsubscribe_(e){let t=this._bindingsIndicesByPath,r=t[e];if(void 0!==r){let i=this._paths,n=this._parsedPaths,a=this._bindings,s=a.length-1,o=a[s];t[e[s]]=r,a[r]=o,a.pop(),n[r]=n[s],n.pop(),i[r]=i[s],i.pop()}}},H2=class{constructor(e,t,r=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=i;let n=t.tracks,a=n.length,s=new Array(a),o={endingStart:Ag,endingEnd:Ag};for(let e=0;e!==a;++e){let t=n[e].createInterpolant(null);s[e]=t,t.settings=o}this._interpolantSettings=o,this._interpolants=s,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=G0e,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){let r=this._clip.duration,i=e._clip.duration,n=i/r,a=r/i;e.warp(1,n,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)}stopFading(){let e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){let i=this._mixer,n=i.time,a=this.timeScale,s=this._timeScaleInterpolant;null===s&&(s=i._lendControlInterpolant(),this._timeScaleInterpolant=s);let o=s.parameterPositions,l=s.sampleValues;return o[0]=n,o[1]=n+r,l[0]=e/a,l[1]=t/a,this}stopWarping(){let e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,i){if(!this.enabled)return void this._updateWeight(e);let n=this._startTime;if(null!==n){let i=(e-n)*r;i<0||0===r?t=0:(this._startTime=null,t=r*i)}t*=this._updateTimeScale(e);let a=this._updateTime(t),s=this._updateWeight(e);if(s>0){let e=this._interpolants,t=this._propertyBindings;if(this.blendMode===Y4)for(let r=0,i=e.length;r!==i;++r)e[r].evaluate(a),t[r].accumulateAdditive(s);else for(let r=0,n=e.length;r!==n;++r)e[r].evaluate(a),t[r].accumulate(i,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let r=this._weightInterpolant;if(null!==r){let i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let r=this._timeScaleInterpolant;if(null!==r){t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,r=this.loop,i=this.time+e,n=this._loopCount,a=r===q0e;if(0===e)return-1===n?i:a&&1==(1&n)?t-i:i;if(r===z0e){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===n&&(e>=0?(n=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),i>=t||i<0){let r=Math.floor(i/t);i-=t*r,n+=Math.abs(r);let s=this.repetitions-n;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){let t=e<0;this._setEndings(t,!t,a)}else this._setEndings(!1,!1,a);this._loopCount=n,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r})}}else this.time=i;if(a&&1==(1&n))return t-i}return i}_setEndings(e,t,r){let i=this._interpolantSettings;r?(i.endingStart=Rg,i.endingEnd=Rg):(i.endingStart=e?this.zeroSlopeAtStart?Rg:Ag:v_,i.endingEnd=t?this.zeroSlopeAtEnd?Rg:Ag:v_)}_scheduleFading(e,t,r){let i=this._mixer,n=i.time,a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);let s=a.parameterPositions,o=a.sampleValues;return s[0]=n,o[0]=t,s[1]=n+e,o[1]=r,this}},Qyt=new Float32Array(1),M4=class extends mu{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let r=e._localRoot||this._root,i=e._clip.tracks,n=i.length,a=e._propertyBindings,s=e._interpolants,o=r.uuid,l=this._bindingsByRootAndName,h=l[o];void 0===h&&(h={},l[o]=h);for(let e=0;e!==n;++e){let n=i[e],l=n.name,c=h[l];if(void 0!==c)++c.referenceCount,a[e]=c;else{if(c=a[e],void 0!==c){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,o,l));continue}let i=t&&t._propertyBindings[e].binding.parsedPath;c=new U2(hn.create(r,l,i),n.ValueTypeName,n.getValueSize()),++c.referenceCount,this._addInactiveBinding(c,o,l),a[e]=c}s[e].resultBuffer=c.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){let t=(e._localRoot||this._root).uuid,r=e._clip.uuid,i=this._actionsByClip[r];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,r,t)}let t=e._propertyBindings;for(let e=0,r=t.length;e!==r;++e){let r=t[e];0==r.useCount++&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let e=0,r=t.length;e!==r;++e){let r=t[e];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,r){let i=this._actions,n=this._actionsByClip,a=n[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=a;else{let t=a.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[r]=e}_removeInactiveAction(e){let t=this._actions,r=t[t.length-1],i=e._cacheIndex;r._cacheIndex=i,t[i]=r,t.pop(),e._cacheIndex=null;let n=e._clip.uuid,a=this._actionsByClip,s=a[n],o=s.knownActions,l=o[o.length-1],h=e._byClipCacheIndex;l._byClipCacheIndex=h,o[h]=l,o.pop(),e._byClipCacheIndex=null,delete s.actionByRoot[(e._localRoot||this._root).uuid],0===o.length&&delete a[n],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let e=0,r=t.length;e!==r;++e){let r=t[e];0==--r.referenceCount&&this._removeInactiveBinding(r)}}_lendAction(e){let t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_takeBackAction(e){let t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_addInactiveBinding(e,t,r){let i=this._bindingsByRootAndName,n=this._bindings,a=i[t];void 0===a&&(a={},i[t]=a),a[r]=e,e._cacheIndex=n.length,n.push(e)}_removeInactiveBinding(e){let t=this._bindings,r=e.binding,i=r.rootNode.uuid,n=r.path,a=this._bindingsByRootAndName,s=a[i],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete s[n],0===Object.keys(s).length&&delete a[i]}_lendBinding(e){let t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_takeBackBinding(e){let t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,n=t[i];e._cacheIndex=i,t[i]=e,n._cacheIndex=r,t[r]=n}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return void 0===r&&(r=new k_(new Float32Array(2),new Float32Array(2),1,Qyt),r.__cacheIndex=t,e[t]=r),r}_takeBackControlInterpolant(e){let t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,n=t[i];e.__cacheIndex=i,t[i]=e,n.__cacheIndex=r,t[r]=n}clipAction(e,t,r){let i=t||this._root,n=i.uuid,a="string"==typeof e?Yo.findByName(i,e):e,s=null!==a?a.uuid:e,o=this._actionsByClip[s],l=null;if(void 0===r&&(r=null!==a?a.blendMode:j2),void 0!==o){let e=o.actionByRoot[n];if(void 0!==e&&e.blendMode===r)return e;l=o.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;let h=new H2(this,a,t,r);return this._bindAction(h,l),this._addInactiveAction(h,s,n),h}existingAction(e,t){let r=t||this._root,i=r.uuid,n="string"==typeof e?Yo.findByName(r,e):e,a=n?n.uuid:e,s=this._actionsByClip[a];return void 0!==s&&s.actionByRoot[i]||null}stopAllAction(){let e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;let t=this._actions,r=this._nActiveActions,i=this.time+=e,n=Math.sign(e),a=this._accuIndex^=1;for(let s=0;s!==r;++s)t[s]._update(i,e,n,a);let s=this._bindings,o=this._nActiveBindings;for(let e=0;e!==o;++e)s[e].apply(a);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,r=e.uuid,i=this._actionsByClip,n=i[r];if(void 0!==n){let e=n.knownActions;for(let r=0,i=e.length;r!==i;++r){let i=e[r];this._deactivateAction(i);let n=i._cacheIndex,a=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,a._cacheIndex=n,t[n]=a,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[r]}}uncacheRoot(e){let t=e.uuid,r=this._actionsByClip;for(let e in r){let i=r[e].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}let i=this._bindingsByRootAndName[t];if(void 0!==i)for(let e in i){let t=i[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){let r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}},jg=class{constructor(e){this.value=e}clone(){return new jg(void 0===this.value.clone?this.value:this.value.clone())}},e1t=0,A4=class extends mu{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:e1t++}),this.name="",this.usage=E_,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){let t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;let t=e.uniforms;this.uniforms.length=0;for(let e=0,r=t.length;e<r;e++)this.uniforms.push(t[e].clone());return this}clone(){return(new this.constructor).copy(this)}},R4=class extends $d{constructor(e,t,r=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){let t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){let t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}},C4=class{constructor(e,t,r,i,n){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=r,this.elementSize=i,this.count=n,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}},vu=class{constructor(e,t,r=0,i=1/0){this.ray=new Za(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new Ep,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,r=[]){return P4(e,this,r,t),r.sort(Jge),r}intersectObjects(e,t=!0,r=[]){for(let i=0,n=e.length;i<n;i++)P4(e[i],this,r,t);return r.sort(Jge),r}};function Jge(e,t){return e.distance-t.distance}function P4(e,t,r,i){if(e.layers.test(t.layers)&&e.raycast(t,r),!0===i){let i=e.children;for(let e=0,n=i.length;e<n;e++)P4(i[e],t,r,!0)}}var Wg=class{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(Os(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},I4=class{constructor(e=1,t=0,r=0){return this.radius=e,this.theta=t,this.y=r,this}set(e,t,r){return this.radius=e,this.theta=t,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}clone(){return(new this.constructor).copy(this)}},Qge=new Te,ts=class{constructor(e=new Te(1/0,1/0),t=new Te(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let r=Qge.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Qge).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},e0e=new F,r2=new F,La=class{constructor(e=new F,t=new F){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){e0e.subVectors(e,this.start),r2.subVectors(this.end,this.start);let r=r2.dot(r2),i=r2.dot(e0e)/r;return t&&(i=Os(i,0,1)),i}closestPointToPoint(e,t,r){let i=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}},t0e=new F,O4=class extends yr{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let r=new Nt,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,r=32;e<r;e++,t++){let n=e/r*Math.PI*2,a=t/r*Math.PI*2;i.push(Math.cos(n),Math.sin(n),1,Math.cos(a),Math.sin(a),1)}r.setAttribute("position",new zt(i,3));let n=new Yr({fog:!1,toneMapped:!1});this.cone=new Wn(r,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),t0e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t0e),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},yp=new F,n2=new lt,c6=new lt,D4=class extends Wn{constructor(e){let t=vve(e),r=new Nt,i=[],n=[],a=new dt(0,0,1),s=new dt(0,1,0);for(let e=0;e<t.length;e++){let r=t[e];r.parent&&r.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),n.push(a.r,a.g,a.b),n.push(s.r,s.g,s.b))}r.setAttribute("position",new zt(i,3)),r.setAttribute("color",new zt(n,3)),super(r,new Yr({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){let t=this.bones,r=this.geometry,i=r.getAttribute("position");c6.copy(this.root.matrixWorld).invert();for(let e=0,r=0;e<t.length;e++){let n=t[e];n.parent&&n.parent.isBone&&(n2.multiplyMatrices(c6,n.matrixWorld),yp.setFromMatrixPosition(n2),i.setXYZ(r,yp.x,yp.y,yp.z),n2.multiplyMatrices(c6,n.parent.matrixWorld),yp.setFromMatrixPosition(n2),i.setXYZ(r+1,yp.x,yp.y,yp.z),r+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}};function vve(e){let t=[];!0===e.isBone&&t.push(e);for(let r=0;r<e.children.length;r++)t.push.apply(t,vve(e.children[r]));return t}var L4=class extends Ht{constructor(e,t,r){super(new Al(t,4,2),new Mr({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},t1t=new F,r0e=new dt,n0e=new dt,k4=class extends yr{constructor(e,t,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";let i=new zg(t);i.rotateY(.5*Math.PI),this.material=new Mr({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);let n=i.getAttribute("position"),a=new Float32Array(3*n.count);i.setAttribute("color",new fr(a,3)),this.add(new Ht(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){let e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{let t=e.geometry.getAttribute("color");r0e.copy(this.light.color),n0e.copy(this.light.groundColor);for(let e=0,r=t.count;e<r;e++){let i=e<r/2?r0e:n0e;t.setXYZ(e,i.r,i.g,i.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(t1t.setFromMatrixPosition(this.light.matrixWorld).negate())}},z_=class extends Wn{constructor(e=10,t=10,r=4473924,i=8947848){r=new dt(r),i=new dt(i);let n=t/2,a=e/t,s=e/2,o=[],l=[];for(let e=0,h=0,c=-s;e<=t;e++,c+=a){o.push(-s,0,c,s,0,c),o.push(c,0,-s,c,0,s);let t=e===n?r:i;t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3,t.toArray(l,h),h+=3}let h=new Nt;h.setAttribute("position",new zt(o,3)),h.setAttribute("color",new zt(l,3)),super(h,new Yr({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},F4=class extends Wn{constructor(e=10,t=16,r=8,i=64,n=4473924,a=8947848){n=new dt(n),a=new dt(a);let s=[],o=[];if(t>1)for(let r=0;r<t;r++){let i=r/t*(2*Math.PI),l=Math.sin(i)*e,h=Math.cos(i)*e;s.push(0,0,0),s.push(l,0,h);let c=1&r?n:a;o.push(c.r,c.g,c.b),o.push(c.r,c.g,c.b)}for(let t=0;t<r;t++){let l=1&t?n:a,h=e-e/r*t;for(let e=0;e<i;e++){let t=e/i*(2*Math.PI),r=Math.sin(t)*h,n=Math.cos(t)*h;s.push(r,0,n),o.push(l.r,l.g,l.b),t=(e+1)/i*(2*Math.PI),r=Math.sin(t)*h,n=Math.cos(t)*h,s.push(r,0,n),o.push(l.r,l.g,l.b)}}let l=new Nt;l.setAttribute("position",new zt(s,3)),l.setAttribute("color",new zt(o,3)),super(l,new Yr({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},i0e=new F,i2=new F,s0e=new F,i1=class extends yr{constructor(e,t,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",void 0===t&&(t=1);let i=new Nt;i.setAttribute("position",new zt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let n=new Yr({fog:!1,toneMapped:!1});this.lightPlane=new jn(i,n),this.add(this.lightPlane),i=new Nt,i.setAttribute("position",new zt([0,0,0,0,0,1],3)),this.targetLine=new jn(i,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),i0e.setFromMatrixPosition(this.light.matrixWorld),i2.setFromMatrixPosition(this.light.target.matrixWorld),s0e.subVectors(i2,i0e),this.lightPlane.lookAt(i2),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(i2),this.targetLine.scale.z=s0e.length()}},s2=new F,Is=new kg,s1=class extends Wn{constructor(e){let t=new Nt,r=new Yr({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],n=[],a={};function s(e,t){o(e),o(t)}function o(e){i.push(0,0,0),n.push(0,0,0),void 0===a[e]&&(a[e]=[]),a[e].push(i.length/3-1)}s("n1","n2"),s("n2","n4"),s("n4","n3"),s("n3","n1"),s("f1","f2"),s("f2","f4"),s("f4","f3"),s("f3","f1"),s("n1","f1"),s("n2","f2"),s("n3","f3"),s("n4","f4"),s("p","n1"),s("p","n2"),s("p","n3"),s("p","n4"),s("u1","u2"),s("u2","u3"),s("u3","u1"),s("c","t"),s("p","c"),s("cn1","cn2"),s("cn3","cn4"),s("cf1","cf2"),s("cf3","cf4"),t.setAttribute("position",new zt(i,3)),t.setAttribute("color",new zt(n,3)),super(t,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();let l=new dt(16755200),h=new dt(16711680),c=new dt(43775),u=new dt(16777215),d=new dt(3355443);this.setColors(l,h,c,u,d)}setColors(e,t,r,i,n){let a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,r.r,r.g,r.b),a.setXYZ(33,r.r,r.g,r.b),a.setXYZ(34,r.r,r.g,r.b),a.setXYZ(35,r.r,r.g,r.b),a.setXYZ(36,r.r,r.g,r.b),a.setXYZ(37,r.r,r.g,r.b),a.setXYZ(38,i.r,i.g,i.b),a.setXYZ(39,i.r,i.g,i.b),a.setXYZ(40,n.r,n.g,n.b),a.setXYZ(41,n.r,n.g,n.b),a.setXYZ(42,n.r,n.g,n.b),a.setXYZ(43,n.r,n.g,n.b),a.setXYZ(44,n.r,n.g,n.b),a.setXYZ(45,n.r,n.g,n.b),a.setXYZ(46,n.r,n.g,n.b),a.setXYZ(47,n.r,n.g,n.b),a.setXYZ(48,n.r,n.g,n.b),a.setXYZ(49,n.r,n.g,n.b),a.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap;Is.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ns("c",t,e,Is,0,0,-1),Ns("t",t,e,Is,0,0,1),Ns("n1",t,e,Is,-1,-1,-1),Ns("n2",t,e,Is,1,-1,-1),Ns("n3",t,e,Is,-1,1,-1),Ns("n4",t,e,Is,1,1,-1),Ns("f1",t,e,Is,-1,-1,1),Ns("f2",t,e,Is,1,-1,1),Ns("f3",t,e,Is,-1,1,1),Ns("f4",t,e,Is,1,1,1),Ns("u1",t,e,Is,.7,1.1,-1),Ns("u2",t,e,Is,-.7,1.1,-1),Ns("u3",t,e,Is,0,2,-1),Ns("cf1",t,e,Is,-1,0,1),Ns("cf2",t,e,Is,1,0,1),Ns("cf3",t,e,Is,0,-1,1),Ns("cf4",t,e,Is,0,1,1),Ns("cn1",t,e,Is,-1,0,-1),Ns("cn2",t,e,Is,1,0,-1),Ns("cn3",t,e,Is,0,-1,-1),Ns("cn4",t,e,Is,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Ns(e,t,r,i,n,a,s){s2.set(n,a,s).unproject(i);let o=t[e];if(void 0!==o){let e=r.getAttribute("position");for(let t=0,r=o.length;t<r;t++)e.setXYZ(o[t],s2.x,s2.y,s2.z)}}var a2=new Vt,B4=class extends Wn{constructor(e,t=16776960){let r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),n=new Nt;n.setIndex(new fr(r,1)),n.setAttribute("position",new fr(i,3)),super(n,new Yr({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&a2.setFromObject(this.object),a2.isEmpty())return;let t=a2.min,r=a2.max,i=this.geometry.attributes.position,n=i.array;n[0]=r.x,n[1]=r.y,n[2]=r.z,n[3]=t.x,n[4]=r.y,n[5]=r.z,n[6]=t.x,n[7]=t.y,n[8]=r.z,n[9]=r.x,n[10]=t.y,n[11]=r.z,n[12]=r.x,n[13]=r.y,n[14]=t.z,n[15]=t.x,n[16]=r.y,n[17]=t.z,n[18]=t.x,n[19]=t.y,n[20]=t.z,n[21]=r.x,n[22]=t.y,n[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}},N4=class extends Wn{constructor(e,t=16776960){let r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Nt;i.setIndex(new fr(r,1)),i.setAttribute("position",new zt([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new Yr({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},U4=class extends jn{constructor(e,t=1,r=16776960){let i=r,n=new Nt;n.setAttribute("position",new zt([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),n.computeBoundingSphere(),super(n,new Yr({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;let a=new Nt;a.setAttribute("position",new zt([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),a.computeBoundingSphere(),this.add(new Ht(a,new Mr({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}},a0e=new F,o2,u6,yu=class extends yr{constructor(e=new F(0,0,1),t=new F(0,0,0),r=1,i=16776960,n=.2*r,a=.2*n){super(),this.type="ArrowHelper",void 0===o2&&((o2=new Nt).setAttribute("position",new zt([0,0,0,0,1,0],3)),(u6=new gu(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new jn(o2,new Yr({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ht(u6,new Mr({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,n,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{a0e.set(e.z,0,-e.x).normalize();let t=Math.acos(e.y);this.quaternion.setFromAxisAngle(a0e,t)}}setLength(e,t=.2*e,r=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}},H4=class extends Wn{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new Nt;r.setAttribute("position",new zt(t,3)),r.setAttribute("color",new zt([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(r,new Yr({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,r){let i=new dt,n=this.geometry.attributes.color.array;return i.set(e),i.toArray(n,0),i.toArray(n,3),i.set(t),i.toArray(n,6),i.toArray(n,9),i.set(r),i.toArray(n,12),i.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},Xg=class{constructor(){this.type="ShapePath",this.color=new dt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new xh,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,r,i){return this.currentPath.quadraticCurveTo(e,t,r,i),this}bezierCurveTo(e,t,r,i,n,a){return this.currentPath.bezierCurveTo(e,t,r,i,n,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){let r=t.length,i=!1;for(let n=r-1,a=0;a<r;n=a++){let r=t[n],s=t[a],o=s.x-r.x,l=s.y-r.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(r=t[a],o=-o,s=t[n],l=-l),e.y<r.y||e.y>s.y)continue;if(e.y===r.y){if(e.x===r.x)return!0}else{let t=l*(e.x-r.x)-o*(e.y-r.y);if(0===t)return!0;if(t<0)continue;i=!i}}else{if(e.y!==r.y)continue;if(s.x<=e.x&&e.x<=r.x||r.x<=e.x&&e.x<=s.x)return!0}}return i}let r=$s.isClockWise,i=this.subPaths;if(0===i.length)return[];let n,a,s,o=[];if(1===i.length)return a=i[0],s=new Ys,s.curves=a.curves,o.push(s),o;let l=!r(i[0].getPoints());l=e?!l:l;let h,c,u=[],d=[],p=[],f=0;d[f]=void 0,p[f]=[];for(let t=0,s=i.length;t<s;t++)a=i[t],h=a.getPoints(),n=r(h),n=e?!n:n,n?(!l&&d[f]&&f++,d[f]={s:new Ys,p:h},d[f].s.curves=a.curves,l&&f++,p[f]=[]):p[f].push({h:a,p:h[0]});if(!d[0])return function(e){let t=[];for(let r=0,i=e.length;r<i;r++){let i=e[r],n=new Ys;n.curves=i.curves,t.push(n)}return t}(i);if(d.length>1){let e=!1,r=0;for(let e=0,t=d.length;e<t;e++)u[e]=[];for(let i=0,n=d.length;i<n;i++){let n=p[i];for(let a=0;a<n.length;a++){let s=n[a],o=!0;for(let n=0;n<d.length;n++)t(s.p,d[n].p)&&(i!==n&&r++,o?(o=!1,u[n].push(s)):e=!0);o&&u[i].push(s)}}r>0&&!1===e&&(p=u)}for(let e=0,t=d.length;e<t;e++){s=d[e].s,o.push(s),c=p[e];for(let e=0,t=c.length;e<t;e++)s.holes.push(c[e].h)}return o}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:V2}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=V2);var Ah=new Sn,yve=new F,bve=new F,xve=new F,Eve=new F;function Z2(e,t,r,i,n,a,s){if(yve.fromBufferAttribute(t,i).applyMatrix4(e.matrixWorld),bve.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),r.ray.distanceSqToSegment(yve,bve,Eve,xve)>a)return!1;let o=r.ray.origin.distanceTo(Eve);return!(o<r.near||o>r.far)&&(s.push({distance:o,point:xve.clone(),index:i,object:e}),!0)}jn.prototype.raycast=function(e,t){let r=this.geometry,i=this.matrixWorld,n=e.params.Line.threshold,a=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),Ah.copy(r.boundingSphere),Ah.applyMatrix4(i),Ah.radius+=n,!1===e.ray.intersectsSphere(Ah))return;let s=n*n,o=this.isLineSegments?2:1,l=r.index,h=r.attributes.position,c=t.length;if(null!==l){let r=this.userData.batches;if(r&&r.length>0&&r[0].boundingSphere)for(let n=0;n<r.length;n++){let a=r[n];if(Ah.copy(a.boundingSphere),Ah.applyMatrix4(i),!1!==e.ray.intersectsSphere(Ah))for(let r=a.indexStart,i=a.indexStart+a.indexCount-1;r<i;r+=o){if(Z2(this,h,e,l.getX(r),l.getX(r+1),s,t)&&(t[t.length-1].index=r,t.length-c>=1))return}}else{for(let r=Math.max(0,a.start),i=Math.min(l.count,a.start+a.count)-1;r<i;r+=o){if(Z2(this,h,e,l.getX(r),l.getX(r+1),s,t)&&(t[t.length-1].index=r,t.length-c>=1))return}}}else{let r=this.userData.batches;if(r&&r.length>0&&r[0].boundingSphere)for(let n=0;n<r.length;n++){let a=r[n];if(Ah.copy(a.boundingSphere),Ah.applyMatrix4(i),!1!==e.ray.intersectsSphere(Ah))for(let r=a.positionStart,i=a.positionStart+a.positionCount-1;r<i;r+=o)if(Z2(this,h,e,r,r+1,s,t)&&t.length-c>=1)return}else{for(let r=Math.max(0,a.start),i=Math.min(h.count,a.start+a.count)-1;r<i;r+=o)if(Z2(this,h,e,r,r+1,s,t)&&t.length-c>=1)return}}};var _ve=Math.pow(2,-24),Zg=class{constructor(){}};function gc(e,t,r){return r.min.x=t[e],r.min.y=t[e+1],r.min.z=t[e+2],r.max.x=t[e+3],r.max.y=t[e+4],r.max.z=t[e+5],r}function iV(e){let t=-1,r=-1/0;for(let i=0;i<3;i++){let n=e[i+3]-e[i];n>r&&(r=n,t=i)}return t}function sV(e,t){t.set(e)}function aV(e,t,r){let i,n;for(let a=0;a<3;a++){let s=a+3;i=e[a],n=t[a],r[a]=i<n?i:n,i=e[s],n=t[s],r[s]=i>n?i:n}}function X_(e,t,r){for(let i=0;i<3;i++){let n=t[e+2*i],a=t[e+2*i+1],s=n-a,o=n+a;s<r[i]&&(r[i]=s),o>r[i+3]&&(r[i+3]=o)}}function f1(e){let t=e[3]-e[0],r=e[4]-e[1],i=e[5]-e[2];return 2*(t*r+r*i+i*t)}function i1t(e,t){if(!e.index){let r,i=e.attributes.position.count,n=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;r=i>65535?new Uint32Array(new n(4*i)):new Uint16Array(new n(2*i)),e.setIndex(new fr(r,1));for(let e=0;e<i;e++)r[e]=e}}function s1t(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],r=new Set;for(let t of e.groups)r.add(t.start),r.add(t.start+t.count);let i=Array.from(r.values()).sort(((e,t)=>e-t));for(let e=0;e<i.length-1;e++){let r=i[e],n=i[e+1];t.push({offset:r/3,count:(n-r)/3})}return t}function lV(e,t,r,i,n=null){let a=1/0,s=1/0,o=1/0,l=-1/0,h=-1/0,c=-1/0,u=1/0,d=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0,v=null!==n;for(let i=6*t,n=6*(t+r);i<n;i+=6){let t=e[i+0],r=e[i+1],n=t-r,y=t+r;n<a&&(a=n),y>l&&(l=y),v&&t<u&&(u=t),v&&t>f&&(f=t);let b=e[i+2],x=e[i+3],_=b-x,w=b+x;_<s&&(s=_),w>h&&(h=w),v&&b<d&&(d=b),v&&b>m&&(m=b);let S=e[i+4],T=e[i+5],M=S-T,E=S+T;M<o&&(o=M),E>c&&(c=E),v&&S<p&&(p=S),v&&S>g&&(g=S)}i[0]=a,i[1]=s,i[2]=o,i[3]=l,i[4]=h,i[5]=c,v&&(n[0]=u,n[1]=d,n[2]=p,n[3]=f,n[4]=m,n[5]=g)}function a1t(e,t,r,i){let n=1/0,a=1/0,s=1/0,o=-1/0,l=-1/0,h=-1/0;for(let i=6*t,c=6*(t+r);i<c;i+=6){let t=e[i+0];t<n&&(n=t),t>o&&(o=t);let r=e[i+2];r<a&&(a=r),r>l&&(l=r);let c=e[i+4];c<s&&(s=c),c>h&&(h=c)}i[0]=n,i[1]=a,i[2]=s,i[3]=o,i[4]=l,i[5]=h}function o1t(e,t,r,i,n){let a=r,s=r+i-1,o=n.pos,l=2*n.axis;for(;;){for(;a<=s&&t[6*a+l]<o;)a++;for(;a<=s&&t[6*s+l]>=o;)s--;if(!(a<s))return a;for(let r=0;r<3;r++){let i=e[3*a+r];e[3*a+r]=e[3*s+r],e[3*s+r]=i;let n=t[6*a+2*r+0];t[6*a+2*r+0]=t[6*s+2*r+0],t[6*s+2*r+0]=n;let o=t[6*a+2*r+1];t[6*a+2*r+1]=t[6*s+2*r+1],t[6*s+2*r+1]=o}a++,s--}}var sf=32,l1t=(e,t)=>e.candidate-t.candidate,Mp=new Array(sf).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),K2=new Float32Array(6);function c1t(e,t,r,i,n,a){let s=-1,o=0;if(0===a)s=iV(t),-1!==s&&(o=(t[s]+t[s+3])/2);else if(1===a)s=iV(e),-1!==s&&(o=u1t(r,i,n,s));else if(2===a){let a=f1(e),l=1.25*n,h=6*i,c=6*(i+n);for(let e=0;e<3;e++){let i=t[e],u=(t[e+3]-i)/sf;if(n<sf/4){let t=[...Mp];t.length=n;let i=0;for(let n=h;n<c;n+=6,i++){let a=t[i];a.candidate=r[n+2*e],a.count=0;let{bounds:s,leftCacheBounds:o,rightCacheBounds:l}=a;for(let e=0;e<3;e++)l[e]=1/0,l[e+3]=-1/0,o[e]=1/0,o[e+3]=-1/0,s[e]=1/0,s[e+3]=-1/0;X_(n,r,s)}t.sort(l1t);let u=n;for(let e=0;e<u;e++){let r=t[e];for(;e+1<u&&t[e+1].candidate===r.candidate;)t.splice(e+1,1),u--}for(let i=h;i<c;i+=6){let n=r[i+2*e];for(let e=0;e<u;e++){let a=t[e];n>=a.candidate?X_(i,r,a.rightCacheBounds):(X_(i,r,a.leftCacheBounds),a.count++)}}for(let r=0;r<u;r++){let i=t[r],h=i.count,c=n-i.count,u=i.leftCacheBounds,d=i.rightCacheBounds,p=0;0!==h&&(p=f1(u)/a);let f=0;0!==c&&(f=f1(d)/a);let m=1+1.25*(p*h+f*c);m<l&&(s=e,l=m,o=i.candidate)}}else{for(let e=0;e<sf;e++){let t=Mp[e];t.count=0,t.candidate=i+u+e*u;let r=t.bounds;for(let e=0;e<3;e++)r[e]=1/0,r[e+3]=-1/0}for(let t=h;t<c;t+=6){let n=~~((r[t+2*e]-i)/u);n>=sf&&(n=sf-1);let a=Mp[n];a.count++,X_(t,r,a.bounds)}let t=Mp[sf-1];sV(t.bounds,t.rightCacheBounds);for(let e=sf-2;e>=0;e--){let t=Mp[e],r=Mp[e+1];aV(t.bounds,r.rightCacheBounds,t.rightCacheBounds)}let d=0;for(let t=0;t<sf-1;t++){let r=Mp[t],i=r.count,h=r.bounds,c=Mp[t+1].rightCacheBounds;0!==i&&(0===d?sV(h,K2):aV(h,K2,K2)),d+=i;let u=0,p=0;0!==d&&(u=f1(K2)/a);let f=n-d;0!==f&&(p=f1(c)/a);let m=1+1.25*(u*d+p*f);m<l&&(s=e,l=m,o=r.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${a} used.`);return{axis:s,pos:o}}function u1t(e,t,r,i){let n=0;for(let a=t,s=t+r;a<s;a++)n+=e[6*a+2*i];return n/r}function h1t(e,t){let r=e.attributes.position,i=e.index.array,n=i.length/3,a=new Float32Array(6*n),s=r.normalized,o=r.array,l=r.offset||0,h=3;r.isInterleavedBufferAttribute&&(h=r.data.stride);let c=["getX","getY","getZ"];for(let e=0;e<n;e++){let n,u,d,p=3*e,f=6*e;s?(n=i[p+0],u=i[p+1],d=i[p+2]):(n=i[p+0]*h+l,u=i[p+1]*h+l,d=i[p+2]*h+l);for(let e=0;e<3;e++){let i,l,h;s?(i=r[c[e]](n),l=r[c[e]](u),h=r[c[e]](d)):(i=o[n+e],l=o[u+e],h=o[d+e]);let p=i;l<p&&(p=l),h<p&&(p=h);let m=i;l>m&&(m=l),h>m&&(m=h);let g=(m-p)/2,v=2*e;a[f+v+0]=p+g,a[f+v+1]=g+(Math.abs(p)+g)*_ve,p<t[e]&&(t[e]=p),m>t[e+3]&&(t[e+3]=m)}}return a}function d1t(e,t){function r(e){d&&d(e/p)}function i(t,n,d,p=null,m=0){if(!f&&m>=l&&(f=!0,h&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),d<=c||m>=l)return r(n+d),t.offset=n,t.count=d,t;let g=c1t(t.boundingData,p,s,n,d,u);if(-1===g.axis)return r(n+d),t.offset=n,t.count=d,t;let v=o1t(o,s,n,d,g);if(v===n||v===n+d)r(n+d),t.offset=n,t.count=d;else{t.splitAxis=g.axis;let e=new Zg,r=n,o=v-n;t.left=e,e.boundingData=new Float32Array(6),lV(s,r,o,e.boundingData,a),i(e,r,o,a,m+1);let l=new Zg,h=v,c=d-o;t.right=l,l.boundingData=new Float32Array(6),lV(s,h,c,l.boundingData,a),i(l,h,c,a,m+1)}return t}i1t(e,t);let n=new Float32Array(6),a=new Float32Array(6),s=h1t(e,n),o=e.index.array,l=t.maxDepth,h=t.verbose,c=t.maxLeafTris,u=t.strategy,d=t.onProgress,p=e.index.count/3,f=!1,m=[],g=s1t(e);if(1===g.length){let e=g[0],t=new Zg;t.boundingData=n,a1t(s,e.offset,e.count,a),i(t,e.offset,e.count,a),m.push(t)}else for(let e of g){let t=new Zg;t.boundingData=new Float32Array(6),lV(s,e.offset,e.count,t.boundingData,a),i(t,e.offset,e.count,a),m.push(t)}return m}function Sve(e,t){let r,i,n,a=d1t(e,t),s=[],o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let e=0;e<a.length;e++){let t=a[e],c=new o(32*l(t));r=new Float32Array(c),i=new Uint32Array(c),n=new Uint16Array(c),h(0,t),s.push(c)}return s;function l(e){return e.count?1:1+l(e.left)+l(e.right)}function h(e,t){let a=e/4,s=e/2,o=!!t.count,l=t.boundingData;for(let e=0;e<6;e++)r[a+e]=l[e];if(o){let r=t.offset,o=t.count;return i[a+6]=r,n[s+14]=o,n[s+15]=65535,e+32}{let r,n=t.left,s=t.right,o=t.splitAxis;if(r=h(e+32,n),r/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return i[a+6]=r/4,r=h(r,s),i[a+7]=o,r}}}var Ko=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let r=1/0,i=-1/0;for(let n=0,a=e.length;n<a;n++){let a=e[n][t];r=a<r?a:r,i=a>i?a:i}this.min=r,this.max=i}setFromPoints(e,t){let r=1/0,i=-1/0;for(let n=0,a=t.length;n<a;n++){let a=t[n],s=e.dot(a);r=s<r?s:r,i=s>i?s:i}this.min=r,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}};Ko.prototype.setFromBox=function(){let e=new F;return function(t,r){let i=r.min,n=r.max,a=1/0,s=-1/0;for(let r=0;r<=1;r++)for(let o=0;o<=1;o++)for(let l=0;l<=1;l++){e.x=i.x*r+n.x*(1-r),e.y=i.y*o+n.y*(1-o),e.z=i.z*l+n.z*(1-l);let h=t.dot(e);a=Math.min(h,a),s=Math.max(h,s)}this.min=a,this.max=s}}();var uzt=function(){let e=new Ko;return function(t,r){let i=t.points,n=t.satAxes,a=t.satBounds,s=r.points,o=r.satAxes,l=r.satBounds;for(let t=0;t<3;t++){let r=a[t],i=n[t];if(e.setFromPoints(i,s),r.isSeparated(e))return!1}for(let t=0;t<3;t++){let r=l[t],n=o[t];if(e.setFromPoints(n,i),r.isSeparated(e))return!1}}}(),f1t=function(){let e=new F,t=new F,r=new F;return function(i,n,a){let s=i.start,o=e,l=n.start,h=t;r.subVectors(s,l),e.subVectors(i.end,i.start),t.subVectors(n.end,n.start);let c,u,d=r.dot(h),p=h.dot(o),f=h.dot(h),m=r.dot(o),g=o.dot(o)*f-p*p;c=0!==g?(d*p-m*f)/g:0,u=(d+c*p)/f,a.x=c,a.y=u}}(),Y_=function(){let e=new Te,t=new F,r=new F;return function(i,n,a,s){f1t(i,n,e);let o=e.x,l=e.y;if(o>=0&&o<=1&&l>=0&&l<=1)return i.at(o,a),void n.at(l,s);if(o>=0&&o<=1)return l<0?n.at(0,s):n.at(1,s),void i.closestPointToPoint(s,!0,a);if(l>=0&&l<=1)return o<0?i.at(0,a):i.at(1,a),void n.closestPointToPoint(a,!0,s);{let e,h;e=o<0?i.start:i.end,h=l<0?n.start:n.end;let c=t,u=r;return i.closestPointToPoint(h,!0,t),n.closestPointToPoint(e,!0,r),c.distanceToSquared(h)<=u.distanceToSquared(e)?(a.copy(c),void s.copy(h)):(a.copy(e),void s.copy(u))}}}(),Mve=function(){let e=new F,t=new F,r=new ii,i=new La;return function(n,a){let{radius:s,center:o}=n,{a:l,b:h,c:c}=a;if(i.start=l,i.end=h,i.closestPointToPoint(o,!0,e).distanceTo(o)<=s||(i.start=l,i.end=c,i.closestPointToPoint(o,!0,e).distanceTo(o)<=s)||(i.start=h,i.end=c,i.closestPointToPoint(o,!0,e).distanceTo(o)<=s))return!0;let u=a.getPlane(r);if(Math.abs(u.distanceToPoint(o))<=s){let e=u.projectPoint(o,t);if(a.containsPoint(e))return!0}return!1}}(),p1t=1e-15;function p1(e){return Math.abs(e)<p1t}var Jo=class extends yi{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new F)),this.satBounds=new Array(4).fill().map((()=>new Ko)),this.points=[this.a,this.b,this.c],this.sphere=new Sn,this.plane=new ii,this.needsUpdate=!0}intersectsSphere(e){return Mve(e,this)}update(){let e=this.a,t=this.b,r=this.c,i=this.points,n=this.satAxes,a=this.satBounds,s=n[0],o=a[0];this.getNormal(s),o.setFromPoints(s,i);let l=n[1],h=a[1];l.subVectors(e,t),h.setFromPoints(l,i);let c=n[2],u=a[2];c.subVectors(t,r),u.setFromPoints(c,i);let d=n[3],p=a[3];d.subVectors(r,e),p.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(s,e),this.needsUpdate=!1}};Jo.prototype.closestPointToSegment=function(){let e=new F,t=new F,r=new La;return function(i,n=null,a=null){let s,{start:o,end:l}=i,h=this.points,c=1/0;for(let o=0;o<3;o++){let l=(o+1)%3;r.start.copy(h[o]),r.end.copy(h[l]),Y_(r,i,e,t),s=e.distanceToSquared(t),s<c&&(c=s,n&&n.copy(e),a&&a.copy(t))}return this.closestPointToPoint(o,e),s=o.distanceToSquared(e),s<c&&(c=s,n&&n.copy(e),a&&a.copy(o)),this.closestPointToPoint(l,e),s=l.distanceToSquared(e),s<c&&(c=s,n&&n.copy(e),a&&a.copy(l)),Math.sqrt(c)}}(),Jo.prototype.intersectsTriangle=function(){let e=new Jo,t=new Array(3),r=new Array(3),i=new Ko,n=new Ko,a=new F,s=new F,o=new F,l=new F,h=new La,c=new La,u=new La;return function(d,p=null,f=!1){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(e.copy(d),e.update(),d=e);let m=this.plane,g=d.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){let e=this.satBounds,s=this.satAxes;r[0]=d.a,r[1]=d.b,r[2]=d.c;for(let t=0;t<4;t++){let n=e[t],a=s[t];if(i.setFromPoints(a,r),n.isSeparated(i))return!1}let o=d.satBounds,l=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let e=0;e<4;e++){let r=o[e],n=l[e];if(i.setFromPoints(n,t),r.isSeparated(i))return!1}for(let e=0;e<4;e++){let o=s[e];for(let e=0;e<4;e++){let s=l[e];if(a.crossVectors(o,s),i.setFromPoints(a,t),n.setFromPoints(a,r),i.isSeparated(n))return!1}}return p&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}{let e=this.points,t=!1,r=0;for(let i=0;i<3;i++){let n=e[i],a=e[(i+1)%3];h.start.copy(n),h.end.copy(a),h.delta(s);let o=t?c.start:c.end,l=p1(g.distanceToPoint(n));if(p1(g.normal.dot(s))&&l){c.copy(h),r=2;break}if((g.intersectLine(h,o)||l)&&!p1(o.distanceTo(a))){if(r++,t)break;t=!0}}if(1===r&&d.containsPoint(c.end))return p&&(p.start.copy(c.end),p.end.copy(c.end)),!0;if(2!==r)return!1;let i=d.points,n=!1,a=0;for(let e=0;e<3;e++){let t=i[e],r=i[(e+1)%3];h.start.copy(t),h.end.copy(r),h.delta(o);let s=n?u.start:u.end,l=p1(m.distanceToPoint(t));if(p1(m.normal.dot(o))&&l){u.copy(h),a=2;break}if((m.intersectLine(h,s)||l)&&!p1(s.distanceTo(r))){if(a++,n)break;n=!0}}if(1===a&&this.containsPoint(u.end))return p&&(p.start.copy(u.end),p.end.copy(u.end)),!0;if(2!==a)return!1;if(c.delta(s),u.delta(o),s.dot(o)<0){let e=u.start;u.start=u.end,u.end=e}let f=c.start.dot(s),v=c.end.dot(s),y=u.start.dot(s),b=u.end.dot(s);return(f===b||y===v||v<y!==f<b)&&(p&&(l.subVectors(c.start,u.start),l.dot(s)>0?p.start.copy(c.start):p.start.copy(u.start),l.subVectors(c.end,u.end),l.dot(s)<0?p.end.copy(c.end):p.end.copy(u.end)),!0)}}}(),Jo.prototype.distanceToPoint=function(){let e=new F;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),Jo.prototype.distanceToTriangle=function(){let e=new F,t=new F,r=["a","b","c"],i=new La,n=new La;return function(a,s=null,o=null){let l=s||o?i:null;if(this.intersectsTriangle(a,l))return(s||o)&&(s&&l.getCenter(s),o&&l.getCenter(o)),0;let h=1/0;for(let t=0;t<3;t++){let i,n=r[t],l=a[n];this.closestPointToPoint(l,e),i=l.distanceToSquared(e),i<h&&(h=i,s&&s.copy(e),o&&o.copy(l));let c=this[n];a.closestPointToPoint(c,e),i=c.distanceToSquared(e),i<h&&(h=i,s&&s.copy(c),o&&o.copy(e))}for(let l=0;l<3;l++){let c=r[l],u=r[(l+1)%3];i.set(this[c],this[u]);for(let l=0;l<3;l++){let c=r[l],u=r[(l+1)%3];n.set(a[c],a[u]),Y_(i,n,e,t);let d=e.distanceToSquared(t);d<h&&(h=d,s&&s.copy(e),o&&o.copy(t))}}return Math.sqrt(h)}}();var Qo=class{constructor(e,t,r){this.isOrientedBox=!0,this.min=new F,this.max=new F,this.matrix=new lt,this.invMatrix=new lt,this.points=new Array(8).fill().map((()=>new F)),this.satAxes=new Array(3).fill().map((()=>new F)),this.satBounds=new Array(3).fill().map((()=>new Ko)),this.alignedSatBounds=new Array(3).fill().map((()=>new Ko)),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),r&&this.matrix.copy(r)}set(e,t,r){this.min.copy(e),this.max.copy(t),this.matrix.copy(r),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};Qo.prototype.update=function(){let e=this.matrix,t=this.min,r=this.max,i=this.points;for(let n=0;n<=1;n++)for(let a=0;a<=1;a++)for(let s=0;s<=1;s++){let o=i[1*n|2*a|4*s];o.x=n?r.x:t.x,o.y=a?r.y:t.y,o.z=s?r.z:t.z,o.applyMatrix4(e)}let n=this.satBounds,a=this.satAxes,s=i[0];for(let e=0;e<3;e++){let t=a[e],r=n[e],o=i[1<<e];t.subVectors(s,o),r.setFromPoints(t,i)}let o=this.alignedSatBounds;o[0].setFromPointsField(i,"x"),o[1].setFromPointsField(i,"y"),o[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},Qo.prototype.intersectsBox=function(){let e=new Ko;return function(t){this.needsUpdate&&this.update();let r=t.min,i=t.max,n=this.satBounds,a=this.satAxes,s=this.alignedSatBounds;if(e.min=r.x,e.max=i.x,s[0].isSeparated(e)||(e.min=r.y,e.max=i.y,s[1].isSeparated(e))||(e.min=r.z,e.max=i.z,s[2].isSeparated(e)))return!1;for(let r=0;r<3;r++){let i=a[r],s=n[r];if(e.setFromBox(i,t),s.isSeparated(e))return!1}return!0}}(),Qo.prototype.intersectsTriangle=function(){let e=new Jo,t=new Array(3),r=new Ko,i=new Ko,n=new F;return function(a){this.needsUpdate&&this.update(),a.isExtendedTriangle?a.needsUpdate&&a.update():(e.copy(a),e.update(),a=e);let s=this.satBounds,o=this.satAxes;t[0]=a.a,t[1]=a.b,t[2]=a.c;for(let e=0;e<3;e++){let i=s[e],n=o[e];if(r.setFromPoints(n,t),i.isSeparated(r))return!1}let l=a.satBounds,h=a.satAxes,c=this.points;for(let e=0;e<3;e++){let t=l[e],i=h[e];if(r.setFromPoints(i,c),t.isSeparated(r))return!1}for(let e=0;e<3;e++){let a=o[e];for(let e=0;e<4;e++){let s=h[e];if(n.crossVectors(a,s),r.setFromPoints(n,t),i.setFromPoints(n,c),r.isSeparated(i))return!1}}return!0}}(),Qo.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},Qo.prototype.distanceToPoint=function(){let e=new F;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),Qo.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map((()=>new La)),r=new Array(12).fill().map((()=>new La)),i=new F,n=new F;return function(a,s=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(a))return(o||l)&&(a.getCenter(n),this.closestPointToPoint(n,i),a.closestPointToPoint(i,n),o&&o.copy(i),l&&l.copy(n)),0;let h=s*s,c=a.min,u=a.max,d=this.points,p=1/0;for(let e=0;e<8;e++){let t=d[e];n.copy(t).clamp(c,u);let r=t.distanceToSquared(n);if(r<p&&(p=r,o&&o.copy(t),l&&l.copy(n),r<h))return Math.sqrt(r)}let f=0;for(let i=0;i<3;i++)for(let n=0;n<=1;n++)for(let a=0;a<=1;a++){let s=(i+1)%3,o=(i+2)%3,l=1<<i|n<<s|a<<o,h=d[n<<s|a<<o],p=d[l];t[f].set(h,p);let m=e[i],g=e[s],v=e[o],y=r[f],b=y.start,x=y.end;b[m]=c[m],b[g]=n?c[g]:u[g],b[v]=a?c[v]:u[g],x[m]=u[m],x[g]=n?c[g]:u[g],x[v]=a?c[v]:u[g],f++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let r=0;r<=1;r++){n.x=e?u.x:c.x,n.y=t?u.y:c.y,n.z=r?u.z:c.z,this.closestPointToPoint(n,i);let a=n.distanceToSquared(i);if(a<p&&(p=a,o&&o.copy(i),l&&l.copy(n),a<h))return Math.sqrt(a)}for(let e=0;e<12;e++){let a=t[e];for(let e=0;e<12;e++){let t=r[e];Y_(a,t,i,n);let s=i.distanceToSquared(n);if(s<p&&(p=s,o&&o.copy(i),l&&l.copy(n),s<h))return Math.sqrt(s)}}return Math.sqrt(p)}}();var Q2=new F,eP=new F,tP=new F,Ave=new Te,Rve=new Te,Cve=new Te,Pve=new F;function m1t(e,t,r,i,n,a){let s;return s=a===ws?e.intersectTriangle(i,r,t,!0,n):e.intersectTriangle(t,r,i,a!==ln,n),null===s?null:{distance:e.origin.distanceTo(n),point:n.clone()}}function g1t(e,t,r,i,n,a,s){Q2.fromBufferAttribute(t,i),eP.fromBufferAttribute(t,n),tP.fromBufferAttribute(t,a);let o=m1t(e,Q2,eP,tP,Pve,s);if(o){r&&(Ave.fromBufferAttribute(r,i),Rve.fromBufferAttribute(r,n),Cve.fromBufferAttribute(r,a),o.uv=yi.getUV(Pve,Q2,eP,tP,Ave,Rve,Cve,new Te));let e={a:i,b:n,c:a,normal:new F,materialIndex:0};yi.getNormal(Q2,eP,tP,e.normal),o.face=e,o.faceIndex=i}return o}function uV(e,t,r,i,n){let a=3*i,s=e.index.getX(a),o=e.index.getX(a+1),l=e.index.getX(a+2),h=g1t(r,e.attributes.position,e.attributes.uv,s,o,l,t);return h?(h.faceIndex=i,n&&n.push(h),h):null}function Ive(e,t,r,i,n,a){for(let s=i,o=i+n;s<o;s++)uV(e,t,r,s,a)}function Ove(e,t,r,i,n){let a=1/0,s=null;for(let o=i,l=i+n;o<l;o++){let i=uV(e,t,r,o);i&&i.distance<a&&(s=i,a=i.distance)}return s}function hV(e,t,r){return null===e||(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(r.ray.origin),e.object=t,e.distance<r.near||e.distance>r.far)?null:e}function vc(e,t,r,i){let n=e.a,a=e.b,s=e.c,o=t,l=t+1,h=t+2;r&&(o=r.getX(t),l=r.getX(t+1),h=r.getX(t+2)),n.x=i.getX(o),n.y=i.getY(o),n.z=i.getZ(o),a.x=i.getX(l),a.y=i.getY(l),a.z=i.getZ(l),s.x=i.getX(h),s.y=i.getY(h),s.z=i.getZ(h)}function dV(e,t,r,i,n,a,s){let o=r.index,l=r.attributes.position;for(let r=e,h=t+e;r<h;r++)if(vc(s,3*r,o,l),s.needsUpdate=!0,i(s,r,n,a))return!0;return!1}var m1=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function af(e,t){return 65535===t[e+15]}function Kg(e,t){return t[e+6]}function g1(e,t){return t[e+14]}function v1(e){return e+8}function y1(e,t){return t[e+6]}function Dve(e,t){return t[e+7]}var b1=new Vt,nP=new F,y1t=["x","y","z"];function iP(e,t,r,i,n){let a=2*e,s=x1,o=Ap,l=Rp;if(af(a,o)){Ive(t,r,i,Kg(e,l),g1(a,o),n)}else{let a=v1(e);aP(a,s,i,nP)&&iP(a,t,r,i,n);let o=y1(e,l);aP(o,s,i,nP)&&iP(o,t,r,i,n)}}function sP(e,t,r,i){let n=2*e,a=x1,s=Ap,o=Rp;if(af(n,s)){return Ove(t,r,i,Kg(e,o),g1(n,s))}{let n,s,l=Dve(e,o),h=y1t[l],c=i.direction[h]>=0;c?(n=v1(e),s=y1(e,o)):(n=y1(e,o),s=v1(e));let u=aP(n,a,i,nP)?sP(n,t,r,i):null;if(u){let e=u.point[h];if(c?e<=a[s+l]:e>=a[s+l+3])return u}let d=aP(s,a,i,nP)?sP(s,t,r,i):null;return u&&d?u.distance<=d.distance?u:d:u||d||null}}var Lve=function(){let e,t,r=[],i=new m1((()=>new Vt));return function(...a){e=i.getPrimitive(),t=i.getPrimitive(),r.push(e,t);let s=n(...a);i.releasePrimitive(e),i.releasePrimitive(t),r.pop(),r.pop();let o=r.length;return o>0&&(t=r[o-1],e=r[o-2]),s};function n(r,i,a,s,o=null,l=0,h=0){function c(e){let t=2*e,r=Ap,i=Rp;for(;!af(t,r);)t=2*(e=v1(e));return Kg(e,i)}function u(e){let t=2*e,r=Ap,i=Rp;for(;!af(t,r);)t=2*(e=y1(e,i));return Kg(e,i)+g1(t,r)}let d=2*r,p=x1,f=Ap,m=Rp;if(af(d,f)){let t=Kg(r,m),i=g1(d,f);return gc(r,p,e),s(t,i,!1,h,l+r,e)}{let d,g,v,y,b=v1(r),x=y1(r,m),_=b,w=x;if(o&&(v=e,y=t,gc(_,p,v),gc(w,p,y),d=o(v),g=o(y),g<d)){_=x,w=b;let e=d;d=g,g=e,v=y}v||(v=e,gc(_,p,v));let S,T=a(v,af(2*_,f),d,h+1,l+_);if(2===T){let e=c(_);S=s(e,u(_)-e,!0,h+1,l+_,v)}else S=T&&n(_,i,a,s,o,l,h+1);if(S)return!0;y=t,gc(w,p,y);let M,E=a(y,af(2*w,f),g,h+1,l+w);if(2===E){let e=c(w);M=s(e,u(w)-e,!0,h+1,l+w,y)}else M=E&&n(w,i,a,s,o,l,h+1);return!!M}}}(),kve=function(){let e=new Jo,t=new Jo,r=new lt,i=new Qo,n=new Qo;return function a(s,o,l,h,c=null){let u=2*s,d=x1,p=Ap,f=Rp;if(null===c&&(l.boundingBox||l.computeBoundingBox(),i.set(l.boundingBox.min,l.boundingBox.max,h),c=i),!af(u,p)){let e=s+8,t=f[s+6];return gc(e,d,b1),!!(c.intersectsBox(b1)&&a(e,o,l,h,c)||(gc(t,d,b1),c.intersectsBox(b1)&&a(t,o,l,h,c)))}{let i=o,a=i.index,c=i.attributes.position,m=l.index,g=l.attributes.position,v=Kg(s,f),y=g1(u,p);if(r.copy(h).invert(),l.boundsTree)return gc(s,d,n),n.matrix.copy(r),n.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:e=>n.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(h),e.b.applyMatrix4(h),e.c.applyMatrix4(h),e.needsUpdate=!0;for(let r=3*v,i=3*(y+v);r<i;r+=3)if(vc(t,r,a,c),t.needsUpdate=!0,e.intersectsTriangle(t))return!0;return!1}});for(let i=3*v,n=y+3*v;i<n;i+=3){vc(e,i,a,c),e.a.applyMatrix4(r),e.b.applyMatrix4(r),e.c.applyMatrix4(r),e.needsUpdate=!0;for(let r=0,i=m.count;r<i;r+=3)if(vc(t,r,m,g),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}}}();function aP(e,t,r,i){return gc(e,t,b1),r.intersectBox(b1,i)}var fV=[],rP,x1,Ap,Rp;function E1(e){rP&&fV.push(rP),rP=e,x1=new Float32Array(e),Ap=new Uint16Array(e),Rp=new Uint32Array(e)}function $_(){rP=null,x1=null,Ap=null,Rp=null,fV.length&&E1(fV.pop())}var pV=Symbol("skip tree generation"),mV=new Vt,gV=new Vt,_1=new lt,Jg=new Qo,Z_=new Qo,K_=new F,oP=new F,b1t=new F,x1t=new F,E1t=new F,Fve=new Vt,Rh=new m1((()=>new Jo)),bu=class{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),bu.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});t=on({cloneBuffers:!0},t);let r,i=e.geometry,n=e._roots,a=i.getIndex();return r=t.cloneBuffers?{roots:n.map((e=>e.slice())),index:a.array.slice()}:{roots:n,index:a.array},r}static deserialize(e,t,r={}){if("boolean"==typeof r)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),bu.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});r=on({setIndex:!0},r);let{index:i,roots:n}=e,a=new bu(t,Ii(on({},r),{[pV]:!0}));if(a._roots=n,r.setIndex){let r=t.getIndex();if(null===r){let r=new fr(e.index,1,!1);t.setIndex(r)}else r.array!==i&&(r.array.set(i),r.needsUpdate=!0)}return a}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[pV]:!1},t)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[pV]||(this._roots=Sve(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Vt))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let t,r,i,n,a=this.geometry,s=a.index.array,o=a.attributes.position,l=0,h=this._roots;for(let e=0,a=h.length;e<a;e++)t=h[e],r=new Uint32Array(t),i=new Uint16Array(t),n=new Float32Array(t),c(0,l),l+=t.byteLength;function c(t,a,l=!1){let h=2*t;if(65535===i[h+15]){let e=r[t+6],a=1/0,l=1/0,c=1/0,u=-1/0,d=-1/0,p=-1/0;for(let t=3*e,r=3*(e+i[h+14]);t<r;t++){let e=s[t],r=o.getX(e),i=o.getY(e),n=o.getZ(e);r<a&&(a=r),r>u&&(u=r),i<l&&(l=i),i>d&&(d=i),n<c&&(c=n),n>p&&(p=n)}return(n[t+0]!==a||n[t+1]!==l||n[t+2]!==c||n[t+3]!==u||n[t+4]!==d||n[t+5]!==p)&&(n[t+0]=a,n[t+1]=l,n[t+2]=c,n[t+3]=u,n[t+4]=d,n[t+5]=p,!0)}{let i=t+8,s=r[t+6],o=i+a,h=s+a,u=l,d=!1,p=!1;e?u||(d=e.has(o),p=e.has(h),u=!d&&!p):(d=!0,p=!0);let f=u||p,m=!1;(u||d)&&(m=c(i,a,u));let g=!1;f&&(g=c(s,a,u));let v=m||g;if(v)for(let e=0;e<3;e++){let r=i+e,a=s+e,o=n[r],l=n[r+3],h=n[a],c=n[a+3];n[t+e]=o<h?o:h,n[t+e+3]=l>c?l:c}return v}}}traverse(e,t=0){let r=this._roots[t],i=new Uint32Array(r),n=new Uint16Array(r);!function t(a,s=0){let o=2*a,l=65535===n[o+15];if(l){let t=i[a+6],h=n[o+14];e(s,l,new Float32Array(r,4*a,6),t,h)}else{let n=a+8,o=i[a+6],h=i[a+7];e(s,l,new Float32Array(r,4*a,6),h)||(t(n,s+1),t(o,s+1))}}(0)}raycast(e,t=zi){let r=this._roots,i=this.geometry,n=[],a=t.isMaterial,s=Array.isArray(t),o=i.groups,l=a?t.side:t;for(let a=0,h=r.length;a<h;a++){let h=s?t[o[a].materialIndex].side:l,c=n.length;if(E1(r[a]),iP(0,i,h,e,n),$_(),s){let e=o[a].materialIndex;for(let t=c,r=n.length;t<r;t++)n[t].face.materialIndex=e}}return n}raycastFirst(e,t=zi){let r=this._roots,i=this.geometry,n=t.isMaterial,a=Array.isArray(t),s=null,o=i.groups,l=n?t.side:t;for(let n=0,h=r.length;n<h;n++){let h=a?t[o[n].materialIndex].side:l;E1(r[n]);let c=sP(0,i,h,e);$_(),null!=c&&(null==s||c.distance<s.distance)&&(s=c,a&&(c.face.materialIndex=o[n].materialIndex))}return s}intersectsGeometry(e,t){let r=this.geometry,i=!1;for(let n of this._roots)if(E1(n),i=kve(0,r,e,t),$_(),i)break;return i}shapecast(e,t,r){let i=this.geometry;if(e instanceof Function){if(t){let e=t;t=(t,r,i,n)=>{let a=3*r;return e(t,a,a+1,a+2,i,n)}}e={boundsTraverseOrder:r,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let n=Rh.getPrimitive(),{boundsTraverseOrder:a,intersectsBounds:s,intersectsRange:o,intersectsTriangle:l}=e;if(o&&l){let e=o;o=(t,r,a,s,o)=>!!e(t,r,a,s,o)||dV(t,r,i,l,a,s,n)}else o||(o=l?(e,t,r,a)=>dV(e,t,i,l,r,a,n):(e,t,r)=>r);let h=!1,c=0;for(let e of this._roots){if(E1(e),h=Lve(0,i,s,o,a,c),$_(),h)break;c+=e.byteLength}return Rh.releasePrimitive(n),h}bvhcast(e,t,r){let{intersectsRanges:i,intersectsTriangles:n}=r,a=this.geometry.index,s=this.geometry.attributes.position,o=e.geometry.index,l=e.geometry.attributes.position;_1.copy(t).invert();let h=Rh.getPrimitive(),c=Rh.getPrimitive();if(n){let e=function(e,r,i,u,d,p,f,m){for(let g=i,v=i+u;g<v;g++){vc(c,3*g,o,l),c.a.applyMatrix4(t),c.b.applyMatrix4(t),c.c.applyMatrix4(t),c.needsUpdate=!0;for(let t=e,i=e+r;t<i;t++)if(vc(h,3*t,a,s),h.needsUpdate=!0,n(h,c,t,g,d,p,f,m))return!0}return!1};if(i){let t=i;i=function(r,i,n,a,s,o,l,h){return!!t(r,i,n,a,s,o,l,h)||e(r,i,n,a,s,o,l,h)}}else i=e}e.getBoundingBox(gV),gV.applyMatrix4(t);let u=this.shapecast({intersectsBounds:e=>gV.intersectsBox(e),intersectsRange:(t,r,n,a,s,o)=>(mV.copy(o),mV.applyMatrix4(_1),e.shapecast({intersectsBounds:e=>mV.intersectsBox(e),intersectsRange:(e,n,o,l,h)=>i(t,r,e,n,a,s,l,h)}))});return Rh.releasePrimitive(h),Rh.releasePrimitive(c),u}intersectsBox(e,t){return Jg.set(e.min,e.max,t),Jg.needsUpdate=!0,this.shapecast({intersectsBounds:e=>Jg.intersectsBox(e),intersectsTriangle:e=>Jg.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,r={},i={},n=0,a=1/0){e.boundingBox||e.computeBoundingBox(),Jg.set(e.boundingBox.min,e.boundingBox.max,t),Jg.needsUpdate=!0;let s=this.geometry,o=s.attributes.position,l=s.index,h=e.attributes.position,c=e.index,u=Rh.getPrimitive(),d=Rh.getPrimitive(),p=oP,f=b1t,m=null,g=null;i&&(m=x1t,g=E1t);let v=1/0,y=null,b=null;return _1.copy(t).invert(),Z_.matrix.copy(_1),this.shapecast({boundsTraverseOrder:e=>Jg.distanceToBox(e),intersectsBounds:(e,t,r)=>r<v&&r<a&&(t&&(Z_.min.copy(e.min),Z_.max.copy(e.max),Z_.needsUpdate=!0),!0),intersectsRange:(r,i)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:e=>Z_.distanceToBox(e),intersectsBounds:(e,t,r)=>r<v&&r<a,intersectsRange:(e,a)=>{for(let s=3*e,x=3*(e+a);s<x;s+=3){vc(d,s,c,h),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let e=3*r,t=3*(r+i);e<t;e+=3){vc(u,e,l,o),u.needsUpdate=!0;let t=u.distanceToTriangle(d,p,m);if(t<v&&(f.copy(p),g&&g.copy(m),v=t,y=e/3,b=s/3),t<n)return!0}}}});for(let e=0,a=c?c.count:h.count;e<a;e+=3){vc(d,e,c,h),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let t=3*r,a=3*(r+i);t<a;t+=3){vc(u,t,l,o),u.needsUpdate=!0;let r=u.distanceToTriangle(d,p,m);if(r<v&&(f.copy(p),g&&g.copy(m),v=r,y=t/3,b=e/3),r<n)return!0}}}}),Rh.releasePrimitive(u),Rh.releasePrimitive(d),v===1/0?null:(r.point?r.point.copy(f):r.point=f.clone(),r.distance=v,r.faceIndex=y,i&&(i.point?i.point.copy(g):i.point=g.clone(),i.point.applyMatrix4(_1),f.applyMatrix4(_1),i.distance=f.sub(i.point).length(),i.faceIndex=b),r)}closestPointToPoint(e,t={},r=0,i=1/0){let n=r*r,a=i*i,s=1/0,o=null;if(this.shapecast({boundsTraverseOrder:t=>(K_.copy(e).clamp(t.min,t.max),K_.distanceToSquared(e)),intersectsBounds:(e,t,r)=>r<s&&r<a,intersectsTriangle:(t,r)=>{t.closestPointToPoint(e,K_);let i=e.distanceToSquared(K_);return i<s&&(oP.copy(K_),s=i,o=r),i<n}}),s===1/0)return null;let l=Math.sqrt(s);return t.point?t.point.copy(oP):t.point=oP.clone(),t.distance=l,t.faceIndex=o,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach((t=>{gc(0,new Float32Array(t),Fve),e.union(Fve)})),e}},vV=new Za,Bve=new lt,_1t=Ht.prototype.raycast;function yV(e,t){if(this.geometry.boundsTree){if(void 0===this.material)return;Bve.copy(this.matrixWorld).invert(),vV.copy(e.ray).applyMatrix4(Bve);let r=this.geometry.boundsTree;if(!0===e.firstHitOnly){let i=hV(r.raycastFirst(vV,this.material),this,e);i&&t.push(i)}else{let i=r.raycast(vV,this.material);for(let r=0,n=i.length;r<n;r++){let n=hV(i[r],this,e);n&&t.push(n)}}}else _1t.call(this,e,t)}var Nve=new lt,T1=new Za,bV=new Sn,Cp=new F,Pp=new F,Ip=new F,xV=new F,EV=new F,_V=new F,lP=new F,cP=new F,uP=new F,hP=new Te,dP=new Te,fP=new Te,TV=new F,pP=new F;function T1t(e,t,r,i,n,a,s,o){let l;if(l=t.side===ws?i.intersectTriangle(s,a,n,!0,o):i.intersectTriangle(n,a,s,t.side!==ln,o),null===l)return null;pP.copy(o),pP.applyMatrix4(e.matrixWorld);let h=r.ray.origin.distanceTo(pP);return h<r.near||h>r.far?null:{distance:h,point:pP.clone(),object:e}}function mP(e,t,r,i,n,a,s,o,l,h,c,u){Cp.fromBufferAttribute(n,h),Pp.fromBufferAttribute(n,c),Ip.fromBufferAttribute(n,u);let d=e.morphTargetInfluences;if(a&&d){lP.set(0,0,0),cP.set(0,0,0),uP.set(0,0,0);for(let e=0,t=a.length;e<t;e++){let t=d[e],r=a[e];0!==t&&(xV.fromBufferAttribute(r,h),EV.fromBufferAttribute(r,c),_V.fromBufferAttribute(r,u),s?(lP.addScaledVector(xV,t),cP.addScaledVector(EV,t),uP.addScaledVector(_V,t)):(lP.addScaledVector(xV.sub(Cp),t),cP.addScaledVector(EV.sub(Pp),t),uP.addScaledVector(_V.sub(Ip),t)))}Cp.add(lP),Pp.add(cP),Ip.add(uP)}e.isSkinnedMesh&&(e.boneTransform(h,Cp),e.boneTransform(c,Pp),e.boneTransform(u,Ip));let p=T1t(e,t,r,i,Cp,Pp,Ip,TV);if(p){o&&(hP.fromBufferAttribute(o,h),dP.fromBufferAttribute(o,c),fP.fromBufferAttribute(o,u),p.uv=yi.getUV(TV,Cp,Pp,Ip,hP,dP,fP,new Te)),l&&(hP.fromBufferAttribute(l,h),dP.fromBufferAttribute(l,c),fP.fromBufferAttribute(l,u),p.uv2=yi.getUV(TV,Cp,Pp,Ip,hP,dP,fP,new Te));let e={a:h,b:c,c:u,normal:new F,materialIndex:0};yi.getNormal(Cp,Pp,Ip,e.normal),p.face=e}return p}Ht.prototype.raycast=function(e,t){let r=this.geometry,i=this.material,n=this.matrixWorld;if(void 0===i||(null===r.boundingSphere&&r.computeBoundingSphere(),bV.copy(r.boundingSphere),bV.applyMatrix4(n),!1===e.ray.intersectsSphere(bV))||(Nve.copy(n).invert(),T1.copy(e.ray).applyMatrix4(Nve),null!==r.boundingBox&&!1===T1.intersectsBox(r.boundingBox)))return;let a,s=r.index,o=r.attributes.position,l=r.morphAttributes.position,h=r.morphTargetsRelative,c=r.attributes.uv,u=r.attributes.uv2,d=r.groups,p=r.drawRange;if(null!==s)if(Array.isArray(i))for(let r=0,n=d.length;r<n;r++){let n=d[r],f=i[n.materialIndex];for(let r=Math.max(n.start,p.start),i=Math.min(s.count,Math.min(n.start+n.count,p.start+p.count));r<i;r+=3){let i=s.getX(r),d=s.getX(r+1),p=s.getX(r+2);a=mP(this,f,e,T1,o,l,h,c,u,i,d,p),a&&(a.faceIndex=Math.floor(r/3),a.face.materialIndex=n.materialIndex,t.push(a))}}else{for(let r=Math.max(0,p.start),n=Math.min(s.count,p.start+p.count);r<n;r+=3){let n=s.getX(r),d=s.getX(r+1),p=s.getX(r+2);a=mP(this,i,e,T1,o,l,h,c,u,n,d,p),a&&(a.faceIndex=Math.floor(r/3),t.push(a))}}else if(void 0!==o)if(Array.isArray(i))for(let r=0,n=d.length;r<n;r++){let n=d[r],s=i[n.materialIndex];for(let r=Math.max(n.start,p.start),i=Math.min(o.count,Math.min(n.start+n.count,p.start+p.count));r<i;r+=3){a=mP(this,s,e,T1,o,l,h,c,u,r,r+1,r+2),a&&(a.faceIndex=Math.floor(r/3),a.face.materialIndex=n.materialIndex,t.push(a))}}else{for(let r=Math.max(0,p.start),n=Math.min(o.count,p.start+p.count);r<n;r+=3){a=mP(this,i,e,T1,o,l,h,c,u,r,r+1,r+2),a&&(a.faceIndex=Math.floor(r/3),t.push(a))}}},Ht.prototype.raycast=yV;var gP=new Sn,vP=new F;function Uve(e,t,r,i,n,a){let s=i.ray.distanceSqToPoint(e);if(s<r){let r=new F;i.ray.closestPointToPoint(e,r);let o=i.ray.origin.distanceTo(r);if(o<i.near||o>i.far)return;n.push({distance:o,distanceToRay:Math.sqrt(s),point:r,index:t,face:null,object:a})}}Di.prototype.raycast=function(e,t){let r=this.geometry,i=this.matrixWorld,n=e.params.Points.threshold,a=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),gP.copy(r.boundingSphere),gP.applyMatrix4(i),gP.radius+=n,!1===e.ray.intersectsSphere(gP))return;let s=n*n,o=r.index,l=r.attributes.position,h=t.length;if(null!==o){for(let r=Math.max(0,a.start),n=Math.min(o.count,a.start+a.count);r<n;r++){let n=o.getX(r);if(vP.fromBufferAttribute(l,n).applyMatrix4(i),Uve(vP,n,s,e,t,this),t.length-h>=1)return}}else{for(let r=Math.max(0,a.start),n=Math.min(l.count,a.start+a.count);r<n;r++)if(vP.fromBufferAttribute(l,r).applyMatrix4(i),Uve(vP,r,s,e,t,this),t.length-h>=1)return}};var Hve='\n    // When an object is transparent, we\'ll change its alpha value,\n    // but we should not assign a fixed value because it may already\n    // has an alpha value that is lower than 1.\n    // So, let\'s multiply a factor.\n    // const float TRANSPARENT_FACTOR = 0.5;\n    // Object color when isolated.\n    // const vec4 ISOLATE_COLOR = vec4(0.5, 0.5, 0.5, 0.2);\n    const vec4 HIGHLIGHT_COLOR = vec4(0.031, 0.906, 0.867, 0.5); // 0x08e8de\n\n    // a value between 1-2, a bigger value results in more significant effect\n    const float HOVER_FACTOR = 1.2;\n\n    // need to make sure the value is the same as in StateType enum.\n    const int StateType_Hidden = 0;\n    const int StateType_Transparent = 1;\n    const int StateType_Highlighted = 2;\n    const int StateType_Hovered = 3;\n\n    /**\n     * Converts a tileObjectId(tilesetId + userId) to color.\n     */\n    vec4 tileObjectId2Color(int id) {\n        int r = id >> 16 & 0xff;\n        int g = id >> 8 & 0xff;\n        int b = id >> 0 & 0xff;\n        int a = id >> 24 & 0xff;\n        return vec4(float(r) / 255.0, float(g) / 255.0, float(b) / 255.0, float(a) / 255.0);\n    }\n\n    // /**\n    //  * Gets tilesetId and userId from a color.\n    //  * (rgb, a) => (userId, tilesetId)\n    //  */\n    // vec2 color2Id(vec4 color) {\n    //     int userId = (int(color.r) << 16) + (int(color.g) << 8)  + (int(color.b) << 0);\n    //     int tilesetId = (int(color.a) << 24);\n    //     return vec2(userId, tilesetId);\n    // }\n\n    /**\n     * Gets userId by tileObjectId.\n     */\n    int tileObjectId2UserId(int tileObjectId) {\n        return tileObjectId & 0x00ffffff;\n    }\n\n    /**\n     * Gets texture color (which contains hidden/transparent/highlight status) form a userId\n     */\n    vec4 getTextureColorByTileObjectId(sampler2D sampler, float textureWidth, float textureHeight, int tileObjectId) {\n        float userId = float(tileObjectId2UserId(tileObjectId));\n        float indexX = mod(userId, textureWidth);\n        float indexY = floor(userId / textureWidth);\n        vec2 texCoord = vec2(indexX / textureWidth, indexY / textureHeight);\n        return texture2D(sampler, texCoord);\n    }\n\n    /**\n     * Gets the flag(0 or 1) from a number by given StateType.\n     * @param num A uint8 number.\n     */\n    bool getFlagByStateType(int num, int state) {\n        // the bit index is the state itself\n        int bitIdx = state;\n        return (num & (0x1 << bitIdx)) != 0;\n    }\n\n    /**\n     * Flags(Hidden/Transparent/Hovered/Highlighted) are in textureColor.r value.\n     */\n    bool getFlagByColor(vec4 textureColor, int state) {\n        // map a color value from 0-1 to range 0-255\n        int num = int(textureColor.r * 255.0);\n        return getFlagByStateType(num, state);\n    }\n\n    /**\n     * Checks if an object is hidden by transparent cloned mesh.\n     */\n    bool isTransparentHidden(vec4 textureColor) {\n        int num = int(textureColor.b * 255.0);\n        return getFlagByStateType(num, StateType_Hidden);\n    }\n\n    /**\n     * Checks if an object is hidden by the "color".\n     */\n    bool isHidden(vec4 textureColor) {\n        return getFlagByColor(textureColor, StateType_Hidden);\n    }\n\n    /**\n     * Checks if an object is transparent by the "color".\n     */\n    bool isTransparent(vec4 textureColor) {\n        return getFlagByColor(textureColor, StateType_Transparent);\n    }\n\n    /**\n     * Gets opacity value between 0-1.\n     */\n    lowp float getOpacity(vec4 textureColor) {\n        return textureColor.g;\n    }\n\n    /**\n     * Checks if an object is hovered by the "color".\n     */\n    bool isHovered(vec4 textureColor) {\n        return getFlagByColor(textureColor, StateType_Hovered);\n    }\n\n    // bool isIsolated(vec4 textureColor) {\n    //     return textureColor.b > 0.5;\n    // }\n\n    /**\n     * Checks if an object is highlighted by the "color".\n     */\n    bool isHighlighted(vec4 textureColor) {\n        return getFlagByColor(textureColor, StateType_Highlighted);\n    }\n\n    /**\n     * Changes a color value by some means. Here, we either multiply or devide a HOVER_FACTOR.\n     */\n    float getChangedValueForHoverEffect(float val) {\n        return (val < 0.5) ? (val * HOVER_FACTOR) : (val / HOVER_FACTOR);\n    }\n\n    /**\n     * Gets hovered color by original color.\n     */\n    vec4 getHoveredColor(vec4 color) {\n        color.r = getChangedValueForHoverEffect(color.r);\n        color.g = getChangedValueForHoverEffect(color.g);\n        color.b = getChangedValueForHoverEffect(color.b);\n        return color;\n    }\n\n    // TODO: isHighlighted isOverride isHovered\n',Vve="\n    attribute int tileObjectId;\n    flat varying int vTileObjectId;\n",zve="\n    vTileObjectId = tileObjectId;\n",Gve="\n    #ifdef USE_BC_OUTLINE\n        // Restore barycentric coordinates\n        int barycentricX = int(barycentric) & 0x1;\n        int barycentricY = int(barycentric) & 0x2;\n        int barycentricZ = int(barycentric) & 0x4;\n        vBarycentric = vec3(float(barycentricX), float(barycentricY), float(barycentricZ));\n    #endif\n",qve="\n        #ifdef USE_BC_OUTLINE\n            vec3 finWireframeColor = outlineColor;\n            vec3 tempColor = gl_FragColor.rgb;\n\n            gl_FragColor.rgb = mix(finWireframeColor, tempColor, edgeFactor3());\n        #endif\n",jve="\n    #ifdef USE_BC_OUTLINE\n        varying vec3 vBarycentric;\n        uniform vec3 outlineColor;\n\n        float edgeFactor3() {\n            vec3 d = fwidth(vBarycentric);\n            float minValue = 0.0000001;\n            // make sure d is not 0\n            d = clamp(d, vec3(minValue), vec3(10.0));\n            vec3 a3 = smoothstep(vec3(0.0), d * 0.8, vBarycentric);\n            return min(min(a3.x, a3.y), a3.z);\n        }\n    #endif\n",Wve="\n    #ifdef USE_BC_OUTLINE \n        attribute float barycentric;\n        varying vec3 vBarycentric;\n    #endif\n",Xve="\n    vec4 textureColor = getTextureColorByTileObjectId(uStateTexture, uTextureWidth, uTextureHeight, vTileObjectId);\n    // if (uHoverId == tileObjectId) {\n    //     gl_FragColor = uHoverColor;\n    // }\n    // if(uIsIsolating) {\n    //     // hide others\n    //     if (!isIsolated(textureColor)) {\n    //         // transparent others\n    //         if (uTransparentOthersForIsolation) {\n    //             gl_FragColor = vec4(0.9, 0.9, 0.9, 0.3);\n    //         } else {\n    //             // hide others when isolating.\n    //             discard;\n    //         }\n    //     }\n    // } else {\n        // TODO: Status priority and mutual exclusion\n        if (isHidden(textureColor)) {\n            discard;\n        }\n        // If entity is transparent just discard, draw in transparent material\n        if (isTransparent(textureColor)) {\n            discard;\n        }\n        if (isHighlighted(textureColor)) {\n            discard;\n        }\n        if (isHovered(textureColor)) {\n            gl_FragColor = getHoveredColor(diffuseColor);\n            return;\n        }\n        // TODO:custom color\n        // if (isOverride(textureColor)) {\n        //     gl_FragColor = vec4(0.5, 0.5, 0.5, 0.8);\n        // }\n    // }\n",Yve="\n    vec4 textureColor = getTextureColorByTileObjectId(uStateTexture, uTextureWidth, uTextureHeight, vTileObjectId);\n    // State priority (high to low):\n    // - Hidden\n    // - Transparent\n    // - Highlighted: A transparent object should not highlighted in the same time!\n    // - Hovered\n    if (isHidden(textureColor)) {\n        discard;\n    } else if (isTransparent(textureColor)) {\n        lowp float opacity = getOpacity(textureColor);\n        diffuseColor.a *= opacity;\n        gl_FragColor = diffuseColor;\n        return;\n    } else if (isHighlighted(textureColor)) {\n        gl_FragColor = HIGHLIGHT_COLOR;\n        return;\n    }\n",$ve="\n    flat varying int vTileObjectId;\n    uniform float uTextureWidth;\n    uniform float uTextureHeight;\n    uniform sampler2D uStateTexture;\n    // uniform vec4 uHoverColor;\n    // uniform int uHoverId;\n    // uniform bool uIsIsolating;\n    // uniform bool uTransparentOthersForIsolation;\n",Zve="\n    vec4 textureColor = getTextureColorByTileObjectId(uStateTexture, uTextureWidth, uTextureHeight, vTileObjectId);\n    // State priority (high to low):\n    // - Hidden\n    // - Transparent\n    // - Highlighted: A transparent object should not highlighted in the same time!\n    // - Hovered\n    if (isTransparentHidden(textureColor)) {\n        discard;\n    } else if (isTransparent(textureColor)) {\n        lowp float opacity = getOpacity(textureColor);\n        diffuseColor.a *= opacity;\n        gl_FragColor = diffuseColor;\n        return;\n    } else if (isHighlighted(textureColor)) {\n        gl_FragColor = HIGHLIGHT_COLOR;\n        return;\n    }\n",yP="\n    #include <clipping_planes_pars_vertex>\n\n    attribute int tileObjectId;\n    flat varying int vTileObjectId;\n    #include <common_ex>\n    void main() {\n\n        vec4 mvPosition = vec4(position, 1.0);\n        #include <clipping_planes_vertex>\n        vTileObjectId = tileObjectId;\n\n        #ifdef USE_INSTANCING\n            mvPosition = instanceMatrix * mvPosition;\n        #endif\n        gl_Position = projectionMatrix * modelViewMatrix * mvPosition;\n    }\n",bP="\n    #include <clipping_planes_pars_fragment>\n\n    flat varying int vTileObjectId;\n    uniform sampler2D uStateTexture;\n    uniform float uTextureWidth;\n    uniform float uTextureHeight;\n    // uniform bool uIsIsolating;\n    #include <common_ex>\n    void main() {\n        #include <clipping_planes_fragment>\n        vec4 textureColor = getTextureColorByTileObjectId(uStateTexture, uTextureWidth, uTextureHeight, vTileObjectId);\n        // If is isolating, other objects(which is hidden or transparent) are not pickable.\n        // if (uIsIsolating && !isIsolated(textureColor)) {\n        //     discard;\n        // }\n        // if an object is hidden, it is not pickable\n        if (isHidden(textureColor)) {\n            discard;\n        }\n        // if an object is transparent, it is not pickable\n        if (isTransparent(textureColor)) {\n            discard;\n        }\n\n        gl_FragColor = tileObjectId2Color(vTileObjectId);\n    }\n",wV="\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifdef USE_TRANSMISSION\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n#include <outline_bc_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\n    #include <outline_bc_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n#ifdef USE_TRANSMISSION\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif\n}\n",SV="\n#define STANDARD\n\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef IOR\n\tuniform float ior;\n#endif\n\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\n\nvarying vec3 vViewPosition;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n#include <outline_bc_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4(diffuse, opacity);\n\tReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\n\t#include <transmission_fragment>\n\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\n\t#ifdef USE_SHEEN\n\n\t\t// Sheen energy compensation approximation calculation can be found at the end of\n\t\t// https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3(material.sheenColor);\n\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT\n\n\t\tfloat dotNVcc = saturate(dot(geometry.clearcoatNormal, geometry.viewDir));\n\n\t\tvec3 Fcc = F_Schlick(material.clearcoatF0, material.clearcoatF90, dotNVcc);\n\n\t\toutgoingLight = outgoingLight * (1.0 - material.clearcoat * Fcc) + clearcoatSpecular * material.clearcoat;\n\n\t#endif\n\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n    #include <outline_bc_fragment>\n}\n";zr.outline_bc_vertex=Gve,zr.outline_bc_fragment=qve,zr.outline_bc_pars_fragment=jve,zr.outline_bc_pars_vertex=Wve,zr.standard_ex_vertex=wV,zr.standard_ex_fragment=SV,zr.common_ex=Hve,zr.id_pars_vertex=Vve,zr.id_vertex=zve,zr.state_pars_fragment=$ve,zr.state_fragment=Xve,zr.state_transparent_fragment=Zve,zr.state_highlight_fragment=Yve,zr.pick_ex_vertex=yP,zr.pick_ex_fragment=bP;var Qve=class{constructor(e){let t=new Promise(((e,t)=>{this.cancelReject=t}));this.promise=Promise.race([t,e])}cancel(){this.cancelReject&&this.cancelReject({type:"cancel"})}},w1t=ra(tye(),1),de=w1t;de.setLevel("warn");var rye=e=>{try{de.setLevel(e)}catch(e){de.setLevel("error"),de.error(e)}},MV=class{static isTouchScreenDevice(){return"ontouchstart"in window}static printDeviceInfo(){let e=navigator.userAgent,t=/(?:Android)/.test(e),r=/(?:Firefox)/.test(e),i=/(?:Chrome|CriOS)/.test(e),n=/(?:iPad|PlayBook)/.test(e)||t&&!/(?:Mobile)/.test(e)||r&&/(?:Tablet)/.test(e),a=/(?:iPhone)/.test(e)&&!n,s=!a&&!t,o=MV.isTouchScreenDevice();t&&de.debug("[DI] is android"),r&&de.debug("[DI] is fireFox"),i&&de.debug("[DI] is chrome"),n&&de.debug("[DI] is tablet"),a&&de.debug("[DI] is iPhone"),s&&de.debug("[DI] is PC"),o&&de.debug("[DI] is touch device")}static creatReactNativeCanvas(e){let t=e.drawingBufferWidth||e.width||0,r=e.drawingBufferHeight||e.height||0;return{style:{},width:t,height:r,clientWidth:Math.ceil(t/(window.devicePixelRatio||1)),clientHeight:Math.ceil(r/(window.devicePixelRatio||1)),addEventListener:()=>{},removeEventListener:()=>{}}}},Pn=MV;Pn.isMobile=/mobile/i.test(navigator.userAgent),Pn.isBrowser="undefined"!=typeof document,Pn.isNode="undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process);var J_=class{static isFullScreen(){return!(!document.fullscreenElement&&!document.mozFullScreenElement)}static fullScreen(e=document.documentElement){(e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen||e.msRequestFullscreen).call(e)}static exitFullscreen(){(document.exitFullscreen||document.mozCancelFullscreen||document.webkitExitFullscreen||document.msExitFullscreen).call(document)}static joinStrings(...e){return e.join("")}static numberToString(e){let t=2;return Math.abs(e)<1e-6?t=2:Math.abs(e)<1e-5?t=7:Math.abs(e)<1e-4?t=6:Math.abs(e)<.001?t=5:Math.abs(e)<.01?t=4:Math.abs(e)<.1&&(t=3),e.toFixed(t)}static byteCountToString(e){let t=e;return e>1e9?(t=e/1e9,this.numberToString(t)+" G"):e>1e6?(t=e/1e6,this.numberToString(t)+" M"):e>1e3?(t=e/1e3,this.numberToString(t)+" K"):this.numberToString(t)}static hexToBase64(e){return btoa((e.match(/\w{2}/g)||[]).map((function(e){return String.fromCharCode(parseInt(e,16))})).join(""))}static vectorToString(e){return Array.isArray(e)?`(${this.numberToString(e[0])}, ${this.numberToString(e[1])}, ${this.numberToString(e[2])})`:e instanceof F?`(${this.numberToString(e.x)}, ${this.numberToString(e.y)}, ${this.numberToString(e.z)})`:`(${this.numberToString(e.x)}, ${this.numberToString(e.y)})`}static arrayToVector2(e){return e?e instanceof Te?e:Array.isArray(e)&&e.length>=2?new Te(e[0],e[1]):void 0:e}static arrayToVector3(e){return e?e instanceof F?e:Array.isArray(e)&&e.length>=2?new F(e[0],e[1],e.length>2?e[2]:0):void 0:e}static arrayToEuler(e){return e?e instanceof tn?e:Array.isArray(e)&&e.length>=3?new tn(e[0],e[1],e[2]):void 0:e}static arrayOrObjectToVector3(e){if(!e)return e;if(e instanceof F)return e;if(e instanceof Te)return new F(e.x,e.y,0);if(Array.isArray(e)&&e.length>=2)return new F(e[0],e[1],e[2]||0);let t=e;return null!=t.x&&null!=t.y?new F(t.x,t.y,t.z||0):void 0}static isVectorValid(e){let t=e&&!isNaN(e.x)&&!isNaN(e.y)&&isFinite(e.x)&&isFinite(e.y);return t&&e instanceof F&&(t=!isNaN(e.z)&&isFinite(e.z)),t}static isBoxValid(e){return e&&!e.isEmpty()&&this.isVectorValid(e.min)&&this.isVectorValid(e.max)}static isMatrixValid(e){let t=e&&e.elements;if(!t||t.length<16)return!1;for(let e=0;e<16;++e){let r=t[e];if(Number.isNaN(r))return!1}return!0}static guid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}static expandBoxByScale(e,t){let r=new F;e.getCenter(r);let i=(e.max.x-e.min.x)*t,n=(e.max.y-e.min.y)*t,a=(e.max.z-e.min.z)*t,s=new F(r.x-i/2,r.y-n/2,r.z-a/2),o=new F(r.x+i/2,r.y+n/2,r.z+a/2);e.set(s,o)}static expandBoxByMinSize(e,t){let r=new F;e.getCenter(r);let i=e.max.x-e.min.x,n=e.max.y-e.min.y,a=e.max.z-e.min.z;i<t&&(e.min.setX(r.x-t/2),e.max.setX(r.x+t/2)),n<t&&(e.min.setY(r.y-t/2),e.max.setY(r.y+t/2)),a<t&&(e.min.setZ(r.z-t/2),e.max.setZ(r.z+t/2))}static generateRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}static roundNumber(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}static convertDecimalToHex(e){return null==e?"#ffffff":`#${e.toString(16).padStart(6,"0")}`}static canvasToImage(e){let t=e.toDataURL(),r=new Image;return r.src=t,new Promise((e=>{r.onload=function(){e(r)}}))}static renderingContextToImage(e,t,r="image/png",i=.8){if(t){let n=Math.max(t.min.x,0),a=Math.max(t.min.y,0),s=Math.max(t.max.x-n,0),o=Math.max(t.max.y-a,0),l=e.getImageData(n,a,s,o),h=document.createElement("canvas");return h.width=s,h.height=o,h.getContext("2d").putImageData(l,0,0),h.toDataURL(r,i)}return e.canvas.toDataURL(r,i)}static printMemory(e){if(!Pn.isBrowser)return;let t=performance.memory;if(!t)return void de.warn("[Util] performance.memory is not available in this browser");let r=(t.jsHeapSizeLimit/1048576).toFixed(2),i=(t.totalJSHeapSize/1048576).toFixed(2),n=(t.usedJSHeapSize/1048576).toFixed(2);de.info(`[Util] ${e}. jsHeapSizeLimit: ${r}M , totalJSHeapSize: ${i}M , usedJSHeapSize: ${n}M `)}static printGpuInfo(e){if(!Pn.isBrowser)return;let t=e.getExtension("webgl_debug_renderer_info"),r=e.getParameter(t.UNMASKED_RENDERER_WEBGL);de.info("[Util] gpu:",r)}static getExtension(e){return e.substring(e.lastIndexOf(".")+1)}static isBinaryFile(e){return"bin"===J_.getExtension(e)}static isGizp(e){return!(e.length<=3)&&(31==e[0]&&139==e[1]&&8==e[2])}static sleep(e){return bt(this,null,(function*(){let t;return new Promise((r=>{t=setTimeout((()=>{r("")}),e)})).then((()=>{clearTimeout(t)}))}))}static twinkle(e,t=500){return bt(this,null,(function*(){let r=this.twinklingObjectIds;r[e.id]||(r[e.id]=!0,e.visible=!e.visible,yield this.sleep(t),e.visible=!e.visible,yield this.sleep(t),e.visible=!e.visible,yield this.sleep(t),e.visible=!e.visible,yield this.sleep(t),e.visible=!e.visible,yield this.sleep(t),e.visible=!e.visible,delete r[e.id])}))}static getUpdateProgressFunc(e){return t=>{e&&e(new ProgressEvent("",{loaded:t,total:100}))}}static getUpdateProgressFuncAsync(e){let t=Date.now();return r=>bt(this,null,(function*(){if(e){e(new ProgressEvent("",{loaded:r,total:100}));let i=500,n=Date.now();n-t>i&&(yield J_.sleep(0),t=n)}}))}static getUpdateProgressFuncForLoop(e,t){let r=Math.round(Math.pow(e,.5)),i=Date.now();return n=>bt(this,null,(function*(){if(t&&(n%r==0||n===e-1)){t(new ProgressEvent("",{loaded:n+1,total:e}));let r=500,a=Date.now();(a-i>r||n===e-1)&&(yield J_.sleep(0),i=a)}}))}static getUpdateSubProgressFunc(e,t,r){let i=!1;return n=>{let a=100*n.loaded/n.total;a=a*(t-e)/100+e,a>t&&(i||(de.warn("[Progress] Invalid ProgressEvent:",n),i=!0),a=t),r&&r(new ProgressEvent(n.type,{loaded:a,total:100}))}}},Ut=J_;Ut.twinklingObjectIds={};var EP=(e,t,r)=>{let{default:i,active:n}=t;r?(e.remove(i),e.add(n||i)):(n&&e.remove(n),e.add(i))},Br=class{static color2rgba(e){let t,r=[0,0,0,1];if(t=/^(\w+)\(([^)]*)\)/.exec(e)){let i,n=t[1],a=t[2];switch(n){case"rgb":case"rgba":(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))&&(r=[Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,Number(i[4]||1)]),(i=/^\s*(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))&&(r=[Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,Number(i[4]||1)]);break;case"hsl":case"hsla":(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))&&(r=[parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,Number(i[4]||1)]);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(t=/^#([A-Fa-f\d]+)$/.exec(e)){let i=t[1],n=i.length;if(3===n)r=[parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,1];else if(6===n){let e=parseInt(i,16);r=[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255,1]}else console.warn("THREE.Color: Invalid hex color "+e)}return r}static rgba2Color(e){return`rgba(${this.to255(e[0])},${this.to255(e[1])},${this.to255(e[2])},${null!=e[3]?e[3]:1})`}static colorStr2Rgba(e){let t=e.replace("rgba(","");t=t.replace(")","");let r=t.split(","),i=[];return i.push(this.to1(parseInt(r[0]))),i.push(this.to1(parseInt(r[1]))),i.push(this.to1(parseInt(r[2]))),null!=r[3]&&i.push(parseFloat(r[3])),i}static rgb2Hex(e){return(this.to255(e[0])<<16)+(this.to255(e[1])<<8)+this.to255(e[2])}static to255(e){let t=Math.max(e,0);return t=Math.min(e,1),255*t}static to1(e){let t=Math.max(e,0);return t=Math.min(e,255),t/255}},Nr=class{static getScreenCoordinateByEvent(e,t){let r=new Te,{left:i,top:n}=t.getBoundingClientRect();return r.x=e.clientX-i,r.y=e.clientY-n,r}static getScreenCoordinateByTouchEvent(e,t){let r=new Te,{left:i,top:n}=t.getBoundingClientRect();return r.x=e.touches[0].clientX-i,r.y=e.touches[0].clientY-n,r}static world2Screen(e,t,r){let{clientWidth:i,clientHeight:n}=r,a=e.clone(),s=new Te;return a.project(t),s.x=Math.round((.5+a.x/2)*i),s.y=Math.round((.5-a.y/2)*n),s}static worldBBox2Screen(e,t,r){let i=new ts,n=e.min,a=e.max,s=(e,n,a)=>{let s=new F(e,n,a),o=this.world2Screen(s,t,r);i.expandByPoint(o)};return s(n.x,n.y,n.z),s(n.x,n.y,a.z),s(n.x,a.y,n.z),s(n.x,a.y,a.z),s(a.x,n.y,n.z),s(a.x,n.y,a.z),s(a.x,a.y,n.z),s(a.x,a.y,a.z),i}static screen2World(e,t,r){let i=Nr.screen2Ndc(e,t,r);return new F(i.x,i.y,1).unproject(t)}static screen2Ndc(e,t,r){let{clientWidth:i,clientHeight:n}=r,a=new Te;return a.x=e.x/i*2-1,a.y=-e.y/n*2+1,a}static world2NormalizedScreen(e,t,r){let i=new F,n=e instanceof Te?0:e.z;i.set(e.x,e.y,n);let a=Nr.world2Screen(i,t,r);return a.x/=r.clientWidth,a.y/=r.clientHeight,a}},S1=class extends yr{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Te(.5,.5),this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)}))}))}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}},w1=new F,nye=new lt,iye=new lt,sye=new F,aye=new F,M1=class{constructor(e={}){let t,r,i,n,a=this,s={objects:new WeakMap},o=void 0!==e.element?e.element:document.createElement("div");function l(e,t,r){if(e.isCSS2DObject){w1.setFromMatrixPosition(e.matrixWorld),w1.applyMatrix4(iye);let l=!0===e.visible&&w1.z>=-1&&w1.z<=1&&!0===e.layers.test(r.layers);if(e.element.style.display=!0===l?"":"none",!0===l){e.onBeforeRender(a,t,r);let s=e.element;s.style.transform="translate("+-100*e.center.x+"%,"+-100*e.center.y+"%)translate("+(w1.x*i+i)+"px,"+(-w1.y*n+n)+"px)",s.parentNode!==o&&o.appendChild(s),e.onAfterRender(a,t,r)}let c={distanceToCameraSquared:h(r,e)};s.objects.set(e,c)}for(let i=0,n=e.children.length;i<n;i++)l(e.children[i],t,r)}function h(e,t){return sye.setFromMatrixPosition(e.matrixWorld),aye.setFromMatrixPosition(t.matrixWorld),sye.distanceToSquared(aye)}o.style.overflow="hidden",this.domElement=o,this.getSize=function(){return{width:t,height:r}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),nye.copy(t.matrixWorldInverse),iye.multiplyMatrices(t.projectionMatrix,nye),l(e,e,t),function(e){let t=function(e){let t=[];return e.traverse((function(e){e.isCSS2DObject&&t.push(e)})),t}(e).sort((function(e,t){if(e.renderOrder!==t.renderOrder)return t.renderOrder-e.renderOrder;return s.objects.get(e).distanceToCameraSquared-s.objects.get(t).distanceToCameraSquared})),r=t.length;for(let e=0,i=t.length;e<i;e++)t[e].element.style.zIndex=r-e}(e)},this.setSize=function(e,a){t=e,r=a,i=t/2,n=r/2,o.style.width=e+"px",o.style.height=a+"px"}}},_P=class{static createCSS2DObject(e){let t=new S1(e);return e.dataset.objectId=t.id.toString(),t}static createDefaultHotpoint(e=12){let t=document.createElement("div"),r=t.style;return r.width=`${e}px`,r.height=`${e}px`,r.opacity="0.8",r.cursor="pointer",r.top=-e/2+"px",r.left=-e/2+"px",r.backgroundColor="#ffffff",r.border="2px solid #00DAB7",r.borderRadius="50%",this.createCSS2DObject(t)}static createHotpoint(e){if(e){let t=document.createElement("div"),r=t.style;return r.top="0px",r.left="0px",t.innerHTML=e,this.createCSS2DObject(t)}return this.createDefaultHotpoint()}static createLabel(e,t=""){let r=document.createElement("div");if(r.innerHTML=e,t)r.classList.add(t);else{let e=r.style;e.padding="5px 9px",e.color="#ffffffdd",e.fontSize="12px",e.position="absolute",e.backgroundColor="rgba(0, 0, 0, 0.3)",e.borderRadius="12px",e.cursor="pointer",e.top="0px",e.left="0px"}return this.createCSS2DObject(r)}static tryFindObjectId(e){if(null!=e.dataset.objectId)return parseInt(e.dataset.objectId);let t=e.parentElement;return!t||t instanceof HTMLBodyElement?void 0:this.tryFindObjectId(t)}},oye={"Precision from file":99,"0(1)":0,"0.1(1/2)":1,"0.01(1/4)":2,"0.001(1/8)":3,"0.0001(1/16)":4,"0.00001(1/32)":5,"0.000001(1/64)":6},Ch=(e,t)=>e.toFixed(t===oye["Precision from file"]?2:t),rs=!1,TP=10,Zs=11,Li=12,wP=583902,u7t=[.031,.906,.867,.5],Q_=[.3,.3,.3,.8],Ph=.5,SP=.1,MP=5e3,lye=45,AP="gemini-viewer-iconfont",Yi="gemini-viewer-icon",RP=10,cye=new F,uye=new F,hye=new F,eT=new F,of=new F,dye=new yi;function S1t(e,t,r,i,n){let a,s,o,l,h,c,u=[],d={},p=Math.pow(10,4),f=0;for(h=0,c=e.length;h<c;h+=3)a=e[h],s=e[h+1],o=e[h+2],l=Math.round(a*p)+"_"+Math.round(s*p)+"_"+Math.round(o*p),d[l]||(d[l]=f/3,r[f++]=a,r[f++]=s,r[f++]=o),u[h/3]=d[l];for(h=0,c=t.length;h<c;h++)n[h]=u[t[h]],i[n[h]]=t[h]}function M1t(e,t,r,i){for(let n=0,a=e;n<a;n+=3){let e=3*t[n],a=3*t[n+1],s=3*t[n+2];cye.set(r[e],r[e+1],r[e+2]),uye.set(r[a],r[a+1],r[a+2]),hye.set(r[s],r[s+1],r[s+2]),yi.getNormal(cye,uye,hye,eT),i.push({normal:eT.clone()})}}var AV=[new F(1,0,0),new F(0,1,0),new F(0,0,1),new F(1,1,0),new F(0,1,1),new F(1,0,1),new F(1,1,1),new F(0,0,0)];function A1t(e,t){return of.addVectors(e,t),0===of.x||0===of.y||0===of.z}var CP=class{static buildEdge(e,t,r=RP){let i=[],n=[],a=[];S1t(e,t,i,n,a);let s=[];M1t(t.length,a,i,s);let o,l,h,c,u,d,p,f,m,g,v=[],y=Math.cos(Tr.DEG2RAD*r),b={},x=!1;for(let e=0,r=t.length;e<r;e+=3){let t=e/3;for(let r=0;r<3;r++)o=a[e+r],l=a[e+(r+1)%3],h=Math.min(o,l),c=Math.max(o,l),u=h+","+c,void 0===b[u]?b[u]={index1:h,index2:c,face1:t,face2:void 0}:b[u].face2=t}for(u in b)d=b[u],!(void 0!==d.face2&&(p=s[d.face1].normal,f=s[d.face2].normal,p.dot(f)>y))&&(m=n[d.index1],g=n[d.index2],(!x&&m>65535||g>65535)&&(x=!0),v.push(m),v.push(g));return x?new Uint32Array(v):new Uint16Array(v)}static buildBarycentrics(e){let t=e.getAttribute("position");if(!t||0===t.count)return console.warn(" no positions in geometry!"),!1;let r=Math.pow(10,4),i=Math.cos(20*Tr.DEG2RAD),n=e.getIndex(),a=n?n.count:t.count,s=[0,0,0],o=new Array(3),l=AV.length,h=[];for(let e=0;e<t.count;e++)h.push({point:new F(1,1,1),inited:!1,barycentricIndex:-1});let c={},u={},d={},p={};for(let e=0;e<a;e+=3){n?(s[0]=n.getX(e),s[1]=n.getX(e+1),s[2]=n.getX(e+2)):(s[0]=e,s[1]=e+1,s[2]=e+2);let{a:a,b:l,c:h}=dye;if(a.fromBufferAttribute(t,s[0]),l.fromBufferAttribute(t,s[1]),h.fromBufferAttribute(t,s[2]),dye.getNormal(eT),d[s[0]]?o[0]=d[s[0]]:(o[0]=`${Math.round(a.x*r)},${Math.round(a.y*r)},${Math.round(a.z*r)}`,d[s[0]]=o[0]),d[s[1]]?o[1]=d[s[1]]:(o[1]=`${Math.round(l.x*r)},${Math.round(l.y*r)},${Math.round(l.z*r)}`,d[s[1]]=o[1]),d[s[2]]?o[2]=d[s[2]]:(o[2]=`${Math.round(h.x*r)},${Math.round(h.y*r)},${Math.round(h.z*r)}`,d[s[2]]=o[2]),o[0]===o[1]||o[1]===o[2]||o[2]===o[0]){de.warn(" skip degenerate triangles in geometry!");continue}let f={a:s[0],b:s[1],c:s[2]};u[s[0]]||(u[s[0]]=[]),u[s[0]].push(f),u[s[1]]||(u[s[1]]=[]),u[s[1]].push(f),u[s[2]]||(u[s[2]]=[]),u[s[2]].push(f);for(let e=0;e<3;e++){let t=(e+1)%3,r=o[e],n=o[t],a=s[e],l=s[t];c[a]||(c[a]=new Set),c[a].add(l),c[l]||(c[l]=new Set),c[l].add(a);let h=`${r}_${n}`,u=`${n}_${r}`;if(u in p&&p[u]){if(p[u].outer){de.warn(`[Edge] edge: ${u} is already outer!`);continue}eT.dot(p[u].normal)<=i?p[u].outer=!0:p[u].find=!0}else h in p?de.warn(`[Edge] ${h} has existed  in geometry!`):p[h]={startIndex:a,endIndex:l,normal:eT.clone(),outer:!1,find:!1}}}for(let e in p)p[e]&&!p[e].find&&!p[e].outer&&(p[e].outer=!0);let f=[],m=[];for(let e in u)m.push(u[e]);let g=new Set;for(let e of m[0])g.add(e.a),g.add(e.b),g.add(e.c);let v=0;for(m.splice(v,1);;){let e=!1;for(let t=0;t<m.length&&!e;t++)for(let r of m[t])if(g.has(r.a)||g.has(r.b)||g.has(r.c)){v=t,e=!0;break}if(e){for(let e of m[v])g.add(e.a),g.add(e.b),g.add(e.c);if(m.splice(v,1),v=0,0===m.length){f.push(g);break}}else if(!e){if(f.push(g),!(m.length>0))break;g=new Set;for(let e of m[v])g.add(e.a),g.add(e.b),g.add(e.c);m.splice(v,1),v=0}}let y=new Set;for(let e=0;e<f.length;e++)f[e].forEach((e=>{y.has(e)?de.warn(`[Edge] ${e} is already in positionIndexSet!`):y.add(e)}));let b=(e,t)=>{let r=!1,i=d[e];if(!i)return console.warn(`${e} is not in positionIndexHash!`),r;let n=d[t];if(!n)return console.warn(`${t} is not in positionIndexHash!`),r;let a=`${i}_${n}`;if(p[a])r=p[a].outer;else{let e=`${n}_${i}`;p[e]&&(r=p[e].outer)}return r},x=(e,t,r)=>{let i=[];return i.push(b(e,t)),i.push(b(t,r)),i.push(b(r,e)),i.filter((e=>!0===e)).length>=2},_=(e,t)=>{if(!c[e])return de.warn(`[Edge] ${e} position isn't used!`),!0;let r=c[e];for(let i of r){let r=b(e,i),n=h[i];if(!n.inited)continue;let a=A1t(t,n.point);if(r&&!a||!r&&a)return!1}let i=u[e];for(let r of i){let i=t,n=h[r.b],a=h[r.c];if(r.b===e?n=h[r.a]:r.c===e&&(a=h[r.a]),x(r.a,r.b,r.c)&&(n.inited&&i.equals(n.point)||a.inited&&i.equals(a.point)))return!1;if(n.inited&&a.inited&&(of.addVectors(i,n.point),of.add(a.point),of.x+of.y+of.z<2))return!1}return!0},w=!1;for(let e=0;e<f.length;e++){let t=Array.from(f[e]);w=!1;let r=0,i=0;for(;i>=0;){r=t[i];let e=h[r].inited?h[r].barycentricIndex+1:0;for(;e<l&&!_(r,AV[e]);e++);if(e<l){if(h[r].inited=!0,h[r].barycentricIndex=e,h[r].point.copy(AV[e]),i==t.length-1){w=!0,de.debug("[Edge]",h);break}i++}else h[r].inited=!1,i--}if(!w){de.warn(`[Edge] no result: ${t}!`);break}}if(w){let t=[];for(let e=0;e<h.length;e++){h[e].inited||de.warn(`[Edge] ${e} is not initialized !`);let r=0;r|=h[e].point.x,r|=h[e].point.y<<1,r|=h[e].point.z<<2,t.push(r)}let r=new S_(t,1,!1);e.setAttribute("barycentric",r)}else de.warn("[Edge] No suitable barycentric found!");return w}},ba=class{constructor(){this.map=new Map}addEventListener(e,t){let r=this.map.get(e);r||(r=new Set,this.map.set(e,r)),r.add(t)}dispatchEvent(e,t={}){let r=this.map.get(e);r&&[...r].forEach((e=>e(t)))}hasEventListener(e){return!!this.map.get(e)}removeEventListener(e,t){if(!e)return void this.map.clear();if(!t)return void this.map.delete(e);let r=this.map.get(e);r&&r.delete(t)}},to=class{parse(e,t={}){if(t=Object.assign({decodeSpeed:5,encodeSpeed:5,encoderMethod:to.MESH_EDGEBREAKER_ENCODING,quantization:[16,8,8,8,8],exportUvs:!0,exportNormals:!0,exportColor:!1},t),void 0===DracoEncoderModule)throw new Error("THREE.DRACOExporter: required the draco_encoder to work.");let r,i,n=e.geometry,a=DracoEncoderModule(),s=new a.Encoder;if(!0===e.isMesh){r=new a.MeshBuilder,i=new a.Mesh;let e=n.getAttribute("position");r.AddFloatAttributeToMesh(i,a.POSITION,e.count,e.itemSize,e.array);let s=n.getIndex();if(null!==s)r.AddFacesToMesh(i,s.count/3,s.array);else{let t=new(e.count>65535?Uint32Array:Uint16Array)(e.count);for(let e=0;e<t.length;e++)t[e]=e;r.AddFacesToMesh(i,e.count,t)}if(!0===t.exportNormals){let e=n.getAttribute("normal");void 0!==e&&r.AddFloatAttributeToMesh(i,a.NORMAL,e.count,e.itemSize,e.array)}if(!0===t.exportUvs){let e=n.getAttribute("uv");void 0!==e&&r.AddFloatAttributeToMesh(i,a.TEX_COORD,e.count,e.itemSize,e.array)}if(!0===t.exportColor){let e=n.getAttribute("color");if(void 0!==e){let t=fye(e);r.AddFloatAttributeToMesh(i,a.COLOR,e.count,e.itemSize,t)}}}else{if(!0!==e.isPoints)throw new Error("DRACOExporter: Unsupported object type.");{r=new a.PointCloudBuilder,i=new a.PointCloud;let e=n.getAttribute("position");if(r.AddFloatAttribute(i,a.POSITION,e.count,e.itemSize,e.array),!0===t.exportColor){let e=n.getAttribute("color");if(void 0!==e){let t=fye(e);r.AddFloatAttribute(i,a.COLOR,e.count,e.itemSize,t)}}}}let o,l=new a.DracoInt8Array,h=void 0!==t.encodeSpeed?t.encodeSpeed:5,c=void 0!==t.decodeSpeed?t.decodeSpeed:5;if(s.SetSpeedOptions(h,c),void 0!==t.encoderMethod&&s.SetEncodingMethod(t.encoderMethod),void 0!==t.quantization)for(let e=0;e<5;e++)void 0!==t.quantization[e]&&s.SetAttributeQuantization(e,t.quantization[e]);if(o=!0===e.isMesh?s.EncodeMeshToDracoBuffer(i,l):s.EncodePointCloudToDracoBuffer(i,!0,l),a.destroy(i),0===o)throw new Error("THREE.DRACOExporter: Draco encoding failed.");let u=new Int8Array(new ArrayBuffer(o));for(let e=0;e<o;e++)u[e]=l.GetValue(e);return a.destroy(l),a.destroy(s),a.destroy(r),u}},tT,RV,A1,PP;function fye(e){let t=new dt,r=e.count,i=e.itemSize,n=new Float32Array(r*i);for(let a=0,s=r;a<s;a++)t.fromBufferAttribute(e,a).convertLinearToSRGB(),n[a*i]=t.r,n[a*i+1]=t.g,n[a*i+2]=t.b,4===i&&(n[a*i+3]=e.getW(a));return n}function IP(e,t=1/0,r=null){RV||(RV=new vs(2,2,1,1)),A1||(A1=new xr({uniforms:{blitTexture:new jg(e)},vertexShader:"\n\t\t\tvarying vec2 vUv;\n\t\t\tvoid main(){\n\t\t\t\tvUv = uv;\n\t\t\t\tgl_Position = vec4(position.xy * 1.0,0.,.999999);\n\t\t\t}",fragmentShader:"\n\t\t\tuniform sampler2D blitTexture; \n\t\t\tvarying vec2 vUv;\n\n\t\t\tvoid main(){ \n\t\t\t\tgl_FragColor = vec4(vUv.xy, 0, 1);\n\t\t\t\t\n\t\t\t\t#ifdef IS_SRGB\n\t\t\t\tgl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );\n\t\t\t\t#else\n\t\t\t\tgl_FragColor = texture2D( blitTexture, vUv);\n\t\t\t\t#endif\n\t\t\t}"})),A1.uniforms.blitTexture.value=e,A1.defines.IS_SRGB=e.colorSpace==Zr,A1.needsUpdate=!0,PP||((PP=new Ht(RV,A1)).frustrumCulled=!1);let i=new ci,n=new Xi;n.add(PP),null===r&&(r=tT=new Ka({antialias:!1}));let a=Math.min(e.image.width,t),s=Math.min(e.image.height,t);r.setSize(a,s),r.clear(),r.render(n,i);let o=document.createElement("canvas"),l=o.getContext("2d");o.width=a,o.height=s,l.drawImage(r.domElement,0,0,a,s);let h=new Zd(o);return h.minFilter=e.minFilter,h.magFilter=e.magFilter,h.wrapS=e.wrapS,h.wrapT=e.wrapT,h.name=e.name,tT&&(tT.forceContextLoss(),tT.dispose(),tT=null),h}to.MESH_EDGEBREAKER_ENCODING=1,to.MESH_SEQUENTIAL_ENCODING=0,to.POINT_CLOUD=0,to.TRIANGULAR_MESH=1,to.INVALID=-1,to.POSITION=0,to.NORMAL=1,to.COLOR=2,to.TEX_COORD=3,to.GENERIC=4;var pye={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]},R1=class{constructor(){this.pluginCallbacks=[],this.register((function(e){return new OV(e)})),this.register((function(e){return new DV(e)})),this.register((function(e){return new FV(e)})),this.register((function(e){return new BV(e)})),this.register((function(e){return new NV(e)})),this.register((function(e){return new UV(e)})),this.register((function(e){return new LV(e)})),this.register((function(e){return new kV(e)})),this.register((function(e){return new HV(e)})),this.register((function(e){return new VV(e)})),this.register((function(e){return new zV(e)})),this.register((function(e){return new GV(e)})),this.register((function(e){return new qV(e)}))}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,i){let n=new IV,a=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)a.push(this.pluginCallbacks[e](n));n.setPlugins(a),n.write(e,t,i).catch(r)}parseAsync(e,t){let r=this;return new Promise((function(i,n){r.parse(e,i,n,t)}))}},Zn={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},CV="KHR_mesh_quantization",Pl={};Pl[ni]=Zn.NEAREST,Pl[mh]=Zn.NEAREST_MIPMAP_NEAREST,Pl[hu]=Zn.NEAREST_MIPMAP_LINEAR,Pl[wn]=Zn.LINEAR,Pl[rf]=Zn.LINEAR_MIPMAP_NEAREST,Pl[ia]=Zn.LINEAR_MIPMAP_LINEAR,Pl[pi]=Zn.CLAMP_TO_EDGE,Pl[ui]=Zn.REPEAT,Pl[fu]=Zn.MIRRORED_REPEAT;var mye={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},R1t=new dt,gye=12,C1t=1179937895,P1t=2,vye=8,I1t=1313821514,O1t=5130562;function rT(e,t){return e.length===t.length&&e.every((function(e,r){return e===t[r]}))}function D1t(e){return(new TextEncoder).encode(e).buffer}function L1t(e){return rT(e.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function k1t(e,t,r){let i={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let n=t;n<t+r;n++)for(let t=0;t<e.itemSize;t++){let r;e.itemSize>4?r=e.array[n*e.itemSize+t]:(0===t?r=e.getX(n):1===t?r=e.getY(n):2===t?r=e.getZ(n):3===t&&(r=e.getW(n)),!0===e.normalized&&(r=Tr.normalize(r,e.array))),i.min[t]=Math.min(i.min[t],r),i.max[t]=Math.max(i.max[t],r)}return i}function xye(e){return 4*Math.ceil(e/4)}function PV(e,t=0){let r=xye(e.byteLength);if(r!==e.byteLength){let i=new Uint8Array(r);if(i.set(new Uint8Array(e)),0!==t)for(let n=e.byteLength;n<r;n++)i[n]=t;return i.buffer}return e}function yye(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function bye(e,t){if(void 0!==e.toBlob)return new Promise((r=>e.toBlob(r,t)));let r;return"image/jpeg"===t?r=.92:"image/webp"===t&&(r=.8),e.convertToBlob({type:t,quality:r})}var IV=class{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}write(e,t){return bt(this,arguments,(function*(e,t,r={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},r),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),yield Promise.all(this.pending);let i=this,n=i.buffers,a=i.json;r=i.options;let s=i.extensionsUsed,o=i.extensionsRequired,l=new Blob(n,{type:"application/octet-stream"}),h=Object.keys(s),c=Object.keys(o);if(h.length>0&&(a.extensionsUsed=h),c.length>0&&(a.extensionsRequired=c),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=l.size),!0===r.binary){let e=new FileReader;e.readAsArrayBuffer(l),e.onloadend=function(){let r=PV(e.result),i=new DataView(new ArrayBuffer(vye));i.setUint32(0,r.byteLength,!0),i.setUint32(4,O1t,!0);let n=PV(D1t(JSON.stringify(a)),32),s=new DataView(new ArrayBuffer(vye));s.setUint32(0,n.byteLength,!0),s.setUint32(4,I1t,!0);let o=new ArrayBuffer(gye),l=new DataView(o);l.setUint32(0,C1t,!0),l.setUint32(4,P1t,!0);let h=gye+s.byteLength+n.byteLength+i.byteLength+r.byteLength;l.setUint32(8,h,!0);let c=new Blob([o,s,n,i,r],{type:"application/octet-stream"}),u=new FileReader;u.readAsArrayBuffer(c),u.onloadend=function(){t(u.result)}}}else if(a.buffers&&a.buffers.length>0){let e=new FileReader;e.readAsDataURL(l),e.onloadend=function(){let r=e.result;a.buffers[0].uri=r,t(a)}}else t(a)}))}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;let r=this.options,i=this.extensionsUsed;try{let n=JSON.parse(JSON.stringify(e.userData));if(r.includeCustomExtensions&&n.gltfExtensions){void 0===t.extensions&&(t.extensions={});for(let e in n.gltfExtensions)t.extensions[e]=n.gltfExtensions[e],i[e]=!0;delete n.gltfExtensions}Object.keys(n).length>0&&(t.extras=n)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}getUID(e,t=!1){if(!1===this.uids.has(e)){let t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;let t=new F;for(let r=0,i=e.count;r<i;r++)if(Math.abs(t.fromBufferAttribute(e,r).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){let t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);let r=e.clone(),i=new F;for(let e=0,t=r.count;e<t;e++)i.fromBufferAttribute(r,e),0===i.x&&0===i.y&&0===i.z?i.setX(1):i.normalize(),r.setXYZ(e,i.x,i.y,i.z);return t.attributesNormalized.set(e,r),r}applyTextureTransform(e,t){let r=!1,i={};(0!==t.offset.x||0!==t.offset.y)&&(i.offset=t.offset.toArray(),r=!0),0!==t.rotation&&(i.rotation=t.rotation,r=!0),(1!==t.repeat.x||1!==t.repeat.y)&&(i.scale=t.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function r(e){return e.colorSpace===Zr?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof bh&&(e=IP(e)),t instanceof bh&&(t=IP(t));let i=e?e.image:null,n=t?t.image:null,a=Math.max(i?i.width:0,n?n.width:0),s=Math.max(i?i.height:0,n?n.height:0),o=yye();o.width=a,o.height=s;let l=o.getContext("2d");l.fillStyle="#00ffff",l.fillRect(0,0,a,s);let h=l.getImageData(0,0,a,s);if(i){l.drawImage(i,0,0,a,s);let t=r(e),n=l.getImageData(0,0,a,s).data;for(let e=2;e<n.length;e+=4)h.data[e]=256*t(n[e]/256)}if(n){l.drawImage(n,0,0,a,s);let e=r(t),i=l.getImageData(0,0,a,s).data;for(let t=1;t<i.length;t+=4)h.data[t]=256*e(i[t]/256)}l.putImageData(h,0,0);let c=(e||t).clone();return c.source=new uu(o),c.colorSpace=Oa,c.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),c}processBuffer(e){let t=this.json,r=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),r.push(e),0}processBufferView(e,t,r,i,n){let a,s=this.json;switch(s.bufferViews||(s.bufferViews=[]),t){case Zn.BYTE:case Zn.UNSIGNED_BYTE:a=1;break;case Zn.SHORT:case Zn.UNSIGNED_SHORT:a=2;break;default:a=4}let o=xye(i*e.itemSize*a),l=new DataView(new ArrayBuffer(o)),h=0;for(let n=r;n<r+i;n++)for(let r=0;r<e.itemSize;r++){let i;e.itemSize>4?i=e.array[n*e.itemSize+r]:(0===r?i=e.getX(n):1===r?i=e.getY(n):2===r?i=e.getZ(n):3===r&&(i=e.getW(n)),!0===e.normalized&&(i=Tr.normalize(i,e.array))),t===Zn.FLOAT?l.setFloat32(h,i,!0):t===Zn.INT?l.setInt32(h,i,!0):t===Zn.UNSIGNED_INT?l.setUint32(h,i,!0):t===Zn.SHORT?l.setInt16(h,i,!0):t===Zn.UNSIGNED_SHORT?l.setUint16(h,i,!0):t===Zn.BYTE?l.setInt8(h,i):t===Zn.UNSIGNED_BYTE&&l.setUint8(h,i),h+=a}let c={buffer:this.processBuffer(l.buffer),byteOffset:this.byteOffset,byteLength:o};return void 0!==n&&(c.target=n),n===Zn.ARRAY_BUFFER&&(c.byteStride=e.itemSize*a),this.byteOffset+=o,s.bufferViews.push(c),{id:s.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){let t=this,r=t.json;return r.bufferViews||(r.bufferViews=[]),new Promise((function(i){let n=new FileReader;n.readAsArrayBuffer(e),n.onloadend=function(){let e=PV(n.result),a={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,i(r.bufferViews.push(a)-1)}}))}processAccessor(e,t,r,i){let n,a=this.json;if(e.array.constructor===Float32Array)n=Zn.FLOAT;else if(e.array.constructor===Int32Array)n=Zn.INT;else if(e.array.constructor===Uint32Array)n=Zn.UNSIGNED_INT;else if(e.array.constructor===Int16Array)n=Zn.SHORT;else if(e.array.constructor===Uint16Array)n=Zn.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)n=Zn.BYTE;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);n=Zn.UNSIGNED_BYTE}if(void 0===r&&(r=0),(void 0===i||i===1/0)&&(i=e.count),0===i)return null;let s,o=k1t(e,r,i);void 0!==t&&(s=e===t.index?Zn.ELEMENT_ARRAY_BUFFER:Zn.ARRAY_BUFFER);let l=this.processBufferView(e,n,r,i,s),h={bufferView:l.id,byteOffset:l.byteOffset,componentType:n,count:i,max:o.max,min:o.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(h.normalized=!0),a.accessors||(a.accessors=[]),a.accessors.push(h)-1}processImage(e,t,r,i="image/png"){if(null!==e){let n=this,a=n.cache,s=n.json,o=n.options,l=n.pending;a.images.has(e)||a.images.set(e,{});let h=a.images.get(e),c=i+":flipY/"+r.toString();if(void 0!==h[c])return h[c];s.images||(s.images=[]);let u={mimeType:i},d=yye();d.width=Math.min(e.width,o.maxTextureSize),d.height=Math.min(e.height,o.maxTextureSize);let p=d.getContext("2d");if(!0===r&&(p.translate(0,d.height),p.scale(1,-1)),void 0!==e.data){t!==gs&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>o.maxTextureSize||e.height>o.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);let r=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<r.length;t+=4)r[t+0]=e.data[t+0],r[t+1]=e.data[t+1],r[t+2]=e.data[t+2],r[t+3]=e.data[t+3];p.putImageData(new ImageData(r,e.width,e.height),0,0)}else p.drawImage(e,0,0,d.width,d.height);!0===o.binary?l.push(bye(d,i).then((e=>n.processBufferViewImage(e))).then((e=>{u.bufferView=e}))):void 0!==d.toDataURL?u.uri=d.toDataURL(i):l.push(bye(d,i).then((e=>(new FileReader).readAsDataURL(e))).then((e=>{u.uri=e})));let f=s.images.push(u)-1;return h[c]=f,f}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){let t=this.json;t.samplers||(t.samplers=[]);let r={magFilter:Pl[e.magFilter],minFilter:Pl[e.minFilter],wrapS:Pl[e.wrapS],wrapT:Pl[e.wrapT]};return t.samplers.push(r)-1}processTexture(e){let t=this.options,r=this.cache,i=this.json;if(r.textures.has(e))return r.textures.get(e);i.textures||(i.textures=[]),e instanceof bh&&(e=IP(e,t.maxTextureSize));let n=e.userData.mimeType;"image/webp"===n&&(n="image/png");let a={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,n)};e.name&&(a.name=e.name),this._invokeAll((function(t){t.writeTexture&&t.writeTexture(e,a)}));let s=i.textures.push(a)-1;return r.textures.set(e,s),s}processMaterial(e){let t=this.cache,r=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;r.materials||(r.materials=[]);let i={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");let n=e.color.toArray().concat([e.opacity]);if(rT(n,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=n),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){let t=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),r={index:this.processTexture(t),channel:t.channel};this.applyTextureTransform(r,t),i.pbrMetallicRoughness.metallicRoughnessTexture=r}if(e.map){let t={index:this.processTexture(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),i.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){let t=e.emissive;if(Math.max(t.r,t.g,t.b)>0&&(i.emissiveFactor=e.emissive.toArray()),e.emissiveMap){let t={index:this.processTexture(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),i.emissiveTexture=t}}if(e.normalMap){let t={index:this.processTexture(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),i.normalTexture=t}if(e.aoMap){let t={index:this.processTexture(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),i.occlusionTexture=t}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===ln&&(i.doubleSided=!0),""!==e.name&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll((function(t){t.writeMaterial&&t.writeMaterial(e,i)}));let a=r.materials.push(i)-1;return t.materials.set(e,a),a}processMesh(e){let t=this.cache,r=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(let t=0,r=e.material.length;t<r;t++)i.push(e.material[t].uuid);else i.push(e.material.uuid);let n=i.join(":");if(t.meshes.has(n))return t.meshes.get(n);let a,s=e.geometry;a=e.isLineSegments?Zn.LINES:e.isLineLoop?Zn.LINE_LOOP:e.isLine?Zn.LINE_STRIP:e.isPoints?Zn.POINTS:e.material.wireframe?Zn.LINES:Zn.TRIANGLES;let o={},l={},h=[],c=[],u={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},d=s.getAttribute("normal");void 0!==d&&!this.isNormalizedNormalAttribute(d)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),s.setAttribute("normal",this.createNormalizedNormalAttribute(d)));let p=null;for(let e in s.attributes){if("morph"===e.slice(0,5))continue;let r=s.attributes[e];if(e=u[e]||e.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(e)||(e="_"+e),t.attributes.has(this.getUID(r))){l[e]=t.attributes.get(this.getUID(r));continue}p=null;let i=r.array;"JOINTS_0"===e&&!(i instanceof Uint16Array)&&!(i instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),p=new fr(new Uint16Array(i),r.itemSize,r.normalized));let n=this.processAccessor(p||r,s);null!==n&&(e.startsWith("_")||this.detectMeshQuantization(e,r),l[e]=n,t.attributes.set(this.getUID(r),n))}if(void 0!==d&&s.setAttribute("normal",d),0===Object.keys(l).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){let r=[],i=[],n={};if(void 0!==e.morphTargetDictionary)for(let t in e.morphTargetDictionary)n[e.morphTargetDictionary[t]]=t;for(let a=0;a<e.morphTargetInfluences.length;++a){let o={},l=!1;for(let e in s.morphAttributes){if("position"!==e&&"normal"!==e){l||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),l=!0);continue}let r=s.morphAttributes[e][a],i=e.toUpperCase(),n=s.attributes[e];if(t.attributes.has(this.getUID(r,!0))){o[i]=t.attributes.get(this.getUID(r,!0));continue}let h=r.clone();if(!s.morphTargetsRelative)for(let e=0,t=r.count;e<t;e++)for(let t=0;t<r.itemSize;t++)0===t&&h.setX(e,r.getX(e)-n.getX(e)),1===t&&h.setY(e,r.getY(e)-n.getY(e)),2===t&&h.setZ(e,r.getZ(e)-n.getZ(e)),3===t&&h.setW(e,r.getW(e)-n.getW(e));o[i]=this.processAccessor(h,s),t.attributes.set(this.getUID(n,!0),o[i])}c.push(o),r.push(e.morphTargetInfluences[a]),void 0!==e.morphTargetDictionary&&i.push(n[a])}o.weights=r,i.length>0&&(o.extras={},o.extras.targetNames=i)}let f=Array.isArray(e.material);if(f&&0===s.groups.length)return null;let m=!1;if(f&&null===s.index){let e=[];for(let t=0,r=s.attributes.position.count;t<r;t++)e[t]=t;s.setIndex(e),m=!0}let g=f?e.material:[e.material],v=f?s.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let e=0,r=v.length;e<r;e++){let r={mode:a,attributes:l};if(this.serializeUserData(s,r),c.length>0&&(r.targets=c),null!==s.index){let i=this.getUID(s.index);(void 0!==v[e].start||void 0!==v[e].count)&&(i+=":"+v[e].start+":"+v[e].count),t.attributes.has(i)?r.indices=t.attributes.get(i):(r.indices=this.processAccessor(s.index,s,v[e].start,v[e].count),t.attributes.set(i,r.indices)),null===r.indices&&delete r.indices}let i=this.processMaterial(g[v[e].materialIndex]);null!==i&&(r.material=i),h.push(r)}!0===m&&s.setIndex(null),o.primitives=h,r.meshes||(r.meshes=[]),this._invokeAll((function(t){t.writeMesh&&t.writeMesh(e,o)}));let y=r.meshes.push(o)-1;return t.meshes.set(n,y),y}detectMeshQuantization(e,t){if(this.extensionsUsed[CV])return;let r;switch(t.array.constructor){case Int8Array:r="byte";break;case Uint8Array:r="unsigned byte";break;case Int16Array:r="short";break;case Uint16Array:r="unsigned short";break;default:return}t.normalized&&(r+=" normalized");let i=e.split("_",1)[0];pye[i]&&pye[i].includes(r)&&(this.extensionsUsed[CV]=!0,this.extensionsRequired[CV]=!0)}processCamera(e){let t=this.json;t.cameras||(t.cameras=[]);let r=e.isOrthographicCamera,i={type:r?"orthographic":"perspective"};return r?i.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:Tr.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(e,t){let r=this.json,i=this.nodeMap;r.animations||(r.animations=[]);let n=(e=R1.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,a=[],s=[];for(let e=0;e<n.length;++e){let r=n[e],o=hn.parseTrackName(r.name),l=hn.findNode(t,o.nodeName),h=mye[o.propertyName];if("bones"===o.objectName&&(l=!0===l.isSkinnedMesh?l.skeleton.getBoneByName(o.objectIndex):void 0),!l||!h)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',r.name),null;let c,u=1,d=r.values.length/r.times.length;h===mye.morphTargetInfluences&&(d/=l.morphTargetInfluences.length),!0===r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(c="CUBICSPLINE",d/=3):c=r.getInterpolation()===jd?"STEP":"LINEAR",s.push({input:this.processAccessor(new fr(r.times,u)),output:this.processAccessor(new fr(r.values,d)),interpolation:c}),a.push({sampler:s.length-1,target:{node:i.get(l),path:h}})}return r.animations.push({name:e.name||"clip_"+r.animations.length,samplers:s,channels:a}),r.animations.length-1}processSkin(e){let t=this.json,r=this.nodeMap,i=t.nodes[r.get(e)],n=e.skeleton;if(void 0===n)return null;let a=e.skeleton.bones[0];if(void 0===a)return null;let s=[],o=new Float32Array(16*n.bones.length),l=new lt;for(let t=0;t<n.bones.length;++t)s.push(r.get(n.bones[t])),l.copy(n.boneInverses[t]),l.multiply(e.bindMatrix).toArray(o,16*t);return void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new fr(o,16)),joints:s,skeleton:r.get(a)}),i.skin=t.skins.length-1}processNode(e){let t=this.json,r=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);let n={};if(r.trs){let t=e.quaternion.toArray(),r=e.position.toArray(),i=e.scale.toArray();rT(t,[0,0,0,1])||(n.rotation=t),rT(r,[0,0,0])||(n.translation=r),rT(i,[1,1,1])||(n.scale=i)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===L1t(e.matrix)&&(n.matrix=e.matrix.elements);if(""!==e.name&&(n.name=String(e.name)),this.serializeUserData(e,n),e.isMesh||e.isLine||e.isPoints){let t=this.processMesh(e);null!==t&&(n.mesh=t)}else e.isCamera&&(n.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){let t=[];for(let i=0,n=e.children.length;i<n;i++){let n=e.children[i];if(n.visible||!1===r.onlyVisible){let e=this.processNode(n);null!==e&&t.push(e)}}t.length>0&&(n.children=t)}this._invokeAll((function(t){t.writeNode&&t.writeNode(e,n)}));let a=t.nodes.push(n)-1;return i.set(e,a),a}processScene(e){let t=this.json,r=this.options;t.scenes||(t.scenes=[],t.scene=0);let i={};""!==e.name&&(i.name=e.name),t.scenes.push(i);let n=[];for(let t=0,i=e.children.length;t<i;t++){let i=e.children[t];if(i.visible||!1===r.onlyVisible){let e=this.processNode(i);null!==e&&n.push(e)}}n.length>0&&(i.nodes=n),this.serializeUserData(e,i)}processObjects(e){let t=new Xi;t.name="AuxScene";for(let r=0;r<e.length;r++)t.children.push(e[r]);this.processScene(t)}processInput(e){let t=this.options;e=e instanceof Array?e:[e],this._invokeAll((function(t){t.beforeParse&&t.beforeParse(e)}));let r=[];for(let t=0;t<e.length;t++)e[t]instanceof Xi?this.processScene(e[t]):r.push(e[t]);r.length>0&&this.processObjects(r);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let r=0;r<t.animations.length;++r)this.processAnimation(t.animations[r],e[0]);this._invokeAll((function(t){t.afterParse&&t.afterParse(e)}))}_invokeAll(e){for(let t=0,r=this.plugins.length;t<r;t++)e(this.plugins[t])}},OV=class{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);let r=this.writer,i=r.json,n=r.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(1-e.penumbra)*e.angle,a.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||0!==e.target.position.x||0!==e.target.position.y||-1!==e.target.position.z)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),n[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},n[this.name]=!0);let s=i.extensions[this.name].lights;s.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:s.length-1}}},DV=class{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;let r=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},r[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}},LV=class{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;let r=this.writer,i=r.extensionsUsed,n={};if(n.clearcoatFactor=e.clearcoat,e.clearcoatMap){let t={index:r.processTexture(e.clearcoatMap),texCoord:e.clearcoatMap.channel};r.applyTextureTransform(t,e.clearcoatMap),n.clearcoatTexture=t}if(n.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){let t={index:r.processTexture(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};r.applyTextureTransform(t,e.clearcoatRoughnessMap),n.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){let t={index:r.processTexture(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};r.applyTextureTransform(t,e.clearcoatNormalMap),n.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}},kV=class{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;let r=this.writer,i=r.extensionsUsed,n={};if(n.iridescenceFactor=e.iridescence,e.iridescenceMap){let t={index:r.processTexture(e.iridescenceMap),texCoord:e.iridescenceMap.channel};r.applyTextureTransform(t,e.iridescenceMap),n.iridescenceTexture=t}if(n.iridescenceIor=e.iridescenceIOR,n.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){let t={index:r.processTexture(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};r.applyTextureTransform(t,e.iridescenceThicknessMap),n.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}},FV=class{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;let r=this.writer,i=r.extensionsUsed,n={};if(n.transmissionFactor=e.transmission,e.transmissionMap){let t={index:r.processTexture(e.transmissionMap),texCoord:e.transmissionMap.channel};r.applyTextureTransform(t,e.transmissionMap),n.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}},BV=class{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;let r=this.writer,i=r.extensionsUsed,n={};if(n.thicknessFactor=e.thickness,e.thicknessMap){let t={index:r.processTexture(e.thicknessMap),texCoord:e.thicknessMap.channel};r.applyTextureTransform(t,e.thicknessMap),n.thicknessTexture=t}n.attenuationDistance=e.attenuationDistance,n.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}},NV=class{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;let r=this.writer.extensionsUsed,i={};i.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}},UV=class{constructor(e){this.writer=e,this.name="KHR_materials_specular"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(R1t)&&!e.specularIntensityMap&&!e.specularColorMap)return;let r=this.writer,i=r.extensionsUsed,n={};if(e.specularIntensityMap){let t={index:r.processTexture(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};r.applyTextureTransform(t,e.specularIntensityMap),n.specularTexture=t}if(e.specularColorMap){let t={index:r.processTexture(e.specularColorMap),texCoord:e.specularColorMap.channel};r.applyTextureTransform(t,e.specularColorMap),n.specularColorTexture=t}n.specularFactor=e.specularIntensity,n.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}},HV=class{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.sheen)return;let r=this.writer,i=r.extensionsUsed,n={};if(e.sheenRoughnessMap){let t={index:r.processTexture(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};r.applyTextureTransform(t,e.sheenRoughnessMap),n.sheenRoughnessTexture=t}if(e.sheenColorMap){let t={index:r.processTexture(e.sheenColorMap),texCoord:e.sheenColorMap.channel};r.applyTextureTransform(t,e.sheenColorMap),n.sheenColorTexture=t}n.sheenRoughnessFactor=e.sheenRoughness,n.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}},VV=class{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;let r=this.writer,i=r.extensionsUsed,n={};if(e.anisotropyMap){let t={index:r.processTexture(e.anisotropyMap)};r.applyTextureTransform(t,e.anisotropyMap),n.anisotropyTexture=t}n.anisotropyStrength=e.anisotropy,n.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}},zV=class{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;let r=this.writer.extensionsUsed,i={};i.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=i,r[this.name]=!0}},GV=class{constructor(e){this.writer=e,this.name="EXT_materials_bump"}writeMaterial(e,t){if(!e.isMeshStandardMaterial||1===e.bumpScale&&!e.bumpMap)return;let r=this.writer,i=r.extensionsUsed,n={};if(e.bumpMap){let t={index:r.processTexture(e.bumpMap),texCoord:e.bumpMap.channel};r.applyTextureTransform(t,e.bumpMap),n.bumpTexture=t}n.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}},qV=class{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;let r=this.writer,i=e,n=new Float32Array(3*i.count),a=new Float32Array(4*i.count),s=new Float32Array(3*i.count),o=new lt,l=new F,h=new dn,c=new F;for(let e=0;e<i.count;e++)i.getMatrixAt(e,o),o.decompose(l,h,c),l.toArray(n,3*e),h.toArray(a,4*e),c.toArray(s,3*e);let u={TRANSLATION:r.processAccessor(new fr(n,3)),ROTATION:r.processAccessor(new fr(a,4)),SCALE:r.processAccessor(new fr(s,3))};i.instanceColor&&(u._COLOR_0=r.processAccessor(i.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:u},r.extensionsUsed[this.name]=!0,r.extensionsRequired[this.name]=!0}};R1.Utils={insertKeyframe:function(e,t){let r,i=e.getValueSize(),n=new e.TimeBufferType(e.times.length+1),a=new e.ValueBufferType(e.values.length+i),s=e.createInterpolant(new e.ValueBufferType(i));if(0===e.times.length){n[0]=t;for(let e=0;e<i;e++)a[e]=0;r=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<.001)return 0;n[0]=t,n.set(e.times,1),a.set(s.evaluate(t),0),a.set(e.values,i),r=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<.001)return e.times.length-1;n[n.length-1]=t,n.set(e.times,0),a.set(e.values,0),a.set(s.evaluate(t),e.values.length),r=n.length-1}else for(let o=0;o<e.times.length;o++){if(Math.abs(e.times[o]-t)<.001)return o;if(e.times[o]<t&&e.times[o+1]>t){n.set(e.times.slice(0,o+1),0),n[o+1]=t,n.set(e.times.slice(o+1),o+2),a.set(e.values.slice(0,(o+1)*i),0),a.set(s.evaluate(t),(o+1)*i),a.set(e.values.slice((o+1)*i),(o+2)*i),r=o+1;break}}return e.times=n,e.values=a,r},mergeMorphTargetTracks:function(e,t){let r=[],i={},n=e.tracks;for(let e=0;e<n.length;++e){let a=n[e],s=hn.parseTrackName(a.name),o=hn.findNode(t,s.nodeName);if("morphTargetInfluences"!==s.propertyName||void 0===s.propertyIndex){r.push(a);continue}if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),a=a.clone(),a.setInterpolation(gh)}let l,h=o.morphTargetInfluences.length,c=o.morphTargetDictionary[s.propertyIndex];if(void 0===c)throw new Error("THREE.GLTFExporter: Morph target name not found: "+s.propertyIndex);if(void 0===i[o.uuid]){l=a.clone();let e=new l.ValueBufferType(h*l.times.length);for(let t=0;t<l.times.length;t++)e[t*h+c]=l.values[t];l.name=(s.nodeName||"")+".morphTargetInfluences",l.values=e,i[o.uuid]=l,r.push(l);continue}let u=a.createInterpolant(new a.ValueBufferType(1));l=i[o.uuid];for(let e=0;e<l.times.length;e++)l.values[e*h+c]=u.evaluate(l.times[e]);for(let e=0;e<a.times.length;e++){let t=this.insertKeyframe(l,a.times[e]);l.values[t*h+c]=a.values[e]}}return e.tracks=r,e}};var OP=class{parse(e){let t="",r=0,i=0,n=0,a=new F,s=new dt,o=new F,l=new Te,h=[];return e.traverse((function(e){!0===e.isMesh&&function(e){let s=0,c=0,u=0,d=e.geometry,p=new Wr,f=d.getAttribute("position"),m=d.getAttribute("normal"),g=d.getAttribute("uv"),v=d.getIndex();if(t+="o "+e.name+"\n",e.material&&e.material.name&&(t+="usemtl "+e.material.name+"\n"),void 0!==f)for(let r=0,i=f.count;r<i;r++,s++)a.fromBufferAttribute(f,r),a.applyMatrix4(e.matrixWorld),t+="v "+a.x+" "+a.y+" "+a.z+"\n";if(void 0!==g)for(let e=0,r=g.count;e<r;e++,u++)l.fromBufferAttribute(g,e),t+="vt "+l.x+" "+l.y+"\n";if(void 0!==m){p.getNormalMatrix(e.matrixWorld);for(let e=0,r=m.count;e<r;e++,c++)o.fromBufferAttribute(m,e),o.applyMatrix3(p).normalize(),t+="vn "+o.x+" "+o.y+" "+o.z+"\n"}if(null!==v)for(let e=0,a=v.count;e<a;e+=3){for(let t=0;t<3;t++){let a=v.getX(e+t)+1;h[t]=r+a+(m||g?"/"+(g?i+a:"")+(m?"/"+(n+a):""):"")}t+="f "+h.join(" ")+"\n"}else for(let e=0,a=f.count;e<a;e+=3){for(let t=0;t<3;t++){let a=e+t+1;h[t]=r+a+(m||g?"/"+(g?i+a:"")+(m?"/"+(n+a):""):"")}t+="f "+h.join(" ")+"\n"}r+=s,i+=u,n+=c}(e),!0===e.isLine&&function(e){let i=0,n=e.geometry,s=e.type,o=n.getAttribute("position");if(t+="o "+e.name+"\n",void 0!==o)for(let r=0,n=o.count;r<n;r++,i++)a.fromBufferAttribute(o,r),a.applyMatrix4(e.matrixWorld),t+="v "+a.x+" "+a.y+" "+a.z+"\n";if("Line"===s){t+="l ";for(let e=1,i=o.count;e<=i;e++)t+=r+e+" ";t+="\n"}if("LineSegments"===s)for(let e=1,i=e+1,n=o.count;e<n;e+=2,i=e+1)t+="l "+(r+e)+" "+(r+i)+"\n";r+=i}(e),!0===e.isPoints&&function(e){let i=0,n=e.geometry,o=n.getAttribute("position"),l=n.getAttribute("color");if(t+="o "+e.name+"\n",void 0!==o){for(let r=0,n=o.count;r<n;r++,i++)a.fromBufferAttribute(o,r),a.applyMatrix4(e.matrixWorld),t+="v "+a.x+" "+a.y+" "+a.z,void 0!==l&&(s.fromBufferAttribute(l,r).convertLinearToSRGB(),t+=" "+s.r+" "+s.g+" "+s.b),t+="\n";t+="p ";for(let e=1,i=o.count;e<=i;e++)t+=r+e+" ";t+="\n"}r+=i}(e)})),t}},DP=class{parse(e,t={}){let r=(t=Object.assign({binary:!1},t)).binary,i=[],n=0;e.traverse((function(e){if(e.isMesh){let t=e.geometry,r=t.index,a=t.getAttribute("position");n+=null!==r?r.count/3:a.count/3,i.push({object3d:e,geometry:t})}}));let a,s=80;if(!0===r){let e=new ArrayBuffer(2*n+3*n*4*4+80+4);a=new DataView(e),a.setUint32(s,n,!0),s+=4}else a="",a+="solid exported\n";let o=new F,l=new F,h=new F,c=new F,u=new F,d=new F;for(let e=0,t=i.length;e<t;e++){let t=i[e].object3d,r=i[e].geometry,n=r.index,a=r.getAttribute("position");if(null!==n)for(let e=0;e<n.count;e+=3){p(n.getX(e+0),n.getX(e+1),n.getX(e+2),a,t)}else for(let e=0;e<a.count;e+=3){p(e+0,e+1,e+2,a,t)}}return!1===r&&(a+="endsolid exported\n"),a;function p(e,t,i,n,p){o.fromBufferAttribute(n,e),l.fromBufferAttribute(n,t),h.fromBufferAttribute(n,i),!0===p.isSkinnedMesh&&(p.applyBoneTransform(e,o),p.applyBoneTransform(t,l),p.applyBoneTransform(i,h)),o.applyMatrix4(p.matrixWorld),l.applyMatrix4(p.matrixWorld),h.applyMatrix4(p.matrixWorld),function(e,t,i){c.subVectors(i,t),u.subVectors(e,t),c.cross(u).normalize(),d.copy(c).normalize(),!0===r?(a.setFloat32(s,d.x,!0),s+=4,a.setFloat32(s,d.y,!0),s+=4,a.setFloat32(s,d.z,!0),s+=4):(a+="\tfacet normal "+d.x+" "+d.y+" "+d.z+"\n",a+="\t\touter loop\n")}(o,l,h),f(o),f(l),f(h),!0===r?(a.setUint16(s,0,!0),s+=2):(a+="\t\tendloop\n",a+="\tendfacet\n")}function f(e){!0===r?(a.setFloat32(s,e.x,!0),s+=4,a.setFloat32(s,e.y,!0),s+=4,a.setFloat32(s,e.z,!0),s+=4):a+="\t\t\tvertex "+e.x+" "+e.y+" "+e.z+"\n"}}},ki=class{static exportToGltf(e,t){ki.exportToGltfOrGlb(e,t,{binary:!1})}static exportToGlb(e,t){ki.exportToGltfOrGlb(e,t,{binary:!0})}static exportToGltfOrGlb(e,t,r={}){if(!e||!t)throw new Error("Invalid input or filename!");let i=new R1;r=Object.assign({},{binary:!0,onlyVisible:!1,includeCustomExtensions:!1},r),i.parse(e,(e=>{if(r.binary){t=ki.addExtention(t,ki.EXTENSION_GLB);let r=e;ki.saveArrayBuffer(r,t)}else t=ki.addExtention(t,ki.EXTENSION_GLTF),ki.saveJson(e,t)}),(e=>console.log(e)),r)}static exportToObj(e,t){if(!e||!t)throw new Error("Invalid input or filename!");t=ki.addExtention(t,ki.EXTENSION_OBJ);let r=(new OP).parse(e);ki.saveString(r,t)}static exportToDraco(e,t,r={}){if(!e||!t)throw new Error("Invalid input or filename!");t=ki.addExtention(t,ki.EXTENSION_DRACO);let i=new to;r=Object.assign({},{encodeSpeed:5},r);let n=i.parse(e,r);ki.saveArrayBuffer(n,t)}static exportToStl(e,t,r=!1){if(!e||!t)throw new Error("Invalid input or filename!");t=ki.addExtention(t,ki.EXTENSION_STL);let i=new DP;if(r){let r={binary:!0},n=i.parse(e,r);ki.saveDataView(n,t)}else{let r=i.parse(e);ki.saveString(r,t)}}static exportToThreeJsJson(e,t){let r=e.toJSON();t.toLowerCase().endsWith(ki.EXTENSION_JSON)||(t+=ki.EXTENSION_JSON),ki.saveJson(r,t)}static save(e,t){let r=ki.downloadLink;r||(r=document.createElement("a"),r.style.display="none",document.body.appendChild(r),ki.downloadLink=r),r.href=URL.createObjectURL(e),r.download=t,r.click()}static saveArrayBuffer(e,t){ki.save(new Blob([e],{type:"application/octet-stream"}),t)}static saveJson(e,t){ki.saveJsonString(JSON.stringify(e),t)}static saveJsonString(e,t){ki.save(new Blob([e],{type:"application/json"}),t)}static saveString(e,t){ki.save(new Blob([e],{type:"text/plain"}),t)}static saveDataView(e,t){ki.save(new Blob([e],{type:"application/octet-stream"}),t)}static addExtention(e,t){return e.toLowerCase().endsWith(t.toLowerCase())||(e+=t),e}},Op=ki;Op.EXTENSION_GLTF=".gltf",Op.EXTENSION_GLB=".glb",Op.EXTENSION_OBJ=".obj",Op.EXTENSION_DRACO=".drc",Op.EXTENSION_JSON=".json",Op.EXTENSION_STL=".stl";var Eye=class{constructor(){this.prevTime=(performance||Date).now(),this.beginTime=(performance||Date).now(),this.frames=0,this.fps=Number.NaN}begin(){this.beginTime=(performance||Date).now()}end(){this.frames++;let e=(performance||Date).now();return e>=this.prevTime+1e3&&(this.fps=Math.round(1e3*this.frames/(e-this.prevTime)),this.frames=0,this.prevTime=e),e}update(){this.beginTime=this.end()}},ZV={exports:{}};function FP(e,t,r){r=r||2;var i,n,a,s,o,l,h,c=t&&t.length,u=c?t[0]*r:e.length,d=Aye(e,0,u,r,!0),p=[];if(!d||d.next===d.prev)return p;if(c&&(d=H1t(e,t,d,r)),e.length>80*r){i=a=e[0],n=s=e[1];for(var f=r;f<u;f+=r)(o=e[f])<i&&(i=o),(l=e[f+1])<n&&(n=l),o>a&&(a=o),l>s&&(s=l);h=0!==(h=Math.max(a-i,s-n))?32767/h:0}return nT(d,p,r,i,n,h,0),p}function Aye(e,t,r,i,n){var a,s;if(n===$V(e,t,r,i)>0)for(a=t;a<r;a+=i)s=_ye(a,e[a],e[a+1],s);else for(a=r-i;a>=t;a-=i)s=_ye(a,e[a],e[a+1],s);return s&&BP(s,s.next)&&(sT(s),s=s.next),s}function Qg(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!BP(i,i.next)&&0!==Ms(i.prev,i,i.next))i=i.next;else{if(sT(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function nT(e,t,r,i,n,a,s){if(e){!s&&a&&j1t(e,i,n,a);for(var o,l,h=e;e.prev!==e.next;)if(o=e.prev,l=e.next,a?B1t(e,i,n,a):F1t(e))t.push(o.i/r|0),t.push(e.i/r|0),t.push(l.i/r|0),sT(e),e=l.next,h=l.next;else if((e=l)===h){s?1===s?nT(e=N1t(Qg(e),t,r),t,r,i,n,a,2):2===s&&U1t(e,t,r,i,n,a):nT(Qg(e),t,r,i,n,a,1);break}}}function F1t(e){var t=e.prev,r=e,i=e.next;if(Ms(t,r,i)>=0)return!1;for(var n=t.x,a=r.x,s=i.x,o=t.y,l=r.y,h=i.y,c=n<a?n<s?n:s:a<s?a:s,u=o<l?o<h?o:h:l<h?l:h,d=n>a?n>s?n:s:a>s?a:s,p=o>l?o>h?o:h:l>h?l:h,f=i.next;f!==t;){if(f.x>=c&&f.x<=d&&f.y>=u&&f.y<=p&&C1(n,o,a,l,s,h,f.x,f.y)&&Ms(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function B1t(e,t,r,i){var n=e.prev,a=e,s=e.next;if(Ms(n,a,s)>=0)return!1;for(var o=n.x,l=a.x,h=s.x,c=n.y,u=a.y,d=s.y,p=o<l?o<h?o:h:l<h?l:h,f=c<u?c<d?c:d:u<d?u:d,m=o>l?o>h?o:h:l>h?l:h,g=c>u?c>d?c:d:u>d?u:d,v=XV(p,f,t,r,i),y=XV(m,g,t,r,i),b=e.prevZ,x=e.nextZ;b&&b.z>=v&&x&&x.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==n&&b!==s&&C1(o,c,l,u,h,d,b.x,b.y)&&Ms(b.prev,b,b.next)>=0||(b=b.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==n&&x!==s&&C1(o,c,l,u,h,d,x.x,x.y)&&Ms(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;b&&b.z>=v;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==n&&b!==s&&C1(o,c,l,u,h,d,b.x,b.y)&&Ms(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==n&&x!==s&&C1(o,c,l,u,h,d,x.x,x.y)&&Ms(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function N1t(e,t,r){var i=e;do{var n=i.prev,a=i.next.next;!BP(n,a)&&Rye(n,i,i.next,a)&&iT(n,a)&&iT(a,n)&&(t.push(n.i/r|0),t.push(i.i/r|0),t.push(a.i/r|0),sT(i),sT(i.next),i=e=a),i=i.next}while(i!==e);return Qg(i)}function U1t(e,t,r,i,n,a){var s=e;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&Y1t(s,o)){var l=Cye(s,o);return s=Qg(s,s.next),l=Qg(l,l.next),nT(s,t,r,i,n,a,0),void nT(l,t,r,i,n,a,0)}o=o.next}s=s.next}while(s!==e)}function H1t(e,t,r,i){var n,a,s,o=[];for(n=0,a=t.length;n<a;n++)(s=Aye(e,t[n]*i,n<a-1?t[n+1]*i:e.length,i,!1))===s.next&&(s.steiner=!0),o.push(X1t(s));for(o.sort(V1t),n=0;n<o.length;n++)r=z1t(o[n],r);return r}function V1t(e,t){return e.x-t.x}function z1t(e,t){var r=G1t(e,t);if(!r)return t;var i=Cye(r,e);return Qg(i,i.next),Qg(r,r.next)}function G1t(e,t){var r,i=t,n=e.x,a=e.y,s=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var o=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=n&&o>s&&(s=o,r=i.x<i.next.x?i:i.next,o===n))return r}i=i.next}while(i!==t);if(!r)return null;var l,h=r,c=r.x,u=r.y,d=1/0;i=r;do{n>=i.x&&i.x>=c&&n!==i.x&&C1(a<u?n:s,a,c,u,a<u?s:n,a,i.x,i.y)&&(l=Math.abs(a-i.y)/(n-i.x),iT(i,e)&&(l<d||l===d&&(i.x>r.x||i.x===r.x&&q1t(r,i)))&&(r=i,d=l)),i=i.next}while(i!==h);return r}function q1t(e,t){return Ms(e.prev,e,t.prev)<0&&Ms(t.next,e,e.next)<0}function j1t(e,t,r,i){var n=e;do{0===n.z&&(n.z=XV(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,W1t(n)}function W1t(e){var t,r,i,n,a,s,o,l,h=1;do{for(r=e,e=null,a=null,s=0;r;){for(s++,i=r,o=0,t=0;t<h&&(o++,i=i.nextZ);t++);for(l=h;o>0||l>0&&i;)0!==o&&(0===l||!i||r.z<=i.z)?(n=r,r=r.nextZ,o--):(n=i,i=i.nextZ,l--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;r=i}a.nextZ=null,h*=2}while(s>1);return e}function XV(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function X1t(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function C1(e,t,r,i,n,a,s,o){return(n-s)*(t-o)>=(e-s)*(a-o)&&(e-s)*(i-o)>=(r-s)*(t-o)&&(r-s)*(a-o)>=(n-s)*(i-o)}function Y1t(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!$1t(e,t)&&(iT(e,t)&&iT(t,e)&&Z1t(e,t)&&(Ms(e.prev,e,t.prev)||Ms(e,t.prev,t))||BP(e,t)&&Ms(e.prev,e,e.next)>0&&Ms(t.prev,t,t.next)>0)}function Ms(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function BP(e,t){return e.x===t.x&&e.y===t.y}function Rye(e,t,r,i){var n=kP(Ms(e,t,r)),a=kP(Ms(e,t,i)),s=kP(Ms(r,i,e)),o=kP(Ms(r,i,t));return!!(n!==a&&s!==o||0===n&&LP(e,r,t)||0===a&&LP(e,i,t)||0===s&&LP(r,e,i)||0===o&&LP(r,t,i))}function LP(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function kP(e){return e>0?1:e<0?-1:0}function $1t(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Rye(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function iT(e,t){return Ms(e.prev,e,e.next)<0?Ms(e,t,e.next)>=0&&Ms(e,e.prev,t)>=0:Ms(e,t,e.prev)<0||Ms(e,e.next,t)<0}function Z1t(e,t){var r=e,i=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}function Cye(e,t){var r=new YV(e.i,e.x,e.y),i=new YV(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}function _ye(e,t,r,i){var n=new YV(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function sT(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function YV(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $V(e,t,r,i){for(var n=0,a=t,s=r-i;a<r;a+=i)n+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return n}ZV.exports=FP,ZV.exports.default=FP,FP.deviation=function(e,t,r,i){var n=t&&t.length,a=n?t[0]*r:e.length,s=Math.abs($V(e,0,a,r));if(n)for(var o=0,l=t.length;o<l;o++){var h=t[o]*r,c=o<l-1?t[o+1]*r:e.length;s-=Math.abs($V(e,h,c,r))}var u=0;for(o=0;o<i.length;o+=3){var d=i[o]*r,p=i[o+1]*r,f=i[o+2]*r;u+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===s&&0===u?0:Math.abs((u-s)/s)},FP.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var a=0;a<e[n].length;a++)for(var s=0;s<t;s++)r.vertices.push(e[n][a][s]);n>0&&(i+=e[n-1].length,r.holes.push(i))}return r};var k7t=ZV.exports;function Tye(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function K1t(e,t){var r=t[0],i=t[1],n=t[2],a=Math.sqrt(r*r+i*i+n*n)||1;return e[0]=r/a,e[1]=i/a,e[2]=n/a,e}function J1t(e,t,r){var i=t[0],n=t[1],a=t[2],s=r[0],o=r[1],l=r[2];return e[0]=n*l-a*o,e[1]=a*s-i*l,e[2]=i*o-n*s,e}function Q1t(e,t){function r(e,t,r,i){e[0]=t,e[1]=r,e[2]=i}for(var i=[],n=[],a=[],s=[],o=[],l=[],h=e.length,c=new Float32Array(t.length),u=0;u<h;){var d=3*e[u],p=3*e[u+1],f=3*e[u+2];r(i,t[d],t[d+1],t[d+2]),r(n,t[p],t[p+1],t[p+2]),r(a,t[f],t[f+1],t[f+2]),Tye(o,a,n),Tye(s,i,n),J1t(l,o,s);for(var m=0;m<3;m++)c[d+m]+=l[m],c[p+m]+=l[m],c[f+m]+=l[m];u+=3}for(var g=0,v=c.length;g<v;)r(l,c[g],c[g+1],c[g+2]),K1t(l,l),c[g]=l[0]||0,c[g+1]=l[1]||0,c[g+2]=l[2]||0,g+=3;return c}function ebt(e){if(1===e.length)return{position:e[0].position,normal:e[0].normal,uv:e[0].uv,indices:e[0].indices,results:e};for(var t=0,r=0,i=0,n=e.length;i<n;i++){var a=e[i],s=a.position,o=a.indices;t+=s.length,r+=o.length}for(var l={position:new Float32Array(t),normal:new Float32Array(t),uv:new Float32Array(t/3*2),indices:new Uint32Array(r),results:e},h=0,c=0,u=0,d=0,p=0,f=e.length;p<f;p++){var m=e[p],g=m.position,v=m.indices,y=m.normal,b=m.uv;l.position.set(g,h),l.normal.set(y,h),l.uv.set(b,d);for(var x=0,_=v.length;x<_;){var w=v[x]+c;l.indices[u]=w,u++,x++}d+=b.length,h+=g.length,c+=g.length/3}return l}function tbt(e){return 180*e/Math.PI}function wye(e){return e/180*Math.PI}function rbt(e,t,r,i,n,a){var s=3*r,o=3*i,l=3*n,h=3*a,c=t[s],u=t[s+1],d=t[s+2],p=t[o],f=t[o+1],m=t[o+2],g=t[l],v=t[l+1],y=t[l+2],b=t[h],x=t[h+1],_=t[h+2];Math.abs(u-f)<Math.abs(c-p)?(e.push(c,1-d),e.push(p,1-m),e.push(g,1-y),e.push(b,1-_)):(e.push(u,1-d),e.push(f,1-m),e.push(v,1-y),e.push(x,1-_))}function Pye(e,t){t=Object.assign({},{depth:2,lineWidth:1},t);var r=ebt(e.map((function(e){var r=sbt(e,t);return r.line=e,nbt(r,t),ibt(r,t),r.position=new Float32Array(r.points),r.indices=new Uint32Array(r.index),r.uv=new Float32Array(r.uvs),r.normal=Q1t(r.indices,r.position),r})));return r.lines=e,r}function nbt(e,t){for(var r=t.depth,i=[],n=[],a=[],s=e.leftPoints,o=e.rightPoints,l=0,h=s.length;l<h;){var c=3*l,u=s[l],d=u[0],p=u[1],f=u[2];i[c]=d,i[c+1]=p,i[c+2]=r+f;var m=o[l],g=m[0],v=m[1],y=m[2],b=3*h+c;i[b]=g,i[b+1]=v,i[b+2]=r+y;var x=2*h*3+c;i[x]=d,i[x+1]=p,i[x+2]=f;var _=2*h*3+3*h+c;i[_]=g,i[_+1]=v,i[_+2]=y,l++}for(l=0,h=i.length;l<h;){var w=i[l],S=i[l+1];a.push(w,S),l+=3}for(l=0,h=s.length;l<h-1;){var T=l,M=l+1,E=T+h,A=M+h;n.push(T,E,M),n.push(E,A,M);var C=l+2*h,P=C+1,R=C+h,I=P+h;n.push(C,R,P),n.push(R,I,P),l++}e.index=n,e.points=i,e.uvs=a}function ibt(e,t){var r=e.points,i=e.index,n=e.leftPoints,a=e.rightPoints,s=e.uvs,o=t.depth,l=[n,a];function h(e,t){var n=r.length/3;r.push(e[0],e[1],o+e[2],t[0],t[1],o+t[2],e[0],e[1],e[2],t[0],t[1],t[2]);var a=n+2,l=n+3,h=n,c=n+1;i.push(a,h,l,h,c,l),rbt(s,r,a,l,h,c)}for(var c=0,u=l.length;c<u;c++){var d=l[c];c>0&&(d=(d=d.map((function(e){return e}))).reverse());for(var p=0,f=d.length-1;p<f;){h(d[p],d[p+1]),p++}}for(var m=n.length,g=[a[0],n[0],n[m-1],a[m-1]],v=0;v<g.length;v+=2){h(g[v],g[v+1])}}var jV={x:0,y:0},WV={x:0,y:0};function sbt(e,t){for(var r=0,i=t.lineWidth/2,n=[],a=[],s=[],o=e.length,l=0;l<o-1;){var h=e[l],c=e[l+1],u=c[1]-h[1],d=c[0]-h[0],p=0,f=tbt(Math.atan(u/d));if(r=f,0===l)p=f,p-=90;else{var m=e[l-1];jV.x=m[0]-h[0],jV.y=m[1]-h[1],WV.x=c[0]-h[0],WV.y=c[1]-h[1],p=f-abt(jV,WV)/2}var g=Sye(wye(p),i,h),v=g[0],y=g[1];n.push(v,y),Mye(v,h,c)?(a.push(v),s.push(y)):(a.push(y),s.push(v)),l++}var b=r,x=wye(b-=90),_=e[o-2],w=e[o-1],S=Sye(x,i,w),T=S[0],M=S[1];return n.push(T,M),Mye(T,_,w)?(a.push(T),s.push(M)):(a.push(M),s.push(T)),{offsetPoints:n,leftPoints:a,rightPoints:s}}function Sye(e,t,r){var i=r[0],n=r[1],a=r[2]||0,s=[i+Math.cos(e)*t,n+Math.sin(e)*t,a],o=e+=Math.PI;return[s,[i+Math.cos(o)*t,n+Math.sin(o)*t,a]]}var abt=function(e,t){var r=e.x,i=e.y,n=t.x,a=t.y,s=r*n+i*a,o=r*a-i*n;return(Math.atan2(o,s)/Math.PI*180+360)%360};function Mye(e,t,r){var i=t[0],n=t[1],a=r[0],s=r[1];return(n-s)*e[0]+(a-i)*e[1]+i*s-a*n>0}var KV=1e-15,Iye=(new lt).set(0,0,-1,0,1,0,0,0,0,1,0,0,0,0,0,1),Oye=(new lt).set(0,1,0,0,1,0,0,0,0,0,1,0,0,0,0,1),or=class{static roundNumber(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}static floorNumber(e,t){return Math.floor(e*Math.pow(10,t))/Math.pow(10,t)}static areNumbersEqual(e,t,r=1e-7){return Math.abs(e-t)<r*Math.max(1,Math.abs(e),Math.abs(t))}static areVector2sEqual(e,t,r=1e-7){return or.areNumbersEqual(e.x,t.x,r)&&or.areNumbersEqual(e.y,t.y,r)}static areVector3sEqual(e,t,r=1e-7){return or.areNumbersEqual(e.x,t.x,r)&&or.areNumbersEqual(e.y,t.y,r)&&or.areNumbersEqual(e.z,t.z,r)}static areNumbersClose(e,t,r=1e-9,i=1e-12){return Math.abs(e-t)<=Math.max(r*Math.max(Math.abs(e),Math.abs(t)),i)}static areVector2sClose(e,t,r=1e-9,i=1e-12){return this.areNumbersClose(e.x,t.x,r,i)&&this.areNumbersClose(e.y,t.y,r,i)}static areVectorsClose(e,t,r=1e-9,i=1e-12){return this.areNumbersClose(e.x,t.x,r,i)&&this.areNumbersClose(e.y,t.y,r,i)&&this.areNumbersClose(e.z,t.z,r,i)}static getArcAngleSpanInRadian(e,t){let r=2*Math.PI;return or.areNumbersClose(e,t,KV)?0:(e%=r,or.areNumbersClose(e,t%r,KV)?r:(or.areNumbersClose(t,r,KV)&&(t%=r),t<e&&(t+=r),t-e))}static getIntegerPartLength(e){return(e=Math.abs(e))<1?0:Math.ceil(Math.log10(Math.abs(e)+1))}static getRelativeEps(e,t=1e-7){let r=or.getIntegerPartLength(e);return Math.max(Math.pow(10,r)*t,t)}static getVector2RelativeEps(e,t=1e-7){return Math.min(or.getRelativeEps(e.x,t),or.getRelativeEps(e.y,t))}static getControlPointByTwoPoints(e,t){let r=(new Te).subVectors(t,e),i=r.angle(),n=r.length(),a=Tr.degToRad(45),s=n/2/Math.cos(a);return new Te(e.x+s*Math.cos(a-i),e.y-s*Math.sin(a-i))}static convertPointFromUEToGltf(e){let t=new F(e.x,e.y,e.z);return t.applyMatrix4(Iye.clone().invert()),t}static convertPointFromGltfToUE(e){let t=new F(e.x,e.y,e.z);return t.applyMatrix4(Iye),t}static convertPointFromUEToRevit(e){let t=new F(e.x,e.y,e.z);return t.applyMatrix4(Oye.clone().invert()),t}static convertPointFromRevitToUE(e){let t=new F(e.x,e.y,e.z);return t.applyMatrix4(Oye),t}static getBox(e,t){return[...[Math.min(e.x,t.x),Math.min(e.y,t.y),Math.min(e.z,t.z)],...[Math.max(e.x,t.x),Math.max(e.y,t.y),Math.max(e.z,t.z)]]}static getCenter(e){let t=new F(e.min.x,e.min.y,e.min.z),r=new F(e.max.x,e.max.y,e.max.z),i=(new F).addVectors(t,r).multiplyScalar(.5);return{x:i.x,y:i.y,z:i.z}}static convertBoxFromGltfToUE(e){let t=or.convertPointFromGltfToUE(e.min),r=or.convertPointFromGltfToUE(e.max);return or.getBox(t,r)}static convertBoxFromUEToGltf(e){let t=or.convertPointFromUEToGltf(e.min),r=or.convertPointFromUEToGltf(e.max);return or.getBox(t,r)}static convertBoxFromRevitToUE(e){let t=or.convertPointFromRevitToUE(e.min),r=or.convertPointFromRevitToUE(e.max);return or.getBox(t,r)}static convertBoxFromUEToRevit(e){let t=or.convertPointFromUEToRevit(e.min),r=or.convertPointFromUEToRevit(e.max);return or.getBox(t,r)}static clamp(e,t,r){return Math.max(t,Math.min(r,e))}static getLookAtMatrix(e,t,r){let i=new lt,n=new F(e.x,e.y,e.z),a=new F(t.x,t.y,t.z),s=new F(r.x,r.y,r.z);i.lookAt(n,a,s),i.transpose();let o=[];return i.toArray(o),o}static getLocationFromMatrix(e){let t=new F;return t.setFromMatrixPosition(e),t}static toDegrees(e){return Tr.radToDeg(e)}static toRadians(e){return Tr.degToRad(e)}static signNotZero(e){return e<0?-1:1}static fromSnorm(e,t){return or.clamp(e*(1/t),-1,1)}static OctDecode(e,t,r){if(t.x=or.fromSnorm(e.x,r),t.y=or.fromSnorm(e.y,r),t.z=1-(Math.abs(t.x)+Math.abs(t.y)),t.z<0){let e=t.x;t.x=(1-Math.abs(t.y))*or.signNotZero(e),t.y=(1-Math.abs(e))*or.signNotZero(t.y)}}},JV=1e7,Dye=new ts,Lye=new ts,kye=new F,Fye=new F,Bye=new F,Dp=new yi,pr=class{static geometriesEqual(e,t){return e===t||e.type===t.type&&e.name===t.name&&e.morphTargetsRelative===t.morphTargetsRelative&&this.equal(e.boundingBox,t.boundingBox)&&this.equal(e.boundingSphere,t.boundingSphere)&&this.attributesEqual(e.attributes,t.attributes)&&this.bufferAttributesEqual(e.index,t.index)}static equal(e,t){return e===t||!e&&!t||!(!e||!t)&&e.equals(t)}static attributesEqual(e,t){if(e===t)return!0;let r=Object.keys(e).sort(),i=Object.keys(t).sort();if(r.length!==i.length)return!1;for(let n=0;n<r.length;++n){if(r[n]!==i[n])return!1;let a=e[r[n]],s=t[i[n]];if(!this.bufferAttributesEqual(a,s))return!1}return!0}static bufferAttributesEqual(e,t){if(e===t)return!0;if(!e||!t||e.name!==t.name||e.itemSize!==t.itemSize||e.count!==t.count||e.normalized!==t.normalized)return!1;if(e.array&&t.array){if(e.array.length!==t.array.length)return!1;for(let r=0;r<e.array.length;++r)if(e.array[r]!==t.array[r])return!1}else if(e.array||t.array)return!1;let r=e.data,i=t.data;if(r&&i){if(r.length!==i.length)return!1;for(let e=0;e<r.length;++e)if(r[e]!==i[e])return!1}else if(r||i)return!1;return!0}static tryConvertInterleavedBufferAttributes(e){!e||!e.attributes||Object.keys(e.attributes).forEach((t=>{let r=e.attributes[t];if(r instanceof Xo){let i=r.clone();e.attributes[t]=i}}))}static isPointInPolygon(e,t,r=!1){let i=e.x,n=e.y,a=!1,s=t.length;for(let e=0,o=s-1;e<s;o=e++){let s=t[e].x,l=t[e].y,h=t[o].x,c=t[o].y,u=l>n!=c>n;r&&(u=l>=n!=c>=n),u&&i<(h-s)*(n-l)/(c-l)+s&&(a=!a)}return a}static caculateGeometryCenter(e){if(!e.hasAttribute("position"))return null;let t=e.getAttribute("position");if(0===t.count)return null;let r=new F,i=t.itemSize,n=t.array,a=[0,0,0];for(let e=0;e<t.count;e++)for(let t=0;t<i;t++)a[t]+=n[e*i+t];for(let e=0;e<i;e++)r.setComponent(e,a[e]/t.count);return r}static isConvex(e){let t=e.length,r=0,i=0,n=new Te,a=new Te;for(let s=0;s<t;++s){let o=e[s],l=e[(s+1)%t],h=e[(s+2)%t];if(n.subVectors(l,o),a.subVectors(h,l),i=n.cross(a),0!=i){if(i>0&&r<0||i<0&&r>0)return!1;r=i}}return!0}static areLineSegmentsIntersecting(e,t){let{start:r,end:i}=e,{start:n,end:a}=t,s=n.clone().sub(r),o=i.clone().sub(r),l=a.clone().sub(r),h=s.cross(o).dot(l.cross(o)),c=r.clone().sub(n),u=a.clone().sub(n),d=i.clone().sub(n),p=c.cross(u).dot(d.cross(u));return h<0&&p<0}static getLineSegmentsIntersectingPoint(e,t){let{start:r,end:i}=e,{start:n,end:a}=t,s=kye.subVectors(i,r).normalize(),o=Fye.subVectors(a,n).normalize();if(1===s.dot(o))return null;let l=Bye.subVectors(n,r),h=s.clone().cross(o),c=l.clone().cross(o),u=l.clone().dot(h);if(u>=1e-5||u<=-1e-5)return null;let d=h.lengthSq();if(or.areNumbersEqual(0,d))return;let p=c.clone().dot(h)/d,f=r.clone().add(s.multiplyScalar(p));return f.equals(r)||f.equals(i)?null:f}static isPointOnLineSegment(e,t,r=.001){let{start:i,end:n}=t,a=kye.subVectors(i,n).length(),s=Fye.subVectors(e,i).length(),o=Bye.subVectors(e,n).length();return Math.abs(a-(s+o))<=r}static isPointOnLineSegments(e,t,r=.001){let i=!1;for(let n=0;n<t.length-1;n+=2){let a=t[n],s=t[n+1];if(i=this.isPointOnLineSegment(e,{start:a,end:s},r),i)break}return i}static checkAndRebasePositionsOnRTC(e,t){if(0===e.length)return!1;let r=e[0]instanceof F;e.forEach((e=>{r?t.add(e):(t.x+=e.x,t.y+=e.y)})),t.divideScalar(e.length);let i=!1;if(pr.shouldRebasePositionOnRTC(t)){i=!0;for(let i=0;i<e.length;i++){let n=e[i].x-t.x,a=e[i].y-t.y;e[i]=r?new F(n,a,e[i].z-t.z):new Te(n,a)}}else t.setScalar(0);return i}static shouldRebasePositionOnRTC(e){return Math.abs(e.x)>JV||Math.abs(e.y)>JV||e instanceof F&&Math.abs(e.z)>JV}static calculateSurfaceArea(e){let t=0,r=e.getAttribute("position"),i=e.index;if(i)for(let e=0;e<i.count;e+=3)Dp.a.fromBufferAttribute(r,i.getX(e)),Dp.b.fromBufferAttribute(r,i.getX(e+1)),Dp.c.fromBufferAttribute(r,i.getX(e+2)),t+=Dp.getArea();else for(let e=0;e<r.count;e+=3)Dp.a.fromBufferAttribute(r,e),Dp.b.fromBufferAttribute(r,e+1),Dp.c.fromBufferAttribute(r,e+2),t+=Dp.getArea();return t}static convertLineStripToLine(e,t=!1){let r=e.getIndex();if(!r)return;let i=r.array.constructor,n=r.count,a=n;n>2&&(a=t?2*n:2*n-2);let s=new i(a),o=0;for(let e=0;e<n;e++){let t=r.getX(e);s[o++]=t,e>0&&e<n-1&&(s[o++]=t)}t&&(s[o++]=r.getX(n-1),s[o++]=r.getX(0)),e.setIndex(s)}static convertGeometryWithIndexedToNonIndexed(e){if(!e.index)return e;let t=new Nt,r=e.index;for(let i in e.attributes)t.setAttribute(i,pr.createGeometryAttributeByIndex(e.attributes[i],r));return t}static createGeometryAttributeByIndex(e,t){let r=t.count,i=e.itemSize,n=new(0,e.array.constructor)(r*i);for(let a=0;a<r;a++){let r=t.getX(a)*i;for(let t=0;t<i;t++)n[a*i+t]=e.array[r+t]}return new fr(n,i,e.normalized)}static getLineEndPointsByIndex(e,t){var r,i,n;let a=t=>{let r=e.geometry.attributes.position.array;return e.localToWorld(new F(r[3*t],r[3*t+1],r[3*t+2]))};e.updateWorldMatrix(!0,!1);let s=(null==(r=e.geometry.getIndex())?void 0:r.array)||[],o=null!=(i=s[t])?i:t,l=null!=(n=s[t+1])?n:t+1;return[a(o),a(l)]}static arePolygonsIntersect(e,t){if(0===e.length||0===t.length||(Dye.setFromPoints(e),Lye.setFromPoints(t),!Dye.intersectsBox(Lye)))return!1;for(let r=0;r<e.length;){if(this.isPointInPolygon(e[r],t,!0))return!0;r<e.length-1&&or.areVector2sEqual(e[r+1],e[r])&&++r,++r}return!1}static getLineLineIntersectionPoint(e,t,r,i,n=.001){let a=t.clone().sub(e).normalize(),s=i.clone().sub(r).normalize();if(Math.abs(a.dot(s))>1-n)return;let o=t.y-e.y,l=e.x-t.x,h=o*e.x+l*e.y,c=i.y-r.y,u=r.x-i.x,d=c*r.x+u*r.y,p=o*u-c*l;return Math.abs(p)<n?void 0:new Te((u*h-l*d)/p,(o*d-c*h)/p)}static getOffsetPoint(e,t,r){let i=t.x-e.x,n=t.y-e.y,a=r/Math.sqrt(i*i+n*n);return new Te(-a*n,a*i)}static convertSimpleWidthLineToMeshGeometry(e,t){let r,i,n,a=!1,s=!1,o=[],l=[],h=new Te,c=new Te,u=new Te,d=new Te,p=[],f=t/2;for(let t=0,m=e.length-1;t<m;t++)a=!t,s=t===e.length-2,r=this.getOffsetPoint(e[t],e[t+1],f),h=new Te(e[t].x+r.x,e[t].y+r.y),c=new Te(e[t+1].x+r.x,e[t+1].y+r.y),u=new Te(e[t].x-r.x,e[t].y-r.y),d=new Te(e[t+1].x-r.x,e[t+1].y-r.y),a||(i=this.getLineLineIntersectionPoint(o[0],o[1],h,c),void 0!==i?p.unshift(i):p.unshift(h),n=this.getLineLineIntersectionPoint(l[0],l[1],u,d),void 0!==n?p.push(n):p.push(u)),a&&(p.unshift(h),p.push(u)),s&&(p.unshift(c),p.push(d)),s||(o=[h,c],l=[u,d]);if(p.length<3)return;let m=$s.triangulateShape(p,[]),g=[];for(let e=0;e<m.length;e++)g.push(...m[e]);let v=(new Nt).setFromPoints(p);return v.setIndex(g),v}static convertWidthLineToMeshGeometry(e,t){if(e.length<2)return;let r=[];e.forEach((e=>{r.push([e.x,e.y])}));try{let{indices:e,position:i}=Pye([r],{lineWidth:t,depth:1}),n=new Nt;return n.setAttribute("position",new zt(i,3)),n.setIndex(Array.from(e)),n}catch(e){return}}static releaseGeometryManually(e){e.index=null,e.attributes={}}static getAdjacentNonRepeatPoints(e,t=1e-7){let r=[],i=e.length;for(let n=0;n<i-1;n++)or.areVector3sEqual(e[n],e[n+1],t)||r.push(e[n]);return r.push(e[i-1]),r}static mergeBBoxes(e){let t=[...e];if(t.length<2)return t;let r=[],i=[];for(let e=0;e<t.length;e++){let n=t[e];if(!i.includes(e)){for(let e=0;e<t.length;e++){let r=t[e];n.equals(r)||n.intersectsBox(r)&&(n.union(r),i.push(e))}r.push(n)}}return r}},Nye={NavCube:{front:"Front",back:"Back",top:"Top",bottom:"Bottom",left:"Left",right:"Right"},ContextMenu:{viewFitAll:"View Fit All",hideAll:"Hide All",showAll:"Show All",xRayAll:"X-Ray",xRayNone:"X-Ray None",selectNone:"Select None",resetView:"Reset View",viewFitEntity:"View Fit",hideEntity:"Hide",hideOthers:"Hide Others",xRayEntity:"X-Ray",xRayOthers:"X-Ray Others",select:"Select",deselect:"Undo Select",showSectionPlane:"Show Section Plane",showSectionBox:"Show Section Box",showAxisSection:"Show Axis Section",hideSectionPlane:"Hide Section Plane",hideSectionBox:"Hide Section Box",hideAxisSection:"Hide Axis Section",undoSection:"Undo Section"},ProgressBar:{Loading:"Loading",Comparing:"Comparing"},Toolbar:{homeView:"Home",orthoView:"Ortho View",measurement:"Measure",distanceMeasurement:"Distance",areaMeasurement:"Area",angleMeasurement:"Angle",coordinateMeasurement:"Coordinate",clearMeasurement:"Clear",markupVisibility:"Markup Visibility",markup:"Markup",markupArrow:"Arrow",markupRect:"Rect",markupCloudRect:"CloudRect",markupPolyLine:"PolyLine",markupCloudLine:"CloudLine",markupEllipse:"Ellipse",markupCircle:"Circle",markupDot:"Dot",markupText:"Text",markupX:"X",markupStroke:"Stroke Style",markupLineWidth:"Line Width",markupLineWidth2:"Line Width 2",markupLineWidth5:"Line Width 5",markupLineWidth10:"Line Width 10",markupFontSize:"Font Size",markupFontSize14:"14",markupFontSize18:"18",markupFontSize24:"24",clearMarkup:"Clear Markup",quitMarkup:"Quit markup",section:"Section",axisSection:"Axis Section",pickSectionPlane:"Pick Section Plane",sectionBox:"Section Box",bimTree:"BIM Tree",viewpoint:"Viewpoint",annotation:"Annotation",property:"Property",settings:"Settings",compared:"Compared",quitCompare:"Quit compare",fullscreen:"Full Screen",layers:"Layers",zoomToRectangle:"Zoom",screenshot:"Screenshot"},Tooltip:{measure:"Pick a point to continue, pressing ESC to exit",areaMeasurement:"Pick a point to continue, pressing ESC to exit, click start point to finish",section:"Click to pick a section plane",boxSelect:"Box select an area to confirm the screenshot range",pickMarkup:"Click on a markup to confirm the screenshot range"},PopPanel:{reset:"Reset"}},Uye={NavCube:{front:"前",back:"后",top:"上",bottom:"下",left:"左",right:"右"},ContextMenu:{viewFitAll:"缩放视口到所有模型",hideAll:"全部隐藏",showAll:"全部显示",xRayAll:"全部应用 X 光模式",xRayNone:"清除 X 光模式",selectNone:"清空选择",resetView:"重置视图",viewFitEntity:"缩放视口到实体",hideEntity:"隐藏",hideOthers:"隐藏其他 (隔离)",xRayEntity:"应用 X 光模式",xRayOthers:"对其他实体应用 X 光模式",select:"选择",deselect:"取消选择",showSectionPlane:"显示剖切面",showSectionBox:"显示剖切盒",showAxisSection:"显示轴向剖切",hideSectionPlane:"隐藏剖切面",hideSectionBox:"隐藏剖切盒",hideAxisSection:"隐藏轴向剖切",undoSection:"取消剖切"},ProgressBar:{Loading:"正在加载",Comparing:"正在对比"},Toolbar:{homeView:"主视图",orthoView:"正交视图",measurement:"测量",distanceMeasurement:"距离测量",areaMeasurement:"面积测量",angleMeasurement:"角度测量",coordinateMeasurement:"坐标测量",clearMeasurement:"清除测量",markupVisibility:"批注显隐",markup:"批注",markupArrow:"箭头",markupRect:"矩形框",markupCloudRect:"云线框",markupPolyLine:"多段线",markupCloudLine:"云线",markupEllipse:"椭圆",markupCircle:"圆",markupDot:"点",markupText:"文字",markupX:"叉号",markupStroke:"画笔颜色",markupLineWidth:"线宽",markupLineWidth2:"线宽 2",markupLineWidth5:"线宽 5",markupLineWidth10:"线宽 10",markupFontSize:"字号",markupFontSize14:"14",markupFontSize18:"18",markupFontSize24:"24",clearMarkup:"清除批注",quitMarkup:"退出批注",section:"剖切",axisSection:"轴向剖切",pickSectionPlane:"面剖切",sectionBox:"剖切盒",bimTree:"BIM树",viewpoint:"视点",annotation:"批注",property:"属性",settings:"设置",compared:"图纸对比",quitCompare:"退出图纸对比",fullscreen:"全屏",layers:"图层",zoomToRectangle:"框选放大",screenshot:"截屏"},Tooltip:{measure:"点击继续测量, ESC 取消测量",areaMeasurement:"点击继续测量, ESC 取消测量，点击起点完成测量",section:"点击确定剖切面",boxSelect:"框选一个区域以确定截图范围",pickMarkup:"点击一个批注以确定截图范围"},PopPanel:{reset:"重置"}},$i=class{static materialEquals(e,t){if(e===t)return!0;if(e.type!==t.type)return!1;if(e instanceof qn&&t instanceof qn){let r=e,i=t;return e.alphaTest===t.alphaTest&&e.opacity===t.opacity&&e.side===t.side&&e.visible===t.visible&&e.name===t.name&&e.transparent===t.transparent&&this.colorEquals(r.color,i.color)&&this.colorEquals(r.emissive,i.emissive)&&r.roughness===i.roughness&&r.metalness===i.metalness&&r.alphaMap===i.alphaMap&&r.uniforms===i.uniforms&&r.defines===i.defines&&r.vertexShader===i.vertexShader&&r.fragmentShader===i.fragmentShader&&r.clippingPlanes===i.clippingPlanes&&r.map===i.map&&r.clipIntersection===i.clipIntersection}return!1}static materialsEquals(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)&&e.length===t.length){for(let r=0;r<e.length;++r)if(!this.materialEquals(e[r],t[r]))return!1;return!0}return e instanceof qn&&t instanceof qn&&this.materialEquals(e,t)}static colorEquals(e,t){return e===t||e instanceof dt&&t instanceof dt&&e.equals(t)}static clonedHighlightMaterials(e,t={}){if(!e||!e.material)return;let r=e.material;if(Array.isArray(r)&&r.length>0){let e=[];return r.forEach((r=>{e.push(this.clonedHighlightMaterial(r,t))})),e}if(r instanceof qn)return this.clonedHighlightMaterial(r,t);console.warn(`[MaterialUtils] Invalid material: ${r}`)}static clonedHighlightMaterial(e,t={}){let{depthTest:r,highlightColor:i=new dt(583902),opacity:n=.7}=t,a=e.clone();return this.setMaterialColor(a,i),a.opacity=n,a.transparent=!0,void 0!==r&&(a.depthTest=r,a.side=ln),a}static cloneMaterial(e){if(!e)return e;if(Array.isArray(e)){let t=[];return e.forEach((e=>{t.push(e.clone())})),t}return e.clone()}static getMaterialColor(e){let t=new dt(16777215);return e instanceof Ai||e instanceof Yr||e instanceof Mr?t=e.color:e instanceof xr&&e.uniforms.u_color&&(t=e.uniforms.u_color.value),t}static setMaterialColor(e,t){var r,i,n;let a=e;null==(r=a.color)||r.set(t),null==(i=a.emissive)||i.set(t),null!=(n=a.uniforms)&&n.u_color&&a.uniforms.u_color.value.set(t)}static setMaterialOpacity(e,t){var r;let i=e;i.transparent=!0,i.opacity=t,null!=(r=i.uniforms)&&r.opacity&&(i.uniforms.opacity.value=t)}static cloneMaterials(e){let t=new Map;e.traverse((e=>{e.material&&(e.material=(e=>{let r;return Array.isArray(e)?(r=[],e.forEach((e=>{if(t.has(e))r.push(t.get(e));else{let i=e.clone();t.set(e,i),r.push(i)}}))):e&&(t.has(e)?r=t.get(e):(r=e.clone(),t.set(e,r))),r})(e.material))}))}};function qi(e,t=!1){let r=null!==e[0].index,i=new Set(Object.keys(e[0].attributes)),n=new Set(Object.keys(e[0].morphAttributes)),a={},s={},o=e[0].morphTargetsRelative,l=new Nt,h=0;for(let c=0;c<e.length;++c){let u=e[c],d=0;if(r!==(null!==u.index))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+c+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let e in u.attributes){if(!i.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+c+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===a[e]&&(a[e]=[]),a[e].push(u.attributes[e]),d++}if(d!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+c+". Make sure all geometries have the same number of attributes."),null;if(o!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+c+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let e in u.morphAttributes){if(!n.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+c+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===s[e]&&(s[e]=[]),s[e].push(u.morphAttributes[e])}if(t){let e;if(r)e=u.index.count;else{if(void 0===u.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+c+". The geometry must have either an index or a position attribute"),null;e=u.attributes.position.count}l.addGroup(h,e,c),h+=e}}if(r){let t=0,r=[];for(let i=0;i<e.length;++i){let n=e[i].index;for(let e=0;e<n.count;++e)r.push(n.getX(e)+t);t+=e[i].attributes.position.count}l.setIndex(r)}for(let e in a){let t=Hye(a[e]);if(!t)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+e+" attribute."),null;l.setAttribute(e,t)}for(let e in s){let t=s[e][0].length;if(0===t)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[e]=[];for(let r=0;r<t;++r){let t=[];for(let i=0;i<s[e].length;++i)t.push(s[e][i][r]);let i=Hye(t);if(!i)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+e+" morphAttribute."),null;l.morphAttributes[e].push(i)}}return l}function Hye(e){let t,r,i,n=-1,a=0;for(let s=0;s<e.length;++s){let o=e[s];if(o.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=o.array.constructor),t!==o.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===r&&(r=o.itemSize),r!==o.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===i&&(i=o.normalized),i!==o.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(-1===n&&(n=o.gpuType),n!==o.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;a+=o.array.length}let s=new t(a),o=0;for(let t=0;t<e.length;++t)s.set(e[t].array,o),o+=e[t].array.length;let l=new fr(s,r,i);return void 0!==n&&(l.gpuType=n),l}function Vye(e,t=1e-4){t=Math.max(t,Number.EPSILON);let r={},i=e.getIndex(),n=e.getAttribute("position"),a=i?i.count:n.count,s=0,o=Object.keys(e.attributes),l={},h={},c=[],u=["getX","getY","getZ","getW"],d=["setX","setY","setZ","setW"];for(let t=0,r=o.length;t<r;t++){let r=o[t],i=e.attributes[r];l[r]=new fr(new i.array.constructor(i.count*i.itemSize),i.itemSize,i.normalized);let n=e.morphAttributes[r];n&&(h[r]=new fr(new n.array.constructor(n.count*n.itemSize),n.itemSize,n.normalized))}let p=.5*t,f=Math.log10(1/t),m=Math.pow(10,f),g=p*m;for(let t=0;t<a;t++){let n=i?i.getX(t):t,a="";for(let t=0,r=o.length;t<r;t++){let r=o[t],i=e.getAttribute(r),s=i.itemSize;for(let e=0;e<s;e++)a+=~~(i[u[e]](n)*m+g)+","}if(a in r)c.push(r[a]);else{for(let t=0,r=o.length;t<r;t++){let r=o[t],i=e.getAttribute(r),a=e.morphAttributes[r],c=i.itemSize,p=l[r],f=h[r];for(let e=0;e<c;e++){let t=u[e],r=d[e];if(p[r](s,i[t](n)),a)for(let e=0,i=a.length;e<i;e++)f[e][r](s,a[e][t](n))}}r[a]=s,c.push(s),s++}}let v=e.clone();for(let t in e.attributes){let e=l[t];if(v.setAttribute(t,new fr(e.array.slice(0,s*e.itemSize),e.itemSize,e.normalized)),t in h)for(let e=0;e<h[t].length;e++){let r=h[t][e];v.morphAttributes[t][e]=new fr(r.array.slice(0,s*r.itemSize),r.itemSize,r.normalized)}}return v.setIndex(c),v}function QV(e,t){if(t===$4)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===h1||t===j_){let r=e.getIndex();if(null===r){let t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}let i=r.count-2,n=[];if(t===h1)for(let e=1;e<=i;e++)n.push(r.getX(0)),n.push(r.getX(e)),n.push(r.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(n.push(r.getX(e)),n.push(r.getX(e+1)),n.push(r.getX(e+2))):(n.push(r.getX(e+2)),n.push(r.getX(e+1)),n.push(r.getX(e)));n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let a=e.clone();return a.setIndex(n),a.clearGroups(),a}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}var lbt=new F(0,1,0),xu=class{static resetObjectStyle(e){this.revertWireframeMode(e),this.revertObjectOpacity(e,[]),this.revertAppliedMaterialToObject(e),this.revertVisibleForFloors(e)}static resetObjectStyleById(e,t){let r=this.getObjectById(e,t);this.resetObjectStyle(r)}static setObjectOpacity(e,t=.3,r,i){let n=[],a=e=>{n.find((t=>t.id===e.id))||(n.push({id:e.id,opacity:e.opacity,transparent:e.transparent,side:e.side}),e.opacity*=t,e.transparent=!0,e.side=ln)},s=e=>{let r=n.find((t=>t.id===e.id));if(!r){let r=e.clone();return n.push({id:e.id,opacity:e.opacity,transparent:e.transparent,side:e.side,material:e,clonedMaterial:r}),r.opacity*=t,r.transparent=!0,r}return r.clonedMaterial};return e.traverse((e=>{if((!i||-1===i.indexOf(e.id))&&(!r||-1!==r.indexOf(e.id))&&e instanceof Ht){let t=e;if(r||i){if(Array.isArray(t.material)){let e=[];t.material.forEach((t=>{let r=s(t);r&&e.push(r)})),t.material=e}else if(t.material){let e=s(t.material);e&&(t.material=e)}}else if(Array.isArray(t.material))t.material.forEach((e=>{a(e)}));else if(t.material){let e=t.material;a(e)}}})),n}static revertObjectOpacity(e,t,r,i){let n=new Set,a=e=>{if(!e||null==e.id||n.has(e.id))return;n.add(e.id);let r=t.find((t=>t.id===e.id));r&&(e.opacity=r.opacity,e.transparent=r.transparent,e.side=r.side,0===e.opacity&&de.warn(`[ObjectUtils] Material '${e.name}'s opacity is 0, you may not be able to see your objects!`))},s=e=>{let r=t.find((t=>t.clonedMaterial&&t.clonedMaterial.id===e.id));if(r)return r.material};e.traverse((e=>{if((!i||-1===i.indexOf(e.id))&&(!r||-1!==r.indexOf(e.id))&&e instanceof Ht)if(Array.isArray(e.material)){let t=[];e.material.forEach((e=>{let r=s(e);r?t.push(r):a(e)})),e.material=t}else if(e.material){let t=s(e.material);t?e.material=t:a(e.material)}}))}static setObjectOpacityById(e,t,r=.3,i,n){let a=e.getObjectById(t);if(!a)throw new Error(`Failed to find object by id: ${t}`);return xu.setObjectOpacity(a,r,i,n)}static revertObjectOpacityById(e,t,r,i,n){let a=e.getObjectById(t);if(!a)throw new Error(`Failed to find object by id: ${t}`);xu.revertObjectOpacity(a,r,i,n)}static applyMaterialToObject(e,t,r,i){e.traverse((e=>{i&&-1!==i.indexOf(e.id)||r&&-1===r.indexOf(e.id)||e instanceof Ht&&(e.userData.originalMaterial||(e.userData.originalMaterial=e.material),e.material=t)}))}static revertAppliedMaterialToObject(e,t,r){e.traverse((e=>{r&&-1!==r.indexOf(e.id)||t&&-1===t.indexOf(e.id)||e.userData.originalMaterial&&(e.material=e.userData.originalMaterial,e.userData.originalMaterial=void 0)}))}static applyMaterialToObjectById(e,t,r,i,n){let a=e.getObjectById(t);if(!a)throw new Error(`Failed to find object by id: ${t}`);this.applyMaterialToObject(a,r,i,n)}static revertAppliedMaterialToObjectById(e,t,r,i){let n=e.getObjectById(t);if(!n)throw new Error(`Failed to find object by id: ${t}`);this.revertAppliedMaterialToObject(n,r,i)}static applyOpacityMaterialToObject(e,t,r){let i=new Mr({color:0,transparent:!0,opacity:.05});this.applyMaterialToObject(e,i,t,r)}static setWireframeMode(e){let t=new Mr({color:16732160,wireframe:!0,transparent:!0,opacity:.8});e.traverseVisible((e=>{if(e instanceof Ht){let r=e;r.userData.materialForWireframe=r.material,r.material=t}}))}static setWireframeModeById(e,t){let r=e.getObjectById(t);if(!r)throw new Error(`Failed to find object by id: ${t}`);xu.setWireframeMode(r)}static revertWireframeMode(e){e.traverseVisible((e=>{e instanceof Ht&&e.userData.materialForWireframe&&(e.material=e.userData.materialForWireframe,e.userData.materialForWireframe=void 0)}))}static revertWireframeModeById(e,t){let r=e.getObjectById(t);if(!r)throw new Error(`Failed to find object by id: ${t}`);xu.revertWireframeMode(r)}static findInner(e,t,r=[],i=!1){let n=t.toLowerCase(),a=[],s=e=>-1!==e.toLowerCase().indexOf(n),o=e=>-1!==e.toString().indexOf(n),l=e=>{if(e.name&&-1!==e.name.toLowerCase().indexOf(n))return!0;if(e.gltfExtensions){let t=e.gltfExtensions,r=t.objectId&&t.objectId.Value||t.elementId&&t.elementId.Value;if(r&&-1!==r.toLowerCase().indexOf(n))return!0}return!1};if(r.length>0)for(let t=0;t<r.length;++t){let n=r[t],h=e.getObjectById(n);if(h&&h.traverse((e=>{(s(e.name)||o(e.id)||l(e.userData))&&a.push(e)})),i&&a.length>0)return[a[0]]}else if(e.traverse((e=>{(s(e.name)||o(e.id)||l(e.userData))&&a.push(e)})),i&&a.length>0)return[a[0]];return a}static find(e,t,r=[],i=!1){return this.findInner(e,t,r,i)}static findFirst(e,t,r=[],i=!1){let n=this.findInner(e,t,r,i);if(n.length>0)return n[0]}static getFloorsFromString(e){let t=[],r=new RegExp(/(?:-?(?:\d+(?:\.5)?)F)(?=\W|$)/,"g").exec(e);return r&&r.length>0&&r.forEach((e=>{if(e){let r=e.replace("F",""),i=Number(r);i?t.push(i):console.log(`[OU] invalid floor: ${e}`)}})),t}static matchFloor(e,t){return-1!==this.getFloorsFromString(e).findIndex((e=>e===t))}static matchFloors(e,t){return-1!==this.getFloorsFromString(e).findIndex((e=>-1!==t.findIndex((t=>t===e))))}static distinctFloors(e,t){let r=[],i=e=>{this.getFloorsFromString(e).forEach((e=>{r[e]=!0}))};return t.forEach((t=>{let r=e.getObjectById(t);r&&r.traverse((e=>{if(i(e.name),e.userData.gltfExtensions){let t=e.userData.gltfExtensions;t.level&&t.level.Value&&i(t.level.Value)}}))})),Object.keys(r).sort()}static traverseObjectByFloors(e,t,r,i,n){let a=e.getObjectById(t);if(!a)return[];a.traverse((e=>{let t=this.matchFloors(e.name,r);if(!t&&e.userData&&e.userData.gltfExtensions){let i=e.userData.gltfExtensions;i.level&&i.level.Value&&(t=this.matchFloors(i.level.Value,r))}t&&i&&i(e),!t&&n&&n(e)}))}static setVisibleForFloors(e,t,r,i=!0){this.traverseObjectByFloors(e,t,r,(e=>{let t=e;for(;t;)t.visible=!0,t=t.parent||void 0}),(e=>{i&&(e.visible=!1)}))}static revertVisibleForFloors(e){e.traverse((e=>{e.visible=!0}))}static revertVisibleForFloorsById(e,t){let r=this.getObjectById(e,t);this.revertVisibleForFloors(r)}static getObjectById(e,t){let r=e.getObjectById(t);if(!r)throw new Error(`Failed to find object by id: ${t}`);return r}static createOutlines(e){return bt(this,arguments,(function*(e,t={onlyVisible:!0,meshOnly:!0},r){if(!e)return[];if(0===e.children.length&&(t.onlyVisible&&!e.visible||t.meshOnly&&!(e instanceof Ht)))return[];let i=[],n=e,a=n.children.length,s=Math.round(Math.pow(a,.5)),o=Ut.getUpdateProgressFuncAsync(r);for(let e=a-1;e>=0;--e){let o,l=a-e-1;if(r&&(l%s==0||0===l||l===a-1)){let e=90*l/a,t=90*(l+1)/a;o=Ut.getUpdateSubProgressFunc(e,t,r)}let h=n.children[e],c=yield this.createOutlines(h,t,o);i.push(...c)}if(!n.geometry)return yield o(100),i;if(n instanceof Ht&&!this.hasOutline(n,!1)){yield o(50);let e=this.createOutline(n.geometry);n.add(e),e.updateWorldMatrix(!0,!1),i.push(e)}return yield o(100),i}))}static removeOutlines(e){if(e&&Array.isArray(e.children))for(let t=e.children.length-1;t>=0;--t){let r=e.children[t];r.children.length>0&&this.removeOutlines(r),r.userData.isOutline&&e.remove(r)}}static hasOutline(e,t=!0){let r=!1;for(let i=0;i<e.children.length;++i){let n=e.children[i];if(n.userData.isOutline){r=!0;break}if(t&&n.children.length>0&&(r=this.hasOutline(n),r))break}return r}static setOutlinesVisibility(e,t){e.traverse((e=>{e.userData.isOutline&&(e.visible=t)}))}static createOutline(e,t=this.OUTLINE_MATERIAL,r){let i=new _h(e,RP),n=new Wn(i,t);return n.layers.enableAll(),xu.disableLayerChannels(n,[12,11]),n.userData.isOutline=!0,n.matrixAutoUpdate=!1,r&&n.applyMatrix4(r),n}static cloneObject(e,t=!0){let r=e.clone();return t&&r.traverse((e=>{(e instanceof Ht||e instanceof jn)&&(e.material=$i.cloneMaterial(e.material))})),r}static createBox(e,t,r,i=xu.BOX_FACE_MATERIAL,n=!0){let a=[],s=(e,t,r)=>{a.push(new F(e,t,r))};s(0,0,0),s(e,0,0),s(e,t,0),s(0,t,0),s(0,0,r),s(e,0,r),s(e,t,r),s(0,t,r);let o=new Nt;o.setFromPoints(a);let l=[0,3,2,0,2,1,4,6,7,4,5,6,0,7,3,0,4,7,3,6,2,3,7,6,1,6,5,1,2,6];return n&&l.push(0,5,4,0,1,5),o.setIndex(l),o.computeVertexNormals(),new Ht(o,i)}static rebaseObjectOnRTC(e){let t=e;if(!((t.isMesh||t.isLine||t.isPoints)&&t.geometry&&t.geometry instanceof Nt))return e;let r=t.geometry;if(!r.hasAttribute("position"))return e;let i=r.getAttribute("position");if(0===i.count)return e;let n=i.itemSize,a=i.array,s=[];for(let e=0;e<n;e++)s.push(a[e]);for(let e=0;e<i.count;e++)for(let t=0;t<n;t++)a[e*n+t]-=s[t];e.updateMatrix();let o=e.matrix.clone();e.matrix.makeTranslation(s[0],s[1],s.length>2?s[2]:0);let l=e.matrixAutoUpdate;return e.matrixAutoUpdate=!1,e.applyMatrix4(o),e.matrixAutoUpdate=l,e}static isEmptyObject(e){if(0===e.children.length){let t=e.geometry;if(!t||!t.hasAttribute("position")||0===t.getAttribute("position").count)return!0}return!1}static removeEmptyObjects(e){for(let t=0;t<e.children.length;)this.removeEmptyObjects(e.children[t])||++t;return!!this.isEmptyObject(e)&&(e.removeFromParent(),!0)}static removeEmptyObjectsFromRemovingObjects(e,t){0!==e.length&&(e.forEach((e=>{e.removeFromParent()})),this.removeEmptyObjects(t))}static setSharedVariablesOfObject(e){e.uuid="",e.up=lbt;let t=e;t.material&&(Array.isArray(t.material)?t.material.forEach((e=>{e.uuid&&(e.uuid="")})):t.material.uuid&&(t.material.uuid=""))}static isLeafObject(e){return(e instanceof Ht||e instanceof jn||e instanceof Di)&&!!e.geometry}static enableLayerChannels(e,t,r=!0){for(let r=0,i=t.length;r<i;r++)e.layers.enable(t[r]);if(r){let r=e.children;for(let e=0,i=r.length;e<i;e++)xu.enableLayerChannels(r[e],t,!0)}}static disableLayerChannels(e,t,r=!0){for(let r=0,i=t.length;r<i;r++)e.layers.disable(t[r]);if(r){let r=e.children;for(let e=0,i=r.length;e<i;e++)xu.disableLayerChannels(r[e],t,!0)}}static setLayerChannels(e,t,r=!0){e.layers.disableAll();for(let r=0,i=t.length;r<i;r++)e.layers.enable(t[r]);if(r){let r=e.children;for(let e=0,i=r.length;e<i;e++)xu.setLayerChannels(r[e],t,!0)}}static isObjectHittable(e){return e.layers.isEnabled(10)}static isObjectSnapable(e){return e.layers.isEnabled(11)}static isObjectSelectable(e){return e.layers.isEnabled(12)}},pn=xu;pn.OUTLINE_MATERIAL=new Yr({name:"outline",color:0,transparent:!0,opacity:.2}),pn.BOX_FACE_MATERIAL=new Da({color:11648971,transparent:!0,opacity:.3,side:zi});var NP=new lt,cbt=new lt,UP=class{static resetMergeInfo(){this.MergeInfo.removedObjects=0,this.MergeInfo.mergedMeshes=0,this.MergeInfo.mergedLines=0,this.MergeInfo.mergedPoints=0,this.MergeInfo.mergedUnknownTypeObjects=0,this.MergeInfo.elapsedTime=0}static merge(e,t=!0){let r=Date.now();this.mergeInner(e,t),this.MergeInfo.elapsedTime+=Date.now()-r}static mergeInner(e,t=!0){if(!e.children||e.children.length<1)return;let r=e.children.length,i={},n=[];for(let a=0;a<r;++a){let r=e.children[a];if(r.children.length>0){this.mergeInner(r,t);continue}if(r.isInstancedMesh||!r.geometry||!(r.geometry instanceof Nt))continue;let s=!1,o=Object.values(i);for(let t=o.length-1;t>=0;--t){let r=o[t].indexes[0];if(s=this.tryHandleMergeableObjects(e,a,r,i,n),s)break}for(let t=n.length-1;!s&&t>=0;--t){let r=n[t];if(s=this.tryHandleMergeableObjects(e,a,r,i,n),s)break}s||n.push(a)}if(Object.keys(i).length<=0)return;let a=[],s=[],o=[],l=[];Object.values(i).forEach((r=>{let i,n=r.indexes,h=e.children[n[0]],c=[],u=0,d=0,p=0,f=[];if(n.forEach((r=>{var i,n,a;let s=e.children[r],o=s.geometry.clone();if(o.applyMatrix4(s.matrix),pr.tryConvertInterleavedBufferAttributes(o),o.userData.isLineSegments=!0===s.isLineSegments,c.push(o),t){let e=s.name,t=null==(n=null==(i=o.attributes)?void 0:i.position)?void 0:n.count,r=(null==(a=o.index)?void 0:a.count)||0,l={batchId:u,name:e,positionStart:d,positionCount:t,indexStart:p,indexCount:r};0!==Object.keys(s.userData).length&&(l.userData=s.userData),f.push(l),d+=t,p+=r,u++}})),0!==c.length){if(h.isMesh){let e=qi(c);if(!e)return;e.userData={},i=new Ht(e,h.material),a.push(i)}else if(h.isLine){let e=this.mergeLineGeometries(c,t,h.material instanceof wh||h.material instanceof xr,f);if(!e)return;i=new Wn(e,h.material),s.push(i)}else if(h.isPoints){let e=qi(c);if(!e)return;e.userData={},i=new Di(e,h.material),o.push(i)}i&&(t?i.userData.batches=f:(i.userData=h.userData,i.userData.batches=void 0),i.userData.layerName=h.userData.layerName,i.name=`[Merged] ${h.name}`,i.matrixAutoUpdate=!1,i.renderOrder=h.renderOrder,i.layers.mask=h.layers.mask,i.visible=h.visible,l.push(...n)),c.forEach((e=>{e.dispose(),pr.releaseGeometryManually(e)})),c=[]}})),l.sort(((e,t)=>t-e)),l.forEach((t=>{let r=e.children[t];e.remove(r)})),[...a,...s,...o].forEach((t=>{e.add(t)})),e.updateMatrix(),this.MergeInfo.removedObjects+=l.length,this.MergeInfo.mergedMeshes+=a.length,this.MergeInfo.mergedLines+=s.length,this.MergeInfo.mergedPoints+=o.length}static tryHandleMergeableObjects(e,t,r,i,n){let a=!1,s=Array.isArray(e),o=s?e.length:e.children.length;if(t===r||t>=o||r>=o)return a;let l=s?e[t]:e.children[t],h=s?e[r]:e.children[r];return this.areObjectsMergeable(l,h)&&this.areGeometriesMergeable(l.geometry,h.geometry)&&$i.materialsEquals(l.material,h.material)&&(i[r]||(i[r]={indexes:[r]},this.removeFromArray(n,r)),i[r].indexes.push(t),a=!0),a}static deepMerge(e,t=void 0,r=!0,i=!0,n=!0){let a={added:[],removed:[]};if(e.length<=1)return a;let s=Date.now(),o={},l=[];for(let t=0;t<e.length;++t){let r=e[t];if(r.isInstancedMesh||!r.geometry||!(r.geometry instanceof Nt))continue;let i=!1,n=Object.values(o);for(let r=n.length-1;r>=0;--r){let a=n[r].indexes[0];if(i=this.tryHandleMergeableObjects(e,t,a,o,l),i)break}for(let r=l.length-1;!i&&r>=0;--r){let n=l[r];if(i=this.tryHandleMergeableObjects(e,t,n,o,l),i)break}i||l.push(t)}if(Object.keys(o).length<=0)return a;de.debug(`[Merge] Built merged indexes for ${e.length} objects in ${(Date.now()-s)/1e3}s`),s=Date.now();let h=[],c=[],u=[],d=[];Object.values(o).forEach((r=>{let i=r.indexes;if(i.length<2)return;let a,s=e[i[0]],o=[],l=0,p=0,f=0,m=[];if(i.forEach((r=>{var i,a,h;let c=e[r],u=c.geometry.clone();if(s.material instanceof Yr&&u.deleteAttribute("lineDistance"),this.applyMatrix(u,c,t),u.userData.isLineSegments=!0===c.isLineSegments,o.push(u),n){let e,t=c.name,r=null==(a=null==(i=u.attributes)?void 0:i.position)?void 0:a.count,n=(null==(h=u.index)?void 0:h.count)||0;s.isLine&&(u.boundingSphere||u.computeBoundingSphere(),e=u.boundingSphere.clone());let o={batchId:l,name:t,positionStart:p,positionCount:r,indexStart:f,indexCount:n,boundingSphere:e};!c.parent.geometry&&0!==Object.keys(c.parent.userData).length&&(o.parentUserData=c.parent.userData),0!==Object.keys(c.userData).length&&(o.userData=c.userData),m.push(o),p+=r,f+=n,l++}})),0!==o.length){if(s.isMesh){let e=qi(o);if(!e)return;e.userData={},a=new Ht(e,s.material),h.push(a)}else if(s.isLine){let e=this.mergeLineGeometries(o,n,s.material instanceof wh||s.material instanceof xr,m);if(!e)return;a=new Wn(e,s.material),c.push(a)}else if(s.isPoints){let e=qi(o);if(!e)return;e.userData={},a=new Di(e,s.material),u.push(a)}a&&(n?a.userData.batches=m:(a.userData=s.userData,a.userData.batches=void 0),a.userData.layerName=s.userData.layerName,a.name=`[Merged] ${s.name}`,a.matrixAutoUpdate=!1,a.renderOrder=s.renderOrder,a.layers.mask=s.layers.mask,a.visible=s.visible,i.forEach((e=>d.push(e)))),o.forEach((e=>{e.dispose(),pr.releaseGeometryManually(e)})),o=[]}})),de.debug(`[Merge] Ran deepMerge() in ${(Date.now()-s)/1e3}s`);let p=a.removed;d.forEach((t=>{let i=e[t];p.push(i),r&&i.removeFromParent()}));let f=a.added;return[...h,...c,...u].forEach((e=>{f.push(e),r&&t&&(t.add(e),e.updateWorldMatrix(!1,!1))})),this.MergeInfo.removedObjects+=d.length,this.MergeInfo.mergedMeshes+=h.length,this.MergeInfo.mergedLines+=c.length,this.MergeInfo.mergedPoints+=u.length,i&&t&&pn.removeEmptyObjects(t),a}static applyMatrix(e,t,r){let i=t;for(NP.identity();i&&i!==r&&(NP.premultiply(i.matrix),i.parent);)i=i.parent;return NP.equals(cbt)?e:e.applyMatrix4(NP)}static mergeLineGeometries(e,t,r,i){let n;if(r)n=UP.mergeBufferGeometriesWithLinesToLineSegments(e,t,i);else{if(n=qi(e),!n)return;n.userData={};let r=[],a=0;e.forEach(((e,n)=>{let s=e.attributes.position;if(!s)return;let o=e.index,l=!0===e.userData.isLineSegments,h=r.length;if(o)for(let e=0;e<o.count;e++){let t=o.array[e];l?r.push(a+t):e>0&&r.push(a+o.array[e-1],a+t)}else for(let e=0;e<s.count;e++)e>0&&(l?e%2==1&&r.push(a+e-1,a+e):r.push(a+e-1,a+e));a+=s.count,t&&i&&(i[n].indexStart=h,i[n].indexCount=r.length-h)})),n.setIndex(r)}return n}static mergeBufferGeometriesWithLinesToLineSegments(e,t,r){let i=new Set(Object.keys(e[0].attributes)),n={},a=new Nt,s=[],o=0;for(let a=0;a<e.length;++a){let l=e[a],h=!0===l.userData.isLineSegments;s.push(h),l.index&&(de.debug(`[Merge] Geometry '${a}' contains index buffer, going to convert it to non-indexed.`),l=pr.convertGeometryWithIndexedToNonIndexed(l));let c=0;for(let e in l.attributes){if(!i.has(e))return void de.error(`[Merge] mergeGeometries() failed with geometry at index ${a}. All geometries must have compatible attributes; make sure ${e} attribute exists among all geometries, or in none of them`);n[e]||(n[e]=[]),n[e].push(l.attributes[e]),c++}if(c!==i.size)return void de.error(`[Merge] mergeGeometries() failed with geometry at index ${a}. Make sure all geometries have the same number of attributes.`);if(t&&r){let e=l.attributes.position;r[a].indexStart=0,r[a].indexCount=0;let t=h?e.count:2*e.count-2;r[a].positionStart=o,r[a].positionCount=t,o+=t}}for(let e in n){let t=UP.mergeBufferAttributesWithLinesToLineSegments(n[e],s);if(!t)return void de.error(`[Merge] mergeGeometries() failed while trying to merge the ${e} attribute.`);a.setAttribute(e,t)}return a}static mergeBufferAttributesWithLinesToLineSegments(e,t){let r,i,n,a=0;for(let s=0;s<e.length;++s){let o=e[s];if(void 0===r&&(r=o.array.constructor),r!==o.array.constructor)return void de.error("[Merge] mergeBufferAttributes() failed. THREE.BufferAttribute.array must be of consistent array types across matching attributes.");if(void 0===i&&(i=o.itemSize),i!==o.itemSize)return void de.error("[Merge] mergeBufferAttributes() failed. THREE.BufferAttribute.itemSize must be consistent across matching attributes.");if(void 0===n&&(n=o.normalized),n!==o.normalized)return void de.error("[Merge]  mergeBufferAttributes() failed. THREE.BufferAttribute.normalized must be consistent across matching attributes.");let l=t[s]?0:o.count-2;a+=(o.count+l)*i}let s=new r(a),o=0;for(let i=0;i<e.length;++i){let n=t[i],a=e[i],l=n?0:a.count-2,h=a.count+l,c=a.itemSize,u=new r(h*c),d=0;for(let e=0;e<a.count;e++){let t=e*c,r=0!==e&&e!==a.count-1&&!n;for(let e=0;e<c;e++)u[d+e]=a.array[t+e],r&&(u[d+c+e]=a.array[t+e]);d+=r?2*c:c}s.set(u,o),o+=h*c}return new fr(s,i,n)}static removeFromArray(e,t){for(let r=e.length-1;r>=0;--r)if(e[r]===t)return void e.splice(r,1)}static removeObjectFromArray(e,t){for(let r=e.length-1;r>=0;--r)if(e[r]===t)return void e.splice(r,1)}static areGeometriesMergeable(e,t){if(!e||!t||"InstancedBufferGeometry"===e.type||"InstancedBufferGeometry"===t.type||!!e.index!=!!t.index)return!1;let r=Object.keys(e.attributes);if(r.length!==Object.keys(t.attributes).length)return!1;for(let e of r)if(!t.attributes[e])return!1;return!0}static areObjectsMergeable(e,t){if(e.layers.mask!==t.layers.mask||e.renderOrder!==t.renderOrder||e.visible!==t.visible||e.userData.layerName!==t.userData.layerName)return!1;if(e.type===t.type)return!0;let r=e,i=t;return r.isMesh&&i.isMesh||r.isLine&&i.isLine||r.isPoints&&i.isPoints}static isMergedMesh(e){return!(!e||!e.userData.batches)}static isFaceIndexInBatch(e,t,r){if(e.boundsTree){let i=e.index.getX(3*r);if(i>=t.positionStart&&i<t.positionStart+t.positionCount)return!0}else if(e.index){let e=t.indexStart/3,i=(t.indexStart+t.indexCount)/3-1;if(r>=e&&r<=i)return!0}else{let e=3*r;if(e>=t.positionStart&&e<t.positionStart+t.positionCount)return!0}return!1}static getBatchByFaceIndex(e,t){if(t<0)return void de.error(`[Merge]: Invalid faceIndex: ${t}`);let r=e&&e.geometry&&e.userData.batches;if(r)for(let i=0;i<r.length;++i){let n=r[i];if(this.isFaceIndexInBatch(e.geometry,n,t))return n}}static getBatchByLineIndex(e,t){if(t<0)return void de.error(`[Merge]: Invalid index: ${t}`);let r=e&&e.geometry&&e.userData.batches;if(!r)return;let i=e.geometry.index;for(let e=0;e<r.length;++e){let n=r[e];if(i){if(t>=n.indexStart&&t<n.indexStart+n.indexCount)return n}else if(t>=n.positionStart&&t<n.positionStart+n.positionCount)return n}}static getBatchIdByFaceIndex(e,t){let r=this.getBatchByFaceIndex(e,t);return r?r.batchId:-1}static getBatchByBatchId(e,t){let r=e&&e.geometry&&e.userData.batches;if(r)for(let e=0;e<r.length;++e){let i=r[e];if(i.batchId===t)return i}}static cloneGeometryForBatch(e,t){var r;let i=e&&e.geometry;if(!i)return;let n=i.attributes.position,a=null==n?void 0:n.array,s=null==(r=i.index)?void 0:r.array;if(!a||!s)return void de.warn(`[Merge]: Unexpected position: ${a}, or index: ${s}!`);let o=new Nt,l=t.positionStart,h=t.positionStart+t.positionCount,c=i.attributes;for(let e in c){let t=c[e],r=t.itemSize,i=t.array.slice(l*r,h*r);o.setAttribute(e,new fr(i,r,t.normalized))}if(i.boundsTree&&(s=i.userData.originalIndex,!s))return void de.warn("[Merge] After building bvh, the original index data is not preserved !");let u=t.indexStart,d=t.indexStart+t.indexCount,p=[],f=0;for(let e=u;e<d&&e<s.length;++e)p[f++]=s[e]-t.positionStart;return o.setIndex(p),i.boundingBox&&o.computeBoundingBox(),i.boundingSphere&&o.computeBoundingSphere(),o}},Zi=UP;Zi.MergeInfo={removedObjects:0,mergedMeshes:0,mergedLines:0,mergedPoints:0,mergedUnknownTypeObjects:0,elapsedTime:0};var f1e=ra(o1e(),1),c1e={triangulate:function(e,t,r=2){let i,n,a,s,o,l,h,c=t&&t.length,u=c?t[0]*r:e.length,d=u1e(e,0,u,r,!0),p=[];if(!d||d.next===d.prev)return p;if(c&&(d=qbt(e,t,d,r)),e.length>80*r){i=a=e[0],n=s=e[1];for(let t=r;t<u;t+=r)o=e[t],l=e[t+1],o<i&&(i=o),l<n&&(n=l),o>a&&(a=o),l>s&&(s=l);h=Math.max(a-i,s-n),h=0!==h?32767/h:0}return uT(d,p,r,i,n,h,0),p}};function u1e(e,t,r,i,n){let a,s;if(n===txt(e,t,r,i)>0)for(a=t;a<r;a+=i)s=l1e(a,e[a],e[a+1],s);else for(a=r-i;a>=t;a-=i)s=l1e(a,e[a],e[a+1],s);return s&&YP(s,s.next)&&(dT(s),s=s.next),s}function t0(e,t){if(!e)return e;t||(t=e);let r,i=e;do{if(r=!1,i.steiner||!YP(i,i.next)&&0!==As(i.prev,i,i.next))i=i.next;else{if(dT(i),i=t=i.prev,i===i.next)break;r=!0}}while(r||i!==t);return t}function uT(e,t,r,i,n,a,s){if(!e)return;!s&&a&&$bt(e,i,n,a);let o,l,h=e;for(;e.prev!==e.next;)if(o=e.prev,l=e.next,a?Vbt(e,i,n,a):Hbt(e))t.push(o.i/r|0),t.push(e.i/r|0),t.push(l.i/r|0),dT(e),e=l.next,h=l.next;else if((e=l)===h){s?1===s?uT(e=zbt(t0(e),t,r),t,r,i,n,a,2):2===s&&Gbt(e,t,r,i,n,a):uT(t0(e),t,r,i,n,a,1);break}}function Hbt(e){let t=e.prev,r=e,i=e.next;if(As(t,r,i)>=0)return!1;let n=t.x,a=r.x,s=i.x,o=t.y,l=r.y,h=i.y,c=n<a?n<s?n:s:a<s?a:s,u=o<l?o<h?o:h:l<h?l:h,d=n>a?n>s?n:s:a>s?a:s,p=o>l?o>h?o:h:l>h?l:h,f=i.next;for(;f!==t;){if(f.x>=c&&f.x<=d&&f.y>=u&&f.y<=p&&P1(n,o,a,l,s,h,f.x,f.y)&&As(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Vbt(e,t,r,i){let n=e.prev,a=e,s=e.next;if(As(n,a,s)>=0)return!1;let o=n.x,l=a.x,h=s.x,c=n.y,u=a.y,d=s.y,p=o<l?o<h?o:h:l<h?l:h,f=c<u?c<d?c:d:u<d?u:d,m=o>l?o>h?o:h:l>h?l:h,g=c>u?c>d?c:d:u>d?u:d,v=a8(p,f,t,r,i),y=a8(m,g,t,r,i),b=e.prevZ,x=e.nextZ;for(;b&&b.z>=v&&x&&x.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==n&&b!==s&&P1(o,c,l,u,h,d,b.x,b.y)&&As(b.prev,b,b.next)>=0||(b=b.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==n&&x!==s&&P1(o,c,l,u,h,d,x.x,x.y)&&As(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;b&&b.z>=v;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==n&&b!==s&&P1(o,c,l,u,h,d,b.x,b.y)&&As(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==n&&x!==s&&P1(o,c,l,u,h,d,x.x,x.y)&&As(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function zbt(e,t,r){let i=e;do{let n=i.prev,a=i.next.next;!YP(n,a)&&h1e(n,i,i.next,a)&&hT(n,a)&&hT(a,n)&&(t.push(n.i/r|0),t.push(i.i/r|0),t.push(a.i/r|0),dT(i),dT(i.next),i=e=a),i=i.next}while(i!==e);return t0(i)}function Gbt(e,t,r,i,n,a){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&Jbt(s,e)){let o=d1e(s,e);return s=t0(s,s.next),o=t0(o,o.next),uT(s,t,r,i,n,a,0),void uT(o,t,r,i,n,a,0)}e=e.next}s=s.next}while(s!==e)}function qbt(e,t,r,i){let n,a,s,o,l,h=[];for(n=0,a=t.length;n<a;n++)s=t[n]*i,o=n<a-1?t[n+1]*i:e.length,l=u1e(e,s,o,i,!1),l===l.next&&(l.steiner=!0),h.push(Kbt(l));for(h.sort(jbt),n=0;n<h.length;n++)r=Wbt(h[n],r);return r}function jbt(e,t){return e.x-t.x}function Wbt(e,t){let r=Xbt(e,t);if(!r)return t;let i=d1e(r,e);return t0(i,i.next),t0(r,r.next)}function Xbt(e,t){let r,i=t,n=-1/0,a=e.x,s=e.y;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){let e=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=a&&e>n&&(n=e,r=i.x<i.next.x?i:i.next,e===a))return r}i=i.next}while(i!==t);if(!r)return null;let o,l=r,h=r.x,c=r.y,u=1/0;i=r;do{a>=i.x&&i.x>=h&&a!==i.x&&P1(s<c?a:n,s,h,c,s<c?n:a,s,i.x,i.y)&&(o=Math.abs(s-i.y)/(a-i.x),hT(i,e)&&(o<u||o===u&&(i.x>r.x||i.x===r.x&&Ybt(r,i)))&&(r=i,u=o)),i=i.next}while(i!==l);return r}function Ybt(e,t){return As(e.prev,e,t.prev)<0&&As(t.next,e,e.next)<0}function $bt(e,t,r,i){let n=e;do{0===n.z&&(n.z=a8(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,Zbt(n)}function Zbt(e){let t,r,i,n,a,s,o,l,h=1;do{for(r=e,e=null,a=null,s=0;r;){for(s++,i=r,o=0,t=0;t<h&&(o++,i=i.nextZ,i);t++);for(l=h;o>0||l>0&&i;)0!==o&&(0===l||!i||r.z<=i.z)?(n=r,r=r.nextZ,o--):(n=i,i=i.nextZ,l--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;r=i}a.nextZ=null,h*=2}while(s>1);return e}function a8(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Kbt(e){let t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function P1(e,t,r,i,n,a,s,o){return(n-s)*(t-o)>=(e-s)*(a-o)&&(e-s)*(i-o)>=(r-s)*(t-o)&&(r-s)*(a-o)>=(n-s)*(i-o)}function Jbt(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!Qbt(e,t)&&(hT(e,t)&&hT(t,e)&&ext(e,t)&&(As(e.prev,e,t.prev)||As(e,t.prev,t))||YP(e,t)&&As(e.prev,e,e.next)>0&&As(t.prev,t,t.next)>0)}function As(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function YP(e,t){return e.x===t.x&&e.y===t.y}function h1e(e,t,r,i){let n=XP(As(e,t,r)),a=XP(As(e,t,i)),s=XP(As(r,i,e)),o=XP(As(r,i,t));return!!(n!==a&&s!==o||0===n&&WP(e,r,t)||0===a&&WP(e,i,t)||0===s&&WP(r,e,i)||0===o&&WP(r,t,i))}function WP(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function XP(e){return e>0?1:e<0?-1:0}function Qbt(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&h1e(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function hT(e,t){return As(e.prev,e,e.next)<0?As(e,t,e.next)>=0&&As(e,e.prev,t)>=0:As(e,t,e.prev)<0||As(e,e.next,t)<0}function ext(e,t){let r=e,i=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}function d1e(e,t){let r=new o8(e.i,e.x,e.y),i=new o8(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}function l1e(e,t,r,i){let n=new o8(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function dT(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function o8(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function txt(e,t,r,i){let n=0;for(let a=t,s=r-i;a<r;a+=i)n+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return n}var rxt=.01,r0=class{static getFaces(e){let t=e.map((e=>e.toArray())).reduce(((e,t)=>(e.push(...t),e)),[]),r=[];return c1e.triangulate(t,[],3).forEach((e=>r.push(e))),r}static arePointsCoplanar(e){if(e.length<4)return!0;let t=e[1].clone().sub(e[0]),r=e[2].clone().sub(e[0]).cross(t).normalize();for(let t=3;t<e.length;t++)if(e[t].clone().sub(e[0]).projectOnVector(r).length()>rxt)return!1;return!0}static isSelfIntersecting(e){let t=e.map((e=>e.toArray().slice(0,-1)));return(0,f1e.default)(t).length>0}},bc=class{static getVisibleObjectBoundingBox(e){let t=new Vt;return e.traverse((e=>{e.visible&&(e instanceof Ht||e instanceof jn)&&pn.isObjectSelectable(e)&&t.expandByObject(e)})),t}static getObjectsBoundingBox(e,t,r){let i=new Vt;return t.forEach((t=>{let n=e.getObjectById(t);if(n){let e=bc.getBoundingBox(n,r);e.isEmpty()||i.union(e)}})),i}static getBoundingBox(e,t=!0){let r=new Vt;if(e instanceof ls)return bc.getInstancedMeshBoundingBox(e);if(0===e.children.length)return r.expandByObject(e),r;let i=e.children.length,n=1;i>20&&(n=3),i>100&&(n=5),i>200&&(n=10),i>1e3&&(n=100),e.updateMatrixWorld(!1);for(let a=0;a<i;++a){let i=e.children[a];if(!t||a%n==0)if(i.updateMatrix(),i instanceof ls){let e=bc.getInstancedMeshBoundingBox(i);e.isEmpty()||r.union(e)}else if(Ut.isMatrixValid(i.matrixWorld)){let e=bc.getBoundingBox(i);e.isEmpty()||r.union(e)}else console.warn(`[SceneUtils] Found object(${i.type}) with invalid matrix: ${i.matrixWorld.elements}`)}return e.geometry&&r.expandByObject(e),r}static getInstancedMeshBoundingBox(e){let t=new Vt,r=new lt;for(let i=0;i<e.count;++i){e.getMatrixAt(i,r);let n=e.geometry.clone();if(n.boundingBox){let e=n.boundingBox.applyMatrix4(r);!e.isEmpty()&&Ut.isBoxValid(e)&&t.union(e)}}return t.applyMatrix4(e.matrixWorld),t}static getObjectCenter(e,t){let r=bc.getBoundingBox(e);r.getCenter(t),t.y=r.min.y}},Ih=class{static setMaterialSection(e,t,r=!1,i=!1){let n=r&&e.clippingPlanes?e.clippingPlanes:[];n.push(...t),e.clippingPlanes=n,e.clipIntersection=i}static removeSection(e){e&&e.traverse((e=>{let t=e.material;Array.isArray(t)?t.forEach((e=>{e.clippingPlanes=[]})):t&&(t.clippingPlanes=[])}))}static addSection(e,t,r=!1,i=!1){e&&e.traverse((e=>{let n=e.material;Array.isArray(n)?n.forEach((e=>{Ih.setMaterialSection(e,t,r,i)})):n&&Ih.setMaterialSection(n,t,r,i)}))}static generateSectionPlanesByBox(e){let t=e.min,r=e.max;return[new ii(new F(0,-1,0),r.y),new ii(new F(0,1,0),-t.y),new ii(new F(1,0,0),-t.x),new ii(new F(-1,0,0),r.x)]}static generateSectionPlanesByPoints(e,t=!0){let r=e.length;if(r<2)return;let i=[];for(let n=0;n<r-1;n++){let a=e[n],s=e[(n+1)%r],o=new ii;o.setFromCoplanarPoints(new F(a.x,a.y,-1),new F(a.x,a.y,0),new F(s.x,s.y,0)),t||o.negate(),i.push(o)}return i}},l8=new F,p1e=new F,$P=class{modify(e,t){delete(e=e.clone()).morphAttributes.position,delete e.morphAttributes.normal;let r=e.attributes;for(let t in r)"position"!==t&&"uv"!==t&&"normal"!==t&&"tangent"!==t&&"color"!==t&&e.deleteAttribute(t);let i=[],n=[],a=(e=Vye(e)).getAttribute("position"),s=e.getAttribute("uv"),o=e.getAttribute("normal"),l=e.getAttribute("tangent"),h=e.getAttribute("color"),c=null,u=null,d=null,p=null;for(let e=0;e<a.count;e++){let t=(new F).fromBufferAttribute(a,e);s&&(u=(new Te).fromBufferAttribute(s,e)),o&&(d=(new F).fromBufferAttribute(o,e)),l&&(c=(new Fn).fromBufferAttribute(l,e)),h&&(p=(new THREE.Color).fromBufferAttribute(h,e));let r=new c8(t,u,d,c,p);i.push(r)}let f=e.getIndex();if(null!==f)for(let e=0;e<f.count;e+=3){let t=f.getX(e),r=f.getX(e+1),a=f.getX(e+2),s=new ZP(i[t],i[r],i[a],t,r,a);n.push(s)}else for(let e=0;e<a.count;e+=3){let t=e,r=e+1,a=e+2,s=new ZP(i[t],i[r],i[a],t,r,a);n.push(s)}for(let e=0,t=i.length;e<t;e++)g1e(i[e]);let m,g=t;for(;g--;){if(m=oxt(i),!m){console.log("THREE.SimplifyModifier: No next vertex");break}axt(i,n,m,m.collapseNeighbor)}let v=new Nt,y=[],b=[],x=[],_=[],w=[];f=[];for(let e=0;e<i.length;e++){let t=i[e];y.push(t.position.x,t.position.y,t.position.z),t.uv&&b.push(t.uv.x,t.uv.y),t.normal&&x.push(t.normal.x,t.normal.y,t.normal.z),t.tangent&&_.push(t.tangent.x,t.tangent.y,t.tangent.z,t.tangent.w),t.color&&w.push(t.color.r,t.color.g,t.color.b),t.id=e}for(let e=0;e<n.length;e++){let t=n[e];f.push(t.v1.id,t.v2.id,t.v3.id)}return v.setAttribute("position",new zt(y,3)),b.length>0&&v.setAttribute("uv",new zt(b,2)),x.length>0&&v.setAttribute("normal",new zt(x,3)),_.length>0&&v.setAttribute("tangent",new zt(_,4)),w.length>0&&v.setAttribute("color",new zt(w,3)),v.setIndex(f),v}};function nxt(e,t){-1===e.indexOf(t)&&e.push(t)}function n0(e,t){let r=e.indexOf(t);r>-1&&e.splice(r,1)}function ixt(e,t){let r=t.position.distanceTo(e.position),i=0,n=[];for(let r=0,i=e.faces.length;r<i;r++){let i=e.faces[r];i.hasVertex(t)&&n.push(i)}for(let t=0,r=e.faces.length;t<r;t++){let r=1,a=e.faces[t];for(let e=0;e<n.length;e++){let t=n[e],i=a.normal.dot(t.normal);r=Math.min(r,(1.001-i)/2)}i=Math.max(i,r)}return n.length<2&&(i=1),r*i+0}function g1e(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(let t=0;t<e.neighbors.length;t++){let r=ixt(e,e.neighbors[t]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[t],e.collapseCost=r,e.minCost=r,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=r,r<e.minCost&&(e.collapseNeighbor=e.neighbors[t],e.minCost=r)}e.collapseCost=e.totalCost/e.costCount}function m1e(e,t){for(console.assert(0===e.faces.length);e.neighbors.length;){n0(e.neighbors.pop().neighbors,e)}n0(t,e)}function sxt(e,t){n0(t,e),e.v1&&n0(e.v1.faces,e),e.v2&&n0(e.v2.faces,e),e.v3&&n0(e.v3.faces,e);let r=[e.v1,e.v2,e.v3];for(let e=0;e<3;e++){let t=r[e],i=r[(e+1)%3];!t||!i||(t.removeIfNonNeighbor(i),i.removeIfNonNeighbor(t))}}function axt(e,t,r,i){if(!i)return void m1e(r,e);i.uv&&r.uv.copy(i.uv),i.normal&&i.normal.add(r.normal).normalize(),i.tangent&&i.tangent.add(r.tangent).normalize();let n=[];for(let e=0;e<r.neighbors.length;e++)n.push(r.neighbors[e]);for(let e=r.faces.length-1;e>=0;e--)r.faces[e]&&r.faces[e].hasVertex(i)&&sxt(r.faces[e],t);for(let e=r.faces.length-1;e>=0;e--)r.faces[e].replaceVertex(r,i);m1e(r,e);for(let e=0;e<n.length;e++)g1e(n[e])}function oxt(e){let t=e[0];for(let r=0;r<e.length;r++)e[r].collapseCost<t.collapseCost&&(t=e[r]);return t}var ZP=class{constructor(e,t,r,i,n,a){this.a=i,this.b=n,this.c=a,this.v1=e,this.v2=t,this.v3=r,this.normal=new F,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(t),e.addUniqueNeighbor(r),t.faces.push(this),t.addUniqueNeighbor(e),t.addUniqueNeighbor(r),r.faces.push(this),r.addUniqueNeighbor(e),r.addUniqueNeighbor(t)}computeNormal(){let e=this.v1.position,t=this.v2.position,r=this.v3.position;l8.subVectors(r,t),p1e.subVectors(e,t),l8.cross(p1e).normalize(),this.normal.copy(l8)}hasVertex(e){return e===this.v1||e===this.v2||e===this.v3}replaceVertex(e,t){e===this.v1?this.v1=t:e===this.v2?this.v2=t:e===this.v3&&(this.v3=t),n0(e.faces,this),t.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()}},c8=class{constructor(e,t,r,i,n){this.position=e,this.uv=t,this.normal=r,this.tangent=i,this.color=n,this.id=-1,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}addUniqueNeighbor(e){nxt(this.neighbors,e)}removeIfNonNeighbor(e){let t=this.neighbors,r=this.faces,i=t.indexOf(e);if(-1!==i){for(let t=0;t<r.length;t++)if(r[t].hasVertex(e))return;t.splice(i,1)}}},v1e=class{static simplifyGeometry(e,t){let r=this.getNumberOfVerticesToRemove(e,t);return r>0?(new $P).modify(e,r):e}static getNumberOfVerticesToRemove(e,t){let r=0;e instanceof Nt&&e.index&&(r=e.attributes.position.count);let i=Math.floor(r*t);return r<20?0:i}},KP=class extends yr{constructor(e){super(),this.isSVGObject=!0,this.node=e}},Cqt=10,b1e=(e=>(e.TripleCross="TripleCross",e.Square="Square",e.Triangle="Triangle",e.CircleWithCross="CircleWithCross",e.Cross="Cross",e.Perpendicular="Perpendicular",e))(b1e||{}),y1e=class{static createSVGObject(e){return new KP(e)}},JP=class extends tf{constructor(e){super(e),this.type=Cn}parse(e){let t=function(e,t){switch(e){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(t||""))}},r=function(e,t,r){t=t||1024;let i=e.pos,n=-1,a=0,s="",o=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));for(;0>(n=o.indexOf("\n"))&&a<t&&i<e.byteLength;)s+=o,a+=o.length,i+=128,o+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return-1<n&&(!1!==r&&(e.pos+=a+n+1),s+o.slice(0,n))},i=function(e,t,r,i){let n=e[t+3],a=Math.pow(2,n-128)/255;r[i+0]=e[t+0]*a,r[i+1]=e[t+1]*a,r[i+2]=e[t+2]*a,r[i+3]=1},n=function(e,t,r,i){let n=e[t+3],a=Math.pow(2,n-128)/255;r[i+0]=nf.toHalfFloat(Math.min(e[t+0]*a,65504)),r[i+1]=nf.toHalfFloat(Math.min(e[t+1]*a,65504)),r[i+2]=nf.toHalfFloat(Math.min(e[t+2]*a,65504)),r[i+3]=nf.toHalfFloat(1)},a=new Uint8Array(e);a.pos=0;let s,o,l,h=function(e){let i,n,a=/^#\?(\S+)/,s=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,l=/^\s*FORMAT=(\S+)\s*$/,h=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,c={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};for((e.pos>=e.byteLength||!(i=r(e)))&&t(1,"no header found"),(n=i.match(a))||t(3,"bad initial token"),c.valid|=1,c.programtype=n[1],c.string+=i+"\n";i=r(e),!1!==i;)if(c.string+=i+"\n","#"!==i.charAt(0)){if((n=i.match(s))&&(c.gamma=parseFloat(n[1])),(n=i.match(o))&&(c.exposure=parseFloat(n[1])),(n=i.match(l))&&(c.valid|=2,c.format=n[1]),(n=i.match(h))&&(c.valid|=4,c.height=parseInt(n[1],10),c.width=parseInt(n[2],10)),2&c.valid&&4&c.valid)break}else c.comments+=i+"\n";return 2&c.valid||t(3,"missing format specifier"),4&c.valid||t(3,"missing image size specifier"),c}(a),c=h.width,u=h.height,d=function(e,r,i){let n=r;if(n<8||n>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);n!==(e[2]<<8|e[3])&&t(3,"wrong scanline width");let a=new Uint8Array(4*r*i);a.length||t(4,"unable to allocate buffer space");let s=0,o=0,l=4*n,h=new Uint8Array(4),c=new Uint8Array(l),u=i;for(;u>0&&o<e.byteLength;){o+4>e.byteLength&&t(1),h[0]=e[o++],h[1]=e[o++],h[2]=e[o++],h[3]=e[o++],(2!=h[0]||2!=h[1]||(h[2]<<8|h[3])!=n)&&t(3,"bad rgbe scanline format");let r,i=0;for(;i<l&&o<e.byteLength;){r=e[o++];let n=r>128;if(n&&(r-=128),(0===r||i+r>l)&&t(3,"bad scanline data"),n){let t=e[o++];for(let e=0;e<r;e++)c[i++]=t}else c.set(e.subarray(o,o+r),i),i+=r,o+=r}let d=n;for(let e=0;e<d;e++){let t=0;a[s]=c[e+t],t+=n,a[s+1]=c[e+t],t+=n,a[s+2]=c[e+t],t+=n,a[s+3]=c[e+t],s+=4}u--}return a}(a.subarray(a.pos),c,u);switch(this.type){case Us:l=d.length/4;let e=new Float32Array(4*l);for(let t=0;t<l;t++)i(d,4*t,e,4*t);s=e,o=Us;break;case Cn:l=d.length/4;let t=new Uint16Array(4*l);for(let e=0;e<l;e++)n(d,4*e,t,4*e);s=t,o=Cn;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:c,height:u,data:s,header:h.string,gamma:h.gamma,exposure:h.exposure,type:o}}setDataType(e){return this.type=e,this}load(e,t,r,i){return super.load(e,(function(e,r){switch(e.type){case Us:case Cn:e.colorSpace=Hi,e.minFilter=wn,e.magFilter=wn,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)}),r,i)}},kp=class{static createEnvTexture(e,t){return bt(this,null,(function*(){let r=new JP;return new Promise((i=>{r.load(t,(t=>{if(e){let r=e.fromEquirectangular(t).texture;e.dispose(),i(r)}}))}))}))}static createEnvTextureFromDataArray(e){return bt(this,arguments,(function*(e,t=this.HDR_CITY_STREET_64x32,r=64,i=32){if(e){let n=new _o(t,r,i);n.flipY=!0,n.magFilter=wn,n.minFilter=wn,n.type=Cn,n.version=1;let a=e.fromEquirectangular(n).texture;return e.dispose(),Promise.resolve(a)}return Promise.reject("Invalid pmremGenerator!")}))}};function lxt(){if(Pn.isBrowser){let e=document.createElement("div");return e.setAttribute("style","height: 1in; visibility: hidden; position: absolute; margin: 0; padding: 0;"),document.body.appendChild(e),.0254/e.clientHeight}return.0254/96}kp.HDR_CITY_STREET_64x32=Uint16Array.from([11910,12340,12797,15360,11926,12348,12806,15360,11958,12364,12814,15360,11974,12380,12830,15360,11958,12364,12822,15360,11926,12348,12797,15360,11878,12324,12773,15360,11830,12308,12749,15360,11798,12292,12733,15360,11782,12279,12725,15360,11765,12263,12709,15360,11749,12247,12701,15360,11733,12231,12701,15360,11701,12215,12693,15360,11685,12199,12685,15360,11685,12199,12685,15360,11701,12215,12693,15360,11717,12231,12701,15360,11733,12247,12709,15360,11749,12263,12717,15360,11749,12279,12717,15360,11765,12279,12725,15360,11765,12279,12725,15360,11765,12292,12725,15360,11798,12300,12733,15360,11830,12316,12749,15360,11846,12324,12757,15360,11894,12340,12781,15360,11926,12356,12797,15360,11942,12356,12797,15360,11926,12348,12789,15360,11926,12348,12789,15360,11942,12356,12797,15360,11942,12356,12797,15360,11942,12348,12806,15360,11942,12356,12806,15360,11942,12356,12814,15360,11958,12372,12830,15360,11974,12372,12830,15360,11974,12372,12838,15360,11990,12388,12854,15360,12055,12420,12886,15360,12119,12452,12918,15360,12167,12476,12950,15360,12231,12500,12982,15360,12263,12516,12998,15360,12231,12500,12974,15360,12199,12484,12958,15360,12199,12484,12958,15360,12199,12492,12966,15360,12247,12508,12982,15360,12247,12508,12990,15360,12231,12500,12982,15360,12199,12484,12966,15360,12167,12468,12942,15360,12119,12444,12918,15360,12087,12436,12902,15360,12055,12420,12886,15360,12055,12412,12878,15360,12039,12412,12878,15360,12022,12396,12862,15360,12006,12388,12846,15360,11958,12364,12830,15360,11910,12340,12806,15360,12119,12508,13103,15360,12087,12484,13071,15360,12055,12468,13046,15360,12006,12436,13006,15360,11926,12396,12958,15360,11878,12364,12926,15360,11846,12348,12894,15360,11782,12308,12854,15360,11749,12292,12830,15360,11717,12263,12814,15360,11685,12247,12806,15360,11669,12215,12789,15360,11685,12231,12789,15360,11701,12247,12797,15360,11701,12247,12806,15360,11717,12263,12814,15360,11749,12292,12822,15360,11782,12308,12838,15360,11798,12316,12846,15360,11814,12332,12862,15360,11846,12340,12870,15360,11862,12348,12878,15360,11846,12340,12870,15360,11846,12340,12862,15360,11878,12356,12886,15360,11910,12372,12910,15360,11942,12396,12934,15360,11958,12412,12958,15360,12039,12452,12998,15360,12071,12468,13022,15360,12039,12452,12998,15360,12039,12452,12998,15360,12006,12444,13006,15360,11974,12436,12998,15360,11942,12412,12982,15360,11926,12396,12974,15360,11926,12404,12974,15360,11958,12420,12998,15360,12006,12452,13038,15360,12055,12476,13071,15360,12039,12476,13079,15360,12087,12508,13127,15360,12247,12597,13231,15360,12388,12693,13332,15360,12420,12741,13364,15360,12436,12757,13372,15360,12468,12773,13380,15360,12500,12806,13388,15360,12516,12822,13404,15360,12629,12934,13452,15360,12741,13046,13508,15360,12806,13095,13532,15360,12757,13046,13516,15360,12645,12950,13460,15360,12565,12870,13428,15360,12532,12838,13412,15360,12549,12854,13412,15360,12516,12838,13396,15360,12452,12757,13356,15360,12420,12725,13340,15360,12404,12709,13332,15360,12372,12677,13316,15360,12279,12589,13207,15360,12135,12516,13119,15360,12388,12709,13348,15360,12247,12581,13223,15360,12055,12476,13087,15360,11910,12388,12982,15360,11733,12308,12886,15360,11669,12247,12846,15360,11621,12199,12814,15360,11541,12103,12765,15360,11492,12055,12733,15360,11508,12055,12733,15360,11476,12022,12717,15360,11525,12055,12725,15360,11589,12135,12757,15360,11669,12199,12765,15360,11765,12292,12814,15360,11862,12348,12886,15360,11910,12372,12910,15360,12006,12420,12966,15360,12071,12452,12998,15360,12119,12476,13022,15360,12167,12492,13046,15360,12183,12500,13063,15360,12199,12524,13079,15360,12308,12589,13151,15360,12300,12581,13151,15360,12167,12516,13087,15360,12087,12468,13030,15360,12022,12444,13014,15360,11990,12420,12990,15360,11974,12420,12990,15360,11974,12420,12990,15360,11990,12436,13014,15360,11990,12444,13030,15360,12103,12500,13103,15360,12087,12508,13111,15360,12039,12484,13103,15360,12039,12476,13103,15360,11942,12436,13054,15360,11974,12452,13087,15360,12039,12492,13135,15360,12103,12532,13199,15360,12183,12581,13263,15360,12308,12661,13340,15360,12484,12822,13436,15360,12613,12918,13484,15360,12725,13046,13540,15360,13046,13332,13677,15360,13143,13380,13717,15360,13223,13420,13741,15360,13396,13540,13862,15360,13436,13589,13902,15360,13484,13629,13942,15360,13468,13621,13934,15360,13412,13564,13878,15360,13372,13524,13846,15360,13287,13452,13781,15360,13223,13428,13749,15360,13340,13492,13805,15360,13239,13428,13749,15360,13095,13364,13685,15360,12918,13223,13597,15360,12822,13111,13556,15360,12613,12934,13468,15360,12532,12854,13428,15360,12565,12870,13444,15360,12468,12789,13396,15360,12372,12693,13340,15360,12087,12492,13111,15360,11846,12364,12958,15360,11717,12300,12878,15360,11557,12135,12781,15360,11476,12055,12741,15360,11460,12022,12725,15360,11476,12022,12725,15360,11476,12022,12709,15360,11476,11958,12605,15360,11364,11733,12332,15360,11111,11412,11661,15360,11223,11476,11773,15360,11388,11669,12095,15360,11765,12119,12492,15360,12388,12613,13079,15360,12661,12902,13356,15360,12998,13255,13564,15360,13372,13508,13797,15360,13412,13548,13846,15360,13287,13436,13725,15360,13271,13428,13709,15360,13287,13428,13717,15360,13014,13287,13597,15360,12709,12998,13460,15360,12452,12741,13332,15360,12364,12653,13271,15360,12404,12693,13316,15360,12420,12709,13316,15360,12420,12709,13332,15360,12263,12589,13231,15360,12332,12661,13312,15360,12300,12629,13295,15360,12263,12605,13287,15360,12231,12597,13279,15360,12247,12613,13303,15360,12231,12597,13295,15360,12231,12605,13312,15360,12199,12597,13324,15360,12231,12613,13340,15360,12516,12870,13468,15360,12725,13063,13564,15360,12741,13079,13573,15360,12854,13175,13613,15360,12902,13223,13629,15360,13046,13348,13693,15360,13356,13516,13846,15360,13605,13765,14078,15360,13717,13870,14191,15360,13765,13918,14255,15360,13765,13910,14247,15360,13701,13854,14191,15360,13573,13733,14070,15360,13508,13677,14006,15360,13380,13548,13886,15360,13111,13380,13741,15360,13063,13348,13709,15360,12886,13207,13629,15360,12725,13046,13548,15360,12645,12966,13508,15360,12677,12982,13508,15360,12629,12950,13492,15360,12452,12789,13412,15360,12324,12661,13332,15360,12356,12677,13340,15360,12388,12693,13348,15360,12279,12597,13247,15360,11894,12396,12998,15360,11637,12231,12846,15360,11573,12135,12789,15360,11589,12151,12797,15360,11621,12167,12797,15360,11637,12119,12677,15360,11079,11404,11693,15360,10517,10701,10653,15360,10252,10348,10007,15360,9902,9999,9428,15360,9846,9886,9047,15360,10135,10260,9685,15360,10412,10533,10412,15360,11268,11436,11549,15360,12364,12605,13087,15360,12444,12709,13255,15360,12549,12822,13348,15360,12613,12886,13396,15360,12597,12886,13412,15360,12581,12870,13404,15360,12661,12950,13460,15360,12725,13014,13492,15360,13079,13332,13645,15360,12757,13046,13500,15360,12677,12982,13476,15360,12854,13143,13556,15360,12693,12982,13492,15360,12581,12886,13452,15360,12709,13030,13508,15360,12372,12709,13364,15360,12324,12661,13348,15360,12292,12645,13340,15360,12292,12645,13348,15360,12468,12806,13436,15360,12532,12854,13460,15360,12500,12854,13468,15360,12500,12854,13484,15360,12725,13063,13589,15360,12982,13324,13701,15360,13111,13388,13741,15360,13014,13340,13709,15360,13014,13332,13717,15360,13287,13476,13862,15360,13436,13621,13974,15360,13532,13717,14095,15360,13725,13902,14295,15360,13942,14103,14420,15360,13974,14135,14436,15360,13862,14022,14388,15360,13725,13894,14295,15360,13789,13958,14336,15360,13830,13990,14348,15360,13372,13548,13942,15360,13014,13332,13733,15360,12886,13239,13661,15360,12854,13207,13637,15360,12757,13095,13589,15360,12757,13079,13573,15360,12645,12982,13516,15360,12629,12966,13532,15360,12549,12870,13468,15360,12356,12693,13372,15360,12151,12549,13231,15360,12215,12573,13247,15360,12199,12565,13231,15360,12071,12492,13135,15360,12055,12468,13087,15360,11878,12372,12958,15360,11685,12199,12781,15360,10774,11159,11412,15360,9533,9621,8870,15360,9308,9340,8071,15360,9276,9300,7878,15360,9324,9332,8420,15360,9191,9216,7991,15360,8950,8983,7766,15360,9493,9525,8677,15360,10252,10332,10007,15360,10661,10846,10894,15360,10701,10926,10998,15360,10950,11276,11428,15360,11364,11637,12063,15360,11958,12388,12926,15360,12183,12540,13175,15360,12340,12645,13295,15360,12420,12693,13316,15360,12757,13030,13460,15360,13046,13324,13645,15360,13095,13348,13677,15360,13303,13460,13781,15360,13207,13404,13741,15360,13127,13372,13717,15360,13372,13524,13862,15360,12693,13030,13540,15360,12725,13046,13548,15360,12468,12822,13436,15360,12263,12629,13348,15360,12436,12773,13428,15360,12693,12998,13524,15360,12725,13046,13564,15360,12645,12982,13556,15360,12613,12966,13556,15360,12886,13255,13685,15360,13436,13629,14022,15360,13637,13813,14231,15360,13621,13789,14215,15360,13878,14038,14412,15360,14022,14183,14468,15360,13926,14119,14452,15360,14054,14231,14508,15360,14135,14311,14540,15360,14348,14436,14669,15360,14460,14540,14749,15360,14404,14484,14709,15360,14420,14500,14709,15360,14653,14717,14894,15360,14119,14279,14508,15360,13484,13669,14078,15360,13063,13380,13773,15360,12677,13079,13613,15360,12484,12886,13516,15360,12436,12822,13476,15360,12468,12838,13476,15360,12039,12532,13316,15360,12231,12613,13340,15360,12468,12789,13436,15360,12388,12725,13396,15360,12135,12557,13287,15360,12151,12557,13271,15360,12039,12484,13175,15360,11878,12396,13038,15360,11814,12348,12950,15360,11492,11894,12460,15360,9950,10103,9621,15360,8830,8838,7220,15360,8565,8533,7015,15360,8541,8501,6919,15360,8332,8300,6822,15360,8412,8372,7220,15360,8710,8701,7686,15360,9372,9404,8549,15360,9533,9621,9079,15360,9268,9292,8196,15360,9452,9460,8167,15360,9533,9581,8533,15360,9742,9870,9316,15360,11460,11814,12348,15360,11942,12388,12902,15360,11749,12167,12573,15360,11300,11492,11621,15360,11974,12332,12669,15360,12436,12741,13364,15360,12597,12886,13460,15360,12966,13271,13653,15360,12998,13303,13669,15360,13476,13629,13974,15360,13733,13886,14239,15360,13364,13524,13894,15360,13063,13356,13725,15360,12982,13287,13669,15360,12484,12806,13444,15360,12565,12902,13500,15360,12950,13287,13693,15360,12934,13271,13677,15360,12693,13046,13589,15360,12661,13030,13605,15360,12870,13271,13717,15360,13348,13548,13966,15360,13621,13813,14271,15360,13797,13974,14412,15360,13942,14119,14484,15360,14263,14388,14629,15360,14420,14508,14733,15360,14460,14548,14773,15360,14982,15046,15231,15360,15564,15580,15669,15360,15974,15982,16078,15360,15805,15821,15926,15360,15460,15476,15572,15360,15436,15460,15556,15360,14781,14862,15127,15360,13621,13813,14348,15360,12789,13207,13757,15360,12452,12886,13581,15360,12263,12709,13476,15360,12039,12597,13396,15360,11942,12516,13340,15360,11846,12468,13271,15360,11733,12380,13127,15360,11926,12460,13191,15360,12055,12524,13263,15360,11878,12428,13159,15360,11605,12231,12886,15360,11412,11990,12709,15360,11508,12103,12789,15360,11637,12231,12854,15360,10661,11079,11380,15360,9541,9685,9252,15360,8573,8605,7493,15360,8404,8388,7348,15360,8830,8822,8212,15360,9308,9324,9095,15360,9324,9364,9220,15360,9047,9119,8653,15360,9023,9055,8404,15360,9055,9063,8167,15360,8870,8846,7541,15360,8862,8806,7380,15360,8950,8910,7252,15360,9268,9284,7557,15360,10316,10468,10380,15360,11239,11476,11677,15360,10653,10942,11047,15360,9661,9814,9324,15360,10693,10958,11047,15360,11396,11653,11990,15360,11878,12292,12597,15360,12468,12789,13396,15360,12773,13095,13589,15360,13364,13516,13894,15360,13894,14054,14380,15360,13717,13870,14247,15360,13420,13589,13958,15360,13255,13452,13830,15360,12806,13143,13637,15360,13159,13412,13830,15360,13629,13813,14215,15360,13303,13500,13910,15360,13079,13396,13805,15360,13191,13452,13878,15360,13412,13621,14062,15360,14103,14279,14540,15360,14773,14854,15086,15360,14717,14805,15046,15360,14295,14420,14685,15360,14380,14476,14733,15360,14572,14661,14902,15360,15596,15612,15701,15360,16351,16335,16384,15360,16484,16476,16492,15360,16516,16500,16516,15360,16388,16375,16404,15360,16054,16054,16118,15360,15918,15926,16006,15360,15556,15572,15669,15360,14653,14725,14982,15360,13637,13838,14319,15360,13412,13613,14054,15360,12870,13287,13789,15360,12404,12838,13524,15360,12199,12677,13428,15360,12324,12741,13452,15360,11942,12516,13324,15360,11765,12380,13111,15360,11428,11942,12589,15360,10886,11388,11902,15360,10372,10717,11006,15360,9846,10240,10191,15360,10252,10549,10766,15360,10613,11079,11484,15360,10581,10998,11388,15360,9613,9846,9629,15360,8525,8557,7541,15360,8605,8613,7814,15360,9292,9324,9079,15360,9388,9396,9220,15360,10709,10846,11031,15360,9894,9966,9854,15360,9252,9236,8774,15360,8822,8790,8183,15360,8292,8260,6533,15360,8111,8007,6324,15360,8228,8183,6405,15360,8501,8501,6565,15360,8814,8878,7172,15360,9260,9364,8244,15360,8902,9095,8252,15360,9444,9581,9047,15360,9509,9637,8790,15360,9477,9613,8806,15360,10725,11063,11079,15360,11508,11910,12356,15360,12484,12789,13380,15360,12838,13159,13629,15360,13428,13589,13974,15360,14135,14279,14484,15360,13942,14087,14396,15360,13677,13846,14247,15360,13436,13613,14006,15360,13597,13781,14183,15360,14183,14340,14540,15360,14022,14215,14484,15360,13637,13838,14271,15360,14038,14231,14508,15360,14380,14476,14701,15360,14757,14854,15078,15360,15030,15111,15343,15360,15420,15452,15556,15360,15476,15500,15588,15360,15351,15388,15492,15360,15572,15596,15677,15360,15653,15669,15717,15360,15821,15821,15853,15360,15845,15845,15869,15360,15998,15990,16022,15360,15926,15926,15974,15360,15653,15669,15733,15360,15661,15677,15749,15360,15612,15629,15717,15360,15271,15335,15452,15360,14484,14572,14821,15360,14215,14372,14588,15360,13468,13677,14167,15360,12773,13175,13653,15360,12725,13143,13637,15360,12452,12886,13532,15360,12263,12709,13444,15360,11894,12436,13103,15360,10252,10533,10661,15360,8613,8693,7445,15360,8742,8782,7047,15360,8420,8412,6565,15360,7926,7910,6405,15360,8806,8854,7300,15360,9127,9228,8007,15360,8685,8750,7300,15360,8348,8356,6758,15360,8380,8340,7300,15360,8991,8918,8388,15360,9838,9790,9549,15360,10055,10127,10047,15360,9501,9493,9268,15360,9332,9292,8902,15360,9079,9007,8509,15360,8300,8260,7252,15360,8693,8701,8196,15360,8228,8212,7111,15360,8469,8501,7380,15360,8420,8501,6919,15360,8549,8645,6983,15360,8581,8661,6951,15360,9268,9332,7718,15360,9063,9207,7445,15360,9284,9380,7718,15360,9412,9557,8693,15360,10276,10517,10103,15360,11830,12279,12589,15360,12725,13079,13589,15360,13127,13396,13773,15360,14087,14231,14460,15360,13974,14119,14412,15360,13677,13854,14247,15360,14119,14279,14500,15360,13990,14167,14460,15360,14364,14452,14653,15360,14564,14653,14837,15360,14404,14492,14701,15360,14870,14942,15135,15360,15388,15420,15500,15360,15207,15287,15420,15360,14797,14894,15127,15360,15271,15335,15452,15360,15926,15942,15990,15360,16207,16207,16231,15360,16118,16110,16126,15360,15741,15733,15741,15360,16239,16207,16175,15360,16444,16460,16484,15360,16046,16022,16006,15360,15942,15950,15966,15360,15773,15789,15829,15360,15789,15797,15845,15360,15693,15709,15757,15360,15540,15564,15653,15360,15303,15364,15468,15360,14733,14813,15014,15360,13862,14054,14420,15360,12838,13255,13725,15360,12789,13207,13693,15360,12468,12918,13564,15360,12404,12838,13500,15360,11428,11862,12412,15360,9143,9276,8388,15360,8541,8533,6726,15360,8444,8428,6629,15360,8212,8183,6597,15360,8388,8380,7015,15360,8726,8710,6758,15360,8332,8316,6437,15360,8453,8428,6565,15360,8597,8605,7814,15360,8701,8661,8151,15360,9452,9396,9015,15360,10581,10557,10380,15360,10950,10974,10846,15360,10380,10356,10252,15360,10749,10741,10685,15360,9870,9854,9693,15360,9023,9039,8669,15360,8790,8854,8509,15360,8196,8167,7332,15360,7975,8015,7079,15360,8589,8750,7445,15360,9095,9260,7111,15360,8983,9135,7188,15360,8902,8991,7252,15360,8862,9007,7015,15360,8967,9111,7300,15360,8742,8878,7493,15360,9557,9999,9549,15360,11292,11613,11862,15360,12135,12468,12982,15360,12215,12460,12878,15360,13356,13468,13685,15360,13821,13934,14199,15360,13548,13701,14022,15360,14103,14263,14468,15360,14279,14388,14572,15360,14364,14452,14645,15360,14709,14789,14950,15360,15143,15199,15327,15360,15388,15412,15468,15360,15476,15500,15548,15360,15420,15444,15492,15360,15436,15460,15516,15360,15612,15637,15685,15360,16086,16086,16110,15360,16396,16388,16396,15360,16094,16094,16110,15360,15869,15861,15861,15360,16135,16110,16070,15360,16428,16420,16404,15360,15588,15556,15524,15360,15484,15500,15508,15360,15335,15364,15396,15360,15677,15685,15717,15360,15604,15621,15661,15360,15420,15444,15500,15360,15303,15372,15452,15360,14717,14805,14998,15360,14412,14508,14701,15360,13548,13765,14199,15360,13271,13508,13942,15360,12661,13159,13709,15360,12468,12854,13436,15360,10260,10484,10509,15360,8613,8669,6951,15360,8151,8143,6469,15360,8653,8629,7814,15360,8469,8444,7541,15360,8718,8693,7814,15360,8372,8332,6597,15360,8356,8308,7111,15360,9047,8983,8396,15360,8822,8798,8308,15360,9372,9348,8967,15360,10364,10364,10183,15360,10268,10260,9894,15360,10541,10533,10468,15360,10380,10364,10276,15360,10621,10613,10549,15360,9910,9942,9758,15360,8364,8380,7621,15360,8581,8637,8135,15360,8252,8300,7573,15360,8119,8175,7300,15360,8372,8453,7493,15360,8420,8501,6983,15360,8742,8822,7573,15360,8782,8854,8151,15360,8581,8661,7079,15360,9220,9268,8340,15360,9549,9645,8854,15360,11717,11950,12127,15360,12468,12741,13207,15360,12709,12966,13388,15360,12300,12508,12886,15360,12492,12709,13063,15360,13239,13372,13548,15360,12476,12597,12814,15360,13581,13685,13878,15360,14476,14548,14685,15360,14556,14629,14773,15360,14765,14829,14966,15360,15159,15207,15303,15360,15372,15396,15444,15360,15516,15532,15572,15360,15653,15661,15693,15360,15829,15837,15853,15360,16022,16014,16022,15360,16311,16295,16279,15360,16343,16319,16303,15360,16412,16388,16359,15360,15813,15797,15773,15360,13063,13151,13183,15360,11484,11701,11798,15360,12300,12412,12468,15360,14613,14637,14653,15360,11974,12215,12316,15360,14135,14215,14303,15360,15604,15629,15677,15360,15524,15548,15596,15360,15351,15380,15428,15360,14797,14894,15054,15360,13990,14231,14500,15360,13492,13709,14070,15360,12886,13316,13701,15360,12613,13207,13749,15360,11525,11974,12428,15360,9284,9412,8629,15360,8597,8653,6951,15360,7806,7790,6292,15360,7589,7541,6437,15360,7485,7437,6597,15360,7453,7404,6180,15360,7774,7686,6565,15360,8300,8260,7332,15360,9918,9942,9862,15360,10348,10372,10231,15360,9725,9709,9228,15360,10613,10621,10509,15360,10199,10175,9838,15360,10380,10388,10340,15360,11207,11255,11284,15360,10661,10717,10725,15360,10103,10135,9950,15360,8444,8436,7669,15360,8469,8501,7445,15360,8950,9111,8854,15360,9485,9798,10071,15360,8364,8501,8039,15360,7959,7951,6806,15360,8597,8605,8039,15360,8501,8533,7557,15360,8758,8830,7509,15360,10758,10830,10693,15360,11508,11605,11621,15360,13524,13669,13886,15360,13830,14022,14327,15360,13926,14103,14364,15360,13460,13621,13886,15360,12854,13191,13420,15360,13597,13733,13926,15360,13846,13990,14223,15360,13773,13942,14199,15360,13910,14087,14356,15360,13813,14022,14319,15360,14247,14396,14540,15360,14693,14765,14878,15360,15223,15279,15343,15360,15508,15524,15540,15360,15540,15548,15564,15360,15327,15335,15319,15360,15303,15311,15303,15360,15918,15910,15886,15360,16247,16207,16151,15360,16175,16143,16086,15360,14436,14452,14436,15360,12263,12380,12404,15360,11476,11701,11773,15360,12380,12492,12532,15360,14797,14797,14757,15360,11372,11589,11677,15360,12597,12934,13356,15360,13990,14364,14725,15360,14183,14444,14773,15360,14231,14444,14717,15360,14412,14532,14709,15360,14054,14199,14380,15360,12372,12500,12605,15360,12199,12565,13006,15360,12581,13175,13653,15360,10055,10380,10324,15360,8557,8573,6726,15360,8167,8196,6533,15360,7517,7485,6119,15360,7244,7172,5798,15360,7071,6959,5718,15360,7669,7581,6260,15360,8661,8605,7975,15360,10942,11079,11151,15360,12573,12741,13014,15360,11902,12030,12191,15360,10308,10332,10135,15360,11255,11300,11284,15360,11276,11348,11396,15360,10055,10215,10292,15360,12183,12332,12468,15360,9918,9966,9798,15360,8734,8742,8196,15360,8967,8950,8469,15360,10260,10276,10039,15360,9734,9758,9605,15360,9388,9404,9308,15360,7943,7878,7095,15360,7726,7637,6645,15360,8047,7983,7204,15360,9284,9236,8693,15360,9621,9565,9143,15360,11255,11268,11047,15360,13175,13332,13420,15360,13773,13934,14175,15360,13854,14022,14271,15360,13870,14038,14279,15360,13388,13516,13677,15360,12279,12629,12966,15360,13348,13452,13564,15360,13821,13918,14054,15360,13701,13846,14022,15360,13460,13605,13781,15360,13492,13637,13821,15360,13709,13821,13950,15360,14372,14428,14476,15360,14516,14572,14613,15360,14741,14789,14813,15360,14725,14749,14749,15360,13452,13484,13468,15360,13476,13500,13492,15360,14990,15022,15022,15360,14556,14572,14564,15360,15094,15111,15094,15360,13231,13287,13215,15360,11255,11380,11175,15360,10677,10886,10492,15360,11846,12006,11934,15360,14327,14340,14279,15360,10766,11039,10862,15360,12918,13255,13452,15360,14231,14548,14886,15360,13878,14380,14765,15360,13444,13862,14412,15360,12151,12404,12621,15360,12637,12902,13215,15360,11549,11749,11870,15360,12279,12653,13119,15360,13223,13404,13516,15360,9228,9260,8276,15360,8087,7991,6308,15360,7918,7814,6919,15360,7469,7364,6148,15360,7485,7380,6212,15360,8228,7991,7204,15360,9276,8967,8212,15360,9806,9573,8742,15360,10135,10087,9621,15360,11452,11452,11452,15360,10629,10637,10509,15360,10693,10733,10637,15360,11095,11111,10982,15360,11292,11348,11372,15360,10199,10244,10167,15360,10814,10926,10846,15360,8669,8774,7493,15360,7870,7910,6244,15360,8204,8183,6919,15360,9806,9758,9159,15360,9460,9436,8629,15360,9159,9087,8260,15360,7637,7509,6790,15360,7758,7629,6838,15360,7967,7918,6774,15360,10854,10749,10501,15360,11508,11412,11316,15360,12372,12300,12151,15360,12030,12119,12063,15360,12781,12910,12982,15360,13476,13581,13661,15360,13484,13589,13677,15360,12404,12428,12380,15360,11605,11765,11798,15360,11492,11533,11452,15360,11838,11886,11798,15360,12263,12372,12380,15360,12151,12231,12175,15360,11492,11508,11412,15360,11119,11111,10838,15360,12508,12581,12573,15360,12621,12693,12677,15360,12573,12629,12589,15360,12292,12324,12231,15360,12476,12565,12573,15360,11998,12159,12215,15360,12950,13071,13159,15360,12263,12372,12428,15360,12380,12428,12444,15360,11300,11308,11143,15360,10199,10244,9734,15360,9709,9701,9252,15360,10492,10581,10404,15360,11476,11516,11388,15360,9477,9517,8790,15360,11717,11854,11838,15360,14247,14420,14524,15360,14054,14311,14436,15360,13597,13805,13982,15360,11364,11533,11597,15360,12263,12428,12549,15360,11436,11605,11653,15360,13079,13324,13444,15360,12516,12613,12605,15360,10039,10015,9605,15360,8693,8621,7878,15360,7951,7862,6902,15360,8196,8204,7015,15360,8677,8589,7637,15360,9284,9031,8340,15360,9814,9605,8902,15360,10685,10428,9910,15360,10492,10260,9685,15360,9404,9252,7943,15360,8830,8766,7220,15360,9220,9047,7943,15360,9693,9669,9015,15360,11412,11468,11372,15360,11135,11159,11023,15360,10087,10055,9428,15360,9910,10007,9621,15360,9236,9300,8934,15360,9597,9557,8902,15360,10669,10549,9782,15360,9926,9870,9127,15360,9894,9918,9047,15360,8685,8742,7910,15360,9958,10167,10284,15360,10215,10332,10396,15360,11396,11428,11452,15360,11223,11255,11300,15360,11814,11862,11958,15360,10685,10846,10870,15360,10340,10380,10007,15360,11175,11207,10894,15360,12103,12207,12215,15360,11143,11103,10902,15360,9910,9966,9613,15360,10015,10079,9493,15360,10806,10846,10517,15360,10862,10934,10637,15360,10838,10942,10661,15360,10958,11087,10878,15360,10709,10838,10701,15360,10669,10741,10589,15360,10581,10669,10525,15360,10252,10348,9974,15360,11396,11500,11525,15360,11207,11255,11264,15360,10878,10910,10934,15360,11031,11063,11159,15360,11292,11324,11396,15360,11223,11255,11300,15360,10693,10685,10645,15360,10428,10420,10324,15360,10300,10252,9991,15360,10838,10846,10798,15360,10428,10428,10364,15360,9669,9605,9380,15360,10167,10244,10087,15360,11709,11854,11910,15360,11223,11284,11268,15360,10231,10244,9878,15360,10199,10244,9862,15360,10183,10260,9942,15360,10525,10653,10541,15360,12500,12597,12621,15360,11814,11741,11597,15360,11533,11460,11175,15360,11103,11006,10557,15360,10444,10396,9846,15360,10007,10023,9228,15360,9653,9790,8469,15360,9316,9372,8039,15360,9557,9830,8071,15360,9621,9918,8071,15360,9677,10015,8167,15360,9991,10284,8420,15360,10215,10436,8581,15360,10260,10484,8645,15360,10292,10476,8902,15360,10324,10468,9252,15360,9910,9894,8886,15360,10525,10573,9701,15360,9782,10039,8581,15360,9565,9814,8167,15360,9950,10039,8934,15360,10749,10758,10199,15360,10669,10685,10244,15360,10838,10838,10460,15360,11215,10910,10087,15360,11492,11364,10806,15360,11095,11159,11055,15360,11364,11388,11356,15360,11023,11039,10990,15360,11653,11653,11613,15360,11798,11725,11557,15360,11974,11862,11637,15360,12039,11942,11765,15360,12119,12047,11934,15360,12151,12071,11950,15360,12087,12006,11886,15360,12047,11966,11838,15360,11990,11926,11790,15360,11974,11910,11798,15360,11998,11934,11814,15360,12111,12039,11886,15360,12231,12143,11998,15360,12292,12199,12039,15360,12039,11974,11846,15360,11822,11782,11653,15360,11862,11838,11765,15360,11798,11765,11701,15360,11782,11733,11669,15360,11798,11749,11685,15360,11838,11790,11725,15360,11870,11822,11749,15360,11741,11701,11621,15360,11565,11541,11452,15360,11533,11500,11412,15360,11621,11581,11484,15360,11605,11557,11460,15360,11516,11468,11372,15360,11565,11533,11444,15360,11677,11637,11541,15360,11725,11661,11557,15360,11725,11661,11557,15360,11733,11669,11573,15360,11838,11773,11677,15360,11998,11926,11814,15360,12014,11926,11798,15360,11460,11404,11332,15360,11637,11557,11428,15360,12014,11894,11693,15360,12167,12022,11765,15360,12119,11982,11709,15360,11926,11806,11516,15360,11685,11589,11300,15360,11476,11404,10886,15360,11239,11151,10468,15360,10766,10733,9894,15360,10565,10565,9589,15360,10436,10444,9332,15360,10308,10308,9031,15360,10308,10316,8999,15360,10199,10244,8774,15360,9725,9645,8549,15360,10244,10276,8967,15360,10878,10838,10183,15360,11055,10966,10348,15360,11119,11006,10404,15360,11264,11135,10565,15360,11404,11316,10822,15360,11492,11388,10982,15360,11798,11613,11223,15360,12047,11830,11412,15360,12039,11894,11597,15360,12127,11990,11693,15360,12127,11990,11725,15360,12191,12055,11806,15360,12191,12055,11830,15360,11870,11773,11613,15360,11573,11516,11428,15360,11533,11484,11412,15360,11541,11492,11420,15360,11565,11516,11452,15360,11589,11541,11476,15360,11605,11557,11500,15360,11637,11589,11533,15360,11669,11621,11557,15360,11701,11645,11573,15360,11733,11669,11589,15360,11798,11717,11605,15360,11838,11749,11621,15360,11878,11782,11661,15360,11894,11798,11661,15360,11926,11806,11653,15360,11958,11822,11661,15360,11982,11846,11677,15360,12006,11870,11685,15360,12095,11950,11765,15360,12047,11910,11741,15360,11886,11765,11605,15360,11838,11733,11589,15360,11814,11717,11589,15360,11814,11709,11573,15360,11790,11693,11565,15360,11741,11677,11589,15360,11733,11677,11613,15360,11733,11685,11629,15360,11717,11669,11621,15360,11685,11645,11589,15360,11629,11589,11533,15360,11573,11525,11468,15360,11492,11444,11380,15360,11316,11255,11111,15360,11348,11292,11143,15360,11516,11436,11316,15360,11854,11749,11589,15360,12127,11990,11765,15360,12199,12055,11782,15360,12340,12231,11910,15360,12372,12292,11958,15360,12380,12300,11974,15360,12348,12247,11910,15360,12324,12215,11878,15360,12247,12103,11773,15360,12095,11958,11637,15360,12055,11926,11613,15360,11974,11854,11541,15360,11870,11765,11468,15360,11966,11854,11541,15360,12300,12151,11846,15360,12396,12316,12006,15360,12388,12308,11990,15360,12388,12308,12006,15360,12396,12316,12022,15360,12396,12308,12022,15360,12396,12308,12022,15360,12364,12279,11974,15360,12340,12247,11942,15360,12340,12231,11926,15360,12215,12071,11806,15360,12095,11966,11749,15360,11741,11645,11500,15360,11420,11356,11255,15360,11364,11308,11207,15360,11356,11300,11175,15360,11348,11292,11191,15360,11372,11324,11255,15360,11412,11364,11308,15360,11420,11372,11316,15360,11428,11380,11324,15360,11444,11388,11332,15360,11484,11428,11364,15360,11508,11460,11396,15360,11557,11500,11436,15360,11589,11533,11460,15360,11613,11557,11484,15360,11621,11557,11492,15360,11613,11557,11500,15360,11621,11557,11500,15360,11629,11573,11508,15360,11629,11573,11508,15360,11605,11557,11484,15360,11589,11533,11468,15360,11557,11508,11436,15360,11549,11500,11428,15360,11557,11500,11436,15360,11549,11492,11436,15360,11533,11484,11428,15360,11525,11476,11428,15360,11516,11476,11428,15360,11525,11484,11444,15360,11516,11476,11428,15360,11468,11428,11380,15360,11428,11388,11332,15360,11356,11308,11239,15360,11308,11255,11127,15360,11167,11071,10926,15360,11223,11119,10966,15360,11276,11175,10998,15360,11404,11332,11191,15360,11773,11693,11557,15360,11926,11798,11613,15360,12207,12039,11773,15360,12348,12231,11894,15360,12308,12151,11846,15360,12332,12215,11894,15360,12364,12279,11958,15360,12380,12292,11974,15360,12396,12316,12022,15360,12404,12316,12039,15360,12412,12332,12087,15360,12412,12332,12103,15360,12436,12356,12135,15360,12372,12292,12039,15360,12420,12332,12087,15360,12396,12316,12055,15360,12356,12263,11990,15360,12340,12231,11942,15360,12271,12127,11854,15360,12215,12071,11814,15360,12292,12135,11878,15360,12288,12135,11870,15360,12111,11982,11765,15360,11990,11886,11717,15360,11637,11557,11428,15360,11364,11300,11143,15360,11316,11239,11079,15360,11300,11207,11047,15360,11268,11159,11015,15360,11268,11159,11015,15360,11268,11159,11031,15360,11300,11223,11095,15360,11340,11292,11191,15360,11348,11300,11223,15360,11372,11324,11255,15360,11380,11332,11255,15360,11372,11316,11239,15360,11396,11340,11268,15360,11468,11404,11300,15360,11460,11404,11324,15360,11484,11428,11356,15360,11492,11436,11372,15360,11500,11444,11388,15360,11508,11460,11404,15360,11500,11452,11396,15360,11492,11436,11380,15360,11468,11412,11356,15360,11444,11388,11324,15360,11444,11388,11324,15360,11428,11380,11316,15360,11412,11356,11300,15360,11404,11348,11300,15360,11404,11356,11308,15360,11396,11356,11308,15360,11388,11348,11308,15360,11372,11340,11292,15360,11348,11308,11255,15360,11284,11223,11111,15360,11231,11143,11023,15360,11199,11111,10974,15360,11047,10958,10814,15360,11127,11023,10870,15360,11119,11006,10846,15360,11175,11055,10886,15360,11292,11191,10998,15360,11525,11404,11284,15360,11822,11637,11476,15360,11878,11733,11549,15360,11918,11790,11573,15360,12063,11918,11653,15360,12223,12063,11765,15360,12300,12151,11846,15360,12255,12103,11814,15360,12271,12127,11846,15360,12271,12127,11862,15360,12271,12127,11886,15360,12308,12183,11942,15360,12175,12039,11814,15360,12063,11934,11709,15360,12159,12014,11765,15360,12215,12063,11798,15360,12143,11998,11757,15360,12071,11934,11693,15360,11998,11870,11661,15360,11974,11870,11685,15360,11998,11910,11757,15360,11846,11765,11629,15360,11468,11396,11284,15360,11308,11223,11031,15360,11215,11103,10934,15360,11207,11095,10942,15360,11215,11103,10950,15360,11191,11087,10942,15360,11175,11079,10942,15360,11167,11063,10934,15360,11143,11031,10902,15360,11247,11143,11015,15360,11284,11191,11079,15360,11300,11223,11095,15360,11316,11268,11127,15360,11340,11284,11143,15360,11340,11284,11159,15360,11356,11300,11191,15360,11372,11316,11239,15360,11380,11324,11255,15360,11372,11316,11255,15360,11380,11324,11276,15360,11380,11324,11268,15360,11372,11316,11255,15360,11364,11316,11255,15360,11364,11308,11239,15360,11348,11292,11207,15360,11340,11284,11191,15360,11348,11292,11191,15360,11348,11292,11207,15360,11340,11292,11207,15360,11340,11292,11207,15360,11324,11276,11207,15360,11308,11255,11175,15360,11264,11175,11079,15360,11119,11039,10934,15360,11103,11015,10902,15360,11095,11006,10878,15360,11031,10942,10806,15360,10990,10902,10766,15360,11047,10942,10814,15360,11031,10926,10790,15360,11055,10942,10806,15360,11119,10998,10846,15360,11151,11015,10830,15360,11268,11095,10886,15360,11484,11396,11268,15360,11790,11701,11549,15360,11886,11790,11637,15360,11838,11741,11581,15360,11838,11725,11541,15360,11902,11782,11581,15360,11966,11838,11629,15360,11974,11846,11629,15360,11958,11838,11629,15360,11950,11838,11637,15360,11814,11701,11525,15360,11581,11492,11332,15360,11645,11541,11380,15360,11806,11701,11533,15360,11902,11806,11637,15360,11950,11862,11717,15360,12014,11934,11790,15360,11942,11862,11725,15360,11565,11492,11388,15360,11292,11191,11015,15360,11231,11111,10950,15360,11159,11047,10894,15360,11119,11006,10854,15360,11127,11023,10878,15360,11159,11055,10902,15360,11135,11031,10894,15360,11111,11006,10878,15360,11095,10990,10870,15360,11095,10998,10886,15360,11071,10966,10846,15360,11111,11006,10902,15360,11191,11095,10974,15360,11268,11159,11031,15360,11284,11191,11063,15360,11292,11207,11063,15360,11300,11223,11079,15360,11332,11268,11143,15360,11316,11255,11127,15360,11316,11255,11143,15360,11308,11239,11127,15360,11316,11255,11159,15360,11300,11223,11127,15360,11292,11207,11095,15360,11300,11223,11111,15360,11300,11223,11095,15360,11300,11223,11095,15360,11308,11239,11111,15360,11300,11223,11111,15360,11292,11207,11111,15360,11264,11167,11071,15360,11215,11127,11047,15360,11135,11055,10966,15360,11015,10934,10846,15360,10918,10838,10733,15360,10982,10894,10782,15360,10974,10886,10766,15360,10982,10894,10766,15360,10958,10862,10749,15360,10982,10886,10774,15360,10958,10862,10758,15360,10958,10862,10749,15360,11015,10910,10790,15360,11023,10910,10774,15360,11079,10958,10806,15360,11103,10974,10798,15360,11191,11047,10846,15360,11468,11388,11276,15360,11846,11765,11637,15360,12006,11918,11782,15360,11998,11910,11782,15360,11902,11822,11693,15360,11838,11749,11637,15360,11782,11709,11605,15360,11806,11741,11645,15360,11782,11717,11629,15360,11773,11717,11621,15360,11870,11806,11701,15360,11942,11862,11757,15360,12183,12103,11974,15360,11974,11894,11765,15360,11476,11404,11308,15360,11268,11143,10966,15360,11183,11063,10902,15360,11111,10998,10854,15360,11055,10942,10806,15360,11023,10910,10766,15360,11047,10934,10782,15360,11039,10926,10782,15360,11079,10966,10830,15360,11031,10918,10782,15360,11031,10926,10806,15360,10990,10894,10782,15360,10974,10886,10790,15360,10966,10870,10774,15360,11006,10902,10806,15360,11039,10942,10838,15360,11127,11023,10910,15360,11175,11079,10958,15360,11191,11087,10958,15360,11207,11095,10958,15360,11268,11143,11015,15360,11276,11175,11047,15360,11284,11191,11079,15360,11292,11191,11079,15360,11276,11175,11079,15360,11239,11135,11031,15360,11268,11159,11047,15360,11215,11111,11006,15360,11239,11127,11015,15360,11255,11143,11031,15360,11223,11119,11015,15360,11199,11103,10998,15360,11175,11087,10982,15360,11143,11047,10958,15360,11031,10942,10854,15360,10958,10878,10790,15360,10910,10830,10741,15360,10942,10862,10758,15360,10926,10838,10733,15360,10854,10758,10637,15360,10918,10830,10709,15360,10910,10822,10717,15360,10942,10846,10749,15360,10942,10854,10741,15360,10942,10854,10749,15360,10966,10870,10758,15360,10966,10870,10758,15360,10958,10854,10733,15360,10998,10886,10741,15360,10942,10830,10677,15360,11039,10918,10749,15360,11095,10974,10806,15360,11308,11223,11031,15360,11468,11396,11292,15360,11605,11533,11428,15360,11701,11621,11525,15360,11693,11629,11541,15360,11685,11621,11549,15360,11685,11629,11549,15360,11629,11565,11484,15360,11589,11533,11444,15360,11364,11308,11191,15360,11191,11087,10958,15360,11135,11031,10902,15360,11135,11031,10894,15360,11055,10950,10830,15360,11015,10910,10782,15360,10958,10854,10733,15360,10942,10838,10717,15360,10974,10870,10733,15360,10982,10878,10749,15360,10990,10886,10758,15360,11015,10910,10798,15360,10966,10862,10758,15360,10950,10854,10758,15360,10910,10822,10733,15360,10894,10798,10709,15360,10902,10814,10725,15360,10934,10846,10758,15360,10910,10822,10733,15360,10950,10854,10749,15360,10974,10878,10766,15360,11047,10942,10830,15360,11095,10990,10878,15360,11167,11055,10942,15360,11199,11103,10990,15360,11191,11087,10982,15360,11151,11047,10950,15360,11135,11031,10934,15360,11095,10998,10902,15360,11143,11047,10950,15360,11079,10990,10894,15360,11079,10990,10902,15360,11103,11006,10910,15360,11079,10982,10886,15360,11023,10926,10822,15360,10982,10894,10798,15360,10958,10870,10782,15360,10910,10814,10725,15360,10926,10838,10741,15360,10934,10838,10733,15360,10950,10854,10749,15360,10886,10798,10709,15360,10910,10814,10709,15360,10926,10830,10725,15360,10910,10814,10701,15360,10862,10774,10677,15360,10950,10854,10733,15360,10926,10830,10717,15360,10926,10838,10725,15360,10926,10830,10725,15360,10894,10798,10685,15360,10926,10830,10701,15360,10958,10854,10717,15360,10934,10830,10685,15360,10950,10846,10709,15360,10974,10862,10717,15360,10942,10830,10685,15360,10958,10846,10701,15360,11006,10894,10749,15360,10950,10846,10725,15360,10958,10862,10741,15360,10894,10806,10701,15360,10854,10774,10669,15360,10886,10806,10701,15360,10862,10790,10693,15360,10878,10806,10717,15360,10982,10902,10798,15360,10990,10902,10798,15360,10950,10862,10758,15360,10942,10846,10733,15360,10870,10774,10669,15360,10894,10798,10693,15360,10918,10830,10725,15360,10894,10806,10701,15360,10926,10830,10733,15360,10902,10830,10725,15360,10870,10790,10693,15360,10886,10814,10725,15360,10814,10741,10661,15360,10838,10766,10677,15360,10822,10741,10661,15360,10822,10741,10669,15360,10862,10790,10709,15360,10846,10758,10669,15360,10894,10798,10693,15360,10974,10878,10766,15360,10966,10870,10766,15360,11023,10926,10814,15360,11079,10974,10862,15360,11006,10910,10814,15360,10950,10862,10766,15360,10982,10894,10798,15360,10958,10862,10774,15360,10958,10870,10782,15360,10910,10830,10741,15360,10950,10862,10766,15360,10982,10886,10790,15360,10918,10822,10725,15360,10886,10798,10701,15360,10854,10766,10669,15360,10894,10806,10709,15360,10926,10830,10725,15360,10926,10830,10725,15360,10958,10862,10749,15360,10958,10862,10749,15360,10894,10806,10717,15360,10902,10814,10717,15360,10878,10790,10677,15360,10942,10838,10717,15360,10918,10814,10701,15360,10886,10790,10661,15360,10942,10838,10717,15360,10950,10854,10725,15360,10950,10854,10725,15360,10910,10814,10693,15360,10910,10814,10685,15360,10942,10838,10709,15360,10894,10790,10661,15360,10910,10806,10669,15360,10822,10725,10597,15360,10749,10661,10541,15360,10830,10733,10613,15360,10838,10741,10629,15360,10806,10709,10597,15360,10854,10766,10653,15360,10862,10774,10669,15360,10798,10725,10629,15360,10822,10749,10653,15360,10854,10782,10693,15360,10806,10741,10661,15360,10862,10790,10701,15360,10870,10790,10685,15360,10870,10790,10693,15360,10878,10790,10677,15360,10862,10782,10677,15360,10870,10790,10693,15360,10870,10782,10685,15360,10894,10814,10709,15360,10886,10814,10709,15360,10846,10782,10685,15360,10741,10669,10573,15360,10766,10693,10589,15360,10709,10637,10541,15360,10741,10669,10589,15360,10741,10677,10589,15360,10709,10637,10557,15360,10774,10701,10613,15360,10862,10774,10677,15360,11006,10918,10806,15360,11006,10902,10782,15360,10974,10870,10749,15360,10958,10854,10733,15360,10934,10838,10725,15360,10934,10838,10733,15360,10934,10838,10725,15360,10886,10790,10685,15360,10854,10766,10661,15360,10886,10798,10701,15360,10838,10749,10645,15360,10878,10782,10661,15360,10822,10725,10613,15360,10822,10717,10605,15360,10846,10749,10629,15360,10854,10749,10637,15360,10950,10854,10733,15360,10958,10854,10741,15360,10910,10806,10693,15360,10926,10822,10693,15360,10934,10838,10725,15360,10910,10822,10709,15360,10910,10822,10709,15360,10886,10782,10661,15360,10910,10814,10677,15360,10910,10806,10677,15360,10926,10822,10685,15360,10958,10854,10717,15360,10974,10870,10725,15360,10926,10830,10693,15360,10926,10830,10693,15360,10918,10822,10693,15360,10934,10838,10701,15360,10918,10814,10685,15360,10878,10782,10653,15360,10870,10774,10645,15360,10838,10749,10629,15360,10806,10717,10605,15360,10822,10733,10621,15360,10822,10733,10621,15360,10846,10758,10653,15360,10846,10766,10653,15360,10822,10741,10629,15360,10806,10733,10629,15360,10806,10725,10621,15360,10790,10709,10605,15360,10766,10693,10589,15360,10814,10741,10629,15360,10846,10766,10653,15360,10838,10758,10653,15360,10878,10790,10677,15360,10894,10798,10685,15360,10830,10741,10629,15360,10830,10758,10653,15360,10798,10725,10629,15360,10806,10733,10629,15360,10717,10637,10525,15360,10661,10581,10476,15360,10701,10621,10517,15360,10733,10661,10565,15360,10782,10685,10557,15360,10862,10758,10613,15360,10974,10862,10725,15360,10958,10846,10709,15360,11006,10902,10766,15360,11006,10902,10774,15360,11039,10934,10814,15360,11006,10902,10790,15360,11006,10910,10790,15360,10950,10854,10741,15360,10934,10830,10709,15360,10918,10814,10701,15360,10854,10758,10653,15360,10918,10814,10701,15360,10870,10766,10645,15360,10830,10733,10621,15360,10934,10830,10709,15360,10990,10886,10758,15360,10950,10838,10717,15360,10910,10814,10701,15360,10926,10822,10693,15360,10934,10830,10709,15360,10878,10774,10653,15360,10934,10830,10701,15360,10926,10822,10693,15360,10878,10782,10661,15360,10878,10782,10661,15360,10862,10766,10621,15360,10886,10782,10645,15360,10886,10782,10653,15360,10926,10822,10701,15360,10902,10806,10685,15360,10926,10822,10701,15360,10918,10814,10685,15360,10878,10782,10645,15360,10910,10806,10669,15360,10854,10758,10621,15360,10886,10790,10645,15360,10854,10758,10629,15360,10830,10741,10613,15360,10918,10814,10685,15360,10862,10766,10645,15360,10830,10741,10613,15360,10806,10717,10597,15360,10741,10661,10557,15360,10774,10693,10581,15360,10749,10669,10557,15360,10774,10693,10581,15360,10766,10685,10573,15360,10790,10709,10597,15360,10782,10701,10589,15360,10790,10709,10597,15360,10838,10749,10621,15360,10870,10774,10645,15360,10894,10790,10661,15360,10878,10782,10653,15360,10846,10741,10613,15360,10790,10693,10557,15360,10814,10717,10597,15360,10790,10701,10581,15360,10741,10645,10525,15360,10717,10629,10509,15360,10774,10685,10573,15360,10725,10637,10525,15360,10854,10749,10621,15360,10950,10846,10701,15360,10966,10854,10709,15360,10934,10814,10677,15360,10926,10822,10701,15360,10982,10878,10766,15360,10998,10894,10782,15360,10990,10878,10766,15360,10998,10894,10782,15360,10998,10886,10774,15360,10998,10886,10758,15360,11006,10894,10774,15360,10942,10838,10733,15360,10958,10854,10741,15360,10958,10854,10749,15360,11006,10902,10790,15360,11015,10902,10798,15360,10982,10870,10758,15360,10998,10894,10782,15360,10974,10870,10758,15360,11006,10902,10790,15360,10998,10894,10774,15360,10974,10870,10758,15360,10950,10854,10741,15360,10878,10790,10693,15360,10902,10814,10701,15360,10918,10822,10709,15360,10838,10733,10613,15360,10878,10782,10661,15360,10934,10838,10717,15360,10902,10806,10693,15360,10918,10822,10709,15360,10926,10830,10709,15360,10838,10733,10605,15360,10910,10806,10661,15360,10942,10838,10693,15360,10886,10782,10645,15360,10886,10782,10637,15360,10854,10749,10621,15360,10926,10830,10709,15360,10966,10862,10741,15360,10846,10749,10629,15360,10830,10733,10605,15360,10854,10758,10637,15360,10822,10725,10605,15360,10886,10790,10661,15360,10902,10806,10669,15360,10918,10814,10677,15360,10830,10733,10605,15360,10806,10717,10589,15360,10870,10774,10645,15360,10934,10838,10709,15360,10958,10862,10733,15360,10886,10790,10661,15360,10894,10798,10661,15360,10958,10854,10709,15360,10934,10830,10709,15360,10814,10717,10581,15360,10862,10758,10613,15360,10854,10741,10589,15360,10814,10717,10573,15360,10886,10782,10645,15360,10814,10725,10597,15360,10862,10766,10637,15360,10910,10806,10669,15360,10942,10838,10709,15360,10966,10862,10733,15360,10974,10870,10741,15360,10974,10870,10749,15360,10958,10862,10749,15360,11031,10934,10822,15360,10998,10894,10782,15360,10974,10870,10766,15360,11023,10918,10814,15360,11039,10926,10822,15360,10958,10846,10741,15360,10918,10814,10693,15360,10966,10870,10741,15360,10982,10886,10766,15360,10982,10878,10766,15360,10942,10846,10733,15360,10958,10862,10758,15360,10950,10854,10758,15360,10934,10830,10717,15360,10966,10862,10733,15360,10942,10846,10725,15360,10934,10846,10733,15360,10934,10846,10733,15360,10878,10798,10693,15360,10886,10798,10693,15360,10910,10814,10709,15360,10942,10846,10733,15360,10838,10733,10597,15360,10878,10774,10645,15360,10918,10822,10701,15360,10878,10782,10653,15360,10894,10790,10661,15360,10934,10838,10725,15360,10958,10854,10725,15360,10966,10862,10733,15360,10910,10806,10685,15360,10982,10878,10758,15360,10942,10854,10749,15360,10934,10838,10733,15360,10918,10814,10701,15360,10894,10798,10669,15360,10894,10798,10669,15360,10814,10725,10605,15360,10902,10798,10669,15360,10814,10725,10605,15360,10894,10798,10685,15360,10958,10862,10749,15360,10910,10814,10701,15360,10910,10806,10685,15360,10918,10814,10693,15360,10926,10822,10709,15360,10894,10790,10661,15360,10902,10806,10677,15360,10902,10806,10685,15360,10934,10838,10717,15360,10934,10838,10701,15360,10934,10838,10717,15360,10950,10854,10725,15360,10894,10798,10661,15360,10862,10749,10597,15360,10894,10798,10677,15360,10878,10782,10661,15360,10926,10838,10717,15360,10926,10838,10717,15360,10918,10822,10709,15360,10934,10838,10733,15360,10926,10838,10733,15360,10958,10870,10766,15360,10942,10854,10749,15360,10958,10870,10774,15360,10974,10878,10774,15360,10958,10854,10741,15360,10950,10846,10741,15360,10950,10854,10758,15360,10934,10838,10733,15360,10942,10846,10725,15360,10966,10862,10741,15360,10926,10838,10733,15360,10958,10862,10749,15360,10910,10822,10709,15360,10942,10854,10758,15360,10926,10838,10733,15360,10910,10822,10717,15360,10934,10838,10733,15360,10934,10846,10733,15360,10902,10814,10709,15360,10926,10830,10717,15360,10918,10822,10709,15360,10838,10749,10637,15360,10878,10790,10677,15360,10942,10846,10733,15360,10926,10822,10701,15360,10958,10862,10749,15360,10886,10790,10685,15360,10918,10814,10693,15360,10910,10814,10693,15360,10902,10806,10701,15360,10878,10774,10637,15360,10798,10693,10565,15360,10822,10725,10597,15360,10934,10838,10709,15360,10958,10854,10725,15360,10886,10790,10669,15360,10910,10806,10677,15360,10886,10782,10645,15360,10830,10725,10597,15360,10822,10717,10581,15360,10862,10758,10637,15360,10878,10782,10669,15360,10926,10822,10709,15360,10974,10878,10774,15360,10966,10870,10758,15360,10918,10822,10709,15360,10846,10749,10645,15360,10894,10798,10693,15360,10918,10822,10709,15360,10974,10878,10774,15360,10918,10822,10717,15360,10982,10886,10774,15360,10974,10878,10758,15360,10950,10854,10741,15360,10958,10854,10725,15360,10982,10886,10766,15360,10918,10822,10701,15360,10878,10782,10669,15360,10886,10790,10669,15360,10934,10838,10717,15360,10950,10854,10741,15360,10934,10838,10733,15360,10982,10886,10782,15360,10886,10798,10701,15360,10870,10782,10685,15360,10894,10814,10717,15360,10910,10822,10725,15360,10934,10838,10733,15360,10950,10846,10741,15360,10934,10838,10725,15360,10934,10846,10749,15360,10902,10814,10717,15360,10878,10790,10677,15360,10878,10782,10669,15360,10854,10766,10645,15360,10838,10749,10629,15360,10902,10814,10701,15360,10910,10814,10693,15360,10902,10798,10669,15360,10910,10806,10677,15360,10886,10782,10653,15360,10854,10749,10629,15360,10870,10774,10653,15360,10974,10870,10758,15360,10990,10878,10758,15360,10918,10822,10709,15360,10926,10838,10725,15360,10958,10854,10733,15360,10894,10790,10653,15360,10822,10725,10605,15360,10878,10782,10661,15360,10974,10870,10749,15360,10902,10806,10677,15360,10934,10838,10725,15360,10870,10774,10653,15360,10798,10701,10581,15360,10854,10749,10621,15360,10894,10798,10669,15360,10934,10822,10685,15360,10942,10830,10701,15360,10910,10806,10669,15360,10870,10758,10629,15360,10886,10774,10645,15360,10950,10838,10701,15360,10966,10870,10749,15360,10886,10790,10685,15360,10870,10782,10677,15360,10934,10838,10733,15360,10934,10838,10725,15360,10822,10725,10621,15360,10878,10790,10677,15360,10894,10798,10693,15360,10822,10733,10629,15360,10894,10798,10685,15360,10998,10902,10790,15360,11015,10918,10806,15360,10950,10854,10741,15360,10950,10846,10741,15360,10934,10838,10733,15360,10942,10846,10749,15360,10910,10822,10725,15360,10846,10758,10653,15360,10878,10790,10685,15360,10894,10798,10701,15360,10862,10774,10669,15360,10814,10725,10621,15360,10846,10758,10645,15360,10870,10774,10661,15360,10870,10774,10677,15360,10878,10790,10693,15360,10878,10782,10677,15360,10830,10741,10637,15360,10870,10782,10677,15360,10966,10870,10766,15360,11015,10918,10814,15360,10910,10814,10701,15360,10942,10846,10725,15360,10950,10846,10725,15360,10942,10838,10725,15360,10934,10830,10701,15360,10910,10798,10677,15360,10886,10782,10653,15360,10838,10733,10597,15360,10902,10806,10669,15360,10830,10733,10613,15360,10838,10741,10621,15360,10838,10741,10621,15360,10894,10798,10669,15360,10934,10830,10685,15360,10886,10790,10669,15360,10902,10806,10685,15360,10854,10749,10637,15360]);var x1e={file:1,m:1,mm:.001,cm:.01,ft:.3048,in:.0254,pt:lxt()},cxt={file:"m",m:"m",mm:"mm",cm:"cm",ft:"ft",in:"in",pt:"pt"},E1e=e=>2===e?"²":3===e?"³":"",fT=(e,t=1)=>cxt[e]+E1e(t),Bqt=(e,t,r,i=1)=>(null==r&&(r=t),r===t?{value:e,unit:fT(r)}:{value:e*Math.pow(x1e[t]/x1e[r],i),unit:fT(r)+E1e(i)}),u8=(e=>(e.Top="Top",e.Bottom="Bottom",e.Front="Front",e.Back="Back",e.Left="Left",e.Right="Right",e))(u8||{}),QP=class{static getCameraDirectionByView(e){let t=new F(1,0,0);return"Top"===e?t.set(0,-1,0):"Bottom"===e?t.set(0,1,0):"Front"===e?t.set(0,0,-1):"Back"===e?t.set(0,0,1):"Left"===e?t.set(1,0,0):"Right"===e&&t.set(-1,0,0),t}},Fi=(e=>(e.MouseClick="mouseclick",e.LayoutChange="layoutchange",e.ModelLoad="modelload",e.BeforeRender="beforerender",e.AfterRender="afterrender",e.OnAnimate="onanimate",e.CameraChange="camerachange",e.ControlChange="controlchange",e.BoxSelectActivate="boxselectactivate",e.BoxSelectDeactivate="boxselectdeactivate",e.PickMarkupActivate="pickmarkupactivate",e.PickMarkupDeactivate="pickmarkupdeactivate",e.MarkupActivate="markupactivate",e.MarkupDeactivate="markupdeactivate",e.MarkupAdd="markupadd",e.MarkupUpdate="markupupdate",e.MarkupRemove="markupremove",e.BeforeRemoveMarkup="beforeremovemarkup",e.MeasurementActivate="measurementactivate",e.MeasurementDeactivate="measurementdeactivate",e.MeasurementAdd="measurementadd",e.MeasurementRemove="measurementremove",e.HotpointClick="hotpointclick",e))(Fi||{}),_1e={},Jr=class extends ba{constructor(e){super(),this.drawableLists=[],this.frustum=new Ml,this.projScreenMatrix=new lt,this.viewer=e,this.init()}static _registerDrawableClass(e){_1e[e.prototype.getClassType()]=e}static createDrawable(e){let t=_1e[e.type];if(!t)throw new Error(`Invalid drawable type: ${t}`);let r=e.points.map((e=>new F(e[0],e[1],e[2]||0))),i=new t(e.id,r);return i.setData(e),i}get is3d(){return this.viewer.is3d()}get container(){return this.viewer.viewerContainer}get camera(){return this.viewer.camera}get raycaster(){return this.viewer.getRaycaster()}init(){this.initCanvas(),this.viewer.addEventListener("afterrender",(()=>{this.projScreenMatrix.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),this.frustum.setFromProjectionMatrix(this.projScreenMatrix),this.render()}))}initCanvas(){let e=this.viewer.getViewerConfig();if(Pn.isBrowser&&!e.context2d){let e=this.canvas=document.createElement("canvas"),t=this.viewer.viewerContainer;t.appendChild(e),e.classList.add("overlay-renderer"),e.style.pointerEvents="none",e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.userSelect="none",this.context=e.getContext("2d",{willReadFrequently:!0});let{clientWidth:r,clientHeight:i}=t;this.setSize(r,i)}else e.context2d&&(this.context=e.context2d,this.canvas=Pn.creatReactNativeCanvas(this.context),this.context.canvas||(this.context.canvas=this.canvas))}toHighDpr(e,t,r){let i=Math.max(window.devicePixelRatio||1,1),n=this.canvas;return n.width=t*i,n.height=r*i,e.scale(i,i),n.style.width=`${t}px`,n.style.height=`${r}px`,e}clearCanvas(){var e,t,r;null==(r=this.context)||r.clearRect(0,0,null==(e=this.canvas)?void 0:e.width,null==(t=this.canvas)?void 0:t.height)}addDrawableList(e){this.drawableLists.push(e)}render(){if(!this.canvas||!this.context||this.drawableLists.length<1)return;this.clearCanvas();let e=this.getSortedDrawables(!1);if(0===e.length)return;let t=new Sn,r=this.viewer.getPixelSizeInWorldCoord();for(let i=0;i<e.length;i++){let n=e[i];n.setTolerance(r),n.visible&&(n.getBounds().getBoundingSphere(t),!n.needsFrustumCulled||this.frustum.intersectsSphere(t))&&n.render(this.context,this.camera)}}setSize(e,t){let r=this.canvas;r.width=e,r.height=t,r.style.width=`${e}px`,r.style.height=`${t}px`,this.toHighDpr(this.context,e,t)}getSortedDrawables(e=!1){let t=[];return this.drawableLists.forEach((r=>{let i=Array.from(r.getDrawables().values());e&&(i=i.filter((e=>e.visible))),i.length>0&&t.push(...i)})),t.sort(((e,t)=>e.renderOrder===t.renderOrder?t.getCenter().distanceTo(this.camera.position)-e.getCenter().distanceTo(this.camera.position):e.renderOrder-t.renderOrder)),t}getDrawablesByDrawableListAndPosition(e,t){return this.is3d||(t.z=0),e.getDrawableByPosition(t,this.raycaster)}getDrawablesByPosition(e){this.is3d||(e.z=0);let t=this.getSortedDrawables(),r=[];for(let i=0;i<t.length;i++){let n=t[i];n.isPointInPath(e,this.raycaster)&&r.push(n)}return r}getDrawableById(e){return this.getSortedDrawables().find((t=>t.id===e))}measureTextLength(e,t){let r=this.context,i=e.split("\n"),n=0;for(let e=0;e<i.length;e++){let a=i[e];r.save(),r.font=t;let s=r.measureText(a).width;r.restore(),n=Math.max(n,s)}return n}getImage(e){this.clearCanvas();let t=this.getSortedDrawables();for(let r=0;r<t.length;r++){let i=t[r];e(i)&&i.render(this.context,this.camera)}return Ut.canvasToImage(this.canvas)}getCanvas(){return this.canvas}destroy(){var e;this.drawableLists.forEach((e=>e.clear())),this.drawableLists=[],this.canvas&&(null==(e=this.viewer.viewerContainer)||e.removeChild(this.canvas),this.canvas=void 0)}},Ol=class extends ba{constructor(e){super(),this.drawableMap=new Map,this.category=e}addDrawable(e){this.drawableMap.set(e.id,e),this.dispatchEvent("add",e.getData())}updateDrawable(e,t){e.setData(t),this.dispatchEvent("update",e.getData())}removeDrawable(e){this.drawableMap.delete(e.id),this.dispatchEvent("remove",e.getData())}getDrawableById(e){return this.drawableMap.get(e)}clear(){this.drawableMap.forEach((e=>this.removeDrawable(e)))}getDrawables(){return this.drawableMap}getDrawableDatas(){return Array.from(this.drawableMap).map((([e,t])=>t.getData()))}setDrawableDatas(e){for(let t=0;t<e.length;t++){let r=e[t],i=Jr.createDrawable(r);this.addDrawable(i)}}getDrawableByPosition(e,t){let r;for(let[i,n]of this.drawableMap)if(n.visible&&n.isPointInPath(e,t)){r=n;break}return r}},uxt=!1,Ki=class extends ba{constructor(e){super(),this.DEFAULT_LINE_WIDTH=1,this.DEFAULT_STROKE_STYLE=[0,0,0,1],this.DEFAULT_FILL_STYLE=[0,0,0,1],this.lineWidth=this.DEFAULT_LINE_WIDTH,this.lineColor=this.DEFAULT_STROKE_STYLE,this.fillColor=this.DEFAULT_FILL_STYLE,this.x=0,this.y=0,this.width=0,this.height=0,this.points=[],this.userData={},this.tolerance=1,this.visible=!0,this.selected=!1,this.renderOrder=1,this.needsFrustumCulled=!0,this.editPointSize=3,this.editPointFillColor="#ffffff",this.editPointStrokeColor="#939ea4",this.matrix=new lt,this.id=e||Ut.guid()}setTolerance(e){this.tolerance=e}render(e,t){this.ctx=e,this.draw(e,t),this.selected&&this.drawSelect(e,t),uxt&&(this.drawBounds(e,t),this.drawCenter(e,t))}getData(){return{id:this.id,points:this.points.map((e=>[e.x,e.y])),lineWidth:this.lineWidth,lineColor:this.lineColor,fillColor:this.fillColor,type:this.getClassType()}}setData(e){this.id=e.id,this.setLineWidth(e.lineWidth),this.setLineColor(e.lineColor),this.setFillColor(e.fillColor)}getVertexes(){return[new F(this.x,this.y,0),new F(this.x+this.width,this.y,0),new F(this.x+this.width,this.y-this.height,0),new F(this.x,this.y-this.height,0)]}setLineWidth(e){this.lineWidth=e||this.DEFAULT_LINE_WIDTH}setLineColor(e){this.lineColor=e||this.DEFAULT_STROKE_STYLE}setFillColor(e){this.fillColor=e||this.DEFAULT_FILL_STYLE}isSelected(){return this.selected}getCenter(){return this.getBounds().getCenter(new F)}transToScreenCoord(e,t){return this.ctx?Nr.world2Screen(e,t,this.ctx.canvas):new Te}drawBounds(e,t){let{min:r,max:i}=this.getBounds(),n=[],a=(e,t,r)=>n.push(new F(e,t,r));a(i.x,i.y,i.z),a(r.x,i.y,i.z),a(r.x,r.y,i.z),a(i.x,r.y,i.z),a(i.x,i.y,r.z),a(r.x,i.y,r.z),a(r.x,r.y,r.z),a(i.x,r.y,r.z),a(r.x,i.y,i.z),a(r.x,r.y,i.z),a(i.x,i.y,i.z),a(i.x,r.y,i.z),a(i.x,i.y,r.z),a(i.x,r.y,r.z),a(r.x,i.y,r.z),a(r.x,r.y,r.z),a(r.x,i.y,i.z),a(r.x,i.y,r.z),a(i.x,i.y,i.z),a(i.x,i.y,r.z),a(r.x,r.y,i.z),a(r.x,r.y,r.z),a(i.x,r.y,i.z),a(i.x,r.y,r.z),e.save(),e.strokeStyle="yellow",e.beginPath(),n.forEach(((r,i)=>{let n=this.transToScreenCoord(r,t);i%2==0?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y)})),e.closePath(),e.stroke(),e.restore()}drawCenter(e,t){let r=this.transToScreenCoord(this.getCenter(),t);e.save(),e.fillStyle="yellow",e.beginPath(),e.arc(r.x,r.y,5,0,2*Math.PI),e.closePath(),e.fill(),e.restore()}getBounds(){let e=this.getVertexes();return(new Vt).setFromPoints(e)}},hxt=new Vt,ns=class extends Ki{constructor(e){super(e),this.editPointSize=3,this.editPointFillColor="#ffffff",this.editPointStrokeColor="#939ea4",this.id=e||Ut.guid()}isSelected(){return this.selected}drawSelect(e,t){let r=this.getVertexes();this.drawPoints(e,t,r)}drawPoints(e,t,r){e.save(),e.fillStyle=this.editPointFillColor,e.strokeStyle=this.editPointStrokeColor,e.beginPath(),r.forEach((r=>{let i=this.transToScreenCoord(r,t);e.moveTo(i.x,i.y),e.arc(i.x,i.y,this.editPointSize,0,2*Math.PI)})),e.closePath(),e.stroke(),e.fill(),e.restore()}setEditPointSize(e){this.editPointSize=e}setEditPointFillColor(e){this.editPointFillColor=e}setEditPointStrokeColor(e){this.editPointStrokeColor=e}getCenter(){return this.getBounds().getCenter(new F)}isPointInPath(e){let t=this.getVertexes().map((e=>new Te(e.x,e.y)));return pr.isPointInPolygon(new Te(e.x,e.y),t,!0)}setData(e){super.setData(e),this.update(e.points.map((e=>new F(e[0],e[1],0))))}setParent(e){this.parent=e}setLeaderText(e){this.leaderText=e,e.setParent(this)}update(e){let{min:t,max:r}=hxt.setFromPoints(e);return this.x=t.x,this.y=r.y,this.width=Math.abs(r.x-t.x),this.height=Math.abs(r.y-t.y),this.points=e,this}translate(e,t){let r=new F(e,t,0);return this.points.forEach((e=>e.add(r))),this.update(this.points),this}rotate(){return this}scale(){return this}},So=(e=>(e.Arrow="ArrowMarkup",e.Circle="CircleMarkup",e.CloudLine="CloudLineMarkup",e.CloudLineRectangle="CloudRectMarkup",e.CloudRectWithText="CloudRectWithTextMarkup",e.Dot="DotMarkup",e.Ellipse="EllipseMarkup",e.LeaderLine="LeaderLineMarkup",e.PolyLine="PolylineMarkup",e.Rectangle="RectMarkup",e.Text="TextMarkup",e.X="XMarkup",e))(So||{}),h8=class extends ns{constructor(e,t){super(e),this.type="ArrowMarkup",this.update(t)}draw(e,t){let r=this.points.map((e=>this.transToScreenCoord(e,t))),[i,n]=this.points,a=(new F).subVectors(i,n).length()/10/this.tolerance;this.drawArrowLine(e,r,a),this.drawArrowHead(e,r[0],r[1],10,a)}drawArrowLine(e,t,r){e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=Br.rgba2Color(this.lineColor);let[i,n]=t,a=(new Te).subVectors(n,i).normalize();e.beginPath(),e.moveTo(i.x,i.y);let s=n.clone().sub(a.multiplyScalar(r));e.lineTo(s.x,s.y),e.closePath(),e.stroke(),e.restore()}drawArrowHead(e,t,r,i,n){let a=180*Math.atan2(t.y-r.y,t.x-r.x)/Math.PI,s=(a+i)*Math.PI/180,o=(a-i)*Math.PI/180,l=n*Math.cos(s),h=n*Math.sin(s),c=n*Math.cos(o),u=n*Math.sin(o),d=new Te(r.x+l,r.y+h),p=new Te(r.x+c,r.y+u);e.save(),e.fillStyle=Br.rgba2Color(this.lineColor),e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(d.x,d.y),e.lineTo(p.x,p.y),e.closePath(),e.fill(),e.restore()}getVertexes(){return this.points}update(e){let[t,r]=e;return this.points=e,this.x=Math.min(t.x,r.x),this.y=Math.max(t.y,r.y),this.width=Math.abs(r.x-t.x),this.height=Math.abs(r.y-t.y),this}isPointInPath(e){return pr.isPointOnLineSegments(e,this.points,this.tolerance)}getClassType(){return"ArrowMarkup"}};Jr._registerDrawableClass(h8);var dxt=new Te,T1e=new F,d8=class extends ns{constructor(e,t){super(e),this.radius=1,this.type="CircleMarkup",this.update(t)}draw(e,t){let[r,i]=this.points.map((e=>this.transToScreenCoord(e,t)));this.radius=dxt.subVectors(i,r).length(),e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=Br.rgba2Color(this.lineColor),e.fillStyle=Br.rgba2Color(this.fillColor),e.beginPath(),e.arc(r.x,r.y,this.radius,0,2*Math.PI),e.closePath(),e.stroke(),e.restore()}update(e){let[t,r]=e,i=T1e.subVectors(r,t).length();return this.width=2*i,this.height=2*i,this.x=t.x-this.width/2,this.y=t.y+this.height/2,this.points=e,this}isPointInPath(e){let[t,r]=this.points,i=T1e.subVectors(t,r).length();return Math.abs(e.distanceTo(t)-i)<=2*this.tolerance}getClassType(){return"CircleMarkup"}};Jr._registerDrawableClass(d8);var w1e=new Vt,Eu=class extends ns{constructor(e,t){super(e),this.type="CloudLineMarkup",this.update(t)}draw(e,t){let r=this.points,i=[];e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=Br.rgba2Color(this.lineColor),e.fillStyle=Br.rgba2Color(this.fillColor),e.beginPath();for(let n=0;n<r.length-1;n++){let a=this.transToScreenCoord(r[n],t),s=this.transToScreenCoord(r[n+1],t),o=Eu.getControlPointByTwoPoints(a,s);0===n&&e.moveTo(a.x,a.y),e.quadraticCurveTo(o.x,o.y,s.x,s.y),i.push(r[n],r[n+1],Nr.screen2World(o,t,this.ctx.canvas))}e.stroke(),e.restore(),w1e.setFromPoints(i);let{min:n,max:a}=w1e;this.width=Math.abs(a.x-n.x),this.height=Math.abs(a.y-n.y),this.x=n.x,this.y=a.y}static getControlPointByTwoPoints(e,t){let r=(new Te).subVectors(t,e),i=r.angle(),n=r.length(),a=Tr.degToRad(45),s=n/2/Math.cos(a);return new Te(e.x+s*Math.cos(a-i),e.y-s*Math.sin(a-i))}getClassType(){return"CloudLineMarkup"}};Jr._registerDrawableClass(Eu);var f8=class extends ns{constructor(e,t){super(e),this.type="CloudRectMarkup",this.update(t)}draw(e,t){e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=Br.rgba2Color(this.lineColor),e.fillStyle=Br.rgba2Color(this.fillColor),e.beginPath();let r=this.getVertexes();r.push(r[0]);let i,n=[],a=new F;for(let e=0;e<r.length-1;e++){let t=r[e],s=r[e+1];a.subVectors(s,t),i||(i=a.length()/10);let o=a.length(),l=a.normalize(),h=Math.round(o/i);for(let e=0;e<h;e++)n.push(t.clone().add(l.clone().multiplyScalar(i*e)))}n.push(n[0]),this.vertexes=[];for(let r=0;r<n.length-1;r++){let i=n[r],a=n[r+1],s=this.transToScreenCoord(i,t),o=this.transToScreenCoord(a,t),l=Eu.getControlPointByTwoPoints(s,o);this.vertexes.push(i,a,Nr.screen2World(l,t,this.ctx.canvas)),0===r&&e.moveTo(s.x,s.y),e.quadraticCurveTo(l.x,l.y,o.x,o.y)}e.closePath(),e.stroke(),e.restore()}isPointInPath(e){let t=this.getVertexes(),r=[];for(let e=0;e<t.length;e++){let i=t[e],n=t[e+1]||t[0];r.push(i,n)}return pr.isPointOnLineSegments(e,r,3*this.tolerance)}getClassType(){return"CloudRectMarkup"}};Jr._registerDrawableClass(f8);var p8=class extends ns{constructor(e,t){super(e),this.radius=8,this.update(t)}draw(e,t){let r=this.transToScreenCoord(this.points[0],t);this.width=2*this.radius*this.tolerance,this.height=2*this.radius*this.tolerance,this.x=this.points[0].x-this.radius*this.tolerance,this.y=this.points[0].y+this.radius*this.tolerance,e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=Br.rgba2Color(this.lineColor),e.fillStyle=Br.rgba2Color(this.fillColor),e.beginPath(),e.arc(r.x,r.y,this.radius,0,2*Math.PI),e.closePath(),e.fill(),e.stroke(),e.restore()}update(e){let t=e[0];return this.width=2*this.radius*this.tolerance,this.height=2*this.radius*this.tolerance,this.x=t.x-this.radius*this.tolerance,this.y=t.y+this.radius*this.tolerance,this.points=e,this}getClassType(){return"DotMarkup"}};Jr._registerDrawableClass(p8);var m8=class extends ns{constructor(e,t){super(e),this.radiusX=1,this.radiusY=1,this.type="EllipseMarkup",this.update(t)}draw(e,t){let[r,i]=this.points.map((e=>this.transToScreenCoord(e,t))),n=(new Te).lerpVectors(r,i,.5);this.radiusX=Math.abs(i.x-r.x)/2,this.radiusY=Math.abs(i.y-r.y)/2,e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=Br.rgba2Color(this.lineColor),e.fillStyle=Br.rgba2Color(this.fillColor),e.beginPath(),e.ellipse(n.x,n.y,this.radiusX,this.radiusY,0,0,2*Math.PI),e.closePath(),e.stroke(),e.restore()}isPointInPath(e){let[t,r]=this.points,i=(new F).lerpVectors(t,r,.5),n=Math.pow(e.x-i.x,2),a=Math.pow(e.y-i.y,2),s=2*this.tolerance,o=Math.abs(r.x-t.x)/2-s,l=Math.abs(r.y-t.y)/2-s,h=n/(o*o),c=a/(l*l),u=Math.abs(r.x-t.x)/2+s,d=Math.abs(r.y-t.y)/2+s;return h+c>=1&&n/(u*u)+a/(d*d)<=1}getClassType(){return"EllipseMarkup"}};Jr._registerDrawableClass(m8);var S1e=(e=>(e.EnterEditing="enterediting",e.ExitEditing="exitediting",e))(S1e||{}),pT=class extends ns{constructor(e,t,r){super(e),this.text="",this.fontSize=12,this.type="TextMarkup",this.padding=300,this.inputStatus="CHAR_TYPING",this.isEditing=!1,this.handleClick=()=>{},this.handleKeydown=e=>{if(this.textInput)if("Enter"===e.key){let e=parseInt(this.textInput.style.height);this.textInput.style.height=`${Math.round(e+this.fontSize/this.tolerance)}px`}else"Escape"===e.code&&this.exitEditing()},this.handleInput=()=>{var e;if(!this.textInput||!this.manager||"CHINESE_TYPING"===this.inputStatus)return;let t=this.textInput.value,r=(null==(e=this.manager.overlayRender)?void 0:e.measureTextLength(t,this.fontSize/this.tolerance+"px Arial"))||0;r>pT.DEFAULT_INPUT_WIDTH&&(this.textInput.style.width=`${Math.round(r+this.padding/this.tolerance*2)}px`),this.inputStatus="CHAR_TYPING",this.text=t},this.handleCompositionStart=()=>{this.inputStatus="CHINESE_TYPING"},this.handleCompositionEnd=()=>{var e;if(!this.textInput||!this.manager||"CHINESE_TYPING"!==this.inputStatus)return;let t=this.textInput.value,r=(null==(e=this.manager.overlayRender)?void 0:e.measureTextLength(t,this.fontSize/this.tolerance+"px Arial"))||0;r>pT.DEFAULT_INPUT_WIDTH&&(this.textInput.style.width=`${Math.round(r+this.padding/this.tolerance*2)}px`),this.text=t,this.inputStatus="CHAR_TYPING"},this.handleBlur=()=>{this.exitEditing()},this.handleFoucs=()=>{},this.update(t),this.text=r}draw(e,t){this.isEditing||this.drawText(e,t,this.text)}drawText(e,t,r){let i=this.transToScreenCoord(new F(this.x,this.y,0),t),n=r.split("\n"),a=this.fontSize/this.tolerance,s=0;e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=Br.rgba2Color(this.lineColor),e.fillStyle=Br.rgba2Color(this.lineColor),e.textAlign="left",e.textBaseline="top",e.font=`${a}px Arial`;for(let t=0;t<n.length;t++){let r=n[t],i=e.measureText(r).width;i>s&&(s=i)}let o=this.padding/this.tolerance,l=new Te(i.x,i.y);for(let t=0;t<n.length;t++){let r=n[t];e.fillText(r,l.x+o,l.y+o+t*a,s+2*o)}e.strokeRect(l.x,l.y,s+2*o,n.length*a+2*o),e.restore(),this.width=(s+2*o)*this.tolerance,this.height=(n.length*a+2*o)*this.tolerance}setFontSize(e){this.fontSize=e,this.padding=e/2}update(e){let t=e[0];return this.x=t.x,this.y=t.y,this.points=[t],this}setData(e){super.setData(e),this.text=e.text||"",this.setFontSize(e.fontSize||12),this.padding=e.fontSize/2}updateText(e){this.text=e}getData(){return{id:this.id,points:this.points.map((e=>[e.x,e.y])),text:this.text,lineWidth:this.lineWidth,lineColor:this.lineColor,fillColor:this.fillColor,fontSize:this.fontSize,type:this.getClassType()}}getClassType(){return"TextMarkup"}addInput(e,t,r){var i;this.textInput||(this.textInput=document.createElement("textarea"),this.textInput.style.cssText=`\n                position: absolute;\n                border: ${this.lineWidth}px solid ${Br.rgba2Color(this.lineColor)};\n                background: transparent;\n                outline: none;\n                resize: none;\n                overflow: hidden;\n                z-index: 1000;\n                box-sizing: content-box;\n                display: inline-block;\n                padding: ${this.padding/this.tolerance}px;\n                whiteSpace: 'nowrap';\n                color: ${this.lineColor}`,this.textInput.style.display="inline-block",null==(i=e.viewerCanvas.parentElement)||i.appendChild(this.textInput),this.addInputEvents()),this.manager=e,this.enterEditing(),this.textInput.style.left=`${t}px`,this.textInput.style.top=`${r}px`,this.textInput.style.width=`${pT.DEFAULT_INPUT_WIDTH}px`,this.textInput.style.height=this.fontSize/this.tolerance+"px",this.textInput.style.lineHeight=this.fontSize/this.tolerance+"px",this.textInput.style.fontSize=this.fontSize/this.tolerance+"px",this.textInput.style.color=Br.rgba2Color(this.lineColor)}addInputEvents(){var e,t,r,i,n,a,s;null==(e=this.textInput)||e.addEventListener("click",this.handleClick),null==(t=this.textInput)||t.addEventListener("blur",this.handleBlur),null==(r=this.textInput)||r.addEventListener("foucs",this.handleFoucs),null==(i=this.textInput)||i.addEventListener("keydown",this.handleKeydown),null==(n=this.textInput)||n.addEventListener("input",this.handleInput),null==(a=this.textInput)||a.addEventListener("compositionstart",this.handleCompositionStart),null==(s=this.textInput)||s.addEventListener("compositionend",this.handleCompositionEnd)}enterEditing(){this.textInput&&(this.textInput.value=this.text,this.textInput.focus(),this.isEditing=!0,this.dispatchEvent("enterediting"))}exitEditing(){var e,t,r,i,n,a,s,o;null==(e=this.textInput)||e.removeEventListener("click",this.handleClick),null==(t=this.textInput)||t.removeEventListener("blur",this.handleBlur),null==(r=this.textInput)||r.removeEventListener("foucs",this.handleFoucs),null==(i=this.textInput)||i.removeEventListener("keydown",this.handleKeydown),null==(n=this.textInput)||n.removeEventListener("input",this.handleInput),null==(a=this.textInput)||a.removeEventListener("compositionstart",this.handleCompositionStart),null==(s=this.textInput)||s.removeEventListener("compositionend",this.handleCompositionEnd),null==(o=this.textInput)||o.remove(),this.textInput=void 0,this.isEditing=!1,this.dispatchEvent("exitediting")}},xc=pT;xc.DEFAULT_INPUT_WIDTH=50,Jr._registerDrawableClass(xc);var M1e=new Te,A1e=new Te(1,0),R1e=new Te(0,-1),g8=class extends xc{constructor(e,t,r){super(e,t,r),this.type="LeaderLineMarkup",this.text="LeaderLine",this.fontSize=12,this.textBounds=new Vt,this.handleInput=()=>{!this.textInput||!this.manager||"CHINESE_TYPING"===this.inputStatus||(this.text=this.textInput.value,this.calcuTextInputPositionByText(this.text),this.inputStatus="CHAR_TYPING")},this.handleCompositionEnd=()=>{!this.textInput||!this.manager||"CHINESE_TYPING"!==this.inputStatus||(this.text=this.textInput.value,this.calcuTextInputPositionByText(this.text),this.inputStatus="CHAR_TYPING")}}draw(e,t){if(this.points.length<2)return;let r=this.points.map((e=>this.transToScreenCoord(e,t))),[i,n]=this.points,a=(new F).subVectors(i,n).length()/10/this.tolerance;this.drawArrowLine(e,r,a),this.drawArrowHead(e,r[1],r[0],10,a),!this.isEditing&&this.text.length>0&&this.drawText(e,t,this.text)}drawArrowHead(e,t,r,i,n){let a=180*Math.atan2(t.y-r.y,t.x-r.x)/Math.PI,s=(a+i)*Math.PI/180,o=(a-i)*Math.PI/180,l=n*Math.cos(s),h=n*Math.sin(s),c=n*Math.cos(o),u=n*Math.sin(o),d=new Te(r.x+l,r.y+h),p=new Te(r.x+c,r.y+u);e.save(),e.fillStyle=Br.rgba2Color(this.lineColor),e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(d.x,d.y),e.lineTo(p.x,p.y),e.closePath(),e.fill(),e.restore()}drawArrowLine(e,t,r){e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=Br.rgba2Color(this.lineColor);let[i,n]=t,a=(new Te).subVectors(i,n).normalize();e.beginPath(),e.moveTo(n.x,n.y);let s=i.clone().sub(a.multiplyScalar(r));e.lineTo(s.x,s.y),e.closePath(),e.stroke(),e.restore()}drawText(e,t,r){let[i,n]=this.points.map((e=>this.transToScreenCoord(e,t))),a=(new Te).subVectors(n,i).normalize(),s=a.cross(R1e)<0,o=a.cross(A1e)<0,l=r.split("\n"),h=this.fontSize/this.tolerance,c=0;e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=Br.rgba2Color(this.lineColor),e.fillStyle=Br.rgba2Color(this.lineColor),e.textAlign="left",e.textBaseline="top",e.font=`${h}px Arial`;for(let t=0;t<l.length;t++){let r=l[t],i=e.measureText(r).width;i>c&&(c=i)}let u=this.padding/this.tolerance,d=u+h/2,p=l.length*h+2*u,f=new Te(s?n.x:n.x-c-2*u,o?n.y-d:n.y-p+(p-d));for(let t=0;t<l.length;t++){let r=l[t];e.fillText(r,f.x+u,f.y+u+t*h,c+2*u)}e.strokeRect(f.x,f.y,c+2*u,l.length*h+2*u),e.restore();let m=Nr.screen2World(M1e.set(f.x,f.y),t,this.ctx.canvas);m.z=0;let g=Nr.screen2World(M1e.set(f.x+c+2*u,f.y+p),t,this.ctx.canvas);g.z=0,this.textBounds.setFromPoints([m,g])}getVertexes(){return this.points}update(e){let[t,r]=e;return this.points=e,this.x=Math.min(t.x,r.x),this.y=Math.max(t.y,r.y),this.width=Math.abs(r.x-t.x),this.height=Math.abs(r.y-t.y),this}getData(){return{id:this.id,points:this.points.map((e=>[e.x,e.y])),text:this.text,lineWidth:this.lineWidth,lineColor:this.lineColor,fillColor:this.fillColor,fontSize:this.fontSize,type:this.getClassType()}}isPointInPath(e){return pr.isPointOnLineSegments(e,this.points,this.tolerance)||this.textBounds.containsPoint(e)}updateText(e){this.text=e}getClassType(){return"LeaderLineMarkup"}addInput(e,t,r){let[i,n]=this.points.map((t=>Nr.world2Screen(t,e.camera,e.viewerCanvas))),a=(new Te).subVectors(n,i).normalize(),s=a.cross(R1e)<0,o=a.cross(A1e)<0,l=this.fontSize/this.tolerance,h=this.padding/this.tolerance,c=h+l/2,u=xc.DEFAULT_INPUT_WIDTH,d=l;super.addInput(e,s?t:t-u-2*h,o?r-c:r-d+(d-c))}calcuTextInputPositionByText(e){var t;if(!this.textInput||!this.manager)return;let r=(null==(t=this.manager.overlayRender)?void 0:t.measureTextLength(e,this.fontSize/this.tolerance+"px Arial"))||0;if(r>xc.DEFAULT_INPUT_WIDTH){let e=this.points[1],t=Nr.world2Screen(this.points[0],this.manager.camera,this.manager.viewerCanvas),i=Nr.world2Screen(e,this.manager.camera,this.manager.viewerCanvas).clone().sub(t).normalize().cross(new Te(0,-1))<0,n=Nr.world2Screen(e,this.manager.camera,this.manager.viewerCanvas);i||(this.textInput.style.left=n.x-r-this.padding/this.tolerance*2+"px"),this.textInput.style.width=`${Math.round(r)}px`}}};Jr._registerDrawableClass(g8);var v8=class extends ns{constructor(e,t){super(e),this.type="PolylineMarkup",this.update(t)}draw(e,t){e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=Br.rgba2Color(this.lineColor),e.fillStyle=Br.rgba2Color(this.fillColor);let r=this.points;e.beginPath(),r.forEach(((r,i)=>{let n=this.transToScreenCoord(r,t);0===i?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y)})),e.stroke(),e.restore()}isPointInPath(e){let t=this.points,r=[];for(let e=0;e<t.length-1;e++)r.push(t[e],t[e+1]);return pr.isPointOnLineSegments(e,r,1*this.tolerance)}getVertexes(){return this.points}getClassType(){return"PolylineMarkup"}};Jr._registerDrawableClass(v8);var y8=class extends ns{constructor(e,t){super(e),this.type="RectMarkup",this.update(t)}draw(e,t){e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=Br.rgba2Color(this.lineColor),e.fillStyle=Br.rgba2Color(this.fillColor),e.beginPath(),this.getVertexes().forEach(((r,i)=>{let n=this.transToScreenCoord(r,t);0===i?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y)})),e.closePath(),e.stroke(),e.restore()}isPointInPath(e){let t=this.getVertexes(),r=[];for(let e=0;e<t.length;e++){let i=t[e],n=t[e+1]||t[0];r.push(i,n)}return pr.isPointOnLineSegments(e,r,2*this.tolerance)}getClassType(){return"RectMarkup"}};Jr._registerDrawableClass(y8);var b8=class extends ns{constructor(e,t){super(e),this.type="XMarkup",this.update(t)}draw(e,t){e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=Br.rgba2Color(this.lineColor),e.beginPath();let[r,i,n,a]=this.getVertexes().map((e=>this.transToScreenCoord(e,t)));e.moveTo(r.x,r.y),e.lineTo(n.x,n.y),e.moveTo(i.x,i.y),e.lineTo(a.x,a.y),e.closePath(),e.stroke(),e.restore()}isPointInPath(e){let[t,r,i,n]=this.getVertexes();return pr.isPointOnLineSegments(e,[t,i,r,n],.1)}getClassType(){return"XMarkup"}};Jr._registerDrawableClass(b8);var C1e=new Vt,x8=new F,E8=new Te,fxt=new Te(1,0),pxt=new Te(0,-1),_8=class extends xc{constructor(e,t,r=""){super(e,t,r),this.type="CloudRectWithTextMarkup",this.textPosition=new F,this.textBounds=new Vt,this.text="CloudRectWithText",this.fontSize=12,this.handleClick=()=>{var e;null==(e=this.textInput)||e.blur()},this.handleInput=()=>{!this.textInput||!this.manager||"CHINESE_TYPING"===this.inputStatus||(this.text=this.textInput.value,this.calcInputPositionByText(this.text),this.inputStatus="CHAR_TYPING")},this.handleCompositionEnd=()=>{!this.textInput||!this.manager||"CHINESE_TYPING"!==this.inputStatus||(this.text=this.textInput.value,this.calcInputPositionByText(this.text),this.inputStatus="CHAR_TYPING")}}draw(e,t){this.drawCloudRect(e,t),(this.isEditing||this.text.length>0)&&this.drawLeaderLine(e,t),!this.isEditing&&this.text.length>0&&this.drawText(e,t,this.text)}drawCloudRect(e,t){e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=Br.rgba2Color(this.lineColor),e.fillStyle=Br.rgba2Color(this.fillColor),e.beginPath();let r=this.getCloudPoints();r.push(r[0]);let i,n=[];for(let e=0;e<r.length-1;e++){let t=r[e],a=r[e+1],s=x8.subVectors(a,t);i||(i=s.length()/10);let o=s.length(),l=s.normalize(),h=Math.round(o/i);for(let e=0;e<h;e++)n.push(t.clone().add(l.clone().multiplyScalar(i*e)))}n.push(n[0]),this.controlPoints=[],this.vertexes=[];for(let r=0;r<n.length-1;r++){let i=n[r],a=n[r+1],s=this.transToScreenCoord(i,t),o=this.transToScreenCoord(a,t),l=Eu.getControlPointByTwoPoints(s,o);this.controlPoints.push(s,o),this.vertexes.push(i,a,Nr.screen2World(l,t,this.ctx.canvas)),0===r&&e.moveTo(s.x,s.y),e.quadraticCurveTo(l.x,l.y,o.x,o.y)}e.closePath(),e.stroke(),e.restore()}drawLeaderLine(e,t){if(!this.controlPoints)return;let r=this.transToScreenCoord(this.textPosition,t);this.controlPoints.sort(((e,t)=>r.distanceTo(e)-r.distanceTo(t)));let i=this.controlPoints[0];e.save(),e.lineWidth=_8.LEADER_LINE_WIDTH,e.strokeStyle=Br.rgba2Color(this.lineColor),e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(r.x,r.y),e.closePath(),e.stroke(),e.restore()}drawText(e,t,r){let i=this.transToScreenCoord(this.points[0],t),n=this.transToScreenCoord(this.textPosition,t),a=E8.subVectors(n,i).normalize(),s=a.cross(fxt)<0,o=a.cross(pxt)<0,l=r.split("\n"),h=this.fontSize/this.tolerance,c=0;e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=Br.rgba2Color(this.lineColor),e.fillStyle=Br.rgba2Color(this.lineColor),e.textAlign="left",e.textBaseline="top",e.font=`${h}px Arial`;for(let t=0;t<l.length;t++){let r=l[t],i=e.measureText(r).width;i>c&&(c=i)}let u=this.padding/this.tolerance,d=u+h/2,p=l.length*h+2*u,f=new Te(o?n.x:n.x-c-2*u,s?n.y-d:n.y-p+(p-d));for(let t=0;t<l.length;t++){let r=l[t];e.fillText(r,f.x+u,f.y+u+t*h,c+2*u)}e.strokeRect(f.x,f.y,c+2*u,l.length*h+2*u),e.restore();let m=Nr.screen2World(E8.set(f.x,f.y),t,this.ctx.canvas);m.z=0;let g=Nr.screen2World(E8.set(f.x+c+2*u,f.y+p),t,this.ctx.canvas);g.z=0,this.textBounds.setFromPoints([m,g])}translate(e,t){let r=x8.set(e,t,0);this.points.forEach((e=>e.add(r))),this.textPosition.add(r);let[i,n]=this.points;return this.x=Math.min(i.x,n.x),this.y=Math.max(i.y,n.y),this.width=Math.abs(n.x-i.x),this.height=Math.abs(n.y-i.y),this}update(e){let[t,r]=e;return this.points=e,this.x=Math.min(t.x,r.x),this.y=Math.max(t.y,r.y),this.width=Math.abs(r.x-t.x),this.height=Math.abs(r.y-t.y),this.textPosition||(this.textPosition=new F),this.textPosition.set(Math.max(t.x,r.x),Math.max(t.y,r.y),0),this}getCloudPoints(){return[new F(this.x,this.y,0),new F(this.x+this.width,this.y,0),new F(this.x+this.width,this.y-this.height,0),new F(this.x,this.y-this.height,0)]}getBounds(){return C1e.setFromPoints([...this.points,...this.vertexes||[]]),C1e.union(this.textBounds)}getVertexes(){let e=this.getBounds(),t=e.min,r=e.getSize(x8);return[new F(t.x,t.y,0),new F(t.x+r.x,t.y,0),new F(t.x+r.x,t.y+r.y,0),new F(t.x,t.y+r.y,0)]}isLeaderTextSelected(e){return this.textBounds.containsPoint(e)}translateLeaderText(e,t){let r=new F(e,t,0);return this.textPosition.add(r),this}isPointInPath(e){let t=this.getCloudPoints(),r=[];for(let e=0;e<t.length;e++){let i=t[e],n=t[(e+1)%t.length];r.push(i,n)}return pr.isPointOnLineSegments(e,r,3*this.tolerance)||this.textBounds.containsPoint(e)}setData(e){super.setData(e);let t=e.textPosition||[0,0];this.textPosition.set(t[0],t[1],0)}updateText(e){this.text=e}getData(){return{id:this.id,points:this.points.map((e=>[e.x,e.y])),lineWidth:this.lineWidth,lineColor:this.lineColor,fillColor:this.fillColor,fontSize:this.fontSize,text:this.text,textPosition:[this.textPosition.x,this.textPosition.y],type:this.getClassType()}}getClassType(){return"CloudRectWithTextMarkup"}addInput(e,t,r){let i=this.padding/this.tolerance+this.fontSize/this.tolerance/2;super.addInput(e,t,r-i)}updateInputPosition(e,t){var r;if(!this.manager||!this.textInput)return;let i=t.clone().sub(e).normalize().cross(new Te(0,-1))<0,n=this.textInput.value,a=(null==(r=this.manager.overlayRender)?void 0:r.measureTextLength(n,this.fontSize/this.tolerance+"px Arial"))||xc.DEFAULT_INPUT_WIDTH,s=this.padding/this.tolerance+this.fontSize/this.tolerance/2;this.textInput.style.left=`${i?t.x:t.x-this.padding/this.tolerance*2-a}px`,this.textInput.style.top=t.y-s+"px",this.textPosition.copy(Nr.screen2World(t,this.manager.camera,this.manager.viewerCanvas))}calcInputPositionByText(e){var t;if(!this.textInput||!this.manager)return;let r=(null==(t=this.manager.overlayRender)?void 0:t.measureTextLength(e,this.fontSize/this.tolerance+"px Arial"))||0;if(r>xc.DEFAULT_INPUT_WIDTH){let e=Nr.world2Screen(this.points[0],this.manager.camera,this.manager.viewerCanvas),t=Nr.world2Screen(this.textPosition,this.manager.camera,this.manager.viewerCanvas).clone().sub(e).normalize().cross(new Te(0,-1))<0,i=Nr.world2Screen(this.textPosition,this.manager.camera,this.manager.viewerCanvas);t||(this.textInput.style.left=i.x-r-this.padding/this.tolerance*2+"px"),this.textInput.style.width=`${Math.round(r)}px`}}},i0=_8;i0.LEADER_LINE_WIDTH=1,Jr._registerDrawableClass(i0);var Ec=class{constructor(e){this.name=e}},mT=class extends Ec{constructor(e,t){super("AddMarkup"),this.manager=e,this.data=t}undo(){let e=this.manager.getMarkupById(this.data.id);return!!e&&(this.manager.removeMarkup(e),!0)}redo(){let e=this.manager.createMarkup(this.data);return!!e&&(this.manager.addMarkup(e),!0)}},gT=class extends Ec{constructor(e,t){super("RemoveMarkup"),this.manager=e,this.data=t}undo(){let e=this.manager.createMarkup(this.data);return!!e&&(this.manager.addMarkup(e),!0)}redo(){let e=this.manager.getMarkupById(this.data.id);return!!e&&(this.manager.removeMarkup(e),!0)}},e3=class extends Ec{constructor(e,t,r){super("UpdateMarkup"),this.manager=e,this.oldData=t,this.newData=r}undo(){let e=this.manager.getMarkupById(this.oldData.id);return!!e&&(this.manager.updateMarkup(e,this.oldData),!0)}redo(){let e=this.manager.getMarkupById(this.newData.id);return!!e&&(this.manager.updateMarkup(e,this.newData),!0)}},Fp=(e=>(e.BaseViewer="BaseViewer",e.Viewer3d="Viewer3d",e.Viewer2d="Viewer2d",e.BimTilesViewer="BimTilesViewer",e))(Fp||{});function ro(e){return(ro="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T8(e,t){if("object"!=ro(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=ro(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function vT(e){var t=T8(e,"string");return"symbol"==ro(t)?t:String(t)}function P1e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,vT(i.key),i)}}function Tc(e,t,r){return t&&P1e(e.prototype,t),r&&P1e(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yT(e,t){return(yT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function I1(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&yT(e,t)}function s0(e,t){if(t&&("object"===ro(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _u(e)}function wc(e){return(wc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oh(e,t,r){return(t=vT(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function w8(e){if(Array.isArray(e))return e}function S8(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function t3(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function M8(e,t){if(e){if("string"==typeof e)return t3(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t3(e,t)}}function A8(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function R8(e){return w8(e)||S8(e)||M8(e)||A8()}function I1e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function O1e(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I1e(Object(r),!0).forEach((function(t){Oh(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I1e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var mxt={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,t){console&&console[e]&&console[e].apply(console,t)}},gxt=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_c(this,e),this.init(t,r)}return Tc(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||mxt,this.options=t,this.debug=t.debug}},{key:"setDebug",value:function(e){this.debug=e}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"log","",!0)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","",!0)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"error","")}},{key:"deprecate",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(e,t,r,i){return i&&!this.debug?null:("string"==typeof e[0]&&(e[0]="".concat(r).concat(this.prefix," ").concat(e[0])),this.logger[t](e))}},{key:"create",value:function(t){return new e(this.logger,O1e(O1e({},{prefix:"".concat(this.prefix,":").concat(t,":")}),this.options))}},{key:"clone",value:function(t){return(t=t||this.options).prefix=t.prefix||this.prefix,new e(this.logger,t)}}]),e}(),Lh=new gxt,Np=function(){function e(){_c(this,e),this.observers={}}return Tc(e,[{key:"on",value:function(e,t){var r=this;return e.split(" ").forEach((function(e){r.observers[e]=r.observers[e]||[],r.observers[e].push(t)})),this}},{key:"off",value:function(e,t){if(this.observers[e]){if(!t)return void delete this.observers[e];this.observers[e]=this.observers[e].filter((function(e){return e!==t}))}}},{key:"emit",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];this.observers[e]&&[].concat(this.observers[e]).forEach((function(e){e.apply(void 0,r)}));this.observers["*"]&&[].concat(this.observers["*"]).forEach((function(t){t.apply(t,[e].concat(r))}))}}]),e}();function bT(){var e,t,r=new Promise((function(r,i){e=r,t=i}));return r.resolve=e,r.reject=t,r}function D1e(e){return null==e?"":""+e}function vxt(e,t,r){e.forEach((function(e){t[e]&&(r[e]=t[e])}))}function P8(e,t,r){function i(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function n(){return!e||"string"==typeof e}for(var a="string"!=typeof t?[].concat(t):t.split(".");a.length>1;){if(n())return{};var s=i(a.shift());!e[s]&&r&&(e[s]=new r),e=Object.prototype.hasOwnProperty.call(e,s)?e[s]:{}}return n()?{}:{obj:e,k:i(a.shift())}}function L1e(e,t,r){var i=P8(e,t,Object);i.obj[i.k]=r}function yxt(e,t,r,i){var n=P8(e,t,Object),a=n.obj,s=n.k;a[s]=a[s]||[],i&&(a[s]=a[s].concat(r)),i||a[s].push(r)}function i3(e,t){var r=P8(e,t),i=r.obj,n=r.k;if(i)return i[n]}function k1e(e,t,r){var i=i3(e,r);return void 0!==i?i:i3(t,r)}function X1e(e,t,r){for(var i in t)"__proto__"!==i&&"constructor"!==i&&(i in e?"string"==typeof e[i]||e[i]instanceof String||"string"==typeof t[i]||t[i]instanceof String?r&&(e[i]=t[i]):X1e(e[i],t[i],r):e[i]=t[i]);return e}function O1(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var bxt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function xxt(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(function(e){return bxt[e]})):e}var a3="undefined"!=typeof window&&window.navigator&&void 0===window.navigator.userAgentData&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1,Ext=[" ",",","?","!",";"];function _xt(e,t,r){t=t||"",r=r||"";var i=Ext.filter((function(e){return t.indexOf(e)<0&&r.indexOf(e)<0}));if(0===i.length)return!0;var n=new RegExp("(".concat(i.map((function(e){return"?"===e?"\\?":e})).join("|"),")")),a=!n.test(e);if(!a){var s=e.indexOf(r);s>0&&!n.test(e.substring(0,s))&&(a=!0)}return a}function F1e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function r3(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?F1e(Object(r),!0).forEach((function(t){Oh(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F1e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Txt(e){var t=wxt();return function(){var r,i=wc(e);if(t){var n=wc(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return s0(this,r)}}function wxt(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Y1e(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(e){if(e[t])return e[t];for(var i=t.split(r),n=e,a=0;a<i.length;++a){if(!n||"string"==typeof n[i[a]]&&a+1<i.length)return;if(void 0===n[i[a]]){for(var s=2,o=i.slice(a,a+s).join(r),l=n[o];void 0===l&&i.length>a+s;)s++,l=n[o=i.slice(a,a+s).join(r)];if(void 0===l)return;if(null===l)return null;if(t.endsWith(o)){if("string"==typeof l)return l;if(o&&"string"==typeof l[o])return l[o]}var h=i.slice(a+s).join(r);return h?Y1e(l,h,r):void 0}n=n[i[a]]}return n}}var Sxt=function(e){I1(r,Np);var t=Txt(r);function r(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};return _c(this,r),i=t.call(this),a3&&Np.call(_u(i)),i.data=e||{},i.options=n,void 0===i.options.keySeparator&&(i.options.keySeparator="."),void 0===i.options.ignoreJSONStructure&&(i.options.ignoreJSONStructure=!0),i}return Tc(r,[{key:"addNamespaces",value:function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}},{key:"removeNamespaces",value:function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}},{key:"getResource",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator,a=void 0!==i.ignoreJSONStructure?i.ignoreJSONStructure:this.options.ignoreJSONStructure,s=[e,t];r&&"string"!=typeof r&&(s=s.concat(r)),r&&"string"==typeof r&&(s=s.concat(n?r.split(n):r)),e.indexOf(".")>-1&&(s=e.split("."));var o=i3(this.data,s);return o||!a||"string"!=typeof r?o:Y1e(this.data&&this.data[e]&&this.data[e][t],r,n)}},{key:"addResource",value:function(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},a=this.options.keySeparator;void 0===a&&(a=".");var s=[e,t];r&&(s=s.concat(a?r.split(a):r)),e.indexOf(".")>-1&&(i=t,t=(s=e.split("."))[1]),this.addNamespaces(t),L1e(this.data,s,i),n.silent||this.emit("added",e,t,r,i)}},{key:"addResources",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var n in r)("string"==typeof r[n]||"[object Array]"===Object.prototype.toString.apply(r[n]))&&this.addResource(e,t,n,r[n],{silent:!0});i.silent||this.emit("added",e,t,r)}},{key:"addResourceBundle",value:function(e,t,r,i,n){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},s=[e,t];e.indexOf(".")>-1&&(i=r,r=t,t=(s=e.split("."))[1]),this.addNamespaces(t);var o=i3(this.data,s)||{};i?X1e(o,r,n):o=r3(r3({},o),r),L1e(this.data,s,o),a.silent||this.emit("added",e,t,r)}},{key:"removeResourceBundle",value:function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}},{key:"hasResourceBundle",value:function(e,t){return void 0!==this.getResource(e,t)}},{key:"getResourceBundle",value:function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?r3(r3({},{}),this.getResource(e,t)):this.getResource(e,t)}},{key:"getDataByLanguage",value:function(e){return this.data[e]}},{key:"hasLanguageSomeTranslations",value:function(e){var t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find((function(e){return t[e]&&Object.keys(t[e]).length>0}))}},{key:"toJSON",value:function(){return this.data}}]),r}(),$1e={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,r,i,n){var a=this;return e.forEach((function(e){a.processors[e]&&(t=a.processors[e].process(t,r,i,n))})),t}};function B1e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function Mo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B1e(Object(r),!0).forEach((function(t){Oh(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B1e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Mxt(e){var t=Axt();return function(){var r,i=wc(e);if(t){var n=wc(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return s0(this,r)}}function Axt(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var N1e={},U1e=function(e){I1(r,Np);var t=Mxt(r);function r(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _c(this,r),i=t.call(this),a3&&Np.call(_u(i)),vxt(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,_u(i)),i.options=n,void 0===i.options.keySeparator&&(i.options.keySeparator="."),i.logger=Lh.create("translator"),i}return Tc(r,[{key:"changeLanguage",value:function(e){e&&(this.language=e)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;var r=this.resolve(e,t);return r&&void 0!==r.res}},{key:"extractFromKey",value:function(e,t){var r=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===r&&(r=":");var i=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,n=t.ns||this.options.defaultNS||[],a=r&&e.indexOf(r)>-1,s=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||_xt(e,r,i));if(a&&!s){var o=e.match(this.interpolator.nestingRegexp);if(o&&o.length>0)return{key:e,namespaces:n};var l=e.split(r);(r!==i||r===i&&this.options.ns.indexOf(l[0])>-1)&&(n=l.shift()),e=l.join(i)}return"string"==typeof n&&(n=[n]),{key:e,namespaces:n}}},{key:"translate",value:function(e,t,i){var n=this;if("object"!==ro(t)&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);var a=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,s=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,o=this.extractFromKey(e[e.length-1],t),l=o.key,h=o.namespaces,c=h[h.length-1],u=t.lng||this.language,d=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(u&&"cimode"===u.toLowerCase()){if(d){var p=t.nsSeparator||this.options.nsSeparator;return a?(f.res="".concat(c).concat(p).concat(l),f):"".concat(c).concat(p).concat(l)}return a?(f.res=l,f):l}var f=this.resolve(e,t),m=f&&f.res,g=f&&f.usedKey||l,v=f&&f.exactUsedKey||l,y=Object.prototype.toString.apply(m),b=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,x=!this.i18nFormat||this.i18nFormat.handleAsObject;if(x&&m&&("string"!=typeof m&&"boolean"!=typeof m&&"number"!=typeof m)&&["[object Number]","[object Function]","[object RegExp]"].indexOf(y)<0&&("string"!=typeof b||"[object Array]"!==y)){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");var _=this.options.returnedObjectHandler?this.options.returnedObjectHandler(g,m,Mo(Mo({},t),{},{ns:h})):"key '".concat(l," (").concat(this.language,")' returned an object instead of string.");return a?(f.res=_,f):_}if(s){var w="[object Array]"===y,S=w?[]:{},T=w?v:g;for(var M in m)if(Object.prototype.hasOwnProperty.call(m,M)){var E="".concat(T).concat(s).concat(M);S[M]=this.translate(E,Mo(Mo({},t),{joinArrays:!1,ns:h})),S[M]===E&&(S[M]=m[M])}m=S}}else if(x&&"string"==typeof b&&"[object Array]"===y)(m=m.join(b))&&(m=this.extendTranslation(m,e,t,i));else{var A=!1,C=!1,P=void 0!==t.count&&"string"!=typeof t.count,R=r.hasDefaultValue(t),I=P?this.pluralResolver.getSuffix(u,t.count,t):"",O=t["defaultValue".concat(I)]||t.defaultValue;!this.isValidLookup(m)&&R&&(A=!0,m=O),this.isValidLookup(m)||(C=!0,m=l);var L=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&C?void 0:m,D=R&&O!==m&&this.options.updateMissing;if(C||A||D){if(this.logger.log(D?"updateKey":"missingKey",u,c,l,D?O:m),s){var k=this.resolve(l,Mo(Mo({},t),{},{keySeparator:!1}));k&&k.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var F=[],N=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&N&&N[0])for(var U=0;U<N.length;U++)F.push(N[U]);else"all"===this.options.saveMissingTo?F=this.languageUtils.toResolveHierarchy(t.lng||this.language):F.push(t.lng||this.language);var B=function(e,r,i){var a=R&&i!==m?i:L;n.options.missingKeyHandler?n.options.missingKeyHandler(e,c,r,a,D,t):n.backendConnector&&n.backendConnector.saveMissing&&n.backendConnector.saveMissing(e,c,r,a,D,t),n.emit("missingKey",e,c,r,m)};this.options.saveMissing&&(this.options.saveMissingPlurals&&P?F.forEach((function(e){n.pluralResolver.getSuffixes(e,t).forEach((function(r){B([e],l+r,t["defaultValue".concat(r)]||O)}))})):B(F,l,O))}m=this.extendTranslation(m,e,t,f,i),C&&m===l&&this.options.appendNamespaceToMissingKey&&(m="".concat(c,":").concat(l)),(C||A)&&this.options.parseMissingKeyHandler&&(m="v1"!==this.options.compatibilityAPI?this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?"".concat(c,":").concat(l):l,A?m:void 0):this.options.parseMissingKeyHandler(m))}return a?(f.res=m,f):m}},{key:"extendTranslation",value:function(e,t,r,i,n){var a=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,Mo(Mo({},this.options.interpolation.defaultVariables),r),i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init(Mo(Mo({},r),{interpolation:Mo(Mo({},this.options.interpolation),r.interpolation)}));var s,o="string"==typeof e&&(r&&r.interpolation&&void 0!==r.interpolation.skipOnVariables?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);if(o){var l=e.match(this.interpolator.nestingRegexp);s=l&&l.length}var h=r.replace&&"string"!=typeof r.replace?r.replace:r;if(this.options.interpolation.defaultVariables&&(h=Mo(Mo({},this.options.interpolation.defaultVariables),h)),e=this.interpolator.interpolate(e,h,r.lng||this.language,r),o){var c=e.match(this.interpolator.nestingRegexp);s<(c&&c.length)&&(r.nest=!1)}!1!==r.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return n&&n[0]===i[0]&&!r.context?(a.logger.warn("It seems you are nesting recursively key: ".concat(i[0]," in key: ").concat(t[0])),null):a.translate.apply(a,i.concat([t]))}),r)),r.interpolation&&this.interpolator.reset()}var u=r.postProcess||this.options.postProcess,d="string"==typeof u?[u]:u;return null!=e&&d&&d.length&&!1!==r.applyPostProcessor&&(e=$1e.handle(d,e,t,this.options&&this.options.postProcessPassResolved?Mo({i18nResolved:i},r):r,this)),e}},{key:"resolve",value:function(e){var t,r,i,n,a,s=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((function(e){if(!s.isValidLookup(t)){var l=s.extractFromKey(e,o),h=l.key;r=h;var c=l.namespaces;s.options.fallbackNS&&(c=c.concat(s.options.fallbackNS));var u=void 0!==o.count&&"string"!=typeof o.count,d=u&&!o.ordinal&&0===o.count&&s.pluralResolver.shouldUseIntlApi(),p=void 0!==o.context&&("string"==typeof o.context||"number"==typeof o.context)&&""!==o.context,f=o.lngs?o.lngs:s.languageUtils.toResolveHierarchy(o.lng||s.language,o.fallbackLng);c.forEach((function(e){s.isValidLookup(t)||(a=e,!N1e["".concat(f[0],"-").concat(e)]&&s.utils&&s.utils.hasLoadedNamespace&&!s.utils.hasLoadedNamespace(a)&&(N1e["".concat(f[0],"-").concat(e)]=!0,s.logger.warn('key "'.concat(r,'" for languages "').concat(f.join(", "),'" won\'t get resolved as namespace "').concat(a,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),f.forEach((function(r){if(!s.isValidLookup(t)){n=r;var a,l=[h];if(s.i18nFormat&&s.i18nFormat.addLookupKeys)s.i18nFormat.addLookupKeys(l,h,r,e,o);else{var c;u&&(c=s.pluralResolver.getSuffix(r,o.count,o));var f="".concat(s.options.pluralSeparator,"zero");if(u&&(l.push(h+c),d&&l.push(h+f)),p){var m="".concat(h).concat(s.options.contextSeparator).concat(o.context);l.push(m),u&&(l.push(m+c),d&&l.push(m+f))}}for(;a=l.pop();)s.isValidLookup(t)||(i=a,t=s.getResource(r,e,a,o))}})))}))}})),{res:t,usedKey:r,exactUsedKey:i,usedLng:n,usedNS:a}}},{key:"isValidLookup",value:function(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}},{key:"getResource",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,r,i):this.resourceStore.getResource(e,t,r,i)}}],[{key:"hasDefaultValue",value:function(e){var t="defaultValue";for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t===r.substring(0,12)&&void 0!==e[r])return!0;return!1}}]),r}();function C8(e){return e.charAt(0).toUpperCase()+e.slice(1)}var Rxt=function(){function e(t){_c(this,e),this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Lh.create("languageUtils")}return Tc(e,[{key:"getScriptPartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return null;var t=e.split("-");return 2===t.length||(t.pop(),"x"===t[t.length-1].toLowerCase())?null:this.formatLanguageCode(t.join("-"))}},{key:"getLanguagePartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return e;var t=e.split("-");return this.formatLanguageCode(t[0])}},{key:"formatLanguageCode",value:function(e){if("string"==typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],r=e.split("-");return this.options.lowerCaseLng?r=r.map((function(e){return e.toLowerCase()})):2===r.length?(r[0]=r[0].toLowerCase(),r[1]=r[1].toUpperCase(),t.indexOf(r[1].toLowerCase())>-1&&(r[1]=C8(r[1].toLowerCase()))):3===r.length&&(r[0]=r[0].toLowerCase(),2===r[1].length&&(r[1]=r[1].toUpperCase()),"sgn"!==r[0]&&2===r[2].length&&(r[2]=r[2].toUpperCase()),t.indexOf(r[1].toLowerCase())>-1&&(r[1]=C8(r[1].toLowerCase())),t.indexOf(r[2].toLowerCase())>-1&&(r[2]=C8(r[2].toLowerCase()))),r.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}},{key:"isSupportedCode",value:function(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}},{key:"getBestMatchFromCodes",value:function(e){var t,r=this;return e?(e.forEach((function(e){if(!t){var i=r.formatLanguageCode(e);(!r.options.supportedLngs||r.isSupportedCode(i))&&(t=i)}})),!t&&this.options.supportedLngs&&e.forEach((function(e){if(!t){var i=r.getLanguagePartFromCode(e);if(r.isSupportedCode(i))return t=i;t=r.options.supportedLngs.find((function(e){if(0===e.indexOf(i))return e}))}})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}},{key:"getFallbackCodes",value:function(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),"string"==typeof e&&(e=[e]),"[object Array]"===Object.prototype.toString.apply(e))return e;if(!t)return e.default||[];var r=e[t];return r||(r=e[this.getScriptPartFromCode(t)]),r||(r=e[this.formatLanguageCode(t)]),r||(r=e[this.getLanguagePartFromCode(t)]),r||(r=e.default),r||[]}},{key:"toResolveHierarchy",value:function(e,t){var r=this,i=this.getFallbackCodes(t||this.options.fallbackLng||[],e),n=[],a=function(e){e&&(r.isSupportedCode(e)?n.push(e):r.logger.warn("rejecting language code not found in supportedLngs: ".concat(e)))};return"string"==typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&a(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&a(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&a(this.getLanguagePartFromCode(e))):"string"==typeof e&&a(this.formatLanguageCode(e)),i.forEach((function(e){n.indexOf(e)<0&&a(r.formatLanguageCode(e))})),n}}]),e}(),Cxt=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],Pxt={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}},Ixt=["v1","v2","v3"],H1e={zero:0,one:1,two:2,few:3,many:4,other:5};function Oxt(){var e={};return Cxt.forEach((function(t){t.lngs.forEach((function(r){e[r]={numbers:t.nr,plurals:Pxt[t.fc]}}))})),e}var Dxt=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_c(this,e),this.languageUtils=t,this.options=r,this.logger=Lh.create("pluralResolver"),(!this.options.compatibilityJSON||"v4"===this.options.compatibilityJSON)&&("undefined"==typeof Intl||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=Oxt()}return Tc(e,[{key:"addRule",value:function(e,t){this.rules[e]=t}},{key:"getRule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(e,{type:t.ordinal?"ordinal":"cardinal"})}catch(e){return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}},{key:"needsPlural",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.getRule(e,t);return this.shouldUseIntlApi()?r&&r.resolvedOptions().pluralCategories.length>1:r&&r.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,r).map((function(e){return"".concat(t).concat(e)}))}},{key:"getSuffixes",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.getRule(e,r);return i?this.shouldUseIntlApi()?i.resolvedOptions().pluralCategories.sort((function(e,t){return H1e[e]-H1e[t]})).map((function(e){return"".concat(t.options.prepend).concat(e)})):i.numbers.map((function(i){return t.getSuffix(e,i,r)})):[]}},{key:"getSuffix",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this.getRule(e,r);return i?this.shouldUseIntlApi()?"".concat(this.options.prepend).concat(i.select(t)):this.getSuffixRetroCompatible(i,t):(this.logger.warn("no plural rule found for: ".concat(e)),"")}},{key:"getSuffixRetroCompatible",value:function(e,t){var r=this,i=e.noAbs?e.plurals(t):e.plurals(Math.abs(t)),n=e.numbers[i];this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]&&(2===n?n="plural":1===n&&(n=""));var a=function(){return r.options.prepend&&n.toString()?r.options.prepend+n.toString():n.toString()};return"v1"===this.options.compatibilityJSON?1===n?"":"number"==typeof n?"_plural_".concat(n.toString()):a():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]?a():this.options.prepend&&i.toString()?this.options.prepend+i.toString():i.toString()}},{key:"shouldUseIntlApi",value:function(){return!Ixt.includes(this.options.compatibilityJSON)}}]),e}();function V1e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function Tu(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?V1e(Object(r),!0).forEach((function(t){Oh(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V1e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Lxt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_c(this,e),this.logger=Lh.create("interpolator"),this.options=t,this.format=t.interpolation&&t.interpolation.format||function(e){return e},this.init(t)}return Tc(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escape=void 0!==t.escape?t.escape:xxt,this.escapeValue=void 0===t.escapeValue||t.escapeValue,this.useRawValueToEscape=void 0!==t.useRawValueToEscape&&t.useRawValueToEscape,this.prefix=t.prefix?O1(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?O1(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?O1(t.nestingPrefix):t.nestingPrefixEscaped||O1("$t("),this.nestingSuffix=t.nestingSuffix?O1(t.nestingSuffix):t.nestingSuffixEscaped||O1(")"),this.nestingOptionsSeparator=t.nestingOptionsSeparator?t.nestingOptionsSeparator:t.nestingOptionsSeparator||",",this.maxReplaces=t.maxReplaces?t.maxReplaces:1e3,this.alwaysFormat=void 0!==t.alwaysFormat&&t.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var e="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(e,"g");var t="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(t,"g");var r="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(r,"g")}},{key:"interpolate",value:function(e,t,r,i){var n,a,s,o=this,l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function h(e){return e.replace(/\$/g,"$$$$")}var c=function(e){if(e.indexOf(o.formatSeparator)<0){var n=k1e(t,l,e);return o.alwaysFormat?o.format(n,void 0,r,Tu(Tu(Tu({},i),t),{},{interpolationkey:e})):n}var a=e.split(o.formatSeparator),s=a.shift().trim(),h=a.join(o.formatSeparator).trim();return o.format(k1e(t,l,s),h,r,Tu(Tu(Tu({},i),t),{},{interpolationkey:s}))};this.resetRegExp();var u=i&&i.missingInterpolationHandler||this.options.missingInterpolationHandler,d=i&&i.interpolation&&void 0!==i.interpolation.skipOnVariables?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function(e){return h(e)}},{regex:this.regexp,safeValue:function(e){return o.escapeValue?h(o.escape(e)):h(e)}}].forEach((function(t){for(s=0;n=t.regex.exec(e);){var r=n[1].trim();if(void 0===(a=c(r)))if("function"==typeof u){var l=u(e,n,i);a="string"==typeof l?l:""}else if(i&&i.hasOwnProperty(r))a="";else{if(d){a=n[0];continue}o.logger.warn("missed to pass in variable ".concat(r," for interpolating ").concat(e)),a=""}else"string"!=typeof a&&!o.useRawValueToEscape&&(a=D1e(a));var h=t.safeValue(a);if(e=e.replace(n[0],h),d?(t.regex.lastIndex+=a.length,t.regex.lastIndex-=n[0].length):t.regex.lastIndex=0,++s>=o.maxReplaces)break}})),e}},{key:"nest",value:function(e,t){var r,i,n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=Tu({},a);function o(e,t){var r=this.nestingOptionsSeparator;if(e.indexOf(r)<0)return e;var i=e.split(new RegExp("".concat(r,"[ ]*{"))),n="{".concat(i[1]);e=i[0];var a=(n=this.interpolate(n,s)).match(/'/g),o=n.match(/"/g);(a&&a.length%2==0&&!o||o.length%2!=0)&&(n=n.replace(/'/g,'"'));try{s=JSON.parse(n),t&&(s=Tu(Tu({},t),s))}catch(t){return this.logger.warn("failed parsing options string in nesting for key ".concat(e),t),"".concat(e).concat(r).concat(n)}return delete s.defaultValue,e}for(s.applyPostProcessor=!1,delete s.defaultValue;r=this.nestingRegexp.exec(e);){var l=[],h=!1;if(-1!==r[0].indexOf(this.formatSeparator)&&!/{.*}/.test(r[1])){var c=r[1].split(this.formatSeparator).map((function(e){return e.trim()}));r[1]=c.shift(),l=c,h=!0}if((i=t(o.call(this,r[1].trim(),s),s))&&r[0]===e&&"string"!=typeof i)return i;"string"!=typeof i&&(i=D1e(i)),i||(this.logger.warn("missed to resolve ".concat(r[1]," for nesting ").concat(e)),i=""),h&&(i=l.reduce((function(e,t){return n.format(e,t,a.lng,Tu(Tu({},a),{},{interpolationkey:r[1].trim()}))}),i.trim())),e=e.replace(r[0],i),this.regexp.lastIndex=0}return e}}]),e}();function z1e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function Bp(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?z1e(Object(r),!0).forEach((function(t){Oh(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z1e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function kxt(e){var t=e.toLowerCase().trim(),r={};if(e.indexOf("(")>-1){var i=e.split("(");t=i[0].toLowerCase().trim();var n=i[1].substring(0,i[1].length-1);if("currency"===t&&n.indexOf(":")<0)r.currency||(r.currency=n.trim());else if("relativetime"===t&&n.indexOf(":")<0)r.range||(r.range=n.trim());else{n.split(";").forEach((function(e){if(e){var t=R8(e.split(":")),i=t[0],n=t.slice(1).join(":").trim().replace(/^'+|'+$/g,"");r[i.trim()]||(r[i.trim()]=n),"false"===n&&(r[i.trim()]=!1),"true"===n&&(r[i.trim()]=!0),isNaN(n)||(r[i.trim()]=parseInt(n,10))}}))}}return{formatName:t,formatOptions:r}}function D1(e){var t={};return function(r,i,n){var a=i+JSON.stringify(n),s=t[a];return s||(s=e(i,n),t[a]=s),s(r)}}var Fxt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_c(this,e),this.logger=Lh.create("formatter"),this.options=t,this.formats={number:D1((function(e,t){var r=new Intl.NumberFormat(e,t);return function(e){return r.format(e)}})),currency:D1((function(e,t){var r=new Intl.NumberFormat(e,Bp(Bp({},t),{},{style:"currency"}));return function(e){return r.format(e)}})),datetime:D1((function(e,t){var r=new Intl.DateTimeFormat(e,Bp({},t));return function(e){return r.format(e)}})),relativetime:D1((function(e,t){var r=new Intl.RelativeTimeFormat(e,Bp({},t));return function(e){return r.format(e,t.range||"day")}})),list:D1((function(e,t){var r=new Intl.ListFormat(e,Bp({},t));return function(e){return r.format(e)}}))},this.init(t)}return Tc(e,[{key:"init",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||","}},{key:"add",value:function(e,t){this.formats[e.toLowerCase().trim()]=t}},{key:"addCached",value:function(e,t){this.formats[e.toLowerCase().trim()]=D1(t)}},{key:"format",value:function(e,t,r,i){var n=this;return t.split(this.formatSeparator).reduce((function(e,t){var a=kxt(t),s=a.formatName,o=a.formatOptions;if(n.formats[s]){var l=e;try{var h=i&&i.formatParams&&i.formatParams[i.interpolationkey]||{},c=h.locale||h.lng||i.locale||i.lng||r;l=n.formats[s](e,c,Bp(Bp(Bp({},o),i),h))}catch(e){n.logger.warn(e)}return l}return n.logger.warn("there was no format function for ".concat(s)),e}),e)}}]),e}();function G1e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function q1e(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?G1e(Object(r),!0).forEach((function(t){Oh(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G1e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Bxt(e){var t=Nxt();return function(){var r,i=wc(e);if(t){var n=wc(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return s0(this,r)}}function Nxt(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Uxt(e,t){void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)}var Hxt=function(e){I1(r,Np);var t=Bxt(r);function r(e,i,n){var a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return _c(this,r),a=t.call(this),a3&&Np.call(_u(a)),a.backend=e,a.store=i,a.services=n,a.languageUtils=n.languageUtils,a.options=s,a.logger=Lh.create("backendConnector"),a.waitingReads=[],a.maxParallelReads=s.maxParallelReads||10,a.readingCalls=0,a.maxRetries=s.maxRetries>=0?s.maxRetries:5,a.retryTimeout=s.retryTimeout>=1?s.retryTimeout:350,a.state={},a.queue=[],a.backend&&a.backend.init&&a.backend.init(n,s.backend,s),a}return Tc(r,[{key:"queueLoad",value:function(e,t,r,i){var n=this,a={},s={},o={},l={};return e.forEach((function(e){var i=!0;t.forEach((function(t){var o="".concat(e,"|").concat(t);!r.reload&&n.store.hasResourceBundle(e,t)?n.state[o]=2:n.state[o]<0||(1===n.state[o]?void 0===s[o]&&(s[o]=!0):(n.state[o]=1,i=!1,void 0===s[o]&&(s[o]=!0),void 0===a[o]&&(a[o]=!0),void 0===l[t]&&(l[t]=!0)))})),i||(o[e]=!0)})),(Object.keys(a).length||Object.keys(s).length)&&this.queue.push({pending:s,pendingCount:Object.keys(s).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(a),pending:Object.keys(s),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(l)}}},{key:"loaded",value:function(e,t,r){var i=e.split("|"),n=i[0],a=i[1];t&&this.emit("failedLoading",n,a,t),r&&this.store.addResourceBundle(n,a,r),this.state[e]=t?-1:2;var s={};this.queue.forEach((function(r){yxt(r.loaded,[n],a),Uxt(r,e),t&&r.errors.push(t),0===r.pendingCount&&!r.done&&(Object.keys(r.loaded).forEach((function(e){s[e]||(s[e]={});var t=r.loaded[e];t.length&&t.forEach((function(t){void 0===s[e][t]&&(s[e][t]=!0)}))})),r.done=!0,r.errors.length?r.callback(r.errors):r.callback())})),this.emit("loaded",s),this.queue=this.queue.filter((function(e){return!e.done}))}},{key:"read",value:function(e,t,r){var i=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,s=arguments.length>5?arguments[5]:void 0;return e.length?this.readingCalls>=this.maxParallelReads?void this.waitingReads.push({lng:e,ns:t,fcName:r,tried:n,wait:a,callback:s}):(this.readingCalls++,this.backend[r](e,t,(function(o,l){if(i.readingCalls--,i.waitingReads.length>0){var h=i.waitingReads.shift();i.read(h.lng,h.ns,h.fcName,h.tried,h.wait,h.callback)}o&&l&&n<i.maxRetries?setTimeout((function(){i.read.call(i,e,t,r,n+1,2*a,s)}),a):s(o,l)}))):s(null,{})}},{key:"prepareLoading",value:function(e,t){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),n&&n();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);var a=this.queueLoad(e,t,i,n);if(!a.toLoad.length)return a.pending.length||n(),null;a.toLoad.forEach((function(e){r.loadOne(e)}))}},{key:"load",value:function(e,t,r){this.prepareLoading(e,t,{},r)}},{key:"reload",value:function(e,t,r){this.prepareLoading(e,t,{reload:!0},r)}},{key:"loadOne",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=e.split("|"),n=i[0],a=i[1];this.read(n,a,"read",void 0,void 0,(function(i,s){i&&t.logger.warn("".concat(r,"loading namespace ").concat(a," for language ").concat(n," failed"),i),!i&&s&&t.logger.log("".concat(r,"loaded namespace ").concat(a," for language ").concat(n),s),t.loaded(e,i,s)}))}},{key:"saveMissing",value:function(e,t,r,i,n){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)?this.logger.warn('did not save key "'.concat(r,'" as the namespace "').concat(t,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!"):null==r||""===r||(this.backend&&this.backend.create&&this.backend.create(e,t,r,i,null,q1e(q1e({},a),{},{isUpdate:n})),e&&e[0]&&this.store.addResource(e[0],t,r,i))}}]),r}();function Vxt(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var t={};if("object"===ro(e[1])&&(t=e[1]),"string"==typeof e[1]&&(t.defaultValue=e[1]),"string"==typeof e[2]&&(t.tDescription=e[2]),"object"===ro(e[2])||"object"===ro(e[3])){var r=e[3]||e[2];Object.keys(r).forEach((function(e){t[e]=r[e]}))}return t},interpolation:{escapeValue:!0,format:function(e,t,r,i){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}}function j1e(e){return"string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e}function W1e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function Dh(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?W1e(Object(r),!0).forEach((function(t){Oh(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W1e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function zxt(e){var t=Gxt();return function(){var r,i=wc(e);if(t){var n=wc(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return s0(this,r)}}function Gxt(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function n3(){}function qxt(e){Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach((function(t){"function"==typeof e[t]&&(e[t]=e[t].bind(e))}))}var s3=function(e){I1(r,Np);var t=zxt(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(_c(this,r),e=t.call(this),a3&&Np.call(_u(e)),e.options=j1e(i),e.services={},e.logger=Lh,e.modules={external:[]},qxt(_u(e)),n&&!e.isInitialized&&!i.isClone){if(!e.options.initImmediate)return e.init(i,n),s0(e,_u(e));setTimeout((function(){e.init(i,n)}),0)}return e}return Tc(r,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;"function"==typeof t&&(r=t,t={}),!t.defaultNS&&!1!==t.defaultNS&&t.ns&&("string"==typeof t.ns?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));var i=Vxt();function n(e){return e?"function"==typeof e?new e:e:null}if(this.options=Dh(Dh(Dh({},i),this.options),j1e(t)),"v1"!==this.options.compatibilityAPI&&(this.options.interpolation=Dh(Dh({},i.interpolation),this.options.interpolation)),void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator),!this.options.isClone){var a;this.modules.logger?Lh.init(n(this.modules.logger),this.options):Lh.init(null,this.options),this.modules.formatter?a=this.modules.formatter:"undefined"!=typeof Intl&&(a=Fxt);var s=new Rxt(this.options);this.store=new Sxt(this.options.resources,this.options);var o=this.services;o.logger=Lh,o.resourceStore=this.store,o.languageUtils=s,o.pluralResolver=new Dxt(s,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),a&&(!this.options.interpolation.format||this.options.interpolation.format===i.interpolation.format)&&(o.formatter=n(a),o.formatter.init(o,this.options),this.options.interpolation.format=o.formatter.format.bind(o.formatter)),o.interpolator=new Lxt(this.options),o.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},o.backendConnector=new Hxt(n(this.modules.backend),o.resourceStore,o,this.options),o.backendConnector.on("*",(function(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];e.emit.apply(e,[t].concat(i))})),this.modules.languageDetector&&(o.languageDetector=n(this.modules.languageDetector),o.languageDetector.init(o,this.options.detection,this.options)),this.modules.i18nFormat&&(o.i18nFormat=n(this.modules.i18nFormat),o.i18nFormat.init&&o.i18nFormat.init(this)),this.translator=new U1e(this.services,this.options),this.translator.on("*",(function(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];e.emit.apply(e,[t].concat(i))})),this.modules.external.forEach((function(t){t.init&&t.init(e)}))}if(this.format=this.options.interpolation.format,r||(r=n3),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var l=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);l.length>0&&"dev"!==l[0]&&(this.options.lng=l[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined");["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach((function(t){e[t]=function(){var r;return(r=e.store)[t].apply(r,arguments)}}));["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach((function(t){e[t]=function(){var r;return(r=e.store)[t].apply(r,arguments),e}}));var h=bT(),c=function(){var t=function(t,i){e.isInitialized&&!e.initializedStoreOnce&&e.logger.warn("init: i18next is already initialized. You should call init just once!"),e.isInitialized=!0,e.options.isClone||e.logger.log("initialized",e.options),e.emit("initialized",e.options),h.resolve(i),r(t,i)};if(e.languages&&"v1"!==e.options.compatibilityAPI&&!e.isInitialized)return t(null,e.t.bind(e));e.changeLanguage(e.options.lng,t)};return this.options.resources||!this.options.initImmediate?c():setTimeout(c,0),h}},{key:"loadResources",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n3,i="string"==typeof e?e:this.language;if("function"==typeof e&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if(i&&"cimode"===i.toLowerCase())return r();var n=[],a=function(e){e&&t.services.languageUtils.toResolveHierarchy(e).forEach((function(e){n.indexOf(e)<0&&n.push(e)}))};if(i)a(i);else this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach((function(e){return a(e)}));this.options.preload&&this.options.preload.forEach((function(e){return a(e)})),this.services.backendConnector.load(n,this.options.ns,(function(e){!e&&!t.resolvedLanguage&&t.language&&t.setResolvedLanguage(t.language),r(e)}))}else r(null)}},{key:"reloadResources",value:function(e,t,r){var i=bT();return e||(e=this.languages),t||(t=this.options.ns),r||(r=n3),this.services.backendConnector.reload(e,t,(function(e){i.resolve(),r(e)})),i}},{key:"use",value:function(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&$1e.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}},{key:"setResolvedLanguage",value:function(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(var t=0;t<this.languages.length;t++){var r=this.languages[t];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}}},{key:"changeLanguage",value:function(e,t){var r=this;this.isLanguageChangingTo=e;var i=bT();this.emit("languageChanging",e);var n=function(e){r.language=e,r.languages=r.services.languageUtils.toResolveHierarchy(e),r.resolvedLanguage=void 0,r.setResolvedLanguage(e)},a=function(a){!e&&!a&&r.services.languageDetector&&(a=[]);var s="string"==typeof a?a:r.services.languageUtils.getBestMatchFromCodes(a);s&&(r.language||n(s),r.translator.language||r.translator.changeLanguage(s),r.services.languageDetector&&r.services.languageDetector.cacheUserLanguage(s)),r.loadResources(s,(function(e){!function(e,a){a?(n(a),r.translator.changeLanguage(a),r.isLanguageChangingTo=void 0,r.emit("languageChanged",a),r.logger.log("languageChanged",a)):r.isLanguageChangingTo=void 0,i.resolve((function(){return r.t.apply(r,arguments)})),t&&t(e,(function(){return r.t.apply(r,arguments)}))}(e,s)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect(a):a(e):a(this.services.languageDetector.detect()),i}},{key:"getFixedT",value:function(e,t,r){var i=this,n=function e(t,n){var a;if("object"!==ro(n)){for(var s=arguments.length,o=new Array(s>2?s-2:0),l=2;l<s;l++)o[l-2]=arguments[l];a=i.options.overloadTranslationOptionHandler([t,n].concat(o))}else a=Dh({},n);a.lng=a.lng||e.lng,a.lngs=a.lngs||e.lngs,a.ns=a.ns||e.ns,a.keyPrefix=a.keyPrefix||r||e.keyPrefix;var h=i.options.keySeparator||".",c=a.keyPrefix?"".concat(a.keyPrefix).concat(h).concat(t):t;return i.t(c,a)};return"string"==typeof e?n.lng=e:n.lngs=e,n.ns=t,n.keyPrefix=r,n}},{key:"t",value:function(){var e;return this.translator&&(e=this.translator).translate.apply(e,arguments)}},{key:"exists",value:function(){var e;return this.translator&&(e=this.translator).exists.apply(e,arguments)}},{key:"setDefaultNamespace",value:function(e){this.options.defaultNS=e}},{key:"hasLoadedNamespace",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var i=this.resolvedLanguage||this.languages[0],n=!!this.options&&this.options.fallbackLng,a=this.languages[this.languages.length-1];if("cimode"===i.toLowerCase())return!0;var s=function(e,r){var i=t.services.backendConnector.state["".concat(e,"|").concat(r)];return-1===i||2===i};if(r.precheck){var o=r.precheck(this,s);if(void 0!==o)return o}return!!(this.hasResourceBundle(i,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||s(i,e)&&(!n||s(a,e)))}},{key:"loadNamespaces",value:function(e,t){var r=this,i=bT();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach((function(e){r.options.ns.indexOf(e)<0&&r.options.ns.push(e)})),this.loadResources((function(e){i.resolve(),t&&t(e)})),i):(t&&t(),Promise.resolve())}},{key:"loadLanguages",value:function(e,t){var r=bT();"string"==typeof e&&(e=[e]);var i=this.options.preload||[],n=e.filter((function(e){return i.indexOf(e)<0}));return n.length?(this.options.preload=i.concat(n),this.loadResources((function(e){r.resolve(),t&&t(e)})),r):(t&&t(),Promise.resolve())}},{key:"dir",value:function(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(this.services.languageUtils.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}},{key:"cloneInstance",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n3,n=Dh(Dh(Dh({},this.options),t),{isClone:!0}),a=new r(n);(void 0!==t.debug||void 0!==t.prefix)&&(a.logger=a.logger.clone(t));return["store","services","language"].forEach((function(t){a[t]=e[t]})),a.services=Dh({},this.services),a.services.utils={hasLoadedNamespace:a.hasLoadedNamespace.bind(a)},a.translator=new U1e(a.services,a.options),a.translator.on("*",(function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];a.emit.apply(a,[e].concat(r))})),a.init(n,i),a.translator.options=a.options,a.translator.backendConnector.services.utils={hasLoadedNamespace:a.hasLoadedNamespace.bind(a)},a}},{key:"toJSON",value:function(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}]),r}();Oh(s3,"createInstance",(function(){return new s3(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}));var Ao=s3.createInstance();Ao.createInstance=s3.createInstance;var LWt=Ao.createInstance,kWt=Ao.init,FWt=Ao.loadResources,BWt=Ao.reloadResources,NWt=Ao.use,UWt=Ao.changeLanguage,HWt=Ao.getFixedT,xn=Ao.t,VWt=Ao.exists,zWt=Ao.setDefaultNamespace,GWt=Ao.hasLoadedNamespace,qWt=Ao.loadNamespaces,jWt=Ao.loadLanguages,a0=Ao,o3=class{constructor(e){var t;this.jobCount=0;let r=document.createElement("div");r.classList.add("x-spinner"),r.appendChild(document.createElement("span")),r.appendChild(document.createElement("span")),r.appendChild(document.createElement("span")),r.appendChild(document.createElement("span")),null==(t=e.widgetContainer)||t.appendChild(r),this.element=r,this.setSpinnerVisibility(this.jobCount>0)}setSpinnerVisibility(e){e?this.element.classList.remove("hidden"):this.element.classList.add("hidden")}increaseJobCount(){this.setSpinnerVisibility(++this.jobCount>0)}decreaseJobCount(){this.jobCount<=0?de.warn("[Viewer] jobCount should be at least 1 here!"):this.setSpinnerVisibility(--this.jobCount>0)}destroy(){this.element.remove(),this.jobCount=0}},L1=class{constructor(e){this.width=0,this.height=0;let t=document.getElementById(e);t||(de.warn("[Container] containerId:",e,"is not found in dom tree! will append to document body"),t=document.body);let r=document.createElement("div");r.classList.add("x-container"),r.style.cssText="width: 100%; height: 100%; position: relative;",t.appendChild(r),this.container=r,this.width=t.clientWidth,this.height=t.clientHeight,this.initViewerContainer(),this.initWidgetContainer()}initViewerContainer(){let e=this.container;if(!e)return;let t=document.createElement("div");t.classList.add("x-viewer-container"),t.style.cssText="width: 100%; height: 100%; display: inline-block; position: relative; overflow: hidden;",e.appendChild(t),this.viewerContainer=t}initWidgetContainer(){let e=this.container;if(!e)return;let t=document.createElement("div");t.classList.add("x-widget-container"),e.appendChild(t),this.widgetContainer=t}get needResize(){let e=this.width!==this.container.clientWidth||this.height!==this.container.clientHeight;return e&&(this.width=this.container.clientWidth,this.height=this.container.clientHeight),e}destroy(){this.widgetContainer&&(this.widgetContainer.remove(),this.widgetContainer=void 0),this.viewerContainer&&(this.viewerContainer.remove(),this.viewerContainer=void 0),this.container.remove()}},k1=class{constructor(e){var t;this.progressItems=new Map,this.replaceReg=new RegExp(/<em>[\s\S]*<\/em>/,"g");let r=document.createElement("div");r.classList.add("progress-bar"),null==(t=e.widgetContainer)||t.appendChild(r),this.element=r}addProgressItem(e,t="ProgressBar.Loading",r){this.progressItems.get(e)&&de.error(`[Viewer] ProgressItem with id ${e} already exists!`);let i=document.createElement("div");i.classList.add("progress-bar-item"),i.innerHTML=`${xn(t)}: <em></em>`,this.element.append(i),this.progressItems.set(e,{div:i,onProgress:r})}removeProgressItem(e){let t=this.progressItems.get(e);null==t||t.div.remove(),this.progressItems.delete(e),0===this.progressItems.size&&this.setVisible(!1)}updateProgress(e,t,r){let i=this.progressItems.get(e);if(!i)return;let n=t?`${t}`:"";t&&null!=r&&(n+=": "),null!=r&&(r<0||r>100?(console.warn(`[ProgressBar] Invalid progress value: ${r}`),n+="--%"):n+=`${r.toFixed(2)}%`),i.div.innerHTML=n}updateProgressBar(e,t,r=0,i=100){var n;let a=this.progressItems.get(e);if(!a)return;let s=100*(t instanceof ProgressEvent?t.loaded:t)/(t instanceof ProgressEvent?t.total:100)*(i-r)/100+r;a.div.innerHTML=a.div.innerHTML.replace(this.replaceReg,`<em>${s<0||s>100?"--":s.toFixed(2)}%</em>`),null==(n=a.onProgress)||n.call(a,new ProgressEvent("LoadProgress",{loaded:s,total:100}))}setVisible(e){e?this.element.classList.remove("hidden"):this.element.classList.add("hidden")}delayRemoveProgressItem(e,t=3e3){setTimeout((()=>{let t=this.progressItems.get(e);null==t||t.div.remove(),this.progressItems.delete(e)}),t)}destroy(){this.progressItems.forEach((e=>{e.div.remove()})),this.progressItems.clear(),this.element.remove()}},o0=(e=>(e.Perspective="Perspective",e.Orthographic="Orthographic",e))(o0||{}),iXt={enableSpinner:!0,containerId:"myCanvas"},mn={LEFT:1,RIGHT:2,MIDDLE:4},kt=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768});function el(e){return e.isPerspectiveCamera}function la(e){return e.isOrthographicCamera}var l0=2*Math.PI,I8=Math.PI/2,F1=Math.PI/180;function c0(e,t,r){return Math.max(t,Math.min(r,e))}function cs(e,t=1e-5){return Math.abs(e)<t}function us(e,t,r=1e-5){return cs(e-t,r)}function O8(e,t){return Math.round(e/t)*t}function B1(e){return isFinite(e)?e:e<0?-Number.MAX_VALUE:Number.MAX_VALUE}function N1(e){return Math.abs(e)<Number.MAX_VALUE?e:e*(1/0)}function xT(e,t,r,i,n=1/0,a){let s=2/(i=Math.max(1e-4,i)),o=s*a,l=1/(1+o+.48*o*o+.235*o*o*o),h=e-t,c=t,u=n*i;h=c0(h,-u,u),t=e-h;let d=(r.value+s*h)*a;r.value=(r.value-s*d)*l;let p=t+(h+d)*l;return c-e>0==p>c&&(p=c,r.value=(p-c)/a),p}function D8(e,t,r,i,n=1/0,a,s){let o=2/(i=Math.max(1e-4,i)),l=o*a,h=1/(1+l+.48*l*l+.235*l*l*l),c=t.x,u=t.y,d=t.z,p=e.x-c,f=e.y-u,m=e.z-d,g=c,v=u,y=d,b=n*i,x=p*p+f*f+m*m;if(x>b*b){let e=Math.sqrt(x);p=p/e*b,f=f/e*b,m=m/e*b}c=e.x-p,u=e.y-f,d=e.z-m;let _=(r.x+o*p)*a,w=(r.y+o*f)*a,S=(r.z+o*m)*a;r.x=(r.x-o*_)*h,r.y=(r.y-o*w)*h,r.z=(r.z-o*S)*h,s.x=c+(p+_)*h,s.y=u+(f+w)*h,s.z=d+(m+S)*h;let T=g-e.x,M=v-e.y,E=y-e.z;return T*(s.x-g)+M*(s.y-v)+E*(s.z-y)>0&&(s.x=g,s.y=v,s.z=y,r.x=(s.x-g)/a,r.y=(s.y-v)/a,r.z=(s.z-y)/a),s}function l3(e,t){t.set(0,0),e.forEach((e=>{t.x+=e.clientX,t.y+=e.clientY})),t.x/=e.length,t.y/=e.length}function c3(e,t){return!!la(e)&&(console.warn(`${t} is not supported in OrthographicCamera`),!0)}var u3=class{constructor(){this._listeners={}}addEventListener(e,t){let r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){let r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){let r=this._listeners[e];if(void 0!==r){let e=r.indexOf(t);-1!==e&&r.splice(e,1)}}removeAllEventListeners(e){e?Array.isArray(this._listeners[e])&&(this._listeners[e].length=0):this._listeners={}}dispatchEvent(e){let t=this._listeners[e.type];if(void 0!==t){e.target=this;let r=t.slice(0);for(let t=0,i=r.length;t<i;t++)r[t].call(this,e)}}},h3=1/8,jxt=Pn.isBrowser&&/Mac/.test(navigator.platform),Wxt=!(Pn.isBrowser&&"PointerEvent"in window),gn,Z1e,d3,L8,tl,En,ji,U1,kh,Fh,u0,K1e,J1e,wu,ET,H1,Q1e,k8,ebe,F8,B8,f3,Bh=class extends u3{constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=0,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=kt.NONE,this._viewport=null,this._dollyControlAmount=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=Pn.isBrowser?new DOMRect:{x:0,y:0,width:0,height:0,left:0,right:0,top:0,bottom:0},this._activePointers=[],this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new gn.Vector3,this._focalOffsetVelocity=new gn.Vector3,this._zoomVelocity={value:0},this._truckInternal=(e,t,r)=>{if(el(this._camera)){let i=En.copy(this._camera.position).sub(this._target),n=this._camera.getEffectiveFOV()*F1,a=i.length()*Math.tan(.5*n),s=this.truckSpeed*e*a/this._elementRect.height,o=this.truckSpeed*t*a/this._elementRect.height;this.verticalDragToForward?(r?this.setFocalOffset(this._focalOffsetEnd.x+s,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(s,0,!0),this.forward(-o,!0)):r?this.setFocalOffset(this._focalOffsetEnd.x+s,this._focalOffsetEnd.y+o,this._focalOffsetEnd.z,!0):this.truck(s,o,!0)}else if(la(this._camera)){let i=this._camera,n=this.truckSpeed*e*(i.right-i.left)/i.zoom/this._elementRect.width,a=this.truckSpeed*t*(i.top-i.bottom)/i.zoom/this._elementRect.height;r?this.setFocalOffset(this._focalOffsetEnd.x+n,this._focalOffsetEnd.y+a,this._focalOffsetEnd.z,!0):this.truck(n,a,!0)}},this._rotateInternal=(e,t)=>{let r=l0*this.azimuthRotateSpeed*e/this._elementRect.height,i=l0*this.polarRotateSpeed*t/this._elementRect.height;this.rotate(r,i,!0)},this._dollyInternal=(e,t,r)=>{let i=Math.pow(.95,-e*this.dollySpeed),n=this._sphericalEnd.radius*i,a=this._sphericalEnd.radius,s=a*(e>=0?-1:1);this.dollyTo(n),this.infinityDolly&&(n<this.minDistance||this.maxDistance===this.minDistance)&&(this._camera.getWorldDirection(En),this._targetEnd.add(En.normalize().multiplyScalar(s)),this._target.add(En.normalize().multiplyScalar(s))),this.dollyToCursor&&(this._dollyControlAmount+=this._sphericalEnd.radius-a,this.infinityDolly&&(n<this.minDistance||this.maxDistance===this.minDistance)&&(this._dollyControlAmount-=s),this._dollyControlCoord.set(t,r))},this._zoomInternal=(e,t,r)=>{let i=Math.pow(.95,e*this.dollySpeed),n=this._zoomEnd;this.zoomTo(this._zoom*i),this.dollyToCursor&&(this._dollyControlAmount+=this._zoomEnd-n,this._dollyControlCoord.set(t,r))},void 0===gn&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=(new gn.Quaternion).setFromUnitVectors(this._camera.up,d3),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=kt.NONE,this._target=new gn.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new gn.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=(new gn.Spherical).setFromVector3(En.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._nearPlaneCorners=[new gn.Vector3,new gn.Vector3,new gn.Vector3,new gn.Vector3],this._updateNearPlaneCorners(),this._boundary=new gn.Box3(new gn.Vector3(-1/0,-1/0,-1/0),new gn.Vector3(1/0,1/0,1/0)),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlAmount=0,this._dollyControlCoord=new gn.Vector2,this.mouseButtons={left:kt.ROTATE,middle:kt.DOLLY,right:kt.TRUCK,wheel:el(this._camera)?kt.DOLLY:la(this._camera)?kt.ZOOM:kt.NONE},this.touches={one:kt.TOUCH_ROTATE,two:el(this._camera)?kt.TOUCH_DOLLY_TRUCK:la(this._camera)?kt.TOUCH_ZOOM_TRUCK:kt.NONE,three:kt.TOUCH_TRUCK};let r=new gn.Vector2,i=new gn.Vector2,n=new gn.Vector2,a=e=>{if(!this._enabled||!this._domElement)return;let t="mouse"!==e.pointerType?null:(e.buttons&mn.LEFT)===mn.LEFT?mn.LEFT:(e.buttons&mn.MIDDLE)===mn.MIDDLE?mn.MIDDLE:(e.buttons&mn.RIGHT)===mn.RIGHT?mn.RIGHT:null;if(null!==t){let e=this._findPointerByMouseButton(t);e&&this._activePointers.splice(this._activePointers.indexOf(e),1)}let r={pointerId:e.pointerId,clientX:e.clientX,clientY:e.clientY,deltaX:0,deltaY:0,mouseButton:t};this._activePointers.push(r),this._domElement.removeEventListener("pointermove",o),this._domElement.removeEventListener("pointerup",h),this._domElement.addEventListener("pointermove",o),this._domElement.addEventListener("pointerup",h),f(e)},s=e=>{if(!this._enabled||!this._domElement)return;let t=(e.buttons&mn.LEFT)===mn.LEFT?mn.LEFT:(e.buttons&mn.MIDDLE)===mn.MIDDLE?mn.MIDDLE:(e.buttons&mn.RIGHT)===mn.RIGHT?mn.RIGHT:null;if(null!==t){let e=this._findPointerByMouseButton(t);e&&this._activePointers.splice(this._activePointers.indexOf(e),1)}let r={pointerId:0,clientX:e.clientX,clientY:e.clientY,deltaX:0,deltaY:0,mouseButton:(e.buttons&mn.LEFT)===mn.LEFT?mn.LEFT:(e.buttons&mn.MIDDLE)===mn.LEFT?mn.MIDDLE:(e.buttons&mn.RIGHT)===mn.LEFT?mn.RIGHT:null};this._activePointers.push(r),this._domElement.removeEventListener("mousemove",l),this._domElement.removeEventListener("mouseup",c),this._domElement.addEventListener("mousemove",l),this._domElement.addEventListener("mouseup",c),f(e)},o=e=>{let t=e.pointerId,r=this._findPointerById(t);if(r){if(r.clientX=e.clientX,r.clientY=e.clientY,r.deltaX=e.movementX,r.deltaY=e.movementY,"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=0,(e.buttons&mn.LEFT)===mn.LEFT&&(this._state=this._state|this.mouseButtons.left),(e.buttons&mn.MIDDLE)===mn.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(e.buttons&mn.RIGHT)===mn.RIGHT&&(this._state=this._state|this.mouseButtons.right);m()}},l=e=>{let t=this._findPointerById(0);t&&(t.clientX=e.clientX,t.clientY=e.clientY,t.deltaX=e.movementX,t.deltaY=e.movementY,this._state=0,(e.buttons&mn.LEFT)===mn.LEFT&&(this._state=this._state|this.mouseButtons.left),(e.buttons&mn.MIDDLE)===mn.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(e.buttons&mn.RIGHT)===mn.RIGHT&&(this._state=this._state|this.mouseButtons.right),m())},h=e=>{let t=e.pointerId,r=this._findPointerById(t);if(r&&this._activePointers.splice(this._activePointers.indexOf(r),1),"touch"===e.pointerType)switch(this._activePointers.length){case 0:this._state=kt.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=kt.NONE;g()},c=()=>{let e=this._findPointerById(0);e&&this._activePointers.splice(this._activePointers.indexOf(e),1),this._state=kt.NONE,g()},u=-1,d=e=>{if(!this._enabled||this.mouseButtons.wheel===kt.NONE)return;if(this.dollyToCursor||this.mouseButtons.wheel===kt.ROTATE||this.mouseButtons.wheel===kt.TRUCK){let e=performance.now();u-e<1e3&&this._getClientRect(this._elementRect),u=e}let t=jxt?-1:-3,r=1===e.deltaMode?e.deltaY/t:e.deltaY/(10*t),i=this.dollyToCursor?(e.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,n=this.dollyToCursor?(e.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case kt.ROTATE:this._rotateInternal(e.deltaX,e.deltaY),this._isUserControllingRotate=!0;break;case kt.TRUCK:this._truckInternal(e.deltaX,e.deltaY,!1),this._isUserControllingTruck=!0;break;case kt.OFFSET:this._truckInternal(e.deltaX,e.deltaY,!0),this._isUserControllingOffset=!0;break;case kt.DOLLY:this._dollyInternal(-r,i,n),this._isUserControllingDolly=!0;break;case kt.ZOOM:this._zoomInternal(-r,i,n),this._isUserControllingZoom=!0}this.dispatchEvent({type:"control"})},p=e=>{if(this._domElement&&this._enabled&&this.mouseButtons.right===Bh.ACTION.NONE){let t=e instanceof PointerEvent?e.pointerId:(MouseEvent,0),r=this._findPointerById(t);return r&&this._activePointers.splice(this._activePointers.indexOf(r),1),this._domElement.removeEventListener("pointermove",o),this._domElement.removeEventListener("pointerup",h),this._domElement.removeEventListener("mousemove",l),void this._domElement.removeEventListener("mouseup",c)}},f=e=>{if(this._enabled){if(l3(this._activePointers,tl),this._getClientRect(this._elementRect),r.copy(tl),i.copy(tl),this._activePointers.length>=2){let e=tl.x-this._activePointers[1].clientX,t=tl.y-this._activePointers[1].clientY,r=Math.sqrt(e*e+t*t);n.set(0,r);let a=.5*(this._activePointers[0].clientX+this._activePointers[1].clientX),s=.5*(this._activePointers[0].clientY+this._activePointers[1].clientY);i.set(a,s)}if("pointerType"in e&&"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=0,(e.buttons&mn.LEFT)===mn.LEFT&&(this._state=this._state|this.mouseButtons.left),(e.buttons&mn.MIDDLE)===mn.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(e.buttons&mn.RIGHT)===mn.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&kt.ROTATE)===kt.ROTATE||(this._state&kt.TOUCH_ROTATE)===kt.TOUCH_ROTATE||(this._state&kt.TOUCH_DOLLY_ROTATE)===kt.TOUCH_DOLLY_ROTATE||(this._state&kt.TOUCH_ZOOM_ROTATE)===kt.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&kt.TRUCK)===kt.TRUCK||(this._state&kt.TOUCH_TRUCK)===kt.TOUCH_TRUCK||(this._state&kt.TOUCH_DOLLY_TRUCK)===kt.TOUCH_DOLLY_TRUCK||(this._state&kt.TOUCH_ZOOM_TRUCK)===kt.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&kt.DOLLY)===kt.DOLLY||(this._state&kt.TOUCH_DOLLY)===kt.TOUCH_DOLLY||(this._state&kt.TOUCH_DOLLY_TRUCK)===kt.TOUCH_DOLLY_TRUCK||(this._state&kt.TOUCH_DOLLY_OFFSET)===kt.TOUCH_DOLLY_OFFSET||(this._state&kt.TOUCH_DOLLY_ROTATE)===kt.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&kt.ZOOM)===kt.ZOOM||(this._state&kt.TOUCH_ZOOM)===kt.TOUCH_ZOOM||(this._state&kt.TOUCH_ZOOM_TRUCK)===kt.TOUCH_ZOOM_TRUCK||(this._state&kt.TOUCH_ZOOM_OFFSET)===kt.TOUCH_ZOOM_OFFSET||(this._state&kt.TOUCH_ZOOM_ROTATE)===kt.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&kt.OFFSET)===kt.OFFSET||(this._state&kt.TOUCH_OFFSET)===kt.TOUCH_OFFSET||(this._state&kt.TOUCH_DOLLY_OFFSET)===kt.TOUCH_DOLLY_OFFSET||(this._state&kt.TOUCH_ZOOM_OFFSET)===kt.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},m=()=>{if(!this._enabled)return;l3(this._activePointers,tl);let e=!!Pn.isBrowser&&(this._domElement&&document.pointerLockElement===this._domElement),t=e?-this._activePointers[0].deltaX:i.x-tl.x,a=e?-this._activePointers[0].deltaY:i.y-tl.y;if(i.copy(tl),((this._state&kt.ROTATE)===kt.ROTATE||(this._state&kt.TOUCH_ROTATE)===kt.TOUCH_ROTATE||(this._state&kt.TOUCH_DOLLY_ROTATE)===kt.TOUCH_DOLLY_ROTATE||(this._state&kt.TOUCH_ZOOM_ROTATE)===kt.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(t,a),this._isUserControllingRotate=!0),(this._state&kt.DOLLY)===kt.DOLLY||(this._state&kt.ZOOM)===kt.ZOOM){let e=this.dollyToCursor?(r.x-this._elementRect.x)/this._elementRect.width*2-1:0,t=this.dollyToCursor?(r.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&kt.DOLLY)===kt.DOLLY?(this._dollyInternal(a*h3,e,t),this._isUserControllingDolly=!0):(this._zoomInternal(a*h3,e,t),this._isUserControllingZoom=!0)}if((this._state&kt.TOUCH_DOLLY)===kt.TOUCH_DOLLY||(this._state&kt.TOUCH_ZOOM)===kt.TOUCH_ZOOM||(this._state&kt.TOUCH_DOLLY_TRUCK)===kt.TOUCH_DOLLY_TRUCK||(this._state&kt.TOUCH_ZOOM_TRUCK)===kt.TOUCH_ZOOM_TRUCK||(this._state&kt.TOUCH_DOLLY_OFFSET)===kt.TOUCH_DOLLY_OFFSET||(this._state&kt.TOUCH_ZOOM_OFFSET)===kt.TOUCH_ZOOM_OFFSET||(this._state&kt.TOUCH_DOLLY_ROTATE)===kt.TOUCH_DOLLY_ROTATE||(this._state&kt.TOUCH_ZOOM_ROTATE)===kt.TOUCH_ZOOM_ROTATE){let e=tl.x-this._activePointers[1].clientX,t=tl.y-this._activePointers[1].clientY,r=Math.sqrt(e*e+t*t),a=n.y-r;n.set(0,r);let s=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,o=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&kt.TOUCH_DOLLY)===kt.TOUCH_DOLLY||(this._state&kt.TOUCH_DOLLY_ROTATE)===kt.TOUCH_DOLLY_ROTATE||(this._state&kt.TOUCH_DOLLY_TRUCK)===kt.TOUCH_DOLLY_TRUCK||(this._state&kt.TOUCH_DOLLY_OFFSET)===kt.TOUCH_DOLLY_OFFSET?(this._dollyInternal(a*h3,s,o),this._isUserControllingDolly=!0):(this._zoomInternal(a*h3,s,o),this._isUserControllingZoom=!0)}((this._state&kt.TRUCK)===kt.TRUCK||(this._state&kt.TOUCH_TRUCK)===kt.TOUCH_TRUCK||(this._state&kt.TOUCH_DOLLY_TRUCK)===kt.TOUCH_DOLLY_TRUCK||(this._state&kt.TOUCH_ZOOM_TRUCK)===kt.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(t,a,!1),this._isUserControllingTruck=!0),((this._state&kt.OFFSET)===kt.OFFSET||(this._state&kt.TOUCH_OFFSET)===kt.TOUCH_OFFSET||(this._state&kt.TOUCH_DOLLY_OFFSET)===kt.TOUCH_DOLLY_OFFSET||(this._state&kt.TOUCH_ZOOM_OFFSET)===kt.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(t,a,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},g=()=>{l3(this._activePointers,tl),i.copy(tl),0===this._activePointers.length&&this._domElement&&(this._domElement.removeEventListener("pointermove",o),this._domElement.removeEventListener("mousemove",l),this._domElement.removeEventListener("pointerup",h),this._domElement.removeEventListener("mouseup",c),this.dispatchEvent({type:"controlend"}))};this._addAllEventListeners=e=>{this._domElement=e,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",a),Wxt&&this._domElement.addEventListener("mousedown",s),this._domElement.addEventListener("pointercancel",h),this._domElement.addEventListener("wheel",d),this._domElement.addEventListener("contextmenu",p)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",a),this._domElement.removeEventListener("mousedown",s),this._domElement.removeEventListener("pointercancel",h),this._domElement.removeEventListener("wheel",d),this._domElement.removeEventListener("contextmenu",p),this._domElement.removeEventListener("pointermove",o),this._domElement.removeEventListener("mousemove",l),this._domElement.removeEventListener("pointerup",h),this._domElement.removeEventListener("mouseup",c))},this.cancel=()=>{this._state!==kt.NONE&&(this._state=kt.NONE,this._activePointers.length=0,g())},t&&this.connect(t),this.update(0)}static install(e){gn=e.THREE,Z1e=Object.freeze(new gn.Vector3(0,0,0)),d3=Object.freeze(new gn.Vector3(0,1,0)),L8=Object.freeze(new gn.Vector3(0,0,1)),tl=new gn.Vector2,En=new gn.Vector3,ji=new gn.Vector3,U1=new gn.Vector3,kh=new gn.Vector3,Fh=new gn.Vector3,u0=new gn.Vector3,K1e=new gn.Vector3,J1e=new gn.Vector3,wu=new gn.Spherical,ET=new gn.Spherical,H1=new gn.Box3,Q1e=new gn.Box3,k8=new gn.Sphere,ebe=new gn.Quaternion,F8=new gn.Quaternion,B8=new gn.Matrix4,f3=new gn.Raycaster}static get ACTION(){return kt}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,r=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,r)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,r=!1){this._isUserControllingRotate=!1;let i=c0(e,this.minAzimuthAngle,this.maxAzimuthAngle),n=c0(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=n,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,r||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);let a=!r||us(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&us(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(a)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){this._isUserControllingDolly=!1;let r=this._sphericalEnd.radius,i=c0(e,this.minDistance,this.maxDistance);if(this.colliderMeshes.length>=1){let e=this._collisionTest(),t=us(e,this._spherical.radius);if(!(r>i)&&t)return Promise.resolve();this._sphericalEnd.radius=Math.min(i,e)}else this._sphericalEnd.radius=i;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);let n=!t||us(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(n)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=c0(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);let r=!t||us(this._zoom,this._zoomEnd,this.restThreshold);return this._createOnRestPromise(r)}truck(e,t,r=!1){this._camera.updateMatrix(),kh.setFromMatrixColumn(this._camera.matrix,0),Fh.setFromMatrixColumn(this._camera.matrix,1),kh.multiplyScalar(e),Fh.multiplyScalar(-t);let i=En.copy(kh).add(Fh),n=ji.copy(this._targetEnd).add(i);return this.moveTo(n.x,n.y,n.z,r)}forward(e,t=!1){En.setFromMatrixColumn(this._camera.matrix,0),En.crossVectors(this._camera.up,En),En.multiplyScalar(e);let r=ji.copy(this._targetEnd).add(En);return this.moveTo(r.x,r.y,r.z,t)}elevate(e,t=!1){return En.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+En.x,this._targetEnd.y+En.y,this._targetEnd.z+En.z,t)}moveTo(e,t,r,i=!1){this._isUserControllingTruck=!1;let n=En.set(e,t,r).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,n,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);let a=!i||us(this._target.x,this._targetEnd.x,this.restThreshold)&&us(this._target.y,this._targetEnd.y,this.restThreshold)&&us(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(a)}lookInDirectionOf(e,t,r,i=!1){let n=En.set(e,t,r).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(n.x,n.y,n.z,i)}fitToBox(e,t,{cover:r=!1,paddingLeft:i=0,paddingRight:n=0,paddingBottom:a=0,paddingTop:s=0}={}){let o=[],l=e.isBox3?H1.copy(e):H1.setFromObject(e);l.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());let h=O8(this._sphericalEnd.theta,I8),c=O8(this._sphericalEnd.phi,I8);o.push(this.rotateTo(h,c,t));let u=En.setFromSpherical(this._sphericalEnd).normalize(),d=ebe.setFromUnitVectors(u,L8),p=us(Math.abs(u.y),1);p&&d.multiply(F8.setFromAxisAngle(d3,h)),d.multiply(this._yAxisUpSpaceInverse);let f=Q1e.makeEmpty();ji.copy(l.min).applyQuaternion(d),f.expandByPoint(ji),ji.copy(l.min).setX(l.max.x).applyQuaternion(d),f.expandByPoint(ji),ji.copy(l.min).setY(l.max.y).applyQuaternion(d),f.expandByPoint(ji),ji.copy(l.max).setZ(l.min.z).applyQuaternion(d),f.expandByPoint(ji),ji.copy(l.min).setZ(l.max.z).applyQuaternion(d),f.expandByPoint(ji),ji.copy(l.max).setY(l.min.y).applyQuaternion(d),f.expandByPoint(ji),ji.copy(l.max).setX(l.min.x).applyQuaternion(d),f.expandByPoint(ji),ji.copy(l.max).applyQuaternion(d),f.expandByPoint(ji),f.min.x-=i,f.min.y-=a,f.max.x+=n,f.max.y+=s,d.setFromUnitVectors(L8,u),p&&d.premultiply(F8.invert()),d.premultiply(this._yAxisUpSpace);let m=f.getSize(En),g=f.getCenter(ji).applyQuaternion(d);if(el(this._camera)){let e=this.getDistanceToFitBox(m.x,m.y,m.z,r);o.push(this.moveTo(g.x,g.y,g.z,t)),o.push(this.dollyTo(e,t)),o.push(this.setFocalOffset(0,0,0,t))}else if(la(this._camera)){let e=this._camera,i=e.right-e.left,n=e.top-e.bottom,a=r?Math.max(i/m.x,n/m.y):Math.min(i/m.x,n/m.y);o.push(this.moveTo(g.x,g.y,g.z,t)),o.push(this.zoomTo(a,t)),o.push(this.setFocalOffset(0,0,0,t))}return Promise.all(o)}fitToSphere(e,t){let r=[],i=e instanceof gn.Sphere?k8.copy(e):Bh.createBoundingSphere(e,k8);if(r.push(this.moveTo(i.center.x,i.center.y,i.center.z,t)),el(this._camera)){let e=this.getDistanceToFitSphere(i.radius);r.push(this.dollyTo(e,t))}else if(la(this._camera)){let e=this._camera.right-this._camera.left,n=this._camera.top-this._camera.bottom,a=2*i.radius,s=Math.min(e/a,n/a);r.push(this.zoomTo(s,t))}return r.push(this.setFocalOffset(0,0,0,t)),Promise.all(r)}setLookAt(e,t,r,i,n,a,s=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1;let o=ji.set(i,n,a),l=En.set(e,t,r);this._targetEnd.copy(o),this._sphericalEnd.setFromVector3(l.sub(o).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,s||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let h=!s||us(this._target.x,this._targetEnd.x,this.restThreshold)&&us(this._target.y,this._targetEnd.y,this.restThreshold)&&us(this._target.z,this._targetEnd.z,this.restThreshold)&&us(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&us(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&us(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(h)}lerpLookAt(e,t,r,i,n,a,s,o,l,h,c,u,d,p=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1;let f=En.set(i,n,a),m=ji.set(e,t,r);wu.setFromVector3(m.sub(f).applyQuaternion(this._yAxisUpSpace));let g=U1.set(h,c,u),v=ji.set(s,o,l);ET.setFromVector3(v.sub(g).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(f.lerp(g,d));let y=ET.theta-wu.theta,b=ET.phi-wu.phi,x=ET.radius-wu.radius;this._sphericalEnd.set(wu.radius+x*d,wu.phi+b*d,wu.theta+y*d),this.normalizeRotations(),this._needsUpdate=!0,p||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let _=!p||us(this._target.x,this._targetEnd.x,this.restThreshold)&&us(this._target.y,this._targetEnd.y,this.restThreshold)&&us(this._target.z,this._targetEnd.z,this.restThreshold)&&us(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&us(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&us(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(_)}setPosition(e,t,r,i=!1){return this.setLookAt(e,t,r,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,r,i=!1){let n=this.getPosition(En),a=this.setLookAt(n.x,n.y,n.z,e,t,r,i);return this._sphericalEnd.phi=c0(this.polarAngle,this.minPolarAngle,this.maxPolarAngle),a}setFocalOffset(e,t,r,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,r),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);let n=!i||us(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&us(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&us(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}setOrbitPoint(e,t,r){this._camera.updateMatrixWorld(),kh.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Fh.setFromMatrixColumn(this._camera.matrixWorldInverse,1),u0.setFromMatrixColumn(this._camera.matrixWorldInverse,2);let i=En.set(e,t,r),n=i.distanceTo(this._camera.position),a=i.sub(this._camera.position);kh.multiplyScalar(a.x),Fh.multiplyScalar(a.y),u0.multiplyScalar(a.z),En.copy(kh).add(Fh).add(u0),En.z=En.z+n,this.dollyTo(n,!1),this.setFocalOffset(-En.x,En.y,-En.z,!1),this.moveTo(e,t,r,!1)}setBoundary(e){if(!e)return this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),void(this._needsUpdate=!0);this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,r,i){null!==e?(this._viewport=this._viewport||new gn.Vector4,"number"==typeof e?this._viewport.set(e,t,r,i):this._viewport.copy(e)):this._viewport=null}getDistanceToFitBox(e,t,r,i=!1){if(c3(this._camera,"getDistanceToFitBox"))return this._spherical.radius;let n=e/t,a=this._camera.getEffectiveFOV()*F1,s=this._camera.aspect;return.5*((i?n>s:n<s)?t:e/s)/Math.tan(.5*a)+.5*r}getDistanceToFitSphere(e){if(c3(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;let t=this._camera.getEffectiveFOV()*F1,r=2*Math.atan(Math.tan(.5*t)*this._camera.aspect),i=1<this._camera.aspect?t:r;return e/Math.sin(.5*i)}getTarget(e){return(e&&e.isVector3?e:new gn.Vector3).copy(this._targetEnd)}getPosition(e){return(e&&e.isVector3?e:new gn.Vector3).setFromSpherical(this._sphericalEnd).applyQuaternion(this._yAxisUpSpaceInverse).add(this._targetEnd)}getFocalOffset(e){return(e&&e.isVector3?e:new gn.Vector3).copy(this._focalOffsetEnd)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%l0,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=l0),this._spherical.theta+=l0*Math.round((this._sphericalEnd.theta-this._spherical.theta)/l0)}reset(e=!1){let t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,d3),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert}update(e){let t=this._sphericalEnd.theta-this._spherical.theta,r=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,n=K1e.subVectors(this._targetEnd,this._target),a=J1e.subVectors(this._focalOffsetEnd,this._focalOffset),s=this._zoomEnd-this._zoom;if(cs(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{let t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=xT(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,t,1/0,e),this._needsUpdate=!0}if(cs(r))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{let t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=xT(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,t,1/0,e),this._needsUpdate=!0}if(cs(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{let t=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=xT(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,t,this.maxSpeed,e),this._needsUpdate=!0}if(cs(n.x)&&cs(n.y)&&cs(n.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{let t=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;D8(this._target,this._targetEnd,this._targetVelocity,t,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(cs(a.x)&&cs(a.y)&&cs(a.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{let t=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;D8(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,t,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(0!==this._dollyControlAmount){if(el(this._camera)){let e=this._camera,t=En.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).normalize().negate(),r=ji.copy(t).cross(e.up).normalize();0===r.lengthSq()&&(r.x=1);let i=U1.crossVectors(r,t),n=this._sphericalEnd.radius*Math.tan(e.getEffectiveFOV()*F1*.5),a=(this._sphericalEnd.radius-this._dollyControlAmount-this._sphericalEnd.radius)/this._sphericalEnd.radius,s=En.copy(this._targetEnd).add(r.multiplyScalar(this._dollyControlCoord.x*n*e.aspect)).add(i.multiplyScalar(this._dollyControlCoord.y*n));this._targetEnd.lerp(s,a)}else if(la(this._camera)){let e=this._camera,t=En.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(e.near+e.far)/(e.near-e.far)).unproject(e),r=ji.set(0,0,-1).applyQuaternion(e.quaternion),i=U1.copy(t).add(r.multiplyScalar(-t.dot(e.up))),n=-(this._zoom-this._dollyControlAmount-this._zoomEnd)/this._zoom,a=En.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).normalize().negate(),s=this._targetEnd.dot(a);this._targetEnd.lerp(i,n);let o=this._targetEnd.dot(a),l=a.multiplyScalar(o-s);this._targetEnd.sub(l)}this._target.copy(this._targetEnd),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._dollyControlAmount=0}if(cs(s))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{let t=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=xT(this._zoom,this._zoomEnd,this._zoomVelocity,t,1/0,e)}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0);let o=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,o),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!cs(this._focalOffset.x)||!cs(this._focalOffset.y)||!cs(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),kh.setFromMatrixColumn(this._camera.matrix,0),Fh.setFromMatrixColumn(this._camera.matrix,1),u0.setFromMatrixColumn(this._camera.matrix,2),kh.multiplyScalar(this._focalOffset.x),Fh.multiplyScalar(-this._focalOffset.y),u0.multiplyScalar(this._focalOffset.z),En.copy(kh).add(Fh).add(u0),this._camera.position.add(En)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),En.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);let l=this._needsUpdate;return l&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):l?(this.dispatchEvent({type:"update"}),cs(t,this.restThreshold)&&cs(r,this.restThreshold)&&cs(i,this.restThreshold)&&cs(n.x,this.restThreshold)&&cs(n.y,this.restThreshold)&&cs(n.z,this.restThreshold)&&cs(a.x,this.restThreshold)&&cs(a.y,this.restThreshold)&&cs(a.z,this.restThreshold)&&cs(s,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!l&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._updatedLastTime=l,this._needsUpdate=!1,l}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:B1(this.maxDistance),minZoom:this.minZoom,maxZoom:B1(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:B1(this.maxPolarAngle),minAzimuthAngle:B1(this.minAzimuthAngle),maxAzimuthAngle:B1(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:En.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){let r=JSON.parse(e),i=En.fromArray(r.position);this.enabled=r.enabled,this.minDistance=r.minDistance,this.maxDistance=N1(r.maxDistance),this.minZoom=r.minZoom,this.maxZoom=N1(r.maxZoom),this.minPolarAngle=r.minPolarAngle,this.maxPolarAngle=N1(r.maxPolarAngle),this.minAzimuthAngle=N1(r.minAzimuthAngle),this.maxAzimuthAngle=N1(r.maxAzimuthAngle),this.smoothTime=r.smoothTime,this.draggingSmoothTime=r.draggingSmoothTime,this.dollySpeed=r.dollySpeed,this.truckSpeed=r.truckSpeed,this.dollyToCursor=r.dollyToCursor,this.verticalDragToForward=r.verticalDragToForward,this._target0.fromArray(r.target0),this._position0.fromArray(r.position0),this._zoom0=r.zoom0,this._focalOffset0.fromArray(r.focalOffset0),this.moveTo(r.target[0],r.target[1],r.target[2],t),wu.setFromVector3(i.sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(wu.theta,wu.phi,t),this.zoomTo(r.zoom,t),this.setFocalOffset(r.focalOffset[0],r.focalOffset[1],r.focalOffset[2],t),this._needsUpdate=!0}connect(e){this._domElement?console.warn("camera-controls is already connected."):this._addAllEventListeners(e)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_findPointerById(e){return this._activePointers.find((t=>t.pointerId===e))}_findPointerByMouseButton(e){return this._activePointers.find((t=>t.mouseButton===e))}_encloseToBoundary(e,t,r){let i=t.lengthSq();if(0===i)return e;let n=ji.copy(t).add(e),a=this._boundary.clampPoint(n,U1).sub(n),s=a.lengthSq();if(0===s)return e.add(t);if(s===i)return e;if(0===r)return e.add(t).add(a);{let i=1+r*s/t.dot(a);return e.add(ji.copy(t).multiplyScalar(i)).add(a.multiplyScalar(1-r))}}_updateNearPlaneCorners(){if(el(this._camera)){let e=this._camera,t=e.near,r=e.getEffectiveFOV()*F1,i=Math.tan(.5*r)*t,n=i*e.aspect;this._nearPlaneCorners[0].set(-n,-i,0),this._nearPlaneCorners[1].set(n,-i,0),this._nearPlaneCorners[2].set(n,i,0),this._nearPlaneCorners[3].set(-n,i,0)}else if(la(this._camera)){let e=this._camera,t=1/e.zoom,r=e.left*t,i=e.right*t,n=e.top*t,a=e.bottom*t;this._nearPlaneCorners[0].set(r,n,0),this._nearPlaneCorners[1].set(i,n,0),this._nearPlaneCorners[2].set(i,a,0),this._nearPlaneCorners[3].set(r,a,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||c3(this._camera,"_collisionTest"))return e;let t=En.setFromSpherical(this._spherical).divideScalar(this._spherical.radius);B8.lookAt(Z1e,t,this._camera.up);for(let r=0;r<4;r++){let i=ji.copy(this._nearPlaneCorners[r]);i.applyMatrix4(B8);let n=U1.addVectors(this._target,i);f3.set(n,t),f3.far=this._spherical.radius+1;let a=f3.intersectObjects(this.colliderMeshes);0!==a.length&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;let t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise((e=>{let t=()=>{this.removeEventListener("rest",t),e()};this.addEventListener("rest",t)})))}_addAllEventListeners(e){}_removeAllEventListeners(){}static createBoundingSphere(e,t=new gn.Sphere){let r=t,i=r.center;H1.makeEmpty(),e.traverseVisible((e=>{e.isMesh&&H1.expandByObject(e)})),H1.getCenter(i);let n=0;return e.traverseVisible((e=>{if(!e.isMesh)return;let t=e,r=t.geometry.clone();if(r.applyMatrix4(t.matrixWorld),r.isBufferGeometry){let e=r.attributes.position;for(let t=0,r=e.count;t<r;t++)En.fromBufferAttribute(e,t),n=Math.max(n,i.distanceToSquared(En))}else{let e=r.attributes.position;for(let t=0,r=e.count;t<r;t++)En.fromBufferAttribute(e,t),n=Math.max(n,i.distanceToSquared(En))}})),r.radius=Math.sqrt(n),r}},Ei=Bh,h0=(e=>(e[e.Orbit=0]="Orbit",e[e.FirstPerson=1]="FirstPerson",e[e.Plan=2]="Plan",e))(h0||{}),p3=class{constructor(e){this.mode=0,this.cameraManager=e}setupControl(){let e=this.cameraManager.camera,t=this.cameraManager.cameraControls;t.mouseButtons={left:Ei.ACTION.ROTATE,middle:Ei.ACTION.DOLLY,right:Ei.ACTION.TRUCK,wheel:el(e)?Ei.ACTION.DOLLY:la(e)?Ei.ACTION.ZOOM:Ei.ACTION.NONE},t.touches={one:Ei.ACTION.TOUCH_ROTATE,two:el(e)?Ei.ACTION.TOUCH_DOLLY_TRUCK:la(e)?Ei.ACTION.TOUCH_ZOOM_TRUCK:Ei.ACTION.NONE,three:Ei.ACTION.TOUCH_TRUCK},t.dollyToCursor=!0,t.azimuthRotateSpeed=1,t.polarRotateSpeed=1,t.minDistance=1,t.maxDistance=300,t.minZoom=3,this.cameraManager.cameraControls.truckSpeed=2}adjustCameraByBBox(e){let t=this.cameraManager.cameraControls,r=new F;e.getSize(r);let i=r.length();t.minDistance=1,t.maxDistance=10*i,t.minZoom=3}},m3=class{constructor(e){this.mode=2,this.cameraManager=e}setupControl(){let e=this.cameraManager.camera,t=this.cameraManager.cameraControls;t.mouseButtons={left:Ei.ACTION.TRUCK,middle:Ei.ACTION.TRUCK,right:Ei.ACTION.TRUCK,wheel:el(e)?Ei.ACTION.DOLLY:la(e)?Ei.ACTION.ZOOM:Ei.ACTION.NONE},t.touches={one:Ei.ACTION.TOUCH_TRUCK,two:el(e)?Ei.ACTION.TOUCH_DOLLY_TRUCK:la(e)?Ei.ACTION.TOUCH_ZOOM_TRUCK:Ei.ACTION.NONE,three:Ei.ACTION.NONE},t.dollyToCursor=!0,t.azimuthRotateSpeed=0,t.polarRotateSpeed=0,t.truckSpeed=1,t.maxZoom=1/0,t.minZoom=-1/0}adjustCameraByBBox(e){}},Up=50,N8=new F,g3=class{constructor(e){this.previousDistance=-1,this.previousAzimuthRotateSpeed=1,this.previousPolarRotateSpeed=1,this.previousDollySpeed=1,this.previousTruckSpeed=2,this.previousMouseLeft=Ei.ACTION.NONE,this.enableKeyDown=!0,this.projection="Perspective",this.onKeyDown=e=>{if(!this.enableKeyDown)return;let t=this.cameraControls,r=10*this.viewer.getPixelSizeInWorldCoord(),i="Viewer3d"===this.viewer.name||"BimTilesViewer"===this.viewer.name;switch(e.code){case"ArrowLeft":i?t.rotate(.1,0,!0):"Viewer2d"===this.viewer.name&&t.truck(r,0,!0);break;case"ArrowRight":i?t.rotate(-.1,0,!0):"Viewer2d"===this.viewer.name&&t.truck(-r,0,!0);break;case"ArrowUp":i?t.rotate(0,.1,!0):"Viewer2d"===this.viewer.name&&t.truck(0,r,!0);break;case"ArrowDown":i?t.rotate(0,-.1,!0):"Viewer2d"===this.viewer.name&&t.truck(0,-r,!0);break;case"KeyW":i&&(la(this.activeCamera)?t.zoom(.01,!0):t.dolly(1,!0));break;case"KeyA":i&&t.truck(-r,0,!0);break;case"KeyS":i&&(la(this.activeCamera)?t.zoom(-.01,!0):t.dolly(-1,!0));break;case"KeyD":i&&t.truck(r,0,!0);break;case"KeyQ":i&&t.truck(0,-r,!0);break;case"KeyE":i&&t.truck(0,r,!0)}},this.onChange=()=>{this.viewer.enableRender()},this.viewer=e;let t=e.viewerContainer,r=t.clientWidth/t.clientHeight;this.perspectiveCamera=new ci(lye,r,SP,MP),this.orthographicCamera=new Gi(Up*r/-2,Up*r/2,Up/2,Up/-2,SP,MP),this.activeCamera=this.perspectiveCamera,this.setupCameras(),Ei.install({THREE:Kt}),this.cameraControls=new Ei(this.perspectiveCamera,e.getInputManager()),this.controlsMap={0:new p3(this),2:new m3(this)},this.activeControls=this.controlsMap[0],this.setupControls(),this.setProjection("Perspective"),this.anchor=this.createAnchor()}get viewerContainer(){return this.viewer.viewerContainer}get inputManager(){return this.viewer.getInputManager()}createAnchor(){var e;let t=document.createElement("div");return t.className="anchor",null==(e=this.viewerContainer)||e.appendChild(t),this.cameraControls.addEventListener("control",(()=>{if(this.isOrbitPointVisible()){let e=this.getTarget(),t=Nr.world2Screen(e,this.activeCamera,this.viewerContainer);this.setAnchorPosition(t.x,t.y)}})),t}setAnchorPosition(e,t){this.anchor.style.left=`${e}px`,this.anchor.style.top=`${t}px`}setOrbitPointVisible(e){e?this.anchor.classList.add("active"):this.anchor.classList.remove("active")}isOrbitPointVisible(){return this.anchor.classList.contains("active")}setOrthoCameraAspect(e,t){let r=e/t;this.orthographicCamera.left=-Up*r/2,this.orthographicCamera.right=Up*r/2,this.orthographicCamera.top=Up/2,this.orthographicCamera.bottom=-Up/2,this.orthographicCamera.updateProjectionMatrix()}setupCameras(){this.setCameraPositionAndTarget(this.perspectiveCamera)}setCameraPositionAndTarget(e){e.position.z=10,e.position.y=10,e.position.x=10,e.lookAt(new F(0,0,0))}setupControls(){let e=this.cameraControls;e.smoothTime=.1,e.draggingSmoothTime=0,e.infinityDolly=!0,e.setTarget(0,0,0),e.addEventListener("controlend",(()=>this.onChange)),e.addEventListener("update",(()=>this.viewer.dispatchEvent("controlchange"))),e.addEventListener("rest",(()=>this.onChange)),this.inputManager.addEventListener("keydown",this.onKeyDown)}setOrthoCamera(){if(1===this.activeControls.mode)return;this.previousDistance=this.cameraControls.distance,this.cameraControls.distance=200;let{width:e,height:t}=this.getDims();this.setupOrthoCamera(t,e),this.activeCamera=this.orthographicCamera,this.projection="Orthographic"}getDims(){let e=new F;this.perspectiveCamera.getWorldDirection(e);let t=new F;this.cameraControls.getTarget(t);let r=t.clone().sub(this.perspectiveCamera.position).dot(e),{clientWidth:i,clientHeight:n}=this.viewer.viewerContainer,a=i/n,s=this.perspectiveCamera.fov,o=2*r*Math.atan(s*(Math.PI/180)/2);return{width:o*a,height:o}}setupOrthoCamera(e,t){this.cameraControls.mouseButtons.wheel=Ei.ACTION.ZOOM;let r=this.perspectiveCamera,i=this.orthographicCamera;i.zoom=1,i.left=t/-2,i.right=t/2,i.top=e/2,i.bottom=e/-2,i.updateProjectionMatrix(),i.position.copy(r.position),i.quaternion.copy(r.quaternion),this.cameraControls.camera=i}setPerspectiveCamera(){let e=this.cameraControls;e.mouseButtons.wheel=Ei.ACTION.DOLLY;let t=this.perspectiveCamera,r=this.orthographicCamera;t.position.copy(r.position),t.quaternion.copy(r.quaternion),t.updateProjectionMatrix(),e.camera=t,e.mouseButtons.wheel=Ei.ACTION.DOLLY,this.activeCamera=t,this.projection="Perspective",e.distance=this.previousDistance,e.zoomTo(1)}update(e){return this.cameraControls.update(e)}updateAspect(){let{clientWidth:e,clientHeight:t}=this.viewer.viewerContainer;this.perspectiveCamera.aspect=e/t,this.perspectiveCamera.updateProjectionMatrix(),this.setOrthoCameraAspect(e,t)}get camera(){return this.activeCamera}enableKeyControl(e){this.enableKeyDown=e}getTarget(){return this.cameraControls.getTarget(N8)}getPosition(){return this.cameraControls.getPosition(N8)}adjustCameraByBBox(e){let t=this.camera.near,r=this.camera.far,i=new F;e.getSize(i);let n=i.length(),a=n/5,s=5*n;if(t>a||r<s){let e=e=>Ut.numberToString(e);de.info(`[Viewer] BBox's longest side is: ${e(n)}`),t>a&&(de.warn(`[Viewer] camera.near(${e(t)}) shouldn't bigger than ${e(a)}, will change it!`),this.camera.near=a),r<s&&(de.warn(`[Viewer] camera.far(${e(r)}) shouldn't smaller than ${e(s)}, will change it!`),this.camera.far=s)}this.activeControls.adjustCameraByBBox(e),this.cameraControls.update(0)}enableControl(e){this.cameraControls.enabled=e}get enableRotate(){let e=this.cameraControls;return!!e.azimuthRotateSpeed||!!e.polarRotateSpeed}set enableRotate(e){let t=this.cameraControls;e?(t.azimuthRotateSpeed=this.previousAzimuthRotateSpeed,t.polarRotateSpeed=this.previousPolarRotateSpeed):(this.previousAzimuthRotateSpeed=t.azimuthRotateSpeed,this.previousPolarRotateSpeed=t.polarRotateSpeed,t.azimuthRotateSpeed=0,t.polarRotateSpeed=0)}enableZoom(e){let t=this.cameraControls;e?t.dollySpeed=this.previousDollySpeed:(this.previousDollySpeed=t.dollySpeed,t.dollySpeed=0)}enablePan(e){let t=this.cameraControls;e?t.truckSpeed=this.previousTruckSpeed:(this.previousTruckSpeed=t.dollySpeed,t.truckSpeed=0)}enableMouseLeft(e){let t=this.cameraControls;e?t.mouseButtons.left=this.previousMouseLeft:(this.previousMouseLeft=t.mouseButtons.left,t.mouseButtons.left=Ei.ACTION.NONE)}setCameraPosition(e){this.cameraControls.setPosition(e.x,e.y,e.z)}setCameraTarget(e){this.cameraControls.setTarget(e.x,e.y,e.z)}flyTo(e,t){let r=this.cameraControls;r.setLookAt(e.x,e.y,e.z,t.x,t.y,t.z,!0),r.setFocalOffset(0,0,0,!0)}flyToPosition(e,t,r){this.cameraControls.moveTo(e,t,r,!0)}flyToBox(e){let t=new Sn;e.getBoundingSphere(t),this.cameraControls.fitToSphere(t,!0)}fitToSphere(e){this.cameraControls.fitToSphere(e,!0)}flyToObject(e){let t=(new Vt).setFromObject(e),r=new Sn;t.getBoundingSphere(r),this.cameraControls.fitToSphere(r,!0)}flyToViewpoint(e){this.flyTo(e.eye,e.look),null!=e.zoom&&(this.orthographicCamera.zoom=e.zoom)}getDistanceToFitSphere(e){return this.cameraControls.getDistanceToFitSphere(e)}setNavigationMode(e){this.activeControls.mode!==e&&(this.activeControls=this.controlsMap[e],this.activeControls.setupControl())}getProjection(){return this.projection}setProjection(e){this.projection!==e&&(this.projection=e,"Orthographic"===e?this.setOrthoCamera():this.setPerspectiveCamera())}setOrbitPoint(e){this.cameraControls.setOrbitPoint(e.x,e.y,e.z)}getCameraDirection(){return this.activeCamera.getWorldDirection(N8)}getCameraConfig(){return{eye:this.activeCamera.position,look:this.getTarget(),up:this.activeCamera.up,near:this.activeCamera.near,far:this.activeCamera.far,zoom:this.activeCamera.zoom}}getCurrentViewpoint(){return{eye:this.activeCamera.position,look:this.getTarget(),up:this.activeCamera.up,zoom:this.activeCamera.zoom}}setCameraConfig(e){let t=this.cameraControls,{near:r=SP,far:i=MP,up:n=new F(0,1,0),zoom:a=1,eye:s,look:o}=e;this.activeCamera.near=r,this.activeCamera.far=i,this.activeCamera.up.set(n.x,n.y,n.z),this.activeCamera.updateProjectionMatrix(),t.updateCameraUp(),t.zoomTo(a),t.setLookAt(s.x,s.y,s.z,o.x,o.y,o.z,!0),t.setFocalOffset(0,0,0,!0)}destroy(){this.anchor.remove(),this.inputManager.removeEventListener("keydown",this.onKeyDown),this.perspectiveCamera.removeFromParent(),this.orthographicCamera.removeFromParent()}},v3=class extends va{constructor(e,t={}){let r=t.font;if(void 0===r)super();else{let i=r.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(i,t)}this.type="TextGeometry"}};String.prototype.codePointAt||function(){var e=function(){try{var e={},t=Object.defineProperty,r=t(e,e,e)&&t}catch(e){}return r}(),t=function(e){if(null==this)throw TypeError();var t=String(this),r=t.length,i=e?Number(e):0;if(i!=i&&(i=0),!(i<0||i>=r)){var n,a=t.charCodeAt(i);return a>=55296&&a<=56319&&r>i+1&&((n=t.charCodeAt(i+1))>=56320&&n<=57343)?1024*(a-55296)+n-56320+65536:a}};e?e(String.prototype,"codePointAt",{value:t,configurable:!0,writable:!0}):String.prototype.codePointAt=t}();var nz=0,Hbe=-3;function wT(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function Xxt(e,t){this.source=e,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=t,this.destLen=0,this.ltree=new wT,this.dtree=new wT}var Vbe=new wT,zbe=new wT,iz=new Uint8Array(30),sz=new Uint16Array(30),Gbe=new Uint8Array(30),qbe=new Uint16Array(30),Yxt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),tbe=new wT,Nh=new Uint8Array(320);function jbe(e,t,r,i){var n,a;for(n=0;n<r;++n)e[n]=0;for(n=0;n<30-r;++n)e[n+r]=n/r|0;for(a=i,n=0;n<30;++n)t[n]=a,a+=1<<e[n]}function $xt(e,t){var r;for(r=0;r<7;++r)e.table[r]=0;for(e.table[7]=24,e.table[8]=152,e.table[9]=112,r=0;r<24;++r)e.trans[r]=256+r;for(r=0;r<144;++r)e.trans[24+r]=r;for(r=0;r<8;++r)e.trans[168+r]=280+r;for(r=0;r<112;++r)e.trans[176+r]=144+r;for(r=0;r<5;++r)t.table[r]=0;for(t.table[5]=32,r=0;r<32;++r)t.trans[r]=r}var rbe=new Uint16Array(16);function U8(e,t,r,i){var n,a;for(n=0;n<16;++n)e.table[n]=0;for(n=0;n<i;++n)e.table[t[r+n]]++;for(e.table[0]=0,a=0,n=0;n<16;++n)rbe[n]=a,a+=e.table[n];for(n=0;n<i;++n)t[r+n]&&(e.trans[rbe[t[r+n]]++]=n)}function Zxt(e){e.bitcount--||(e.tag=e.source[e.sourceIndex++],e.bitcount=7);var t=1&e.tag;return e.tag>>>=1,t}function Uh(e,t,r){if(!t)return r;for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var i=e.tag&65535>>>16-t;return e.tag>>>=t,e.bitcount-=t,i+r}function Y8(e,t){for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var r=0,i=0,n=0,a=e.tag;do{i=2*i+(1&a),a>>>=1,++n,r+=t.table[n],i-=t.table[n]}while(i>=0);return e.tag=a,e.bitcount-=n,t.trans[r+i]}function Kxt(e,t,r){var i,n,a,s,o,l;for(i=Uh(e,5,257),n=Uh(e,5,1),a=Uh(e,4,4),s=0;s<19;++s)Nh[s]=0;for(s=0;s<a;++s){var h=Uh(e,3,0);Nh[Yxt[s]]=h}for(U8(tbe,Nh,0,19),o=0;o<i+n;){var c=Y8(e,tbe);switch(c){case 16:var u=Nh[o-1];for(l=Uh(e,2,3);l;--l)Nh[o++]=u;break;case 17:for(l=Uh(e,3,3);l;--l)Nh[o++]=0;break;case 18:for(l=Uh(e,7,11);l;--l)Nh[o++]=0;break;default:Nh[o++]=c}}U8(t,Nh,0,i),U8(r,Nh,i,n)}function nbe(e,t,r){for(;;){var i,n,a,s,o=Y8(e,t);if(256===o)return nz;if(o<256)e.dest[e.destLen++]=o;else for(i=Uh(e,iz[o-=257],sz[o]),n=Y8(e,r),s=a=e.destLen-Uh(e,Gbe[n],qbe[n]);s<a+i;++s)e.dest[e.destLen++]=e.dest[s]}}function Jxt(e){for(var t,r;e.bitcount>8;)e.sourceIndex--,e.bitcount-=8;if((t=256*(t=e.source[e.sourceIndex+1])+e.source[e.sourceIndex])!==(65535&~(256*e.source[e.sourceIndex+3]+e.source[e.sourceIndex+2])))return Hbe;for(e.sourceIndex+=4,r=t;r;--r)e.dest[e.destLen++]=e.source[e.sourceIndex++];return e.bitcount=0,nz}function Qxt(e,t){var r,i,n=new Xxt(e,t);do{switch(r=Zxt(n),Uh(n,2,0)){case 0:i=Jxt(n);break;case 1:i=nbe(n,Vbe,zbe);break;case 2:Kxt(n,n.ltree,n.dtree),i=nbe(n,n.ltree,n.dtree);break;default:i=Hbe}if(i!==nz)throw new Error("Data error")}while(!r);return n.destLen<n.dest.length?"function"==typeof n.dest.slice?n.dest.slice(0,n.destLen):n.dest.subarray(0,n.destLen):n.dest}$xt(Vbe,zbe),jbe(iz,sz,4,3),jbe(Gbe,qbe,2,1),iz[28]=0,sz[28]=258;var eEt=Qxt;function V1(e,t,r,i,n){return Math.pow(1-n,3)*e+3*Math.pow(1-n,2)*n*t+3*(1-n)*Math.pow(n,2)*r+Math.pow(n,3)*i}function Wp(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}function ca(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}function Wbe(e){throw new Error(e)}function ibe(e,t){e||Wbe(t)}Wp.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},Wp.prototype.addPoint=function(e,t){"number"==typeof e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),"number"==typeof t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))},Wp.prototype.addX=function(e){this.addPoint(e,null)},Wp.prototype.addY=function(e){this.addPoint(null,e)},Wp.prototype.addBezier=function(e,t,r,i,n,a,s,o){var l=[e,t],h=[r,i],c=[n,a],u=[s,o];this.addPoint(e,t),this.addPoint(s,o);for(var d=0;d<=1;d++){var p=6*l[d]-12*h[d]+6*c[d],f=-3*l[d]+9*h[d]-9*c[d]+3*u[d],m=3*h[d]-3*l[d];if(0!==f){var g=Math.pow(p,2)-4*m*f;if(!(g<0)){var v=(-p+Math.sqrt(g))/(2*f);0<v&&v<1&&(0===d&&this.addX(V1(l[d],h[d],c[d],u[d],v)),1===d&&this.addY(V1(l[d],h[d],c[d],u[d],v)));var y=(-p-Math.sqrt(g))/(2*f);0<y&&y<1&&(0===d&&this.addX(V1(l[d],h[d],c[d],u[d],y)),1===d&&this.addY(V1(l[d],h[d],c[d],u[d],y)))}}else{if(0===p)continue;var b=-m/p;0<b&&b<1&&(0===d&&this.addX(V1(l[d],h[d],c[d],u[d],b)),1===d&&this.addY(V1(l[d],h[d],c[d],u[d],b)))}}},Wp.prototype.addQuad=function(e,t,r,i,n,a){var s=e+.6666666666666666*(r-e),o=t+2/3*(i-t),l=s+1/3*(n-e),h=o+1/3*(a-t);this.addBezier(e,t,s,o,l,h,n,a)},ca.prototype.moveTo=function(e,t){this.commands.push({type:"M",x:e,y:t})},ca.prototype.lineTo=function(e,t){this.commands.push({type:"L",x:e,y:t})},ca.prototype.curveTo=ca.prototype.bezierCurveTo=function(e,t,r,i,n,a){this.commands.push({type:"C",x1:e,y1:t,x2:r,y2:i,x:n,y:a})},ca.prototype.quadTo=ca.prototype.quadraticCurveTo=function(e,t,r,i){this.commands.push({type:"Q",x1:e,y1:t,x:r,y:i})},ca.prototype.close=ca.prototype.closePath=function(){this.commands.push({type:"Z"})},ca.prototype.extend=function(e){if(e.commands)e=e.commands;else if(e instanceof Wp){var t=e;return this.moveTo(t.x1,t.y1),this.lineTo(t.x2,t.y1),this.lineTo(t.x2,t.y2),this.lineTo(t.x1,t.y2),void this.close()}Array.prototype.push.apply(this.commands,e)},ca.prototype.getBoundingBox=function(){for(var e=new Wp,t=0,r=0,i=0,n=0,a=0;a<this.commands.length;a++){var s=this.commands[a];switch(s.type){case"M":e.addPoint(s.x,s.y),t=i=s.x,r=n=s.y;break;case"L":e.addPoint(s.x,s.y),i=s.x,n=s.y;break;case"Q":e.addQuad(i,n,s.x1,s.y1,s.x,s.y),i=s.x,n=s.y;break;case"C":e.addBezier(i,n,s.x1,s.y1,s.x2,s.y2,s.x,s.y),i=s.x,n=s.y;break;case"Z":i=t,n=r;break;default:throw new Error("Unexpected path command "+s.type)}}return e.isEmpty()&&e.addPoint(0,0),e},ca.prototype.draw=function(e){e.beginPath();for(var t=0;t<this.commands.length;t+=1){var r=this.commands[t];"M"===r.type?e.moveTo(r.x,r.y):"L"===r.type?e.lineTo(r.x,r.y):"C"===r.type?e.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):"Q"===r.type?e.quadraticCurveTo(r.x1,r.y1,r.x,r.y):"Z"===r.type&&e.closePath()}this.fill&&(e.fillStyle=this.fill,e.fill()),this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.strokeWidth,e.stroke())},ca.prototype.toPathData=function(e){function t(t){return Math.round(t)===t?""+Math.round(t):t.toFixed(e)}function r(){for(var e=arguments,r="",i=0;i<arguments.length;i+=1){var n=e[i];n>=0&&i>0&&(r+=" "),r+=t(n)}return r}e=void 0!==e?e:2;for(var i="",n=0;n<this.commands.length;n+=1){var a=this.commands[n];"M"===a.type?i+="M"+r(a.x,a.y):"L"===a.type?i+="L"+r(a.x,a.y):"C"===a.type?i+="C"+r(a.x1,a.y1,a.x2,a.y2,a.x,a.y):"Q"===a.type?i+="Q"+r(a.x1,a.y1,a.x,a.y):"Z"===a.type&&(i+="Z")}return i},ca.prototype.toSVG=function(e){var t='<path d="';return t+=this.toPathData(e),t+='"',this.fill&&"black"!==this.fill&&(null===this.fill?t+=' fill="none"':t+=' fill="'+this.fill+'"'),this.stroke&&(t+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),t+="/>"},ca.prototype.toDOMElement=function(e){var t=this.toPathData(e),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",t),r};var cn={fail:Wbe,argument:ibe,assert:ibe},sbe=32768,abe=2147483648,G1={},mr={},fn={};function Ru(e){return function(){return e}}mr.BYTE=function(e){return cn.argument(e>=0&&e<=255,"Byte value should be between 0 and 255."),[e]},fn.BYTE=Ru(1),mr.CHAR=function(e){return[e.charCodeAt(0)]},fn.CHAR=Ru(1),mr.CHARARRAY=function(e){void 0===e&&(e="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var t=[],r=0;r<e.length;r+=1)t[r]=e.charCodeAt(r);return t},fn.CHARARRAY=function(e){return void 0===e?0:e.length},mr.USHORT=function(e){return[e>>8&255,255&e]},fn.USHORT=Ru(2),mr.SHORT=function(e){return e>=sbe&&(e=-(2*sbe-e)),[e>>8&255,255&e]},fn.SHORT=Ru(2),mr.UINT24=function(e){return[e>>16&255,e>>8&255,255&e]},fn.UINT24=Ru(3),mr.ULONG=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]},fn.ULONG=Ru(4),mr.LONG=function(e){return e>=abe&&(e=-(2*abe-e)),[e>>24&255,e>>16&255,e>>8&255,255&e]},fn.LONG=Ru(4),mr.FIXED=mr.ULONG,fn.FIXED=fn.ULONG,mr.FWORD=mr.SHORT,fn.FWORD=fn.SHORT,mr.UFWORD=mr.USHORT,fn.UFWORD=fn.USHORT,mr.LONGDATETIME=function(e){return[0,0,0,0,e>>24&255,e>>16&255,e>>8&255,255&e]},fn.LONGDATETIME=Ru(8),mr.TAG=function(e){return cn.argument(4===e.length,"Tag should be exactly 4 ASCII characters."),[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]},fn.TAG=Ru(4),mr.Card8=mr.BYTE,fn.Card8=fn.BYTE,mr.Card16=mr.USHORT,fn.Card16=fn.USHORT,mr.OffSize=mr.BYTE,fn.OffSize=fn.BYTE,mr.SID=mr.USHORT,fn.SID=fn.USHORT,mr.NUMBER=function(e){return e>=-107&&e<=107?[e+139]:e>=108&&e<=1131?[247+((e-=108)>>8),255&e]:e>=-1131&&e<=-108?[251+((e=-e-108)>>8),255&e]:e>=-32768&&e<=32767?mr.NUMBER16(e):mr.NUMBER32(e)},fn.NUMBER=function(e){return mr.NUMBER(e).length},mr.NUMBER16=function(e){return[28,e>>8&255,255&e]},fn.NUMBER16=Ru(3),mr.NUMBER32=function(e){return[29,e>>24&255,e>>16&255,e>>8&255,255&e]},fn.NUMBER32=Ru(5),mr.REAL=function(e){var t=e.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(t);if(r){var i=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));t=(Math.round(e*i)/i).toString()}for(var n="",a=0,s=t.length;a<s;a+=1){var o=t[a];n+="e"===o?"-"===t[++a]?"c":"b":"."===o?"a":"-"===o?"e":o}for(var l=[30],h=0,c=(n+=1&n.length?"f":"ff").length;h<c;h+=2)l.push(parseInt(n.substr(h,2),16));return l},fn.REAL=function(e){return mr.REAL(e).length},mr.NAME=mr.CHARARRAY,fn.NAME=fn.CHARARRAY,mr.STRING=mr.CHARARRAY,fn.STRING=fn.CHARARRAY,G1.UTF8=function(e,t,r){for(var i=[],n=r,a=0;a<n;a++,t+=1)i[a]=e.getUint8(t);return String.fromCharCode.apply(null,i)},G1.UTF16=function(e,t,r){for(var i=[],n=r/2,a=0;a<n;a++,t+=2)i[a]=e.getUint16(t);return String.fromCharCode.apply(null,i)},mr.UTF16=function(e){for(var t=[],r=0;r<e.length;r+=1){var i=e.charCodeAt(r);t[t.length]=i>>8&255,t[t.length]=255&i}return t},fn.UTF16=function(e){return 2*e.length};var $8={"x-mac-croatian":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®Š™´¨≠ŽØ∞±≤≥∆µ∂∑∏š∫ªºΩžø¿¡¬√ƒ≈Ć«Č… ÀÃÕŒœĐ—“”‘’÷◊©⁄€‹›Æ»–·‚„‰ÂćÁčÈÍÎÏÌÓÔđÒÚÛÙıˆ˜¯πË˚¸Êæˇ","x-mac-cyrillic":"АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ†°Ґ£§•¶І®©™Ђђ≠Ѓѓ∞±≤≥іµґЈЄєЇїЉљЊњјЅ¬√ƒ≈∆«»… ЋћЌќѕ–—“”‘’÷„ЎўЏџ№Ёёяабвгдежзийклмнопрстуфхцчшщъыьэю","x-mac-gaelic":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØḂ±≤≥ḃĊċḊḋḞḟĠġṀæøṁṖṗɼƒſṠ«»… ÀÃÕŒœ–—“”‘’ṡẛÿŸṪ€‹›Ŷŷṫ·Ỳỳ⁊ÂÊÁËÈÍÎÏÌÓÔ♣ÒÚÛÙıÝýŴŵẄẅẀẁẂẃ","x-mac-greek":"Ä¹²É³ÖÜ΅àâä΄¨çéèêë£™îï•½‰ôö¦€ùûü†ΓΔΘΛΞΠß®©ΣΪ§≠°·Α±≤≥¥ΒΕΖΗΙΚΜΦΫΨΩάΝ¬ΟΡ≈Τ«»… ΥΧΆΈœ–―“”‘’÷ΉΊΌΎέήίόΏύαβψδεφγηιξκλμνοπώρστθωςχυζϊϋΐΰ­","x-mac-icelandic":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûüÝ°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€ÐðÞþý·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-inuit":"ᐃᐄᐅᐆᐊᐋᐱᐲᐳᐴᐸᐹᑉᑎᑏᑐᑑᑕᑖᑦᑭᑮᑯᑰᑲᑳᒃᒋᒌᒍᒎᒐᒑ°ᒡᒥᒦ•¶ᒧ®©™ᒨᒪᒫᒻᓂᓃᓄᓅᓇᓈᓐᓯᓰᓱᓲᓴᓵᔅᓕᓖᓗᓘᓚᓛᓪᔨᔩᔪᔫᔭ… ᔮᔾᕕᕖᕗ–—“”‘’ᕘᕙᕚᕝᕆᕇᕈᕉᕋᕌᕐᕿᖀᖁᖂᖃᖄᖅᖏᖐᖑᖒᖓᖔᖕᙱᙲᙳᙴᙵᙶᖖᖠᖡᖢᖣᖤᖥᖦᕼŁł","x-mac-ce":"ÄĀāÉĄÖÜáąČäčĆćéŹźĎíďĒēĖóėôöõúĚěü†°Ę£§•¶ß®©™ę¨≠ģĮįĪ≤≥īĶ∂∑łĻļĽľĹĺŅņŃ¬√ńŇ∆«»… ňŐÕőŌ–—“”‘’÷◊ōŔŕŘ‹›řŖŗŠ‚„šŚśÁŤťÍŽžŪÓÔūŮÚůŰűŲųÝýķŻŁżĢˇ",macintosh:"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›ﬁﬂ‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-romanian":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ĂȘ∞±≤≥¥µ∂∑∏π∫ªºΩăș¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›Țț‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-turkish":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸĞğİıŞş‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙˆ˜¯˘˙˚¸˝˛ˇ"};G1.MACSTRING=function(e,t,r,i){var n=$8[i];if(void 0!==n){for(var a="",s=0;s<r;s++){var o=e.getUint8(t+s);a+=o<=127?String.fromCharCode(o):n[127&o]}return a}};var b3="function"==typeof WeakMap&&new WeakMap,x3,tEt=function(e){if(!x3)for(var t in x3={},$8)x3[t]=new String(t);var r=x3[e];if(void 0!==r){if(b3){var i=b3.get(r);if(void 0!==i)return i}var n=$8[e];if(void 0!==n){for(var a={},s=0;s<n.length;s++)a[n.charCodeAt(s)]=s+128;return b3&&b3.set(r,a),a}}};function Z8(e){return e>=-128&&e<=127}function rEt(e,t,r){for(var i=0,n=e.length;t<n&&i<64&&0===e[t];)++t,++i;return r.push(128|i-1),t}function nEt(e,t,r){for(var i=0,n=e.length,a=t;a<n&&i<64;){var s=e[a];if(!Z8(s)||0===s&&a+1<n&&0===e[a+1])break;++a,++i}r.push(i-1);for(var o=t;o<a;++o)r.push(e[o]+256&255);return a}function iEt(e,t,r){for(var i=0,n=e.length,a=t;a<n&&i<64;){var s=e[a];if(0===s||Z8(s)&&a+1<n&&Z8(e[a+1]))break;++a,++i}r.push(64|i-1);for(var o=t;o<a;++o){var l=e[o];r.push(l+65536>>8&255,l+256&255)}return a}mr.MACSTRING=function(e,t){var r=tEt(t);if(void 0!==r){for(var i=[],n=0;n<e.length;n++){var a=e.charCodeAt(n);if(a>=128&&void 0===(a=r[a]))return;i[n]=a}return i}},fn.MACSTRING=function(e,t){var r=mr.MACSTRING(e,t);return void 0!==r?r.length:0},mr.VARDELTAS=function(e){for(var t=0,r=[];t<e.length;){var i=e[t];t=0===i?rEt(e,t,r):i>=-128&&i<=127?nEt(e,t,r):iEt(e,t,r)}return r},mr.INDEX=function(e){for(var t=1,r=[t],i=[],n=0;n<e.length;n+=1){var a=mr.OBJECT(e[n]);Array.prototype.push.apply(i,a),t+=a.length,r.push(t)}if(0===i.length)return[0,0];for(var s=[],o=1+Math.floor(Math.log(t)/Math.log(2))/8|0,l=[void 0,mr.BYTE,mr.USHORT,mr.UINT24,mr.ULONG][o],h=0;h<r.length;h+=1){var c=l(r[h]);Array.prototype.push.apply(s,c)}return Array.prototype.concat(mr.Card16(e.length),mr.OffSize(o),s,i)},fn.INDEX=function(e){return mr.INDEX(e).length},mr.DICT=function(e){for(var t=[],r=Object.keys(e),i=r.length,n=0;n<i;n+=1){var a=parseInt(r[n],0),s=e[a];t=(t=t.concat(mr.OPERAND(s.value,s.type))).concat(mr.OPERATOR(a))}return t},fn.DICT=function(e){return mr.DICT(e).length},mr.OPERATOR=function(e){return e<1200?[e]:[12,e-1200]},mr.OPERAND=function(e,t){var r=[];if(Array.isArray(t))for(var i=0;i<t.length;i+=1)cn.argument(e.length===t.length,"Not enough arguments given for type"+t),r=r.concat(mr.OPERAND(e[i],t[i]));else if("SID"===t)r=r.concat(mr.NUMBER(e));else if("offset"===t)r=r.concat(mr.NUMBER32(e));else if("number"===t)r=r.concat(mr.NUMBER(e));else{if("real"!==t)throw new Error("Unknown operand type "+t);r=r.concat(mr.REAL(e))}return r},mr.OP=mr.BYTE,fn.OP=fn.BYTE;var E3="function"==typeof WeakMap&&new WeakMap;function xa(e,t,r){if(t.length&&("coverageFormat"!==t[0].name||1===t[0].value))for(var i=0;i<t.length;i+=1){var n=t[i];this[n.name]=n.value}if(this.tableName=e,this.fields=t,r)for(var a=Object.keys(r),s=0;s<a.length;s+=1){var o=a[s],l=r[o];void 0!==this[o]&&(this[o]=l)}}function ST(e,t,r){void 0===r&&(r=t.length);var i=new Array(t.length+1);i[0]={name:e+"Count",type:"USHORT",value:r};for(var n=0;n<t.length;n++)i[n+1]={name:e+n,type:"USHORT",value:t[n]};return i}function K8(e,t,r){var i=t.length,n=new Array(i+1);n[0]={name:e+"Count",type:"USHORT",value:i};for(var a=0;a<i;a++)n[a+1]={name:e+a,type:"TABLE",value:r(t[a],a)};return n}function MT(e,t,r){var i=t.length,n=[];n[0]={name:e+"Count",type:"USHORT",value:i};for(var a=0;a<i;a++)n=n.concat(r(t[a],a));return n}function M3(e){1===e.format?xa.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(ST("glyph",e.glyphs))):2===e.format?xa.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(MT("rangeRecord",e.ranges,(function(e){return[{name:"startGlyphID",type:"USHORT",value:e.start},{name:"endGlyphID",type:"USHORT",value:e.end},{name:"startCoverageIndex",type:"USHORT",value:e.index}]})))):cn.assert(!1,"Coverage format must be 1 or 2.")}function A3(e){xa.call(this,"scriptListTable",MT("scriptRecord",e,(function(e,t){var r=e.script,i=r.defaultLangSys;return cn.assert(!!i,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+t,type:"TAG",value:e.tag},{name:"script"+t,type:"TABLE",value:new xa("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new xa("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:i.reqFeatureIndex}].concat(ST("featureIndex",i.featureIndexes)))}].concat(MT("langSys",r.langSysRecords,(function(e,t){var r=e.langSys;return[{name:"langSysTag"+t,type:"TAG",value:e.tag},{name:"langSys"+t,type:"TABLE",value:new xa("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:r.reqFeatureIndex}].concat(ST("featureIndex",r.featureIndexes)))}]}))))}]})))}function R3(e){xa.call(this,"featureListTable",MT("featureRecord",e,(function(e,t){var r=e.feature;return[{name:"featureTag"+t,type:"TAG",value:e.tag},{name:"feature"+t,type:"TABLE",value:new xa("featureTable",[{name:"featureParams",type:"USHORT",value:r.featureParams}].concat(ST("lookupListIndex",r.lookupListIndexes)))}]})))}function C3(e,t){xa.call(this,"lookupListTable",K8("lookup",e,(function(e){var r=t[e.lookupType];return cn.assert(!!r,"Unable to write GSUB lookup type "+e.lookupType+" tables."),new xa("lookupTable",[{name:"lookupType",type:"USHORT",value:e.lookupType},{name:"lookupFlag",type:"USHORT",value:e.lookupFlag}].concat(K8("subtable",e.subtables,r)))})))}mr.CHARSTRING=function(e){if(E3){var t=E3.get(e);if(void 0!==t)return t}for(var r=[],i=e.length,n=0;n<i;n+=1){var a=e[n];r=r.concat(mr[a.type](a.value))}return E3&&E3.set(e,r),r},fn.CHARSTRING=function(e){return mr.CHARSTRING(e).length},mr.OBJECT=function(e){var t=mr[e.type];return cn.argument(void 0!==t,"No encoding function for type "+e.type),t(e.value)},fn.OBJECT=function(e){var t=fn[e.type];return cn.argument(void 0!==t,"No sizeOf function for type "+e.type),t(e.value)},mr.TABLE=function(e){for(var t=[],r=e.fields.length,i=[],n=[],a=0;a<r;a+=1){var s=e.fields[a],o=mr[s.type];cn.argument(void 0!==o,"No encoding function for field type "+s.type+" ("+s.name+")");var l=e[s.name];void 0===l&&(l=s.value);var h=o(l);"TABLE"===s.type?(n.push(t.length),t=t.concat([0,0]),i.push(h)):t=t.concat(h)}for(var c=0;c<i.length;c+=1){var u=n[c],d=t.length;cn.argument(d<65536,"Table "+e.tableName+" too big."),t[u]=d>>8,t[u+1]=255&d,t=t.concat(i[c])}return t},fn.TABLE=function(e){for(var t=0,r=e.fields.length,i=0;i<r;i+=1){var n=e.fields[i],a=fn[n.type];cn.argument(void 0!==a,"No sizeOf function for field type "+n.type+" ("+n.name+")");var s=e[n.name];void 0===s&&(s=n.value),t+=a(s),"TABLE"===n.type&&(t+=2)}return t},mr.RECORD=mr.TABLE,fn.RECORD=fn.TABLE,mr.LITERAL=function(e){return e},fn.LITERAL=function(e){return e.length},xa.prototype.encode=function(){return mr.TABLE(this)},xa.prototype.sizeOf=function(){return fn.TABLE(this)},M3.prototype=Object.create(xa.prototype),M3.prototype.constructor=M3,A3.prototype=Object.create(xa.prototype),A3.prototype.constructor=A3,R3.prototype=Object.create(xa.prototype),R3.prototype.constructor=R3,C3.prototype=Object.create(xa.prototype),C3.prototype.constructor=C3;var wr={Table:xa,Record:xa,Coverage:M3,ScriptList:A3,FeatureList:R3,LookupList:C3,ushortList:ST,tableList:K8,recordList:MT};function obe(e,t){return e.getUint8(t)}function P3(e,t){return e.getUint16(t,!1)}function sEt(e,t){return e.getInt16(t,!1)}function az(e,t){return e.getUint32(t,!1)}function Xbe(e,t){return e.getInt16(t,!1)+e.getUint16(t+2,!1)/65535}function aEt(e,t){for(var r="",i=t;i<t+4;i+=1)r+=String.fromCharCode(e.getInt8(i));return r}function oEt(e,t,r){for(var i=0,n=0;n<r;n+=1)i<<=8,i+=e.getUint8(t+n);return i}function lEt(e,t,r){for(var i=[],n=t;n<r;n+=1)i.push(e.getUint8(n));return i}function cEt(e){for(var t="",r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return t}var uEt={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function It(e,t){this.data=e,this.offset=t,this.relativeOffset=0}It.prototype.parseByte=function(){var e=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},It.prototype.parseChar=function(){var e=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},It.prototype.parseCard8=It.prototype.parseByte,It.prototype.parseUShort=function(){var e=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},It.prototype.parseCard16=It.prototype.parseUShort,It.prototype.parseSID=It.prototype.parseUShort,It.prototype.parseOffset16=It.prototype.parseUShort,It.prototype.parseShort=function(){var e=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},It.prototype.parseF2Dot14=function(){var e=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,e},It.prototype.parseULong=function(){var e=az(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},It.prototype.parseOffset32=It.prototype.parseULong,It.prototype.parseFixed=function(){var e=Xbe(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},It.prototype.parseString=function(e){var t=this.data,r=this.offset+this.relativeOffset,i="";this.relativeOffset+=e;for(var n=0;n<e;n++)i+=String.fromCharCode(t.getUint8(r+n));return i},It.prototype.parseTag=function(){return this.parseString(4)},It.prototype.parseLongDateTime=function(){var e=az(this.data,this.offset+this.relativeOffset+4);return e-=2082844800,this.relativeOffset+=8,e},It.prototype.parseVersion=function(e){var t=P3(this.data,this.offset+this.relativeOffset),r=P3(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,void 0===e&&(e=4096),t+r/e/10},It.prototype.skip=function(e,t){void 0===t&&(t=1),this.relativeOffset+=uEt[e]*t},It.prototype.parseULongList=function(e){void 0===e&&(e=this.parseULong());for(var t=new Array(e),r=this.data,i=this.offset+this.relativeOffset,n=0;n<e;n++)t[n]=r.getUint32(i),i+=4;return this.relativeOffset+=4*e,t},It.prototype.parseOffset16List=It.prototype.parseUShortList=function(e){void 0===e&&(e=this.parseUShort());for(var t=new Array(e),r=this.data,i=this.offset+this.relativeOffset,n=0;n<e;n++)t[n]=r.getUint16(i),i+=2;return this.relativeOffset+=2*e,t},It.prototype.parseShortList=function(e){for(var t=new Array(e),r=this.data,i=this.offset+this.relativeOffset,n=0;n<e;n++)t[n]=r.getInt16(i),i+=2;return this.relativeOffset+=2*e,t},It.prototype.parseByteList=function(e){for(var t=new Array(e),r=this.data,i=this.offset+this.relativeOffset,n=0;n<e;n++)t[n]=r.getUint8(i++);return this.relativeOffset+=e,t},It.prototype.parseList=function(e,t){t||(t=e,e=this.parseUShort());for(var r=new Array(e),i=0;i<e;i++)r[i]=t.call(this);return r},It.prototype.parseList32=function(e,t){t||(t=e,e=this.parseULong());for(var r=new Array(e),i=0;i<e;i++)r[i]=t.call(this);return r},It.prototype.parseRecordList=function(e,t){t||(t=e,e=this.parseUShort());for(var r=new Array(e),i=Object.keys(t),n=0;n<e;n++){for(var a={},s=0;s<i.length;s++){var o=i[s],l=t[o];a[o]=l.call(this)}r[n]=a}return r},It.prototype.parseRecordList32=function(e,t){t||(t=e,e=this.parseULong());for(var r=new Array(e),i=Object.keys(t),n=0;n<e;n++){for(var a={},s=0;s<i.length;s++){var o=i[s],l=t[o];a[o]=l.call(this)}r[n]=a}return r},It.prototype.parseStruct=function(e){if("function"==typeof e)return e.call(this);for(var t=Object.keys(e),r={},i=0;i<t.length;i++){var n=t[i],a=e[n];r[n]=a.call(this)}return r},It.prototype.parseValueRecord=function(e){if(void 0===e&&(e=this.parseUShort()),0!==e){var t={};return 1&e&&(t.xPlacement=this.parseShort()),2&e&&(t.yPlacement=this.parseShort()),4&e&&(t.xAdvance=this.parseShort()),8&e&&(t.yAdvance=this.parseShort()),16&e&&(t.xPlaDevice=void 0,this.parseShort()),32&e&&(t.yPlaDevice=void 0,this.parseShort()),64&e&&(t.xAdvDevice=void 0,this.parseShort()),128&e&&(t.yAdvDevice=void 0,this.parseShort()),t}},It.prototype.parseValueRecordList=function(){for(var e=this.parseUShort(),t=this.parseUShort(),r=new Array(t),i=0;i<t;i++)r[i]=this.parseValueRecord(e);return r},It.prototype.parsePointer=function(e){var t=this.parseOffset16();if(t>0)return new It(this.data,this.offset+t).parseStruct(e)},It.prototype.parsePointer32=function(e){var t=this.parseOffset32();if(t>0)return new It(this.data,this.offset+t).parseStruct(e)},It.prototype.parseListOfLists=function(e){for(var t=this.parseOffset16List(),r=t.length,i=this.relativeOffset,n=new Array(r),a=0;a<r;a++){var s=t[a];if(0!==s)if(this.relativeOffset=s,e){for(var o=this.parseOffset16List(),l=new Array(o.length),h=0;h<o.length;h++)this.relativeOffset=s+o[h],l[h]=e.call(this);n[a]=l}else n[a]=this.parseUShortList();else n[a]=void 0}return this.relativeOffset=i,n},It.prototype.parseCoverage=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort(),r=this.parseUShort();if(1===t)return{format:1,glyphs:this.parseUShortList(r)};if(2===t){for(var i=new Array(r),n=0;n<r;n++)i[n]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:i}}throw new Error("0x"+e.toString(16)+": Coverage format must be 1 or 2.")},It.prototype.parseClassDef=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(1===t)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(2===t)return{format:2,ranges:this.parseRecordList({start:It.uShort,end:It.uShort,classId:It.uShort})};throw new Error("0x"+e.toString(16)+": ClassDef format must be 1 or 2.")},It.list=function(e,t){return function(){return this.parseList(e,t)}},It.list32=function(e,t){return function(){return this.parseList32(e,t)}},It.recordList=function(e,t){return function(){return this.parseRecordList(e,t)}},It.recordList32=function(e,t){return function(){return this.parseRecordList32(e,t)}},It.pointer=function(e){return function(){return this.parsePointer(e)}},It.pointer32=function(e){return function(){return this.parsePointer32(e)}},It.tag=It.prototype.parseTag,It.byte=It.prototype.parseByte,It.uShort=It.offset16=It.prototype.parseUShort,It.uShortList=It.prototype.parseUShortList,It.uLong=It.offset32=It.prototype.parseULong,It.uLongList=It.prototype.parseULongList,It.struct=It.prototype.parseStruct,It.coverage=It.prototype.parseCoverage,It.classDef=It.prototype.parseClassDef;var lbe={reserved:It.uShort,reqFeatureIndex:It.uShort,featureIndexes:It.uShortList};It.prototype.parseScriptList=function(){return this.parsePointer(It.recordList({tag:It.tag,script:It.pointer({defaultLangSys:It.pointer(lbe),langSysRecords:It.recordList({tag:It.tag,langSys:It.pointer(lbe)})})}))||[]},It.prototype.parseFeatureList=function(){return this.parsePointer(It.recordList({tag:It.tag,feature:It.pointer({featureParams:It.offset16,lookupListIndexes:It.uShortList})}))||[]},It.prototype.parseLookupList=function(e){return this.parsePointer(It.list(It.pointer((function(){var t=this.parseUShort();cn.argument(1<=t&&t<=9,"GPOS/GSUB lookup type "+t+" unknown.");var r=this.parseUShort(),i=16&r;return{lookupType:t,lookupFlag:r,subtables:this.parseList(It.pointer(e[t])),markFilteringSet:i?this.parseUShort():void 0}}))))||[]},It.prototype.parseFeatureVariationsList=function(){return this.parsePointer32((function(){var e=this.parseUShort(),t=this.parseUShort();return cn.argument(1===e&&t<1,"GPOS/GSUB feature variations table unknown."),this.parseRecordList32({conditionSetOffset:It.offset32,featureTableSubstitutionOffset:It.offset32})}))||[]};var Dr={getByte:obe,getCard8:obe,getUShort:P3,getCard16:P3,getShort:sEt,getULong:az,getFixed:Xbe,getTag:aEt,getOffset:oEt,getBytes:lEt,bytesToString:cEt,Parser:It};function hEt(e,t){var r;t.parseUShort(),e.length=t.parseULong(),e.language=t.parseULong(),e.groupCount=r=t.parseULong(),e.glyphIndexMap={};for(var i=0;i<r;i+=1)for(var n=t.parseULong(),a=t.parseULong(),s=t.parseULong(),o=n;o<=a;o+=1)e.glyphIndexMap[o]=s,s++}function dEt(e,t,r,i,n){var a;e.length=t.parseUShort(),e.language=t.parseUShort(),e.segCount=a=t.parseUShort()>>1,t.skip("uShort",3),e.glyphIndexMap={};for(var s=new Dr.Parser(r,i+n+14),o=new Dr.Parser(r,i+n+16+2*a),l=new Dr.Parser(r,i+n+16+4*a),h=new Dr.Parser(r,i+n+16+6*a),c=i+n+16+8*a,u=0;u<a-1;u+=1)for(var d=void 0,p=s.parseUShort(),f=o.parseUShort(),m=l.parseShort(),g=h.parseUShort(),v=f;v<=p;v+=1)0!==g?(c=h.offset+h.relativeOffset-2,c+=g,c+=2*(v-f),0!==(d=Dr.getUShort(r,c))&&(d=d+m&65535)):d=v+m&65535,e.glyphIndexMap[v]=d}function fEt(e,t){var r={};r.version=Dr.getUShort(e,t),cn.argument(0===r.version,"cmap table version should be 0."),r.numTables=Dr.getUShort(e,t+2);for(var i=-1,n=r.numTables-1;n>=0;n-=1){var a=Dr.getUShort(e,t+4+8*n),s=Dr.getUShort(e,t+4+8*n+2);if(3===a&&(0===s||1===s||10===s)||0===a&&(0===s||1===s||2===s||3===s||4===s)){i=Dr.getULong(e,t+4+8*n+4);break}}if(-1===i)throw new Error("No valid cmap sub-tables found.");var o=new Dr.Parser(e,t+i);if(r.format=o.parseUShort(),12===r.format)hEt(r,o);else{if(4!==r.format)throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");dEt(r,o,e,t,i)}return r}function pEt(e,t,r){e.segments.push({end:t,start:t,delta:-(t-r),offset:0,glyphIndex:r})}function mEt(e){e.segments.push({end:65535,start:65535,delta:1,offset:0})}function gEt(e){var t,r=!0;for(t=e.length-1;t>0;t-=1){if(e.get(t).unicode>65535){console.log("Adding CMAP format 12 (needed!)"),r=!1;break}}var i=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:r?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:r?12:20}];r||(i=i.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),i=i.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var n=new wr.Table("cmap",i);for(n.segments=[],t=0;t<e.length;t+=1){for(var a=e.get(t),s=0;s<a.unicodes.length;s+=1)pEt(n,a.unicodes[s],t);n.segments=n.segments.sort((function(e,t){return e.start-t.start}))}mEt(n);var o=n.segments.length,l=0,h=[],c=[],u=[],d=[],p=[],f=[];for(t=0;t<o;t+=1){var m=n.segments[t];m.end<=65535&&m.start<=65535?(h=h.concat({name:"end_"+t,type:"USHORT",value:m.end}),c=c.concat({name:"start_"+t,type:"USHORT",value:m.start}),u=u.concat({name:"idDelta_"+t,type:"SHORT",value:m.delta}),d=d.concat({name:"idRangeOffset_"+t,type:"USHORT",value:m.offset}),void 0!==m.glyphId&&(p=p.concat({name:"glyph_"+t,type:"USHORT",value:m.glyphId}))):l+=1,!r&&void 0!==m.glyphIndex&&(f=(f=(f=f.concat({name:"cmap12Start_"+t,type:"ULONG",value:m.start})).concat({name:"cmap12End_"+t,type:"ULONG",value:m.end})).concat({name:"cmap12Glyph_"+t,type:"ULONG",value:m.glyphIndex}))}if(n.segCountX2=2*(o-l),n.searchRange=2*Math.pow(2,Math.floor(Math.log(o-l)/Math.log(2))),n.entrySelector=Math.log(n.searchRange/2)/Math.log(2),n.rangeShift=n.segCountX2-n.searchRange,n.fields=n.fields.concat(h),n.fields.push({name:"reservedPad",type:"USHORT",value:0}),n.fields=n.fields.concat(c),n.fields=n.fields.concat(u),n.fields=n.fields.concat(d),n.fields=n.fields.concat(p),n.cmap4Length=14+2*h.length+2+2*c.length+2*u.length+2*d.length+2*p.length,!r){var g=16+4*f.length;n.cmap12Offset=20+n.cmap4Length,n.fields=n.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:g},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:f.length/3}]),n.fields=n.fields.concat(f)}return n}var Ybe={parse:fEt,make:gEt},w3=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],vEt=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],yEt=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],f0=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function $be(e){this.font=e}function Zbe(e){this.cmap=e}function I3(e,t){this.encoding=e,this.charset=t}function oz(e){switch(e.version){case 1:this.names=f0.slice();break;case 2:this.names=new Array(e.numberOfGlyphs);for(var t=0;t<e.numberOfGlyphs;t++)e.glyphNameIndex[t]<f0.length?this.names[t]=f0[e.glyphNameIndex[t]]:this.names[t]=e.names[e.glyphNameIndex[t]-f0.length];break;case 2.5:this.names=new Array(e.numberOfGlyphs);for(var r=0;r<e.numberOfGlyphs;r++)this.names[r]=f0[r+e.glyphNameIndex[r]];break;default:this.names=[]}}function bEt(e){for(var t,r=e.tables.cmap.glyphIndexMap,i=Object.keys(r),n=0;n<i.length;n+=1){var a=i[n],s=r[a];(t=e.glyphs.get(s)).addUnicode(parseInt(a))}for(var o=0;o<e.glyphs.length;o+=1)t=e.glyphs.get(o),e.cffEncoding?e.isCIDFont?t.name="gid"+o:t.name=e.cffEncoding.charset[o]:e.glyphNames.names&&(t.name=e.glyphNames.glyphIndexToName(o))}function xEt(e){e._IndexToUnicodeMap={};for(var t=e.tables.cmap.glyphIndexMap,r=Object.keys(t),i=0;i<r.length;i+=1){var n=r[i],a=t[n];void 0===e._IndexToUnicodeMap[a]?e._IndexToUnicodeMap[a]={unicodes:[parseInt(n)]}:e._IndexToUnicodeMap[a].unicodes.push(parseInt(n))}}function EEt(e,t){t.lowMemory?xEt(e):bEt(e)}function _Et(e,t,r,i,n){e.beginPath(),e.moveTo(t,r),e.lineTo(i,n),e.stroke()}$be.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),r=this.font.glyphs;if(r)for(var i=0;i<r.length;i+=1)for(var n=r.get(i),a=0;a<n.unicodes.length;a+=1)if(n.unicodes[a]===t)return i;return null},Zbe.prototype.charToGlyphIndex=function(e){return this.cmap.glyphIndexMap[e.codePointAt(0)]||0},I3.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),r=this.encoding[t];return this.charset.indexOf(r)},oz.prototype.nameToGlyphIndex=function(e){return this.names.indexOf(e)},oz.prototype.glyphIndexToName=function(e){return this.names[e]};var d0={line:_Et};function TEt(e,t){var r=t||new ca;return{configurable:!0,get:function(){return"function"==typeof r&&(r=r()),r},set:function(e){r=e}}}function Sc(e){this.bindConstructorValues(e)}function _3(e,t,r){Object.defineProperty(e,t,{get:function(){return e.path,e[r]},set:function(t){e[r]=t},enumerable:!0,configurable:!0})}function lz(e,t){if(this.font=e,this.glyphs={},Array.isArray(t))for(var r=0;r<t.length;r++){var i=t[r];i.path.unitsPerEm=e.unitsPerEm,this.glyphs[r]=i}this.length=t&&t.length||0}function wEt(e,t){return new Sc({index:t,font:e})}function SEt(e,t,r,i,n,a){return function(){var s=new Sc({index:t,font:e});return s.path=function(){r(s,i,n);var t=a(e.glyphs,s);return t.unitsPerEm=e.unitsPerEm,t},_3(s,"xMin","_xMin"),_3(s,"xMax","_xMax"),_3(s,"yMin","_yMin"),_3(s,"yMax","_yMax"),s}}function MEt(e,t,r,i){return function(){var n=new Sc({index:t,font:e});return n.path=function(){var t=r(e,n,i);return t.unitsPerEm=e.unitsPerEm,t},n}}Sc.prototype.bindConstructorValues=function(e){this.index=e.index||0,this.name=e.name||null,this.unicode=e.unicode||void 0,this.unicodes=e.unicodes||void 0!==e.unicode?[e.unicode]:[],"xMin"in e&&(this.xMin=e.xMin),"yMin"in e&&(this.yMin=e.yMin),"xMax"in e&&(this.xMax=e.xMax),"yMax"in e&&(this.yMax=e.yMax),"advanceWidth"in e&&(this.advanceWidth=e.advanceWidth),Object.defineProperty(this,"path",TEt(this,e.path))},Sc.prototype.addUnicode=function(e){0===this.unicodes.length&&(this.unicode=e),this.unicodes.push(e)},Sc.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},Sc.prototype.getPath=function(e,t,r,i,n){var a,s;e=void 0!==e?e:0,t=void 0!==t?t:0,r=void 0!==r?r:72,i||(i={});var o=i.xScale,l=i.yScale;if(i.hinting&&n&&n.hinting&&(s=this.path&&n.hinting.exec(this,r)),s)a=n.hinting.getCommands(s),e=Math.round(e),t=Math.round(t),o=l=1;else{a=this.path.commands;var h=1/(this.path.unitsPerEm||1e3)*r;void 0===o&&(o=h),void 0===l&&(l=h)}for(var c=new ca,u=0;u<a.length;u+=1){var d=a[u];"M"===d.type?c.moveTo(e+d.x*o,t+-d.y*l):"L"===d.type?c.lineTo(e+d.x*o,t+-d.y*l):"Q"===d.type?c.quadraticCurveTo(e+d.x1*o,t+-d.y1*l,e+d.x*o,t+-d.y*l):"C"===d.type?c.curveTo(e+d.x1*o,t+-d.y1*l,e+d.x2*o,t+-d.y2*l,e+d.x*o,t+-d.y*l):"Z"===d.type&&c.closePath()}return c},Sc.prototype.getContours=function(){if(void 0===this.points)return[];for(var e=[],t=[],r=0;r<this.points.length;r+=1){var i=this.points[r];t.push(i),i.lastPointOfContour&&(e.push(t),t=[])}return cn.argument(0===t.length,"There are still points left in the current contour."),e},Sc.prototype.getMetrics=function(){for(var e=this.path.commands,t=[],r=[],i=0;i<e.length;i+=1){var n=e[i];"Z"!==n.type&&(t.push(n.x),r.push(n.y)),("Q"===n.type||"C"===n.type)&&(t.push(n.x1),r.push(n.y1)),"C"===n.type&&(t.push(n.x2),r.push(n.y2))}var a={xMin:Math.min.apply(null,t),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,t),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(a.xMin)||(a.xMin=0),isFinite(a.xMax)||(a.xMax=this.advanceWidth),isFinite(a.yMin)||(a.yMin=0),isFinite(a.yMax)||(a.yMax=0),a.rightSideBearing=this.advanceWidth-a.leftSideBearing-(a.xMax-a.xMin),a},Sc.prototype.draw=function(e,t,r,i,n){this.getPath(t,r,i,n).draw(e)},Sc.prototype.drawPoints=function(e,t,r,i){function n(t,r,i,n){e.beginPath();for(var a=0;a<t.length;a+=1)e.moveTo(r+t[a].x*n,i+t[a].y*n),e.arc(r+t[a].x*n,i+t[a].y*n,2,0,2*Math.PI,!1);e.closePath(),e.fill()}t=void 0!==t?t:0,r=void 0!==r?r:0,i=void 0!==i?i:24;for(var a=1/this.path.unitsPerEm*i,s=[],o=[],l=this.path,h=0;h<l.commands.length;h+=1){var c=l.commands[h];void 0!==c.x&&s.push({x:c.x,y:-c.y}),void 0!==c.x1&&o.push({x:c.x1,y:-c.y1}),void 0!==c.x2&&o.push({x:c.x2,y:-c.y2})}e.fillStyle="blue",n(s,t,r,a),e.fillStyle="red",n(o,t,r,a)},Sc.prototype.drawMetrics=function(e,t,r,i){var n;t=void 0!==t?t:0,r=void 0!==r?r:0,i=void 0!==i?i:24,n=1/this.path.unitsPerEm*i,e.lineWidth=1,e.strokeStyle="black",d0.line(e,t,-1e4,t,1e4),d0.line(e,-1e4,r,1e4,r);var a=this.xMin||0,s=this.yMin||0,o=this.xMax||0,l=this.yMax||0,h=this.advanceWidth||0;e.strokeStyle="blue",d0.line(e,t+a*n,-1e4,t+a*n,1e4),d0.line(e,t+o*n,-1e4,t+o*n,1e4),d0.line(e,-1e4,r+-s*n,1e4,r+-s*n),d0.line(e,-1e4,r+-l*n,1e4,r+-l*n),e.strokeStyle="green",d0.line(e,t+h*n,-1e4,t+h*n,1e4)},lz.prototype.get=function(e){if(void 0===this.glyphs[e]){this.font._push(e),"function"==typeof this.glyphs[e]&&(this.glyphs[e]=this.glyphs[e]());var t=this.glyphs[e],r=this.font._IndexToUnicodeMap[e];if(r)for(var i=0;i<r.unicodes.length;i++)t.addUnicode(r.unicodes[i]);this.font.cffEncoding?this.font.isCIDFont?t.name="gid"+e:t.name=this.font.cffEncoding.charset[e]:this.font.glyphNames.names&&(t.name=this.font.glyphNames.glyphIndexToName(e)),this.glyphs[e].advanceWidth=this.font._hmtxTableData[e].advanceWidth,this.glyphs[e].leftSideBearing=this.font._hmtxTableData[e].leftSideBearing}else"function"==typeof this.glyphs[e]&&(this.glyphs[e]=this.glyphs[e]());return this.glyphs[e]},lz.prototype.push=function(e,t){this.glyphs[e]=t,this.length++};var Vh={GlyphSet:lz,glyphLoader:wEt,ttfGlyphLoader:SEt,cffGlyphLoader:MEt};function Kbe(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r+=1)if(!Kbe(e[r],t[r]))return!1;return!0}return!1}function J8(e){return e.length<1240?107:e.length<33900?1131:32768}function zp(e,t,r){var i,n,a=[],s=[],o=Dr.getCard16(e,t);if(0!==o){var l=Dr.getByte(e,t+2);i=t+(o+1)*l+2;for(var h=t+3,c=0;c<o+1;c+=1)a.push(Dr.getOffset(e,h,l)),h+=l;n=i+a[o]}else n=t+2;for(var u=0;u<a.length-1;u+=1){var d=Dr.getBytes(e,i+a[u],i+a[u+1]);r&&(d=r(d)),s.push(d)}return{objects:s,startOffset:t,endOffset:n}}function AEt(e,t){var r,i,n=[],a=Dr.getCard16(e,t);if(0!==a){var s=Dr.getByte(e,t+2);r=t+(a+1)*s+2;for(var o=t+3,l=0;l<a+1;l+=1)n.push(Dr.getOffset(e,o,s)),o+=s;i=r+n[a]}else i=t+2;return{offsets:n,startOffset:t,endOffset:i}}function REt(e,t,r,i,n){var a=Dr.getCard16(r,i),s=0;0!==a&&(s=i+(a+1)*Dr.getByte(r,i+2)+2);var o=Dr.getBytes(r,s+t[e],s+t[e+1]);return n&&(o=n(o)),o}function CEt(e){for(var t="",r=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var i=e.parseByte(),n=i>>4,a=15&i;if(15===n||(t+=r[n],15===a))break;t+=r[a]}return parseFloat(t)}function PEt(e,t){if(28===t)return e.parseByte()<<8|e.parseByte();if(29===t)return e.parseByte()<<24|e.parseByte()<<16|e.parseByte()<<8|e.parseByte();if(30===t)return CEt(e);if(t>=32&&t<=246)return t-139;if(t>=247&&t<=250)return 256*(t-247)+e.parseByte()+108;if(t>=251&&t<=254)return 256*-(t-251)-e.parseByte()-108;throw new Error("Invalid b0 "+t)}function IEt(e){for(var t={},r=0;r<e.length;r+=1){var i=e[r][0],n=e[r][1],a=void 0;if(a=1===n.length?n[0]:n,t.hasOwnProperty(i)&&!isNaN(t[i]))throw new Error("Object "+t+" already has key "+i);t[i]=a}return t}function Jbe(e,t,r){t=void 0!==t?t:0;var i=new Dr.Parser(e,t),n=[],a=[];for(r=void 0!==r?r:e.length;i.relativeOffset<r;){var s=i.parseByte();s<=21?(12===s&&(s=1200+i.parseByte()),n.push([s,a]),a=[]):a.push(PEt(i,s))}return IEt(n)}function TT(e,t){return t=t<=390?w3[t]:e[t-391]}function Qbe(e,t,r){for(var i,n={},a=0;a<t.length;a+=1){var s=t[a];if(Array.isArray(s.type)){var o=[];o.length=s.type.length;for(var l=0;l<s.type.length;l++)void 0===(i=void 0!==e[s.op]?e[s.op][l]:void 0)&&(i=void 0!==s.value&&void 0!==s.value[l]?s.value[l]:null),"SID"===s.type[l]&&(i=TT(r,i)),o[l]=i;n[s.name]=o}else void 0===(i=e[s.op])&&(i=void 0!==s.value?s.value:null),"SID"===s.type&&(i=TT(r,i)),n[s.name]=i}return n}function OEt(e,t){var r={};return r.formatMajor=Dr.getCard8(e,t),r.formatMinor=Dr.getCard8(e,t+1),r.size=Dr.getCard8(e,t+2),r.offsetSize=Dr.getCard8(e,t+3),r.startOffset=t,r.endOffset=t+4,r}var exe=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],txe=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function DEt(e,t){return Qbe(Jbe(e,0,e.byteLength),exe,t)}function rxe(e,t,r,i){return Qbe(Jbe(e,t,r),txe,i)}function cbe(e,t,r,i){for(var n=[],a=0;a<r.length;a+=1){var s=DEt(new DataView(new Uint8Array(r[a]).buffer),i);s._subrs=[],s._subrsBias=0,s._defaultWidthX=0,s._nominalWidthX=0;var o=s.private[0],l=s.private[1];if(0!==o&&0!==l){var h=rxe(e,l+t,o,i);if(s._defaultWidthX=h.defaultWidthX,s._nominalWidthX=h.nominalWidthX,0!==h.subrs){var c=zp(e,l+h.subrs+t);s._subrs=c.objects,s._subrsBias=J8(s._subrs)}s._privateDict=h}n.push(s)}return n}function LEt(e,t,r,i){var n,a,s=new Dr.Parser(e,t);r-=1;var o=[".notdef"],l=s.parseCard8();if(0===l)for(var h=0;h<r;h+=1)n=s.parseSID(),o.push(TT(i,n));else if(1===l)for(;o.length<=r;){n=s.parseSID(),a=s.parseCard8();for(var c=0;c<=a;c+=1)o.push(TT(i,n)),n+=1}else{if(2!==l)throw new Error("Unknown charset format "+l);for(;o.length<=r;){n=s.parseSID(),a=s.parseCard16();for(var u=0;u<=a;u+=1)o.push(TT(i,n)),n+=1}}return o}function kEt(e,t,r){var i,n={},a=new Dr.Parser(e,t),s=a.parseCard8();if(0===s)for(var o=a.parseCard8(),l=0;l<o;l+=1)n[i=a.parseCard8()]=l;else{if(1!==s)throw new Error("Unknown encoding format "+s);var h=a.parseCard8();i=1;for(var c=0;c<h;c+=1)for(var u=a.parseCard8(),d=a.parseCard8(),p=u;p<=u+d;p+=1)n[p]=i,i+=1}return new I3(n,r)}function ube(e,t,r){var i,n,a,s,o,l,h,c,u=new ca,d=[],p=0,f=!1,m=!1,g=0,v=0;if(e.isCIDFont){var y=e.tables.cff.topDict._fdSelect[t.index],b=e.tables.cff.topDict._fdArray[y];o=b._subrs,l=b._subrsBias,h=b._defaultWidthX,c=b._nominalWidthX}else o=e.tables.cff.topDict._subrs,l=e.tables.cff.topDict._subrsBias,h=e.tables.cff.topDict._defaultWidthX,c=e.tables.cff.topDict._nominalWidthX;var x=h;function _(e,t){m&&u.closePath(),u.moveTo(e,t),m=!0}function w(){d.length%2!=0&&!f&&(x=d.shift()+c),p+=d.length>>1,d.length=0,f=!0}return function r(h){for(var y,b,S,T,M,E,A,C,P,R,I,O,L=0;L<h.length;){var D=h[L];switch(L+=1,D){case 1:case 3:case 18:case 23:w();break;case 4:d.length>1&&!f&&(x=d.shift()+c,f=!0),v+=d.pop(),_(g,v);break;case 5:for(;d.length>0;)g+=d.shift(),v+=d.shift(),u.lineTo(g,v);break;case 6:for(;d.length>0&&(g+=d.shift(),u.lineTo(g,v),0!==d.length);)v+=d.shift(),u.lineTo(g,v);break;case 7:for(;d.length>0&&(v+=d.shift(),u.lineTo(g,v),0!==d.length);)g+=d.shift(),u.lineTo(g,v);break;case 8:for(;d.length>0;)i=g+d.shift(),n=v+d.shift(),a=i+d.shift(),s=n+d.shift(),g=a+d.shift(),v=s+d.shift(),u.curveTo(i,n,a,s,g,v);break;case 10:M=d.pop()+l,(E=o[M])&&r(E);break;case 11:return;case 12:switch(D=h[L],L+=1,D){case 35:i=g+d.shift(),n=v+d.shift(),a=i+d.shift(),s=n+d.shift(),A=a+d.shift(),C=s+d.shift(),P=A+d.shift(),R=C+d.shift(),I=P+d.shift(),O=R+d.shift(),g=I+d.shift(),v=O+d.shift(),d.shift(),u.curveTo(i,n,a,s,A,C),u.curveTo(P,R,I,O,g,v);break;case 34:i=g+d.shift(),n=v,a=i+d.shift(),s=n+d.shift(),A=a+d.shift(),C=s,P=A+d.shift(),R=s,I=P+d.shift(),O=v,g=I+d.shift(),u.curveTo(i,n,a,s,A,C),u.curveTo(P,R,I,O,g,v);break;case 36:i=g+d.shift(),n=v+d.shift(),a=i+d.shift(),s=n+d.shift(),A=a+d.shift(),C=s,P=A+d.shift(),R=s,I=P+d.shift(),O=R+d.shift(),g=I+d.shift(),u.curveTo(i,n,a,s,A,C),u.curveTo(P,R,I,O,g,v);break;case 37:i=g+d.shift(),n=v+d.shift(),a=i+d.shift(),s=n+d.shift(),A=a+d.shift(),C=s+d.shift(),P=A+d.shift(),R=C+d.shift(),I=P+d.shift(),O=R+d.shift(),Math.abs(I-g)>Math.abs(O-v)?g=I+d.shift():v=O+d.shift(),u.curveTo(i,n,a,s,A,C),u.curveTo(P,R,I,O,g,v);break;default:console.log("Glyph "+t.index+": unknown operator 1200"+D),d.length=0}break;case 14:d.length>0&&!f&&(x=d.shift()+c,f=!0),m&&(u.closePath(),m=!1);break;case 19:case 20:w(),L+=p+7>>3;break;case 21:d.length>2&&!f&&(x=d.shift()+c,f=!0),v+=d.pop(),_(g+=d.pop(),v);break;case 22:d.length>1&&!f&&(x=d.shift()+c,f=!0),_(g+=d.pop(),v);break;case 24:for(;d.length>2;)i=g+d.shift(),n=v+d.shift(),a=i+d.shift(),s=n+d.shift(),g=a+d.shift(),v=s+d.shift(),u.curveTo(i,n,a,s,g,v);g+=d.shift(),v+=d.shift(),u.lineTo(g,v);break;case 25:for(;d.length>6;)g+=d.shift(),v+=d.shift(),u.lineTo(g,v);i=g+d.shift(),n=v+d.shift(),a=i+d.shift(),s=n+d.shift(),g=a+d.shift(),v=s+d.shift(),u.curveTo(i,n,a,s,g,v);break;case 26:for(d.length%2&&(g+=d.shift());d.length>0;)i=g,n=v+d.shift(),a=i+d.shift(),s=n+d.shift(),g=a,v=s+d.shift(),u.curveTo(i,n,a,s,g,v);break;case 27:for(d.length%2&&(v+=d.shift());d.length>0;)i=g+d.shift(),n=v,a=i+d.shift(),s=n+d.shift(),g=a+d.shift(),v=s,u.curveTo(i,n,a,s,g,v);break;case 28:y=h[L],b=h[L+1],d.push((y<<24|b<<16)>>16),L+=2;break;case 29:M=d.pop()+e.gsubrsBias,(E=e.gsubrs[M])&&r(E);break;case 30:for(;d.length>0&&(i=g,n=v+d.shift(),a=i+d.shift(),s=n+d.shift(),g=a+d.shift(),v=s+(1===d.length?d.shift():0),u.curveTo(i,n,a,s,g,v),0!==d.length);)i=g+d.shift(),n=v,a=i+d.shift(),s=n+d.shift(),v=s+d.shift(),g=a+(1===d.length?d.shift():0),u.curveTo(i,n,a,s,g,v);break;case 31:for(;d.length>0&&(i=g+d.shift(),n=v,a=i+d.shift(),s=n+d.shift(),v=s+d.shift(),g=a+(1===d.length?d.shift():0),u.curveTo(i,n,a,s,g,v),0!==d.length);)i=g,n=v+d.shift(),a=i+d.shift(),s=n+d.shift(),g=a+d.shift(),v=s+(1===d.length?d.shift():0),u.curveTo(i,n,a,s,g,v);break;default:D<32?console.log("Glyph "+t.index+": unknown operator "+D):D<247?d.push(D-139):D<251?(y=h[L],L+=1,d.push(256*(D-247)+y+108)):D<255?(y=h[L],L+=1,d.push(256*-(D-251)-y-108)):(y=h[L],b=h[L+1],S=h[L+2],T=h[L+3],L+=4,d.push((y<<24|b<<16|S<<8|T)/65536))}}}(r),t.advanceWidth=x,u}function FEt(e,t,r,i){var n,a=[],s=new Dr.Parser(e,t),o=s.parseCard8();if(0===o)for(var l=0;l<r;l++){if((n=s.parseCard8())>=i)throw new Error("CFF table CID Font FDSelect has bad FD index value "+n+" (FD count "+i+")");a.push(n)}else{if(3!==o)throw new Error("CFF Table CID Font FDSelect table has unsupported format "+o);var h=s.parseCard16(),c=s.parseCard16();if(0!==c)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+c);for(var u,d=0;d<h;d++){if(n=s.parseCard8(),u=s.parseCard16(),n>=i)throw new Error("CFF table CID Font FDSelect has bad FD index value "+n+" (FD count "+i+")");if(u>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+u);for(;c<u;c++)a.push(n);c=u}if(u!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+u)}return a}function BEt(e,t,r,i){r.tables.cff={};var n=OEt(e,t),a=zp(e,n.endOffset,Dr.bytesToString),s=zp(e,a.endOffset),o=zp(e,s.endOffset,Dr.bytesToString),l=zp(e,o.endOffset);r.gsubrs=l.objects,r.gsubrsBias=J8(r.gsubrs);var h=cbe(e,t,s.objects,o.objects);if(1!==h.length)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+h.length);var c=h[0];if(r.tables.cff.topDict=c,c._privateDict&&(r.defaultWidthX=c._privateDict.defaultWidthX,r.nominalWidthX=c._privateDict.nominalWidthX),void 0!==c.ros[0]&&void 0!==c.ros[1]&&(r.isCIDFont=!0),r.isCIDFont){var u=c.fdArray,d=c.fdSelect;if(0===u||0===d)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");var p=zp(e,u+=t),f=cbe(e,t,p.objects,o.objects);c._fdArray=f,d+=t,c._fdSelect=FEt(e,d,r.numGlyphs,f.length)}var m,g=t+c.private[1],v=rxe(e,g,c.private[0],o.objects);if(r.defaultWidthX=v.defaultWidthX,r.nominalWidthX=v.nominalWidthX,0!==v.subrs){var y=g+v.subrs,b=zp(e,y);r.subrs=b.objects,r.subrsBias=J8(r.subrs)}else r.subrs=[],r.subrsBias=0;i.lowMemory?(m=AEt(e,t+c.charStrings),r.nGlyphs=m.offsets.length):(m=zp(e,t+c.charStrings),r.nGlyphs=m.objects.length);var x=LEt(e,t+c.charset,r.nGlyphs,o.objects);if(0===c.encoding?r.cffEncoding=new I3(vEt,x):1===c.encoding?r.cffEncoding=new I3(yEt,x):r.cffEncoding=kEt(e,t+c.encoding,x),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new Vh.GlyphSet(r),i.lowMemory)r._push=function(i){var n=REt(i,m.offsets,e,t+c.charStrings);r.glyphs.push(i,Vh.cffGlyphLoader(r,i,ube,n))};else for(var _=0;_<r.nGlyphs;_+=1){var w=m.objects[_];r.glyphs.push(_,Vh.cffGlyphLoader(r,_,ube,w))}}function nxe(e,t){var r,i=w3.indexOf(e);return i>=0&&(r=i),(i=t.indexOf(e))>=0?r=i+w3.length:(r=w3.length+t.length,t.push(e)),r}function NEt(){return new wr.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function UEt(e){var t=new wr.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);t.names=[];for(var r=0;r<e.length;r+=1)t.names.push({name:"name_"+r,type:"NAME",value:e[r]});return t}function ixe(e,t,r){for(var i={},n=0;n<e.length;n+=1){var a=e[n],s=t[a.name];void 0!==s&&!Kbe(s,a.value)&&("SID"===a.type&&(s=nxe(s,r)),i[a.op]={name:a.name,type:a.type,value:s})}return i}function hbe(e,t){var r=new wr.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=ixe(exe,e,t),r}function dbe(e){var t=new wr.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return t.topDicts=[{name:"topDict_0",type:"TABLE",value:e}],t}function HEt(e){var t=new wr.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);t.strings=[];for(var r=0;r<e.length;r+=1)t.strings.push({name:"string_"+r,type:"STRING",value:e[r]});return t}function VEt(){return new wr.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function zEt(e,t){for(var r=new wr.Record("Charsets",[{name:"format",type:"Card8",value:0}]),i=0;i<e.length;i+=1){var n=nxe(e[i],t);r.fields.push({name:"glyph_"+i,type:"SID",value:n})}return r}function GEt(e){var t=[],r=e.path;t.push({name:"width",type:"NUMBER",value:e.advanceWidth});for(var i=0,n=0,a=0;a<r.commands.length;a+=1){var s=void 0,o=void 0,l=r.commands[a];if("Q"===l.type){var h=.3333333333333333,c=2/3;l={type:"C",x:l.x,y:l.y,x1:Math.round(h*i+c*l.x1),y1:Math.round(h*n+c*l.y1),x2:Math.round(h*l.x+c*l.x1),y2:Math.round(h*l.y+c*l.y1)}}if("M"===l.type)s=Math.round(l.x-i),o=Math.round(l.y-n),t.push({name:"dx",type:"NUMBER",value:s}),t.push({name:"dy",type:"NUMBER",value:o}),t.push({name:"rmoveto",type:"OP",value:21}),i=Math.round(l.x),n=Math.round(l.y);else if("L"===l.type)s=Math.round(l.x-i),o=Math.round(l.y-n),t.push({name:"dx",type:"NUMBER",value:s}),t.push({name:"dy",type:"NUMBER",value:o}),t.push({name:"rlineto",type:"OP",value:5}),i=Math.round(l.x),n=Math.round(l.y);else if("C"===l.type){var u=Math.round(l.x1-i),d=Math.round(l.y1-n),p=Math.round(l.x2-l.x1),f=Math.round(l.y2-l.y1);s=Math.round(l.x-l.x2),o=Math.round(l.y-l.y2),t.push({name:"dx1",type:"NUMBER",value:u}),t.push({name:"dy1",type:"NUMBER",value:d}),t.push({name:"dx2",type:"NUMBER",value:p}),t.push({name:"dy2",type:"NUMBER",value:f}),t.push({name:"dx",type:"NUMBER",value:s}),t.push({name:"dy",type:"NUMBER",value:o}),t.push({name:"rrcurveto",type:"OP",value:8}),i=Math.round(l.x),n=Math.round(l.y)}}return t.push({name:"endchar",type:"OP",value:14}),t}function qEt(e){for(var t=new wr.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<e.length;r+=1){var i=e.get(r),n=GEt(i);t.charStrings.push({name:i.name,type:"CHARSTRING",value:n})}return t}function jEt(e,t){var r=new wr.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=ixe(txe,e,t),r}function WEt(e,t){for(var r,i=new wr.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/t.unitsPerEm,a={version:t.version,fullName:t.fullName,familyName:t.familyName,weight:t.weightName,fontBBox:t.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},s=[],o=1;o<e.length;o+=1)r=e.get(o),s.push(r.name);var l=[];i.header=NEt(),i.nameIndex=UEt([t.postScriptName]);var h=hbe(a,l);i.topDictIndex=dbe(h),i.globalSubrIndex=VEt(),i.charsets=zEt(s,l),i.charStringsIndex=qEt(e),i.privateDict=jEt({},l),i.stringIndex=HEt(l);var c=i.header.sizeOf()+i.nameIndex.sizeOf()+i.topDictIndex.sizeOf()+i.stringIndex.sizeOf()+i.globalSubrIndex.sizeOf();return a.charset=c,a.encoding=0,a.charStrings=a.charset+i.charsets.sizeOf(),a.private[1]=a.charStrings+i.charStringsIndex.sizeOf(),h=hbe(a,l),i.topDictIndex=dbe(h),i}var sxe={parse:BEt,make:WEt};function XEt(e,t){var r={},i=new Dr.Parser(e,t);return r.version=i.parseVersion(),r.fontRevision=Math.round(1e3*i.parseFixed())/1e3,r.checkSumAdjustment=i.parseULong(),r.magicNumber=i.parseULong(),cn.argument(1594834165===r.magicNumber,"Font header has wrong magic number."),r.flags=i.parseUShort(),r.unitsPerEm=i.parseUShort(),r.created=i.parseLongDateTime(),r.modified=i.parseLongDateTime(),r.xMin=i.parseShort(),r.yMin=i.parseShort(),r.xMax=i.parseShort(),r.yMax=i.parseShort(),r.macStyle=i.parseUShort(),r.lowestRecPPEM=i.parseUShort(),r.fontDirectionHint=i.parseShort(),r.indexToLocFormat=i.parseShort(),r.glyphDataFormat=i.parseShort(),r}function YEt(e){var t=Math.round((new Date).getTime()/1e3)+2082844800,r=t;return e.createdTimestamp&&(r=e.createdTimestamp+2082844800),new wr.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:t},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],e)}var axe={parse:XEt,make:YEt};function $Et(e,t){var r={},i=new Dr.Parser(e,t);return r.version=i.parseVersion(),r.ascender=i.parseShort(),r.descender=i.parseShort(),r.lineGap=i.parseShort(),r.advanceWidthMax=i.parseUShort(),r.minLeftSideBearing=i.parseShort(),r.minRightSideBearing=i.parseShort(),r.xMaxExtent=i.parseShort(),r.caretSlopeRise=i.parseShort(),r.caretSlopeRun=i.parseShort(),r.caretOffset=i.parseShort(),i.relativeOffset+=8,r.metricDataFormat=i.parseShort(),r.numberOfHMetrics=i.parseUShort(),r}function ZEt(e){return new wr.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],e)}var oxe={parse:$Et,make:ZEt};function KEt(e,t,r,i,n){for(var a,s,o=new Dr.Parser(e,t),l=0;l<i;l+=1){l<r&&(a=o.parseUShort(),s=o.parseShort());var h=n.get(l);h.advanceWidth=a,h.leftSideBearing=s}}function JEt(e,t,r,i,n){e._hmtxTableData={};for(var a,s,o=new Dr.Parser(t,r),l=0;l<n;l+=1)l<i&&(a=o.parseUShort(),s=o.parseShort()),e._hmtxTableData[l]={advanceWidth:a,leftSideBearing:s}}function QEt(e,t,r,i,n,a,s){s.lowMemory?JEt(e,t,r,i,n):KEt(t,r,i,n,a)}function e_t(e){for(var t=new wr.Table("hmtx",[]),r=0;r<e.length;r+=1){var i=e.get(r),n=i.advanceWidth||0,a=i.leftSideBearing||0;t.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:n}),t.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:a})}return t}var lxe={parse:QEt,make:e_t};function t_t(e){for(var t=new wr.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:e.length}]),r="",i=12+4*e.length,n=0;n<e.length;++n){var a=r.indexOf(e[n]);a<0&&(a=r.length,r+=e[n]),t.fields.push({name:"offset "+n,type:"USHORT",value:i+a}),t.fields.push({name:"length "+n,type:"USHORT",value:e[n].length})}return t.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),t}function r_t(e,t){var r=new Dr.Parser(e,t),i=r.parseULong();cn.argument(1===i,"Unsupported ltag table version."),r.skip("uLong",1);for(var n=r.parseULong(),a=[],s=0;s<n;s++){for(var o="",l=t+r.parseUShort(),h=r.parseUShort(),c=l;c<l+h;++c)o+=String.fromCharCode(e.getInt8(c));a.push(o)}return a}var cxe={make:t_t,parse:r_t};function n_t(e,t){var r={},i=new Dr.Parser(e,t);return r.version=i.parseVersion(),r.numGlyphs=i.parseUShort(),1===r.version&&(r.maxPoints=i.parseUShort(),r.maxContours=i.parseUShort(),r.maxCompositePoints=i.parseUShort(),r.maxCompositeContours=i.parseUShort(),r.maxZones=i.parseUShort(),r.maxTwilightPoints=i.parseUShort(),r.maxStorage=i.parseUShort(),r.maxFunctionDefs=i.parseUShort(),r.maxInstructionDefs=i.parseUShort(),r.maxStackElements=i.parseUShort(),r.maxSizeOfInstructions=i.parseUShort(),r.maxComponentElements=i.parseUShort(),r.maxComponentDepth=i.parseUShort()),r}function i_t(e){return new wr.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:e}])}var uxe={parse:n_t,make:i_t},hxe=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],dxe={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},s_t={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},fxe={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function a_t(e,t,r){switch(e){case 0:if(65535===t)return"und";if(r)return r[t];break;case 1:return dxe[t];case 3:return fxe[t]}}var Q8="utf-16",o_t={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},l_t={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function pxe(e,t,r){switch(e){case 0:return Q8;case 1:return l_t[r]||o_t[t];case 3:if(1===t||10===t)return Q8}}function c_t(e,t,r){for(var i={},n=new Dr.Parser(e,t),a=n.parseUShort(),s=n.parseUShort(),o=n.offset+n.parseUShort(),l=0;l<s;l++){var h=n.parseUShort(),c=n.parseUShort(),u=n.parseUShort(),d=n.parseUShort(),p=hxe[d]||d,f=n.parseUShort(),m=n.parseUShort(),g=a_t(h,u,r),v=pxe(h,c,u);if(void 0!==v&&void 0!==g){var y=void 0;if(y=v===Q8?G1.UTF16(e,o+m,f):G1.MACSTRING(e,o+m,f,v)){var b=i[p];void 0===b&&(b=i[p]={}),b[g]=y}}}return 1===a&&n.parseUShort(),i}function H8(e){var t={};for(var r in e)t[e[r]]=parseInt(r);return t}function fbe(e,t,r,i,n,a){return new wr.Record("NameRecord",[{name:"platformID",type:"USHORT",value:e},{name:"encodingID",type:"USHORT",value:t},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:i},{name:"length",type:"USHORT",value:n},{name:"offset",type:"USHORT",value:a}])}function u_t(e,t){var r=e.length,i=t.length-r+1;e:for(var n=0;n<i;n++)for(;n<i;n++){for(var a=0;a<r;a++)if(t[n+a]!==e[a])continue e;return n}return-1}function pbe(e,t){var r=u_t(e,t);if(r<0){r=t.length;for(var i=0,n=e.length;i<n;++i)t.push(e[i])}return r}function h_t(e,t){var r,i=[],n={},a=H8(hxe);for(var s in e){var o=a[s];if(void 0===o&&(o=s),r=parseInt(o),isNaN(r))throw new Error('Name table entry "'+s+'" does not exist, see nameTableNames for complete list.');n[r]=e[s],i.push(r)}for(var l=H8(dxe),h=H8(fxe),c=[],u=[],d=0;d<i.length;d++){var p=n[r=i[d]];for(var f in p){var m=p[f],g=1,v=l[f],y=s_t[v],b=pxe(g,y,v),x=mr.MACSTRING(m,b);void 0===x&&(g=0,(v=t.indexOf(f))<0&&(v=t.length,t.push(f)),y=4,x=mr.UTF16(m));var _=pbe(x,u);c.push(fbe(g,y,v,r,x.length,_));var w=h[f];if(void 0!==w){var S=mr.UTF16(m),T=pbe(S,u);c.push(fbe(3,1,w,r,S.length,T))}}}c.sort((function(e,t){return e.platformID-t.platformID||e.encodingID-t.encodingID||e.languageID-t.languageID||e.nameID-t.nameID}));for(var M=new wr.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:c.length},{name:"stringOffset",type:"USHORT",value:6+12*c.length}]),E=0;E<c.length;E++)M.fields.push({name:"record_"+E,type:"RECORD",value:c[E]});return M.fields.push({name:"strings",type:"LITERAL",value:u}),M}var mxe={parse:c_t,make:h_t},ez=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function d_t(e){for(var t=0;t<ez.length;t+=1){var r=ez[t];if(e>=r.begin&&e<r.end)return t}return-1}function f_t(e,t){var r={},i=new Dr.Parser(e,t);r.version=i.parseUShort(),r.xAvgCharWidth=i.parseShort(),r.usWeightClass=i.parseUShort(),r.usWidthClass=i.parseUShort(),r.fsType=i.parseUShort(),r.ySubscriptXSize=i.parseShort(),r.ySubscriptYSize=i.parseShort(),r.ySubscriptXOffset=i.parseShort(),r.ySubscriptYOffset=i.parseShort(),r.ySuperscriptXSize=i.parseShort(),r.ySuperscriptYSize=i.parseShort(),r.ySuperscriptXOffset=i.parseShort(),r.ySuperscriptYOffset=i.parseShort(),r.yStrikeoutSize=i.parseShort(),r.yStrikeoutPosition=i.parseShort(),r.sFamilyClass=i.parseShort(),r.panose=[];for(var n=0;n<10;n++)r.panose[n]=i.parseByte();return r.ulUnicodeRange1=i.parseULong(),r.ulUnicodeRange2=i.parseULong(),r.ulUnicodeRange3=i.parseULong(),r.ulUnicodeRange4=i.parseULong(),r.achVendID=String.fromCharCode(i.parseByte(),i.parseByte(),i.parseByte(),i.parseByte()),r.fsSelection=i.parseUShort(),r.usFirstCharIndex=i.parseUShort(),r.usLastCharIndex=i.parseUShort(),r.sTypoAscender=i.parseShort(),r.sTypoDescender=i.parseShort(),r.sTypoLineGap=i.parseShort(),r.usWinAscent=i.parseUShort(),r.usWinDescent=i.parseUShort(),r.version>=1&&(r.ulCodePageRange1=i.parseULong(),r.ulCodePageRange2=i.parseULong()),r.version>=2&&(r.sxHeight=i.parseShort(),r.sCapHeight=i.parseShort(),r.usDefaultChar=i.parseUShort(),r.usBreakChar=i.parseUShort(),r.usMaxContent=i.parseUShort()),r}function p_t(e){return new wr.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],e)}var tz={parse:f_t,make:p_t,unicodeRanges:ez,getUnicodeRange:d_t};function m_t(e,t){var r={},i=new Dr.Parser(e,t);switch(r.version=i.parseVersion(),r.italicAngle=i.parseFixed(),r.underlinePosition=i.parseShort(),r.underlineThickness=i.parseShort(),r.isFixedPitch=i.parseULong(),r.minMemType42=i.parseULong(),r.maxMemType42=i.parseULong(),r.minMemType1=i.parseULong(),r.maxMemType1=i.parseULong(),r.version){case 1:r.names=f0.slice();break;case 2:r.numberOfGlyphs=i.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var n=0;n<r.numberOfGlyphs;n++)r.glyphNameIndex[n]=i.parseUShort();r.names=[];for(var a=0;a<r.numberOfGlyphs;a++)if(r.glyphNameIndex[a]>=f0.length){var s=i.parseChar();r.names.push(i.parseString(s))}break;case 2.5:r.numberOfGlyphs=i.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.offset[o]=i.parseChar()}return r}function g_t(){return new wr.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var gxe={parse:m_t,make:g_t},Su=new Array(9);Su[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{substFormat:1,coverage:this.parsePointer(It.coverage),deltaGlyphId:this.parseUShort()}:2===t?{substFormat:2,coverage:this.parsePointer(It.coverage),substitute:this.parseOffset16List()}:void cn.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},Su[2]=function(){var e=this.parseUShort();return cn.argument(1===e,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(It.coverage),sequences:this.parseListOfLists()}},Su[3]=function(){var e=this.parseUShort();return cn.argument(1===e,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(It.coverage),alternateSets:this.parseListOfLists()}},Su[4]=function(){var e=this.parseUShort();return cn.argument(1===e,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(It.coverage),ligatureSets:this.parseListOfLists((function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}}))}};var z1={sequenceIndex:It.uShort,lookupListIndex:It.uShort};function v_t(e,t){var r=new It(e,t=t||0),i=r.parseVersion(1);return cn.argument(1===i||1.1===i,"Unsupported GSUB table version."),1===i?{version:i,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Su)}:{version:i,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Su),variations:r.parseFeatureVariationsList()}}Su[5]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(1===t)return{substFormat:t,coverage:this.parsePointer(It.coverage),ruleSets:this.parseListOfLists((function(){var e=this.parseUShort(),t=this.parseUShort();return{input:this.parseUShortList(e-1),lookupRecords:this.parseRecordList(t,z1)}}))};if(2===t)return{substFormat:t,coverage:this.parsePointer(It.coverage),classDef:this.parsePointer(It.classDef),classSets:this.parseListOfLists((function(){var e=this.parseUShort(),t=this.parseUShort();return{classes:this.parseUShortList(e-1),lookupRecords:this.parseRecordList(t,z1)}}))};if(3===t){var r=this.parseUShort(),i=this.parseUShort();return{substFormat:t,coverages:this.parseList(r,It.pointer(It.coverage)),lookupRecords:this.parseRecordList(i,z1)}}cn.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},Su[6]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{substFormat:1,coverage:this.parsePointer(It.coverage),chainRuleSets:this.parseListOfLists((function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(z1)}}))}:2===t?{substFormat:2,coverage:this.parsePointer(It.coverage),backtrackClassDef:this.parsePointer(It.classDef),inputClassDef:this.parsePointer(It.classDef),lookaheadClassDef:this.parsePointer(It.classDef),chainClassSet:this.parseListOfLists((function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(z1)}}))}:3===t?{substFormat:3,backtrackCoverage:this.parseList(It.pointer(It.coverage)),inputCoverage:this.parseList(It.pointer(It.coverage)),lookaheadCoverage:this.parseList(It.pointer(It.coverage)),lookupRecords:this.parseRecordList(z1)}:void cn.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},Su[7]=function(){var e=this.parseUShort();cn.argument(1===e,"GSUB Extension Substitution subtable identifier-format must be 1");var t=this.parseUShort(),r=new It(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:t,extension:Su[t].call(r)}},Su[8]=function(){var e=this.parseUShort();return cn.argument(1===e,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(It.coverage),backtrackCoverage:this.parseList(It.pointer(It.coverage)),lookaheadCoverage:this.parseList(It.pointer(It.coverage)),substitutes:this.parseUShortList()}};var q1=new Array(9);function y_t(e){return new wr.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new wr.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new wr.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new wr.LookupList(e.lookups,q1)}])}q1[1]=function(e){return 1===e.substFormat?new wr.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new wr.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new wr.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new wr.Coverage(e.coverage)}].concat(wr.ushortList("substitute",e.substitute)))},q1[2]=function(e){return cn.assert(1===e.substFormat,"Lookup type 2 substFormat must be 1."),new wr.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new wr.Coverage(e.coverage)}].concat(wr.tableList("seqSet",e.sequences,(function(e){return new wr.Table("sequenceSetTable",wr.ushortList("sequence",e))}))))},q1[3]=function(e){return cn.assert(1===e.substFormat,"Lookup type 3 substFormat must be 1."),new wr.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new wr.Coverage(e.coverage)}].concat(wr.tableList("altSet",e.alternateSets,(function(e){return new wr.Table("alternateSetTable",wr.ushortList("alternate",e))}))))},q1[4]=function(e){return cn.assert(1===e.substFormat,"Lookup type 4 substFormat must be 1."),new wr.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new wr.Coverage(e.coverage)}].concat(wr.tableList("ligSet",e.ligatureSets,(function(e){return new wr.Table("ligatureSetTable",wr.tableList("ligature",e,(function(e){return new wr.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:e.ligGlyph}].concat(wr.ushortList("component",e.components,e.components.length+1)))})))}))))},q1[6]=function(e){if(1===e.substFormat)return new wr.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new wr.Coverage(e.coverage)}].concat(wr.tableList("chainRuleSet",e.chainRuleSets,(function(e){return new wr.Table("chainRuleSetTable",wr.tableList("chainRule",e,(function(e){var t=wr.ushortList("backtrackGlyph",e.backtrack,e.backtrack.length).concat(wr.ushortList("inputGlyph",e.input,e.input.length+1)).concat(wr.ushortList("lookaheadGlyph",e.lookahead,e.lookahead.length)).concat(wr.ushortList("substitution",[],e.lookupRecords.length));return e.lookupRecords.forEach((function(e,r){t=t.concat({name:"sequenceIndex"+r,type:"USHORT",value:e.sequenceIndex}).concat({name:"lookupListIndex"+r,type:"USHORT",value:e.lookupListIndex})})),new wr.Table("chainRuleTable",t)})))}))));if(2===e.substFormat)cn.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(3===e.substFormat){var t=[{name:"substFormat",type:"USHORT",value:e.substFormat}];return t.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach((function(e,r){t.push({name:"backtrackCoverage"+r,type:"TABLE",value:new wr.Coverage(e)})})),t.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach((function(e,r){t.push({name:"inputCoverage"+r,type:"TABLE",value:new wr.Coverage(e)})})),t.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach((function(e,r){t.push({name:"lookaheadCoverage"+r,type:"TABLE",value:new wr.Coverage(e)})})),t.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach((function(e,r){t=t.concat({name:"sequenceIndex"+r,type:"USHORT",value:e.sequenceIndex}).concat({name:"lookupListIndex"+r,type:"USHORT",value:e.lookupListIndex})})),new wr.Table("chainContextTable",t)}cn.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};var vxe={parse:v_t,make:y_t};function b_t(e,t){var r=new Dr.Parser(e,t),i=r.parseULong();cn.argument(1===i,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var n=r.parseULong(),a={},s=0;s<n;s++){var o=r.parseTag(),l=r.parseULong(),h=r.parseULong(),c=G1.UTF8(e,t+l,h);a[o]=c}return a}function x_t(e){var t=Object.keys(e).length,r="",i=16+12*t,n=new wr.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:i},{name:"numTags",type:"ULONG",value:t}]);for(var a in e){var s=r.length;r+=e[a],n.fields.push({name:"tag "+a,type:"TAG",value:a}),n.fields.push({name:"offset "+a,type:"ULONG",value:i+s}),n.fields.push({name:"length "+a,type:"ULONG",value:e[a].length})}return n.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),n}var yxe={parse:b_t,make:x_t};function mbe(e){return Math.log(e)/Math.log(2)|0}function cz(e){for(;e.length%4!=0;)e.push(0);for(var t=0,r=0;r<e.length;r+=4)t+=(e[r]<<24)+(e[r+1]<<16)+(e[r+2]<<8)+e[r+3];return t%=Math.pow(2,32)}function gbe(e,t,r,i){return new wr.Record("Table Record",[{name:"tag",type:"TAG",value:void 0!==e?e:""},{name:"checkSum",type:"ULONG",value:void 0!==t?t:0},{name:"offset",type:"ULONG",value:void 0!==r?r:0},{name:"length",type:"ULONG",value:void 0!==i?i:0}])}function bxe(e){var t=new wr.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);t.tables=e,t.numTables=e.length;var r=Math.pow(2,mbe(t.numTables));t.searchRange=16*r,t.entrySelector=mbe(r),t.rangeShift=16*t.numTables-t.searchRange;for(var i=[],n=[],a=t.sizeOf()+gbe().sizeOf()*t.numTables;a%4!=0;)a+=1,n.push({name:"padding",type:"BYTE",value:0});for(var s=0;s<e.length;s+=1){var o=e[s];cn.argument(4===o.tableName.length,"Table name"+o.tableName+" is invalid.");var l=o.sizeOf(),h=gbe(o.tableName,cz(o.encode()),a,l);for(i.push({name:h.tag+" Table Record",type:"RECORD",value:h}),n.push({name:o.tableName+" table",type:"RECORD",value:o}),a+=l,cn.argument(!isNaN(a),"Something went wrong calculating the offset.");a%4!=0;)a+=1,n.push({name:"padding",type:"BYTE",value:0})}return i.sort((function(e,t){return e.value.tag>t.value.tag?1:-1})),t.fields=t.fields.concat(i),t.fields=t.fields.concat(n),t}function vbe(e,t,r){for(var i=0;i<t.length;i+=1){var n=e.charToGlyphIndex(t[i]);if(n>0)return e.glyphs.get(n).getMetrics()}return r}function E_t(e){for(var t=0,r=0;r<e.length;r+=1)t+=e[r];return t/e.length}function __t(e){for(var t,r=[],i=[],n=[],a=[],s=[],o=[],l=[],h=0,c=0,u=0,d=0,p=0,f=0;f<e.glyphs.length;f+=1){var m=e.glyphs.get(f),g=0|m.unicode;if(isNaN(m.advanceWidth))throw new Error("Glyph "+m.name+" ("+f+"): advanceWidth is not a number.");(t>g||void 0===t)&&g>0&&(t=g),h<g&&(h=g);var v=tz.getUnicodeRange(g);if(v<32)c|=1<<v;else if(v<64)u|=1<<v-32;else if(v<96)d|=1<<v-64;else{if(!(v<123))throw new Error("Unicode ranges bits > 123 are reserved for internal usage");p|=1<<v-96}if(".notdef"!==m.name){var y=m.getMetrics();r.push(y.xMin),i.push(y.yMin),n.push(y.xMax),a.push(y.yMax),o.push(y.leftSideBearing),l.push(y.rightSideBearing),s.push(m.advanceWidth)}}var b={xMin:Math.min.apply(null,r),yMin:Math.min.apply(null,i),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,a),advanceWidthMax:Math.max.apply(null,s),advanceWidthAvg:E_t(s),minLeftSideBearing:Math.min.apply(null,o),maxLeftSideBearing:Math.max.apply(null,o),minRightSideBearing:Math.min.apply(null,l)};b.ascender=e.ascender,b.descender=e.descender;var x=axe.make({flags:3,unitsPerEm:e.unitsPerEm,xMin:b.xMin,yMin:b.yMin,xMax:b.xMax,yMax:b.yMax,lowestRecPPEM:3,createdTimestamp:e.createdTimestamp}),_=oxe.make({ascender:b.ascender,descender:b.descender,advanceWidthMax:b.advanceWidthMax,minLeftSideBearing:b.minLeftSideBearing,minRightSideBearing:b.minRightSideBearing,xMaxExtent:b.maxLeftSideBearing+(b.xMax-b.xMin),numberOfHMetrics:e.glyphs.length}),w=uxe.make(e.glyphs.length),S=tz.make(Object.assign({xAvgCharWidth:Math.round(b.advanceWidthAvg),usFirstCharIndex:t,usLastCharIndex:h,ulUnicodeRange1:c,ulUnicodeRange2:u,ulUnicodeRange3:d,ulUnicodeRange4:p,sTypoAscender:b.ascender,sTypoDescender:b.descender,sTypoLineGap:0,usWinAscent:b.yMax,usWinDescent:Math.abs(b.yMin),ulCodePageRange1:1,sxHeight:vbe(e,"xyvw",{yMax:Math.round(b.ascender/2)}).yMax,sCapHeight:vbe(e,"HIKLEFJMNTZBDPRAGOQSUVWXY",b).yMax,usDefaultChar:e.hasChar(" ")?32:0,usBreakChar:e.hasChar(" ")?32:0},e.tables.os2)),T=lxe.make(e.glyphs),M=Ybe.make(e.glyphs),E=e.getEnglishName("fontFamily"),A=e.getEnglishName("fontSubfamily"),C=E+" "+A,P=e.getEnglishName("postScriptName");P||(P=E.replace(/\s/g,"")+"-"+A);var R={};for(var I in e.names)R[I]=e.names[I];R.uniqueID||(R.uniqueID={en:e.getEnglishName("manufacturer")+":"+C}),R.postScriptName||(R.postScriptName={en:P}),R.preferredFamily||(R.preferredFamily=e.names.fontFamily),R.preferredSubfamily||(R.preferredSubfamily=e.names.fontSubfamily);var O=[],L=mxe.make(R,O),D=O.length>0?cxe.make(O):void 0,k=gxe.make(),F=sxe.make(e.glyphs,{version:e.getEnglishName("version"),fullName:C,familyName:E,weightName:A,postScriptName:P,unitsPerEm:e.unitsPerEm,fontBBox:[0,b.yMin,b.ascender,b.advanceWidthMax]}),N=e.metas&&Object.keys(e.metas).length>0?yxe.make(e.metas):void 0,U=[x,_,w,S,L,M,k,F,T];D&&U.push(D),e.tables.gsub&&U.push(vxe.make(e.tables.gsub)),N&&U.push(N);for(var B=bxe(U),z=cz(B.encode()),H=B.fields,V=!1,j=0;j<H.length;j+=1)if("head table"===H[j].name){H[j].value.checkSumAdjustment=2981146554-z,V=!0;break}if(!V)throw new Error("Could not find head table with checkSum to adjust.");return B}var T_t={make:bxe,fontToTable:__t,computeCheckSum:cz};function V8(e,t){for(var r=0,i=e.length-1;r<=i;){var n=r+i>>>1,a=e[n].tag;if(a===t)return n;a<t?r=n+1:i=n-1}return-r-1}function ybe(e,t){for(var r=0,i=e.length-1;r<=i;){var n=r+i>>>1,a=e[n];if(a===t)return n;a<t?r=n+1:i=n-1}return-r-1}function bbe(e,t){for(var r,i=0,n=e.length-1;i<=n;){var a=i+n>>>1,s=(r=e[a]).start;if(s===t)return r;s<t?i=a+1:n=a-1}if(i>0)return t>(r=e[i-1]).end?0:r}function RT(e,t){this.font=e,this.tableName=t}function CT(e){RT.call(this,e,"gpos")}function Dl(e){RT.call(this,e,"gsub")}function w_t(e,t){var r=e.length;if(r!==t.length)return!1;for(var i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}function uz(e,t,r){for(var i=e.subtables,n=0;n<i.length;n++){var a=i[n];if(a.substFormat===t)return a}if(r)return i.push(r),r}function S_t(){return"undefined"!=typeof window}function M_t(e){for(var t=new Buffer(e.byteLength),r=new Uint8Array(e),i=0;i<t.length;++i)t[i]=r[i];return t}function _T(e,t){if(!e)throw t}function xbe(e,t,r,i,n){var a;return(t&i)>0?(a=e.parseByte(),t&n||(a=-a),a=r+a):a=(t&n)>0?r:r+e.parseShort(),a}function xxe(e,t,r){var i,n,a=new Dr.Parser(t,r);if(e.numberOfContours=a.parseShort(),e._xMin=a.parseShort(),e._yMin=a.parseShort(),e._xMax=a.parseShort(),e._yMax=a.parseShort(),e.numberOfContours>0){for(var s=e.endPointIndices=[],o=0;o<e.numberOfContours;o+=1)s.push(a.parseUShort());e.instructionLength=a.parseUShort(),e.instructions=[];for(var l=0;l<e.instructionLength;l+=1)e.instructions.push(a.parseByte());var h=s[s.length-1]+1;i=[];for(var c=0;c<h;c+=1)if(n=a.parseByte(),i.push(n),(8&n)>0)for(var u=a.parseByte(),d=0;d<u;d+=1)i.push(n),c+=1;if(cn.argument(i.length===h,"Bad flags."),s.length>0){var p,f=[];if(h>0){for(var m=0;m<h;m+=1)n=i[m],(p={}).onCurve=!!(1&n),p.lastPointOfContour=s.indexOf(m)>=0,f.push(p);for(var g=0,v=0;v<h;v+=1)n=i[v],(p=f[v]).x=xbe(a,n,g,2,16),g=p.x;for(var y=0,b=0;b<h;b+=1)n=i[b],(p=f[b]).y=xbe(a,n,y,4,32),y=p.y}e.points=f}else e.points=[]}else if(0===e.numberOfContours)e.points=[];else{e.isComposite=!0,e.points=[],e.components=[];for(var x=!0;x;){i=a.parseUShort();var _={glyphIndex:a.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(1&i)>0?(2&i)>0?(_.dx=a.parseShort(),_.dy=a.parseShort()):_.matchedPoints=[a.parseUShort(),a.parseUShort()]:(2&i)>0?(_.dx=a.parseChar(),_.dy=a.parseChar()):_.matchedPoints=[a.parseByte(),a.parseByte()],(8&i)>0?_.xScale=_.yScale=a.parseF2Dot14():(64&i)>0?(_.xScale=a.parseF2Dot14(),_.yScale=a.parseF2Dot14()):(128&i)>0&&(_.xScale=a.parseF2Dot14(),_.scale01=a.parseF2Dot14(),_.scale10=a.parseF2Dot14(),_.yScale=a.parseF2Dot14()),e.components.push(_),x=!!(32&i)}if(256&i){e.instructionLength=a.parseUShort(),e.instructions=[];for(var w=0;w<e.instructionLength;w+=1)e.instructions.push(a.parseByte())}}}function z8(e,t){for(var r=[],i=0;i<e.length;i+=1){var n=e[i],a={x:t.xScale*n.x+t.scale01*n.y+t.dx,y:t.scale10*n.x+t.yScale*n.y+t.dy,onCurve:n.onCurve,lastPointOfContour:n.lastPointOfContour};r.push(a)}return r}function A_t(e){for(var t=[],r=[],i=0;i<e.length;i+=1){var n=e[i];r.push(n),n.lastPointOfContour&&(t.push(r),r=[])}return cn.argument(0===r.length,"There are still points left in the current contour."),t}function Exe(e){var t=new ca;if(!e)return t;for(var r=A_t(e),i=0;i<r.length;++i){var n=r[i],a=null,s=n[n.length-1],o=n[0];if(s.onCurve)t.moveTo(s.x,s.y);else if(o.onCurve)t.moveTo(o.x,o.y);else{var l={x:.5*(s.x+o.x),y:.5*(s.y+o.y)};t.moveTo(l.x,l.y)}for(var h=0;h<n.length;++h)if(a=s,s=o,o=n[(h+1)%n.length],s.onCurve)t.lineTo(s.x,s.y);else{var c=o;a.onCurve||{x:.5*(s.x+a.x),y:.5*(s.y+a.y)},o.onCurve||(c={x:.5*(s.x+o.x),y:.5*(s.y+o.y)}),t.quadraticCurveTo(s.x,s.y,c.x,c.y)}t.closePath()}return t}function _xe(e,t){if(t.isComposite)for(var r=0;r<t.components.length;r+=1){var i=t.components[r],n=e.get(i.glyphIndex);if(n.getPath(),n.points){var a=void 0;if(void 0===i.matchedPoints)a=z8(n.points,i);else{if(i.matchedPoints[0]>t.points.length-1||i.matchedPoints[1]>n.points.length-1)throw Error("Matched points out of range in "+t.name);var s=t.points[i.matchedPoints[0]],o=n.points[i.matchedPoints[1]],l={xScale:i.xScale,scale01:i.scale01,scale10:i.scale10,yScale:i.yScale,dx:0,dy:0};o=z8([o],l)[0],l.dx=s.x-o.x,l.dy=s.y-o.y,a=z8(n.points,l)}t.points=t.points.concat(a)}}return Exe(t.points)}function R_t(e,t,r,i){for(var n=new Vh.GlyphSet(i),a=0;a<r.length-1;a+=1){var s=r[a];s!==r[a+1]?n.push(a,Vh.ttfGlyphLoader(i,a,xxe,e,t+s,_xe)):n.push(a,Vh.glyphLoader(i,a))}return n}function C_t(e,t,r,i){var n=new Vh.GlyphSet(i);return i._push=function(a){var s=r[a];s!==r[a+1]?n.push(a,Vh.ttfGlyphLoader(i,a,xxe,e,t+s,_xe)):n.push(a,Vh.glyphLoader(i,a))},n}function P_t(e,t,r,i,n){return n.lowMemory?C_t(e,t,r,i):R_t(e,t,r,i)}RT.prototype={searchTag:V8,binSearch:ybe,getTable:function(e){var t=this.font.tables[this.tableName];return!t&&e&&(t=this.font.tables[this.tableName]=this.createDefaultTable()),t},getScriptNames:function(){var e=this.getTable();return e?e.scripts.map((function(e){return e.tag})):[]},getDefaultScriptName:function(){var e=this.getTable();if(e){for(var t=!1,r=0;r<e.scripts.length;r++){var i=e.scripts[r].tag;if("DFLT"===i)return i;"latn"===i&&(t=!0)}if(t)return"latn"}},getScriptTable:function(e,t){var r=this.getTable(t);if(r){e=e||"DFLT";var i=r.scripts,n=V8(r.scripts,e);if(n>=0)return i[n].script;if(t){var a={tag:e,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return i.splice(-1-n,0,a),a.script}}},getLangSysTable:function(e,t,r){var i=this.getScriptTable(e,r);if(i){if(!t||"dflt"===t||"DFLT"===t)return i.defaultLangSys;var n=V8(i.langSysRecords,t);if(n>=0)return i.langSysRecords[n].langSys;if(r){var a={tag:t,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return i.langSysRecords.splice(-1-n,0,a),a.langSys}}},getFeatureTable:function(e,t,r,i){var n=this.getLangSysTable(e,t,i);if(n){for(var a,s=n.featureIndexes,o=this.font.tables[this.tableName].features,l=0;l<s.length;l++)if((a=o[s[l]]).tag===r)return a.feature;if(i){var h=o.length;return cn.assert(0===h||r>=o[h-1].tag,"Features must be added in alphabetical order."),a={tag:r,feature:{params:0,lookupListIndexes:[]}},o.push(a),s.push(h),a.feature}}},getLookupTables:function(e,t,r,i,n){var a=this.getFeatureTable(e,t,r,n),s=[];if(a){for(var o,l=a.lookupListIndexes,h=this.font.tables[this.tableName].lookups,c=0;c<l.length;c++)(o=h[l[c]]).lookupType===i&&s.push(o);if(0===s.length&&n){o={lookupType:i,lookupFlag:0,subtables:[],markFilteringSet:void 0};var u=h.length;return h.push(o),l.push(u),[o]}}return s},getGlyphClass:function(e,t){switch(e.format){case 1:return e.startGlyph<=t&&t<e.startGlyph+e.classes.length?e.classes[t-e.startGlyph]:0;case 2:var r=bbe(e.ranges,t);return r?r.classId:0}},getCoverageIndex:function(e,t){switch(e.format){case 1:var r=ybe(e.glyphs,t);return r>=0?r:-1;case 2:var i=bbe(e.ranges,t);return i?i.index+t-i.start:-1}},expandCoverage:function(e){if(1===e.format)return e.glyphs;for(var t=[],r=e.ranges,i=0;i<r.length;i++)for(var n=r[i],a=n.start,s=n.end,o=a;o<=s;o++)t.push(o);return t}},CT.prototype=RT.prototype,CT.prototype.init=function(){var e=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(e)},CT.prototype.getKerningValue=function(e,t,r){for(var i=0;i<e.length;i++)for(var n=e[i].subtables,a=0;a<n.length;a++){var s=n[a],o=this.getCoverageIndex(s.coverage,t);if(!(o<0))switch(s.posFormat){case 1:for(var l=s.pairSets[o],h=0;h<l.length;h++){var c=l[h];if(c.secondGlyph===r)return c.value1&&c.value1.xAdvance||0}break;case 2:var u=this.getGlyphClass(s.classDef1,t),d=this.getGlyphClass(s.classDef2,r),p=s.classRecords[u][d];return p.value1&&p.value1.xAdvance||0}}return 0},CT.prototype.getKerningTables=function(e,t){if(this.font.tables.gpos)return this.getLookupTables(e,t,"kern",2)},Dl.prototype=RT.prototype,Dl.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},Dl.prototype.getSingle=function(e,t,r){for(var i=[],n=this.getLookupTables(t,r,e,1),a=0;a<n.length;a++)for(var s=n[a].subtables,o=0;o<s.length;o++){var l=s[o],h=this.expandCoverage(l.coverage),c=void 0;if(1===l.substFormat){var u=l.deltaGlyphId;for(c=0;c<h.length;c++){var d=h[c];i.push({sub:d,by:d+u})}}else{var p=l.substitute;for(c=0;c<h.length;c++)i.push({sub:h[c],by:p[c]})}}return i},Dl.prototype.getMultiple=function(e,t,r){for(var i=[],n=this.getLookupTables(t,r,e,2),a=0;a<n.length;a++)for(var s=n[a].subtables,o=0;o<s.length;o++){var l=s[o],h=this.expandCoverage(l.coverage),c=void 0;for(c=0;c<h.length;c++){var u=h[c],d=l.sequences[c];i.push({sub:u,by:d})}}return i},Dl.prototype.getAlternates=function(e,t,r){for(var i=[],n=this.getLookupTables(t,r,e,3),a=0;a<n.length;a++)for(var s=n[a].subtables,o=0;o<s.length;o++)for(var l=s[o],h=this.expandCoverage(l.coverage),c=l.alternateSets,u=0;u<h.length;u++)i.push({sub:h[u],by:c[u]});return i},Dl.prototype.getLigatures=function(e,t,r){for(var i=[],n=this.getLookupTables(t,r,e,4),a=0;a<n.length;a++)for(var s=n[a].subtables,o=0;o<s.length;o++)for(var l=s[o],h=this.expandCoverage(l.coverage),c=l.ligatureSets,u=0;u<h.length;u++)for(var d=h[u],p=c[u],f=0;f<p.length;f++){var m=p[f];i.push({sub:[d].concat(m.components),by:m.ligGlyph})}return i},Dl.prototype.addSingle=function(e,t,r,i){var n=uz(this.getLookupTables(r,i,e,1,!0)[0],2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});cn.assert(1===n.coverage.format,"Single: unable to modify coverage table format "+n.coverage.format);var a=t.sub,s=this.binSearch(n.coverage.glyphs,a);s<0&&(s=-1-s,n.coverage.glyphs.splice(s,0,a),n.substitute.splice(s,0,0)),n.substitute[s]=t.by},Dl.prototype.addMultiple=function(e,t,r,i){cn.assert(t.by instanceof Array&&t.by.length>1,'Multiple: "by" must be an array of two or more ids');var n=uz(this.getLookupTables(r,i,e,2,!0)[0],1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});cn.assert(1===n.coverage.format,"Multiple: unable to modify coverage table format "+n.coverage.format);var a=t.sub,s=this.binSearch(n.coverage.glyphs,a);s<0&&(s=-1-s,n.coverage.glyphs.splice(s,0,a),n.sequences.splice(s,0,0)),n.sequences[s]=t.by},Dl.prototype.addAlternate=function(e,t,r,i){var n=uz(this.getLookupTables(r,i,e,3,!0)[0],1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});cn.assert(1===n.coverage.format,"Alternate: unable to modify coverage table format "+n.coverage.format);var a=t.sub,s=this.binSearch(n.coverage.glyphs,a);s<0&&(s=-1-s,n.coverage.glyphs.splice(s,0,a),n.alternateSets.splice(s,0,0)),n.alternateSets[s]=t.by},Dl.prototype.addLigature=function(e,t,r,i){var n=this.getLookupTables(r,i,e,4,!0)[0],a=n.subtables[0];a||(a={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},n.subtables[0]=a),cn.assert(1===a.coverage.format,"Ligature: unable to modify coverage table format "+a.coverage.format);var s=t.sub[0],o=t.sub.slice(1),l={ligGlyph:t.by,components:o},h=this.binSearch(a.coverage.glyphs,s);if(h>=0){for(var c=a.ligatureSets[h],u=0;u<c.length;u++)if(w_t(c[u].components,o))return;c.push(l)}else h=-1-h,a.coverage.glyphs.splice(h,0,s),a.ligatureSets.splice(h,0,[l])},Dl.prototype.getFeature=function(e,t,r){if(/ss\d\d/.test(e))return this.getSingle(e,t,r);switch(e){case"aalt":case"salt":return this.getSingle(e,t,r).concat(this.getAlternates(e,t,r));case"dlig":case"liga":case"rlig":return this.getLigatures(e,t,r);case"ccmp":return this.getMultiple(e,t,r).concat(this.getLigatures(e,t,r));case"stch":return this.getMultiple(e,t,r)}},Dl.prototype.add=function(e,t,r,i){if(/ss\d\d/.test(e))return this.addSingle(e,t,r,i);switch(e){case"aalt":case"salt":return"number"==typeof t.by?this.addSingle(e,t,r,i):this.addAlternate(e,t,r,i);case"dlig":case"liga":case"rlig":return this.addLigature(e,t,r,i);case"ccmp":return t.by instanceof Array?this.addMultiple(e,t,r,i):this.addLigature(e,t,r,i)}};var Txe={getPath:Exe,parse:P_t},wxe,m0,Sxe,rz;function Mxe(e){this.font=e,this.getCommands=function(e){return Txe.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function I_t(e){return e}function Axe(e){return Math.sign(e)*Math.round(Math.abs(e))}function O_t(e){return Math.sign(e)*Math.round(Math.abs(2*e))/2}function D_t(e){return Math.sign(e)*(Math.round(Math.abs(e)+.5)-.5)}function L_t(e){return Math.sign(e)*Math.ceil(Math.abs(e))}function k_t(e){return Math.sign(e)*Math.floor(Math.abs(e))}var Rxe=function(e){var t=this.srPeriod,r=this.srPhase,i=1;return e<0&&(e=-e,i=-1),e+=this.srThreshold-r,e=Math.trunc(e/t)*t,(e+=r)<0?r*i:e*i},Hh={x:1,y:0,axis:"x",distance:function(e,t,r,i){return(r?e.xo:e.x)-(i?t.xo:t.x)},interpolate:function(e,t,r,i){var n,a,s,o,l,h,c;if(!i||i===this)return n=e.xo-t.xo,a=e.xo-r.xo,l=t.x-t.xo,h=r.x-r.xo,0===(c=(s=Math.abs(n))+(o=Math.abs(a)))?void(e.x=e.xo+(l+h)/2):void(e.x=e.xo+(l*o+h*s)/c);n=i.distance(e,t,!0,!0),a=i.distance(e,r,!0,!0),l=i.distance(t,t,!1,!0),h=i.distance(r,r,!1,!0),0!==(c=(s=Math.abs(n))+(o=Math.abs(a)))?Hh.setRelative(e,e,(l*o+h*s)/c,i,!0):Hh.setRelative(e,e,(l+h)/2,i,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(e,t,r,i,n){if(i&&i!==this){var a=n?t.xo:t.x,s=n?t.yo:t.y,o=a+r*i.x,l=s+r*i.y;e.x=o+(e.y-l)/i.normalSlope}else e.x=(n?t.xo:t.x)+r},slope:0,touch:function(e){e.xTouched=!0},touched:function(e){return e.xTouched},untouch:function(e){e.xTouched=!1}},lf={x:0,y:1,axis:"y",distance:function(e,t,r,i){return(r?e.yo:e.y)-(i?t.yo:t.y)},interpolate:function(e,t,r,i){var n,a,s,o,l,h,c;if(!i||i===this)return n=e.yo-t.yo,a=e.yo-r.yo,l=t.y-t.yo,h=r.y-r.yo,0===(c=(s=Math.abs(n))+(o=Math.abs(a)))?void(e.y=e.yo+(l+h)/2):void(e.y=e.yo+(l*o+h*s)/c);n=i.distance(e,t,!0,!0),a=i.distance(e,r,!0,!0),l=i.distance(t,t,!1,!0),h=i.distance(r,r,!1,!0),0!==(c=(s=Math.abs(n))+(o=Math.abs(a)))?lf.setRelative(e,e,(l*o+h*s)/c,i,!0):lf.setRelative(e,e,(l+h)/2,i,!0)},normalSlope:0,setRelative:function(e,t,r,i,n){if(i&&i!==this){var a=n?t.xo:t.x,s=n?t.yo:t.y,o=a+r*i.x,l=s+r*i.y;e.y=l+i.normalSlope*(e.x-o)}else e.y=(n?t.yo:t.y)+r},slope:Number.POSITIVE_INFINITY,touch:function(e){e.yTouched=!0},touched:function(e){return e.yTouched},untouch:function(e){e.yTouched=!1}};function PT(e,t){this.x=e,this.y=t,this.axis=void 0,this.slope=t/e,this.normalSlope=-e/t,Object.freeze(this)}function IT(e,t){var r=Math.sqrt(e*e+t*t);return t/=r,1===(e/=r)&&0===t?Hh:0===e&&1===t?lf:new PT(e,t)}function cf(e,t,r,i){this.x=this.xo=Math.round(64*e)/64,this.y=this.yo=Math.round(64*t)/64,this.lastPointOfContour=r,this.onCurve=i,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Object.freeze(Hh),Object.freeze(lf),PT.prototype.distance=function(e,t,r,i){return this.x*Hh.distance(e,t,r,i)+this.y*lf.distance(e,t,r,i)},PT.prototype.interpolate=function(e,t,r,i){var n,a,s,o,l,h,c;s=i.distance(e,t,!0,!0),o=i.distance(e,r,!0,!0),n=i.distance(t,t,!1,!0),a=i.distance(r,r,!1,!0),0!==(c=(l=Math.abs(s))+(h=Math.abs(o)))?this.setRelative(e,e,(n*h+a*l)/c,i,!0):this.setRelative(e,e,(n+a)/2,i,!0)},PT.prototype.setRelative=function(e,t,r,i,n){i=i||this;var a=n?t.xo:t.x,s=n?t.yo:t.y,o=a+r*i.x,l=s+r*i.y,h=i.normalSlope,c=this.slope,u=e.x,d=e.y;e.x=(c*u-h*o+l-d)/(c-h),e.y=c*(e.x-u)+d},PT.prototype.touch=function(e){e.xTouched=!0,e.yTouched=!0},cf.prototype.nextTouched=function(e){for(var t=this.nextPointOnContour;!e.touched(t)&&t!==this;)t=t.nextPointOnContour;return t},cf.prototype.prevTouched=function(e){for(var t=this.prevPointOnContour;!e.touched(t)&&t!==this;)t=t.prevPointOnContour;return t};var AT=Object.freeze(new cf(0,0)),F_t={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Gp(e,t){switch(this.env=e,this.stack=[],this.prog=t,e){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=Hh,this.round=Axe}}function O3(e){for(var t=e.tZone=new Array(e.gZone.length),r=0;r<t.length;r++)t[r]=new cf(0,0)}function Cxe(e,t){var r,i=e.prog,n=e.ip,a=1;do{if(88===(r=i[++n]))a++;else if(89===r)a--;else if(64===r)n+=i[n+1]+1;else if(65===r)n+=2*i[n+1]+1;else if(r>=176&&r<=183)n+=r-176+1;else if(r>=184&&r<=191)n+=2*(r-184+1);else if(t&&1===a&&27===r)break}while(a>0);e.ip=n}function Ebe(e,t){exports.DEBUG&&console.log(t.step,"SVTCA["+e.axis+"]"),t.fv=t.pv=t.dpv=e}function _be(e,t){exports.DEBUG&&console.log(t.step,"SPVTCA["+e.axis+"]"),t.pv=t.dpv=e}function Tbe(e,t){exports.DEBUG&&console.log(t.step,"SFVTCA["+e.axis+"]"),t.fv=e}function wbe(e,t){var r,i,n=t.stack,a=n.pop(),s=n.pop(),o=t.z2[a],l=t.z1[s];exports.DEBUG&&console.log("SPVTL["+e+"]",a,s),e?(r=o.y-l.y,i=l.x-o.x):(r=l.x-o.x,i=l.y-o.y),t.pv=t.dpv=IT(r,i)}function Sbe(e,t){var r,i,n=t.stack,a=n.pop(),s=n.pop(),o=t.z2[a],l=t.z1[s];exports.DEBUG&&console.log("SFVTL["+e+"]",a,s),e?(r=o.y-l.y,i=l.x-o.x):(r=l.x-o.x,i=l.y-o.y),t.fv=IT(r,i)}function B_t(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"SPVFS[]",r,i),e.pv=e.dpv=IT(i,r)}function N_t(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"SPVFS[]",r,i),e.fv=IT(i,r)}function U_t(e){var t=e.stack,r=e.pv;exports.DEBUG&&console.log(e.step,"GPV[]"),t.push(16384*r.x),t.push(16384*r.y)}function H_t(e){var t=e.stack,r=e.fv;exports.DEBUG&&console.log(e.step,"GFV[]"),t.push(16384*r.x),t.push(16384*r.y)}function V_t(e){e.fv=e.pv,exports.DEBUG&&console.log(e.step,"SFVTPV[]")}function z_t(e){var t=e.stack,r=t.pop(),i=t.pop(),n=t.pop(),a=t.pop(),s=t.pop(),o=e.z0,l=e.z1,h=o[r],c=o[i],u=l[n],d=l[a],p=e.z2[s];exports.DEBUG&&console.log("ISECT[], ",r,i,n,a,s);var f=h.x,m=h.y,g=c.x,v=c.y,y=u.x,b=u.y,x=d.x,_=d.y,w=(f-g)*(b-_)-(m-v)*(y-x),S=f*v-m*g,T=y*_-b*x;p.x=(S*(y-x)-T*(f-g))/w,p.y=(S*(b-_)-T*(m-v))/w}function G_t(e){e.rp0=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SRP0[]",e.rp0)}function q_t(e){e.rp1=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SRP1[]",e.rp1)}function j_t(e){e.rp2=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SRP2[]",e.rp2)}function W_t(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZP0[]",t),e.zp0=t,t){case 0:e.tZone||O3(e),e.z0=e.tZone;break;case 1:e.z0=e.gZone;break;default:throw new Error("Invalid zone pointer")}}function X_t(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZP1[]",t),e.zp1=t,t){case 0:e.tZone||O3(e),e.z1=e.tZone;break;case 1:e.z1=e.gZone;break;default:throw new Error("Invalid zone pointer")}}function Y_t(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZP2[]",t),e.zp2=t,t){case 0:e.tZone||O3(e),e.z2=e.tZone;break;case 1:e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}}function $_t(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZPS[]",t),e.zp0=e.zp1=e.zp2=t,t){case 0:e.tZone||O3(e),e.z0=e.z1=e.z2=e.tZone;break;case 1:e.z0=e.z1=e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}}function Z_t(e){e.loop=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SLOOP[]",e.loop)}function K_t(e){exports.DEBUG&&console.log(e.step,"RTG[]"),e.round=Axe}function J_t(e){exports.DEBUG&&console.log(e.step,"RTHG[]"),e.round=D_t}function Q_t(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SMD[]",t),e.minDis=t/64}function eTt(e){exports.DEBUG&&console.log(e.step,"ELSE[]"),Cxe(e,!1)}function tTt(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"JMPR[]",t),e.ip+=t-1}function rTt(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SCVTCI[]",t),e.cvCutIn=t/64}function nTt(e){var t=e.stack;exports.DEBUG&&console.log(e.step,"DUP[]"),t.push(t[t.length-1])}function G8(e){exports.DEBUG&&console.log(e.step,"POP[]"),e.stack.pop()}function iTt(e){exports.DEBUG&&console.log(e.step,"CLEAR[]"),e.stack.length=0}function sTt(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"SWAP[]"),t.push(r),t.push(i)}function aTt(e){var t=e.stack;exports.DEBUG&&console.log(e.step,"DEPTH[]"),t.push(t.length)}function oTt(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"LOOPCALL[]",r,i);var n=e.ip,a=e.prog;e.prog=e.funcs[r];for(var s=0;s<i;s++)m0(e),exports.DEBUG&&console.log(++e.step,s+1<i?"next loopcall":"done loopcall",s);e.ip=n,e.prog=a}function lTt(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"CALL[]",t);var r=e.ip,i=e.prog;e.prog=e.funcs[t],m0(e),e.ip=r,e.prog=i,exports.DEBUG&&console.log(++e.step,"returning from",t)}function cTt(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"CINDEX[]",r),t.push(t[t.length-r])}function uTt(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"MINDEX[]",r),t.push(t.splice(t.length-r,1)[0])}function hTt(e){if("fpgm"!==e.env)throw new Error("FDEF not allowed here");var t=e.stack,r=e.prog,i=e.ip,n=t.pop(),a=i;for(exports.DEBUG&&console.log(e.step,"FDEF[]",n);45!==r[++i];);e.ip=i,e.funcs[n]=r.slice(a+1,i)}function Mbe(e,t){var r=t.stack.pop(),i=t.z0[r],n=t.fv,a=t.pv;exports.DEBUG&&console.log(t.step,"MDAP["+e+"]",r);var s=a.distance(i,AT);e&&(s=t.round(s)),n.setRelative(i,AT,s,a),n.touch(i),t.rp0=t.rp1=r}function Abe(e,t){var r,i,n,a=t.z2,s=a.length-2;exports.DEBUG&&console.log(t.step,"IUP["+e.axis+"]");for(var o=0;o<s;o++)r=a[o],!e.touched(r)&&((i=r.prevTouched(e))!==r&&(i===(n=r.nextTouched(e))&&e.setRelative(r,r,e.distance(i,i,!1,!0),e,!0),e.interpolate(r,i,n,e)))}function Rbe(e,t){for(var r=t.stack,i=e?t.rp1:t.rp2,n=(e?t.z0:t.z1)[i],a=t.fv,s=t.pv,o=t.loop,l=t.z2;o--;){var h=r.pop(),c=l[h],u=s.distance(n,n,!1,!0);a.setRelative(c,c,u,s),a.touch(c),exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"SHP["+(e?"rp1":"rp2")+"]",h)}t.loop=1}function Cbe(e,t){var r=t.stack,i=e?t.rp1:t.rp2,n=(e?t.z0:t.z1)[i],a=t.fv,s=t.pv,o=r.pop(),l=t.z2[t.contours[o]],h=l;exports.DEBUG&&console.log(t.step,"SHC["+e+"]",o);var c=s.distance(n,n,!1,!0);do{h!==n&&a.setRelative(h,h,c,s),h=h.nextPointOnContour}while(h!==l)}function Pbe(e,t){var r,i=t.stack,n=e?t.rp1:t.rp2,a=(e?t.z0:t.z1)[n],s=t.fv,o=t.pv,l=i.pop();switch(exports.DEBUG&&console.log(t.step,"SHZ["+e+"]",l),l){case 0:r=t.tZone;break;case 1:r=t.gZone;break;default:throw new Error("Invalid zone")}for(var h,c=o.distance(a,a,!1,!0),u=r.length-2,d=0;d<u;d++)h=r[d],s.setRelative(h,h,c,o)}function dTt(e){for(var t=e.stack,r=e.loop,i=e.fv,n=t.pop()/64,a=e.z2;r--;){var s=t.pop(),o=a[s];exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-r)+": ":"")+"SHPIX[]",s,n),i.setRelative(o,o,n),i.touch(o)}e.loop=1}function fTt(e){for(var t=e.stack,r=e.rp1,i=e.rp2,n=e.loop,a=e.z0[r],s=e.z1[i],o=e.fv,l=e.dpv,h=e.z2;n--;){var c=t.pop(),u=h[c];exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-n)+": ":"")+"IP[]",c,r,"<->",i),o.interpolate(u,a,s,l),o.touch(u)}e.loop=1}function Ibe(e,t){var r=t.stack,i=r.pop()/64,n=r.pop(),a=t.z1[n],s=t.z0[t.rp0],o=t.fv,l=t.pv;o.setRelative(a,s,i,l),o.touch(a),exports.DEBUG&&console.log(t.step,"MSIRP["+e+"]",i,n),t.rp1=t.rp0,t.rp2=n,e&&(t.rp0=n)}function pTt(e){for(var t=e.stack,r=e.rp0,i=e.z0[r],n=e.loop,a=e.fv,s=e.pv,o=e.z1;n--;){var l=t.pop(),h=o[l];exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-n)+": ":"")+"ALIGNRP[]",l),a.setRelative(h,i,0,s),a.touch(h)}e.loop=1}function mTt(e){exports.DEBUG&&console.log(e.step,"RTDG[]"),e.round=O_t}function Obe(e,t){var r=t.stack,i=r.pop(),n=r.pop(),a=t.z0[n],s=t.fv,o=t.pv,l=t.cvt[i];exports.DEBUG&&console.log(t.step,"MIAP["+e+"]",i,"(",l,")",n);var h=o.distance(a,AT);e&&(Math.abs(h-l)<t.cvCutIn&&(h=l),h=t.round(h)),s.setRelative(a,AT,h,o),0===t.zp0&&(a.xo=a.x,a.yo=a.y),s.touch(a),t.rp0=t.rp1=n}function gTt(e){var t=e.prog,r=e.ip,i=e.stack,n=t[++r];exports.DEBUG&&console.log(e.step,"NPUSHB[]",n);for(var a=0;a<n;a++)i.push(t[++r]);e.ip=r}function vTt(e){var t=e.ip,r=e.prog,i=e.stack,n=r[++t];exports.DEBUG&&console.log(e.step,"NPUSHW[]",n);for(var a=0;a<n;a++){var s=r[++t]<<8|r[++t];32768&s&&(s=-(1+(65535^s))),i.push(s)}e.ip=t}function yTt(e){var t=e.stack,r=e.store;r||(r=e.store=[]);var i=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"WS",i,n),r[n]=i}function bTt(e){var t=e.stack,r=e.store,i=t.pop();exports.DEBUG&&console.log(e.step,"RS",i);var n=r&&r[i]||0;t.push(n)}function xTt(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"WCVTP",r,i),e.cvt[i]=r/64}function ETt(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"RCVT",r),t.push(64*e.cvt[r])}function Dbe(e,t){var r=t.stack,i=r.pop(),n=t.z2[i];exports.DEBUG&&console.log(t.step,"GC["+e+"]",i),r.push(64*t.dpv.distance(n,AT,e,!1))}function Lbe(e,t){var r=t.stack,i=r.pop(),n=r.pop(),a=t.z1[i],s=t.z0[n],o=t.dpv.distance(s,a,e,e);exports.DEBUG&&console.log(t.step,"MD["+e+"]",i,n,"->",o),t.stack.push(Math.round(64*o))}function _Tt(e){exports.DEBUG&&console.log(e.step,"MPPEM[]"),e.stack.push(e.ppem)}function TTt(e){exports.DEBUG&&console.log(e.step,"FLIPON[]"),e.autoFlip=!0}function wTt(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"LT[]",r,i),t.push(i<r?1:0)}function STt(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"LTEQ[]",r,i),t.push(i<=r?1:0)}function MTt(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"GT[]",r,i),t.push(i>r?1:0)}function ATt(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"GTEQ[]",r,i),t.push(i>=r?1:0)}function RTt(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"EQ[]",r,i),t.push(r===i?1:0)}function CTt(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"NEQ[]",r,i),t.push(r!==i?1:0)}function PTt(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"ODD[]",r),t.push(Math.trunc(r)%2?1:0)}function ITt(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"EVEN[]",r),t.push(Math.trunc(r)%2?0:1)}function OTt(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"IF[]",t),t||(Cxe(e,!0),exports.DEBUG&&console.log(e.step,"EIF[]"))}function DTt(e){exports.DEBUG&&console.log(e.step,"EIF[]")}function LTt(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"AND[]",r,i),t.push(r&&i?1:0)}function kTt(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"OR[]",r,i),t.push(r||i?1:0)}function FTt(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"NOT[]",r),t.push(r?0:1)}function q8(e,t){var r=t.stack,i=r.pop(),n=t.fv,a=t.pv,s=t.ppem,o=t.deltaBase+16*(e-1),l=t.deltaShift,h=t.z0;exports.DEBUG&&console.log(t.step,"DELTAP["+e+"]",i,r);for(var c=0;c<i;c++){var u=r.pop(),d=r.pop();if(o+((240&d)>>4)===s){var p=(15&d)-8;p>=0&&p++,exports.DEBUG&&console.log(t.step,"DELTAPFIX",u,"by",p*l);var f=h[u];n.setRelative(f,f,p*l,a)}}}function BTt(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SDB[]",t),e.deltaBase=t}function NTt(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SDS[]",t),e.deltaShift=Math.pow(.5,t)}function UTt(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"ADD[]",r,i),t.push(i+r)}function HTt(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"SUB[]",r,i),t.push(i-r)}function VTt(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"DIV[]",r,i),t.push(64*i/r)}function zTt(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"MUL[]",r,i),t.push(i*r/64)}function GTt(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"ABS[]",r),t.push(Math.abs(r))}function qTt(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"NEG[]",r),t.push(-r)}function jTt(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"FLOOR[]",r),t.push(64*Math.floor(r/64))}function WTt(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"CEILING[]",r),t.push(64*Math.ceil(r/64))}function T3(e,t){var r=t.stack,i=r.pop();exports.DEBUG&&console.log(t.step,"ROUND[]"),r.push(64*t.round(i/64))}function XTt(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"WCVTF[]",r,i),e.cvt[i]=r*e.ppem/e.font.unitsPerEm}function j8(e,t){var r=t.stack,i=r.pop(),n=t.ppem,a=t.deltaBase+16*(e-1),s=t.deltaShift;exports.DEBUG&&console.log(t.step,"DELTAC["+e+"]",i,r);for(var o=0;o<i;o++){var l=r.pop(),h=r.pop();if(a+((240&h)>>4)===n){var c=(15&h)-8;c>=0&&c++;var u=c*s;exports.DEBUG&&console.log(t.step,"DELTACFIX",l,"by",u),t.cvt[l]+=u}}}function YTt(e){var t,r=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SROUND[]",r),e.round=Rxe,192&r){case 0:t=.5;break;case 64:t=1;break;case 128:t=2;break;default:throw new Error("invalid SROUND value")}switch(e.srPeriod=t,48&r){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*t;break;case 32:e.srPhase=.5*t;break;case 48:e.srPhase=.75*t;break;default:throw new Error("invalid SROUND value")}r&=15,e.srThreshold=0===r?0:(r/8-.5)*t}function $Tt(e){var t,r=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"S45ROUND[]",r),e.round=Rxe,192&r){case 0:t=Math.sqrt(2)/2;break;case 64:t=Math.sqrt(2);break;case 128:t=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(e.srPeriod=t,48&r){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*t;break;case 32:e.srPhase=.5*t;break;case 48:e.srPhase=.75*t;break;default:throw new Error("invalid S45ROUND value")}r&=15,e.srThreshold=0===r?0:(r/8-.5)*t}function ZTt(e){exports.DEBUG&&console.log(e.step,"ROFF[]"),e.round=I_t}function KTt(e){exports.DEBUG&&console.log(e.step,"RUTG[]"),e.round=L_t}function JTt(e){exports.DEBUG&&console.log(e.step,"RDTG[]"),e.round=k_t}function QTt(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SCANCTRL[]",t)}function kbe(e,t){var r,i,n=t.stack,a=n.pop(),s=n.pop(),o=t.z2[a],l=t.z1[s];exports.DEBUG&&console.log(t.step,"SDPVTL["+e+"]",a,s),e?(r=o.y-l.y,i=l.x-o.x):(r=l.x-o.x,i=l.y-o.y),t.dpv=IT(r,i)}function ewt(e){var t=e.stack,r=t.pop(),i=0;exports.DEBUG&&console.log(e.step,"GETINFO[]",r),1&r&&(i=35),32&r&&(i|=4096),t.push(i)}function twt(e){var t=e.stack,r=t.pop(),i=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"ROLL[]"),t.push(i),t.push(r),t.push(n)}function rwt(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"MAX[]",r,i),t.push(Math.max(i,r))}function nwt(e){var t=e.stack,r=t.pop(),i=t.pop();exports.DEBUG&&console.log(e.step,"MIN[]",r,i),t.push(Math.min(i,r))}function iwt(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SCANTYPE[]",t)}function swt(e){var t=e.stack.pop(),r=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"INSTCTRL[]",t,r),t){case 1:return void(e.inhibitGridFit=!!r);case 2:return void(e.ignoreCvt=!!r);default:throw new Error("invalid INSTCTRL[] selector")}}function Hp(e,t){var r=t.stack,i=t.prog,n=t.ip;exports.DEBUG&&console.log(t.step,"PUSHB["+e+"]");for(var a=0;a<e;a++)r.push(i[++n]);t.ip=n}function Vp(e,t){var r=t.ip,i=t.prog,n=t.stack;exports.DEBUG&&console.log(t.ip,"PUSHW["+e+"]");for(var a=0;a<e;a++){var s=i[++r]<<8|i[++r];32768&s&&(s=-(1+(65535^s))),n.push(s)}t.ip=r}function Or(e,t,r,i,n,a){var s,o,l,h,c=a.stack,u=e&&c.pop(),d=c.pop(),p=a.rp0,f=a.z0[p],m=a.z1[d],g=a.minDis,v=a.fv,y=a.dpv;l=(o=s=y.distance(m,f,!0,!0))>=0?1:-1,o=Math.abs(o),e&&(h=a.cvt[u],i&&Math.abs(o-h)<a.cvCutIn&&(o=h)),r&&o<g&&(o=g),i&&(o=a.round(o)),v.setRelative(m,f,l*o,y),v.touch(m),exports.DEBUG&&console.log(a.step,(e?"MIRP[":"MDRP[")+(t?"M":"m")+(r?">":"_")+(i?"R":"_")+(0===n?"Gr":1===n?"Bl":2===n?"Wh":"")+"]",e?u+"("+a.cvt[u]+","+h+")":"",d,"(d =",s,"->",l*o,")"),a.rp1=a.rp0,a.rp2=d,t&&(a.rp0=d)}function j1(e){this.char=e,this.state={},this.activeState=null}function hz(e,t,r){this.contextName=r,this.startIndex=e,this.endOffset=t}function awt(e,t,r){this.contextName=e,this.openRange=null,this.ranges=[],this.checkStart=t,this.checkEnd=r}function Mu(e,t){this.context=e,this.index=t,this.length=e.length,this.current=e[t],this.backtrack=e.slice(0,t),this.lookahead=e.slice(t+1)}function D3(e){this.eventId=e,this.subscribers=[]}function owt(e){var t=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach((function(e){Object.defineProperty(t.events,e,{value:new D3(e)})})),e&&r.forEach((function(r){var i=e[r];"function"==typeof i&&t.events[r].subscribe(i)}));["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"].forEach((function(e){t.events[e].subscribe(t.updateContextsRanges)}))}function Ls(e){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],owt.call(this,e)}function qp(e){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(e)}function Pxe(e){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(e)}function jp(e){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(e)}function S3(e){return/[A-z]/.test(e)}function lwt(e){return/\s/.test(e)}function Ll(e){this.font=e,this.features={}}function p0(e){this.id=e.id,this.tag=e.tag,this.substitution=e.substitution}function OT(e,t){if(!e)return-1;switch(t.format){case 1:return t.glyphs.indexOf(e);case 2:for(var r=t.ranges,i=0;i<r.length;i++){var n=r[i];if(e>=n.start&&e<=n.end){var a=e-n.start;return n.index+a}}break;default:return-1}return-1}function cwt(e,t){return-1===OT(e,t.coverage)?null:e+t.deltaGlyphId}function uwt(e,t){var r=OT(e,t.coverage);return-1===r?null:t.substitute[r]}function W8(e,t){for(var r=[],i=0;i<e.length;i++){var n=e[i],a=t.current,s=OT(a=Array.isArray(a)?a[0]:a,n);-1!==s&&r.push(s)}return r.length!==e.length?-1:r}function hwt(e,t){var r=t.inputCoverage.length+t.lookaheadCoverage.length+t.backtrackCoverage.length;if(e.context.length<r)return[];var i=W8(t.inputCoverage,e);if(-1===i)return[];var n=t.inputCoverage.length-1;if(e.lookahead.length<t.lookaheadCoverage.length)return[];for(var a=e.lookahead.slice(n);a.length&&jp(a[0].char);)a.shift();var s=new Mu(a,0),o=W8(t.lookaheadCoverage,s),l=[].concat(e.backtrack);for(l.reverse();l.length&&jp(l[0].char);)l.shift();if(l.length<t.backtrackCoverage.length)return[];var h=new Mu(l,0),c=W8(t.backtrackCoverage,h),u=[];if(i.length===t.inputCoverage.length&&o.length===t.lookaheadCoverage.length&&c.length===t.backtrackCoverage.length)for(var d=0;d<t.lookupRecords.length;d++)for(var p=t.lookupRecords[d].lookupListIndex,f=this.getLookupByIndex(p),m=0;m<f.subtables.length;m++){var g=f.subtables[m],v=this.getLookupMethod(f,g);if("12"===this.getSubstitutionType(f,g))for(var y=0;y<i.length;y++){var b=v(e.get(y));b&&u.push(b)}}return u}function dwt(e,t){var r=OT(e.current,t.coverage);if(-1===r)return null;for(var i,n=t.ligatureSets[r],a=0;a<n.length;a++){i=n[a];for(var s=0;s<i.components.length;s++){if(e.lookahead[s]!==i.components[s])break;if(s===i.components.length-1)return i}}return null}function fwt(e,t){var r=OT(e,t.coverage);return-1===r?null:t.sequences[r]}function pwt(e){var t=e.current,r=e.get(-1);return null===r&&qp(t)||!qp(r)&&qp(t)}function mwt(e){var t=e.get(1);return null===t||!qp(t)}Mxe.prototype.exec=function(e,t){if("number"!=typeof t)throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,i=this._prepState;if(!i||i.ppem!==t){var n=this._fpgmState;if(!n){Gp.prototype=F_t,(n=this._fpgmState=new Gp("fpgm",r.tables.fpgm)).funcs=[],n.font=r,exports.DEBUG&&(console.log("---EXEC FPGM---"),n.step=-1);try{m0(n)}catch(e){return console.log("Hinting error in FPGM:"+e),void(this._errorState=3)}}Gp.prototype=n,(i=this._prepState=new Gp("prep",r.tables.prep)).ppem=t;var a=r.tables.cvt;if(a)for(var s=i.cvt=new Array(a.length),o=t/r.unitsPerEm,l=0;l<a.length;l++)s[l]=a[l]*o;else i.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),i.step=-1);try{m0(i)}catch(e){this._errorState<2&&console.log("Hinting error in PREP:"+e),this._errorState=2}}if(!(this._errorState>1))try{return Sxe(e,i)}catch(e){return this._errorState<1&&(console.log("Hinting error:"+e),console.log("Note: further hinting errors are silenced")),void(this._errorState=1)}}},Sxe=function(e,t){var r,i,n,a=t.ppem/t.font.unitsPerEm,s=a,o=e.components;if(Gp.prototype=t,o){var l=t.font;i=[],r=[];for(var h=0;h<o.length;h++){var c=o[h],u=l.glyphs.get(c.glyphIndex);n=new Gp("glyf",u.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+h+"---"),n.step=-1),rz(u,n,a,s);for(var d=Math.round(c.dx*a),p=Math.round(c.dy*s),f=n.gZone,m=n.contours,g=0;g<f.length;g++){var v=f[g];v.xTouched=v.yTouched=!1,v.xo=v.x=v.x+d,v.yo=v.y=v.y+p}var y=i.length;i.push.apply(i,f);for(var b=0;b<m.length;b++)r.push(m[b]+y)}e.instructions&&!n.inhibitGridFit&&((n=new Gp("glyf",e.instructions)).gZone=n.z0=n.z1=n.z2=i,n.contours=r,i.push(new cf(0,0),new cf(Math.round(e.advanceWidth*a),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),n.step=-1),m0(n),i.length-=2)}else n=new Gp("glyf",e.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),n.step=-1),rz(e,n,a,s),i=n.gZone;return i},rz=function(e,t,r,i){for(var n,a=e.points||[],s=a.length,o=t.gZone=t.z0=t.z1=t.z2=[],l=t.contours=[],h=0;h<s;h++)n=a[h],o[h]=new cf(n.x*r,n.y*i,n.lastPointOfContour,n.onCurve);for(var c,u,d=0;d<s;d++)n=o[d],c||(c=n,l.push(d)),n.lastPointOfContour?(n.nextPointOnContour=c,c.prevPointOnContour=n,c=void 0):(u=o[d+1],n.nextPointOnContour=u,u.prevPointOnContour=n);if(!t.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",t.stack);for(var p=0;p<s;p++)console.log(p,o[p].x,o[p].y)}if(o.push(new cf(0,0),new cf(Math.round(e.advanceWidth*r),0)),m0(t),o.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",t.stack);for(var f=0;f<s;f++)console.log(f,o[f].x,o[f].y)}}},m0=function(e){var t=e.prog;if(t){var r,i=t.length;for(e.ip=0;e.ip<i;e.ip++){if(exports.DEBUG&&e.step++,!(r=wxe[t[e.ip]]))throw new Error("unknown instruction: 0x"+Number(t[e.ip]).toString(16));r(e)}}},wxe=[Ebe.bind(void 0,lf),Ebe.bind(void 0,Hh),_be.bind(void 0,lf),_be.bind(void 0,Hh),Tbe.bind(void 0,lf),Tbe.bind(void 0,Hh),wbe.bind(void 0,0),wbe.bind(void 0,1),Sbe.bind(void 0,0),Sbe.bind(void 0,1),B_t,N_t,U_t,H_t,V_t,z_t,G_t,q_t,j_t,W_t,X_t,Y_t,$_t,Z_t,K_t,J_t,Q_t,eTt,tTt,rTt,void 0,void 0,nTt,G8,iTt,sTt,aTt,cTt,uTt,void 0,void 0,void 0,oTt,lTt,hTt,void 0,Mbe.bind(void 0,0),Mbe.bind(void 0,1),Abe.bind(void 0,lf),Abe.bind(void 0,Hh),Rbe.bind(void 0,0),Rbe.bind(void 0,1),Cbe.bind(void 0,0),Cbe.bind(void 0,1),Pbe.bind(void 0,0),Pbe.bind(void 0,1),dTt,fTt,Ibe.bind(void 0,0),Ibe.bind(void 0,1),pTt,mTt,Obe.bind(void 0,0),Obe.bind(void 0,1),gTt,vTt,yTt,bTt,xTt,ETt,Dbe.bind(void 0,0),Dbe.bind(void 0,1),void 0,Lbe.bind(void 0,0),Lbe.bind(void 0,1),_Tt,void 0,TTt,void 0,void 0,wTt,STt,MTt,ATt,RTt,CTt,PTt,ITt,OTt,DTt,LTt,kTt,FTt,q8.bind(void 0,1),BTt,NTt,UTt,HTt,VTt,zTt,GTt,qTt,jTt,WTt,T3.bind(void 0,0),T3.bind(void 0,1),T3.bind(void 0,2),T3.bind(void 0,3),void 0,void 0,void 0,void 0,XTt,q8.bind(void 0,2),q8.bind(void 0,3),j8.bind(void 0,1),j8.bind(void 0,2),j8.bind(void 0,3),YTt,$Tt,void 0,void 0,ZTt,void 0,KTt,JTt,G8,G8,void 0,void 0,void 0,void 0,void 0,QTt,kbe.bind(void 0,0),kbe.bind(void 0,1),ewt,void 0,twt,rwt,nwt,iwt,swt,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Hp.bind(void 0,1),Hp.bind(void 0,2),Hp.bind(void 0,3),Hp.bind(void 0,4),Hp.bind(void 0,5),Hp.bind(void 0,6),Hp.bind(void 0,7),Hp.bind(void 0,8),Vp.bind(void 0,1),Vp.bind(void 0,2),Vp.bind(void 0,3),Vp.bind(void 0,4),Vp.bind(void 0,5),Vp.bind(void 0,6),Vp.bind(void 0,7),Vp.bind(void 0,8),Or.bind(void 0,0,0,0,0,0),Or.bind(void 0,0,0,0,0,1),Or.bind(void 0,0,0,0,0,2),Or.bind(void 0,0,0,0,0,3),Or.bind(void 0,0,0,0,1,0),Or.bind(void 0,0,0,0,1,1),Or.bind(void 0,0,0,0,1,2),Or.bind(void 0,0,0,0,1,3),Or.bind(void 0,0,0,1,0,0),Or.bind(void 0,0,0,1,0,1),Or.bind(void 0,0,0,1,0,2),Or.bind(void 0,0,0,1,0,3),Or.bind(void 0,0,0,1,1,0),Or.bind(void 0,0,0,1,1,1),Or.bind(void 0,0,0,1,1,2),Or.bind(void 0,0,0,1,1,3),Or.bind(void 0,0,1,0,0,0),Or.bind(void 0,0,1,0,0,1),Or.bind(void 0,0,1,0,0,2),Or.bind(void 0,0,1,0,0,3),Or.bind(void 0,0,1,0,1,0),Or.bind(void 0,0,1,0,1,1),Or.bind(void 0,0,1,0,1,2),Or.bind(void 0,0,1,0,1,3),Or.bind(void 0,0,1,1,0,0),Or.bind(void 0,0,1,1,0,1),Or.bind(void 0,0,1,1,0,2),Or.bind(void 0,0,1,1,0,3),Or.bind(void 0,0,1,1,1,0),Or.bind(void 0,0,1,1,1,1),Or.bind(void 0,0,1,1,1,2),Or.bind(void 0,0,1,1,1,3),Or.bind(void 0,1,0,0,0,0),Or.bind(void 0,1,0,0,0,1),Or.bind(void 0,1,0,0,0,2),Or.bind(void 0,1,0,0,0,3),Or.bind(void 0,1,0,0,1,0),Or.bind(void 0,1,0,0,1,1),Or.bind(void 0,1,0,0,1,2),Or.bind(void 0,1,0,0,1,3),Or.bind(void 0,1,0,1,0,0),Or.bind(void 0,1,0,1,0,1),Or.bind(void 0,1,0,1,0,2),Or.bind(void 0,1,0,1,0,3),Or.bind(void 0,1,0,1,1,0),Or.bind(void 0,1,0,1,1,1),Or.bind(void 0,1,0,1,1,2),Or.bind(void 0,1,0,1,1,3),Or.bind(void 0,1,1,0,0,0),Or.bind(void 0,1,1,0,0,1),Or.bind(void 0,1,1,0,0,2),Or.bind(void 0,1,1,0,0,3),Or.bind(void 0,1,1,0,1,0),Or.bind(void 0,1,1,0,1,1),Or.bind(void 0,1,1,0,1,2),Or.bind(void 0,1,1,0,1,3),Or.bind(void 0,1,1,1,0,0),Or.bind(void 0,1,1,1,0,1),Or.bind(void 0,1,1,1,0,2),Or.bind(void 0,1,1,1,0,3),Or.bind(void 0,1,1,1,1,0),Or.bind(void 0,1,1,1,1,1),Or.bind(void 0,1,1,1,1,2),Or.bind(void 0,1,1,1,1,3)],j1.prototype.setState=function(e,t){return this.state[e]=t,this.activeState={key:e,value:this.state[e]},this.activeState},j1.prototype.getState=function(e){return this.state[e]||null},Ls.prototype.inboundIndex=function(e){return e>=0&&e<this.tokens.length},Ls.prototype.composeRUD=function(e){var t=this,r=e.map((function(e){return t[e[0]].apply(t,e.slice(1).concat(true))})),i=function(e){return"object"==typeof e&&e.hasOwnProperty("FAIL")};if(r.every(i))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:r.filter(i)};this.dispatch("composeRUD",[r.filter((function(e){return!i(e)}))])},Ls.prototype.replaceRange=function(e,t,r,i){t=null!==t?t:this.tokens.length;var n=r.every((function(e){return e instanceof j1}));if(!isNaN(e)&&this.inboundIndex(e)&&n){var a=this.tokens.splice.apply(this.tokens,[e,t].concat(r));return i||this.dispatch("replaceToken",[e,t,r]),[a,r]}return{FAIL:"replaceRange: invalid tokens or startIndex."}},Ls.prototype.replaceToken=function(e,t,r){if(!isNaN(e)&&this.inboundIndex(e)&&t instanceof j1){var i=this.tokens.splice(e,1,t);return r||this.dispatch("replaceToken",[e,t]),[i[0],t]}return{FAIL:"replaceToken: invalid token or index."}},Ls.prototype.removeRange=function(e,t,r){t=isNaN(t)?this.tokens.length:t;var i=this.tokens.splice(e,t);return r||this.dispatch("removeRange",[i,e,t]),i},Ls.prototype.removeToken=function(e,t){if(!isNaN(e)&&this.inboundIndex(e)){var r=this.tokens.splice(e,1);return t||this.dispatch("removeToken",[r,e]),r}return{FAIL:"removeToken: invalid token index."}},Ls.prototype.insertToken=function(e,t,r){return e.every((function(e){return e instanceof j1}))?(this.tokens.splice.apply(this.tokens,[t,0].concat(e)),r||this.dispatch("insertToken",[e,t]),e):{FAIL:"insertToken: invalid token(s)."}},Ls.prototype.registerModifier=function(e,t,r){this.events.newToken.subscribe((function(i,n){var a=[i,n],s=[i,n];if(null===t||!0===t.apply(this,a)){var o=r.apply(this,s);i.setState(e,o)}})),this.registeredModifiers.push(e)},D3.prototype.subscribe=function(e){return"function"==typeof e?this.subscribers.push(e)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},D3.prototype.unsubscribe=function(e){this.subscribers.splice(e,1)},Mu.prototype.setCurrentIndex=function(e){this.index=e,this.current=this.context[e],this.backtrack=this.context.slice(0,e),this.lookahead=this.context.slice(e+1)},Mu.prototype.get=function(e){switch(!0){case 0===e:return this.current;case e<0&&Math.abs(e)<=this.backtrack.length:return this.backtrack.slice(e)[0];case e>0&&e<=this.lookahead.length:return this.lookahead[e-1];default:return null}},Ls.prototype.rangeToText=function(e){if(e instanceof hz)return this.getRangeTokens(e).map((function(e){return e.char})).join("")},Ls.prototype.getText=function(){return this.tokens.map((function(e){return e.char})).join("")},Ls.prototype.getContext=function(e){return this.registeredContexts[e]||null},Ls.prototype.on=function(e,t){var r=this.events[e];return r?r.subscribe(t):null},Ls.prototype.dispatch=function(e,t){var r=this,i=this.events[e];i instanceof D3&&i.subscribers.forEach((function(e){e.apply(r,t||[])}))},Ls.prototype.registerContextChecker=function(e,t,r){if(this.getContext(e))return{FAIL:"context name '"+e+"' is already registered."};if("function"!=typeof t)return{FAIL:"missing context start check."};if("function"!=typeof r)return{FAIL:"missing context end check."};var i=new awt(e,t,r);return this.registeredContexts[e]=i,this.contextCheckers.push(i),i},Ls.prototype.getRangeTokens=function(e){var t=e.startIndex+e.endOffset;return[].concat(this.tokens.slice(e.startIndex,t))},Ls.prototype.getContextRanges=function(e){var t=this.getContext(e);return t?t.ranges:{FAIL:"context checker '"+e+"' is not registered."}},Ls.prototype.resetContextsRanges=function(){var e=this.registeredContexts;for(var t in e)if(e.hasOwnProperty(t)){e[t].ranges=[]}},Ls.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var e=this.tokens.map((function(e){return e.char})),t=0;t<e.length;t++){var r=new Mu(e,t);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])},Ls.prototype.setEndOffset=function(e,t){var r=new hz(this.getContext(t).openRange.startIndex,e,t),i=this.getContext(t).ranges;return r.rangeId=t+"."+i.length,i.push(r),this.getContext(t).openRange=null,r},Ls.prototype.runContextCheck=function(e){var t=this,r=e.index;this.contextCheckers.forEach((function(i){var n=i.contextName,a=t.getContext(n).openRange;if(!a&&i.checkStart(e)&&(a=new hz(r,null,n),t.getContext(n).openRange=a,t.dispatch("contextStart",[n,r])),a&&i.checkEnd(e)){var s=r-a.startIndex+1,o=t.setEndOffset(s,n);t.dispatch("contextEnd",[n,o])}}))},Ls.prototype.tokenize=function(e){this.tokens=[],this.resetContextsRanges();var t=Array.from(e);this.dispatch("start");for(var r=0;r<t.length;r++){var i=t[r],n=new Mu(t,r);this.dispatch("next",[n]),this.runContextCheck(n);var a=new j1(i);this.tokens.push(a),this.dispatch("newToken",[a,n])}return this.dispatch("end",[this.tokens]),this.tokens},Ll.prototype.getDefaultScriptFeaturesIndexes=function(){for(var e=this.font.tables.gsub.scripts,t=0;t<e.length;t++){var r=e[t];if("DFLT"===r.tag)return r.script.defaultLangSys.featureIndexes}return[]},Ll.prototype.getScriptFeaturesIndexes=function(e){if(!this.font.tables.gsub)return[];if(!e)return this.getDefaultScriptFeaturesIndexes();for(var t=this.font.tables.gsub.scripts,r=0;r<t.length;r++){var i=t[r];if(i.tag===e&&i.script.defaultLangSys)return i.script.defaultLangSys.featureIndexes;var n=i.langSysRecords;if(n)for(var a=0;a<n.length;a++){var s=n[a];if(s.tag===e)return s.langSys.featureIndexes}}return this.getDefaultScriptFeaturesIndexes()},Ll.prototype.mapTagsToFeatures=function(e,t){for(var r={},i=0;i<e.length;i++){var n=e[i].tag,a=e[i].feature;r[n]=a}this.features[t].tags=r},Ll.prototype.getScriptFeatures=function(e){var t=this.features[e];if(this.features.hasOwnProperty(e))return t;var r=this.getScriptFeaturesIndexes(e);if(!r)return null;var i=this.font.tables.gsub;return t=r.map((function(e){return i.features[e]})),this.features[e]=t,this.mapTagsToFeatures(t,e),t},Ll.prototype.getSubstitutionType=function(e,t){return e.lookupType.toString()+t.substFormat.toString()},Ll.prototype.getLookupMethod=function(e,t){var r=this;switch(this.getSubstitutionType(e,t)){case"11":return function(e){return cwt.apply(r,[e,t])};case"12":return function(e){return uwt.apply(r,[e,t])};case"63":return function(e){return hwt.apply(r,[e,t])};case"41":return function(e){return dwt.apply(r,[e,t])};case"21":return function(e){return fwt.apply(r,[e,t])};default:throw new Error("lookupType: "+e.lookupType+" - substFormat: "+t.substFormat+" is not yet supported")}},Ll.prototype.lookupFeature=function(e){var t=e.contextParams,r=t.index,i=this.getFeature({tag:e.tag,script:e.script});if(!i)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+e.tag+"' for script '"+e.script+"'.");for(var n=this.getFeatureLookups(i),a=[].concat(t.context),s=0;s<n.length;s++)for(var o=n[s],l=this.getLookupSubtables(o),h=0;h<l.length;h++){var c=l[h],u=this.getSubstitutionType(o,c),d=this.getLookupMethod(o,c),p=void 0;switch(u){case"11":(p=d(t.current))&&a.splice(r,1,new p0({id:11,tag:e.tag,substitution:p}));break;case"12":(p=d(t.current))&&a.splice(r,1,new p0({id:12,tag:e.tag,substitution:p}));break;case"63":p=d(t),Array.isArray(p)&&p.length&&a.splice(r,1,new p0({id:63,tag:e.tag,substitution:p}));break;case"41":(p=d(t))&&a.splice(r,1,new p0({id:41,tag:e.tag,substitution:p}));break;case"21":(p=d(t.current))&&a.splice(r,1,new p0({id:21,tag:e.tag,substitution:p}))}t=new Mu(a,r),(!Array.isArray(p)||p.length)&&(p=null)}return a.length?a:null},Ll.prototype.supports=function(e){if(!e.script)return!1;this.getScriptFeatures(e.script);var t=this.features.hasOwnProperty(e.script);if(!e.tag)return t;var r=this.features[e.script].some((function(t){return t.tag===e.tag}));return t&&r},Ll.prototype.getLookupSubtables=function(e){return e.subtables||null},Ll.prototype.getLookupByIndex=function(e){return this.font.tables.gsub.lookups[e]||null},Ll.prototype.getFeatureLookups=function(e){return e.lookupListIndexes.map(this.getLookupByIndex.bind(this))},Ll.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var t=this.features[e.script];return t?t.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};var gwt={startCheck:pwt,endCheck:mwt};function vwt(e){var t=e.current,r=e.get(-1);return(qp(t)||jp(t))&&!qp(r)}function ywt(e){var t=e.get(1);switch(!0){case null===t:return!0;case!qp(t)&&!jp(t):var r=lwt(t);if(!r)return!0;if(r){if(!e.lookahead.some((function(e){return qp(e)||jp(e)})))return!0}break;default:return!1}}var bwt={startCheck:vwt,endCheck:ywt};function xwt(e,t,r){t[r].setState(e.tag,e.substitution)}function Ewt(e,t,r){t[r].setState(e.tag,e.substitution)}function _wt(e,t,r){e.substitution.forEach((function(i,n){t[r+n].setState(e.tag,i)}))}function Twt(e,t,r){var i=t[r];i.setState(e.tag,e.substitution.ligGlyph);for(var n=e.substitution.components.length,a=0;a<n;a++)(i=t[r+a+1]).setState("deleted",!0)}var Fbe={11:xwt,12:Ewt,63:_wt,41:Twt};function dz(e,t,r){e instanceof p0&&Fbe[e.id]&&Fbe[e.id](e,t,r)}function wwt(e){for(var t=[].concat(e.backtrack),r=t.length-1;r>=0;r--){var i=t[r],n=Pxe(i),a=jp(i);if(!n&&!a)return!0;if(n)return!1}return!1}function Swt(e){if(Pxe(e.current))return!1;for(var t=0;t<e.lookahead.length;t++){if(!jp(e.lookahead[t]))return!0}return!1}function Mwt(e){var t=this,r="arab",i=this.featuresTags[r],n=this.tokenizer.getRangeTokens(e);if(1!==n.length){var a=new Mu(n.map((function(e){return e.getState("glyphIndex")})),0),s=new Mu(n.map((function(e){return e.char})),0);n.forEach((function(e,o){if(!jp(e.char)){a.setCurrentIndex(o),s.setCurrentIndex(o);var l,h=0;switch(wwt(s)&&(h|=1),Swt(s)&&(h|=2),h){case 1:l="fina";break;case 2:l="init";break;case 3:l="medi"}if(-1!==i.indexOf(l)){var c=t.query.lookupFeature({tag:l,script:r,contextParams:a});if(c instanceof Error)return console.info(c.message);c.forEach((function(e,t){e instanceof p0&&(dz(e,n,t),a.context[t]=e.substitution)}))}}}))}}function Bbe(e,t){return new Mu(e.map((function(e){return e.activeState.value})),t||0)}function Awt(e){var t=this,r=this.tokenizer.getRangeTokens(e),i=Bbe(r);i.context.forEach((function(e,n){i.setCurrentIndex(n);var a=t.query.lookupFeature({tag:"rlig",script:"arab",contextParams:i});a.length&&(a.forEach((function(e){return dz(e,r,n)})),i=Bbe(r))}))}function Rwt(e){var t=e.current,r=e.get(-1);return null===r&&S3(t)||!S3(r)&&S3(t)}function Cwt(e){var t=e.get(1);return null===t||!S3(t)}var Pwt={startCheck:Rwt,endCheck:Cwt};function Nbe(e,t){return new Mu(e.map((function(e){return e.activeState.value})),t||0)}function Iwt(e){var t=this,r=this.tokenizer.getRangeTokens(e),i=Nbe(r);i.context.forEach((function(e,n){i.setCurrentIndex(n);var a=t.query.lookupFeature({tag:"liga",script:"latn",contextParams:i});a.length&&(a.forEach((function(e){return dz(e,r,n)})),i=Nbe(r))}))}function Cu(e){this.baseDir=e||"ltr",this.tokenizer=new Ls,this.featuresTags={}}function X8(e){var t=this.contextChecks[e+"Check"];return this.tokenizer.registerContextChecker(e,t.startCheck,t.endCheck)}function Owt(){return X8.call(this,"latinWord"),X8.call(this,"arabicWord"),X8.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function Dwt(){var e=this;this.tokenizer.getContextRanges("arabicSentence").forEach((function(t){var r=e.tokenizer.getRangeTokens(t);e.tokenizer.replaceRange(t.startIndex,t.endOffset,r.reverse())}))}function fz(){if(-1===this.tokenizer.registeredModifiers.indexOf("glyphIndex"))throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function Lwt(){var e=this;this.featuresTags.hasOwnProperty("arab")&&(fz.call(this),this.tokenizer.getContextRanges("arabicWord").forEach((function(t){Mwt.call(e,t)})))}function kwt(){var e=this,t="arab";this.featuresTags.hasOwnProperty(t)&&(-1!==this.featuresTags[t].indexOf("rlig")&&(fz.call(this),this.tokenizer.getContextRanges("arabicWord").forEach((function(t){Awt.call(e,t)}))))}function Fwt(){var e=this,t="latn";this.featuresTags.hasOwnProperty(t)&&(-1!==this.featuresTags[t].indexOf("liga")&&(fz.call(this),this.tokenizer.getContextRanges("latinWord").forEach((function(t){Iwt.call(e,t)}))))}function Ji(e){(e=e||{}).tables=e.tables||{},e.empty||(_T(e.familyName,"When creating a new Font object, familyName is required."),_T(e.styleName,"When creating a new Font object, styleName is required."),_T(e.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),_T(e.ascender,"When creating a new Font object, ascender is required."),_T(e.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:e.familyName||" "},fontSubfamily:{en:e.styleName||" "},fullName:{en:e.fullName||e.familyName+" "+e.styleName},postScriptName:{en:e.postScriptName||(e.familyName+e.styleName).replace(/\s/g,"")},designer:{en:e.designer||" "},designerURL:{en:e.designerURL||" "},manufacturer:{en:e.manufacturer||" "},manufacturerURL:{en:e.manufacturerURL||" "},license:{en:e.license||" "},licenseURL:{en:e.licenseURL||" "},version:{en:e.version||"Version 0.1"},description:{en:e.description||" "},copyright:{en:e.copyright||" "},trademark:{en:e.trademark||" "}},this.unitsPerEm=e.unitsPerEm||1e3,this.ascender=e.ascender,this.descender=e.descender,this.createdTimestamp=e.createdTimestamp,this.tables=Object.assign(e.tables,{os2:Object.assign({usWeightClass:e.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:e.widthClass||this.usWidthClasses.MEDIUM,fsSelection:e.fsSelection||this.fsSelectionValues.REGULAR},e.tables.os2)})),this.supported=!0,this.glyphs=new Vh.GlyphSet(this,e.glyphs||[]),this.encoding=new $be(this),this.position=new CT(this),this.substitution=new Dl(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){return this._hinting?this._hinting:"truetype"===this.outlinesFormat?this._hinting=new Mxe(this):void 0}})}function Ixe(e,t){var r=JSON.stringify(e),i=256;for(var n in t){var a=parseInt(n);if(a&&!(a<256)){if(JSON.stringify(t[n])===r)return a;i<=a&&(i=a+1)}}return t[i]=e,i}function Bwt(e,t,r){var i=Ixe(t.name,r);return[{name:"tag_"+e,type:"TAG",value:t.tag},{name:"minValue_"+e,type:"FIXED",value:t.minValue<<16},{name:"defaultValue_"+e,type:"FIXED",value:t.defaultValue<<16},{name:"maxValue_"+e,type:"FIXED",value:t.maxValue<<16},{name:"flags_"+e,type:"USHORT",value:0},{name:"nameID_"+e,type:"USHORT",value:i}]}function Nwt(e,t,r){var i={},n=new Dr.Parser(e,t);return i.tag=n.parseTag(),i.minValue=n.parseFixed(),i.defaultValue=n.parseFixed(),i.maxValue=n.parseFixed(),n.skip("uShort",1),i.name=r[n.parseUShort()]||{},i}function Uwt(e,t,r,i){for(var n=[{name:"nameID_"+e,type:"USHORT",value:Ixe(t.name,i)},{name:"flags_"+e,type:"USHORT",value:0}],a=0;a<r.length;++a){var s=r[a].tag;n.push({name:"axis_"+e+" "+s,type:"FIXED",value:t.coordinates[s]<<16})}return n}function Hwt(e,t,r,i){var n={},a=new Dr.Parser(e,t);n.name=i[a.parseUShort()]||{},a.skip("uShort",1),n.coordinates={};for(var s=0;s<r.length;++s)n.coordinates[r[s].tag]=a.parseFixed();return n}function Vwt(e,t){var r=new wr.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:e.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:e.instances.length},{name:"instanceSize",type:"USHORT",value:4+4*e.axes.length}]);r.offsetToData=r.sizeOf();for(var i=0;i<e.axes.length;i++)r.fields=r.fields.concat(Bwt(i,e.axes[i],t));for(var n=0;n<e.instances.length;n++)r.fields=r.fields.concat(Uwt(n,e.instances[n],e.axes,t));return r}function zwt(e,t,r){var i=new Dr.Parser(e,t),n=i.parseULong();cn.argument(65536===n,"Unsupported fvar table version.");var a=i.parseOffset16();i.skip("uShort",1);for(var s=i.parseUShort(),o=i.parseUShort(),l=i.parseUShort(),h=i.parseUShort(),c=[],u=0;u<s;u++)c.push(Nwt(e,t+a+u*o,r));for(var d=[],p=t+a+s*o,f=0;f<l;f++)d.push(Hwt(e,p+f*h,c,r));return{axes:c,instances:d}}Cu.prototype.setText=function(e){this.text=e},Cu.prototype.contextChecks={latinWordCheck:Pwt,arabicWordCheck:gwt,arabicSentenceCheck:bwt},Cu.prototype.registerFeatures=function(e,t){var r=this,i=t.filter((function(t){return r.query.supports({script:e,tag:t})}));this.featuresTags.hasOwnProperty(e)?this.featuresTags[e]=this.featuresTags[e].concat(i):this.featuresTags[e]=i},Cu.prototype.applyFeatures=function(e,t){if(!e)throw new Error("No valid font was provided to apply features");this.query||(this.query=new Ll(e));for(var r=0;r<t.length;r++){var i=t[r];this.query.supports({script:i.script})&&this.registerFeatures(i.script,i.tags)}},Cu.prototype.registerModifier=function(e,t,r){this.tokenizer.registerModifier(e,t,r)},Cu.prototype.checkContextReady=function(e){return!!this.tokenizer.getContext(e)},Cu.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(Lwt.call(this),kwt.call(this)),this.checkContextReady("latinWord")&&Fwt.call(this),this.checkContextReady("arabicSentence")&&Dwt.call(this)},Cu.prototype.processText=function(e){(!this.text||this.text!==e)&&(this.setText(e),Owt.call(this),this.applyFeaturesToContexts())},Cu.prototype.getBidiText=function(e){return this.processText(e),this.tokenizer.getText()},Cu.prototype.getTextGlyphs=function(e){this.processText(e);for(var t=[],r=0;r<this.tokenizer.tokens.length;r++){var i=this.tokenizer.tokens[r];if(!i.state.deleted){var n=i.activeState.value;t.push(Array.isArray(n)?n[0]:n)}}return t},Ji.prototype.hasChar=function(e){return null!==this.encoding.charToGlyphIndex(e)},Ji.prototype.charToGlyphIndex=function(e){return this.encoding.charToGlyphIndex(e)},Ji.prototype.charToGlyph=function(e){var t=this.charToGlyphIndex(e),r=this.glyphs.get(t);return r||(r=this.glyphs.get(0)),r},Ji.prototype.updateFeatures=function(e){return this.defaultRenderOptions.features.map((function(t){return"latn"===t.script?{script:"latn",tags:t.tags.filter((function(t){return e[t]}))}:t}))},Ji.prototype.stringToGlyphs=function(e,t){var r=this,i=new Cu;i.registerModifier("glyphIndex",null,(function(e){return r.charToGlyphIndex(e.char)}));var n=t?this.updateFeatures(t.features):this.defaultRenderOptions.features;i.applyFeatures(this,n);for(var a=i.getTextGlyphs(e),s=a.length,o=new Array(s),l=this.glyphs.get(0),h=0;h<s;h+=1)o[h]=this.glyphs.get(a[h])||l;return o},Ji.prototype.nameToGlyphIndex=function(e){return this.glyphNames.nameToGlyphIndex(e)},Ji.prototype.nameToGlyph=function(e){var t=this.nameToGlyphIndex(e),r=this.glyphs.get(t);return r||(r=this.glyphs.get(0)),r},Ji.prototype.glyphIndexToName=function(e){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(e):""},Ji.prototype.getKerningValue=function(e,t){e=e.index||e,t=t.index||t;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,e,t):this.kerningPairs[e+","+t]||0},Ji.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},Ji.prototype.forEachGlyph=function(e,t,r,i,n,a){t=void 0!==t?t:0,r=void 0!==r?r:0,i=void 0!==i?i:72,n=Object.assign({},this.defaultRenderOptions,n);var s,o=1/this.unitsPerEm*i,l=this.stringToGlyphs(e,n);if(n.kerning){var h=n.script||this.position.getDefaultScriptName();s=this.position.getKerningTables(h,n.language)}for(var c=0;c<l.length;c+=1){var u=l[c];if(a.call(this,u,t,r,i,n),u.advanceWidth&&(t+=u.advanceWidth*o),n.kerning&&c<l.length-1)t+=(s?this.position.getKerningValue(s,u.index,l[c+1].index):this.getKerningValue(u,l[c+1]))*o;n.letterSpacing?t+=n.letterSpacing*i:n.tracking&&(t+=n.tracking/1e3*i)}return t},Ji.prototype.getPath=function(e,t,r,i,n){var a=new ca;return this.forEachGlyph(e,t,r,i,n,(function(e,t,r,i){var s=e.getPath(t,r,i,n,this);a.extend(s)})),a},Ji.prototype.getPaths=function(e,t,r,i,n){var a=[];return this.forEachGlyph(e,t,r,i,n,(function(e,t,r,i){var s=e.getPath(t,r,i,n,this);a.push(s)})),a},Ji.prototype.getAdvanceWidth=function(e,t,r){return this.forEachGlyph(e,0,0,t,r,(function(){}))},Ji.prototype.draw=function(e,t,r,i,n,a){this.getPath(t,r,i,n,a).draw(e)},Ji.prototype.drawPoints=function(e,t,r,i,n,a){this.forEachGlyph(t,r,i,n,a,(function(t,r,i,n){t.drawPoints(e,r,i,n)}))},Ji.prototype.drawMetrics=function(e,t,r,i,n,a){this.forEachGlyph(t,r,i,n,a,(function(t,r,i,n){t.drawMetrics(e,r,i,n)}))},Ji.prototype.getEnglishName=function(e){var t=this.names[e];if(t)return t.en},Ji.prototype.validate=function(){var e=this;function t(t){var r=e.getEnglishName(t);r&&r.trim().length}t("fontFamily"),t("weightName"),t("manufacturer"),t("copyright"),t("version"),this.unitsPerEm},Ji.prototype.toTables=function(){return T_t.fontToTable(this)},Ji.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},Ji.prototype.toArrayBuffer=function(){for(var e=this.toTables().encode(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),i=0;i<e.length;i++)r[i]=e[i];return t},Ji.prototype.download=function(e){var t=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");e=e||t.replace(/\s/g,"")+"-"+r+".otf";var i=this.toArrayBuffer();if(S_t())if(window.URL=window.URL||window.webkitURL,window.URL){var n=new DataView(i),a=new Blob([n],{type:"font/opentype"}),s=document.createElement("a");s.href=window.URL.createObjectURL(a),s.download=e;var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!1),s.dispatchEvent(o)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var l=y3(),h=M_t(i);l.writeFileSync(e,h)}},Ji.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},Ji.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},Ji.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var Gwt={make:Vwt,parse:zwt},qwt=function(){return{coverage:this.parsePointer(It.coverage),attachPoints:this.parseList(It.pointer(It.uShortList))}},jwt=function(){var e=this.parseUShort();return cn.argument(1===e||2===e||3===e,"Unsupported CaretValue table version."),1===e?{coordinate:this.parseShort()}:2===e?{pointindex:this.parseShort()}:3===e?{coordinate:this.parseShort()}:void 0},Wwt=function(){return this.parseList(It.pointer(jwt))},Xwt=function(){return{coverage:this.parsePointer(It.coverage),ligGlyphs:this.parseList(It.pointer(Wwt))}},Ywt=function(){return this.parseUShort(),this.parseList(It.pointer(It.coverage))};function $wt(e,t){var r=new It(e,t=t||0),i=r.parseVersion(1);cn.argument(1===i||1.2===i||1.3===i,"Unsupported GDEF table version.");var n={version:i,classDef:r.parsePointer(It.classDef),attachList:r.parsePointer(qwt),ligCaretList:r.parsePointer(Xwt),markAttachClassDef:r.parsePointer(It.classDef)};return i>=1.2&&(n.markGlyphSets=r.parsePointer(Ywt)),n}var Zwt={parse:$wt},Au=new Array(10);function Kwt(e,t){var r=new It(e,t=t||0),i=r.parseVersion(1);return cn.argument(1===i||1.1===i,"Unsupported GPOS table version "+i),1===i?{version:i,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Au)}:{version:i,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Au),variations:r.parseFeatureVariationsList()}}Au[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{posFormat:1,coverage:this.parsePointer(It.coverage),value:this.parseValueRecord()}:2===t?{posFormat:2,coverage:this.parsePointer(It.coverage),values:this.parseValueRecordList()}:void cn.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},Au[2]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();cn.assert(1===t||2===t,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var r=this.parsePointer(It.coverage),i=this.parseUShort(),n=this.parseUShort();if(1===t)return{posFormat:t,coverage:r,valueFormat1:i,valueFormat2:n,pairSets:this.parseList(It.pointer(It.list((function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(i),value2:this.parseValueRecord(n)}}))))};if(2===t){var a=this.parsePointer(It.classDef),s=this.parsePointer(It.classDef),o=this.parseUShort(),l=this.parseUShort();return{posFormat:t,coverage:r,valueFormat1:i,valueFormat2:n,classDef1:a,classDef2:s,class1Count:o,class2Count:l,classRecords:this.parseList(o,It.list(l,(function(){return{value1:this.parseValueRecord(i),value2:this.parseValueRecord(n)}})))}}},Au[3]=function(){return{error:"GPOS Lookup 3 not supported"}},Au[4]=function(){return{error:"GPOS Lookup 4 not supported"}},Au[5]=function(){return{error:"GPOS Lookup 5 not supported"}},Au[6]=function(){return{error:"GPOS Lookup 6 not supported"}},Au[7]=function(){return{error:"GPOS Lookup 7 not supported"}},Au[8]=function(){return{error:"GPOS Lookup 8 not supported"}},Au[9]=function(){return{error:"GPOS Lookup 9 not supported"}};var Jwt=new Array(10);function Qwt(e){return new wr.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new wr.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new wr.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new wr.LookupList(e.lookups,Jwt)}])}var eSt={parse:Kwt,make:Qwt};function tSt(e){var t={};e.skip("uShort");var r=e.parseUShort();cn.argument(0===r,"Unsupported kern sub-table version."),e.skip("uShort",2);var i=e.parseUShort();e.skip("uShort",3);for(var n=0;n<i;n+=1){var a=e.parseUShort(),s=e.parseUShort(),o=e.parseShort();t[a+","+s]=o}return t}function rSt(e){var t={};e.skip("uShort"),e.parseULong()>1&&console.warn("Only the first kern subtable is supported."),e.skip("uLong");var r=255&e.parseUShort();if(e.skip("uShort"),0===r){var i=e.parseUShort();e.skip("uShort",3);for(var n=0;n<i;n+=1){var a=e.parseUShort(),s=e.parseUShort(),o=e.parseShort();t[a+","+s]=o}}return t}function nSt(e,t){var r=new Dr.Parser(e,t),i=r.parseUShort();if(0===i)return tSt(r);if(1===i)return rSt(r);throw new Error("Unsupported kern table version ("+i+").")}var iSt={parse:nSt};function sSt(e,t,r,i){for(var n=new Dr.Parser(e,t),a=i?n.parseUShort:n.parseULong,s=[],o=0;o<r+1;o+=1){var l=a.call(n);i&&(l*=2),s.push(l)}return s}var aSt={parse:sSt};function Ube(e,t){for(var r=[],i=12,n=0;n<t;n+=1){var a=Dr.getTag(e,i),s=Dr.getULong(e,i+4),o=Dr.getULong(e,i+8),l=Dr.getULong(e,i+12);r.push({tag:a,checksum:s,offset:o,length:l,compression:!1}),i+=16}return r}function oSt(e,t){for(var r=[],i=44,n=0;n<t;n+=1){var a=Dr.getTag(e,i),s=Dr.getULong(e,i+4),o=Dr.getULong(e,i+8),l=Dr.getULong(e,i+12),h=void 0;h=o<l&&"WOFF",r.push({tag:a,offset:s,compression:h,compressedLength:o,length:l}),i+=20}return r}function Hs(e,t){if("WOFF"===t.compression){var r=new Uint8Array(e.buffer,t.offset+2,t.compressedLength-2),i=new Uint8Array(t.length);if(eEt(r,i),i.byteLength!==t.length)throw new Error("Decompression error: "+t.tag+" decompressed length doesn't match recorded length");return{data:new DataView(i.buffer,0),offset:0}}return{data:e,offset:t.offset}}function Oxe(e,t){t=null==t?{}:t;var r,i,n,a=new Ji({empty:!0}),s=new DataView(e,0),o=[],l=Dr.getTag(s,0);if(l===String.fromCharCode(0,1,0,0)||"true"===l||"typ1"===l)a.outlinesFormat="truetype",o=Ube(s,n=Dr.getUShort(s,4));else if("OTTO"===l)a.outlinesFormat="cff",o=Ube(s,n=Dr.getUShort(s,4));else{if("wOFF"!==l)throw new Error("Unsupported OpenType signature "+l);var h=Dr.getTag(s,4);if(h===String.fromCharCode(0,1,0,0))a.outlinesFormat="truetype";else{if("OTTO"!==h)throw new Error("Unsupported OpenType flavor "+l);a.outlinesFormat="cff"}o=oSt(s,n=Dr.getUShort(s,12))}for(var c,u,d,p,f,m,g,v,y,b,x,_,w=0;w<n;w+=1){var S=o[w],T=void 0;switch(S.tag){case"cmap":T=Hs(s,S),a.tables.cmap=Ybe.parse(T.data,T.offset),a.encoding=new Zbe(a.tables.cmap);break;case"cvt ":T=Hs(s,S),_=new Dr.Parser(T.data,T.offset),a.tables.cvt=_.parseShortList(S.length/2);break;case"fvar":u=S;break;case"fpgm":T=Hs(s,S),_=new Dr.Parser(T.data,T.offset),a.tables.fpgm=_.parseByteList(S.length);break;case"head":T=Hs(s,S),a.tables.head=axe.parse(T.data,T.offset),a.unitsPerEm=a.tables.head.unitsPerEm,r=a.tables.head.indexToLocFormat;break;case"hhea":T=Hs(s,S),a.tables.hhea=oxe.parse(T.data,T.offset),a.ascender=a.tables.hhea.ascender,a.descender=a.tables.hhea.descender,a.numberOfHMetrics=a.tables.hhea.numberOfHMetrics;break;case"hmtx":g=S;break;case"ltag":T=Hs(s,S),i=cxe.parse(T.data,T.offset);break;case"maxp":T=Hs(s,S),a.tables.maxp=uxe.parse(T.data,T.offset),a.numGlyphs=a.tables.maxp.numGlyphs;break;case"name":b=S;break;case"OS/2":T=Hs(s,S),a.tables.os2=tz.parse(T.data,T.offset);break;case"post":T=Hs(s,S),a.tables.post=gxe.parse(T.data,T.offset),a.glyphNames=new oz(a.tables.post);break;case"prep":T=Hs(s,S),_=new Dr.Parser(T.data,T.offset),a.tables.prep=_.parseByteList(S.length);break;case"glyf":d=S;break;case"loca":y=S;break;case"CFF ":c=S;break;case"kern":v=S;break;case"GDEF":p=S;break;case"GPOS":f=S;break;case"GSUB":m=S;break;case"meta":x=S}}var M=Hs(s,b);if(a.tables.name=mxe.parse(M.data,M.offset,i),a.names=a.tables.name,d&&y){var E=0===r,A=Hs(s,y),C=aSt.parse(A.data,A.offset,a.numGlyphs,E),P=Hs(s,d);a.glyphs=Txe.parse(P.data,P.offset,C,a,t)}else{if(!c)throw new Error("Font doesn't contain TrueType or CFF outlines.");var R=Hs(s,c);sxe.parse(R.data,R.offset,a,t)}var I=Hs(s,g);if(lxe.parse(a,I.data,I.offset,a.numberOfHMetrics,a.numGlyphs,a.glyphs,t),EEt(a,t),v){var O=Hs(s,v);a.kerningPairs=iSt.parse(O.data,O.offset)}else a.kerningPairs={};if(p){var L=Hs(s,p);a.tables.gdef=Zwt.parse(L.data,L.offset)}if(f){var D=Hs(s,f);a.tables.gpos=eSt.parse(D.data,D.offset),a.position.init()}if(m){var k=Hs(s,m);a.tables.gsub=vxe.parse(k.data,k.offset)}if(u){var F=Hs(s,u);a.tables.fvar=Gwt.parse(F.data,F.offset,a.names)}if(x){var N=Hs(s,x);a.tables.meta=yxe.parse(N.data,N.offset),a.metas=a.tables.meta}return a}var L3=class{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100){let r=[],i=lSt(e,t,this.data);for(let e=0,t=i.length;e<t;e++)r.push(...i[e].toShapes());return r}};function lSt(e,t,r){let i=Array.from(e),n=t/r.resolution,a=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*n,s=[],o=0,l=0;for(let e=0;e<i.length;e++){let t=i[e];if("\n"===t)o=0,l-=a;else{let e=cSt(t,n,o,l,r);o+=e.offsetX,s.push(e.path)}}return s}function cSt(e,t,r,i,n){let a=n.glyphs[e]||n.glyphs["?"];if(!a)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+n.familyName+".");let s,o,l,h,c,u,d,p,f=new Xg;if(a.o){let e=a._cachedOutline||(a._cachedOutline=a.o.split(" "));for(let n=0,a=e.length;n<a;)switch(e[n++]){case"m":s=e[n++]*t+r,o=e[n++]*t+i,f.moveTo(s,o);break;case"l":s=e[n++]*t+r,o=e[n++]*t+i,f.lineTo(s,o);break;case"q":l=e[n++]*t+r,h=e[n++]*t+i,c=e[n++]*t+r,u=e[n++]*t+i,f.quadraticCurveTo(c,u,l,h);break;case"b":l=e[n++]*t+r,h=e[n++]*t+i,c=e[n++]*t+r,u=e[n++]*t+i,d=e[n++]*t+r,p=e[n++]*t+i,f.bezierCurveTo(c,u,d,p,l,h)}}return{offsetX:a.ha*t,path:f}}var DT="0.3.0",Dxe="VERSION",uSt=()=>window.localStorage.getItem(Dxe),hSt=()=>{window.localStorage.setItem(Dxe,DT)},Lxe=()=>uSt()!==DT&&(hSt(),!0),W1=class{constructor(){this.DATABASE_NAME="x_viewer",this.DEFAULT_TABLES=[{name:"dxf_data",options:{keyPath:"dxfDataId",autoIncrement:!1}},{name:"fonts",options:{keyPath:"fileName",autoIncrement:!0}}],this.db=void 0,this.tables=this.DEFAULT_TABLES}static instance(){return W1._instance||(W1._instance=new W1),W1._instance}setTables(e){this.tables=e}getTables(){return this.tables}getDatabase(){return bt(this,null,(function*(){let e=yield this.getDB(this.DATABASE_NAME);return this.db||(e.close(),Lxe()&&(yield this.deleteDataBase(this.DATABASE_NAME)),e=yield this.getUpgradedDB(e)),e.onclose=()=>{this.db=void 0,de.debug(`[DB] Db ${e.name} is closed.`)},e.onerror=t=>{this.db=void 0,de.debug(`[DB] Db ${e.name} encountered error.`,t)},e.onabort=t=>{this.db=void 0,de.debug(`[DB] Db ${e.name} aborted.`,t)},e.onversionchange=e=>{de.debug("onversionchange",e)},this.db=e,Promise.resolve(this.db)}))}closeDatabase(){this.db&&this.db.close()}deleteDataBase(e){return new Promise(((t,r)=>{let i=window.indexedDB.deleteDatabase(e);i.onerror=e=>{de.debug(e),r(e)},i.onsuccess=r=>{let i=r.target;de.debug(`[DB] Db ${e} delete old version ${r.oldVersion}.`),t(i)}}))}getDB(e){return bt(this,null,(function*(){return new Promise(((t,r)=>{let i=window.indexedDB.open(e);i.onerror=r,i.onsuccess=e=>{let r=e.target.result;de.debug(`[DB] Db ${r.name} opened (version ${r.version}).`),t(r)}}))}))}getUpgradedDB(e){return bt(this,null,(function*(){return new Promise(((t,r)=>{de.debug(`[DB] Upgrading db ${e.name} (version ${e.version})`);let i=window.indexedDB.open(e.name,e.version+1);i.onerror=r,i.onblocked=e=>{de.debug("onblocked",e)},i.onupgradeneeded=e=>{e.target.transaction.oncomplete=()=>{de.debug(`[DB] Upgrade is done (new version: ${t.version}).`)};let t=e.target.result,r=[];for(let e=0;e<this.tables.length;++e){let i=this.tables[e];if(!t.objectStoreNames.contains(i.name)){de.debug(`[DB] Creating table ${i.name}...`);let e=this.createTable(t,i.name,i.options,i.indexArray);r.push(e)}}r.length>0&&Promise.all(r).then((()=>{de.debug(`[DB] All(${r.length}) tables created.`)}))},i.onsuccess=e=>{let r=e.target.result;de.debug(`[DB] Db ${r.name} opened (version ${r.version}).`),t(r)}}))}))}createTable(e,t,r,i){return bt(this,null,(function*(){return new Promise((n=>{let a=e.createObjectStore(t,r);i&&i.forEach((e=>{a.createIndex(e.name,e.fields,{unique:e.unique})})),de.debug(`[DB] Table ${t} created.`),n(e)}))}))}},Vs=W1;Vs._instance=void 0;var X1=class{constructor(){if(this.db=void 0,this.isCreatingTable=!1,-1===Vs.instance().getTables().findIndex((e=>e.name===this.tableName())))throw new Error(`Failed to find table '${this.tableName()}' from indexeddb!`)}tableName(){throw new Error("Derived class have to override 'tableName', and set a proper table name!")}add(e,t,r){let i=this.tableName();Vs.instance().getDatabase().then((n=>{let a=n.transaction([i],"readwrite").objectStore(i).add(e);a.onsuccess=t,a.onerror=r})).finally((()=>{Vs.instance().closeDatabase()})).catch((e=>{r&&r(e)}))}delete(e,t,r){let i=this.tableName();Vs.instance().getDatabase().then((n=>{let a=n.transaction([i],"readwrite").objectStore(i).delete(e);a.onsuccess=t,a.onerror=r})).finally((()=>{Vs.instance().closeDatabase()}))}update(){Vs.instance().getDatabase().then((()=>{}))}query(e,t){let r=this.tableName();Vs.instance().getDatabase().then((i=>{let n=i.transaction([r],"readonly").objectStore(r).openCursor();n.onsuccess=t=>{let r=t.target.result;r&&r.continue(),e&&e(r)},n.onerror=t})).finally((()=>{Vs.instance().closeDatabase()}))}queryByIndex(e,t,r,i){let n=this.tableName();Vs.instance().getDatabase().then((a=>{let s=a.transaction([n],"readonly").objectStore(n).index(e).get(t);s.onerror=i,s.onsuccess=function(e){var t;let i=null==(t=e.target)?void 0:t.result;r&&r(i)}})).finally((()=>{Vs.instance().closeDatabase()}))}queryAll(e,t){let r=this.tableName();Vs.instance().getDatabase().then((i=>{let n=i.transaction([r],"readonly").objectStore(r).getAll();n.onsuccess=t=>{e&&e(n.result)},n.onerror=t})).finally((()=>{Vs.instance().closeDatabase()}))}clearAll(e,t){let r=this.tableName();Vs.instance().getDatabase().then((i=>{let n=i.transaction([r],"readwrite").objectStore(r).clear();n.onsuccess=t=>{e&&e(t)},n.onerror=e=>{t&&t(e)}})).finally((()=>{Vs.instance().closeDatabase()}))}},Y1=class extends X1{tableName(){return"dxf_data"}static instance(){return Y1._instance||(Y1._instance=new Y1),Y1._instance}query(e,t,r){let i=[],n=this.tableName();Vs.instance().getDatabase().then((a=>{let s=a.transaction([n],"readonly").objectStore(n).get(e);s.onerror=e=>{r&&r(e),de.info("[DxfDataTable] Failed to query !",e)},s.onsuccess=()=>{s.result&&i.push(s.result),t&&t(i)}})).finally((()=>{Vs.instance().closeDatabase()}))}},$1=Y1;$1._instance=void 0;var g0=class extends X1{tableName(){return"fonts"}static instance(){return g0._instance||(g0._instance=new g0),g0._instance}query(e){let t;return new Promise(((r,i)=>{super.query((i=>{i?!i.value||i.value.fileName!==e||(t=i.value):r(t)}),(e=>{i(e)}))}))}queryAll(){return bt(this,null,(function*(){return new Promise(((e,t)=>{mX(g0.prototype,this,"queryAll").call(this,(t=>{e(t)}),(e=>{t(e)}))}))}))}},uf=g0;uf._instance=void 0;var Z1=class extends L3{constructor(e,t){super(t),this.info="",this.orientation=0,this.baseUp=0,this.baseDown=0,this.fileHeader="",this.fileVersion="",this.order=0,this.unsupportedChars={},this.fileName=e}addUnsupportedChar(e){this.unsupportedChars[e]||(this.unsupportedChars[e]=0),this.unsupportedChars[e]++}getFontFile(){return{order:this.order,data:this.data,info:this.info,orientation:this.orientation,baseUp:this.baseUp,baseDown:this.baseDown,fileName:this.fileName,fileHeader:this.fileHeader,fileVersion:this.fileVersion}}setFontFile(e){this.fileName=e.fileName,this.data=e.data,this.info=e.info,this.order=e.order,this.orientation=e.orientation,this.baseUp=e.baseUp,this.baseDown=e.baseDown,this.fileHeader=e.fileHeader,this.fileVersion=e.fileVersion}setFontDataToIndexedDb(){return bt(this,null,(function*(){let e=this.getFontFile();return new Promise(((t,r)=>{uf.instance().add(e,(()=>{console.log(`[FontFile] Saved '${this.fileName}' (${this.fileHeader}) to indexedDb`),t()}),(e=>r(`[FontFile] Failed to save '${this.fileName}' (${this.fileHeader}) to indexedDb! ${e}`)))}))}))}getFontDataByIndexedDb(){return bt(this,null,(function*(){return uf.instance().query(this.fileName)}))}releaseFontData(){this.data={}}},Xp=class extends Z1{constructor(e,t){super(e,t),this.reversed=!1,t instanceof ArrayBuffer?this.data=this.parseTTF(t):t.fileName?this.setFontFile(t):this.data=t,this.type="MeshFont"}generateShapes(e,t){return super.generateShapes(e,t)}getCharShape(e,t){var r;let i=null==(r=kxe(e,t,0,0,this.data))?void 0:r.path;return i||this.addUnsupportedChar(e),i}getNotFoundTextShape(e){var t;return null==(t=kxe("?",e,0,0,this.data))?void 0:t.path}parseTTF(e){function t(e){let t,r=[];e.forEach((function(e){"m"===e.type.toLowerCase()?(t=[e],r.push(t)):"z"!==e.type.toLowerCase()&&t.push(e)}));let i=[];return r.forEach((function(e){let t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};i.push(t);for(let t=e.length-1;t>0;t--){let r=e[t],n={type:r.type};void 0!==r.x2&&void 0!==r.y2?(n.x1=r.x2,n.y1=r.y2,n.x2=r.x1,n.y2=r.y1):void 0!==r.x1&&void 0!==r.y1&&(n.x1=r.x1,n.y1=r.y1),n.x=e[t-1].x,n.y=e[t-1].y,i.push(n)}})),i}return function(e,r){let i=Math.round,n={},a=1e5/(72*(e.unitsPerEm||2048)),s=e.encoding.cmap.glyphIndexMap,o=Object.keys(s);for(let l=0;l<o.length;l++){let h=o[l],c=e.glyphs.glyphs[s[h]];if(void 0!==h){let e={ha:i(c.advanceWidth*a),x_min:i(c.xMin*a),x_max:i(c.xMax*a),o:""};r&&(c.path.commands=t(c.path.commands)),c.path.commands.forEach((function(t){"c"===t.type.toLowerCase()&&(t.type="b"),e.o+=t.type.toLowerCase()+" ",void 0!==t.x&&void 0!==t.y&&(e.o+=i(t.x*a)+" "+i(t.y*a)+" "),void 0!==t.x1&&void 0!==t.y1&&(e.o+=i(t.x1*a)+" "+i(t.y1*a)+" "),void 0!==t.x2&&void 0!==t.y2&&(e.o+=i(t.x2*a)+" "+i(t.y2*a)+" ")})),n[String.fromCodePoint(c.unicode)]=e}}return{glyphs:n,familyName:e.getEnglishName("fullName"),ascender:i(e.ascender*a),descender:i(e.descender*a),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(Oxe(e),this.reversed)}};function kxe(e,t,r,i,n){let a=n.glyphs[e];if(!a)return;let s,o,l,h,c,u,d,p,f=new Xg;if(a.o){let e=a._cachedOutline||(a._cachedOutline=a.o.split(" "));for(let n=0,a=e.length;n<a;)switch(e[n++]){case"m":s=e[n++]*t+r,o=e[n++]*t+i,f.moveTo(s,o);break;case"l":s=e[n++]*t+r,o=e[n++]*t+i,f.lineTo(s,o);break;case"q":l=e[n++]*t+r,h=e[n++]*t+i,c=e[n++]*t+r,u=e[n++]*t+i,f.quadraticCurveTo(c,u,l,h);break;case"b":l=e[n++]*t+r,h=e[n++]*t+i,c=e[n++]*t+r,u=e[n++]*t+i,d=e[n++]*t+r,p=e[n++]*t+i,f.bezierCurveTo(c,u,d,p,l,h)}}return{offsetX:a.ha*t,path:f}}var k3={130:[[[5,0],[5,9.5]],[[4,7.1],[2.6,6.6],[2.1,6.2],[1.7,5.4],[1.6,4],[2.1,3],[2.6,2.6],[3.9,2.2],[6.1,2.2],[7.5,2.6],[8,3.1],[8.4,3.9],[8.4,5.2],[7.9,6.1],[7.5,6.6],[6.1,7.1],[4,7.1]]],131:[[[3,0],[7,0]],[[5,0],[5,9.5]],[[4,7.1],[2.6,6.6],[2.1,6.2],[1.7,5.4],[1.6,4],[2.1,3],[2.6,2.6],[3.9,2.2],[6.1,2.2],[7.5,2.6],[8,3.1],[8.4,3.9],[8.4,5.2],[7.9,6.1],[7.5,6.6],[6.1,7.1],[4,7.1]]],132:[[[3,0],[7,0]],[[4,0],[4,9.5]],[[6,0],[6,9.5]],[[4,7.1],[2.6,6.6],[2.1,6.2],[1.7,5.4],[1.6,4],[2.1,3],[2.6,2.6],[3.9,2.2],[6.1,2.2],[7.5,2.6],[8,3.1],[8.4,3.9],[8.4,5.2],[7.9,6.1],[7.5,6.6],[6.1,7.1],[4,7.1]]],133:[[[3,0],[7,0]],[[4,0],[4,9.5]],[[6,0],[6,9.5]],[[4,7.1],[2.6,6.6],[2.1,6.2],[1.7,5.4],[1.6,4],[2.1,3],[2.6,2.6],[3.9,2.2],[6.1,2.2],[7.5,2.6],[8,3.1],[8.4,3.9],[8.4,5.2],[7.9,6.1],[7.5,6.6],[6.1,7.1],[4,7.1]],[[3,9.5],[7,9.5]]],134:[[[3,0],[7,0]],[[5,0],[5,9.5]],[[4,7.1],[2.6,6.6],[2.1,6.2],[1.7,5.4],[1.6,4],[2.1,3],[2.6,2.6],[3.9,2.2],[6.1,2.2],[7.5,2.6],[8,3.1],[8.4,3.9],[8.4,5.2],[7.9,6.1],[7.5,6.6],[6.1,7.1],[4,7.1]],[[12,10],[9,10],[9,6]],[[9,8],[11,8]]],135:[[[3,0],[7,0]],[[4,0],[4,9.5]],[[6,0],[6,9.5]],[[4,7.1],[2.6,6.6],[2.1,6.2],[1.7,5.4],[1.6,4],[2.1,3],[2.6,2.6],[3.9,2.2],[6.1,2.2],[7.5,2.6],[8,3.1],[8.4,3.9],[8.4,5.2],[7.9,6.1],[7.5,6.6],[6.1,7.1],[4,7.1]],[[12,10],[9,10],[9,6]],[[9,8],[11,8]]],136:[[[3,0],[7,0]],[[4,0],[4,9.5]],[[6,0],[6,9.5]],[[4,7.1],[2.6,6.6],[2.1,6.2],[1.7,5.4],[1.6,4],[2.1,3],[2.6,2.6],[3.9,2.2],[6.1,2.2],[7.5,2.6],[8,3.1],[8.4,3.9],[8.4,5.2],[7.9,6.1],[7.5,6.6],[6.1,7.1],[4,7.1]],[[3,9.5],[7,9.5]],[[12,10],[9,10],[9,6]],[[9,8],[11,8]]],178:[[[1.142,9.285],[1.142,9.428],[1.285,9.714],[1.428,9.857],[1.714,10],[2.285,10],[2.571,9.857],[2.714,9.714],[2.857,9.428],[2.857,9.142],[2.714,8.857],[2.428,8.428],[1,7],[3,7]]],8960:[[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]],[[0,0],[8,8]]],20393:[[[0,0],[0,6.666]],[[0,4.761],[1.428,6.19],[2.38,6.666],[3.809,6.666],[4.761,6.19],[5.238,4.761],[5.238,0]],[[5.238,4.761],[6.666,6.19],[7.619,6.666],[9.047,6.666],[10,6.19],[10.476,4.761],[10.476,0]],[[11.142,9.285],[11.142,9.428],[11.285,9.714],[11.428,9.857],[11.714,10],[12.285,10],[12.571,9.857],[12.714,9.714],[12.857,9.428],[12.857,9.142],[12.714,8.857],[12.428,8.428],[11,7],[13,7]]],41123:[],55714:[[[2,5.9],[2.6,6.1],[3.4,7],[3.4,1]],[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]]],55970:[[[2.3,5.6],[2.3,5.9],[2.6,6.4],[2.9,6.7],[3.4,7],[4.6,7],[5.1,6.7],[5.4,6.4],[5.7,5.9],[5.7,5.3],[5.4,4.7],[4.9,3.9],[2,1],[6,1]],[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]]],56226:[[[2.6,7],[5.7,7],[4,4.7],[4.9,4.7],[5.4,4.4],[5.7,4.1],[6,3.3],[6,2.7],[5.7,1.9],[5.1,1.3],[4.3,1],[3.4,1],[2.6,1.3],[2.3,1.6],[2,2.1]],[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]]],56482:[[[4.9,7],[2,3],[6.3,3]],[[4.9,7],[4.9,1]],[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]]],56738:[[[5.4,7],[2.6,7],[2.3,4.4],[2.6,4.7],[3.4,5],[4.3,5],[5.1,4.7],[5.7,4.1],[6,3.3],[6,2.7],[5.7,1.9],[5.1,1.3],[4.3,1],[3.4,1],[2.6,1.3],[2.3,1.6],[2,2.1]],[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]]],56994:[[[5.4,6.1],[5.1,6.7],[4.3,7],[3.7,7],[2.9,6.7],[2.3,5.9],[2,4.4],[2,3],[2.3,1.9],[2.9,1.3],[3.7,1],[4,1],[4.9,1.3],[5.4,1.9],[5.7,2.7],[5.7,3],[5.4,3.9],[4.9,4.4],[4,4.7],[3.7,4.7],[2.9,4.4],[2.3,3.9],[2,3]],[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]]],57250:[[[2,7],[6,7],[3.1,1]],[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]]],57506:[[[3.4,7],[2.6,6.7],[2.3,6.1],[2.3,5.6],[2.6,5],[3.1,4.7],[4.3,4.4],[5.1,4.1],[5.7,3.6],[6,3],[6,2.1],[5.7,1.6],[5.4,1.3],[4.6,1],[3.4,1],[2.6,1.3],[2.3,1.6],[2,2.1],[2,3],[2.3,3.6],[2.9,4.1],[3.7,4.4],[4.9,4.7],[5.4,5],[5.7,5.6],[5.7,6.1],[5.4,6.7],[4.6,7],[3.4,7]],[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]]],57762:[[[5.7,5],[5.4,4.1],[4.9,3.6],[4,3.3],[3.7,3.3],[2.9,3.6],[2.3,4.1],[2,5],[2,5.3],[2.3,6.1],[2.9,6.7],[3.7,7],[4,7],[4.9,6.7],[5.4,6.1],[5.7,5],[5.7,3.6],[5.4,2.1],[4.9,1.3],[4,1],[3.4,1],[2.6,1.3],[2.3,1.9]],[[2.9,8],[1.7,7.4],[.6,6.3],[0,4.6],[0,3.4],[.6,1.7],[1.7,.6],[2.9,0],[4.6,0],[5.7,.6],[6.9,1.7],[7.4,3.4],[7.4,4.6],[6.9,6.3],[5.7,7.4],[4.6,8],[2.9,8]]],60070:[[[0,6],[10,6],[10,4]]],60326:[[[0,7],[0,5],[10,5]]]},dSt=!1,fSt=new Te,hf=class extends Ys{constructor(e,t){super(),this.width=0,this.bounds=new ts,this.lastPoint=e,this.polylines=t,this.width=this.calcWidth(t)}offset(e){let t=[];for(let r=0;r<this.polylines.length;r++){let i=this.polylines[r],n=[];for(let t=0;t<i.length;t++){let r=i[t];n.push(r.clone().add(e))}t.push(n)}return new hf(this.lastPoint,t)}transform(e){let t=[];for(let r=0;r<this.polylines.length;r++){let i=this.polylines[r],n=[];for(let t=0;t<i.length;t++){let r=i[t];n.push(r.clone().applyMatrix3(e))}t.push(n)}return new hf(this.lastPoint.clone().applyMatrix3(e),t)}calcWidth(e){let t=this.bounds;for(let r=0;r<e.length;r++){let i=e[r];for(let e=0;e<i.length;e++){let r=i[e];t.expandByPoint(r)}}let r=t.min.x||0;return(t.max.x||0)-r}toThreeGeometry(){let e=this.polylines;if(dSt&&e.length>0){let t=this.bounds.min,r=this.bounds.getSize(fSt),i=new Te(t.x,t.y),n=new Te(t.x+r.width,t.y),a=new Te(t.x+r.width,t.y+r.height),s=new Te(t.x,t.y+r.height);e.push([i,n],[n,a],[a,s],[s,i])}let t=[],r=[],i=0,n=new Nt;for(let n=0;n<e.length;n++){let a=e[n];for(let e=0;e<a.length;e++){let n=a[e];t.push(n.x,n.y,0),e===a.length-1||r.push(i,i+1),i++}}return n.setAttribute("position",new zt(t,3)),n.setIndex(r),n}},F3;function pSt(){let e=[[161,169,161,254],[176,247,161,254],[129,160,64,254],[170,254,64,160],[168,169,64,160],[170,175,161,254],[248,254,161,254],[161,167,64,160]],t=new Uint16Array(23940),r=0;for(let[i,n,a,s]of e)for(let e=a;e<=s;e++)if(127!==e)for(let a=i;a<=n;a++)t[r++]=e<<8|a;let i=new TextDecoder("gbk").decode(t);for(F3=new Uint16Array(65536),r=0;r<i.length;r++)F3[i.charCodeAt(r)]=t[r]}function Fxe(e){F3||pSt();let t=new Uint8Array(2*e.length),r=0;for(let i=0;i<e.length;i++){let n=e.charCodeAt(i);if(n<128)t[r++]=n;else{let e=F3[n];t[r++]=255&e,t[r++]=e>>8}}return t.subarray(0,r)}var mSt="啊阿埃挨哎唉哀皑癌蔼矮艾碍爱隘鞍氨安俺按暗岸胺案肮昂盎凹敖熬翱袄傲奥懊澳芭捌扒叭吧笆八疤巴拔跋靶把耙坝霸罢爸白柏百摆佰败拜稗斑班搬扳般颁板版扮拌伴瓣半办绊邦帮梆榜膀绑棒磅蚌镑傍谤苞胞包褒剥薄雹保堡饱宝抱报暴豹鲍爆杯碑悲卑北辈背贝钡倍狈备惫焙被奔苯本笨崩绷甭泵蹦迸逼鼻比鄙笔彼碧蓖蔽毕毙毖币庇痹闭敝弊必辟壁臂避陛鞭边编贬扁便变卞辨辩辫遍标彪膘表鳖憋别瘪彬斌濒滨宾摈兵冰柄丙秉饼炳病并玻菠播拨钵波博勃搏铂箔伯帛舶脖膊渤泊驳捕卜哺补埠不布步簿部怖擦猜裁材才财睬踩采彩菜蔡餐参蚕残惭惨灿苍舱仓沧藏操糙槽曹草厕策侧册测层蹭插叉茬茶查碴搽察岔差诧拆柴豺搀掺蝉馋谗缠铲产阐颤昌猖场尝常长偿肠厂敞畅唱倡超抄钞朝嘲潮巢吵炒车扯撤掣彻澈郴臣辰尘晨忱沉陈趁衬撑称城橙成呈乘程惩澄诚承逞骋秤吃痴持匙池迟弛驰耻齿侈尺赤翅斥炽充冲虫崇宠抽酬畴踌稠愁筹仇绸瞅丑臭初出橱厨躇锄雏滁除楚础储矗搐触处揣川穿椽传船喘串疮窗幢床闯创吹炊捶锤垂春椿醇唇淳纯蠢戳绰疵茨磁雌辞慈瓷词此刺赐次聪葱囱匆从丛凑粗醋簇促蹿篡窜摧崔催脆瘁粹淬翠村存寸磋撮搓措挫错搭达答瘩打大呆歹傣戴带殆代贷袋待逮怠耽担丹单郸掸胆旦氮但惮淡诞弹蛋当挡党荡档刀捣蹈倒岛祷导到稻悼道盗德得的蹬灯登等瞪凳邓堤低滴迪敌笛狄涤翟嫡抵底地蒂第帝弟递缔颠掂滇碘点典靛垫电佃甸店惦奠淀殿碉叼雕凋刁掉吊钓调跌爹碟蝶迭谍叠丁盯叮钉顶鼎锭定订丢东冬董懂动栋侗恫冻洞兜抖斗陡豆逗痘都督毒犊独读堵睹赌杜镀肚度渡妒端短锻段断缎堆兑队对墩吨蹲敦顿囤钝盾遁掇哆多夺垛躲朵跺舵剁惰堕蛾峨鹅俄额讹娥恶厄扼遏鄂饿恩而儿耳尔饵洱二贰发罚筏伐乏阀法珐藩帆番翻樊矾钒繁凡烦反返范贩犯饭泛坊芳方肪房防妨仿访纺放菲非啡飞肥匪诽吠肺废沸费芬酚吩氛分纷坟焚汾粉奋份忿愤粪丰封枫蜂峰锋风疯烽逢冯缝讽奉凤佛否夫敷肤孵扶拂辐幅氟符伏俘服浮涪福袱弗甫抚辅俯釜斧脯腑府腐赴副覆赋复傅付阜父腹负富讣附妇缚咐噶嘎该改概钙盖溉干甘杆柑竿肝赶感秆敢赣冈刚钢缸肛纲岗港杠篙皋高膏羔糕搞镐稿告哥歌搁戈鸽胳疙割革葛格蛤阁隔铬个各给根跟耕更庚羹埂耿梗工攻功恭龚供躬公宫弓巩汞拱贡共钩勾沟苟狗垢构购够辜菇咕箍估沽孤姑鼓古蛊骨谷股故顾固雇刮瓜剐寡挂褂乖拐怪棺关官冠观管馆罐惯灌贯光广逛瑰规圭硅归龟闺轨鬼诡癸桂柜跪贵刽辊滚棍锅郭国果裹过哈骸孩海氦亥害骇酣憨邯韩含涵寒函喊罕翰撼捍旱憾悍焊汗汉夯杭航壕嚎豪毫郝好耗号浩呵喝荷菏核禾和何合盒貉阂河涸赫褐鹤贺嘿黑痕很狠恨哼亨横衡恒轰哄烘虹鸿洪宏弘红喉侯猴吼厚候后呼乎忽瑚壶葫胡蝴狐糊湖弧虎唬护互沪户花哗华猾滑画划化话槐徊怀淮坏欢环桓还缓换患唤痪豢焕涣宦幻荒慌黄磺蝗簧皇凰惶煌晃幌恍谎灰挥辉徽恢蛔回毁悔慧卉惠晦贿秽会烩汇讳诲绘荤昏婚魂浑混豁活伙火获或惑霍货祸击圾基机畸稽积箕肌饥迹激讥鸡姬绩缉吉极棘辑籍集及急疾汲即嫉级挤几脊己蓟技冀季伎祭剂悸济寄寂计记既忌际继纪嘉枷夹佳家加荚颊贾甲钾假稼价架驾嫁歼监坚尖笺间煎兼肩艰奸缄茧检柬碱硷拣捡简俭剪减荐槛鉴践贱见键箭件健舰剑饯渐溅涧建僵姜将浆江疆蒋桨奖讲匠酱降蕉椒礁焦胶交郊浇骄娇嚼搅铰矫侥脚狡角饺缴绞剿教酵轿较叫窖揭接皆秸街阶截劫节茎睛晶鲸京惊精粳经井警景颈静境敬镜径痉靖竟竞净炯窘揪究纠玖韭久灸九酒厩救旧臼舅咎就疚鞠拘狙疽居驹菊局咀矩举沮聚拒据巨具距踞锯俱句惧炬剧捐鹃娟倦眷卷绢撅攫抉掘倔爵桔杰捷睫竭洁结解姐戒藉芥界借介疥诫届巾筋斤金今津襟紧锦仅谨进靳晋禁近烬浸尽劲荆兢觉决诀绝均菌钧军君峻俊竣浚郡骏喀咖卡咯开揩楷凯慨刊堪勘坎砍看康慷糠扛抗亢炕考拷烤靠坷苛柯棵磕颗科壳咳可渴克刻客课肯啃垦恳坑吭空恐孔控抠口扣寇枯哭窟苦酷库裤夸垮挎跨胯块筷侩快宽款匡筐狂框矿眶旷况亏盔岿窥葵奎魁傀馈愧溃坤昆捆困括扩廓阔垃拉喇蜡腊辣啦莱来赖蓝婪栏拦篮阑兰澜谰揽览懒缆烂滥琅榔狼廊郎朗浪捞劳牢老佬姥酪烙涝勒乐雷镭蕾磊累儡垒擂肋类泪棱楞冷厘梨犁黎篱狸离漓理李里鲤礼莉荔吏栗丽厉励砾历利傈例俐痢立粒沥隶力璃哩俩联莲连镰廉怜涟帘敛脸链恋炼练粮凉梁粱良两辆量晾亮谅撩聊僚疗燎寥辽潦了撂镣廖料列裂烈劣猎琳林磷霖临邻鳞淋凛赁吝拎玲菱零龄铃伶羚凌灵陵岭领另令溜琉榴硫馏留刘瘤流柳六龙聋咙笼窿隆垄拢陇楼娄搂篓漏陋芦卢颅庐炉掳卤虏鲁麓碌露路赂鹿潞禄录陆戮驴吕铝侣旅履屡缕虑氯律率滤绿峦挛孪滦卵乱掠略抡轮伦仑沦纶论萝螺罗逻锣箩骡裸落洛骆络妈麻玛码蚂马骂嘛吗埋买麦卖迈脉瞒馒蛮满蔓曼慢漫谩芒茫盲氓忙莽猫茅锚毛矛铆卯茂冒帽貌贸么玫枚梅酶霉煤没眉媒镁每美昧寐妹媚门闷们萌蒙檬盟锰猛梦孟眯醚靡糜迷谜弥米秘觅泌蜜密幂棉眠绵冕免勉娩缅面苗描瞄藐秒渺庙妙蔑灭民抿皿敏悯闽明螟鸣铭名命谬摸摹蘑模膜磨摩魔抹末莫墨默沫漠寞陌谋牟某拇牡亩姆母墓暮幕募慕木目睦牧穆拿哪呐钠那娜纳氖乃奶耐奈南男难囊挠脑恼闹淖呢馁内嫩能妮霓倪泥尼拟你匿腻逆溺蔫拈年碾撵捻念娘酿鸟尿捏聂孽啮镊镍涅您柠狞凝宁拧泞牛扭钮纽脓浓农弄奴努怒女暖虐疟挪懦糯诺哦欧鸥殴藕呕偶沤啪趴爬帕怕琶拍排牌徘湃派攀潘盘磐盼畔判叛乓庞旁耪胖抛咆刨炮袍跑泡呸胚培裴赔陪配佩沛喷盆砰抨烹澎彭蓬棚硼篷膨朋鹏捧碰坯砒霹批披劈琵毗啤脾疲皮匹痞僻屁譬篇偏片骗飘漂瓢票撇瞥拼频贫品聘乒坪苹萍平凭瓶评屏坡泼颇婆破魄迫粕剖扑铺仆莆葡菩蒲埔朴圃普浦谱曝瀑期欺栖戚妻七凄漆柒沏其棋奇歧畦崎脐齐旗祈祁骑起岂乞企启契砌器气迄弃汽泣讫掐洽牵扦钎铅千迁签仟谦乾黔钱钳前潜遣浅谴堑嵌欠歉枪呛腔羌墙蔷强抢橇锹敲悄桥瞧乔侨巧鞘撬翘峭俏窍切茄且怯窃钦侵亲秦琴勤芹擒禽寝沁青轻氢倾卿清擎晴氰情顷请庆琼穷秋丘邱球求囚酋泅趋区蛆曲躯屈驱渠取娶龋趣去圈颧权醛泉全痊拳犬券劝缺炔瘸却鹊榷确雀裙群然燃冉染瓤壤攘嚷让饶扰绕惹热壬仁人忍韧任认刃妊纫扔仍日戎茸蓉荣融熔溶容绒冗揉柔肉茹蠕儒孺如辱乳汝入褥软阮蕊瑞锐闰润若弱撒洒萨腮鳃塞赛三叁伞散桑嗓丧搔骚扫嫂瑟色涩森僧莎砂杀刹沙纱傻啥煞筛晒珊苫杉山删煽衫闪陕擅赡膳善汕扇缮墒伤商赏晌上尚裳梢捎稍烧芍勺韶少哨邵绍奢赊蛇舌舍赦摄射慑涉社设砷申呻伸身深娠绅神沈审婶甚肾慎渗声生甥牲升绳省盛剩胜圣师失狮施湿诗尸虱十石拾时什食蚀实识史矢使屎驶始式示士世柿事拭誓逝势是嗜噬适仕侍释饰氏市恃室视试收手首守寿授售受瘦兽蔬枢梳殊抒输叔舒淑疏书赎孰熟薯暑曙署蜀黍鼠属术述树束戍竖墅庶数漱恕刷耍摔衰甩帅栓拴霜双爽谁水睡税吮瞬顺舜说硕朔烁斯撕嘶思私司丝死肆寺嗣四伺似饲巳松耸怂颂送宋讼诵搜艘擞嗽苏酥俗素速粟僳塑溯宿诉肃酸蒜算虽隋随绥髓碎岁穗遂隧祟孙损笋蓑梭唆缩琐索锁所塌他它她塔獭挞蹋踏胎苔抬台泰酞太态汰坍摊贪瘫滩坛檀痰潭谭谈坦毯袒碳探叹炭汤塘搪堂棠膛唐糖倘躺淌趟烫掏涛滔绦萄桃逃淘陶讨套特藤腾疼誊梯剔踢锑提题蹄啼体替嚏惕涕剃屉天添填田甜恬舔腆挑条迢眺跳贴铁帖厅听烃汀廷停亭庭挺艇通桐酮瞳同铜彤童桶捅筒统痛偷投头透凸秃突图徒途涂屠土吐兔湍团推颓腿蜕褪退吞屯臀拖托脱鸵陀驮驼椭妥拓唾挖哇蛙洼娃瓦袜歪外豌弯湾玩顽丸烷完碗挽晚皖惋宛婉万腕汪王亡枉网往旺望忘妄威巍微危韦违桅围唯惟为潍维苇萎委伟伪尾纬未蔚味畏胃喂魏位渭谓尉慰卫瘟温蚊文闻纹吻稳紊问嗡翁瓮挝蜗涡窝我斡卧握沃巫呜钨乌污诬屋无芜梧吾吴毋武五捂午舞伍侮坞戊雾晤物勿务悟误昔熙析西硒矽晰嘻吸锡牺稀息希悉膝夕惜熄烯溪汐犀檄袭席习媳喜铣洗系隙戏细瞎虾匣霞辖暇峡侠狭下厦夏吓掀锨先仙鲜纤咸贤衔舷闲涎弦嫌显险现献县腺馅羡宪陷限线相厢镶香箱襄湘乡翔祥详想响享项巷橡像向象萧硝霄削哮嚣销消宵淆晓小孝校肖啸笑效楔些歇蝎鞋协挟携邪斜胁谐写械卸蟹懈泄泻谢屑薪芯锌欣辛新忻心信衅星腥猩惺兴刑型形邢行醒幸杏性姓兄凶胸匈汹雄熊休修羞朽嗅锈秀袖绣墟戌需虚嘘须徐许蓄酗叙旭序畜恤絮婿绪续轩喧宣悬旋玄选癣眩绚靴薛学穴雪血勋熏循旬询寻驯巡殉汛训讯逊迅压押鸦鸭呀丫芽牙蚜崖衙涯雅哑亚讶焉咽阉烟淹盐严研蜒岩延言颜阎炎沿奄掩眼衍演艳堰燕厌砚雁唁彦焰宴谚验殃央鸯秧杨扬佯疡羊洋阳氧仰痒养样漾邀腰妖瑶摇尧遥窑谣姚咬舀药要耀椰噎耶爷野冶也页掖业叶曳腋夜液一壹医揖铱依伊衣颐夷遗移仪胰疑沂宜姨彝椅蚁倚已乙矣以艺抑易邑屹亿役臆逸肄疫亦裔意毅忆义益溢诣议谊译异翼翌绎茵荫因殷音阴姻吟银淫寅饮尹引隐印英樱婴鹰应缨莹萤营荧蝇迎赢盈影颖硬映哟拥佣臃痈庸雍踊蛹咏泳涌永恿勇用幽优悠忧尤由邮铀犹油游酉有友右佑釉诱又幼迂淤于盂榆虞愚舆余俞逾鱼愉渝渔隅予娱雨与屿禹宇语羽玉域芋郁吁遇喻峪御愈欲狱育誉浴寓裕预豫驭鸳渊冤元垣袁原援辕园员圆猿源缘远苑愿怨院曰约越跃钥岳粤月悦阅耘云郧匀陨允运蕴酝晕韵孕匝砸杂栽哉灾宰载再在咱攒暂赞赃脏葬遭糟凿藻枣早澡蚤躁噪造皂灶燥责择则泽贼怎增憎曾赠扎喳渣札轧铡闸眨栅榨咋乍炸诈摘斋宅窄债寨瞻毡詹粘沾盏斩辗崭展蘸栈占战站湛绽樟章彰漳张掌涨杖丈帐账仗胀瘴障招昭找沼赵照罩兆肇召遮折哲蛰辙者锗蔗这浙珍斟真甄砧臻贞针侦枕疹诊震振镇阵蒸挣睁征狰争怔整拯正政帧症郑证芝枝支吱蜘知肢脂汁之织职直植殖执值侄址指止趾只旨纸志挚掷至致置帜峙制智秩稚质炙痔滞治窒中盅忠钟衷终种肿重仲众舟周州洲诌粥轴肘帚咒皱宙昼骤珠株蛛朱猪诸诛逐竹烛煮拄瞩嘱主著柱助蛀贮铸筑住注祝驻抓爪拽专砖转撰赚篆桩庄装妆撞壮状椎锥追赘坠缀谆准捉拙卓桌琢茁酌啄着灼浊兹咨资姿滋淄孜紫仔籽滓子自渍字鬃棕踪宗综总纵邹走奏揍租足卒族祖诅阻组钻纂嘴醉最罪尊遵昨左佐柞做作坐座锕嗳嫒瑷暧霭谙铵鹌媪骜鳌钯呗钣鸨龅鹎贲锛荜哔滗铋筚跸苄缏笾骠飑飙镖镳鳔傧缤槟殡膑镔髌鬓禀饽钹鹁钸骖黪恻锸侪钗冁谄谶蒇忏婵骣觇禅镡伥苌怅阊鲳砗伧谌榇碜龀枨柽铖铛饬鸱铳俦帱雠刍绌蹰钏怆缍鹑辍龊鹚苁骢枞辏撺锉鹾哒鞑骀绐殚赕瘅箪谠砀裆焘镫籴诋谛绨觌镝巅钿癫铫鲷鲽铤铥岽鸫窦渎椟牍笃黩簖怼镦炖趸铎谔垩阏轭锇锷鹗颚颛鳄诶迩铒鸸鲕钫鲂绯镄鲱偾沣凫驸绂绋赙麸鲋鳆钆赅尴擀绀戆睾诰缟锆纥镉颍亘赓绠鲠诟缑觏诂毂钴锢鸪鹄鹘鸹掴诖掼鹳鳏犷匦刿妫桧鲑鳜衮绲鲧埚呙帼椁蝈铪阚绗颉灏颢诃阖蛎黉讧荭闳鲎浒鹕骅桦铧奂缳锾鲩鳇诙荟哕浍缋珲晖诨馄阍钬镬讦诘荠叽哜骥玑觊齑矶羁虿跻霁鲚鲫郏浃铗镓蛲谏缣戋戬睑鹣笕鲣鞯绛缰挢峤鹪鲛疖颌鲒卺荩馑缙赆觐刭泾迳弪胫靓阄鸠鹫讵屦榉飓钜锔窭龃锩镌隽谲珏皲剀垲忾恺铠锴龛闶钪铐骒缂轲钶锞颔龈铿喾郐哙脍狯髋诓诳邝圹纩贶匮蒉愦聩篑阃锟鲲蛴崃徕涞濑赉睐铼癞籁岚榄斓镧褴阆锒唠崂铑铹痨鳓诔缧俪郦坜苈莅蓠呖逦骊缡枥栎轹砺锂鹂疠粝跞雳鲡鳢蔹奁潋琏殓裢裣鲢魉缭钌鹩蔺廪檩辚躏绫棂蛏鲮浏骝绺镏鹨茏泷珑栊胧砻偻蒌喽嵝镂瘘耧蝼髅垆撸噜闾泸渌栌橹轳辂辘氇胪鸬鹭舻鲈脔娈栾鸾銮囵荦猡泺椤脶镙榈褛锊呒唛嬷杩劢缦镘颡鳗麽扪焖懑钔芈谧猕祢渑腼黾缈缪闵缗谟蓦馍殁镆钼铙讷铌鲵辇鲶茑袅陧蘖嗫颟蹑苎咛聍侬哝驽钕傩讴怄瓯蹒疱辔纰罴铍谝骈缥嫔钋镤镨蕲骐绮桤碛颀颃鳍佥荨悭骞缱椠钤嫱樯戗炝锖锵镪羟跄诮谯荞缲硗跷惬锲箧锓揿鲭茕蛱巯赇虮鳅诎岖阒觑鸲诠绻辁铨阕阙悫荛娆桡饪轫嵘蝾缛铷颦蚬飒毵糁缫啬铯穑铩鲨酾讪姗骟钐鳝垧殇觞厍滠畲诜谂渖谥埘莳弑轼贳铈鲥绶摅纾闩铄厮驷缌锶鸶薮馊飕锼谡稣谇荪狲唢睃闼铊鳎钛鲐昙钽锬顸傥饧铴镗韬铽缇鹈阗粜龆鲦恸钭钍抟饨箨鼍娲腽纨绾辋诿帏闱沩涠玮韪炜鲔阌莴龌邬庑怃妩骛鹉鹜饩阋玺觋硖苋莶藓岘猃娴鹇痫蚝籼跹芗饷骧缃飨哓潇骁绡枭箫亵撷绁缬陉荥馐鸺诩顼谖铉镟谑泶鳕埙浔鲟垭娅桠氩厣赝俨兖谳恹闫酽魇餍鼹炀轺鹞鳐靥谒邺晔烨诒呓峄饴怿驿缢轶贻钇镒镱瘗舣铟瘾茔莺萦蓥撄嘤滢潆璎鹦瘿颏罂镛莸铕鱿伛俣谀谕蓣嵛饫阈妪纡觎欤钰鹆鹬龉橼鸢鼋钺郓芸恽愠纭韫殒氲瓒趱錾驵赜啧帻箦谮缯谵诏钊谪辄鹧浈缜桢轸赈祯鸩诤峥钲铮筝骘栉栀轵轾贽鸷蛳絷踬踯觯锺纣绉伫槠铢啭馔颞骓缒诼镯谘缁辎赀眦锱龇鲻偬诹驺鲰镞缵躜鳟讠谫郄勐凼坂垅垴埯埝苘荬荮莜莼菰藁揸吒吣咔咝咴噘噼嚯幞岙嵴彷徼犸狍馀馇馓馕愣憷懔丬溆滟溷漤潴澹甯纟绔绱珉枧桊桉槔橥轱轷赍肷胨飚煳煅熘愍淼砜磙眍钚钷铘铞锃锍锎锏锘锝锪锫锿镅镎镢镥镩镲稆鹋鹛鹱疬疴痖癯裥襁耢颥螨麴鲅鲆鲇鲞鲴鲺鲼鳊鳋鳘鳙鞒鞴齄",Bxe="啊阿埃挨哎唉哀皚癌藹矮艾礙愛隘鞍氨安俺按暗岸胺案骯昂盎凹敖熬翺襖傲奧懊澳芭捌扒叭吧笆八疤巴拔跋靶把耙壩霸罷爸白柏百擺佰敗拜稗斑班搬扳般頒板版扮拌伴瓣半辦絆邦幫梆榜膀綁棒磅蚌鎊傍謗苞胞包褒剝薄雹保堡飽寶抱報暴豹鮑爆杯碑悲卑北輩背貝鋇倍狽備憊焙被奔苯本笨崩繃甭泵蹦迸逼鼻比鄙筆彼碧蓖蔽畢斃毖幣庇痹閉敝弊必辟壁臂避陛鞭邊編貶扁便變卞辨辯辮遍標彪膘表鱉憋別癟彬斌瀕濱賓擯兵冰柄丙秉餅炳病並玻菠播撥缽波博勃搏鉑箔伯帛舶脖膊渤泊駁捕蔔哺補埠不布步簿部怖擦猜裁材才財睬踩采彩菜蔡餐參蠶殘慚慘燦蒼艙倉滄藏操糙槽曹草廁策側冊測層蹭插叉茬茶查碴搽察岔差詫拆柴豺攙摻蟬饞讒纏鏟產闡顫昌猖場嘗常長償腸廠敞暢唱倡超抄鈔朝嘲潮巢吵炒車扯撤掣徹澈郴臣辰塵晨忱沈陳趁襯撐稱城橙成呈乘程懲澄誠承逞騁秤吃癡持匙池遲弛馳恥齒侈尺赤翅斥熾充沖蟲崇寵抽酬疇躊稠愁籌仇綢瞅醜臭初出櫥廚躇鋤雛滁除楚礎儲矗搐觸處揣川穿椽傳船喘串瘡窗幢床闖創吹炊捶錘垂春椿醇唇淳純蠢戳綽疵茨磁雌辭慈瓷詞此刺賜次聰蔥囪匆從叢湊粗醋簇促躥篡竄摧崔催脆瘁粹淬翠村存寸磋撮搓措挫錯搭達答瘩打大呆歹傣戴帶殆代貸袋待逮怠耽擔丹單鄲撣膽旦氮但憚淡誕彈蛋當擋黨蕩檔刀搗蹈倒島禱導到稻悼道盜德得的蹬燈登等瞪凳鄧堤低滴迪敵笛狄滌翟嫡抵底地蒂第帝弟遞締顛掂滇碘點典靛墊電佃甸店惦奠澱殿碉叼雕雕刁掉吊釣調跌爹碟蝶叠諜疊丁盯叮釘頂鼎錠定訂丟東冬董懂動棟侗恫凍洞兜抖鬥陡豆逗痘都督毒犢獨讀堵睹賭杜鍍肚度渡妒端短鍛段斷緞堆兌隊對墩噸蹲敦頓囤鈍盾遁掇哆多奪垛躲朵跺舵剁惰墮蛾峨鵝俄額訛娥惡厄扼遏鄂餓恩而兒耳爾餌洱二貳發罰筏伐乏閥法琺藩帆番翻樊礬釩繁凡煩反返範販犯飯泛坊芳方肪房防妨仿訪紡放菲非啡飛肥匪誹吠肺廢沸費芬酚吩氛分紛墳焚汾粉奮份忿憤糞豐封楓蜂峰鋒風瘋烽逢馮縫諷奉鳳佛否夫敷膚孵扶拂輻幅氟符伏俘服浮涪福袱弗甫撫輔俯釜斧脯腑府腐赴副覆賦復傅付阜父腹負富訃附婦縛咐噶嘎該改概鈣蓋溉幹甘桿柑竿肝趕感稈敢贛岡剛鋼缸肛綱崗港杠篙臯高膏羔糕搞鎬稿告哥歌擱戈鴿胳疙割革葛格蛤閣隔鉻個各給根跟耕更庚羹埂耿梗工攻功恭龔供躬公宮弓鞏汞拱貢共鉤勾溝茍狗垢構購夠辜菇咕箍估沽孤姑鼓古蠱骨谷股故顧固雇刮瓜剮寡掛褂乖拐怪棺關官冠觀管館罐慣灌貫光廣逛瑰規圭矽歸龜閨軌鬼詭癸桂櫃跪貴劊輥滾棍鍋郭國果裹過哈骸孩海氦亥害駭酣憨邯韓含涵寒函喊罕翰撼捍旱憾悍焊汗漢夯杭航壕嚎豪毫郝好耗號浩呵喝荷菏核禾和何合盒貉閡河涸赫褐鶴賀嘿黑痕很狠恨哼亨橫衡恒轟哄烘虹鴻洪宏弘紅喉侯猴吼厚候後呼乎忽瑚壺葫胡蝴狐糊湖弧虎唬護互滬戶花嘩華猾滑畫劃化話槐徊懷淮壞歡環桓還緩換患喚瘓豢煥渙宦幻荒慌黃磺蝗簧皇凰惶煌晃幌恍謊灰揮輝徽恢蛔回毀悔慧卉惠晦賄穢會燴匯諱誨繪葷昏婚魂渾混豁活夥火獲或惑霍貨禍擊圾基機畸稽積箕肌饑跡激譏雞姬績緝吉極棘輯籍集及急疾汲即嫉級擠幾脊己薊技冀季伎祭劑悸濟寄寂計記既忌際繼紀嘉枷夾佳家加莢頰賈甲鉀假稼價架駕嫁殲監堅尖箋間煎兼肩艱奸緘繭檢柬堿鹼揀撿簡儉剪減薦檻鑒踐賤見鍵箭件健艦劍餞漸濺澗建僵姜將漿江疆蔣槳獎講匠醬降蕉椒礁焦膠交郊澆驕嬌嚼攪鉸矯僥腳狡角餃繳絞剿教酵轎較叫窖揭接皆稭街階截劫節莖睛晶鯨京驚精粳經井警景頸靜境敬鏡徑痙靖竟競凈炯窘揪究糾玖韭久灸九酒廄救舊臼舅咎就疚鞠拘狙疽居駒菊局咀矩舉沮聚拒據巨具距踞鋸俱句懼炬劇捐鵑娟倦眷卷絹撅攫抉掘倔爵桔傑捷睫竭潔結解姐戒藉芥界借介疥誡屆巾筋斤金今津襟緊錦僅謹進靳晉禁近燼浸盡勁荊兢覺決訣絕均菌鈞軍君峻俊竣浚郡駿喀咖卡咯開揩楷凱慨刊堪勘坎砍看康慷糠扛抗亢炕考拷烤靠坷苛柯棵磕顆科殼咳可渴克刻客課肯啃墾懇坑吭空恐孔控摳口扣寇枯哭窟苦酷庫褲誇垮挎跨胯塊筷儈快寬款匡筐狂框礦眶曠況虧盔巋窺葵奎魁傀饋愧潰坤昆捆困括擴廓闊垃拉喇蠟臘辣啦萊來賴藍婪欄攔籃闌蘭瀾讕攬覽懶纜爛濫瑯榔狼廊郎朗浪撈勞牢老佬姥酪烙澇勒樂雷鐳蕾磊累儡壘擂肋類淚棱楞冷厘梨犁黎籬貍離漓理李裏鯉禮莉荔吏栗麗厲勵礫歷利傈例俐痢立粒瀝隸力璃哩倆聯蓮連鐮廉憐漣簾斂臉鏈戀煉練糧涼梁粱良兩輛量晾亮諒撩聊僚療燎寥遼潦了撂鐐廖料列裂烈劣獵琳林磷霖臨鄰鱗淋凜賃吝拎玲菱零齡鈴伶羚淩靈陵嶺領另令溜琉榴硫餾留劉瘤流柳六龍聾嚨籠窿隆壟攏隴樓婁摟簍漏陋蘆盧顱廬爐擄鹵虜魯麓碌露路賂鹿潞祿錄陸戮驢呂鋁侶旅履屢縷慮氯律率濾綠巒攣孿灤卵亂掠略掄輪倫侖淪綸論蘿螺羅邏鑼籮騾裸落洛駱絡媽麻瑪碼螞馬罵嘛嗎埋買麥賣邁脈瞞饅蠻滿蔓曼慢漫謾芒茫盲氓忙莽貓茅錨毛矛鉚卯茂冒帽貌貿麽玫枚梅酶黴煤沒眉媒鎂每美昧寐妹媚門悶們萌蒙檬盟錳猛夢孟瞇醚靡糜迷謎彌米秘覓泌蜜密冪棉眠綿冕免勉娩緬面苗描瞄藐秒渺廟妙蔑滅民抿皿敏憫閩明螟鳴銘名命謬摸摹蘑模膜磨摩魔抹末莫墨默沫漠寞陌謀牟某拇牡畝姆母墓暮幕募慕木目睦牧穆拿哪吶鈉那娜納氖乃奶耐奈南男難囊撓腦惱鬧淖呢餒內嫩能妮霓倪泥尼擬妳匿膩逆溺蔫拈年碾攆撚念娘釀鳥尿捏聶孽嚙鑷鎳涅您檸獰凝寧擰濘牛扭鈕紐膿濃農弄奴努怒女暖虐瘧挪懦糯諾哦歐鷗毆藕嘔偶漚啪趴爬帕怕琶拍排牌徘湃派攀潘盤磐盼畔判叛乓龐旁耪胖拋咆刨炮袍跑泡呸胚培裴賠陪配佩沛噴盆砰抨烹澎彭蓬棚硼篷膨朋鵬捧碰坯砒霹批披劈琵毗啤脾疲皮匹痞僻屁譬篇偏片騙飄漂瓢票撇瞥拼頻貧品聘乒坪蘋萍平憑瓶評屏坡潑頗婆破魄迫粕剖撲鋪仆莆葡菩蒲埔樸圃普浦譜曝瀑期欺棲戚妻七淒漆柒沏其棋奇歧畦崎臍齊旗祈祁騎起豈乞企啟契砌器氣迄棄汽泣訖掐洽牽扡釬鉛千遷簽仟謙乾黔錢鉗前潛遣淺譴塹嵌欠歉槍嗆腔羌墻薔強搶橇鍬敲悄橋瞧喬僑巧鞘撬翹峭俏竅切茄且怯竊欽侵親秦琴勤芹擒禽寢沁青輕氫傾卿清擎晴氰情頃請慶瓊窮秋丘邱球求囚酋泅趨區蛆曲軀屈驅渠取娶齲趣去圈顴權醛泉全痊拳犬券勸缺炔瘸卻鵲榷確雀裙群然燃冉染瓤壤攘嚷讓饒擾繞惹熱壬仁人忍韌任認刃妊紉扔仍日戎茸蓉榮融熔溶容絨冗揉柔肉茹蠕儒孺如辱乳汝入褥軟阮蕊瑞銳閏潤若弱撒灑薩腮鰓塞賽三三傘散桑嗓喪搔騷掃嫂瑟色澀森僧莎砂殺剎沙紗傻啥煞篩曬珊苫杉山刪煽衫閃陜擅贍膳善汕扇繕墑傷商賞晌上尚裳梢捎稍燒芍勺韶少哨邵紹奢賒蛇舌舍赦攝射懾涉社設砷申呻伸身深娠紳神沈審嬸甚腎慎滲聲生甥牲升繩省盛剩勝聖師失獅施濕詩屍虱十石拾時什食蝕實識史矢使屎駛始式示士世柿事拭誓逝勢是嗜噬適仕侍釋飾氏市恃室視試收手首守壽授售受瘦獸蔬樞梳殊抒輸叔舒淑疏書贖孰熟薯暑曙署蜀黍鼠屬術述樹束戍豎墅庶數漱恕刷耍摔衰甩帥栓拴霜雙爽誰水睡稅吮瞬順舜說碩朔爍斯撕嘶思私司絲死肆寺嗣四伺似飼巳松聳慫頌送宋訟誦搜艘擻嗽蘇酥俗素速粟僳塑溯宿訴肅酸蒜算雖隋隨綏髓碎歲穗遂隧祟孫損筍蓑梭唆縮瑣索鎖所塌他它她塔獺撻蹋踏胎苔擡臺泰酞太態汰坍攤貪癱灘壇檀痰潭譚談坦毯袒碳探嘆炭湯塘搪堂棠膛唐糖倘躺淌趟燙掏濤滔絳萄桃逃淘陶討套特藤騰疼謄梯剔踢銻提題蹄啼體替嚏惕涕剃屜天添填田甜恬舔腆挑條迢眺跳貼鐵帖廳聽烴汀廷停亭庭挺艇通桐酮瞳同銅彤童桶捅筒統痛偷投頭透凸禿突圖徒途塗屠土吐兔湍團推頹腿蛻褪退吞屯臀拖托脫鴕陀馱駝橢妥拓唾挖哇蛙窪娃瓦襪歪外豌彎灣玩頑丸烷完碗挽晚皖惋宛婉萬腕汪王亡枉網往旺望忘妄威巍微危韋違桅圍唯惟為濰維葦萎委偉偽尾緯未蔚味畏胃餵魏位渭謂尉慰衛瘟溫蚊文聞紋吻穩紊問嗡翁甕撾蝸渦窩我斡臥握沃巫嗚鎢烏汙誣屋無蕪梧吾吳毋武五捂午舞伍侮塢戊霧晤物勿務悟誤昔熙析西硒矽晰嘻吸錫犧稀息希悉膝夕惜熄烯溪汐犀檄襲席習媳喜銑洗系隙戲細瞎蝦匣霞轄暇峽俠狹下廈夏嚇掀鍁先仙鮮纖鹹賢銜舷閑涎弦嫌顯險現獻縣腺餡羨憲陷限線相廂鑲香箱襄湘鄉翔祥詳想響享項巷橡像向象蕭硝霄削哮囂銷消宵淆曉小孝校肖嘯笑效楔些歇蠍鞋協挾攜邪斜脅諧寫械卸蟹懈泄瀉謝屑薪芯鋅欣辛新忻心信釁星腥猩惺興刑型形邢行醒幸杏性姓兄兇胸匈洶雄熊休修羞朽嗅銹秀袖繡墟戌需虛噓須徐許蓄酗敘旭序畜恤絮婿緒續軒喧宣懸旋玄選癬眩絢靴薛學穴雪血勛熏循旬詢尋馴巡殉汛訓訊遜迅壓押鴉鴨呀丫芽牙蚜崖衙涯雅啞亞訝焉咽閹煙淹鹽嚴研蜒巖延言顏閻炎沿奄掩眼衍演艷堰燕厭硯雁唁彥焰宴諺驗殃央鴦秧楊揚佯瘍羊洋陽氧仰癢養樣漾邀腰妖瑤搖堯遙窯謠姚咬舀藥要耀椰噎耶爺野冶也頁掖業葉曳腋夜液壹壹醫揖銥依伊衣頤夷遺移儀胰疑沂宜姨彜椅蟻倚已乙矣以藝抑易邑屹億役臆逸肄疫亦裔意毅憶義益溢詣議誼譯異翼翌繹茵蔭因殷音陰姻吟銀淫寅飲尹引隱印英櫻嬰鷹應纓瑩螢營熒蠅迎贏盈影穎硬映喲擁傭臃癰庸雍踴蛹詠泳湧永恿勇用幽優悠憂尤由郵鈾猶油遊酉有友右佑釉誘又幼迂淤於盂榆虞愚輿余俞逾魚愉渝漁隅予娛雨與嶼禹宇語羽玉域芋郁籲遇喻峪禦愈欲獄育譽浴寓裕預豫馭鴛淵冤元垣袁原援轅園員圓猿源緣遠苑願怨院曰約越躍鑰嶽粵月悅閱耘雲鄖勻隕允運蘊醞暈韻孕匝砸雜栽哉災宰載再在咱攢暫贊贓臟葬遭糟鑿藻棗早澡蚤躁噪造皂竈燥責擇則澤賊怎增憎曾贈紮喳渣劄軋鍘閘眨柵榨咋乍炸詐摘齋宅窄債寨瞻氈詹粘沾盞斬輾嶄展蘸棧占戰站湛綻樟章彰漳張掌漲杖丈帳賬仗脹瘴障招昭找沼趙照罩兆肇召遮折哲蟄轍者鍺蔗這浙珍斟真甄砧臻貞針偵枕疹診震振鎮陣蒸掙睜征猙爭怔整拯正政幀癥鄭證芝枝支吱蜘知肢脂汁之織職直植殖執值侄址指止趾只旨紙誌摯擲至致置幟峙制智秩稚質炙痔滯治窒中盅忠鐘衷終種腫重仲眾舟周州洲謅粥軸肘帚咒皺宙晝驟珠株蛛朱豬諸誅逐竹燭煮拄矚囑主著柱助蛀貯鑄築住註祝駐抓爪拽專磚轉撰賺篆樁莊裝妝撞壯狀椎錐追贅墜綴諄準捉拙卓桌琢茁酌啄著灼濁茲咨資姿滋淄孜紫仔籽滓子自漬字鬃棕蹤宗綜總縱鄒走奏揍租足卒族祖詛阻組鉆纂嘴醉最罪尊遵昨左佐柞做作坐座錒噯嬡璦曖靄諳銨鵪媼驁鰲鈀唄鈑鴇齙鵯賁錛蓽嗶潷鉍篳蹕芐緶籩驃颮飆鏢鑣鰾儐繽檳殯臏鑌髕鬢稟餑鈸鵓鈽驂黲惻鍤儕釵囅諂讖蕆懺嬋驏覘禪鐔倀萇悵閶鯧硨傖諶櫬磣齔棖檉鋮鐺飭鴟銃儔幬讎芻絀躕釧愴綞鶉輟齪鶿蓯驄樅輳攛銼鹺噠韃駘紿殫賧癉簞讜碭襠燾鐙糴詆諦綈覿鏑巔鈿癲銚鯛鰈鋌銩崠鶇竇瀆櫝牘篤黷籪懟鐓燉躉鐸諤堊閼軛鋨鍔鶚顎顓鱷誒邇鉺鴯鮞鈁魴緋鐨鯡僨灃鳧駙紱紼賻麩鮒鰒釓賅尷搟紺戇睪誥縞鋯紇鎘潁亙賡綆鯁詬緱覯詁轂鈷錮鴣鵠鶻鴰摑詿摜鸛鰥獷匭劌媯檜鮭鱖袞緄鯀堝咼幗槨蟈鉿闞絎頡灝顥訶闔蠣黌訌葒閎鱟滸鶘驊樺鏵奐繯鍰鯇鰉詼薈噦澮繢琿暉諢餛閽鈥鑊訐詰薺嘰嚌驥璣覬齏磯羈蠆躋霽鱭鯽郟浹鋏鎵蟯諫縑戔戩瞼鶼筧鰹韉絳韁撟嶠鷦鮫癤頜鮚巹藎饉縉贐覲剄涇逕弳脛靚鬮鳩鷲詎屨櫸颶鉅鋦窶齟錈鐫雋譎玨皸剴塏愾愷鎧鍇龕閌鈧銬騍緙軻鈳錁頷齦鏗嚳鄶噲膾獪髖誆誑鄺壙纊貺匱蕢憒聵簣閫錕鯤蠐崍徠淶瀨賚睞錸癩籟嵐欖斕鑭襤閬鋃嘮嶗銠鐒癆鰳誄縲儷酈壢藶蒞蘺嚦邐驪縭櫪櫟轢礪鋰鸝癘糲躒靂鱺鱧蘞奩瀲璉殮褳襝鰱魎繚釕鷯藺廩檁轔躪綾欞蟶鯪瀏騮綹鎦鷚蘢瀧瓏櫳朧礱僂蔞嘍嶁鏤瘺耬螻髏壚擼嚕閭瀘淥櫨櫓轤輅轆氌臚鸕鷺艫鱸臠孌欒鸞鑾圇犖玀濼欏腡鏍櫚褸鋝嘸嘜嬤榪勱縵鏝顙鰻麼捫燜懣鍆羋謐獼禰澠靦黽緲繆閔緡謨驀饃歿鏌鉬鐃訥鈮鯢輦鯰蔦裊隉蘗囁顢躡苧嚀聹儂噥駑釹儺謳慪甌蹣皰轡紕羆鈹諞駢縹嬪釙鏷鐠蘄騏綺榿磧頎頏鰭僉蕁慳騫繾槧鈐嬙檣戧熗錆鏘鏹羥蹌誚譙蕎繰磽蹺愜鍥篋鋟撳鯖煢蛺巰賕蟣鰍詘嶇闃覷鴝詮綣輇銓闋闕愨蕘嬈橈飪軔嶸蠑縟銣顰蜆颯毿糝繅嗇銫穡鎩鯊釃訕姍騸釤鱔坰殤觴厙灄畬詵諗瀋謚塒蒔弒軾貰鈰鰣綬攄紓閂鑠廝駟緦鍶鷥藪餿颼鎪謖穌誶蓀猻嗩脧闥鉈鰨鈦鮐曇鉭錟頇儻餳鐋鏜韜鋱緹鵜闐糶齠鰷慟鈄釷摶飩籜鼉媧膃紈綰輞諉幃闈溈潿瑋韙煒鮪閿萵齷鄔廡憮嫵騖鵡鶩餼鬩璽覡硤莧薟蘚峴獫嫻鷴癇蠔秈躚薌餉驤緗饗嘵瀟驍綃梟簫褻擷紲纈陘滎饈鵂詡頊諼鉉鏇謔澩鱈塤潯鱘埡婭椏氬厴贗儼兗讞懨閆釅魘饜鼴煬軺鷂鰩靨謁鄴曄燁詒囈嶧飴懌驛縊軼貽釔鎰鐿瘞艤銦癮塋鶯縈鎣攖嚶瀅瀠瓔鸚癭頦罌鏞蕕銪魷傴俁諛諭蕷崳飫閾嫗紆覦歟鈺鵒鷸齬櫞鳶黿鉞鄆蕓惲慍紜韞殞氳瓚趲鏨駔賾嘖幘簀譖繒譫詔釗謫輒鷓湞縝楨軫賑禎鴆諍崢鉦錚箏騭櫛梔軹輊贄鷙螄縶躓躑觶鍾紂縐佇櫧銖囀饌顳騅縋諑鐲諮緇輜貲眥錙齜鯔傯諏騶鯫鏃纘躦鱒訁譾郤猛氹阪壟堖垵墊檾蕒葤蓧蒓菇槁摣咤唚哢噝噅撅劈謔襆嶴脊仿僥獁麅餘餷饊饢楞怵懍爿漵灩混濫瀦淡寧糸絝緔瑉梘棬案橰櫫軲軤賫膁腖飈糊煆溜湣渺碸滾瞘鈈鉕鋣銱鋥鋶鐦鐧鍩鍀鍃錇鎄鎇鎿鐝鑥鑹鑔穭鶓鶥鸌癧屙瘂臒襇繈耮顬蟎麯鮁鮃鮎鯗鯝鯴鱝鯿鰠鰵鱅鞽韝齇";function Nxe(e){return mSt.charAt(Bxe.indexOf(e.charAt(0)))}var KYt=new RegExp("[一-龥]+");function Uxe(e){return Bxe.includes(e)}var si=class{static GetBytes(e){switch(typeof e){case"string":{let t=new Uint16Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return new Uint8Array(t.buffer)}case"number":return e-Math.floor(e)==0?e>4294967295?((t=new Float64Array(1))[0]=e,new Uint8Array(t.buffer)):function(t){return t[0]=e,new Uint8Array(t.buffer)}(new Int32Array(1)):function(t){return t[0]=e,new Uint8Array(t.buffer)}(new Float64Array(1));case"boolean":return function(t){return t[0]=Number(e),t}(new Uint8Array(1));default:if(e instanceof Array){let t=[];for(let r=0;r<e.length;r++)t.push(si.GetBytes(e[r]));let r=0;for(let e=0;e<t.length;e++)r+=t[e].length;let i=new Uint8Array(r),n=0;for(let e=0;e<t.length;e++)for(let r=0;r<t[e].length;r++)i[n++]=t[e][r];return i}throw"Can't Convert To Bytes!!"}var t}static Get1Bytes(e){switch(typeof e){case"number":case"boolean":return new Uint8Array([Number(e)]);default:if(e instanceof Array){let t=[];for(let r=0;r<e.length;r++)t.push(this.Get1Bytes(e[r]));let r=0;for(let e=0;e<t.length;e++)r+=t[e].length;let i=new Uint8Array(r),n=0;for(let e=0;e<t.length;e++)for(let r=0;r<t[e].length;r++)i[n++]=t[e][r];return i}throw"Can't Convert To Bytes!!"}}static byteTosbyte(e){return(127&e)-(128&e?128:0)}static ToBoolean(e,t){return!!e[t=t||0]}static ToInt8(e,t){return 128&e[t=t||0]?-(1+(255^e[t])):e[t]}static ToUInt8(e,t){return e[t=t||0]}static ToInt16(e,t){t=t||0;let r=e.slice(t,t+2);return new Int16Array(r.buffer,0,1)[0]}static ToInt32(e,t){t=t||0;let r=e.slice(t,t+4);return new Int32Array(r.buffer,0,1)[0]}static ToUInt16(e,t){t=t||0;let r=e.slice(t,t+2);return new Uint16Array(r.buffer,0,1)[0]}static ToUInt32(e,t){t=t||0;let r=e.slice(t,t+4);return new Uint32Array(r.buffer,0,1)[0]}static ToChar(e,t){t=t||0;let r=e.slice(t,t+2);return String.fromCharCode(new Uint16Array(r.buffer,0,1)[0])}static ToAscii(e,t){return t=t||0,String.fromCharCode(e[t])}static ToAsciiString(e,t,r){t=t||0,(r=r||e.length)+t>e.length&&(r-=t);let i="";for(let n=0;n<r;n++)i+=String.fromCharCode(e[t+n]||0);return i}static ToUTF16String(e,t,r){t=t||0,(r=r||e.length)+t>e.length&&(r-=t);let i=new Uint8Array(r);for(let n=0;n<r;n++)i[n]=e[t+n]||0;return String.fromCharCode.apply(null,Array.from(new Uint16Array(i.buffer,0,r/2)))}static ToFloat32(e,t){t=t||0;let r=e.slice(t,t+4);return new Float32Array(r.buffer,0,1)[0]}static ToFloat64(e,t){t=t||0;let r=e.slice(t,t+8);return new Float64Array(r.buffer,0,1)[0]}},Yp=class{static parserHeader(e,t){let r="",i=!1,n=0;for(;;){let a=e.readInt8(),s=String.fromCharCode(a);if(i)s===t[n]?n++:(i=!1,n=0);else{if(s===t[n]){i=!0,n++;continue}r+=s}if(i&&n===t.length)break}return r}static getCode(e){let t=Fxe(e);return t.length<2?t[0]:t.length<4?si.ToUInt16(t,0):si.ToUInt32(t,0)}static parserCode(e,t,r){let i=new Te,n=[],a=[],s=[],o=!1;for(let l=0;l<t.length;l++){let h=t[l];switch(h){case 0:break;case 1:o=!0,a.push(i.clone());break;case 2:o=!1,a.length>1?(n.push(a.slice()),a=[]):i.set(0,0);break;case 3:l++,r/=t[l];break;case 4:l++,r*=t[l];break;case 5:if(4===s.length)throw"The position stack is only four locations deep";s.push(i);break;case 6:i=s.pop(),a.length>1&&(n.push(a.slice()),a=[]),o&&a.push(i.clone());break;case 7:{let s,o=0,h=r*e.baseUp,c=i.clone();switch(a.length>1&&(n.push(a.slice()),a=[]),e.fontType){case 0:l++,o=t[l];break;case 1:l++,o=t[l],0==o&&(l++,o=si.ToUInt16(new Uint8Array([t[l++],t[l++]]),0),c.x=t[l++]*r,c.y=t[l++]*r,h=t[l]*r);break;case 2:l+=2,o=si.ToUInt16(new Uint8Array([t[l-1],t[l]]),0)}0!==o&&(s=e.getGraphicDataByCodeWithOffset(o,h,c),s&&(n.push(...s.polylines.slice()),i=s.lastPoint.clone()))}break;case 8:{let e=new Te;e.x=si.byteTosbyte(t[++l]),e.y=si.byteTosbyte(t[++l]),i.add(e.multiplyScalar(r)),o&&a.push(i.clone())}break;case 9:for(;;){let e=new Te;if(e.x=si.byteTosbyte(t[++l]),e.y=si.byteTosbyte(t[++l]),0==e.x&&0==e.y)break;i.add(e.multiplyScalar(r)),o&&a.push(i.clone())}break;case 10:{let e=t[++l]*r,n=si.byteTosbyte(t[++l]),s=(112&n)>>4,h=7&n;0==h&&(h=8);let c=Math.PI/4,u=c*h,d=Yp.CIRCLE_SPAN;n<0&&(d=-d,u=-u);let p=c*s,f=p+u,m=i.clone().sub(new Te(Math.cos(p)*e,Math.sin(p)*e));if(i=m.clone().add(new Te(Math.cos(f)*e,Math.sin(f)*e)),o){let t=p,r=!0;for(;r&&(t+=d,n>=0&&t<f||n<0&&t>f);)a.push(m.clone().add(new Te(e*Math.cos(t),e*Math.sin(t))));a.push(i.clone())}}break;case 11:{let e=t[++l],n=t[++l],s=(255*t[++l]+t[++l])*r,h=si.byteTosbyte(t[++l]),c=(112&h)>>4,u=7&h;0==u&&(u=8),0!=n&&u--;let d=Math.PI/4,p=d*u,f=Yp.CIRCLE_SPAN,m=1;h<0&&(f=-f,p=-p,m=-1);let g=d*c,v=g+p;g+=d*e/256*m,v+=d*n/256*m;let y=i.clone().sub(new Te(s*Math.cos(g),s*Math.sin(g)));if(i=y.clone().add(new Te(s*Math.cos(v),s*Math.sin(v))),o){let e=g,t=!0;for(;t&&(e+=f,h>0&&e<v||h<0&&e>v);)a.push(y.clone().add(new Te(s*Math.cos(e),s*Math.sin(e))));a.push(i.clone())}}break;case 12:{let e=new Te;e.x=si.byteTosbyte(t[++l])*r,e.y=si.byteTosbyte(t[++l])*r;let n=si.byteTosbyte(t[++l]);n<-127&&(n=-127),o&&(0==n?a.push(i.clone().add(e)):a.push(Yp.generateArcPoints(i,e,n/127))),i.add(e)}break;case 13:for(;;){let e=new Te;if(e.x=si.byteTosbyte(t[++l])*r,e.y=si.byteTosbyte(t[++l])*r,0==e.x&&0==e.y)break;let n=si.byteTosbyte(t[++l]);n<-127&&(n=-127),o&&(0==n?a.push(i.clone().add(e)):a.push(Yp.generateArcPoints(i.clone(),e,n/127))),i.add(e)}break;case 14:l=Yp.skipCode(e,t,++l);break;default:if(h>15){let e=(240&h)>>4,t=15&h,n=new Te;switch(t){case 0:n.x=1;break;case 1:n.x=1,n.y=.5;break;case 2:n.x=1,n.y=1;break;case 3:n.x=.5,n.y=1;break;case 4:n.y=1;break;case 5:n.x=-.5,n.y=1;break;case 6:n.x=-1,n.y=1;break;case 7:n.x=-1,n.y=.5;break;case 8:n.x=-1;break;case 9:n.x=-1,n.y=-.5;break;case 10:n.x=-1,n.y=-1;break;case 11:n.x=-.5,n.y=-1;break;case 12:n.y=-1;break;case 13:n.x=.5,n.y=-1;break;case 14:n.x=1,n.y=-1;break;case 15:n.x=1,n.y=-.5}i.add(n.multiplyScalar(e*r)),o&&a.push(i.clone())}}}return new hf(i,n)}static skipCode(e,t,r){switch(t[r]){case 0:case 1:case 2:case 5:case 6:case 14:default:break;case 3:case 4:r++;break;case 7:switch(e.fontType){case 0:r++;break;case 1:0==t[++r]&&(r+=6);break;case 2:r+=2}break;case 8:case 10:r+=2;break;case 9:for(;;){let e=t[++r],i=t[++r];if(0==e&&0==i)break}break;case 11:r+=5;break;case 12:r+=3;break;case 13:for(;;){let e=t[++r],i=t[++r];if(0==e&&0==i)break;t[++r]}}return r}static generateArcPoints(e,t,r){let i=e.clone().add(t),n=r<0;r=Math.abs(r);let a=t.length()/2,s=a*r,o=2*Math.atan(1/r),l=new Te(t.y,-t.x);l.normalize(),l.multiplyScalar(s);let h=Math.abs(a/Math.sin(o/2)),c=e.add(t.divideScalar(2));!1!==n?c.add(l):c.sub(l);let u=e.sub(c),d=i.sub(c),p=Math.atan2(u.y,u.x),f=Math.atan2(d.y,d.x),m=Yp.CIRCLE_SPAN;n?(m=-m,p<f&&(p+=2*Math.PI)):p>f&&(p-=2*Math.PI);let g=p;for(;;){if(g+=m,!n&&g<f||n&&g>f)return c.add(new Te(h*Math.cos(g),h*Math.sin(g)));break}return i}},Pu=Yp;Pu.FILE_STOP_FLAG=["\r","\n",""],Pu.CIRCLE_SPAN=Math.PI/18;var LT=ra(Hxe(),1),Mc=class{constructor(e,t){this.endian=t&&"big"===t?"big":"little",this.position=0,this.data=new DataView(e)}readAsciiString(e){if(this.data.byteLength<this.position+e)throw"range error";let t="";for(let r=0;r<e;r++)t+=String.fromCharCode(this.data.getInt8(this.position+r));return this.position+=e,t}readUtf8String(e){let t=this.readBytes(e);return this.decoder||(this.decoder=new TextDecoder("utf-8")),this.decoder.decode(t)}readBytes(e=1){if(this.data.byteLength<this.position+e)throw"range error";let t=new Uint8Array(e);for(let r=0;r<e;r++)t[r]=this.data.getUint8(this.position+r);return this.position+=e,t}readUint8(){if(this.data.byteLength<this.position+1)throw"range error";let e=this.data.getUint8(this.position);return this.position+=1,e}readInt8(){if(this.data.byteLength<this.position+1)throw"range error";let e=this.data.getInt8(this.position);return this.position+=1,e}readUint16(){if(this.data.byteLength<this.position+2)throw"range error";let e=this.data.getUint16(this.position,"little"===this.endian);return this.position+=2,e}readInt16(){if(this.data.byteLength<this.position+2)throw"range error";let e=this.data.getInt16(this.position,"little"===this.endian);return this.position+=2,e}readUint32(){if(this.data.byteLength<this.position+4)throw"range error";let e=this.data.getUint32(this.position,"little"===this.endian);return this.position+=4,e}readInt32(){if(this.data.byteLength<this.position+4)throw"range error";let e=this.data.getInt32(this.position,"little"===this.endian);return this.position+=4,e}readFloat32(){if(this.data.byteLength<this.position+4)throw"range error";let e=this.data.getFloat32(this.position,"little"===this.endian);return this.position+=4,e}readFloat64(){if(this.data.byteLength<this.position+8)throw"range error";let e=this.data.getFloat64(this.position,"little"===this.endian);return this.position+=8,e}readInt64(){if(this.data.byteLength<this.position+8)throw"range error";let e=LT.default.DataViewGetBigInt64(this.data,this.position,"little"===this.endian);return this.position+=8,LT.default.toNumber(e)}readUint64(){if(this.data.byteLength<this.position+8)throw"range error";let e=LT.default.DataViewGetBigUint64(this.data,this.position,"little"===this.endian);return this.position+=8,LT.default.toNumber(e)}getPosition(){return this.position}setPosition(e){if(this.data.byteLength<e)throw"range error";this.position=e}isEnd(){return this.position===this.data.byteLength-1}},Vxe=new Wr,B3=class extends Z1{constructor(e,t){if(super(e,t),this.isExtend=!1,this.isUniCode=!0,this.isEmbedded=!1,this.fontType=2,this.textShapesCache=new Map,this.graphicData=new Map,t instanceof ArrayBuffer){let e=new Mc(t),r=Pu.parserHeader(e,Pu.FILE_STOP_FLAG).split(" ");switch(r[1]){case"shapes":this.parseShapeFont(e),this.fontType=0;break;case"bigfont":this.parseBigFont(e),this.fontType=1;break;case"unifont":this.parseUniFont(e),this.fontType=2}this.fileHeader=r[0],this.fileVersion=r[2]}else this.setFontFile(t)}generateShapes(e,t){let r=[],i=0;for(let n=0;n<e.length;n++){let a=e[n];if(" "===a){i+=t;continue}let s=this.getCharShape(a,t);s?(r.push(s.offset(new Te(i,0))),i+=s.width):(i+=t,this.addUnsupportedChar(a))}return r}getCharShape(e,t){Uxe(e)&&(e=Nxe(e));let r=Pu.getCode(e);0===r&&(r=e.charCodeAt(0));let i=this.getGraphicDataByCode(r,t);return i&&0===i.polylines.length&&(i.width=t),i}getGraphicDataByCode(e,t){let r=`${e}_${t}`;if(this.textShapesCache.has(r))return this.textShapesCache.get(r);if(0===e)return;let i,n=this.data;if(!this.graphicData.has(e))if(n[e]){let t=n[e],r=B3.DEFAULT_SIZE/this.baseUp;i=Pu.parserCode(this,t,r),this.graphicData.set(e,i)}else if(k3[e]){let t=[];for(let r=0;r<k3[e].length;r++)t.push(k3[e][r].map((e=>new Te(e[0],e[1]))));i=new hf(new Te,t),this.graphicData.set(e,i)}if(this.graphicData.has(e)){let r=t/B3.DEFAULT_SIZE;Vxe.identity().scale(r,r),i=this.graphicData.get(e).transform(Vxe)}return i}getGraphicDataByCodeWithOffset(e,t,r){var i;return null==(i=this.getGraphicDataByCode(e,t))?void 0:i.offset(r)}parseBigFont(e){si.ToInt16(e.readBytes(2),0);let t=si.ToInt16(e.readBytes(2),0),r=si.ToInt16(e.readBytes(2),0);for(let t=0;t<r;t++)e.readBytes(2),e.readBytes(2);let i=[];for(let r=0;r<t;r++){let t=e.readBytes(8),r=si.ToUInt16(new Uint8Array([t[1],t[0]]),0),n=si.ToUInt16(t,2),a=si.ToUInt32(t,4);0===r&&0===n&&0===a||i.push({code:r,length:n,offset:a})}let n={};for(let t of i)e.setPosition(t.offset),n[t.code]=e.readBytes(t.length);let a=n[0],s=(this.info=vSt(a)).indexOf("\0")+1;a.length-s==4?(this.baseUp=a[s++],this.baseDown=a[s++],this.orientation=a[s++]):(this.baseUp=a[s++],s++,this.orientation=a[s++],this.baseDown=a[s++],this.isExtend=!0),this.data=n}parseUniFont(e){let t=si.ToInt32(e.readBytes(4),0),r=si.ToInt16(e.readBytes(2),0),i=e.readBytes(r),n=(this.info=(new TextDecoder).decode(i)).indexOf("\0");this.baseUp=i[++n],this.baseDown=i[++n],this.orientation=i[++n],this.isUniCode=0==i[++n],this.isEmbedded=0==i[++n];let a={};for(let r=0;r<t-1;r++){let t=si.ToUInt16(e.readBytes(2),0),r=si.ToUInt16(e.readBytes(2),0);a[t]=e.readBytes(r)}this.data=a}parseShapeFont(e){e.readBytes(2),e.readBytes(2);let t=si.ToInt16(e.readBytes(2),0),r=[];for(let i=0;i<t;i++){let t=si.ToUInt16(e.readBytes(2),0),i=si.ToUInt16(e.readBytes(2),0);r.push({code:t,length:i})}let i={};for(let t of r)i[t.code]=e.readBytes(t.length);let n=i[0],a=(this.info=(new TextDecoder).decode(n)).indexOf("\0");this.baseUp=n[++a],this.baseDown=n[++a],this.orientation=n[++a],this.data=i}getNotFoundTextShape(e){let t=0;return 1===this.fontType&&(t=Pu.getCode("？")),2===this.fontType&&(t=Pu.getCode("?")),this.getGraphicDataByCode(t,e)}getFontFile(){return{fontType:this.fontType,order:this.order,data:this.data,info:this.info,orientation:this.orientation,baseUp:this.baseUp,baseDown:this.baseDown,fileName:this.fileName,fileHeader:this.fileHeader,fileVersion:this.fileVersion}}setFontFile(e){this.fileName=e.fileName,this.fontType=e.fontType||2,this.data=e.data,this.info=e.info,this.order=e.order,this.orientation=e.orientation,this.baseUp=e.baseUp,this.baseDown=e.baseDown,this.fileHeader=e.fileHeader,this.fileVersion=e.fileVersion}releaseFontData(){super.releaseFontData(),this.graphicData.clear(),this.textShapesCache.clear()}},df=B3;function vSt(e){let t,r,i,n,a;t="";let s=e.length;for(r=0;r<s;)switch(i=e[r++],i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(i);break;case 12:case 13:n=e[r++],t+=String.fromCharCode((31&i)<<6|63&n);break;case 14:n=e[r++],a=e[r++],t+=String.fromCharCode((15&i)<<12|(63&n)<<6|(63&a)<<0)}return t}df.DEFAULT_SIZE=12;var kl=class{constructor(){this.fontMap=new Map,this.unsupportedChars={},this.missingFonts={},this.enableFontCache=!0,this.loader=new Hn}loadFonts(e){return bt(this,null,(function*(){if(e=Array.isArray(e)?e:[e],this.fileNames=e.map((e=>kl.getFileName(e.toLowerCase()))),!(yield this.checkAllFontsLoaded(e))){for(let t=0;t<e.length;t++){let r,i=e[t],n=kl.getFileName(i).toLowerCase();if(kl.isJsonFile(i)){this.loader.setResponseType("json");let e=yield this.loader.loadAsync(i);r=new Xp(n,e)}else if(kl.isShxFile(i)){this.loader.setResponseType("arraybuffer");let e=yield this.loader.loadAsync(i);r=new df(n,e)}else if(kl.isTtfFile(i)){this.loader.setResponseType("arraybuffer");let e=yield this.loader.loadAsync(i);r=new Xp(n,e)}r&&(r.order=t+1,this.fontMap.set(n,r))}this.enableFontCache&&Pn.isBrowser&&(this.fontMap.forEach((e=>bt(this,null,(function*(){yield e.setFontDataToIndexedDb()})))),this.releaseFontData())}}))}getTextShape(e,t,r){if(0===this.fontMap.size)return void de.warn("[FontManager] no font loaded.");let i=this.fontMap.get(t.toLowerCase());return i||(i=this.fontMap.get(this.fontMap.keys().next().value),this.missingFonts[t]||(this.missingFonts[t]=0),this.missingFonts[t]++),null==i?void 0:i.generateShapes(e,r)}getCharShape(e,t,r){if(0===this.fontMap.size)return void de.warn("[FontManager] no font loaded.");null==t&&(t="");let i=this.fontMap.get(t.toLowerCase());if(!i){this.missingFonts[t]||(this.missingFonts[t]=0),this.missingFonts[t]++;for(let[t,n]of this.fontMap)if(n.getCharShape(e,r)){i=n;break}}let n=null==i?void 0:i.getCharShape(e,r);if(n){if(i instanceof df)return n.toThreeGeometry();if(i instanceof Xp)return new v3(e,{font:i,height:0,size:r||12,curveSegments:3,bevelSegments:3})}}getNotFoundTextShape(e){let t,r;for(let[i,n]of this.fontMap){let i=n.getNotFoundTextShape(e);if(i){t=i,r=n;break}}return r instanceof df?t.toThreeGeometry():r instanceof Xp?new va(t.toShapes(!1),{curveSegments:3,bevelSegments:3}):void 0}checkAllFontsLoaded(e){return bt(this,null,(function*(){if(!Pn.isBrowser)return!1;let t=!1;for(let r=0;r<e.length;r++){let i=e[r],n=kl.getFileName(i.toLowerCase()),a=yield uf.instance().query(n);if(!a){t=!1;break}if(t=!0,void 0!==a.codes){t=!1;break}}return t}))}getFontFromIndexeddb(){return bt(this,null,(function*(){if(0!==this.fontMap.size)return;let e=(yield uf.instance().queryAll()).sort(((e,t)=>e.order-t.order));for(let t=0;t<e.length;t++){let r,i=e[t],{fileName:n,fontType:a}=i;this.fileNames&&!this.fileNames.includes(n)||(r=a?new df(n,i):new Xp(n,i),this.fontMap.set(n,r))}de.debug("[FontManager] Loaded font data from cache.")}))}isShxFont(e){if(0===this.fontMap.size)return void de.warn("[FontManager] no font loaded.");let t=this.fontMap.get(e);return t||(t=this.fontMap.get(this.fontMap.keys().next().value),this.missingFonts[e]||(this.missingFonts[e]=0),this.missingFonts[e]++),t instanceof df}getUnsupportedChar(){return this.fontMap.forEach((e=>{Object.assign(this.unsupportedChars,e.unsupportedChars)})),this.unsupportedChars}releaseFontData(){this.fontMap.forEach((e=>{e.releaseFontData()})),this.fontMap.clear()}destroy(){this.releaseFontData(),this.fontMap.clear()}static isShxFile(e){return"shx"===Ut.getExtension(e)}static isTtfFile(e){return["WOFF","OTF","TTF"].includes(Ut.getExtension(e).toUpperCase())}static isJsonFile(e){return"json"===Ut.getExtension(e)}static getFileName(e){let t=e.lastIndexOf("/");return e.substring(t+1)}},zxe=class{constructor(e){this.object=e}instantiate(){let e=Date.now();this.instantiateInner(this.object),console.log(`[Inst] instantiate() costed ${(Date.now()-e)/1e3}s`)}instantiateInner(e){if(!e.children||0===e.children.length)return;let t=e.children.length,r={},i=[];for(let n=0;n<t;++n){let t=e.children[n];if(this.instantiateInner(t),t.children&&t.children.length>0||!t.geometry)continue;let a=!1,s=Object.values(r);for(let o=s.length-1;o>=0;--o){let l=s[o].indexes[0],h=e.children[l];if(this.geometryEquals(t.geometry,h.geometry)&&$i.materialsEquals(t.material,h.material)){r[l]||(r[l]={indexes:[l]},this.removeFromArray(i,l)),r[l].indexes.push(n),a=!0;break}}for(let s=i.length-1;!a&&s>=0;--s){let o=i[s],l=e.children[o];if(this.geometryEquals(t.geometry,l.geometry)&&$i.materialsEquals(t.material,l.material)){r[o]||(r[o]={indexes:[o]},this.removeFromArray(i,o)),r[o].indexes.push(n),a=!0;break}}a||i.push(n)}if(Object.keys(r).length<=0)return;let n=[],a=[];Object.values(r).forEach((t=>{let r=t.indexes;a.push(...r);let i=e.children[r[0]],s=i.material;if(s instanceof qn)s=s.clone();else if(Array.isArray(s)){let e=[];s.forEach((t=>e.push(t.clone()))),s=e}let o=new ls(i.geometry,s,r.length);o.name=`[Instanced] ${i.name}`;for(let t=0;t<r.length;++t){let i=r[t],n=e.children[i];n.updateMatrix(),o.setMatrixAt(t,n.matrix)}o.matrixAutoUpdate=!1,o.updateMatrix(),n.push(o)})),a.sort(((e,t)=>t-e)),a.forEach((t=>e.remove(e.children[t]))),n.forEach((t=>{t.parent=e,e.children.push(t)})),e.updateMatrix(),console.log(`[Inst] ${a.length}(out of ${t}) objects instanced to ${n.length} InstancedMesh`)}removeFromArray(e,t){for(let r=e.length-1;r>=0;--r)if(e[r]===t)return void e.splice(r,1)}geometryEquals(e,t){return pr.geometriesEqual(e,t)}},K1=class{constructor(){this.TIMEOUT="timeout",this.INTERVAL="interval",this.timeoutMap={},this.intervalMap={}}run(e=this.INTERVAL,t,r=16.7){let i=Date.now,n=i(),a=n,s=Symbol(""),o=()=>{this.setIdMap(s,e,o),a=i(),a-n>=r&&(e===this.intervalMap&&(n=i(),a=n),t(),e===this.TIMEOUT&&this.clearTimeout(s))};return this.setIdMap(s,e,o),s}setIdMap(e,t,r){let i=requestAnimationFrame(r);t===this.INTERVAL?this.intervalMap[e]=i:t===this.TIMEOUT&&(this.timeoutMap[e]=i)}setTimeout(e,t){return this.run(this.TIMEOUT,e,t)}clearTimeout(e){cancelAnimationFrame(this.timeoutMap[e])}setInterval(e,t){return this.run(this.INTERVAL,e,t)}clearInterval(e){cancelAnimationFrame(this.intervalMap[e])}},Gxe=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},ySt=function(e){return new Worker(e)};try{URL.revokeObjectURL(Gxe(""))}catch(e){Gxe=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},ySt=function(e){return new Worker(e,{type:"module"})}}var Ac=Uint8Array,$p=Uint16Array,yz=Uint32Array,qxe=new Ac([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),jxe=new Ac([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),bSt=new Ac([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Wxe=function(e,t){for(var r=new $p(31),i=0;i<31;++i)r[i]=t+=1<<e[i-1];var n=new yz(r[30]);for(i=1;i<30;++i)for(var a=r[i];a<r[i+1];++a)n[a]=a-r[i]<<5|i;return[r,n]},Xxe=Wxe(qxe,2),Yxe=Xxe[0],xSt=Xxe[1];Yxe[28]=258,xSt[258]=28;var $xe=Wxe(jxe,0),ESt=$xe[0],R$t=$xe[1],bz=new $p(32768);for(Ri=0;Ri<32768;++Ri)ff=(43690&Ri)>>>1|(21845&Ri)<<1,ff=(52428&ff)>>>2|(13107&ff)<<2,ff=(61680&ff)>>>4|(3855&ff)<<4,bz[Ri]=((65280&ff)>>>8|(255&ff)<<8)>>>1;var ff,Ri,kT=function(e,t,r){for(var i=e.length,n=0,a=new $p(t);n<i;++n)++a[e[n]-1];var s,o=new $p(t);for(n=0;n<t;++n)o[n]=o[n-1]+a[n-1]<<1;if(r){s=new $p(1<<t);var l=15-t;for(n=0;n<i;++n)if(e[n])for(var h=n<<4|e[n],c=t-e[n],u=o[e[n]-1]++<<c,d=u|(1<<c)-1;u<=d;++u)s[bz[u]>>>l]=h}else for(s=new $p(i),n=0;n<i;++n)e[n]&&(s[n]=bz[o[e[n]-1]++]>>>15-e[n]);return s},FT=new Ac(288),Ri,Ri,Ri;for(Ri=0;Ri<144;++Ri)FT[Ri]=8;for(Ri=144;Ri<256;++Ri)FT[Ri]=9;for(Ri=256;Ri<280;++Ri)FT[Ri]=7;for(Ri=280;Ri<288;++Ri)FT[Ri]=8;var Ri,Zxe=new Ac(32),Ri;for(Ri=0;Ri<32;++Ri)Zxe[Ri]=5;var _St=kT(FT,9,1),TSt=kT(Zxe,5,1),gz=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},Iu=function(e,t,r){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&r},vz=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},wSt=function(e){return(e/8|0)+(7&e&&1)},SSt=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var i=new(e instanceof $p?$p:e instanceof yz?yz:Ac)(r-t);return i.set(e.subarray(t,r)),i},MSt=function(e,t,r){var i=e.length;if(!i||r&&!r.l&&i<5)return t||new Ac(0);var n=!t||r,a=!r||r.i;r||(r={}),t||(t=new Ac(3*i));var s=function(e){var r=t.length;if(e>r){var i=new Ac(Math.max(2*r,e));i.set(t),t=i}},o=r.f||0,l=r.p||0,h=r.b||0,c=r.l,u=r.d,d=r.m,p=r.n,f=8*i;do{if(!c){r.f=o=Iu(e,l,1);var m=Iu(e,l+1,3);if(l+=3,!m){var g=e[(A=wSt(l)+4)-4]|e[A-3]<<8,v=A+g;if(v>i){if(a)throw"unexpected EOF";break}n&&s(h+g),t.set(e.subarray(A,v),h),r.b=h+=g,r.p=l=8*v;continue}if(1==m)c=_St,u=TSt,d=9,p=5;else{if(2!=m)throw"invalid block type";var y=Iu(e,l,31)+257,b=Iu(e,l+10,15)+4,x=y+Iu(e,l+5,31)+1;l+=14;for(var _=new Ac(x),w=new Ac(19),S=0;S<b;++S)w[bSt[S]]=Iu(e,l+3*S,7);l+=3*b;var T=gz(w),M=(1<<T)-1,E=kT(w,T,1);for(S=0;S<x;){var A,C=E[Iu(e,l,M)];if(l+=15&C,(A=C>>>4)<16)_[S++]=A;else{var P=0,R=0;for(16==A?(R=3+Iu(e,l,3),l+=2,P=_[S-1]):17==A?(R=3+Iu(e,l,7),l+=3):18==A&&(R=11+Iu(e,l,127),l+=7);R--;)_[S++]=P}}var I=_.subarray(0,y),O=_.subarray(y);d=gz(I),p=gz(O),c=kT(I,d,1),u=kT(O,p,1)}if(l>f){if(a)throw"unexpected EOF";break}}n&&s(h+131072);for(var L=(1<<d)-1,D=(1<<p)-1,k=l;;k=l){var F=(P=c[vz(e,l)&L])>>>4;if((l+=15&P)>f){if(a)throw"unexpected EOF";break}if(!P)throw"invalid length/literal";if(F<256)t[h++]=F;else{if(256==F){k=l,c=null;break}var N=F-254;if(F>264){var U=qxe[S=F-257];N=Iu(e,l,(1<<U)-1)+Yxe[S],l+=U}var B=u[vz(e,l)&D],z=B>>>4;if(!B)throw"invalid distance";l+=15&B;O=ESt[z];if(z>3){U=jxe[z];O+=vz(e,l)&(1<<U)-1,l+=U}if(l>f){if(a)throw"unexpected EOF";break}n&&s(h+131072);for(var H=h+N;h<H;h+=4)t[h]=t[h-O],t[h+1]=t[h+1-O],t[h+2]=t[h+2-O],t[h+3]=t[h+3-O];h=H}}r.l=c,r.p=k,r.b=h,c&&(o=1,r.m=d,r.d=u,r.n=p)}while(!o);return h==t.length?t:SSt(t,0,h)},ASt=new Ac(0),RSt=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function v0(e,t){return MSt((RSt(e),e.subarray(2,-4)),t)}var CSt="undefined"!=typeof TextDecoder&&new TextDecoder,PSt=0;try{CSt.decode(ASt,{stream:!0}),PSt=1}catch(e){}var N3=class extends tf{constructor(e){super(e),this.type=Cn}parse(e){let t=Math.pow(2.7182818,2.2);let r={l:0,c:0,lc:0};function i(e,t,i,n,a){for(;i<e;)t=t<<8|N(n,a),i+=8;i-=e,r.l=t>>i&(1<<e)-1,r.c=t,r.lc=i}let n=new Array(59);function a(e,t,a,s,o,l){let h=t,c=0,u=0;for(;s<=o;s++){if(h.value-t.value>a)return!1;i(6,c,u,e,h);let n=r.l;if(c=r.c,u=r.lc,l[s]=n,63==n){if(h.value-t.value>a)throw new Error("Something wrong with hufUnpackEncTable");i(8,c,u,e,h);let n=r.l+6;if(c=r.c,u=r.lc,s+n>o+1)throw new Error("Something wrong with hufUnpackEncTable");for(;n--;)l[s++]=0;s--}else if(n>=59){let e=n-59+2;if(s+e>o+1)throw new Error("Something wrong with hufUnpackEncTable");for(;e--;)l[s++]=0;s--}}!function(e){for(let e=0;e<=58;++e)n[e]=0;for(let t=0;t<65537;++t)n[e[t]]+=1;let t=0;for(let e=58;e>0;--e){let r=t+n[e]>>1;n[e]=t,t=r}for(let t=0;t<65537;++t){let r=e[t];r>0&&(e[t]=r|n[r]++<<6)}}(l)}function s(e){return 63&e}function o(e){return e>>6}let l={c:0,lc:0};function h(e,t,r,i){e=e<<8|N(r,i),t+=8,l.c=e,l.lc=t}let c={c:0,lc:0};function u(e,t,r,i,n,a,s,o,u){if(e==t){i<8&&(h(r,i,n,a),r=l.c,i=l.lc);let e=r>>(i-=8);if(e=new Uint8Array([e])[0],o.value+e>u)return!1;let t=s[o.value-1];for(;e-- >0;)s[o.value++]=t}else{if(!(o.value<u))return!1;s[o.value++]=e}c.c=r,c.lc=i}function d(e){return 65535&e}function p(e){let t=d(e);return t>32767?t-65536:t}let f={a:0,b:0};function m(e,t){let r=p(e),i=p(t),n=r+(1&i)+(i>>1),a=n,s=n-i;f.a=a,f.b=s}function g(e,t){let r=d(e),i=d(t),n=r-(i>>1)&65535,a=i+n-32768&65535;f.a=a,f.b=n}function v(e,t,r,i,n,a,s){let o,l,h=s<16384,c=r>n?n:r,u=1;for(;u<=c;)u<<=1;for(u>>=1,o=u,u>>=1;u>=1;){l=0;let s,c,d,p,v=l+a*(n-o),y=a*u,b=a*o,x=i*u,_=i*o;for(;l<=v;l+=b){let n=l,a=l+i*(r-o);for(;n<=a;n+=_){let r=n+x,i=n+y,a=i+x;h?(m(e[n+t],e[i+t]),s=f.a,d=f.b,m(e[r+t],e[a+t]),c=f.a,p=f.b,m(s,c),e[n+t]=f.a,e[r+t]=f.b,m(d,p),e[i+t]=f.a,e[a+t]=f.b):(g(e[n+t],e[i+t]),s=f.a,d=f.b,g(e[r+t],e[a+t]),c=f.a,p=f.b,g(s,c),e[n+t]=f.a,e[r+t]=f.b,g(d,p),e[i+t]=f.a,e[a+t]=f.b)}if(r&u){let r=n+y;h?m(e[n+t],e[r+t]):g(e[n+t],e[r+t]),s=f.a,e[r+t]=f.b,e[n+t]=s}}if(n&u){let n=l,a=l+i*(r-o);for(;n<=a;n+=_){let r=n+x;h?m(e[n+t],e[r+t]):g(e[n+t],e[r+t]),s=f.a,e[r+t]=f.b,e[n+t]=s}}o=u,u>>=1}return l}function y(e,t,r,i,n,d){let p=r.value,f=F(t,r),m=F(t,r);r.value+=4;let g=F(t,r);if(r.value+=4,f<0||f>=65537||m<0||m>=65537)throw new Error("Something wrong with HUF_ENCSIZE");let v=new Array(65537),y=new Array(16384);if(function(e){for(let t=0;t<16384;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(y),a(e,r,i-(r.value-p),f,m,v),g>8*(i-(r.value-p)))throw new Error("Something wrong with hufUncompress");(function(e,t,r,i){for(;t<=r;t++){let r=o(e[t]),n=s(e[t]);if(r>>n)throw new Error("Invalid table entry");if(n>14){let e=i[r>>n-14];if(e.len)throw new Error("Invalid table entry");if(e.lit++,e.p){let t=e.p;e.p=new Array(e.lit);for(let r=0;r<e.lit-1;++r)e.p[r]=t[r]}else e.p=new Array(1);e.p[e.lit-1]=t}else if(n){let e=0;for(let a=1<<14-n;a>0;a--){let a=i[(r<<14-n)+e];if(a.len||a.p)throw new Error("Invalid table entry");a.len=n,a.lit=t,e++}}}})(v,f,m,y),function(e,t,r,i,n,a,d,p,f){let m=0,g=0,v=d,y=Math.trunc(i.value+(n+7)/8);for(;i.value<y;)for(h(m,g,r,i),m=l.c,g=l.lc;g>=14;){let n=t[m>>g-14&16383];if(n.len)g-=n.len,u(n.lit,a,m,g,r,i,p,f,v),m=c.c,g=c.lc;else{if(!n.p)throw new Error("hufDecode issues");let t;for(t=0;t<n.lit;t++){let d=s(e[n.p[t]]);for(;g<d&&i.value<y;)h(m,g,r,i),m=l.c,g=l.lc;if(g>=d&&o(e[n.p[t]])==(m>>g-d&(1<<d)-1)){g-=d,u(n.p[t],a,m,g,r,i,p,f,v),m=c.c,g=c.lc;break}}if(t==n.lit)throw new Error("hufDecode issues")}}let b=8-n&7;for(m>>=b,g-=b;g>0;){let e=t[m<<14-g&16383];if(!e.len)throw new Error("hufDecode issues");g-=e.len,u(e.lit,a,m,g,r,i,p,f,v),m=c.c,g=c.lc}}(v,y,e,r,g,m,d,n,{value:0})}function b(e){for(let t=1;t<e.length;t++){let r=e[t-1]+e[t]-128;e[t]=r}}function x(e,t){let r=0,i=Math.floor((e.length+1)/2),n=0,a=e.length-1;for(;!(n>a||(t[n++]=e[r++],n>a));)t[n++]=e[i++]}function _(e){let t=e.byteLength,r=new Array,i=0,n=new DataView(e);for(;t>0;){let e=n.getInt8(i++);if(e<0){let a=-e;t-=a+1;for(let e=0;e<a;e++)r.push(n.getUint8(i++))}else{let a=e;t-=2;let s=n.getUint8(i++);for(let e=0;e<a+1;e++)r.push(s)}}return r}function w(e,t,r){let i,n=1;for(;n<64;)i=t[e.value],65280==i?n=64:i>>8==255?n+=255&i:(r[n]=i,n++),e.value++}function S(e,t){t[0]=V(e[0]),t[1]=V(e[1]),t[2]=V(e[5]),t[3]=V(e[6]),t[4]=V(e[14]),t[5]=V(e[15]),t[6]=V(e[27]),t[7]=V(e[28]),t[8]=V(e[2]),t[9]=V(e[4]),t[10]=V(e[7]),t[11]=V(e[13]),t[12]=V(e[16]),t[13]=V(e[26]),t[14]=V(e[29]),t[15]=V(e[42]),t[16]=V(e[3]),t[17]=V(e[8]),t[18]=V(e[12]),t[19]=V(e[17]),t[20]=V(e[25]),t[21]=V(e[30]),t[22]=V(e[41]),t[23]=V(e[43]),t[24]=V(e[9]),t[25]=V(e[11]),t[26]=V(e[18]),t[27]=V(e[24]),t[28]=V(e[31]),t[29]=V(e[40]),t[30]=V(e[44]),t[31]=V(e[53]),t[32]=V(e[10]),t[33]=V(e[19]),t[34]=V(e[23]),t[35]=V(e[32]),t[36]=V(e[39]),t[37]=V(e[45]),t[38]=V(e[52]),t[39]=V(e[54]),t[40]=V(e[20]),t[41]=V(e[22]),t[42]=V(e[33]),t[43]=V(e[38]),t[44]=V(e[46]),t[45]=V(e[51]),t[46]=V(e[55]),t[47]=V(e[60]),t[48]=V(e[21]),t[49]=V(e[34]),t[50]=V(e[37]),t[51]=V(e[47]),t[52]=V(e[50]),t[53]=V(e[56]),t[54]=V(e[59]),t[55]=V(e[61]),t[56]=V(e[35]),t[57]=V(e[36]),t[58]=V(e[48]),t[59]=V(e[49]),t[60]=V(e[57]),t[61]=V(e[58]),t[62]=V(e[62]),t[63]=V(e[63])}function T(e){let t=.5*Math.cos(.7853975),r=.5*Math.cos(3.14159/16),i=.5*Math.cos(3.14159/8),n=.5*Math.cos(3*3.14159/16),a=.5*Math.cos(.981746875),s=.5*Math.cos(3*3.14159/8),o=.5*Math.cos(1.374445625),l=new Array(4),h=new Array(4),c=new Array(4),u=new Array(4);for(let d=0;d<8;++d){let p=8*d;l[0]=i*e[p+2],l[1]=s*e[p+2],l[2]=i*e[p+6],l[3]=s*e[p+6],h[0]=r*e[p+1]+n*e[p+3]+a*e[p+5]+o*e[p+7],h[1]=n*e[p+1]-o*e[p+3]-r*e[p+5]-a*e[p+7],h[2]=a*e[p+1]-r*e[p+3]+o*e[p+5]+n*e[p+7],h[3]=o*e[p+1]-a*e[p+3]+n*e[p+5]-r*e[p+7],c[0]=t*(e[p+0]+e[p+4]),c[3]=t*(e[p+0]-e[p+4]),c[1]=l[0]+l[3],c[2]=l[1]-l[2],u[0]=c[0]+c[1],u[1]=c[3]+c[2],u[2]=c[3]-c[2],u[3]=c[0]-c[1],e[p+0]=u[0]+h[0],e[p+1]=u[1]+h[1],e[p+2]=u[2]+h[2],e[p+3]=u[3]+h[3],e[p+4]=u[3]-h[3],e[p+5]=u[2]-h[2],e[p+6]=u[1]-h[1],e[p+7]=u[0]-h[0]}for(let d=0;d<8;++d)l[0]=i*e[16+d],l[1]=s*e[16+d],l[2]=i*e[48+d],l[3]=s*e[48+d],h[0]=r*e[8+d]+n*e[24+d]+a*e[40+d]+o*e[56+d],h[1]=n*e[8+d]-o*e[24+d]-r*e[40+d]-a*e[56+d],h[2]=a*e[8+d]-r*e[24+d]+o*e[40+d]+n*e[56+d],h[3]=o*e[8+d]-a*e[24+d]+n*e[40+d]-r*e[56+d],c[0]=t*(e[d]+e[32+d]),c[3]=t*(e[d]-e[32+d]),c[1]=l[0]+l[3],c[2]=l[1]-l[2],u[0]=c[0]+c[1],u[1]=c[3]+c[2],u[2]=c[3]-c[2],u[3]=c[0]-c[1],e[0+d]=u[0]+h[0],e[8+d]=u[1]+h[1],e[16+d]=u[2]+h[2],e[24+d]=u[3]+h[3],e[32+d]=u[3]-h[3],e[40+d]=u[2]-h[2],e[48+d]=u[1]-h[1],e[56+d]=u[0]-h[0]}function M(e){for(let t=0;t<64;++t){let r=e[0][t],i=e[1][t],n=e[2][t];e[0][t]=r+1.5747*n,e[1][t]=r-.1873*i-.4682*n,e[2][t]=r+1.8556*i}}function E(e,t,r){for(let i=0;i<64;++i)t[r+i]=nf.toHalfFloat(A(e[i]))}function A(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(t,Math.abs(e)-1)}function C(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function P(e){let t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),r=new Uint8Array(_(t)),i=new Uint8Array(r.length);return b(r),x(r,i),new DataView(i.buffer)}function R(e){let t=v0(e.array.slice(e.offset.value,e.offset.value+e.size)),r=new Uint8Array(t.length);return b(t),x(t,r),new DataView(r.buffer)}function I(e){let t=e.viewer,r={value:e.offset.value},i=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),n=new Uint8Array(8192),a=0,s=new Array(e.channels);for(let t=0;t<e.channels;t++)s[t]={},s[t].start=a,s[t].end=s[t].start,s[t].nx=e.width,s[t].ny=e.lines,s[t].size=e.type,a+=s[t].nx*s[t].ny*s[t].size;let o=j(t,r),l=j(t,r);if(l>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(o<=l)for(let e=0;e<l-o+1;e++)n[e+o]=U(t,r);let h=new Uint16Array(65536),c=function(e,t){let r=0;for(let i=0;i<65536;++i)(0==i||e[i>>3]&1<<(7&i))&&(t[r++]=i);let i=r-1;for(;r<65536;)t[r++]=0;return i}(n,h),u=F(t,r);y(e.array,t,r,u,i,a);for(let t=0;t<e.channels;++t){let e=s[t];for(let r=0;r<s[t].size;++r)v(i,e.start+r,e.nx,e.size,e.ny,e.nx*e.size,c)}!function(e,t,r){for(let i=0;i<r;++i)t[i]=e[t[i]]}(h,i,a);let d=0,p=new Uint8Array(i.buffer.byteLength);for(let t=0;t<e.lines;t++)for(let t=0;t<e.channels;t++){let e=s[t],r=e.nx*e.size,n=new Uint8Array(i.buffer,2*e.end,2*r);p.set(n,d),d+=2*r,e.end+=r}return new DataView(p.buffer)}function O(e){let t=v0(e.array.slice(e.offset.value,e.offset.value+e.size)),r=e.lines*e.channels*e.width,i=1==e.type?new Uint16Array(r):new Uint32Array(r),n=0,a=0,s=new Array(4);for(let r=0;r<e.lines;r++)for(let r=0;r<e.channels;r++){let r=0;switch(e.type){case 1:s[0]=n,s[1]=s[0]+e.width,n=s[1]+e.width;for(let n=0;n<e.width;++n){r+=t[s[0]++]<<8|t[s[1]++],i[a]=r,a++}break;case 2:s[0]=n,s[1]=s[0]+e.width,s[2]=s[1]+e.width,n=s[2]+e.width;for(let n=0;n<e.width;++n){r+=t[s[0]++]<<24|t[s[1]++]<<16|t[s[2]++]<<8,i[a]=r,a++}}}return new DataView(i.buffer)}function L(e){let t=e.viewer,r={value:e.offset.value},i=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),n={version:B(t,r),unknownUncompressedSize:B(t,r),unknownCompressedSize:B(t,r),acCompressedSize:B(t,r),dcCompressedSize:B(t,r),rleCompressedSize:B(t,r),rleUncompressedSize:B(t,r),rleRawSize:B(t,r),totalAcUncompressedCount:B(t,r),totalDcUncompressedCount:B(t,r),acCompression:B(t,r)};if(n.version<2)throw new Error("EXRLoader.parse: "+$.compression+" version "+n.version+" is unsupported");let a=new Array,s=j(t,r)-2;for(;s>0;){let e=D(t.buffer,r),i=U(t,r),n=i>>2&3,o=new Int8Array([(i>>4)-1])[0],l=U(t,r);a.push({name:e,index:o,type:l,compression:n}),s-=e.length+3}let o=$.channels,l=new Array(e.channels);for(let t=0;t<e.channels;++t){let r=l[t]={},i=o[t];r.name=i.name,r.compression=0,r.decoded=!1,r.type=i.pixelType,r.pLinear=i.pLinear,r.width=e.width,r.height=e.lines}let h,c,u,d={idx:new Array(3)};for(let t=0;t<e.channels;++t){let e=l[t];for(let r=0;r<a.length;++r){let i=a[r];e.name==i.name&&(e.compression=i.compression,i.index>=0&&(d.idx[i.index]=t),e.offset=t)}}if(n.acCompressedSize>0)switch(n.acCompression){case 0:h=new Uint16Array(n.totalAcUncompressedCount),y(e.array,t,r,n.acCompressedSize,h,n.totalAcUncompressedCount);break;case 1:let i=v0(e.array.slice(r.value,r.value+n.totalAcUncompressedCount));h=new Uint16Array(i.buffer),r.value+=n.totalAcUncompressedCount}if(n.dcCompressedSize>0){let t={array:e.array,offset:r,size:n.dcCompressedSize};c=new Uint16Array(R(t).buffer),r.value+=n.dcCompressedSize}if(n.rleRawSize>0){u=_(v0(e.array.slice(r.value,r.value+n.rleCompressedSize)).buffer),r.value+=n.rleCompressedSize}let p=0,f=new Array(l.length);for(let e=0;e<f.length;++e)f[e]=new Array;for(let t=0;t<e.lines;++t)for(let t=0;t<l.length;++t)f[t].push(p),p+=l[t].width*e.type*2;!function(e,t,r,i,n,a){let s=new DataView(a.buffer),o=r[e.idx[0]].width,l=r[e.idx[0]].height,h=Math.floor(o/8),c=Math.ceil(o/8),u=Math.ceil(l/8),d=o-8*(c-1),p=l-8*(u-1),f={value:0},m=new Array(3),g=new Array(3),v=new Array(3),y=new Array(3),b=new Array(3);for(let r=0;r<3;++r)b[r]=t[e.idx[r]],m[r]=r<1?0:m[r-1]+c*u,g[r]=new Float32Array(64),v[r]=new Uint16Array(64),y[r]=new Uint16Array(64*c);for(let t=0;t<u;++t){let a=8;t==u-1&&(a=p);let o=8;for(let e=0;e<c;++e){e==c-1&&(o=d);for(let e=0;e<3;++e)v[e].fill(0),v[e][0]=n[m[e]++],w(f,i,v[e]),S(v[e],g[e]),T(g[e]);M(g);for(let t=0;t<3;++t)E(g[t],y[t],64*e)}let l=0;for(let i=0;i<3;++i){let n=r[e.idx[i]].type;for(let e=8*t;e<8*t+a;++e){l=b[i][e];for(let t=0;t<h;++t){let r=64*t+8*(7&e);s.setUint16(l+0*n,y[i][r+0],!0),s.setUint16(l+2*n,y[i][r+1],!0),s.setUint16(l+4*n,y[i][r+2],!0),s.setUint16(l+6*n,y[i][r+3],!0),s.setUint16(l+8*n,y[i][r+4],!0),s.setUint16(l+10*n,y[i][r+5],!0),s.setUint16(l+12*n,y[i][r+6],!0),s.setUint16(l+14*n,y[i][r+7],!0),l+=16*n}}if(h!=c)for(let e=8*t;e<8*t+a;++e){let t=b[i][e]+8*h*2*n,r=64*h+8*(7&e);for(let e=0;e<o;++e)s.setUint16(t+2*e*n,y[i][r+e],!0)}}}let x=new Uint16Array(o);s=new DataView(a.buffer);for(let t=0;t<3;++t){r[e.idx[t]].decoded=!0;let i=r[e.idx[t]].type;if(2==r[t].type)for(let e=0;e<l;++e){let r=b[t][e];for(let e=0;e<o;++e)x[e]=s.getUint16(r+2*e*i,!0);for(let e=0;e<o;++e)s.setFloat32(r+2*e*i,V(x[e]),!0)}}}(d,f,l,h,c,i);for(let t=0;t<l.length;++t){let r=l[t];if(!r.decoded){if(2!==r.compression)throw new Error("EXRLoader.parse: unsupported channel compression");{let n=0,a=0;for(let s=0;s<e.lines;++s){let e=f[t][n];for(let t=0;t<r.width;++t){for(let t=0;t<2*r.type;++t)i[e++]=u[a+t*r.width*r.height];a++}n++}}}}return new DataView(i.buffer)}function D(e,t){let r=new Uint8Array(e),i=0;for(;0!=r[t.value+i];)i+=1;let n=(new TextDecoder).decode(r.slice(t.value,t.value+i));return t.value=t.value+i+1,n}function k(e,t){let r=e.getInt32(t.value,!0);return t.value=t.value+4,r}function F(e,t){let r=e.getUint32(t.value,!0);return t.value=t.value+4,r}function N(e,t){let r=e[t.value];return t.value=t.value+1,r}function U(e,t){let r=e.getUint8(t.value);return t.value=t.value+1,r}let B=function(e,t){let r;return r="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,r};function z(e,t){let r=e.getFloat32(t.value,!0);return t.value+=4,r}function H(e,t){return nf.toHalfFloat(z(e,t))}function V(e){let t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function j(e,t){let r=e.getUint16(t.value,!0);return t.value+=2,r}function G(e,t){return V(j(e,t))}function W(e,t,r,i,n){return"string"===i||"stringvector"===i||"iccProfile"===i?function(e,t,r){let i=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+r));return t.value=t.value+r,i}(t,r,n):"chlist"===i?function(e,t,r,i){let n=r.value,a=[];for(;r.value<n+i-1;){let i=D(t,r),n=k(e,r),s=U(e,r);r.value+=3;let o=k(e,r),l=k(e,r);a.push({name:i,pixelType:n,pLinear:s,xSampling:o,ySampling:l})}return r.value+=1,a}(e,t,r,n):"chromaticities"===i?function(e,t){return{redX:z(e,t),redY:z(e,t),greenX:z(e,t),greenY:z(e,t),blueX:z(e,t),blueY:z(e,t),whiteX:z(e,t),whiteY:z(e,t)}}(e,r):"compression"===i?function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][U(e,t)]}(e,r):"box2i"===i?function(e,t){return{xMin:F(e,t),yMin:F(e,t),xMax:F(e,t),yMax:F(e,t)}}(e,r):"lineOrder"===i?function(e,t){return["INCREASING_Y"][U(e,t)]}(e,r):"float"===i?z(e,r):"v2f"===i?function(e,t){return[z(e,t),z(e,t)]}(e,r):"v3f"===i?function(e,t){return[z(e,t),z(e,t),z(e,t)]}(e,r):"int"===i?k(e,r):"rational"===i?function(e,t){return[k(e,t),F(e,t)]}(e,r):"timecode"===i?function(e,t){return[F(e,t),F(e,t)]}(e,r):"preview"===i?(r.value+=n,"skipped"):void(r.value+=n)}let X=new DataView(e),q=new Uint8Array(e),Y={value:0},$=function(e,t,r){let i={};if(20000630!=e.getUint32(0,!0))throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");i.version=e.getUint8(4);let n=e.getUint8(5);i.spec={singleTile:!!(2&n),longName:!!(4&n),deepFormat:!!(8&n),multiPart:!!(16&n)},r.value=8;let a=!0;for(;a;){let n=D(t,r);if(0==n)a=!1;else{let a=D(t,r),s=W(e,t,r,a,F(e,r));void 0===s?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${a}'.`):i[n]=s}}if(-5&n)throw console.error("THREE.EXRHeader:",i),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return i}(X,e,Y),Z=function(e,t,r,i,n){let a={size:0,viewer:t,array:r,offset:i,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:Hi};switch(e.compression){case"NO_COMPRESSION":a.lines=1,a.uncompress=C;break;case"RLE_COMPRESSION":a.lines=1,a.uncompress=P;break;case"ZIPS_COMPRESSION":a.lines=1,a.uncompress=R;break;case"ZIP_COMPRESSION":a.lines=16,a.uncompress=R;break;case"PIZ_COMPRESSION":a.lines=32,a.uncompress=I;break;case"PXR24_COMPRESSION":a.lines=16,a.uncompress=O;break;case"DWAA_COMPRESSION":a.lines=32,a.uncompress=L;break;case"DWAB_COMPRESSION":a.lines=256,a.uncompress=L;break;default:throw new Error("EXRLoader.parse: "+e.compression+" is unsupported")}if(a.scanlineBlockSize=a.lines,1==a.type)switch(n){case Us:a.getter=G,a.inputSize=2;break;case Cn:a.getter=j,a.inputSize=2}else{if(2!=a.type)throw new Error("EXRLoader.parse: unsupported pixelType "+a.type+" for "+e.compression+".");switch(n){case Us:a.getter=z,a.inputSize=4;break;case Cn:a.getter=H,a.inputSize=4}}a.blockCount=(e.dataWindow.yMax+1)/a.scanlineBlockSize;for(let e=0;e<a.blockCount;e++)B(t,i);a.outputChannels=3==a.channels?4:a.channels;let s=a.width*a.height*a.outputChannels;switch(n){case Us:a.byteArray=new Float32Array(s),a.channels<a.outputChannels&&a.byteArray.fill(1,0,s);break;case Cn:a.byteArray=new Uint16Array(s),a.channels<a.outputChannels&&a.byteArray.fill(15360,0,s);break;default:console.error("THREE.EXRLoader: unsupported type: ",n)}return a.bytesPerLine=a.width*a.inputSize*a.channels,4==a.outputChannels?(a.format=gs,a.colorSpace=Hi):(a.format=u1,a.colorSpace=Oa),a}($,X,q,Y,this.type),K={value:0},J={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<Z.height/Z.scanlineBlockSize;e++){let t=F(X,Y);Z.size=F(X,Y),Z.lines=t+Z.scanlineBlockSize>Z.height?Z.height-t:Z.scanlineBlockSize;let r=Z.size<Z.lines*Z.bytesPerLine?Z.uncompress(Z):C(Z);Y.value+=Z.size;for(let t=0;t<Z.scanlineBlockSize;t++){let i=t+e*Z.scanlineBlockSize;if(i>=Z.height)break;for(let e=0;e<Z.channels;e++){let n=J[$.channels[e].name];for(let a=0;a<Z.width;a++){K.value=(t*(Z.channels*Z.width)+e*Z.width+a)*Z.inputSize;let s=(Z.height-1-i)*(Z.width*Z.outputChannels)+a*Z.outputChannels+n;Z.byteArray[s]=Z.getter(r,K)}}}}return{header:$,width:Z.width,height:Z.height,data:Z.byteArray,format:Z.format,colorSpace:Z.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,r,i){return super.load(e,(function(e,r){e.colorSpace=r.colorSpace,e.minFilter=wn,e.magFilter=wn,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,r)}),r,i)}},xz=new WeakMap,U3=class extends Mn{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,i){let n=new Hn(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),this.url=e,n.load(e,(r=>{if(xz.has(r))return xz.get(r).promise.then(t).catch(i);this.decodeObjects(r,e).then((e=>{e.userData.warnings=this.warnings,t(e)})).catch((e=>i(e)))}),r,i)}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}decodeObjects(e,t){let r,i,n=e.byteLength,a=this._getWorker(n).then((t=>(r=t,i=this.workerNextTaskID++,new Promise(((t,n)=>{r._callbacks[i]={resolve:t,reject:n},r.postMessage({type:"decode",id:i,buffer:e},[e])}))))).then((e=>this._createGeometry(e.data))).catch((e=>{throw e}));return a.catch((()=>!0)).then((()=>{r&&i&&this._releaseTask(r,i)})),xz.set(e,{url:t,promise:a}),a}parse(e,t,r){this.decodeObjects(e,"").then((e=>{e.userData.warnings=this.warnings,t(e)})).catch((e=>r(e)))}_compareMaterials(e){let t={};t.name=e.name,t.color={},t.color.r=e.color.r,t.color.g=e.color.g,t.color.b=e.color.b,t.type=e.type;let r=JSON.stringify(t);for(let e=0;e<this.materials.length;e++){let t=this.materials[e],i={};if(i.name=t.name,i.color={},i.color.r=t.color.r,i.color.g=t.color.g,i.color.b=t.color.b,i.type=t.type,JSON.stringify(i)===r)return t}return this.materials.push(e),e}_createMaterial(e,t){if(void 0===e)return new Ss({color:new dt(1,1,1),metalness:.8,name:Mn.DEFAULT_MATERIAL_NAME,side:ln});let r=new Qa({color:new dt(e.diffuseColor.r/255,e.diffuseColor.g/255,e.diffuseColor.b/255),emissive:new dt(e.emissionColor.r,e.emissionColor.g,e.emissionColor.b),flatShading:e.disableLighting,ior:e.indexOfRefraction,name:e.name,reflectivity:e.reflectivity,opacity:1-e.transparency,side:ln,specularColor:e.specularColor,transparent:e.transparency>0});if(r.userData.id=e.id,e.pbrSupported){let t=e.pbr;r.anisotropy=t.anisotropy,r.anisotropyRotation=t.anisotropicRotation,r.color=new dt(t.baseColor.r,t.baseColor.g,t.baseColor.b),r.clearCoat=t.clearCoat,r.clearCoatRoughness=t.clearCoatRoughness,r.metalness=t.metallic,r.transmission=1-t.opacity,r.roughness=t.roughness,r.sheen=t.sheen,r.specularIntensity=t.specular,r.thickness=t.subsurface}e.pbrSupported&&0===e.pbr.opacity&&1===e.transparency&&(r.opacity=.2,r.transmission=1);let i=new Ds;for(let t=0;t<e.textures.length;t++){let n=e.textures[t];if(null!==n.image){let e=i.load(n.image);switch(n.type){case"Bump":r.bumpMap=e;break;case"Diffuse":case"PBR_BaseColor":r.map=e;break;case"Emap":r.envMap=e;break;case"Opacity":r.transmissionMap=e;break;case"Transparency":case"PBR_Alpha":r.alphaMap=e,r.transparent=!0;break;case"PBR_AmbientOcclusion":r.aoMap=e;break;case"PBR_Anisotropic":r.anisotropyMap=e;break;case"PBR_Clearcoat":r.clearcoatMap=e;break;case"PBR_ClearcoatBump":r.clearcoatNormalMap=e;break;case"PBR_ClearcoatRoughness":r.clearcoatRoughnessMap=e;break;case"PBR_Displacement":r.displacementMap=e;break;case"PBR_Emission":r.emissiveMap=e;break;case"PBR_Metallic":r.metalnessMap=e;break;case"PBR_Roughness":r.roughnessMap=e;break;case"PBR_Sheen":r.sheenColorMap=e;break;case"PBR_Specular":r.specularColorMap=e;break;case"PBR_Subsurface":r.thicknessMap=e;break;default:this.warnings.push({message:`THREE.3DMLoader: No conversion exists for 3dm ${n.type}.`,type:"no conversion"})}e.wrapS=0===n.wrapU?ui:pi,e.wrapT=0===n.wrapV?ui:pi,n.repeat&&e.repeat.set(n.repeat[0],n.repeat[1])}}return t&&(new N3).load(t.image,(function(e){e.mapping=THREE.EquirectangularReflectionMapping,r.envMap=e})),r}_createGeometry(e){let t=new yr,r=[],i=[],n=[];t.userData.layers=e.layers,t.userData.groups=e.groups,t.userData.settings=e.settings,t.userData.settings.renderSettings=e.renderSettings,t.userData.objectType="File3dm",t.userData.materials=null,t.name=this.url;let a=e.objects,s=e.materials;for(let o=0;o<a.length;o++){let l=a[o],h=l.attributes;switch(l.objectType){case"InstanceDefinition":i.push(l);break;case"InstanceReference":n.push(l);break;default:let a,o;switch(h.materialSource.name){case"ObjectMaterialSource_MaterialFromLayer":a=h.layerIndex>=0?e.layers[h.layerIndex].renderMaterialIndex:null;break;case"ObjectMaterialSource_MaterialFromObject":a=h.materialIndex>=0?h.materialIndex:null}if(a>=0){let t=s[a];o=this._createMaterial(t,e.renderEnvironment)}else o=this._createMaterial();o=this._compareMaterials(o);let c=this._createObject(l,o);if(void 0===c)continue;let u=e.layers[h.layerIndex];c.visible=!u||e.layers[h.layerIndex].visible,h.isInstanceDefinitionObject?r.push(c):t.add(c)}}for(let e=0;e<i.length;e++){let s=i[e];a=[];for(let e=0;e<s.attributes.objectIds.length;e++){let t=s.attributes.objectIds[e];for(let e=0;e<r.length;e++){t===r[e].userData.attributes.id&&a.push(r[e])}}for(let e=0;e<n.length;e++){let r=n[e];if(r.geometry.parentIdefId===s.attributes.id){let e=new yr,i=r.geometry.xform.array,n=new lt;n.set(...i),e.applyMatrix4(n);for(let t=0;t<a.length;t++)e.add(a[t].clone(!0));t.add(e)}}}return t.userData.materials=this.materials,t.name="",t}_createObject(e,t){let r,i,n,a,s=new n1,o=e.attributes;switch(e.objectType){case"Point":case"PointSet":r=s.parse(e.geometry),r.attributes.hasOwnProperty("color")?i=new Ai({vertexColors:!0,sizeAttenuation:!1,size:2}):(n=o.drawColor,a=new dt(n.r/255,n.g/255,n.b/255),i=new Ai({color:a,sizeAttenuation:!1,size:2})),i=this._compareMaterials(i);let l=new Di(r,i);return l.userData.attributes=o,l.userData.objectType=e.objectType,o.name&&(l.name=o.name),l;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(null===e.geometry)return;r=s.parse(e.geometry),r.attributes.hasOwnProperty("color")&&(t.vertexColors=!0),null===t&&(t=this._createMaterial(),t=this._compareMaterials(t));let h=new Ht(r,t);return h.castShadow=o.castsShadows,h.receiveShadow=o.receivesShadows,h.userData.attributes=o,h.userData.objectType=e.objectType,o.name&&(h.name=o.name),h;case"Curve":r=s.parse(e.geometry),n=o.drawColor,a=new dt(n.r/255,n.g/255,n.b/255),i=new Yr({color:a}),i=this._compareMaterials(i);let c=new jn(r,i);return c.userData.attributes=o,c.userData.objectType=e.objectType,o.name&&(c.name=o.name),c;case"TextDot":r=e.geometry;let u=document.createElement("canvas").getContext("2d"),d=`${r.fontHeight}px ${r.fontFace}`;u.font=d;let p=u.measureText(r.text).width+10,f=r.fontHeight+10,m=window.devicePixelRatio;u.canvas.width=p*m,u.canvas.height=f*m,u.canvas.style.width=p+"px",u.canvas.style.height=f+"px",u.setTransform(m,0,0,m,0,0),u.font=d,u.textBaseline="middle",u.textAlign="center",a=o.drawColor,u.fillStyle=`rgba(${a.r},${a.g},${a.b},${a.a})`,u.fillRect(0,0,p,f),u.fillStyle="white",u.fillText(r.text,p/2,f/2);let g=new Zd(u.canvas);g.minFilter=wn,g.wrapS=pi,g.wrapT=pi,i=new Bg({map:g,depthTest:!1});let v=new qy(i);return v.position.set(r.point[0],r.point[1],r.point[2]),v.scale.set(p/10,f/10,1),v.userData.attributes=o,v.userData.objectType=e.objectType,o.name&&(v.name=o.name),v;case"Light":let y;switch(r=e.geometry,r.lightStyle.name){case"LightStyle_WorldPoint":y=new Cl,y.castShadow=o.castsShadows,y.position.set(r.location[0],r.location[1],r.location[2]),y.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":y=new pc,y.castShadow=o.castsShadows,y.position.set(r.location[0],r.location[1],r.location[2]),y.target.position.set(r.direction[0],r.direction[1],r.direction[2]),y.angle=r.spotAngleRadians,y.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":y=new t1;let e=Math.abs(r.width[2]),t=Math.abs(r.length[0]);y.position.set(r.location[0]-t/2,r.location[1],r.location[2]-e/2),y.height=t,y.width=e,y.lookAt(r.direction[0],r.direction[1],r.direction[2]);break;case"LightStyle_WorldDirectional":y=new ya,y.castShadow=o.castsShadows,y.position.set(r.location[0],r.location[1],r.location[2]),y.target.position.set(r.direction[0],r.direction[1],r.direction[2]),y.shadow.normalBias=.1}return y&&(y.intensity=r.intensity,n=r.diffuse,a=new dt(n.r/255,n.g/255,n.b/255),y.color=a,y.userData.attributes=o,y.userData.objectType=e.objectType),y}}_initLibrary(){if(!this.libraryPending){let e=new Hn(this.manager);e.setPath(this.libraryPath);let t=new Promise(((t,r)=>{e.load("rhino3dm.js",t,void 0,r)})),r=new Hn(this.manager);r.setPath(this.libraryPath),r.setResponseType("arraybuffer");let i=new Promise(((e,t)=>{r.load("rhino3dm.wasm",e,void 0,t)}));this.libraryPending=Promise.all([t,i]).then((([e,t])=>{this.libraryConfig.wasmBinary=t;let r=ISt.toString(),i=["/* rhino3dm.js */",e,"/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i]))}))}return this.libraryPending}_getWorker(e){return this._initLibrary().then((()=>{if(this.workerPool.length<this.workerLimit){let e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",libraryConfig:this.libraryConfig}),e.onmessage=t=>{let r=t.data;switch(r.type){case"warning":this.warnings.push(r.data),console.warn(r.data);break;case"decode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));let t=this.workerPool[this.workerPool.length-1];return t._taskLoad+=e,t}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}};function ISt(){let e,t,r,i;function n(e,t,r){let i=[];for(let n=0;n<t.length;n++){let s=e.getTexture(t[n]);if(s){let e=t[n].constructor.name;e=e.substring(12,e.length);let o=a(s,e,r);i.push(o),s.delete()}}return i}function a(e,t,r){let n={type:t},a=r.getEmbeddedFileAsBase64(e.fileName);n.wrapU=e.wrapU,n.wrapV=e.wrapV,n.wrapW=e.wrapW;let s=e.uvwTransform.toFloatArray(!0);return n.repeat=[s[0],s[5]],a?n.image="data:image/png;base64,"+a:(self.postMessage({type:"warning",id:i,data:{message:`THREE.3DMLoader: Image for ${t} texture not embedded in file.`,type:"missing resource"}}),n.image=null),n}function s(e,t){let n,a,s,h,c,u=e.geometry(),d=e.attributes(),p=u.objectType;switch(p){case r.ObjectType.Curve:let e=l(u,100);s={},a={},h={},s.itemSize=3,s.type="Float32Array",s.array=[];for(let t=0;t<e.length;t++)s.array.push(e[t][0]),s.array.push(e[t][1]),s.array.push(e[t][2]);a.position=s,h.attributes=a,n={data:h};break;case r.ObjectType.Point:let f=u.location;s={};let m={};a={},h={},s.itemSize=3,s.type="Float32Array",s.array=[f[0],f[1],f[2]];let g=d.drawColor(t);m.itemSize=3,m.type="Float32Array",m.array=[g.r/255,g.g/255,g.b/255],a.position=s,a.color=m,h.attributes=a,n={data:h};break;case r.ObjectType.PointSet:case r.ObjectType.Mesh:n=u.toThreejsJSON();break;case r.ObjectType.Brep:let v=u.faces();c=new r.Mesh;for(let e=0;e<v.count;e++){let t=v.get(e),i=t.getMesh(r.MeshType.Any);i&&(c.append(i),i.delete()),t.delete()}c.faces().count>0&&(c.compact(),n=c.toThreejsJSON(),v.delete()),c.delete();break;case r.ObjectType.Extrusion:c=u.getMesh(r.MeshType.Any),c&&(n=c.toThreejsJSON(),c.delete());break;case r.ObjectType.TextDot:n=o(u);break;case r.ObjectType.Light:n=o(u),"LightStyle_WorldLinear"===n.lightStyle.name&&self.postMessage({type:"warning",id:i,data:{message:`THREE.3DMLoader: No conversion exists for ${p.constructor.name} ${n.lightStyle.name}`,type:"no conversion",guid:d.id}});break;case r.ObjectType.InstanceReference:n=o(u),n.xform=o(u.xform),n.xform.array=u.xform.toFloatArray(!0);break;case r.ObjectType.SubD:u.subdivide(3),c=r.Mesh.createFromSubDControlNet(u),c&&(n=c.toThreejsJSON(),c.delete());break;default:self.postMessage({type:"warning",id:i,data:{message:`THREE.3DMLoader: Conversion not implemented for ${p.constructor.name}`,type:"not implemented",guid:d.id}})}if(n)return a=o(d),a.geometry=o(u),d.groupCount>0&&(a.groupIds=d.getGroupList()),d.userStringCount>0&&(a.userStrings=d.getUserStrings()),u.userStringCount>0&&(a.geometry.userStrings=u.getUserStrings()),d.decals().count>0&&self.postMessage({type:"warning",id:i,data:{message:"THREE.3DMLoader: No conversion exists for the decals associated with this object.",type:"no conversion",guid:d.id}}),a.drawColor=d.drawColor(t),p=p.constructor.name,p=p.substring(11,p.length),{geometry:n,attributes:a,objectType:p};self.postMessage({type:"warning",id:i,data:{message:`THREE.3DMLoader: ${p.constructor.name} has no associated mesh geometry.`,type:"missing mesh",guid:d.id}})}function o(e){let t={};for(let r in e){let i=e[r];"function"!=typeof i&&("object"==typeof i&&null!==i&&i.hasOwnProperty("constructor")?t[r]={name:i.constructor.name,value:i.value}:t[r]="object"==typeof i&&null!==i?o(i):i)}return t}function l(e,t){let i=t,n=[],a=[];if(e instanceof r.LineCurve)return[e.pointAtStart,e.pointAtEnd];if(e instanceof r.PolylineCurve){i=e.pointCount;for(let t=0;t<i;t++)n.push(e.point(t));return n}if(e instanceof r.PolyCurve){let t=e.segmentCount;for(let r=0;r<t;r++){let t=e.segmentCurve(r),a=l(t,i);n=n.concat(a),t.delete()}return n}if(e instanceof r.ArcCurve&&(i=Math.floor(e.angleDegrees/5),i=i<2?2:i),e instanceof r.NurbsCurve&&1===e.degree){let t=e.tryGetPolyline();for(let e=0;e<t.count;e++)n.push(t.get(e));return t.delete(),n}let s=e.domain,o=i-1;for(let t=0;t<i;t++){let r=s[0]+t/o*(s[1]-s[0]);if(r===s[0]||r===s[1]){a.push(r);continue}let i,n=e.tangentAt(r),l=e.tangentAt(a.slice(-1)[0]),h=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],c=l[0]*l[0]+l[1]*l[1]+l[2]*l[2],u=Math.sqrt(h*c);if(0===u)i=Math.PI/2;else{let e=(n.x*l.x+n.y*l.y+n.z*l.z)/u;i=Math.acos(Math.max(-1,Math.min(1,e)))}i<.1||a.push(r)}return n=a.map((t=>e.pointAt(t))),n}onmessage=function(a){let l=a.data;switch(l.type){case"init":t=l.libraryConfig;let a,h=t.wasmBinary;e=new Promise((function(e){a={wasmBinary:h,onRuntimeInitialized:e},rhino3dm(a)})).then((()=>{r=a}));break;case"decode":i=l.id;let c=l.buffer;e.then((()=>{try{let e=function(e,t){let r=new Uint8Array(t),i=e.File3dm.fromByteArray(r),a=[],l=[],h=[],c=[],u=[],d=[],p=[],f=i.objects(),m=f.count;for(let e=0;e<m;e++){let t=f.get(e),r=s(t,i);t.delete(),r&&a.push(r)}for(let e=0;e<i.instanceDefinitions().count;e++){let t=i.instanceDefinitions().get(e),r=o(t);r.objectIds=t.getObjectIds(),a.push({geometry:null,attributes:r,objectType:"InstanceDefinition"})}let g=[e.TextureType.Diffuse,e.TextureType.Bump,e.TextureType.Transparency,e.TextureType.Opacity,e.TextureType.Emap],v=[e.TextureType.PBR_BaseColor,e.TextureType.PBR_Subsurface,e.TextureType.PBR_SubsurfaceScattering,e.TextureType.PBR_SubsurfaceScatteringRadius,e.TextureType.PBR_Metallic,e.TextureType.PBR_Specular,e.TextureType.PBR_SpecularTint,e.TextureType.PBR_Roughness,e.TextureType.PBR_Anisotropic,e.TextureType.PBR_Anisotropic_Rotation,e.TextureType.PBR_Sheen,e.TextureType.PBR_SheenTint,e.TextureType.PBR_Clearcoat,e.TextureType.PBR_ClearcoatBump,e.TextureType.PBR_ClearcoatRoughness,e.TextureType.PBR_OpacityIor,e.TextureType.PBR_OpacityRoughness,e.TextureType.PBR_Emission,e.TextureType.PBR_AmbientOcclusion,e.TextureType.PBR_Displacement];for(let e=0;e<i.materials().count;e++){let t=i.materials().get(e),r=o(t),a=[];a.push(...n(t,g,i)),r.pbrSupported=t.physicallyBased().supported,r.pbrSupported&&(a.push(...n(t,v,i)),r.pbr=o(t.physicallyBased())),r.textures=a,l.push(r),t.delete()}for(let e=0;e<i.layers().count;e++){let t=i.layers().get(e),r=o(t);h.push(r),t.delete()}for(let e=0;e<i.views().count;e++){let t=i.views().get(e),r=o(t);c.push(r),t.delete()}for(let e=0;e<i.namedViews().count;e++){let t=i.namedViews().get(e),r=o(t);u.push(r),t.delete()}for(let e=0;e<i.groups().count;e++){let t=i.groups().get(e),r=o(t);d.push(r),t.delete()}let y=o(i.settings()),b=i.strings().count;for(let e=0;e<b;e++)p.push(i.strings().get(e));let x=i.settings().renderSettings().renderEnvironments.reflectionId,_=i.renderContent(),w=null;for(let e=0;e<_.count;e++){let t=_.get(e);switch(t.kind){case"environment":if(t.id!==x)break;let e=t.findChild("texture").fileName;for(let t=0;t<i.embeddedFiles().count;t++){e===i.embeddedFiles().get(t).fileName&&(w={type:"renderEnvironment",image:"data:image/png;base64,"+i.getEmbeddedFileAsBase64(e),name:e})}}}let S={ambientLight:i.settings().renderSettings().ambientLight,backgroundColorTop:i.settings().renderSettings().backgroundColorTop,backgroundColorBottom:i.settings().renderSettings().backgroundColorBottom,useHiddenLights:i.settings().renderSettings().useHiddenLights,depthCue:i.settings().renderSettings().depthCue,flatShade:i.settings().renderSettings().flatShade,renderBackFaces:i.settings().renderSettings().renderBackFaces,renderPoints:i.settings().renderSettings().renderPoints,renderCurves:i.settings().renderSettings().renderCurves,renderIsoParams:i.settings().renderSettings().renderIsoParams,renderMeshEdges:i.settings().renderSettings().renderMeshEdges,renderAnnotations:i.settings().renderSettings().renderAnnotations,useViewportSize:i.settings().renderSettings().useViewportSize,scaleBackgroundToFit:i.settings().renderSettings().scaleBackgroundToFit,transparentBackground:i.settings().renderSettings().transparentBackground,imageDpi:i.settings().renderSettings().imageDpi,shadowMapLevel:i.settings().renderSettings().shadowMapLevel,namedView:i.settings().renderSettings().namedView,snapShot:i.settings().renderSettings().snapShot,specificViewport:i.settings().renderSettings().specificViewport,groundPlane:o(i.settings().renderSettings().groundPlane),safeFrame:o(i.settings().renderSettings().safeFrame),dithering:o(i.settings().renderSettings().dithering),skylight:o(i.settings().renderSettings().skylight),linearWorkflow:o(i.settings().renderSettings().linearWorkflow),renderChannels:o(i.settings().renderSettings().renderChannels),sun:o(i.settings().renderSettings().sun),renderEnvironments:o(i.settings().renderSettings().renderEnvironments),postEffects:o(i.settings().renderSettings().postEffects)};return i.delete(),{objects:a,materials:l,layers:h,views:c,namedViews:u,groups:d,strings:p,settings:y,renderSettings:S,renderEnvironment:w}}(r,c);self.postMessage({type:"decode",id:l.id,data:e})}catch(e){self.postMessage({type:"error",id:l.id,error:e})}}))}}}var BT=class extends tf{constructor(e){super(e)}parse(e){let t=0,r=1,i=2,n=3,a=9,s=10,o=11,l=48,h=4,c=0,u=1,d=2,p=3;if(e.length<19)throw new Error("THREE.TGALoader: Not enough data to contain header.");let f=0,m=new Uint8Array(e),g={id_length:m[f++],colormap_type:m[f++],image_type:m[f++],colormap_index:m[f++]|m[f++]<<8,colormap_length:m[f++]|m[f++]<<8,colormap_size:m[f++],origin:[m[f++]|m[f++]<<8,m[f++]|m[f++]<<8],width:m[f++]|m[f++]<<8,height:m[f++]|m[f++]<<8,pixel_size:m[f++],flags:m[f++]};if(function(e){switch(e.image_type){case r:case a:if(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case i:case n:case s:case o:if(e.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case t:throw new Error("THREE.TGALoader: No data.");default:throw new Error("THREE.TGALoader: Invalid type "+e.image_type)}if(e.width<=0||e.height<=0)throw new Error("THREE.TGALoader: Invalid image size.");if(8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size)throw new Error("THREE.TGALoader: Invalid pixel size "+e.pixel_size)}(g),g.id_length+f>e.length)throw new Error("THREE.TGALoader: No data.");f+=g.id_length;let v=!1,y=!1,b=!1;switch(g.image_type){case a:v=!0,y=!0;break;case r:y=!0;break;case s:v=!0;break;case i:break;case o:v=!0,b=!0;break;case n:b=!0}let x=new Uint8Array(g.width*g.height*4),_=function(e,t,r,i,n){let a,s,o=r.pixel_size>>3,l=r.width*r.height*o;if(t&&(s=n.subarray(i,i+=r.colormap_length*(r.colormap_size>>3))),e){a=new Uint8Array(l);let e,t,r,s=0,h=new Uint8Array(o);for(;s<l;)if(e=n[i++],t=1+(127&e),128&e){for(r=0;r<o;++r)h[r]=n[i++];for(r=0;r<t;++r)a.set(h,s+r*o);s+=o*t}else{for(t*=o,r=0;r<t;++r)a[s+r]=n[i++];s+=t}}else a=n.subarray(i,i+=t?r.width*r.height:l);return{pixel_data:a,palettes:s}}(v,y,g,f,m);return function(e,t,r,i,n){let a,s,o,f,m,v;switch((g.flags&l)>>h){default:case d:a=0,o=1,m=t,s=0,f=1,v=r;break;case c:a=0,o=1,m=t,s=r-1,f=-1,v=-1;break;case p:a=t-1,o=-1,m=-1,s=0,f=1,v=r;break;case u:a=t-1,o=-1,m=-1,s=r-1,f=-1,v=-1}if(b)switch(g.pixel_size){case 8:!function(e,t,r,i,n,a,s,o){let l,h,c,u=0,d=g.width;for(c=t;c!==i;c+=r)for(h=n;h!==s;h+=a,u++)l=o[u],e[4*(h+d*c)+0]=l,e[4*(h+d*c)+1]=l,e[4*(h+d*c)+2]=l,e[4*(h+d*c)+3]=255}(e,s,f,v,a,o,m,i);break;case 16:!function(e,t,r,i,n,a,s,o){let l,h,c=0,u=g.width;for(h=t;h!==i;h+=r)for(l=n;l!==s;l+=a,c+=2)e[4*(l+u*h)+0]=o[c+0],e[4*(l+u*h)+1]=o[c+0],e[4*(l+u*h)+2]=o[c+0],e[4*(l+u*h)+3]=o[c+1]}(e,s,f,v,a,o,m,i);break;default:throw new Error("THREE.TGALoader: Format not supported.")}else switch(g.pixel_size){case 8:!function(e,t,r,i,n,a,s,o,l){let h,c,u,d=l,p=0,f=g.width;for(u=t;u!==i;u+=r)for(c=n;c!==s;c+=a,p++)h=o[p],e[4*(c+f*u)+3]=255,e[4*(c+f*u)+2]=d[3*h+0],e[4*(c+f*u)+1]=d[3*h+1],e[4*(c+f*u)+0]=d[3*h+2]}(e,s,f,v,a,o,m,i,n);break;case 16:!function(e,t,r,i,n,a,s,o){let l,h,c,u=0,d=g.width;for(c=t;c!==i;c+=r)for(h=n;h!==s;h+=a,u+=2)l=o[u+0]+(o[u+1]<<8),e[4*(h+d*c)+0]=(31744&l)>>7,e[4*(h+d*c)+1]=(992&l)>>2,e[4*(h+d*c)+2]=(31&l)<<3,e[4*(h+d*c)+3]=32768&l?0:255}(e,s,f,v,a,o,m,i);break;case 24:!function(e,t,r,i,n,a,s,o){let l,h,c=0,u=g.width;for(h=t;h!==i;h+=r)for(l=n;l!==s;l+=a,c+=3)e[4*(l+u*h)+3]=255,e[4*(l+u*h)+2]=o[c+0],e[4*(l+u*h)+1]=o[c+1],e[4*(l+u*h)+0]=o[c+2]}(e,s,f,v,a,o,m,i);break;case 32:!function(e,t,r,i,n,a,s,o){let l,h,c=0,u=g.width;for(h=t;h!==i;h+=r)for(l=n;l!==s;l+=a,c+=4)e[4*(l+u*h)+2]=o[c+0],e[4*(l+u*h)+1]=o[c+1],e[4*(l+u*h)+0]=o[c+2],e[4*(l+u*h)+3]=o[c+3]}(e,s,f,v,a,o,m,i);break;default:throw new Error("THREE.TGALoader: Format not supported.")}}(x,g.width,g.height,_.pixel_data,_.palettes),{data:x,width:g.width,height:g.height,flipY:!0,generateMipmaps:!0,minFilter:ia}}},H3=class extends Mn{load(e,t,r,i){let n=this,a=""===n.path?oa.extractUrlBase(e):n.path,s=new Hn(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(e,(function(r){try{t(n.parse(r,a))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}}),r,i)}parse(e,t){function r(e,t){let r=[],i=e.childNodes;for(let e=0,n=i.length;e<n;e++){let n=i[e];n.nodeName===t&&r.push(n)}return r}function i(e){if(0===e.length)return[];let t=e.trim().split(/\s+/),r=new Array(t.length);for(let e=0,i=t.length;e<i;e++)r[e]=t[e];return r}function n(e){if(0===e.length)return[];let t=e.trim().split(/\s+/),r=new Array(t.length);for(let e=0,i=t.length;e<i;e++)r[e]=parseFloat(t[e]);return r}function a(e){if(0===e.length)return[];let t=e.trim().split(/\s+/),r=new Array(t.length);for(let e=0,i=t.length;e<i;e++)r[e]=parseInt(t[e]);return r}function s(e){return e.substring(1)}function o(e){return 0===Object.keys(e).length}function l(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function h(e){return void 0!==e?e.textContent:"Y_UP"}function c(e,t,i,n){let a=r(e,t)[0];if(void 0!==a){let e=r(a,i);for(let t=0;t<e.length;t++)n(e[t])}}function u(e,t){for(let r in e){e[r].build=t(e[r])}}function d(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function p(e){let t={inputs:{}};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType&&"input"===i.nodeName){let e=s(i.getAttribute("source")),r=i.getAttribute("semantic");t.inputs[r]=e}}return t}function f(e){let t={},r=e.getAttribute("target").split("/"),i=r.shift(),n=r.shift(),a=-1!==n.indexOf("("),o=-1!==n.indexOf(".");if(o)r=n.split("."),n=r.shift(),t.member=r.shift();else if(a){let e=n.split("(");n=e.shift();for(let t=0;t<e.length;t++)e[t]=parseInt(e[t].replace(/\)/,""));t.indices=e}return t.id=i,t.sid=n,t.arraySyntax=a,t.memberSyntax=o,t.sampler=s(e.getAttribute("source")),t}function m(e){let t=[],r=e.channels,i=e.samplers,n=e.sources;for(let e in r)if(r.hasOwnProperty(e)){let a=r[e],s=i[a.sampler],o=s.inputs.INPUT,l=s.inputs.OUTPUT;_(v(a,n[o],n[l]),t)}return t}function g(e){return d(tt.animations[e],m)}function v(e,t,r){let i,n,a,s,o,l,h=tt.nodes[e.id],c=Be(h.id),u=h.transforms[e.sid],d=h.matrix.clone().transpose(),p={};switch(u){case"matrix":for(a=0,s=t.array.length;a<s;a++)if(i=t.array[a],n=a*r.stride,void 0===p[i]&&(p[i]={}),!0===e.arraySyntax){let t=r.array[n],a=e.indices[0]+4*e.indices[1];p[i][a]=t}else for(o=0,l=r.stride;o<l;o++)p[i][o]=r.array[n+o];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',u)}let f=function(e,t){let r=[];for(let t in e)r.push({time:parseFloat(t),value:e[t]});r.sort(i);for(let e=0;e<16;e++)w(r,e,t.elements[e]);return r;function i(e,t){return e.time-t.time}}(p,d);return{name:c.uuid,keyframes:f}}let y=new F,b=new F,x=new dn;function _(e,t){let r=e.keyframes,i=e.name,n=[],a=[],s=[],o=[];for(let e=0,t=r.length;e<t;e++){let t=r[e],i=t.time,l=t.value;Ce.fromArray(l).transpose(),Ce.decompose(y,x,b),n.push(i),a.push(y.x,y.y,y.z),s.push(x.x,x.y,x.z,x.w),o.push(b.x,b.y,b.z)}return a.length>0&&t.push(new wo(i+".position",n,a)),s.length>0&&t.push(new eo(i+".quaternion",n,s)),o.length>0&&t.push(new wo(i+".scale",n,o)),t}function w(e,t,r){let i,n,a,s=!0;for(n=0,a=e.length;n<a;n++)i=e[n],void 0===i.value[t]?i.value[t]=null:s=!1;if(!0===s)for(n=0,a=e.length;n<a;n++)i=e[n],i.value[t]=r;else!function(e,t){let r,i;for(let n=0,a=e.length;n<a;n++){let a=e[n];if(null===a.value[t]){if(r=S(e,n,t),i=T(e,n,t),null===r){a.value[t]=i.value[t];continue}if(null===i){a.value[t]=r.value[t];continue}M(a,r,i,t)}}}(e,t)}function S(e,t,r){for(;t>=0;){let i=e[t];if(null!==i.value[r])return i;t--}return null}function T(e,t,r){for(;t<e.length;){let i=e[t];if(null!==i.value[r])return i;t++}return null}function M(e,t,r,i){r.time-t.time!=0?e.value[i]=(e.time-t.time)*(r.value[i]-t.value[i])/(r.time-t.time)+t.value[i]:e.value[i]=t.value[i]}function E(e){let t=[],r=e.name,i=e.end-e.start||-1,n=e.animations;for(let e=0,r=n.length;e<r;e++){let r=g(n[e]);for(let e=0,i=r.length;e<i;e++)t.push(r[e])}return new Yo(r,i,t)}function A(e){return d(tt.clips[e],E)}function C(e){let t={sources:{}};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=n(i.textContent);break;case"source":let e=i.getAttribute("id");t.sources[e]=oe(i);break;case"joints":t.joints=P(i);break;case"vertex_weights":t.vertexWeights=R(i)}}return t}function P(e){let t={inputs:{}};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType&&"input"===i.nodeName){let e=i.getAttribute("semantic"),r=s(i.getAttribute("source"));t.inputs[e]=r}}return t}function R(e){let t={inputs:{}};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":let e=i.getAttribute("semantic"),r=s(i.getAttribute("source")),n=parseInt(i.getAttribute("offset"));t.inputs[e]={id:r,offset:n};break;case"vcount":t.vcount=a(i.textContent);break;case"v":t.v=a(i.textContent)}}return t}function I(e){let t={id:e.id},r=tt.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){let t,r,i,n={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},a=e.sources,s=e.vertexWeights,o=s.vcount,l=s.v,h=s.inputs.JOINT.offset,c=s.inputs.WEIGHT.offset,u=e.sources[e.joints.inputs.JOINT],d=e.sources[e.joints.inputs.INV_BIND_MATRIX],p=a[s.inputs.WEIGHT.id].array,f=0;for(t=0,i=o.length;t<i;t++){let e=o[t],i=[];for(r=0;r<e;r++){let e=l[f+h],t=p[l[f+c]];i.push({index:e,weight:t}),f+=2}for(i.sort(m),r=0;r<4;r++){let e=i[r];void 0!==e?(n.indices.array.push(e.index),n.weights.array.push(e.weight)):(n.indices.array.push(0),n.weights.array.push(0))}}for(e.bindShapeMatrix?n.bindMatrix=(new lt).fromArray(e.bindShapeMatrix).transpose():n.bindMatrix=(new lt).identity(),t=0,i=u.array.length;t<i;t++){let e=u.array[t],r=(new lt).fromArray(d.array,t*d.stride).transpose();n.joints.push({name:e,boneInverse:r})}return n;function m(e,t){return t.weight-e.weight}}(e.skin),r.sources.skinIndices=t.skin.indices,r.sources.skinWeights=t.skin.weights),t}function O(e){return d(tt.controllers[e],I)}function L(e){return void 0!==e.build?e.build:e.init_from}function D(e){let t=tt.images[e];return void 0!==t?d(t,L):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function k(e){let t={surfaces:{},samplers:{}};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"newparam":N(i,t);break;case"technique":t.technique=z(i);break;case"extra":t.extra=X(i)}}return t}function N(e,t){let r=e.getAttribute("sid");for(let i=0,n=e.childNodes.length;i<n;i++){let n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"surface":t.surfaces[r]=U(n);break;case"sampler2D":t.samplers[r]=B(n)}}}function U(e){let t={};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType&&"init_from"===i.nodeName)t.init_from=i.textContent}return t}function B(e){let t={};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType&&"source"===i.nodeName)t.source=i.textContent}return t}function z(e){let t={};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=i.nodeName,t.parameters=H(i);break;case"extra":t.extra=X(i)}}return t}function H(e){let t={};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[i.nodeName]=V(i);break;case"transparent":t[i.nodeName]={opaque:i.hasAttribute("opaque")?i.getAttribute("opaque"):"A_ONE",data:V(i)}}}return t}function V(e){let t={};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"color":t[i.nodeName]=n(i.textContent);break;case"float":t[i.nodeName]=parseFloat(i.textContent);break;case"texture":t[i.nodeName]={id:i.getAttribute("texture"),extra:j(i)}}}return t}function j(e){let t={technique:{}};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType&&"extra"===i.nodeName)G(i,t)}return t}function G(e,t){for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType&&"technique"===i.nodeName)W(i,t)}}function W(e,t){for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=1:"FALSE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=0:t.technique[i.nodeName]=parseInt(i.textContent);break;case"bump":t[i.nodeName]=Y(i)}}}function X(e){let t={};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType&&"technique"===i.nodeName)t.technique=q(i)}return t}function q(e){let t={};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"double_sided":t[i.nodeName]=parseInt(i.textContent);break;case"bump":t[i.nodeName]=Y(i)}}return t}function Y(e){let t={};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType&&"texture"===i.nodeName)t[i.nodeName]={id:i.getAttribute("texture"),texcoord:i.getAttribute("texcoord"),extra:j(i)}}return t}function $(e){return e}function Z(e){let t,r=function(e){return d(tt.effects[e],$)}(e.url),i=r.profile.technique;switch(i.type){case"phong":case"blinn":t=new Da;break;case"lambert":t=new Th;break;default:t=new Mr}function n(e,t=null){let i=r.profile.samplers[e.id],n=null;if(void 0!==i){n=D(r.profile.surfaces[i.source].init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),n=D(e.id);if(null!==n){let r=function(e){let t,r=e.slice(2+(e.lastIndexOf(".")-1>>>0));t="tga"===(r=r.toLowerCase(),r)?Ze:Ye;return t}(n);if(void 0!==r){let i=r.load(n),a=e.extra;if(void 0!==a&&void 0!==a.technique&&!1===o(a.technique)){let e=a.technique;i.wrapS=e.wrapU?ui:pi,i.wrapT=e.wrapV?ui:pi,i.offset.set(e.offsetU||0,e.offsetV||0),i.repeat.set(e.repeatU||1,e.repeatV||1)}else i.wrapS=ui,i.wrapT=ui;return null!==t&&(i.colorSpace=t),i}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",n),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}t.name=e.name||"";let a=i.parameters;for(let e in a){let r=a[e];switch(e){case"diffuse":r.color&&t.color.fromArray(r.color),r.texture&&(t.map=n(r.texture,Zr));break;case"specular":r.color&&t.specular&&t.specular.fromArray(r.color),r.texture&&(t.specularMap=n(r.texture));break;case"bump":r.texture&&(t.normalMap=n(r.texture));break;case"ambient":r.texture&&(t.lightMap=n(r.texture,Zr));break;case"shininess":r.float&&t.shininess&&(t.shininess=r.float);break;case"emission":r.color&&t.emissive&&t.emissive.fromArray(r.color),r.texture&&(t.emissiveMap=n(r.texture,Zr))}}t.color.convertSRGBToLinear(),t.specular&&t.specular.convertSRGBToLinear(),t.emissive&&t.emissive.convertSRGBToLinear();let s=a.transparent,l=a.transparency;if(void 0===l&&s&&(l={float:1}),void 0===s&&l&&(s={opaque:"A_ONE",data:{color:[1,1,1,1]}}),s&&l)if(s.data.texture)t.transparent=!0;else{let e=s.data.color;switch(s.opaque){case"A_ONE":t.opacity=e[3]*l.float;break;case"RGB_ZERO":t.opacity=1-e[0]*l.float;break;case"A_ZERO":t.opacity=1-e[3]*l.float;break;case"RGB_ONE":t.opacity=e[0]*l.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',s.opaque)}t.opacity<1&&(t.transparent=!0)}if(void 0!==i.extra&&void 0!==i.extra.technique){let e=i.extra.technique;for(let r in e){let i=e[r];switch(r){case"double_sided":t.side=1===i?ln:zi;break;case"bump":t.normalMap=n(i.texture),t.normalScale=new Te(1,1)}}}return t}function K(e){return d(tt.materials[e],Z)}function J(e){for(let t=0;t<e.childNodes.length;t++){let r=e.childNodes[t];if("technique_common"===r.nodeName)return Q(r)}return{}}function Q(e){let t={};for(let r=0;r<e.childNodes.length;r++){let i=e.childNodes[r];switch(i.nodeName){case"perspective":case"orthographic":t.technique=i.nodeName,t.parameters=ee(i)}}return t}function ee(e){let t={};for(let r=0;r<e.childNodes.length;r++){let i=e.childNodes[r];switch(i.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[i.nodeName]=parseFloat(i.textContent)}}return t}function te(e){let t;switch(e.optics.technique){case"perspective":t=new ci(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":let r=e.optics.parameters.ymag,i=e.optics.parameters.xmag,n=e.optics.parameters.aspect_ratio;i=void 0===i?r*n:i,r=void 0===r?i/n:r,i*=.5,r*=.5,t=new Gi(-i,i,r,-r,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new ci}return t.name=e.name||"",t}function re(e){let t=tt.cameras[e];return void 0!==t?d(t,te):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function ie(e){let t={};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=i.nodeName,t.parameters=ne(i)}}return t}function ne(e){let t={};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"color":let e=n(i.textContent);t.color=(new dt).fromArray(e).convertSRGBToLinear();break;case"falloff_angle":t.falloffAngle=parseFloat(i.textContent);break;case"quadratic_attenuation":let r=parseFloat(i.textContent);t.distance=r?Math.sqrt(1/r):0}}return t}function ae(e){let t;switch(e.technique){case"directional":t=new ya;break;case"point":t=new Cl;break;case"spot":t=new pc;break;case"ambient":t=new $o}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function se(e){let t=tt.lights[e];return void 0!==t?d(t,ae):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function oe(e){let t={array:[],stride:3};for(let a=0;a<e.childNodes.length;a++){let s=e.childNodes[a];if(1===s.nodeType)switch(s.nodeName){case"float_array":t.array=n(s.textContent);break;case"Name_array":t.array=i(s.textContent);break;case"technique_common":let e=r(s,"accessor")[0];void 0!==e&&(t.stride=parseInt(e.getAttribute("stride")))}}return t}function le(e){let t={};for(let r=0;r<e.childNodes.length;r++){let i=e.childNodes[r];1===i.nodeType&&(t[i.getAttribute("semantic")]=s(i.getAttribute("source")))}return t}function he(e){let t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"input":let e=s(i.getAttribute("source")),r=i.getAttribute("semantic"),n=parseInt(i.getAttribute("offset")),o=parseInt(i.getAttribute("set")),l=o>0?r+o:r;t.inputs[l]={id:e,offset:n},t.stride=Math.max(t.stride,n+1),"TEXCOORD"===r&&(t.hasUV=!0);break;case"vcount":t.vcount=a(i.textContent);break;case"p":t.p=a(i.textContent)}}return t}function ce(e){let t=0;for(let r=0,i=e.length;r<i;r++)!0===e[r].hasUV&&t++;t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function ue(e){let t={},r=e.sources,i=e.vertices,n=e.primitives;if(0===n.length)return{};let a=function(e){let t={};for(let r=0;r<e.length;r++){let i=e[r];void 0===t[i.type]&&(t[i.type]=[]),t[i.type].push(i)}return t}(n);for(let e in a){let n=a[e];ce(n),t[e]=de(n,r,i)}return t}function de(e,t,r){let i={},n={array:[],stride:0},a={array:[],stride:0},s={array:[],stride:0},o={array:[],stride:0},l={array:[],stride:0},h=[],c=4,u=[],d=4,p=new Nt,f=[],m=0;for(let i=0;i<e.length;i++){let c=e[i],d=c.inputs,g=0;switch(c.type){case"lines":case"linestrips":g=2*c.count;break;case"triangles":g=3*c.count;break;case"polylist":for(let e=0;e<c.count;e++){let t=c.vcount[e];switch(t){case 3:g+=3;break;case 4:g+=6;break;default:g+=3*(t-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",c.type)}p.addGroup(m,g,i),m+=g,c.material&&f.push(c.material);for(let i in d){let p=d[i];switch(i){case"VERTEX":for(let i in r){let d=r[i];switch(i){case"POSITION":let r=n.array.length;if(pe(c,t[d],p.offset,n.array),n.stride=t[d].stride,t.skinWeights&&t.skinIndices&&(pe(c,t.skinIndices,p.offset,h),pe(c,t.skinWeights,p.offset,u)),!1===c.hasUV&&!0===e.uvsNeedsFix){let e=(n.array.length-r)/n.stride;for(let t=0;t<e;t++)s.array.push(0,0)}break;case"NORMAL":pe(c,t[d],p.offset,a.array),a.stride=t[d].stride;break;case"COLOR":pe(c,t[d],p.offset,l.array),l.stride=t[d].stride;break;case"TEXCOORD":pe(c,t[d],p.offset,s.array),s.stride=t[d].stride;break;case"TEXCOORD1":pe(c,t[d],p.offset,o.array),s.stride=t[d].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',i)}}break;case"NORMAL":pe(c,t[p.id],p.offset,a.array),a.stride=t[p.id].stride;break;case"COLOR":pe(c,t[p.id],p.offset,l.array,!0),l.stride=t[p.id].stride;break;case"TEXCOORD":pe(c,t[p.id],p.offset,s.array),s.stride=t[p.id].stride;break;case"TEXCOORD1":pe(c,t[p.id],p.offset,o.array),o.stride=t[p.id].stride}}}return n.array.length>0&&p.setAttribute("position",new zt(n.array,n.stride)),a.array.length>0&&p.setAttribute("normal",new zt(a.array,a.stride)),l.array.length>0&&p.setAttribute("color",new zt(l.array,l.stride)),s.array.length>0&&p.setAttribute("uv",new zt(s.array,s.stride)),o.array.length>0&&p.setAttribute("uv1",new zt(o.array,o.stride)),h.length>0&&p.setAttribute("skinIndex",new zt(h,c)),u.length>0&&p.setAttribute("skinWeight",new zt(u,d)),i.data=p,i.type=e[0].type,i.materialKeys=f,i}function pe(e,t,r,i,n=!1){let a=e.p,s=e.stride,o=e.vcount;function l(e){let t=a[e+r]*c,s=t+c;for(;t<s;t++)i.push(h[t]);if(n){let e=i.length-c-1;Ke.setRGB(i[e+0],i[e+1],i[e+2]).convertSRGBToLinear(),i[e+0]=Ke.r,i[e+1]=Ke.g,i[e+2]=Ke.b}}let h=t.array,c=t.stride;if(void 0!==e.vcount){let e=0;for(let t=0,r=o.length;t<r;t++){let r=o[t];if(4===r){let t=e+1*s,r=e+2*s,i=e+3*s;l(e+0*s),l(t),l(i),l(t),l(r),l(i)}else if(3===r){let t=e+1*s,r=e+2*s;l(e+0*s),l(t),l(r)}else if(r>4)for(let t=1,i=r-2;t<=i;t++){let r=e+s*t,i=e+s*(t+1);l(e+0*s),l(r),l(i)}e+=s*r}}else for(let e=0,t=a.length;e<t;e+=s)l(e)}function fe(e){return d(tt.geometries[e],ue)}function me(e){return void 0!==e.build?e.build:e}function ge(e,t){for(let r=0;r<e.childNodes.length;r++){let i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"joint":t.joints[i.getAttribute("sid")]=ve(i);break;case"link":t.links.push(be(i))}}}function ve(e){let t;for(let r=0;r<e.childNodes.length;r++){let i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"prismatic":case"revolute":t=ye(i)}}return t}function ye(e){let t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new F,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let r=0;r<e.childNodes.length;r++){let i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"axis":let e=n(i.textContent);t.axis.fromArray(e);break;case"limits":let r=i.getElementsByTagName("max")[0],a=i.getElementsByTagName("min")[0];t.limits.max=parseFloat(r.textContent),t.limits.min=parseFloat(a.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function be(e){let t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]};for(let r=0;r<e.childNodes.length;r++){let i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"attachment_full":t.attachments.push(xe(i));break;case"matrix":case"translate":case"rotate":t.transforms.push(_e(i))}}return t}function xe(e){let t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let r=0;r<e.childNodes.length;r++){let i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"link":t.links.push(be(i));break;case"matrix":case"translate":case"rotate":t.transforms.push(_e(i))}}return t}function _e(e){let t={type:e.nodeName},r=n(e.textContent);switch(t.type){case"matrix":t.obj=new lt,t.obj.fromArray(r).transpose();break;case"translate":t.obj=new F,t.obj.fromArray(r);break;case"rotate":t.obj=new F,t.obj.fromArray(r),t.angle=Tr.degToRad(r[3])}return t}function we(e,t){for(let r=0;r<e.childNodes.length;r++){let i=e.childNodes[r];if(1===i.nodeType&&"technique_common"===i.nodeName)Se(i,t)}}function Se(e,t){for(let r=0;r<e.childNodes.length;r++){let i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"inertia":t.inertia=n(i.textContent);break;case"mass":t.mass=n(i.textContent)[0]}}}function Me(e){let t={target:e.getAttribute("target").split("/").pop()};for(let r=0;r<e.childNodes.length;r++){let i=e.childNodes[r];if(1===i.nodeType&&"axis"===i.nodeName){let e=i.getElementsByTagName("param")[0];t.axis=e.textContent;let r=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=r.substring(0,r.length-1)}}return t}function Ee(e){return void 0!==e.build?e.build:e}function Ae(e){let t=[],r=Ge.querySelector('[id="'+e.id+'"]');for(let e=0;e<r.childNodes.length;e++){let i,a,s=r.childNodes[e];if(1===s.nodeType)switch(s.nodeName){case"matrix":i=n(s.textContent);let e=(new lt).fromArray(i).transpose();t.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:e});break;case"translate":case"scale":i=n(s.textContent),a=(new F).fromArray(i),t.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:a});break;case"rotate":i=n(s.textContent),a=(new F).fromArray(i);let r=Tr.degToRad(i[3]);t.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:a,angle:r})}}return t}let Ce=new lt,Pe=new F;function Re(e){let t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new lt,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let r=0;r<e.childNodes.length;r++){let i,a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"node":t.nodes.push(a.getAttribute("id")),Re(a);break;case"instance_camera":t.instanceCameras.push(s(a.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Ie(a));break;case"instance_light":t.instanceLights.push(s(a.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Ie(a));break;case"instance_node":t.instanceNodes.push(s(a.getAttribute("url")));break;case"matrix":i=n(a.textContent),t.matrix.multiply(Ce.fromArray(i).transpose()),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"translate":i=n(a.textContent),Pe.fromArray(i),t.matrix.multiply(Ce.makeTranslation(Pe.x,Pe.y,Pe.z)),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"rotate":i=n(a.textContent);let e=Tr.degToRad(i[3]);t.matrix.multiply(Ce.makeRotationAxis(Pe.fromArray(i),e)),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"scale":i=n(a.textContent),t.matrix.scale(Pe.fromArray(i)),t.transforms[a.getAttribute("sid")]=a.nodeName;break;case"extra":break;default:console.log(a)}}return Ue(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):tt.nodes[t.id]=t,t}function Ie(e){let t={id:s(e.getAttribute("url")),materials:{},skeletons:[]};for(let r=0;r<e.childNodes.length;r++){let i=e.childNodes[r];switch(i.nodeName){case"bind_material":let e=i.getElementsByTagName("instance_material");for(let r=0;r<e.length;r++){let i=e[r],n=i.getAttribute("symbol"),a=i.getAttribute("target");t.materials[n]=s(a)}break;case"skeleton":t.skeletons.push(s(i.textContent))}}return t}function Oe(e,t){let r,i,n,a=[],s=[];for(r=0;r<e.length;r++){let i,n=e[r];if(Ue(n))i=Be(n),Le(i,t,a);else if(He(n)){let e=tt.visualScenes[n].children;for(let r=0;r<e.length;r++){let i=e[r];if("JOINT"===i.type){Le(Be(i.id),t,a)}}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",n)}for(r=0;r<t.length;r++)for(i=0;i<a.length;i++)if(n=a[i],n.bone.name===t[r].name){s[r]=n,n.processed=!0;break}for(r=0;r<a.length;r++)n=a[r],!1===n.processed&&(s.push(n),n.processed=!0);let o=[],l=[];for(r=0;r<s.length;r++)n=s[r],o.push(n.bone),l.push(n.boneInverse);return new uc(o,l)}function Le(e,t,r){e.traverse((function(e){if(!0===e.isBone){let i;for(let r=0;r<t.length;r++){let n=t[r];if(n.name===e.name){i=n.boneInverse;break}}void 0===i&&(i=new lt),r.push({bone:e,boneInverse:i,processed:!1})}}))}function De(e){let t,r=[],i=e.matrix,n=e.nodes,a=e.type,s=e.instanceCameras,o=e.instanceControllers,l=e.instanceLights,h=e.instanceGeometries,c=e.instanceNodes;for(let e=0,t=n.length;e<t;e++)r.push(Be(n[e]));for(let e=0,t=s.length;e<t;e++){let t=re(s[e]);null!==t&&r.push(t.clone())}for(let e=0,t=o.length;e<t;e++){let t=o[e],i=O(t.id),n=Ne(fe(i.id),t.materials),a=Oe(t.skeletons,i.skin.joints);for(let e=0,t=n.length;e<t;e++){let t=n[e];t.isSkinnedMesh&&(t.bind(a,i.skin.bindMatrix),t.normalizeSkinWeights()),r.push(t)}}for(let e=0,t=l.length;e<t;e++){let t=se(l[e]);null!==t&&r.push(t.clone())}for(let e=0,t=h.length;e<t;e++){let t=h[e],i=Ne(fe(t.id),t.materials);for(let e=0,t=i.length;e<t;e++)r.push(i[e])}for(let e=0,t=c.length;e<t;e++)r.push(Be(c[e]).clone());if(0===n.length&&1===r.length)t=r[0];else{t="JOINT"===a?new cc:new Xr;for(let e=0;e<r.length;e++)t.add(r[e])}return t.name="JOINT"===a?e.sid:e.name,t.matrix.copy(i),t.matrix.decompose(t.position,t.quaternion,t.scale),t}let ke=new Mr({name:Mn.DEFAULT_MATERIAL_NAME,color:16711935});function Fe(e,t){let r=[];for(let i=0,n=e.length;i<n;i++){let n=t[e[i]];void 0===n?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[i]),r.push(ke)):r.push(K(n))}return r}function Ne(e,t){let r=[];for(let i in e){let n=e[i],a=Fe(n.materialKeys,t);if(0===a.length&&("lines"===i||"linestrips"===i?a.push(new Yr):a.push(new Da)),"lines"===i||"linestrips"===i)for(let e=0,t=a.length;e<t;e++){let t=a[e];if(!0===t.isMeshPhongMaterial||!0===t.isMeshLambertMaterial){let r=new Yr;r.color.copy(t.color),r.opacity=t.opacity,r.transparent=t.transparent,a[e]=r}}let s,o=void 0!==n.data.attributes.skinIndex,l=1===a.length?a[0]:a;switch(i){case"lines":s=new Wn(n.data,l);break;case"linestrips":s=new jn(n.data,l);break;case"triangles":case"polylist":s=o?new yh(n.data,l):new Ht(n.data,l)}r.push(s)}return r}function Ue(e){return void 0!==tt.nodes[e]}function Be(e){return d(tt.nodes[e],De)}function ze(e){let t=new Xr;t.name=e.name;let r=e.children;for(let e=0;e<r.length;e++){let i=r[e];t.add(Be(i.id))}return t}function He(e){return void 0!==tt.visualScenes[e]}function Ve(e){return d(tt.visualScenes[e],ze)}if(0===e.length)return{scene:new Xi};let je=(new DOMParser).parseFromString(e,"application/xml"),Ge=r(je,"COLLADA")[0],We=je.getElementsByTagName("parsererror")[0];if(void 0!==We){let e,t=r(We,"div")[0];return e=t?t.textContent:function(e){let t="",r=[e];for(;r.length;){let e=r.shift();e.nodeType===Node.TEXT_NODE?t+=e.textContent:(t+="\n",r.push.apply(r,e.childNodes))}return t.trim()}(We),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",e),null}let Xe=Ge.getAttribute("version");console.debug("THREE.ColladaLoader: File version",Xe);let qe=($e=r(Ge,"asset")[0],{unit:l(r($e,"unit")[0]),upAxis:h(r($e,"up_axis")[0])}),Ye=new Ds(this.manager);var $e;let Ze;Ye.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),BT&&(Ze=new BT(this.manager),Ze.setPath(this.resourcePath||t));let Ke=new dt,Je=[],Qe={},et=0,tt={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};c(Ge,"library_animations","animation",(function e(t){let r={sources:{},samplers:{},channels:{}},i=!1;for(let n=0,a=t.childNodes.length;n<a;n++){let a,s=t.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"source":a=s.getAttribute("id"),r.sources[a]=oe(s);break;case"sampler":a=s.getAttribute("id"),r.samplers[a]=p(s);break;case"channel":a=s.getAttribute("target"),r.channels[a]=f(s);break;case"animation":e(s),i=!0;break;default:console.log(s)}}!1===i&&(tt.animations[t.getAttribute("id")||Tr.generateUUID()]=r)})),c(Ge,"library_animation_clips","animation_clip",(function(e){let t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType&&"instance_animation"===i.nodeName)t.animations.push(s(i.getAttribute("url")))}tt.clips[e.getAttribute("id")]=t})),c(Ge,"library_controllers","controller",(function(e){let t={};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"skin":t.id=s(i.getAttribute("source")),t.skin=C(i);break;case"morph":t.id=s(i.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}tt.controllers[e.getAttribute("id")]=t})),c(Ge,"library_images","image",(function(e){let t={init_from:r(e,"init_from")[0].textContent};tt.images[e.getAttribute("id")]=t})),c(Ge,"library_effects","effect",(function(e){let t={};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType&&"profile_COMMON"===i.nodeName)t.profile=k(i)}tt.effects[e.getAttribute("id")]=t})),c(Ge,"library_materials","material",(function(e){let t={name:e.getAttribute("name")};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType&&"instance_effect"===i.nodeName)t.url=s(i.getAttribute("url"))}tt.materials[e.getAttribute("id")]=t})),c(Ge,"library_cameras","camera",(function(e){let t={name:e.getAttribute("name")};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType&&"optics"===i.nodeName)t.optics=J(i)}tt.cameras[e.getAttribute("id")]=t})),c(Ge,"library_lights","light",(function(e){let t={};for(let r=0,i=e.childNodes.length;r<i;r++){let i=e.childNodes[r];if(1===i.nodeType&&"technique_common"===i.nodeName)t=ie(i)}tt.lights[e.getAttribute("id")]=t})),c(Ge,"library_geometries","geometry",(function(e){let t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},i=r(e,"mesh")[0];if(void 0!==i){for(let e=0;e<i.childNodes.length;e++){let r=i.childNodes[e];if(1!==r.nodeType)continue;let n=r.getAttribute("id");switch(r.nodeName){case"source":t.sources[n]=oe(r);break;case"vertices":t.vertices=le(r);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",r.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(he(r));break;default:console.log(r)}}tt.geometries[e.getAttribute("id")]=t}})),c(Ge,"library_nodes","node",Re),c(Ge,"library_visual_scenes","visual_scene",(function(e){let t={name:e.getAttribute("name"),children:[]};!function(e){let t=e.getElementsByTagName("node");for(let e=0;e<t.length;e++){let r=t[e];!1===r.hasAttribute("id")&&r.setAttribute("id","three_default_"+et++)}}(e);let i=r(e,"node");for(let e=0;e<i.length;e++)t.children.push(Re(i[e]));tt.visualScenes[e.getAttribute("id")]=t})),c(Ge,"library_kinematics_models","kinematics_model",(function(e){let t={name:e.getAttribute("name")||"",joints:{},links:[]};for(let r=0;r<e.childNodes.length;r++){let i=e.childNodes[r];if(1===i.nodeType&&"technique_common"===i.nodeName)ge(i,t)}tt.kinematicsModels[e.getAttribute("id")]=t})),c(Ge,"library_physics_models","physics_model",(function(e){let t={name:e.getAttribute("name")||"",rigidBodies:{}};for(let r=0;r<e.childNodes.length;r++){let i=e.childNodes[r];if(1===i.nodeType&&"rigid_body"===i.nodeName)t.rigidBodies[i.getAttribute("name")]={},we(i,t.rigidBodies[i.getAttribute("name")])}tt.physicsModels[e.getAttribute("id")]=t})),c(Ge,"scene","instance_kinematics_scene",(function(e){let t={bindJointAxis:[]};for(let r=0;r<e.childNodes.length;r++){let i=e.childNodes[r];if(1===i.nodeType&&"bind_joint_axis"===i.nodeName)t.bindJointAxis.push(Me(i))}tt.kinematicsScenes[s(e.getAttribute("url"))]=t})),u(tt.animations,m),u(tt.clips,E),u(tt.controllers,I),u(tt.images,L),u(tt.effects,$),u(tt.materials,Z),u(tt.cameras,te),u(tt.lights,ae),u(tt.geometries,ue),u(tt.visualScenes,ze),function(){let e=tt.clips;if(!0===o(e)){if(!1===o(tt.animations)){let e=[];for(let t in tt.animations){let r=g(t);for(let t=0,i=r.length;t<i;t++)e.push(r[t])}Je.push(new Yo("default",-1,e))}}else for(let t in e)Je.push(A(t))}(),function(){let e=Object.keys(tt.kinematicsModels)[0],t=Object.keys(tt.kinematicsScenes)[0],r=Object.keys(tt.visualScenes)[0];if(void 0===e||void 0===t)return;let i=function(e){return d(tt.kinematicsModels[e],me)}(e),n=function(e){return d(tt.kinematicsScenes[e],Ee)}(t),a=Ve(r),s=n.bindJointAxis,o={};for(let e=0,t=s.length;e<t;e++){let t=s[e],r=Ge.querySelector('[sid="'+t.target+'"]');if(r){let e=r.parentElement;l(t.jointIndex,e)}}function l(e,t){let r=t.getAttribute("name"),n=i.joints[e];a.traverse((function(i){i.name===r&&(o[e]={object:i,transforms:Ae(t),joint:n,position:n.zeroPosition})}))}let h=new lt;Qe={joints:i&&i.joints,getJointValue:function(e){let t=o[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){let r=o[e];if(r){let i=r.joint;if(t>i.limits.max||t<i.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+i.limits.min+", max: "+i.limits.max+").");else if(i.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{let n=r.object,a=i.axis,s=r.transforms;Ce.identity();for(let r=0;r<s.length;r++){let n=s[r];if(n.sid&&-1!==n.sid.indexOf(e))switch(i.type){case"revolute":Ce.multiply(h.makeRotationAxis(a,Tr.degToRad(t)));break;case"prismatic":Ce.multiply(h.makeTranslation(a.x*t,a.y*t,a.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+i.type)}else switch(n.type){case"matrix":Ce.multiply(n.obj);break;case"translate":Ce.multiply(h.makeTranslation(n.obj.x,n.obj.y,n.obj.z));break;case"scale":Ce.scale(n.obj);break;case"rotate":Ce.multiply(h.makeRotationAxis(n.obj,n.angle))}}n.matrix.copy(Ce),n.matrix.decompose(n.position,n.quaternion,n.scale),o[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}();let rt=function(e){return Ve(s(r(e,"instance_visual_scene")[0].getAttribute("url")))}(r(Ge,"scene")[0]);return rt.animations=Je,"Z_UP"===qe.upAxis&&(console.warn("THREE.ColladaLoader: You are loading an asset with a Z-UP coordinate system. The loader just rotates the asset to transform it into Y-UP. The vertex data are not converted, see #24289."),rt.rotation.set(-Math.PI/2,0,0)),rt.scale.multiplyScalar(qe.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),Je},kinematics:Qe,library:tt,scene:rt}}},Ez=new WeakMap,V3=class extends Mn{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,i){let n=new Hn(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,(e=>{this.parse(e,t,i)}),r,i)}parse(e,t,r){this.decodeDracoFile(e,t,null,null,Zr).catch(r)}decodeDracoFile(e,t,r,i,n=Hi){let a={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!r,vertexColorSpace:n};return this.decodeGeometry(e,a).then(t)}decodeGeometry(e,t){let r=JSON.stringify(t);if(Ez.has(e)){let t=Ez.get(e);if(t.key===r)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i,n=this.workerNextTaskID++,a=e.byteLength,s=this._getWorker(n,a).then((r=>(i=r,new Promise(((r,a)=>{i._callbacks[n]={resolve:r,reject:a},i.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return s.catch((()=>!0)).then((()=>{i&&n&&this._releaseTask(i,n)})),Ez.set(e,{key:r,promise:s}),s}_createGeometry(e){let t=new Nt;e.index&&t.setIndex(new fr(e.index.array,1));for(let r=0;r<e.attributes.length;r++){let i=e.attributes[r],n=i.name,a=i.array,s=i.itemSize,o=new fr(a,s);"color"===n&&(this._assignVertexColorSpace(o,i.vertexColorSpace),o.normalized=!(a instanceof Float32Array)),t.setAttribute(n,o)}return t}_assignVertexColorSpace(e,t){if(t!==Zr)return;let r=new dt;for(let t=0,i=e.count;t<i;t++)r.fromBufferAttribute(e,t).convertSRGBToLinear(),e.setXYZ(t,r.r,r.g,r.b)}_loadLibrary(e,t){let r=new Hn(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise(((t,i)=>{r.load(e,t,void 0,i)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{let r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);let i=OSt.toString(),n=["/* draco decoder */",r,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){let e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){let r=t.data;switch(r.type){case"decode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));let r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}};function OSt(){let e,t;function r(e,t,r,i,n,a){let s=a.num_components(),o=r.num_points()*s,l=o*n.BYTES_PER_ELEMENT,h=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,n),c=e._malloc(l);t.GetAttributeDataArrayForAllPoints(r,a,h,l,c);let u=new n(e.HEAPF32.buffer,c,o).slice();return e._free(c),{name:i,array:u,itemSize:s}}onmessage=function(i){let n=i.data;switch(n.type){case"init":e=n.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":let i=n.buffer,a=n.taskConfig;t.then((e=>{let t=e.draco,s=new t.Decoder;try{let e=function(e,t,i,n){let a,s,o=n.attributeIDs,l=n.attributeTypes,h=t.GetEncodedGeometryType(i);if(h===e.TRIANGULAR_MESH)a=new e.Mesh,s=t.DecodeArrayToMesh(i,i.byteLength,a);else{if(h!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,s=t.DecodeArrayToPointCloud(i,i.byteLength,a)}if(!s.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+s.error_msg());let c={index:null,attributes:[]};for(let i in o){let s,h,u=self[l[i]];if(n.useUniqueIDs)h=o[i],s=t.GetAttributeByUniqueId(a,h);else{if(h=t.GetAttributeId(a,e[o[i]]),-1===h)continue;s=t.GetAttribute(a,h)}let d=r(e,t,a,i,u,s);"color"===i&&(d.vertexColorSpace=n.vertexColorSpace),c.attributes.push(d)}return h===e.TRIANGULAR_MESH&&(c.index=function(e,t,r){let i=3*r.num_faces(),n=4*i,a=e._malloc(n);t.GetTrianglesUInt32Array(r,n,a);let s=new Uint32Array(e.HEAPF32.buffer,a,i).slice();return e._free(a),{array:s,itemSize:1}}(e,t,a)),e.destroy(a),c}(t,s,new Int8Array(i),a),o=e.attributes.map((e=>e.array.buffer));e.index&&o.push(e.index.array.buffer),self.postMessage({type:"decode",id:n.id,geometry:e},o)}catch(e){console.error(e),self.postMessage({type:"error",id:n.id,error:e.message})}finally{t.destroy(s)}}))}}}function Jxe(e,t,r){let i=r.length-e-1;if(t>=r[i])return i-1;if(t<=r[e])return e;let n=e,a=i,s=Math.floor((n+a)/2);for(;t<r[s]||t>=r[s+1];)t<r[s]?a=s:n=s,s=Math.floor((n+a)/2);return s}function DSt(e,t,r,i){let n=[],a=[],s=[];n[0]=1;for(let o=1;o<=r;++o){a[o]=t-i[e+1-o],s[o]=i[e+o]-t;let r=0;for(let e=0;e<o;++e){let t=s[e+1],i=a[o-e],l=n[e]/(t+i);n[e]=r+t*l,r=i*l}n[o]=r}return n}function Qxe(e,t,r,i){let n=Jxe(e,i,t),a=DSt(n,i,e,t),s=new Fn(0,0,0,0);for(let t=0;t<=e;++t){let i=r[n-e+t],o=a[t],l=i.w*o;s.x+=i.x*l,s.y+=i.y*l,s.z+=i.z*l,s.w+=i.w*o}return s}function LSt(e,t,r,i,n){let a=[];for(let e=0;e<=r;++e)a[e]=0;let s=[];for(let e=0;e<=i;++e)s[e]=a.slice(0);let o=[];for(let e=0;e<=r;++e)o[e]=a.slice(0);o[0][0]=1;let l=a.slice(0),h=a.slice(0);for(let i=1;i<=r;++i){l[i]=t-n[e+1-i],h[i]=n[e+i]-t;let r=0;for(let e=0;e<i;++e){let t=h[e+1],n=l[i-e];o[i][e]=t+n;let a=o[e][i-1]/o[i][e];o[e][i]=r+t*a,r=n*a}o[i][i]=r}for(let e=0;e<=r;++e)s[0][e]=o[e][r];for(let e=0;e<=r;++e){let t=0,n=1,l=[];for(let e=0;e<=r;++e)l[e]=a.slice(0);l[0][0]=1;for(let a=1;a<=i;++a){let i=0,h=e-a,c=r-a;e>=a&&(l[n][0]=l[t][0]/o[c+1][h],i=l[n][0]*o[h][c]);let u=e-1<=c?a-1:r-e;for(let e=h>=-1?1:-h;e<=u;++e)l[n][e]=(l[t][e]-l[t][e-1])/o[c+1][h+e],i+=l[n][e]*o[h+e][c];e<=c&&(l[n][a]=-l[t][a-1]/o[c+1][e],i+=l[n][a]*o[e][c]),s[a][e]=i;let d=t;t=n,n=d}}let c=r;for(let e=1;e<=i;++e){for(let t=0;t<=r;++t)s[e][t]*=c;c*=r-e}return s}function kSt(e,t,r,i,n){let a=n<e?n:e,s=[],o=Jxe(e,i,t),l=LSt(o,i,e,a,t),h=[];for(let e=0;e<r.length;++e){let t=r[e].clone(),i=t.w;t.x*=i,t.y*=i,t.z*=i,h[e]=t}for(let t=0;t<=a;++t){let r=h[o-e].clone().multiplyScalar(l[t][0]);for(let i=1;i<=e;++i)r.add(h[o-e+i].clone().multiplyScalar(l[t][i]));s[t]=r}for(let e=a+1;e<=n+1;++e)s[e]=new Fn(0,0,0);return s}function FSt(e,t){let r=1;for(let t=2;t<=e;++t)r*=t;let i=1;for(let e=2;e<=t;++e)i*=e;for(let r=2;r<=e-t;++r)i*=r;return r/i}function BSt(e){let t=e.length,r=[],i=[];for(let n=0;n<t;++n){let t=e[n];r[n]=new F(t.x,t.y,t.z),i[n]=t.w}let n=[];for(let e=0;e<t;++e){let t=r[e].clone();for(let r=1;r<=e;++r)t.sub(n[e-r].clone().multiplyScalar(FSt(e,r)*i[r]));n[e]=t.divideScalar(i[0])}return n}function eEe(e,t,r,i,n){return BSt(kSt(e,t,r,i,n))}var z3=class extends To{constructor(e,t,r,i,n){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=n||this.knots.length-1;for(let e=0;e<r.length;++e){let t=r[e];this.controlPoints[e]=new Fn(t.x,t.y,t.z,t.w)}}getPoint(e,t=new F){let r=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),n=Qxe(this.degree,this.knots,this.controlPoints,i);return 1!==n.w&&n.divideScalar(n.w),r.set(n.x,n.y,n.z)}getTangent(e,t=new F){let r=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),n=eEe(this.degree,this.knots,this.controlPoints,i,1);return r.copy(n[1]).normalize(),r}},Un,zs,Ro,q3=class extends Mn{constructor(e){super(e)}load(e,t,r,i){let n=this,a=""===n.path?oa.extractUrlBase(e):n.path,s=new Hn(this.manager);s.setPath(n.path),s.setResponseType("arraybuffer"),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(e,(function(r){try{t(n.parse(r,a))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}}),r,i)}parse(e,t){if(USt(e))Un=(new Rz).parse(e);else{let t=iEe(e);if(!HSt(t))throw new Error("THREE.FBXLoader: Unknown format.");if(tEe(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+tEe(t));Un=(new Az).parse(t)}let r=new Ds(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new wz(r,this.manager).parse(Un)}},wz=class{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){zs=this.parseConnections();let e=this.parseImages(),t=this.parseTextures(e),r=this.parseMaterials(t),i=this.parseDeformers(),n=(new Sz).parse(i);return this.parseScene(i,n,r),Ro}parseConnections(){let e=new Map;return"Connections"in Un&&Un.Connections.connections.forEach((function(t){let r=t[0],i=t[1],n=t[2];e.has(r)||e.set(r,{parents:[],children:[]});let a={ID:i,relationship:n};e.get(r).parents.push(a),e.has(i)||e.set(i,{parents:[],children:[]});let s={ID:r,relationship:n};e.get(i).children.push(s)})),e}parseImages(){let e={},t={};if("Video"in Un.Objects){let r=Un.Objects.Video;for(let i in r){let n=r[i];if(e[parseInt(i)]=n.RelativeFilename||n.Filename,"Content"in n){let e=n.Content instanceof ArrayBuffer&&n.Content.byteLength>0,a="string"==typeof n.Content&&""!==n.Content;if(e||a){let e=this.parseImage(r[i]);t[n.RelativeFilename||n.Filename]=e}}}}for(let r in e){let i=e[r];void 0!==t[i]?e[r]=t[i]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){let t,r=e.Content,i=e.RelativeFilename||e.Filename,n=i.slice(i.lastIndexOf(".")+1).toLowerCase();switch(n){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",i),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+n+'" is not supported.')}if("string"==typeof r)return"data:"+t+";base64,"+r;{let e=new Uint8Array(r);return window.URL.createObjectURL(new Blob([e],{type:t}))}}parseTextures(e){let t=new Map;if("Texture"in Un.Objects){let r=Un.Objects.Texture;for(let i in r){let n=this.parseTexture(r[i],e);t.set(parseInt(i),n)}}return t}parseTexture(e,t){let r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;let i=e.WrapModeU,n=e.WrapModeV,a=void 0!==i?i.value:0,s=void 0!==n?n.value:0;if(r.wrapS=0===a?ui:pi,r.wrapT=0===s?ui:pi,"Scaling"in e){let t=e.Scaling.value;r.repeat.x=t[0],r.repeat.y=t[1]}if("Translation"in e){let t=e.Translation.value;r.offset.x=t[0],r.offset.y=t[1]}return r}loadTexture(e,t){let r,i=this.textureLoader.path,n=zs.get(e.id).children;void 0!==n&&n.length>0&&void 0!==t[n[0].ID]&&(r=t[n[0].ID],(0===r.indexOf("blob:")||0===r.indexOf("data:"))&&this.textureLoader.setPath(void 0));let a,s=e.FileName.slice(-3).toLowerCase();if("tga"===s){let t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),a=new bi):(t.setPath(this.textureLoader.path),a=t.load(r))}else if("dds"===s){let t=this.manager.getHandler(".dds");null===t?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",e.RelativeFilename),a=new bi):(t.setPath(this.textureLoader.path),a=t.load(r))}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),a=new bi):a=this.textureLoader.load(r);return this.textureLoader.setPath(i),a}parseMaterials(e){let t=new Map;if("Material"in Un.Objects){let r=Un.Objects.Material;for(let i in r){let n=this.parseMaterial(r[i],e);null!==n&&t.set(parseInt(i),n)}}return t}parseMaterial(e,t){let r=e.id,i=e.attrName,n=e.ShadingModel;if("object"==typeof n&&(n=n.value),!zs.has(r))return null;let a,s=this.parseParameters(e,t,r);switch(n.toLowerCase()){case"phong":a=new Da;break;case"lambert":a=new Th;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',n),a=new Da}return a.setValues(s),a.name=i,a}parseParameters(e,t,r){let i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=(new dt).fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&("Color"===e.DiffuseColor.type||"ColorRGB"===e.DiffuseColor.type)&&(i.color=(new dt).fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=(new dt).fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&("Color"===e.EmissiveColor.type||"ColorRGB"===e.EmissiveColor.type)&&(i.emissive=(new dt).fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=(new dt).fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=(new dt).fromArray(e.SpecularColor.value).convertSRGBToLinear());let n=this;return zs.get(r).children.forEach((function(e){let r=e.relationship;switch(r){case"Bump":i.bumpMap=n.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=n.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=n.getTexture(t,e.ID),void 0!==i.map&&(i.map.colorSpace=Zr);break;case"DisplacementColor":i.displacementMap=n.getTexture(t,e.ID);break;case"EmissiveColor":i.emissiveMap=n.getTexture(t,e.ID),void 0!==i.emissiveMap&&(i.emissiveMap.colorSpace=Zr);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=n.getTexture(t,e.ID);break;case"ReflectionColor":i.envMap=n.getTexture(t,e.ID),void 0!==i.envMap&&(i.envMap.mapping=Og,i.envMap.colorSpace=Zr);break;case"SpecularColor":i.specularMap=n.getTexture(t,e.ID),void 0!==i.specularMap&&(i.specularMap.colorSpace=Zr);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=n.getTexture(t,e.ID),i.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",r)}})),i}getTexture(e,t){return"LayeredTexture"in Un.Objects&&t in Un.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=zs.get(t).children[0].ID),e.get(t)}parseDeformers(){let e={},t={};if("Deformer"in Un.Objects){let r=Un.Objects.Deformer;for(let i in r){let n=r[i],a=zs.get(parseInt(i));if("Skin"===n.attrType){let t=this.parseSkeleton(a,r);t.ID=i,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=a.parents[0].ID,e[i]=t}else if("BlendShape"===n.attrType){let e={id:i};e.rawTargets=this.parseMorphTargets(a,r),e.id=i,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){let r=[];return e.children.forEach((function(e){let i=t[e.ID];if("Cluster"!==i.attrType)return;let n={ID:e.ID,indices:[],weights:[],transformLink:(new lt).fromArray(i.TransformLink.a)};"Indexes"in i&&(n.indices=i.Indexes.a,n.weights=i.Weights.a),r.push(n)})),{rawBones:r,bones:[]}}parseMorphTargets(e,t){let r=[];for(let i=0;i<e.children.length;i++){let n=e.children[i],a=t[n.ID],s={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;s.geoID=zs.get(parseInt(n.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,r.push(s)}return r}parseScene(e,t,r){Ro=new Xr;let i=this.parseModels(e.skeletons,t,r),n=Un.Objects.Model,a=this;i.forEach((function(e){let t=n[e.ID];a.setLookAtProperties(e,t),zs.get(e.ID).parents.forEach((function(t){let r=i.get(t.ID);void 0!==r&&r.add(e)})),null===e.parent&&Ro.add(e)})),this.bindSkeleton(e.skeletons,t,i),this.addGlobalSceneSettings(),Ro.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);let t=rEe(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));let s=(new Mz).parse();1===Ro.children.length&&Ro.children[0].isGroup&&(Ro.children[0].animations=s,Ro=Ro.children[0]),Ro.animations=s}parseModels(e,t,r){let i=new Map,n=Un.Objects.Model;for(let a in n){let s=parseInt(a),o=n[a],l=zs.get(s),h=this.buildSkeleton(l,e,s,o.attrName);if(!h){switch(o.attrType){case"Camera":h=this.createCamera(l);break;case"Light":h=this.createLight(l);break;case"Mesh":h=this.createMesh(l,t,r);break;case"NurbsCurve":h=this.createCurve(l,t);break;case"LimbNode":case"Root":h=new cc;break;default:h=new Xr}h.name=o.attrName?hn.sanitizeNodeName(o.attrName):"",h.userData.originalName=o.attrName,h.ID=s}this.getTransformData(h,o),i.set(s,h)}return i}buildSkeleton(e,t,r,i){let n=null;return e.parents.forEach((function(e){for(let a in t){let s=t[a];s.rawBones.forEach((function(t,a){if(t.ID===e.ID){let e=n;n=new cc,n.matrixWorld.copy(t.transformLink),n.name=i?hn.sanitizeNodeName(i):"",n.userData.originalName=i,n.ID=r,s.bones[a]=n,null!==e&&n.add(e)}}))}})),n}createCamera(e){let t,r;if(e.children.forEach((function(e){let t=Un.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)})),void 0===r)t=new yr;else{let e=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(e=1);let i=1;void 0!==r.NearPlane&&(i=r.NearPlane.value/1e3);let n=1e3;void 0!==r.FarPlane&&(n=r.FarPlane.value/1e3);let a=window.innerWidth,s=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(a=r.AspectWidth.value,s=r.AspectHeight.value);let o=a/s,l=45;void 0!==r.FieldOfView&&(l=r.FieldOfView.value);let h=r.FocalLength?r.FocalLength.value:null;switch(e){case 0:t=new ci(l,o,i,n),null!==h&&t.setFocalLength(h);break;case 1:t=new Gi(-a/2,a/2,s/2,-s/2,i,n);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new yr}}return t}createLight(e){let t,r;if(e.children.forEach((function(e){let t=Un.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)})),void 0===r)t=new yr;else{let e;e=void 0===r.LightType?0:r.LightType.value;let i=16777215;void 0!==r.Color&&(i=(new dt).fromArray(r.Color.value).convertSRGBToLinear());let n=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(n=0);let a=0;void 0!==r.FarAttenuationEnd&&(a=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value);let s=1;switch(e){case 0:t=new Cl(i,n,a,s);break;case 1:t=new ya(i,n);break;case 2:let e=Math.PI/3;void 0!==r.InnerAngle&&(e=Tr.degToRad(r.InnerAngle.value));let o=0;void 0!==r.OuterAngle&&(o=Tr.degToRad(r.OuterAngle.value),o=Math.max(o,1)),t=new pc(i,n,a,e,o,s);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),t=new Cl(i,n)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,r){let i,n=null,a=null,s=[];return e.children.forEach((function(e){t.has(e.ID)&&(n=t.get(e.ID)),r.has(e.ID)&&s.push(r.get(e.ID))})),s.length>1?a=s:s.length>0?a=s[0]:(a=new Da({name:Mn.DEFAULT_MATERIAL_NAME,color:13421772}),s.push(a)),"color"in n.attributes&&s.forEach((function(e){e.vertexColors=!0})),n.FBX_Deformer?(i=new yh(n,a),i.normalizeSkinWeights()):i=new Ht(n,a),i}createCurve(e,t){let r=e.children.reduce((function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e}),null),i=new Yr({name:Mn.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new jn(r,i)}getTransformData(e,t){let r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?nEe(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,t){"LookAtProperty"in t&&zs.get(e.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){let r=Un.Objects.Model[t.ID];if("Lcl_Translation"in r){let t=r.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),Ro.add(e.target)):e.lookAt((new F).fromArray(t))}}}))}bindSkeleton(e,t,r){let i=this.parsePoseNodes();for(let n in e){let a=e[n];zs.get(parseInt(a.ID)).parents.forEach((function(e){if(t.has(e.ID)){let t=e.ID;zs.get(t).parents.forEach((function(e){r.has(e.ID)&&r.get(e.ID).bind(new uc(a.bones),i[e.ID])}))}}))}}parsePoseNodes(){let e={};if("Pose"in Un.Objects){let t=Un.Objects.Pose;for(let r in t)if("BindPose"===t[r].attrType&&t[r].NbPoseNodes>0){let i=t[r].PoseNode;Array.isArray(i)?i.forEach((function(t){e[t.Node]=(new lt).fromArray(t.Matrix.a)})):e[i.Node]=(new lt).fromArray(i.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in Un){if("AmbientColor"in Un.GlobalSettings){let e=Un.GlobalSettings.AmbientColor.value,t=e[0],r=e[1],i=e[2];if(0!==t||0!==r||0!==i){let e=new dt(t,r,i).convertSRGBToLinear();Ro.add(new $o(e,1))}}"UnitScaleFactor"in Un.GlobalSettings&&(Ro.userData.unitScaleFactor=Un.GlobalSettings.UnitScaleFactor.value)}}},Sz=class{constructor(){this.negativeMaterialIndices=!1}parse(e){let t=new Map;if("Geometry"in Un.Objects){let r=Un.Objects.Geometry;for(let i in r){let n=zs.get(parseInt(i)),a=this.parseGeometry(n,r[i],e);t.set(parseInt(i),a)}}return!0===this.negativeMaterialIndices&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,r){let i=r.skeletons,n=[],a=e.parents.map((function(e){return Un.Objects.Model[e.ID]}));if(0===a.length)return;let s=e.children.reduce((function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e}),null);e.children.forEach((function(e){void 0!==r.morphTargets[e.ID]&&n.push(r.morphTargets[e.ID])}));let o=a[0],l={};"RotationOrder"in o&&(l.eulerOrder=nEe(o.RotationOrder.value)),"InheritType"in o&&(l.inheritType=parseInt(o.InheritType.value)),"GeometricTranslation"in o&&(l.translation=o.GeometricTranslation.value),"GeometricRotation"in o&&(l.rotation=o.GeometricRotation.value),"GeometricScaling"in o&&(l.scale=o.GeometricScaling.value);let h=rEe(l);return this.genGeometry(t,s,n,h)}genGeometry(e,t,r,i){let n=new Nt;e.attrName&&(n.name=e.attrName);let a=this.parseGeoNode(e,t),s=this.genBuffers(a),o=new zt(s.vertex,3);if(o.applyMatrix4(i),n.setAttribute("position",o),s.colors.length>0&&n.setAttribute("color",new zt(s.colors,3)),t&&(n.setAttribute("skinIndex",new Dg(s.weightsIndices,4)),n.setAttribute("skinWeight",new zt(s.vertexWeights,4)),n.FBX_Deformer=t),s.normal.length>0){let e=(new Wr).getNormalMatrix(i),t=new zt(s.normal,3);t.applyNormalMatrix(e),n.setAttribute("normal",t)}if(s.uvs.forEach((function(e,t){let r=0===t?"uv":`uv${t}`;n.setAttribute(r,new zt(s.uvs[t],2))})),a.material&&"AllSame"!==a.material.mappingType){let e=s.materialIndex[0],t=0;if(s.materialIndex.forEach((function(r,i){r!==e&&(n.addGroup(t,i-t,e),e=r,t=i)})),n.groups.length>0){let t=n.groups[n.groups.length-1],r=t.start+t.count;r!==s.materialIndex.length&&n.addGroup(r,s.materialIndex.length-r,e)}0===n.groups.length&&n.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(n,e,r,i),n}parseGeoNode(e,t){let r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(i,n){void 0===r.weightTable[i]&&(r.weightTable[i]=[]),r.weightTable[i].push({id:t,weight:e.weights[n]})}))}))),r}genBuffers(e){let t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},r=0,i=0,n=!1,a=[],s=[],o=[],l=[],h=[],c=[],u=this;return e.vertexIndices.forEach((function(d,p){let f,m=!1;d<0&&(d^=-1,m=!0);let g=[],v=[];if(a.push(3*d,3*d+1,3*d+2),e.color){let t=G3(p,r,d,e.color);o.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[d]&&e.weightTable[d].forEach((function(e){v.push(e.weight),g.push(e.id)})),v.length>4){n||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),n=!0);let e=[0,0,0,0],t=[0,0,0,0];v.forEach((function(r,i){let n=r,a=g[i];t.forEach((function(t,r,i){if(n>t){i[r]=n,n=t;let s=e[r];e[r]=a,a=s}}))})),g=e,v=t}for(;v.length<4;)v.push(0),g.push(0);for(let e=0;e<4;++e)h.push(v[e]),c.push(g[e])}if(e.normal){let t=G3(p,r,d,e.normal);s.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(f=G3(p,r,d,e.material)[0],f<0&&(u.negativeMaterialIndices=!0,f=0)),e.uv&&e.uv.forEach((function(e,t){let i=G3(p,r,d,e);void 0===l[t]&&(l[t]=[]),l[t].push(i[0]),l[t].push(i[1])})),i++,m&&(u.genFace(t,e,a,f,s,o,l,h,c,i),r++,i=0,a=[],s=[],o=[],l=[],h=[],c=[])})),t}getNormalNewell(e){let t=new F(0,0,0);for(let r=0;r<e.length;r++){let i=e[r],n=e[(r+1)%e.length];t.x+=(i.y-n.y)*(i.z+n.z),t.y+=(i.z-n.z)*(i.x+n.x),t.z+=(i.x-n.x)*(i.y+n.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){let t=this.getNormalNewell(e),r=(Math.abs(t.z)>.5?new F(0,1,0):new F(0,0,1)).cross(t).normalize(),i=t.clone().cross(r).normalize();return{normal:t,tangent:r,bitangent:i}}flattenVertex(e,t,r){return new Te(e.dot(t),e.dot(r))}genFace(e,t,r,i,n,a,s,o,l,h){let c;if(h>3){let e=[];for(let i=0;i<r.length;i+=3)e.push(new F(t.vertexPositions[r[i]],t.vertexPositions[r[i+1]],t.vertexPositions[r[i+2]]));let{tangent:i,bitangent:n}=this.getNormalTangentAndBitangent(e),a=[];for(let t of e)a.push(this.flattenVertex(t,i,n));c=$s.triangulateShape(a,[])}else c=[[0,1,2]];for(let[h,u,d]of c)e.vertex.push(t.vertexPositions[r[3*h]]),e.vertex.push(t.vertexPositions[r[3*h+1]]),e.vertex.push(t.vertexPositions[r[3*h+2]]),e.vertex.push(t.vertexPositions[r[3*u]]),e.vertex.push(t.vertexPositions[r[3*u+1]]),e.vertex.push(t.vertexPositions[r[3*u+2]]),e.vertex.push(t.vertexPositions[r[3*d]]),e.vertex.push(t.vertexPositions[r[3*d+1]]),e.vertex.push(t.vertexPositions[r[3*d+2]]),t.skeleton&&(e.vertexWeights.push(o[4*h]),e.vertexWeights.push(o[4*h+1]),e.vertexWeights.push(o[4*h+2]),e.vertexWeights.push(o[4*h+3]),e.vertexWeights.push(o[4*u]),e.vertexWeights.push(o[4*u+1]),e.vertexWeights.push(o[4*u+2]),e.vertexWeights.push(o[4*u+3]),e.vertexWeights.push(o[4*d]),e.vertexWeights.push(o[4*d+1]),e.vertexWeights.push(o[4*d+2]),e.vertexWeights.push(o[4*d+3]),e.weightsIndices.push(l[4*h]),e.weightsIndices.push(l[4*h+1]),e.weightsIndices.push(l[4*h+2]),e.weightsIndices.push(l[4*h+3]),e.weightsIndices.push(l[4*u]),e.weightsIndices.push(l[4*u+1]),e.weightsIndices.push(l[4*u+2]),e.weightsIndices.push(l[4*u+3]),e.weightsIndices.push(l[4*d]),e.weightsIndices.push(l[4*d+1]),e.weightsIndices.push(l[4*d+2]),e.weightsIndices.push(l[4*d+3])),t.color&&(e.colors.push(a[3*h]),e.colors.push(a[3*h+1]),e.colors.push(a[3*h+2]),e.colors.push(a[3*u]),e.colors.push(a[3*u+1]),e.colors.push(a[3*u+2]),e.colors.push(a[3*d]),e.colors.push(a[3*d+1]),e.colors.push(a[3*d+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(n[3*h]),e.normal.push(n[3*h+1]),e.normal.push(n[3*h+2]),e.normal.push(n[3*u]),e.normal.push(n[3*u+1]),e.normal.push(n[3*u+2]),e.normal.push(n[3*d]),e.normal.push(n[3*d+1]),e.normal.push(n[3*d+2])),t.uv&&t.uv.forEach((function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(s[r][2*h]),e.uvs[r].push(s[r][2*h+1]),e.uvs[r].push(s[r][2*u]),e.uvs[r].push(s[r][2*u+1]),e.uvs[r].push(s[r][2*d]),e.uvs[r].push(s[r][2*d+1])}))}addMorphTargets(e,t,r,i){if(0===r.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];let n=this;r.forEach((function(r){r.rawTargets.forEach((function(r){let a=Un.Objects.Geometry[r.geoID];void 0!==a&&n.genMorphGeometry(e,t,a,i,r.name)}))}))}genMorphGeometry(e,t,r,i,n){let a=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==r.Vertices?r.Vertices.a:[],o=void 0!==r.Indexes?r.Indexes.a:[],l=3*e.attributes.position.count,h=new Float32Array(l);for(let e=0;e<o.length;e++){let t=3*o[e];h[t]=s[3*e],h[t+1]=s[3*e+1],h[t+2]=s[3*e+2]}let c={vertexIndices:a,vertexPositions:h},u=this.genBuffers(c),d=new zt(u.vertex,3);d.name=n||r.attrName,d.applyMatrix4(i),e.morphAttributes.position.push(d)}parseNormals(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,i=e.Normals.a,n=[];return"IndexToDirect"===r&&("NormalIndex"in e?n=e.NormalIndex.a:"NormalsIndex"in e&&(n=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:n,mappingType:t,referenceType:r}}parseUVs(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,i=e.UV.a,n=[];return"IndexToDirect"===r&&(n=e.UVIndex.a),{dataSize:2,buffer:i,indices:n,mappingType:t,referenceType:r}}parseVertexColors(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,i=e.Colors.a,n=[];"IndexToDirect"===r&&(n=e.ColorIndex.a);for(let e=0,t=new dt;e<i.length;e+=4)t.fromArray(i,e).convertSRGBToLinear().toArray(i,e);return{dataSize:4,buffer:i,indices:n,mappingType:t,referenceType:r}}parseMaterialIndices(e){let t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};let i=e.Materials.a,n=[];for(let e=0;e<i.length;++e)n.push(e);return{dataSize:1,buffer:i,indices:n,mappingType:t,referenceType:r}}parseNurbsGeometry(e){let t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Nt;let r,i,n=t-1,a=e.KnotVector.a,s=[],o=e.Points.a;for(let e=0,t=o.length;e<t;e+=4)s.push((new Fn).fromArray(o,e));if("Closed"===e.Form)s.push(s[0]);else if("Periodic"===e.Form){r=n,i=a.length-1-r;for(let e=0;e<n;++e)s.push(s[e])}let l=new z3(n,a,s,r,i).getPoints(12*s.length);return(new Nt).setFromPoints(l)}},Mz=class{parse(){let e=[],t=this.parseClips();if(void 0!==t)for(let r in t){let i=t[r],n=this.addClip(i);e.push(n)}return e}parseClips(){if(void 0===Un.Objects.AnimationCurve)return;let e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);let t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){let e=Un.Objects.AnimationCurveNode,t=new Map;for(let r in e){let i=e[r];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){let e={id:i.id,attr:i.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){let t=Un.Objects.AnimationCurve;for(let r in t){let i={id:t[r].id,times:t[r].KeyTime.a.map(VSt),values:t[r].KeyValueFloat.a},n=zs.get(i.id);if(void 0!==n){let t=n.parents[0].ID,r=n.parents[0].relationship;r.match(/X/)?e.get(t).curves.x=i:r.match(/Y/)?e.get(t).curves.y=i:r.match(/Z/)?e.get(t).curves.z=i:r.match(/DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=i)}}}parseAnimationLayers(e){let t=Un.Objects.AnimationLayer,r=new Map;for(let i in t){let t=[],n=zs.get(parseInt(i));void 0!==n&&(n.children.forEach((function(r,i){if(e.has(r.ID)){let n=e.get(r.ID);if(void 0!==n.curves.x||void 0!==n.curves.y||void 0!==n.curves.z){if(void 0===t[i]){let e=zs.get(r.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==e){let n=Un.Objects.Model[e.toString()];if(void 0===n)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",r);let a={modelName:n.attrName?hn.sanitizeNodeName(n.attrName):"",ID:n.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Ro.traverse((function(e){e.ID===n.id&&(a.transform=e.matrix,e.userData.transformData&&(a.eulerOrder=e.userData.transformData.eulerOrder))})),a.transform||(a.transform=new lt),"PreRotation"in n&&(a.preRotation=n.PreRotation.value),"PostRotation"in n&&(a.postRotation=n.PostRotation.value),t[i]=a}}t[i]&&(t[i][n.attr]=n)}else if(void 0!==n.curves.morph){if(void 0===t[i]){let e=zs.get(r.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,n=zs.get(e).parents[0].ID,a=zs.get(n).parents[0].ID,s=zs.get(a).parents[0].ID,o=Un.Objects.Model[s],l={modelName:o.attrName?hn.sanitizeNodeName(o.attrName):"",morphName:Un.Objects.Deformer[e].attrName};t[i]=l}t[i][n.attr]=n}}})),r.set(parseInt(i),t))}return r}parseAnimStacks(e){let t=Un.Objects.AnimationStack,r={};for(let i in t){let n=zs.get(parseInt(i)).children;n.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");let a=e.get(n[0].ID);r[i]={name:t[i].attrName,layer:a}}return r}addClip(e){let t=[],r=this;return e.layer.forEach((function(e){t=t.concat(r.generateTracks(e))})),new Yo(e.name,-1,t)}generateTracks(e){let t=[],r=new F,i=new F;if(e.transform&&e.transform.decompose(r,new dn,i),r=r.toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){let i=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==i&&t.push(i)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){let r=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);void 0!==r&&t.push(r)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){let r=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==r&&t.push(r)}if(void 0!==e.DeformPercent){let r=this.generateMorphTrack(e);void 0!==r&&t.push(r)}return t}generateVectorTrack(e,t,r,i){let n=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(n,t,r);return new wo(e+"."+i,n,a)}generateRotationTrack(e,t,r,i,n){let a,s;if(void 0!==t.x&&void 0!==t.y&&void 0!==t.z){let e=this.interpolateRotations(t.x,t.y,t.z,n);a=e[0],s=e[1]}void 0!==r&&((r=r.map(Tr.degToRad)).push(n),r=(new tn).fromArray(r),r=(new dn).setFromEuler(r)),void 0!==i&&((i=i.map(Tr.degToRad)).push(n),i=(new tn).fromArray(i),i=(new dn).setFromEuler(i).invert());let o=new dn,l=new tn,h=[];if(!s||!a)return new eo(e+".quaternion",[],[]);for(let e=0;e<s.length;e+=3)l.set(s[e],s[e+1],s[e+2],n),o.setFromEuler(l),void 0!==r&&o.premultiply(r),void 0!==i&&o.multiply(i),e>2&&(new dn).fromArray(h,(e-3)/3*4).dot(o)<0&&o.set(-o.x,-o.y,-o.z,-o.w),o.toArray(h,e/3*4);return new eo(e+".quaternion",a,h)}generateMorphTrack(e){let t=e.DeformPercent.curves.morph,r=t.values.map((function(e){return e/100})),i=Ro.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new dc(e.modelName+".morphTargetInfluences["+i+"]",t.times,r)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,r=t[0];for(let i=1;i<t.length;i++){let n=t[i];n!==r&&(t[e]=n,r=n,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,r){let i=r,n=[],a=-1,s=-1,o=-1;return e.forEach((function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(s=t.y.times.indexOf(e)),t.z&&(o=t.z.times.indexOf(e)),-1!==a){let e=t.x.values[a];n.push(e),i[0]=e}else n.push(i[0]);if(-1!==s){let e=t.y.values[s];n.push(e),i[1]=e}else n.push(i[1]);if(-1!==o){let e=t.z.values[o];n.push(e),i[2]=e}else n.push(i[2])})),n}interpolateRotations(e,t,r,i){let n=[],a=[];n.push(e.times[0]),a.push(Tr.degToRad(e.values[0])),a.push(Tr.degToRad(t.values[0])),a.push(Tr.degToRad(r.values[0]));for(let s=1;s<e.values.length;s++){let o=[e.values[s-1],t.values[s-1],r.values[s-1]];if(isNaN(o[0])||isNaN(o[1])||isNaN(o[2]))continue;let l=o.map(Tr.degToRad),h=[e.values[s],t.values[s],r.values[s]];if(isNaN(h[0])||isNaN(h[1])||isNaN(h[2]))continue;let c=h.map(Tr.degToRad),u=[h[0]-o[0],h[1]-o[1],h[2]-o[2]],d=[Math.abs(u[0]),Math.abs(u[1]),Math.abs(u[2])];if(d[0]>=180||d[1]>=180||d[2]>=180){let t=Math.max(...d)/180,r=new tn(...l,i),o=new tn(...c,i),h=(new dn).setFromEuler(r),u=(new dn).setFromEuler(o);h.dot(u)&&u.set(-u.x,-u.y,-u.z,-u.w);let p=e.times[s-1],f=e.times[s]-p,m=new dn,g=new tn;for(let e=0;e<1;e+=1/t)m.copy(h.clone().slerp(u.clone(),e)),n.push(p+e*f),g.setFromQuaternion(m,i),a.push(g.x),a.push(g.y),a.push(g.z)}else n.push(e.times[s]),a.push(Tr.degToRad(e.values[s])),a.push(Tr.degToRad(t.values[s])),a.push(Tr.degToRad(r.values[s]))}return[n,a]}},Az=class{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new W3,this.nodeStack=[],this.currentProp=[],this.currentPropName="";let t=this,r=e.split(/[\r\n]+/);return r.forEach((function(e,i){let n=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(n||a)return;let s=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),o=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");s?t.parseNodeBegin(e,s):o?t.parseNodeProperty(e,o,r[++i]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){let r=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),n={name:r},a=this.parseNodeAttr(i),s=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,n):r in s?("PoseNode"===r?s.PoseNode.push(n):void 0!==s[r].id&&(s[r]={},s[r][s[r].id]=s[r]),""!==a.id&&(s[r][a.id]=n)):"number"==typeof a.id?(s[r]={},s[r][a.id]=n):"Properties70"!==r&&(s[r]="PoseNode"===r?[n]:n),"number"==typeof a.id&&(n.id=a.id),""!==a.name&&(n.attrName=a.name),""!==a.type&&(n.attrType=a.type),this.pushStack(n)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let r="",i="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:r,type:i}}parseNodeProperty(e,t,r){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),n=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===n&&(n=r.replace(/"/g,"").replace(/,$/,"").trim());let a=this.getCurrentNode();if("Properties70"!==a.name){if("C"===i){let e=n.split(",").slice(1),t=parseInt(e[0]),r=parseInt(e[1]),s=n.split(",").slice(3);s=s.map((function(e){return e.trim().replace(/^"/,"")})),i="connections",n=[t,r],GSt(n,s),void 0===a[i]&&(a[i]=[])}"Node"===i&&(a.id=n),i in a&&Array.isArray(a[i])?a[i].push(n):"a"!==i?a[i]=n:a.a=n,this.setCurrentProp(a,i),"a"===i&&","!==n.slice(-1)&&(a.a=Tz(n))}else this.parseNodeSpecialProperty(e,i,n)}parseNodePropertyContinued(e){let t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=Tz(t.a))}parseNodeSpecialProperty(e,t,r){let i=r.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),n=i[0],a=i[1],s=i[2],o=i[3],l=i[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Tz(l)}this.getPrevNode()[n]={type:a,type2:s,flag:o,value:l},this.setCurrentProp(this.getPrevNode(),n)}},Rz=class{parse(e){let t=new j3(e);t.skip(23);let r=t.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);let i=new W3;for(;!this.endOfContent(t);){let e=this.parseNode(t,r);null!==e&&i.add(e.name,e)}return i}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){let r={},i=t>=7500?e.getUint64():e.getUint32(),n=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();let a=e.getUint8(),s=e.getString(a);if(0===i)return null;let o=[];for(let t=0;t<n;t++)o.push(this.parseProperty(e));let l=o.length>0?o[0]:"",h=o.length>1?o[1]:"",c=o.length>2?o[2]:"";for(r.singleProperty=1===n&&e.getOffset()===i;i>e.getOffset();){let i=this.parseNode(e,t);null!==i&&this.parseSubNode(s,r,i)}return r.propertyList=o,"number"==typeof l&&(r.id=l),""!==h&&(r.attrName=h),""!==c&&(r.attrType=c),""!==s&&(r.name=s),r}parseSubNode(e,t,r){if(!0===r.singleProperty){let e=r.propertyList[0];Array.isArray(e)?(t[r.name]=r,r.a=e):t[r.name]=e}else if("Connections"===e&&"C"===r.name){let e=[];r.propertyList.forEach((function(t,r){0!==r&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===r.name)Object.keys(r).forEach((function(e){t[e]=r[e]}));else if("Properties70"===e&&"P"===r.name){let e,i=r.propertyList[0],n=r.propertyList[1],a=r.propertyList[2],s=r.propertyList[3];0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),0===n.indexOf("Lcl ")&&(n=n.replace("Lcl ","Lcl_")),e="Color"===n||"ColorRGB"===n||"Vector"===n||"Vector3D"===n||0===n.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[i]={type:n,type2:a,flag:s,value:e}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)}parseProperty(e){let t,r=e.getString(1);switch(r){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return t=e.getUint32(),e.getArrayBuffer(t);case"S":return t=e.getUint32(),e.getString(t);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":let i=e.getUint32(),n=e.getUint32(),a=e.getUint32();if(0===n)switch(r){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}let s=v0(new Uint8Array(e.getArrayBuffer(a))),o=new j3(s.buffer);switch(r){case"b":case"c":return o.getBooleanArray(i);case"d":return o.getFloat64Array(i);case"f":return o.getFloat32Array(i);case"i":return o.getInt32Array(i);case"l":return o.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+r)}}},j3=class{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(e){let t=[];for(let r=0;r<e;r++)t.push(this.getBoolean());return t}getUint8(){let e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){let e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){let e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getInt32());return t}getUint32(){let e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){let e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getFloat32());return t}getFloat64(){let e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getFloat64());return t}getArrayBuffer(e){let t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=this.offset,r=new Uint8Array(this.dv.buffer,t,e);this.skip(e);let i=r.indexOf(0);return i>=0&&(r=new Uint8Array(this.dv.buffer,t,i)),this._textDecoder.decode(r)}},W3=class{add(e,t){this[e]=t}};function USt(e){let t="Kaydara FBX Binary  \0";return e.byteLength>=21&&t===iEe(e,0,21)}function HSt(e){let t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;function i(t){let i=e[t-1];return e=e.slice(r+t),r++,i}for(let e=0;e<t.length;++e)if(i(1)===t[e])return!1;return!0}function tEe(e){let t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function VSt(e){return e/46186158e3}var zSt=[];function G3(e,t,r,i){let n;switch(i.mappingType){case"ByPolygonVertex":n=e;break;case"ByPolygon":n=t;break;case"ByVertice":n=r;break;case"AllSame":n=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}"IndexToDirect"===i.referenceType&&(n=i.indices[n]);let a=n*i.dataSize,s=a+i.dataSize;return qSt(zSt,i.buffer,a,s)}var _z=new tn,J1=new F;function rEe(e){let t=new lt,r=new lt,i=new lt,n=new lt,a=new lt,s=new lt,o=new lt,l=new lt,h=new lt,c=new lt,u=new lt,d=new lt,p=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(J1.fromArray(e.translation)),e.preRotation){let t=e.preRotation.map(Tr.degToRad);t.push(e.eulerOrder||tn.DEFAULT_ORDER),r.makeRotationFromEuler(_z.fromArray(t))}if(e.rotation){let t=e.rotation.map(Tr.degToRad);t.push(e.eulerOrder||tn.DEFAULT_ORDER),i.makeRotationFromEuler(_z.fromArray(t))}if(e.postRotation){let t=e.postRotation.map(Tr.degToRad);t.push(e.eulerOrder||tn.DEFAULT_ORDER),n.makeRotationFromEuler(_z.fromArray(t)),n.invert()}e.scale&&a.scale(J1.fromArray(e.scale)),e.scalingOffset&&o.setPosition(J1.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(J1.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition(J1.fromArray(e.rotationOffset)),e.rotationPivot&&h.setPosition(J1.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(u.copy(e.parentMatrix),c.copy(e.parentMatrixWorld));let f=r.clone().multiply(i).multiply(n),m=new lt;m.extractRotation(c);let g=new lt;g.copyPosition(c);let v=g.clone().invert().multiply(c),y=m.clone().invert().multiply(v),b=a,x=new lt;if(0===p)x.copy(m).multiply(f).multiply(y).multiply(b);else if(1===p)x.copy(m).multiply(y).multiply(f).multiply(b);else{let e=(new lt).scale((new F).setFromMatrixScale(u)).clone().invert(),t=y.clone().multiply(e);x.copy(m).multiply(f).multiply(t).multiply(b)}let _=h.clone().invert(),w=s.clone().invert(),S=t.clone().multiply(l).multiply(h).multiply(r).multiply(i).multiply(n).multiply(_).multiply(o).multiply(s).multiply(a).multiply(w),T=(new lt).copyPosition(S),M=c.clone().multiply(T);return d.copyPosition(M),S=d.clone().multiply(x),S.premultiply(c.invert()),S}function nEe(e){let t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function Tz(e){return e.split(",").map((function(e){return parseFloat(e)}))}function iEe(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),(new TextDecoder).decode(new Uint8Array(e,t,r))}function GSt(e,t){for(let r=0,i=e.length,n=t.length;r<n;r++,i++)e[i]=t[r]}function qSt(e,t,r,i){for(let n=r,a=0;n<i;n++,a++)e[a]=t[n];return e}var zh=class extends Mn{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new kz(e)})),this.register((function(e){return new qz(e)})),this.register((function(e){return new jz(e)})),this.register((function(e){return new Wz(e)})),this.register((function(e){return new Bz(e)})),this.register((function(e){return new Nz(e)})),this.register((function(e){return new Uz(e)})),this.register((function(e){return new Hz(e)})),this.register((function(e){return new Lz(e)})),this.register((function(e){return new Vz(e)})),this.register((function(e){return new Fz(e)})),this.register((function(e){return new Gz(e)})),this.register((function(e){return new zz(e)})),this.register((function(e){return new Oz(e)})),this.register((function(e){return new Xz(e)})),this.register((function(e){return new Yz(e)}))}load(e,t,r,i){let n,a=this;if(""!==this.resourcePath)n=this.resourcePath;else if(""!==this.path){let t=oa.extractUrlBase(e);n=oa.resolveURL(t,this.path)}else n=oa.extractUrlBase(e);this.manager.itemStart(e);let s=function(t){i?i(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},o=new Hn(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(r){try{a.parse(r,n,(function(r){t(r),a.manager.itemEnd(e)}),s)}catch(e){s(e)}}),r,s)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,i){let n,a={},s={},o=new TextDecoder;if("string"==typeof e)n=JSON.parse(e);else if(e instanceof ArrayBuffer)if(o.decode(new Uint8Array(e,0,4))===cEe){try{a[Kn.KHR_BINARY_GLTF]=new $z(e)}catch(e){return void(i&&i(e))}n=JSON.parse(a[Kn.KHR_BINARY_GLTF].content)}else n=JSON.parse(o.decode(e));else n=e;if(void 0===n.asset||n.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));let l=new rG(n,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){let t=this.pluginCallbacks[e](l);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),s[t.name]=t,a[t.name]=!0}if(n.extensionsUsed)for(let e=0;e<n.extensionsUsed.length;++e){let t=n.extensionsUsed[e],r=n.extensionsRequired||[];switch(t){case Kn.KHR_MATERIALS_UNLIT:a[t]=new Dz;break;case Kn.KHR_DRACO_MESH_COMPRESSION:a[t]=new Zz(n,this.dracoLoader);break;case Kn.KHR_TEXTURE_TRANSFORM:a[t]=new Kz;break;case Kn.KHR_MESH_QUANTIZATION:a[t]=new Jz;break;default:r.indexOf(t)>=0&&void 0===s[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(a),l.setPlugins(s),l.parse(r,i)}parseAsync(e,t){let r=this;return new Promise((function(i,n){r.parse(e,t,i,n)}))}};function jSt(){let e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}var Kn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"},Oz=class{constructor(e){this.parser=e,this.name=Kn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let r=0,i=t.length;r<i;r++){let i=t[r];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){let t=this.parser,r="light:"+e,i=t.cache.get(r);if(i)return i;let n,a=t.json,s=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e],o=new dt(16777215);void 0!==s.color&&o.setRGB(s.color[0],s.color[1],s.color[2],Hi);let l=void 0!==s.range?s.range:0;switch(s.type){case"directional":n=new ya(o),n.target.position.set(0,0,-1),n.add(n.target);break;case"point":n=new Cl(o),n.distance=l;break;case"spot":n=new pc(o),n.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,n.angle=s.spot.outerConeAngle,n.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,n.target.position.set(0,0,-1),n.add(n.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return n.position.set(0,0,0),n.decay=2,Kp(n,s),void 0!==s.intensity&&(n.intensity=s.intensity),n.name=t.createUniqueName(s.name||"light_"+e),i=Promise.resolve(n),t.cache.add(r,i),i}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){let t=this,r=this.parser,i=r.json.nodes[e],n=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then((function(e){return r._getNodeRef(t.cache,n,e)}))}},Dz=class{constructor(){this.name=Kn.KHR_MATERIALS_UNLIT}getMaterialType(){return Mr}extendParams(e,t,r){let i=[];e.color=new dt(1,1,1),e.opacity=1;let n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){let t=n.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],Hi),e.opacity=t[3]}void 0!==n.baseColorTexture&&i.push(r.assignTexture(e,"map",n.baseColorTexture,Zr))}return Promise.all(i)}},Lz=class{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}},kz=class{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Qa:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&n.push(r.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&n.push(r.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(n.push(r.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){let e=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Te(e,e)}return Promise.all(n)}},Fz=class{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Qa:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return void 0!==a.iridescenceFactor&&(t.iridescence=a.iridescenceFactor),void 0!==a.iridescenceTexture&&n.push(r.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),void 0!==a.iridescenceIor&&(t.iridescenceIOR=a.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==a.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),void 0!==a.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),void 0!==a.iridescenceThicknessTexture&&n.push(r.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(n)}},Bz=class{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_SHEEN}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Qa:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[];t.sheenColor=new dt(0,0,0),t.sheenRoughness=0,t.sheen=1;let a=i.extensions[this.name];if(void 0!==a.sheenColorFactor){let e=a.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],Hi)}return void 0!==a.sheenRoughnessFactor&&(t.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&n.push(r.assignTexture(t,"sheenColorMap",a.sheenColorTexture,Zr)),void 0!==a.sheenRoughnessTexture&&n.push(r.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(n)}},Nz=class{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Qa:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&n.push(r.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(n)}},Uz=class{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_VOLUME}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Qa:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];t.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&n.push(r.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;let s=a.attenuationColor||[1,1,1];return t.attenuationColor=(new dt).setRGB(s[0],s[1],s[2],Hi),Promise.all(n)}},Hz=class{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_IOR}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Qa:null}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}},Vz=class{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_SPECULAR}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Qa:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];t.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&n.push(r.assignTexture(t,"specularIntensityMap",a.specularTexture));let s=a.specularColorFactor||[1,1,1];return t.specularColor=(new dt).setRGB(s[0],s[1],s[2],Hi),void 0!==a.specularColorTexture&&n.push(r.assignTexture(t,"specularColorMap",a.specularColorTexture,Zr)),Promise.all(n)}},zz=class{constructor(e){this.parser=e,this.name=Kn.EXT_MATERIALS_BUMP}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Qa:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return t.bumpScale=void 0!==a.bumpFactor?a.bumpFactor:1,void 0!==a.bumpTexture&&n.push(r.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(n)}},Gz=class{constructor(e){this.parser=e,this.name=Kn.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Qa:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return void 0!==a.anisotropyStrength&&(t.anisotropy=a.anisotropyStrength),void 0!==a.anisotropyRotation&&(t.anisotropyRotation=a.anisotropyRotation),void 0!==a.anisotropyTexture&&n.push(r.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(n)}},qz=class{constructor(e){this.parser=e,this.name=Kn.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,r=t.json,i=r.textures[e];if(!i.extensions||!i.extensions[this.name])return null;let n=i.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,n.source,a)}},jz=class{constructor(e){this.parser=e,this.name=Kn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,r=this.parser,i=r.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;let a=n.extensions[t],s=i.images[a.source],o=r.textureLoader;if(s.uri){let e=r.options.manager.getHandler(s.uri);null!==e&&(o=e)}return this.detectSupport().then((function(n){if(n)return r.loadTextureImage(e,a.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}},Wz=class{constructor(e){this.parser=e,this.name=Kn.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){let t=this.name,r=this.parser,i=r.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;let a=n.extensions[t],s=i.images[a.source],o=r.textureLoader;if(s.uri){let e=r.options.manager.getHandler(s.uri);null!==e&&(o=e)}return this.detectSupport().then((function(n){if(n)return r.loadTextureImage(e,a.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){let t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}},Xz=class{constructor(e){this.name=Kn.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){let e=r.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then((function(t){let r=e.byteOffset||0,i=e.byteLength||0,a=e.count,s=e.byteStride,o=new Uint8Array(t,r,i);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(a,s,o,e.mode,e.filter).then((function(e){return e.buffer})):n.ready.then((function(){let t=new ArrayBuffer(a*s);return n.decodeGltfBuffer(new Uint8Array(t),a,s,o,e.mode,e.filter),t}))}))}return null}},Yz=class{constructor(e){this.name=Kn.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){let t=this.parser.json,r=t.nodes[e];if(!r.extensions||!r.extensions[this.name]||void 0===r.mesh)return null;let i=t.meshes[r.mesh];for(let e of i.primitives)if(e.mode!==Rc.TRIANGLES&&e.mode!==Rc.TRIANGLE_STRIP&&e.mode!==Rc.TRIANGLE_FAN&&void 0!==e.mode)return null;let n=r.extensions[this.name].attributes,a=[],s={};for(let e in n)a.push(this.parser.getDependency("accessor",n[e]).then((t=>(s[e]=t,s[e]))));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then((e=>{let t=e.pop(),r=t.isGroup?t.children:[t],i=e[0].count,n=[];for(let e of r){let t=new lt,r=new F,a=new dn,o=new F(1,1,1),l=new ls(e.geometry,e.material,i);for(let e=0;e<i;e++)s.TRANSLATION&&r.fromBufferAttribute(s.TRANSLATION,e),s.ROTATION&&a.fromBufferAttribute(s.ROTATION,e),s.SCALE&&o.fromBufferAttribute(s.SCALE,e),l.setMatrixAt(e,t.compose(r,a,o));for(let t in s)if("_COLOR_0"===t){let e=s[t];l.instanceColor=new Ja(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,s[t]);yr.prototype.copy.call(l,e),this.parser.assignFinalMaterial(l),n.push(l)}return t.isGroup?(t.clear(),t.add(...n),t):n[0]})))}},cEe="glTF",NT=12,sEe={JSON:1313821514,BIN:5130562},$z=class{constructor(e){this.name=Kn.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,NT),r=new TextDecoder;if(this.header={magic:r.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==cEe)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");let i=this.header.length-NT,n=new DataView(e,NT),a=0;for(;a<i;){let t=n.getUint32(a,!0);a+=4;let i=n.getUint32(a,!0);if(a+=4,i===sEe.JSON){let i=new Uint8Array(e,NT+a,t);this.content=r.decode(i)}else if(i===sEe.BIN){let r=NT+a;this.body=e.slice(r,r+t)}a+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}},Zz=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Kn.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let r=this.json,i=this.dracoLoader,n=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,s={},o={},l={};for(let e in a){let t=eG[e]||e.toLowerCase();s[t]=a[e]}for(let t in e.attributes){let i=eG[t]||t.toLowerCase();if(void 0!==a[t]){let n=r.accessors[e.attributes[t]],a=Q1[n.componentType];l[i]=a.name,o[i]=!0===n.normalized}}return t.getDependency("bufferView",n).then((function(e){return new Promise((function(t){i.decodeDracoFile(e,(function(e){for(let t in e.attributes){let r=e.attributes[t],i=o[t];void 0!==i&&(r.normalized=i)}t(e)}),s,l)}))}))}},Kz=class{constructor(){this.name=Kn.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}},Jz=class{constructor(){this.name=Kn.KHR_MESH_QUANTIZATION}},X3=class extends Jd{constructor(e,t,r,i){super(e,t,r,i)}copySampleValue_(e){let t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i*3+i;for(let e=0;e!==i;e++)t[e]=r[n+e];return t}interpolate_(e,t,r,i){let n=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=2*s,l=3*s,h=i-t,c=(r-t)/h,u=c*c,d=u*c,p=e*l,f=p-l,m=-2*d+3*u,g=d-u,v=1-m,y=g-u+c;for(let e=0;e!==s;e++){let t=a[f+e+s],r=a[f+e+o]*h,i=a[p+e+s],l=a[p+e]*h;n[e]=v*t+y*r+m*i+g*l}return n}},WSt=new dn,Qz=class extends X3{interpolate_(e,t,r,i){let n=super.interpolate_(e,t,r,i);return WSt.fromArray(n).normalize().toArray(n),n}},Rc={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Q1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},aEe={9728:ni,9729:wn,9984:mh,9985:rf,9986:hu,9987:ia},oEe={33071:pi,33648:fu,10497:ui},Cz={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},eG={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Zp={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},XSt={CUBICSPLINE:void 0,LINEAR:gh,STEP:jd},Pz={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function YSt(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new Ss({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:zi})),e.DefaultMaterial}function y0(e,t,r){for(let i in r.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=r.extensions[i])}function Kp(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function $St(e,t,r){let i=!1,n=!1,a=!1;for(let e=0,r=t.length;e<r;e++){let r=t[e];if(void 0!==r.POSITION&&(i=!0),void 0!==r.NORMAL&&(n=!0),void 0!==r.COLOR_0&&(a=!0),i&&n&&a)break}if(!i&&!n&&!a)return Promise.resolve(e);let s=[],o=[],l=[];for(let h=0,c=t.length;h<c;h++){let c=t[h];if(i){let t=void 0!==c.POSITION?r.getDependency("accessor",c.POSITION):e.attributes.position;s.push(t)}if(n){let t=void 0!==c.NORMAL?r.getDependency("accessor",c.NORMAL):e.attributes.normal;o.push(t)}if(a){let t=void 0!==c.COLOR_0?r.getDependency("accessor",c.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(l)]).then((function(t){let r=t[0],s=t[1],o=t[2];return i&&(e.morphAttributes.position=r),n&&(e.morphAttributes.normal=s),a&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e}))}function ZSt(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let r=0,i=t.weights.length;r<i;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){let r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(let t=0,i=r.length;t<i;t++)e.morphTargetDictionary[r[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function KSt(e){let t,r=e.extensions&&e.extensions[Kn.KHR_DRACO_MESH_COMPRESSION];if(t=r?"draco:"+r.bufferView+":"+r.indices+":"+Iz(r.attributes):e.indices+":"+Iz(e.attributes)+":"+e.mode,void 0!==e.targets)for(let r=0,i=e.targets.length;r<i;r++)t+=":"+Iz(e.targets[r]);return t}function Iz(e){let t="",r=Object.keys(e).sort();for(let i=0,n=r.length;i<n;i++)t+=r[i]+":"+e[r[i]]+";";return t}function tG(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function JSt(e){return e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":"image/png"}var QSt=new lt,rG=class{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new jSt,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,i=!1,n=-1;"undefined"!=typeof navigator&&(r=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),i=navigator.userAgent.indexOf("Firefox")>-1,n=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||r||i&&n<98?this.textureLoader=new Ds(this.options.manager):this.textureLoader=new H_(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Hn(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let r=this,i=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])})).then((function(t){let a={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:r,userData:{}};return y0(n,a,i),Kp(a,i),Promise.all(r._invokeAll((function(e){return e.afterRoot&&e.afterRoot(a)}))).then((function(){e(a)}))})).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let r=0,i=t.length;r<i;r++){let i=t[r].joints;for(let t=0,r=i.length;t<r;t++)e[i[t]].isBone=!0}for(let t=0,i=e.length;t<i;t++){let i=e[t];void 0!==i.mesh&&(this._addNodeRef(this.meshCache,i.mesh),void 0!==i.skin&&(r[i.mesh].isSkinnedMesh=!0)),void 0!==i.camera&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;let i=r.clone(),n=(e,t)=>{let r=this.associations.get(e);null!=r&&this.associations.set(t,r);for(let[r,i]of e.children.entries())n(i,t.children[r])};return n(r,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){let i=e(t[r]);if(i)return i}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let r=[];for(let i=0;i<t.length;i++){let n=e(t[i]);n&&r.push(n)}return r}getDependency(e,t){let r=e+":"+t,i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":i=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":i=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne((function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)})),!i)throw new Error("Unknown type: "+e)}this.cache.add(r,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){let r=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map((function(t,i){return r.getDependency(e,i)}))),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Kn.KHR_BINARY_GLTF].body);let i=this.options;return new Promise((function(e,n){r.load(oa.resolveURL(t.uri,i.path),e,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){let r=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+r)}))}loadAccessor(e){let t=this,r=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){let e=Cz[i.type],t=Q1[i.componentType],r=!0===i.normalized,n=new t(i.count*e);return Promise.resolve(new fr(n,e,r))}let n=[];return void 0!==i.bufferView?n.push(this.getDependency("bufferView",i.bufferView)):n.push(null),void 0!==i.sparse&&(n.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(n).then((function(e){let n,a,s=e[0],o=Cz[i.type],l=Q1[i.componentType],h=l.BYTES_PER_ELEMENT,c=h*o,u=i.byteOffset||0,d=void 0!==i.bufferView?r.bufferViews[i.bufferView].byteStride:void 0,p=!0===i.normalized;if(d&&d!==c){let e=Math.floor(u/d),r="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count,c=t.cache.get(r);c||(n=new l(s,e*d,i.count*d/h),c=new $d(n,d/h),t.cache.add(r,c)),a=new Xo(c,o,u%d/h,p)}else n=null===s?new l(i.count*o):new l(s,u,i.count*o),a=new fr(n,o,p);if(void 0!==i.sparse){let t=Cz.SCALAR,r=Q1[i.sparse.indices.componentType],n=i.sparse.indices.byteOffset||0,h=i.sparse.values.byteOffset||0,c=new r(e[1],n,i.sparse.count*t),u=new l(e[2],h,i.sparse.count*o);null!==s&&(a=new fr(a.array.slice(),a.itemSize,a.normalized));for(let e=0,t=c.length;e<t;e++){let t=c[e];if(a.setX(t,u[e*o]),o>=2&&a.setY(t,u[e*o+1]),o>=3&&a.setZ(t,u[e*o+2]),o>=4&&a.setW(t,u[e*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a}))}loadTexture(e){let t=this.json,r=this.options,i=t.textures[e].source,n=t.images[i],a=this.textureLoader;if(n.uri){let e=r.manager.getHandler(n.uri);null!==e&&(a=e)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,r){let i=this,n=this.json,a=n.textures[e],s=n.images[t],o=(s.uri||s.bufferView)+":"+a.sampler;if(this.textureCache[o])return this.textureCache[o];let l=this.loadImageSource(t,r).then((function(t){t.flipY=!1,t.name=a.name||s.name||"",""===t.name&&"string"==typeof s.uri&&!1===s.uri.startsWith("data:image/")&&(t.name=s.uri);let r=(n.samplers||{})[a.sampler]||{};return t.magFilter=aEe[r.magFilter]||wn,t.minFilter=aEe[r.minFilter]||ia,t.wrapS=oEe[r.wrapS]||ui,t.wrapT=oEe[r.wrapT]||ui,i.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[o]=l,l}loadImageSource(e,t){let r=this.json,i=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));let n=r.images[e],a=self.URL||self.webkitURL,s=n.uri||"",o=!1;if(void 0!==n.bufferView)s=this.getDependency("bufferView",n.bufferView).then((function(e){o=!0;let t=new Blob([e],{type:n.mimeType});return s=a.createObjectURL(t),s}));else if(void 0===n.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let l=Promise.resolve(s).then((function(e){return new Promise((function(r,n){let a=r;!0===t.isImageBitmapLoader&&(a=function(e){let t=new bi(e);t.needsUpdate=!0,r(t)}),t.load(oa.resolveURL(e,i.path),a,void 0,n)}))})).then((function(e){return!0===o&&a.revokeObjectURL(s),e.userData.mimeType=n.mimeType||JSt(n.uri),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",s),e}));return this.sourceCache[e]=l,l}assignTexture(e,t,r,i){let n=this;return this.getDependency("texture",r.index).then((function(a){if(!a)return null;if(void 0!==r.texCoord&&r.texCoord>0&&((a=a.clone()).channel=r.texCoord),n.extensions[Kn.KHR_TEXTURE_TRANSFORM]){let e=void 0!==r.extensions?r.extensions[Kn.KHR_TEXTURE_TRANSFORM]:void 0;if(e){let t=n.associations.get(a);a=n.extensions[Kn.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),n.associations.set(a,t)}}return void 0!==i&&(a.colorSpace=i),e[t]=a,a}))}assignFinalMaterial(e){let t=e.geometry,r=e.material,i=void 0===t.attributes.tangent,n=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){let e="PointsMaterial:"+r.uuid,t=this.cache.get(e);t||(t=new Ai,qn.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,t.sizeAttenuation=!1,this.cache.add(e,t)),r=t}else if(e.isLine){let e="LineBasicMaterial:"+r.uuid,t=this.cache.get(e);t||(t=new Yr,qn.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,this.cache.add(e,t)),r=t}if(i||n||a){let e="ClonedMaterial:"+r.uuid+":";i&&(e+="derivative-tangents:"),n&&(e+="vertex-colors:"),a&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=r.clone(),n&&(t.vertexColors=!0),a&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}e.material=r}getMaterialType(){return Ss}loadMaterial(e){let t,r=this,i=this.json,n=this.extensions,a=i.materials[e],s={},o=[];if((a.extensions||{})[Kn.KHR_MATERIALS_UNLIT]){let e=n[Kn.KHR_MATERIALS_UNLIT];t=e.getMaterialType(),o.push(e.extendParams(s,a,r))}else{let i=a.pbrMetallicRoughness||{};if(s.color=new dt(1,1,1),s.opacity=1,Array.isArray(i.baseColorFactor)){let e=i.baseColorFactor;s.color.setRGB(e[0],e[1],e[2],Hi),s.opacity=e[3]}void 0!==i.baseColorTexture&&o.push(r.assignTexture(s,"map",i.baseColorTexture,Zr)),s.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,s.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(o.push(r.assignTexture(s,"metalnessMap",i.metallicRoughnessTexture)),o.push(r.assignTexture(s,"roughnessMap",i.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),o.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,s)}))))}!0===a.doubleSided&&(s.side=ln);let l=a.alphaMode||Pz.OPAQUE;if(l===Pz.BLEND?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,l===Pz.MASK&&(s.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&t!==Mr&&(o.push(r.assignTexture(s,"normalMap",a.normalTexture)),s.normalScale=new Te(1,1),void 0!==a.normalTexture.scale)){let e=a.normalTexture.scale;s.normalScale.set(e,e)}if(void 0!==a.occlusionTexture&&t!==Mr&&(o.push(r.assignTexture(s,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(s.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&t!==Mr){let e=a.emissiveFactor;s.emissive=(new dt).setRGB(e[0],e[1],e[2],Hi)}return void 0!==a.emissiveTexture&&t!==Mr&&o.push(r.assignTexture(s,"emissiveMap",a.emissiveTexture,Zr)),Promise.all(o).then((function(){let i=new t(s);return a.name&&(i.name=a.name),Kp(i,a),r.associations.set(i,{materials:e}),a.extensions&&y0(n,i,a),i}))}createUniqueName(e){let t=hn.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){let t=this,r=this.extensions,i=this.primitiveCache;function n(e){return r[Kn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(r){return lEe(r,e,t)}))}let a=[];for(let r=0,s=e.length;r<s;r++){let s=e[r],o=KSt(s),l=i[o];if(l)a.push(l.promise);else{let e;e=s.extensions&&s.extensions[Kn.KHR_DRACO_MESH_COMPRESSION]?n(s):lEe(new Nt,s,t),i[o]={primitive:s,promise:e},a.push(e)}}return Promise.all(a)}loadMesh(e){let t=this,r=this.json,i=this.extensions,n=r.meshes[e],a=n.primitives,s=[];for(let e=0,t=a.length;e<t;e++){let t=void 0===a[e].material?YSt(this.cache):this.getDependency("material",a[e].material);s.push(t)}return s.push(t.loadGeometries(a)),Promise.all(s).then((function(r){let s=r.slice(0,r.length-1),o=r[r.length-1],l=[];for(let r=0,h=o.length;r<h;r++){let h,c=o[r],u=a[r],d=s[r];if(u.mode===Rc.TRIANGLES||u.mode===Rc.TRIANGLE_STRIP||u.mode===Rc.TRIANGLE_FAN||void 0===u.mode)h=!0===n.isSkinnedMesh?new yh(c,d):new Ht(c,d),!0===h.isSkinnedMesh&&h.normalizeSkinWeights(),u.mode===Rc.TRIANGLE_STRIP?h.geometry=QV(h.geometry,j_):u.mode===Rc.TRIANGLE_FAN&&(h.geometry=QV(h.geometry,h1));else if(u.mode===Rc.LINES)h=new Wn(c,d);else if(u.mode===Rc.LINE_STRIP)h=new jn(c,d);else if(u.mode===Rc.LINE_LOOP)h=new jy(c,d);else{if(u.mode!==Rc.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);h=new Di(c,d)}Object.keys(h.geometry.morphAttributes).length>0&&ZSt(h,n),h.name=t.createUniqueName(n.name||"mesh_"+e),Kp(h,n),u.extensions&&y0(i,h,u),t.assignFinalMaterial(h),l.push(h)}for(let r=0,i=l.length;r<i;r++)t.associations.set(l[r],{meshes:e,primitives:r});if(1===l.length)return n.extensions&&y0(i,l[0],n),l[0];let h=new Xr;n.extensions&&y0(i,h,n),t.associations.set(h,{meshes:e});for(let e=0,t=l.length;e<t;e++)h.add(l[e]);return h}))}loadCamera(e){let t,r=this.json.cameras[e],i=r[r.type];if(i)return"perspective"===r.type?t=new ci(Tr.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===r.type&&(t=new Gi(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),Kp(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){let t=this.json.skins[e],r=[];for(let e=0,i=t.joints.length;e<i;e++)r.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?r.push(this.getDependency("accessor",t.inverseBindMatrices)):r.push(null),Promise.all(r).then((function(e){let r=e.pop(),i=e,n=[],a=[];for(let e=0,s=i.length;e<s;e++){let s=i[e];if(s){n.push(s);let t=new lt;null!==r&&t.fromArray(r.array,16*e),a.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}return new uc(n,a)}))}loadAnimation(e){let t=this.json,r=this,i=t.animations[e],n=i.name?i.name:"animation_"+e,a=[],s=[],o=[],l=[],h=[];for(let e=0,t=i.channels.length;e<t;e++){let t=i.channels[e],r=i.samplers[t.sampler],n=t.target,c=n.node,u=void 0!==i.parameters?i.parameters[r.input]:r.input,d=void 0!==i.parameters?i.parameters[r.output]:r.output;void 0!==n.node&&(a.push(this.getDependency("node",c)),s.push(this.getDependency("accessor",u)),o.push(this.getDependency("accessor",d)),l.push(r),h.push(n))}return Promise.all([Promise.all(a),Promise.all(s),Promise.all(o),Promise.all(l),Promise.all(h)]).then((function(e){let t=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=[];for(let e=0,n=t.length;e<n;e++){let n=t[e],h=i[e],c=a[e],u=s[e],d=o[e];if(void 0===n)continue;n.updateMatrix&&n.updateMatrix();let p=r._createAnimationTracks(n,h,c,u,d);if(p)for(let e=0;e<p.length;e++)l.push(p[e])}return new Yo(n,void 0,l)}))}createNodeMesh(e){let t=this.json,r=this,i=t.nodes[e];return void 0===i.mesh?null:r.getDependency("mesh",i.mesh).then((function(e){let t=r._getNodeRef(r.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,r=i.weights.length;t<r;t++)e.morphTargetInfluences[t]=i.weights[t]})),t}))}loadNode(e){let t=this,r=this.json.nodes[e],i=t._loadNodeShallow(e),n=[],a=r.children||[];for(let e=0,r=a.length;e<r;e++)n.push(t.getDependency("node",a[e]));let s=void 0===r.skin?Promise.resolve(null):t.getDependency("skin",r.skin);return Promise.all([i,Promise.all(n),s]).then((function(e){let t=e[0],r=e[1],i=e[2];null!==i&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(i,QSt)}));for(let e=0,i=r.length;e<i;e++)t.add(r[e]);return t}))}_loadNodeShallow(e){let t=this.json,r=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];let n=t.nodes[e],a=n.name?i.createUniqueName(n.name):"",s=[],o=i._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return o&&s.push(o),void 0!==n.camera&&s.push(i.getDependency("camera",n.camera).then((function(e){return i._getNodeRef(i.cameraCache,n.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){s.push(e)})),this.nodeCache[e]=Promise.all(s).then((function(t){let s;if(s=!0===n.isBone?new cc:t.length>1?new Xr:1===t.length?t[0]:new yr,s!==t[0])for(let e=0,r=t.length;e<r;e++)s.add(t[e]);if(n.name&&(s.userData.name=n.name,s.name=a),Kp(s,n),n.extensions&&y0(r,s,n),void 0!==n.matrix){let e=new lt;e.fromArray(n.matrix),s.applyMatrix4(e)}else void 0!==n.translation&&s.position.fromArray(n.translation),void 0!==n.rotation&&s.quaternion.fromArray(n.rotation),void 0!==n.scale&&s.scale.fromArray(n.scale);return i.associations.has(s)||i.associations.set(s,{}),i.associations.get(s).nodes=e,s})),this.nodeCache[e]}loadScene(e){let t=this.extensions,r=this.json.scenes[e],i=this,n=new Xr;r.name&&(n.name=i.createUniqueName(r.name)),Kp(n,r),r.extensions&&y0(t,n,r);let a=r.nodes||[],s=[];for(let e=0,t=a.length;e<t;e++)s.push(i.getDependency("node",a[e]));return Promise.all(s).then((function(e){for(let t=0,r=e.length;t<r;t++)n.add(e[t]);return i.associations=(e=>{let t=new Map;for(let[e,r]of i.associations)(e instanceof qn||e instanceof bi)&&t.set(e,r);return e.traverse((e=>{let r=i.associations.get(e);null!=r&&t.set(e,r)})),t})(n),n}))}_createAnimationTracks(e,t,r,i,n){let a,s=[],o=e.name?e.name:e.uuid,l=[];switch(Zp[n.path]===Zp.weights?e.traverse((function(e){e.morphTargetInfluences&&l.push(e.name?e.name:e.uuid)})):l.push(o),Zp[n.path]){case Zp.weights:a=dc;break;case Zp.rotation:a=eo;break;case Zp.position:case Zp.scale:a=wo;break;default:if(1===r.itemSize)a=dc;else a=wo}let h=void 0!==i.interpolation?XSt[i.interpolation]:gh,c=this._getArrayFromAccessor(r);for(let e=0,r=l.length;e<r;e++){let r=new a(l[e]+"."+Zp[n.path],t.array,c,h);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(r),s.push(r)}return s}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){let e=tG(t.constructor),r=new Float32Array(t.length);for(let i=0,n=t.length;i<n;i++)r[i]=t[i]*e;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof eo?Qz:X3)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}};function eMt(e,t,r){let i=t.attributes,n=new Vt;if(void 0===i.POSITION)return;{let e=r.json.accessors[i.POSITION],t=e.min,a=e.max;if(void 0===t||void 0===a)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(n.set(new F(t[0],t[1],t[2]),new F(a[0],a[1],a[2])),e.normalized){let t=tG(Q1[e.componentType]);n.min.multiplyScalar(t),n.max.multiplyScalar(t)}}let a=t.targets;if(void 0!==a){let e=new F,t=new F;for(let i=0,n=a.length;i<n;i++){let n=a[i];if(void 0!==n.POSITION){let i=r.json.accessors[n.POSITION],a=i.min,s=i.max;if(void 0!==a&&void 0!==s){if(t.setX(Math.max(Math.abs(a[0]),Math.abs(s[0]))),t.setY(Math.max(Math.abs(a[1]),Math.abs(s[1]))),t.setZ(Math.max(Math.abs(a[2]),Math.abs(s[2]))),i.normalized){let e=tG(Q1[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(e)}e.boundingBox=n;let s=new Sn;n.getCenter(s.center),s.radius=n.min.distanceTo(n.max)/2,e.boundingSphere=s}function lEe(e,t,r){let i=t.attributes,n=[];function a(t,i){return r.getDependency("accessor",t).then((function(t){e.setAttribute(i,t)}))}for(let t in i){let r=eG[t]||t.toLowerCase();r in e.attributes||n.push(a(i[t],r))}if(void 0!==t.indices&&!e.index){let i=r.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));n.push(i)}return vi.workingColorSpace!==Hi&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${vi.workingColorSpace}" not supported.`),Kp(e,t),eMt(e,t,r),Promise.all(n).then((function(){return void 0!==t.targets?$St(e,t.targets,r):e}))}var Y3=class extends Mn{constructor(e){super(e)}load(e,t,r,i){let n=this,a=""===this.path?oa.extractUrlBase(e):this.path,s=new Hn(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(r){try{t(n.parse(r,a))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}}),r,i)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){let r=e.split("\n"),i={},n=/\s+/,a={};for(let e=0;e<r.length;e++){let t=r[e];if(t=t.trim(),0===t.length||"#"===t.charAt(0))continue;let s=t.indexOf(" "),o=s>=0?t.substring(0,s):t;o=o.toLowerCase();let l=s>=0?t.substring(s+1):"";if(l=l.trim(),"newmtl"===o)i={name:l},a[l]=i;else if("ka"===o||"kd"===o||"ks"===o||"ke"===o){let e=l.split(n,3);i[o]=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]}else i[o]=l}let s=new nG(this.resourcePath||t,this.materialOptions);return s.setCrossOrigin(this.crossOrigin),s.setManager(this.manager),s.setMaterials(a),s}},nG=class{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=void 0!==this.options.side?this.options.side:zi,this.wrap=void 0!==this.options.wrap?this.options.wrap:ui}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;let t={};for(let r in e){let i=e[r],n={};t[r]=n;for(let e in i){let t=!0,r=i[e],a=e.toLowerCase();switch(a){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(r=[r[0]/255,r[1]/255,r[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===r[0]&&0===r[1]&&0===r[2]&&(t=!1)}t&&(n[a]=r)}}return t}preload(){for(let e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(let t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){let t=this,r=this.materialsInfo[e],i={name:e,side:this.side};function n(e,r){if(i[e])return;let n=t.getTextureParams(r,i),a=t.loadTexture(function(e,t){return"string"!=typeof t||""===t?"":/^https?:\/\//i.test(t)?t:e+t}(t.baseUrl,n.url));a.repeat.copy(n.scale),a.offset.copy(n.offset),a.wrapS=t.wrap,a.wrapT=t.wrap,("map"===e||"emissiveMap"===e)&&(a.colorSpace=Zr),i[e]=a}for(let e in r){let t,a=r[e];if(""!==a)switch(e.toLowerCase()){case"kd":i.color=(new dt).fromArray(a).convertSRGBToLinear();break;case"ks":i.specular=(new dt).fromArray(a).convertSRGBToLinear();break;case"ke":i.emissive=(new dt).fromArray(a).convertSRGBToLinear();break;case"map_kd":n("map",a);break;case"map_ks":n("specularMap",a);break;case"map_ke":n("emissiveMap",a);break;case"norm":n("normalMap",a);break;case"map_bump":case"bump":n("bumpMap",a);break;case"map_d":n("alphaMap",a),i.transparent=!0;break;case"ns":i.shininess=parseFloat(a);break;case"d":t=parseFloat(a),t<1&&(i.opacity=t,i.transparent=!0);break;case"tr":t=parseFloat(a),this.options&&this.options.invertTrProperty&&(t=1-t),t>0&&(i.opacity=1-t,i.transparent=!0)}}return this.materials[e]=new Da(i),this.materials[e]}getTextureParams(e,t){let r,i={scale:new Te(1,1),offset:new Te(0,0)},n=e.split(/\s+/);return r=n.indexOf("-bm"),r>=0&&(t.bumpScale=parseFloat(n[r+1]),n.splice(r,2)),r=n.indexOf("-s"),r>=0&&(i.scale.set(parseFloat(n[r+1]),parseFloat(n[r+2])),n.splice(r,4)),r=n.indexOf("-o"),r>=0&&(i.offset.set(parseFloat(n[r+1]),parseFloat(n[r+2])),n.splice(r,4)),i.url=n.join(" ").trim(),i}loadTexture(e,t,r,i,n){let a=void 0!==this.manager?this.manager:Zo,s=a.getHandler(e);null===s&&(s=new Ds(a)),s.setCrossOrigin&&s.setCrossOrigin(this.crossOrigin);let o=s.load(e,r,i,n);return void 0!==t&&(o.mapping=t),o}},tMt=/^[og]\s*(.+)?/,rMt=/^mtllib /,nMt=/^usemtl /,iMt=/^usemap /,uEe=/\s+/,hEe=new F,iG=new F,dEe=new F,fEe=new F,Cc=new F,$3=new dt;function sMt(){let e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);let r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){let r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);let i={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){let t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){let t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(let e=this.materials.length-1;e>=0;e--)this.materials[e].groupCount<=0&&this.materials.splice(e,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){let e=r.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){let r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){let r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){let r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){let i=this.vertices,n=this.object.geometry.vertices;n.push(i[e+0],i[e+1],i[e+2]),n.push(i[t+0],i[t+1],i[t+2]),n.push(i[r+0],i[r+1],i[r+2])},addVertexPoint:function(e){let t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){let t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){let i=this.normals,n=this.object.geometry.normals;n.push(i[e+0],i[e+1],i[e+2]),n.push(i[t+0],i[t+1],i[t+2]),n.push(i[r+0],i[r+1],i[r+2])},addFaceNormal:function(e,t,r){let i=this.vertices,n=this.object.geometry.normals;hEe.fromArray(i,e),iG.fromArray(i,t),dEe.fromArray(i,r),Cc.subVectors(dEe,iG),fEe.subVectors(hEe,iG),Cc.cross(fEe),Cc.normalize(),n.push(Cc.x,Cc.y,Cc.z),n.push(Cc.x,Cc.y,Cc.z),n.push(Cc.x,Cc.y,Cc.z)},addColor:function(e,t,r){let i=this.colors,n=this.object.geometry.colors;void 0!==i[e]&&n.push(i[e+0],i[e+1],i[e+2]),void 0!==i[t]&&n.push(i[t+0],i[t+1],i[t+2]),void 0!==i[r]&&n.push(i[r+0],i[r+1],i[r+2])},addUV:function(e,t,r){let i=this.uvs,n=this.object.geometry.uvs;n.push(i[e+0],i[e+1]),n.push(i[t+0],i[t+1]),n.push(i[r+0],i[r+1])},addDefaultUV:function(){let e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){let t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,i,n,a,s,o,l){let h=this.vertices.length,c=this.parseVertexIndex(e,h),u=this.parseVertexIndex(t,h),d=this.parseVertexIndex(r,h);if(this.addVertex(c,u,d),this.addColor(c,u,d),void 0!==s&&""!==s){let e=this.normals.length;c=this.parseNormalIndex(s,e),u=this.parseNormalIndex(o,e),d=this.parseNormalIndex(l,e),this.addNormal(c,u,d)}else this.addFaceNormal(c,u,d);if(void 0!==i&&""!==i){let e=this.uvs.length;c=this.parseUVIndex(i,e),u=this.parseUVIndex(n,e),d=this.parseUVIndex(a,e),this.addUV(c,u,d),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";let t=this.vertices.length;for(let r=0,i=e.length;r<i;r++){let i=this.parseVertexIndex(e[r],t);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";let r=this.vertices.length,i=this.uvs.length;for(let t=0,i=e.length;t<i;t++)this.addVertexLine(this.parseVertexIndex(e[t],r));for(let e=0,r=t.length;e<r;e++)this.addUVLine(this.parseUVIndex(t[e],i))}};return e.startObject("",!1),e}var Z3=class extends Mn{constructor(e){super(e),this.materials=null}load(e,t,r,i){let n=this,a=new Hn(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(r){try{t(n.parse(r))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}}),r,i)}setMaterials(e){return this.materials=e,this}parse(e){let t=new sMt;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));let r=e.split("\n"),i=[];for(let e=0,n=r.length;e<n;e++){let n=r[e].trimStart();if(0===n.length)continue;let a=n.charAt(0);if("#"!==a)if("v"===a){let e=n.split(uEe);switch(e[0]){case"v":t.vertices.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),e.length>=7?($3.setRGB(parseFloat(e[4]),parseFloat(e[5]),parseFloat(e[6])).convertSRGBToLinear(),t.colors.push($3.r,$3.g,$3.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vt":t.uvs.push(parseFloat(e[1]),parseFloat(e[2]))}}else if("f"===a){let e=n.slice(1).trim().split(uEe),r=[];for(let t=0,i=e.length;t<i;t++){let i=e[t];if(i.length>0){let e=i.split("/");r.push(e)}}let i=r[0];for(let e=1,n=r.length-1;e<n;e++){let n=r[e],a=r[e+1];t.addFace(i[0],n[0],a[0],i[1],n[1],a[1],i[2],n[2],a[2])}}else if("l"===a){let e=n.substring(1).trim().split(" "),r=[],i=[];if(-1===n.indexOf("/"))r=e;else for(let t=0,n=e.length;t<n;t++){let n=e[t].split("/");""!==n[0]&&r.push(n[0]),""!==n[1]&&i.push(n[1])}t.addLineGeometry(r,i)}else if("p"===a){let e=n.slice(1).trim().split(" ");t.addPointGeometry(e)}else if(null!==(i=tMt.exec(n))){let e=(" "+i[0].slice(1).trim()).slice(1);t.startObject(e)}else if(nMt.test(n))t.object.startMaterial(n.substring(7).trim(),t.materialLibraries);else if(rMt.test(n))t.materialLibraries.push(n.substring(7).trim());else if(iMt.test(n))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===a){if(i=n.split(" "),i.length>1){let e=i[1].trim().toLowerCase();t.object.smooth="0"!==e&&"off"!==e}else t.object.smooth=!0;let e=t.object.currentMaterial();e&&(e.smooth=t.object.smooth)}else{if("\0"===n)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+n+'"')}}t.finalize();let n=new Xr;if(n.materialLibraries=[].concat(t.materialLibraries),!0==!(1===t.objects.length&&0===t.objects[0].geometry.vertices.length))for(let e=0,r=t.objects.length;e<r;e++){let r=t.objects[e],i=r.geometry,a=r.materials,s="Line"===i.type,o="Points"===i.type,l=!1;if(0===i.vertices.length)continue;let h=new Nt;h.setAttribute("position",new zt(i.vertices,3)),i.normals.length>0&&h.setAttribute("normal",new zt(i.normals,3)),i.colors.length>0&&(l=!0,h.setAttribute("color",new zt(i.colors,3))),!0===i.hasUVIndices&&h.setAttribute("uv",new zt(i.uvs,2));let c,u=[];for(let e=0,r=a.length;e<r;e++){let r=a[e],i=r.name+"_"+r.smooth+"_"+l,n=t.materials[i];if(null!==this.materials)if(n=this.materials.create(r.name),!s||!n||n instanceof Yr){if(o&&n&&!(n instanceof Ai)){let e=new Ai({size:10,sizeAttenuation:!1});qn.prototype.copy.call(e,n),e.color.copy(n.color),e.map=n.map,n=e}}else{let e=new Yr;qn.prototype.copy.call(e,n),e.color.copy(n.color),n=e}void 0===n&&(n=s?new Yr:o?new Ai({size:1,sizeAttenuation:!1}):new Da,n.name=r.name,n.flatShading=!r.smooth,n.vertexColors=l,t.materials[i]=n),u.push(n)}if(u.length>1){for(let e=0,t=a.length;e<t;e++){let t=a[e];h.addGroup(t.groupStart,t.groupCount,e)}c=s?new Wn(h,u):o?new Di(h,u):new Ht(h,u)}else c=s?new Wn(h,u[0]):o?new Di(h,u[0]):new Ht(h,u[0]);c.name=r.name,n.add(c)}else if(t.vertices.length>0){let e=new Ai({size:1,sizeAttenuation:!1}),r=new Nt;r.setAttribute("position",new zt(t.vertices,3)),t.colors.length>0&&void 0!==t.colors[0]&&(r.setAttribute("color",new zt(t.colors,3)),e.vertexColors=!0);let i=new Di(r,e);n.add(i)}return n}},rl=new dt,K3=class extends Mn{constructor(e){super(e),this.propertyNameMapping={},this.customPropertyMapping={}}load(e,t,r,i){let n=this,a=new Hn(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(r){try{t(n.parse(r))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}}),r,i)}setPropertyNameMapping(e){this.propertyNameMapping=e}setCustomPropertyNameMapping(e){this.customPropertyMapping=e}parse(e){function t(e,t=0){let r="",i=/^ply([\s\S]*)end_header(\r\n|\r|\n)/.exec(e);null!==i&&(r=i[1]);let n,a={comments:[],elements:[],headerLength:t,objInfo:""},s=r.split(/\r\n|\r|\n/);function o(e,t){let r={type:e[0]};return"list"===r.type?(r.name=e[3],r.countType=e[1],r.itemType=e[2]):r.name=e[1],r.name in t&&(r.name=t[r.name]),r}for(let e=0;e<s.length;e++){let t=s[e];if(t=t.trim(),""===t)continue;let r=t.split(/\s+/),i=r.shift();switch(t=r.join(" "),i){case"format":a.format=r[0],a.version=r[1];break;case"comment":a.comments.push(t);break;case"element":void 0!==n&&a.elements.push(n),n={},n.name=r[0],n.count=parseInt(r[1]),n.properties=[];break;case"property":n.properties.push(o(r,d.propertyNameMapping));break;case"obj_info":a.objInfo=t;break;default:console.log("unhandled",i,r)}}return void 0!==n&&a.elements.push(n),a}function r(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function i(e,t){let i={};for(let n=0;n<e.length;n++){if(t.empty())return null;if("list"===e[n].type){let a=[],s=r(t.next(),e[n].countType);for(let i=0;i<s;i++){if(t.empty())return null;a.push(r(t.next(),e[n].itemType))}i[e[n].name]=a}else i[e[n].name]=r(t.next(),e[n].type)}return i}function n(){let e={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[],faceVertexColors:[]};for(let t of Object.keys(d.customPropertyMapping))e[t]=[];return e}function a(e){let t=e.map((e=>e.name));function r(e){for(let r=0,i=e.length;r<i;r++){let i=e[r];if(t.includes(i))return i}return null}return{attrX:r(["x","px","posx"])||"x",attrY:r(["y","py","posy"])||"y",attrZ:r(["z","pz","posz"])||"z",attrNX:r(["nx","normalx"]),attrNY:r(["ny","normaly"]),attrNZ:r(["nz","normalz"]),attrS:r(["s","u","texture_u","tx"]),attrT:r(["t","v","texture_v","ty"]),attrR:r(["red","diffuse_red","r","diffuse_r"]),attrG:r(["green","diffuse_green","g","diffuse_g"]),attrB:r(["blue","diffuse_blue","b","diffuse_b"])}}function s(e,t){let r,s,h=n();r=null!==(s=/end_header\s+(\S[\s\S]*\S|\S)\s*$/.exec(e))?s[1].split(/\s+/):[];let c=new sG(r);e:for(let e=0;e<t.elements.length;e++){let r=t.elements[e],n=a(r.properties);for(let e=0;e<r.count;e++){let e=i(r.properties,c);if(!e)break e;l(h,r.name,e,n)}}return o(h)}function o(e){let t=new Nt;e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new zt(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new zt(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new zt(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new zt(e.colors,3)),(e.faceVertexUvs.length>0||e.faceVertexColors.length>0)&&(t=t.toNonIndexed(),e.faceVertexUvs.length>0&&t.setAttribute("uv",new zt(e.faceVertexUvs,2)),e.faceVertexColors.length>0&&t.setAttribute("color",new zt(e.faceVertexColors,3)));for(let r of Object.keys(d.customPropertyMapping))e[r].length>0&&t.setAttribute(r,new zt(e[r],d.customPropertyMapping[r].length));return t.computeBoundingSphere(),t}function l(e,t,r,i){if("vertex"===t){e.vertices.push(r[i.attrX],r[i.attrY],r[i.attrZ]),null!==i.attrNX&&null!==i.attrNY&&null!==i.attrNZ&&e.normals.push(r[i.attrNX],r[i.attrNY],r[i.attrNZ]),null!==i.attrS&&null!==i.attrT&&e.uvs.push(r[i.attrS],r[i.attrT]),null!==i.attrR&&null!==i.attrG&&null!==i.attrB&&(rl.setRGB(r[i.attrR]/255,r[i.attrG]/255,r[i.attrB]/255).convertSRGBToLinear(),e.colors.push(rl.r,rl.g,rl.b));for(let t of Object.keys(d.customPropertyMapping))for(let i of d.customPropertyMapping[t])e[t].push(r[i])}else if("face"===t){let t=r.vertex_indices||r.vertex_index,n=r.texcoord;3===t.length?(e.indices.push(t[0],t[1],t[2]),n&&6===n.length&&(e.faceVertexUvs.push(n[0],n[1]),e.faceVertexUvs.push(n[2],n[3]),e.faceVertexUvs.push(n[4],n[5]))):4===t.length&&(e.indices.push(t[0],t[1],t[3]),e.indices.push(t[1],t[2],t[3])),null!==i.attrR&&null!==i.attrG&&null!==i.attrB&&(rl.setRGB(r[i.attrR]/255,r[i.attrG]/255,r[i.attrB]/255).convertSRGBToLinear(),e.faceVertexColors.push(rl.r,rl.g,rl.b),e.faceVertexColors.push(rl.r,rl.g,rl.b),e.faceVertexColors.push(rl.r,rl.g,rl.b))}}function h(e,t){let r={},i=0;for(let n=0;n<t.length;n++){let a=t[n],s=a.valueReader;if("list"===a.type){let t=[],n=a.countReader.read(e+i);i+=a.countReader.size;for(let r=0;r<n;r++)t.push(s.read(e+i)),i+=s.size;r[a.name]=t}else r[a.name]=s.read(e+i),i+=s.size}return[r,i]}function c(e,t,r){function i(e,t,r){switch(t){case"int8":case"char":return{read:t=>e.getInt8(t),size:1};case"uint8":case"uchar":return{read:t=>e.getUint8(t),size:1};case"int16":case"short":return{read:t=>e.getInt16(t,r),size:2};case"uint16":case"ushort":return{read:t=>e.getUint16(t,r),size:2};case"int32":case"int":return{read:t=>e.getInt32(t,r),size:4};case"uint32":case"uint":return{read:t=>e.getUint32(t,r),size:4};case"float32":case"float":return{read:t=>e.getFloat32(t,r),size:4};case"float64":case"double":return{read:t=>e.getFloat64(t,r),size:8}}}for(let n=0,a=e.length;n<a;n++){let a=e[n];"list"===a.type?(a.countReader=i(t,a.countType,r),a.valueReader=i(t,a.itemType,r)):a.valueReader=i(t,a.type,r)}}let u,d=this;if(e instanceof ArrayBuffer){let r=new Uint8Array(e),{headerText:i,headerLength:d}=function(e){let t=0,r=!0,i="",n=[],a=(new TextDecoder).decode(e.subarray(0,5)),s=/^ply\r\n/.test(a);do{let a=String.fromCharCode(e[t++]);"\n"!==a&&"\r"!==a?i+=a:("end_header"===i&&(r=!1),""!==i&&(n.push(i),i=""))}while(r&&t<e.length);return!0===s&&t++,{headerText:n.join("\r")+"\r",headerLength:t}}(r),p=t(i,d);if("ascii"===p.format){u=s((new TextDecoder).decode(r),p)}else u=function(e,t){let r,i=n(),s="binary_little_endian"===t.format,u=new DataView(e,t.headerLength),d=0;for(let e=0;e<t.elements.length;e++){let n=t.elements[e],o=n.properties,p=a(o);c(o,u,s);for(let e=0;e<n.count;e++){r=h(d,o),d+=r[1];let e=r[0];l(i,n.name,e,p)}}return o(i)}(e,p)}else u=s(e,t(e));return u}},sG=class{constructor(e){this.arr=e,this.i=0}empty(){return this.i>=this.arr.length}next(){return this.arr[this.i++]}},J3=class extends Mn{constructor(e){super(e)}load(e,t,r,i){let n=this,a=new Hn(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(r){try{t(n.parse(r))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}}),r,i)}parse(e){function t(e,t,r){for(let i=0,n=e.length;i<n;i++)if(e[i]!==t.getUint8(r+i))return!1;return!0}let r=function(e){if("string"==typeof e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}(e);return function(e){let r=new DataView(e);if(84+50*r.getUint32(80,!0)===r.byteLength)return!0;let i=[115,111,108,105,100];for(let e=0;e<5;e++)if(t(i,r,e))return!1;return!0}(r)?function(e){let t,r,i,n,a,s,o,l,h=new DataView(e),c=h.getUint32(80,!0),u=!1;for(let e=0;e<70;e++)1129270351==h.getUint32(e,!1)&&82==h.getUint8(e+4)&&61==h.getUint8(e+5)&&(u=!0,n=new Float32Array(3*c*3),a=h.getUint8(e+6)/255,s=h.getUint8(e+7)/255,o=h.getUint8(e+8)/255,l=h.getUint8(e+9)/255);let d=new Nt,p=new Float32Array(3*c*3),f=new Float32Array(3*c*3),m=new dt;for(let e=0;e<c;e++){let l=84+50*e,c=h.getFloat32(l,!0),d=h.getFloat32(l+4,!0),g=h.getFloat32(l+8,!0);if(u){let e=h.getUint16(l+48,!0);32768&e?(t=a,r=s,i=o):(t=(31&e)/31,r=(e>>5&31)/31,i=(e>>10&31)/31)}for(let a=1;a<=3;a++){let s=l+12*a,o=3*e*3+3*(a-1);p[o]=h.getFloat32(s,!0),p[o+1]=h.getFloat32(s+4,!0),p[o+2]=h.getFloat32(s+8,!0),f[o]=c,f[o+1]=d,f[o+2]=g,u&&(m.set(t,r,i).convertSRGBToLinear(),n[o]=m.r,n[o+1]=m.g,n[o+2]=m.b)}}return d.setAttribute("position",new fr(p,3)),d.setAttribute("normal",new fr(f,3)),u&&(d.setAttribute("color",new fr(n,3)),d.hasColors=!0,d.alpha=l),d}(r):function(e){let t,r=new Nt,i=/solid([\s\S]*?)endsolid/g,n=/facet([\s\S]*?)endfacet/g,a=/solid\s(.+)/,s=0,o=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,l=new RegExp("vertex"+o+o+o,"g"),h=new RegExp("normal"+o+o+o,"g"),c=[],u=[],d=[],p=new F,f=0,m=0,g=0;for(;null!==(t=i.exec(e));){m=g;let e=t[0],i=null!==(t=a.exec(e))?t[1]:"";for(d.push(i);null!==(t=n.exec(e));){let e=0,r=0,i=t[0];for(;null!==(t=h.exec(i));)p.x=parseFloat(t[1]),p.y=parseFloat(t[2]),p.z=parseFloat(t[3]),r++;for(;null!==(t=l.exec(i));)c.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),u.push(p.x,p.y,p.z),e++,g++;1!==r&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+s),3!==e&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+s),s++}let o=m,v=g-m;r.userData.groupNames=d,r.addGroup(o,v,f),f++}return r.setAttribute("position",new zt(c,3)),r.setAttribute("normal",new zt(u,3)),r}("string"!=typeof(i=e)?(new TextDecoder).decode(i):i);var i}},k_e=ra(PEe(),1),FEe="3.7.5",mMt=FEe,gMt="function"==typeof atob,vMt="function"==typeof btoa,rb="function"==typeof Buffer,IEe="function"==typeof TextDecoder?new TextDecoder:void 0,OEe="function"==typeof TextEncoder?new TextEncoder:void 0,yMt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",UT=Array.prototype.slice.call(yMt),nI=(e=>{let t={};return UT.forEach(((e,r)=>t[e]=r)),t})(),bMt=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,ka=String.fromCharCode.bind(String),DEe="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),BEe=e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_")),NEe=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),UEe=e=>{let t,r,i,n,a="",s=e.length%3;for(let s=0;s<e.length;){if((r=e.charCodeAt(s++))>255||(i=e.charCodeAt(s++))>255||(n=e.charCodeAt(s++))>255)throw new TypeError("invalid character found");t=r<<16|i<<8|n,a+=UT[t>>18&63]+UT[t>>12&63]+UT[t>>6&63]+UT[63&t]}return s?a.slice(0,s-3)+"===".substring(s):a},gG=vMt?e=>btoa(e):rb?e=>Buffer.from(e,"binary").toString("base64"):UEe,pG=rb?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let r=0,i=e.length;r<i;r+=4096)t.push(ka.apply(null,e.subarray(r,r+4096)));return gG(t.join(""))},iI=(e,t=!1)=>t?BEe(pG(e)):pG(e),xMt=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?ka(192|t>>>6)+ka(128|63&t):ka(224|t>>>12&15)+ka(128|t>>>6&63)+ka(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return ka(240|t>>>18&7)+ka(128|t>>>12&63)+ka(128|t>>>6&63)+ka(128|63&t)},EMt=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,HEe=e=>e.replace(EMt,xMt),LEe=rb?e=>Buffer.from(e,"utf8").toString("base64"):OEe?e=>pG(OEe.encode(e)):e=>gG(HEe(e)),tb=(e,t=!1)=>t?BEe(LEe(e)):LEe(e),kEe=e=>tb(e,!0),_Mt=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,TMt=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return ka(55296+(t>>>10))+ka(56320+(1023&t));case 3:return ka((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return ka((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},VEe=e=>e.replace(_Mt,TMt),zEe=e=>{if(e=e.replace(/\s+/g,""),!bMt.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,r,i,n="";for(let a=0;a<e.length;)t=nI[e.charAt(a++)]<<18|nI[e.charAt(a++)]<<12|(r=nI[e.charAt(a++)])<<6|(i=nI[e.charAt(a++)]),n+=64===r?ka(t>>16&255):64===i?ka(t>>16&255,t>>8&255):ka(t>>16&255,t>>8&255,255&t);return n},vG=gMt?e=>atob(NEe(e)):rb?e=>Buffer.from(e,"base64").toString("binary"):zEe,GEe=rb?e=>DEe(Buffer.from(e,"base64")):e=>DEe(vG(e).split("").map((e=>e.charCodeAt(0)))),qEe=e=>GEe(jEe(e)),wMt=rb?e=>Buffer.from(e,"base64").toString("utf8"):IEe?e=>IEe.decode(GEe(e)):e=>VEe(vG(e)),jEe=e=>NEe(e.replace(/[-_]/g,(e=>"-"==e?"+":"/"))),mG=e=>wMt(jEe(e)),SMt=e=>{if("string"!=typeof e)return!1;let t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},WEe=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),XEe=function(){let e=(e,t)=>Object.defineProperty(String.prototype,e,WEe(t));e("fromBase64",(function(){return mG(this)})),e("toBase64",(function(e){return tb(this,e)})),e("toBase64URI",(function(){return tb(this,!0)})),e("toBase64URL",(function(){return tb(this,!0)})),e("toUint8Array",(function(){return qEe(this)}))},YEe=function(){let e=(e,t)=>Object.defineProperty(Uint8Array.prototype,e,WEe(t));e("toBase64",(function(e){return iI(this,e)})),e("toBase64URI",(function(){return iI(this,!0)})),e("toBase64URL",(function(){return iI(this,!0)}))},MMt=()=>{XEe(),YEe()},$Ee={version:FEe,VERSION:mMt,atob:vG,atobPolyfill:zEe,btoa:gG,btoaPolyfill:UEe,fromBase64:mG,toBase64:tb,encode:tb,encodeURI:kEe,encodeURL:kEe,utob:HEe,btou:VEe,decode:mG,isValid:SMt,fromUint8Array:iI,toUint8Array:qEe,extendString:XEe,extendUint8Array:YEe,extendBuiltins:MMt},Oc=ra(f_e(),1),nb="BYLAYER",ib="BYBLOCK",p_e=(e=>(e[e.Mesh=-1]="Mesh",e[e.MeshWithPattern=0]="MeshWithPattern",e[e.LineWithWidth=1]="LineWithWidth",e[e.Line=2]="Line",e[e.LineWithPattern=3]="LineWithPattern",e[e.Point=4]="Point",e[e.Text=5]="Text",e))(p_e||{}),b0=["INSERT","DIMENSION"],sI=[0,16711680,16776960,65280,65535,255,16711935,16777215,8421504,12632256,16711680,16744319,13369344,13395558,10027008,10046540,8323072,8339263,4980736,4990502,16727808,16752511,13382400,13401958,10036736,10051404,8331008,8343359,4985600,4992806,16744192,16760703,13395456,13408614,10046464,10056268,8339200,8347455,4990464,4995366,16760576,16768895,13408512,13415014,10056192,10061132,8347392,8351551,4995328,4997670,16776960,16777087,13421568,13421670,10000384,10000460,8355584,8355647,5000192,5000230,12582656,14679935,10079232,11717734,7510016,8755276,6258432,7307071,3755008,4344870,8388352,12582783,6736896,10079334,5019648,7510092,4161280,6258495,2509824,3755046,4194048,10485631,3394560,8375398,2529280,6264908,2064128,5209919,1264640,3099686,65280,8388479,52224,6736998,38912,5019724,32512,4161343,19456,2509862,65343,8388511,52275,6737023,38950,5019743,32543,4161359,19475,2509871,65407,8388543,52326,6737049,38988,5019762,32575,4161375,19494,2509881,65471,8388575,52377,6737074,39026,5019781,32607,4161391,19513,2509890,65535,8388607,52428,6737100,39064,5019800,32639,4161407,19532,2509900,49151,8380415,39372,6730444,29336,5014936,24447,4157311,14668,2507340,32767,8372223,26316,6724044,19608,5010072,16255,4153215,9804,2505036,16383,8364031,13260,6717388,9880,5005208,8063,4149119,4940,2502476,255,8355839,204,6710988,152,5000344,127,4145023,76,2500172,4129023,10452991,3342540,8349388,2490520,6245528,2031743,5193599,1245260,3089996,8323327,12550143,6684876,10053324,4980888,7490712,4128895,6242175,2490444,3745356,12517631,14647295,10027212,11691724,7471256,8735896,6226047,7290751,3735628,4335180,16711935,16744447,13369548,13395660,9961624,9981080,8323199,8339327,4980812,4990540,16711871,16744415,13369497,13395634,9961586,9981061,8323167,8339311,4980793,4990530,16711807,16744383,13369446,13395609,9961548,9981042,8323135,8339295,4980774,4990521,16711743,16744351,13369395,13395583,9961510,9981023,8323103,8339279,4980755,4990511,3355443,5987163,8684676,11382189,14079702,16777215],BMt="OriginalHandle",NMt="OriginalType",UMt="Outlines",m_e=["PROXY","REGION","INSERT","HATCH"];function x0(e){return sI[e]}function Wt(e){let t={},r=e.lastReadGroup,i=r.code;if(t.x=r.value,i+=10,r=e.next(),r.code!=i)throw new Error(`Expected code for point value to be ${i} but got ${r.code}`);return t.y=r.value,i+=10,r=e.next(),r.code!=i||(t.z=r.value,e.next()),t}function g_e(e,t){let r=e.lastReadGroup,i=[];for(let n=0;n<16;n++){if(r.code!==t)throw new Error(`Expected code for matrix value to be ${t} but got ${r.code}`);i.push(r.value),r=e.next()}return i}function Gr(e,t){switch(t.code){case 0:e.type=t.value;break;case 5:e.handle=t.value;break;case 6:e.lineType=t.value.toUpperCase();break;case 8:e.layer=t.value;break;case 48:e.lineTypeScale=t.value,e.lineTypeScale<=0&&(e.lineTypeScale=1);break;case 60:e.visible=0===t.value;break;case 62:e.isTrueColor||(e.colorIndex=t.value,e.colorIndex<0&&de.warn("[DxfParser] a negative value of colorIndex indicates that the layer is turned off"),e.color=x0(Math.abs(t.value)));break;case 67:e.inPaperSpace=0!==t.value;break;case 100:case 1001:break;case 330:e.ownerHandle=t.value;break;case 347:e.materialObjectHandle=t.value;break;case 370:e.lineweight=t.value;break;case 410:e.layoutName=t.value;break;case 420:e.isTrueColor=!0,e.color=t.value;break;case 1e3:if(t.value&&t.value.includes(BMt)){let r=t.value.split(":").map((e=>e.trim()));e.extendedData||(e.extendedData={}),e.extendedData.originalHandle=r[1]}if(e.extendedData&&e.extendedData.outlines)try{e.extendedData.outlines=JSON.parse(t.value||"[]")}catch(t){e.extendedData.outlines=void 0}if(t.value&&t.value.includes(UMt)&&(e.extendedData||(e.extendedData={}),e.extendedData.outlines=[]),t.value&&t.value.includes(NMt)){let r=t.value.split(":").map((e=>e.trim()));e.extendedData||(e.extendedData={}),e.extendedData.originalType=r[1]}break;default:return!1}return!0}function Ic(e,t){switch(t.code){case 0:e.type=t.value;break;case 5:e.handle=t.value;break;case 330:e.ownerHandle=t.value;break;case 1e3:case 1001:break;default:return!1}return!0}var yG=(e=>(e.Added="Added",e.Removed="Removed",e.Modified="Modified",e.NoChange="NoChange",e))(yG||{}),Co=1,aI=class{constructor(e,t,r){if(this.changes={},this.comparedBlocks=new Map,this.isComparingBlock=!1,this.isComparingDimension=!1,this.enableDetailComparision=!0,this.dxf1=e,this.dxf2=t,this.enableDetailComparision=!r||(null==r?void 0:r.enableDetailComparision),!e||!t)throw new Error("Invalid dxf data to compare!")}getLayerFrozen(e,t){var r,i,n;let a=null==(i=null==(r=e.tables)?void 0:r.layer)?void 0:i.layers;return a&&(null==(n=a[t.layer])?void 0:n.frozen)}compare(e){return bt(this,null,(function*(){this.changes={};let t=[],r=new Map;return this.dxf1.entities.forEach((e=>{if(!0!==e.inPaperSpace){let r=!0===this.getLayerFrozen(this.dxf1,e);!aI.ENTITY_TYPES_TO_IGNORE.includes(e.type)&&!r&&t.push(e)}})),this.dxf2.entities.forEach((e=>{if(!0!==e.inPaperSpace){let t=!0===this.getLayerFrozen(this.dxf2,e);!aI.ENTITY_TYPES_TO_IGNORE.includes(e.type)&&!t&&r.set(e.handle,e)}})),yield this.compareEntities(t,r,e),Promise.resolve(this.changes)}))}isDimensionBlock(e){return e.includes("*D")}compareInsertOrDemensionEntities(e,t,r,i){if(!e.block||!t.block)return;let n,a=e.block;if(this.isComparingBlock=!0,this.isDimensionBlock(a)){let r=this.dxf1.blocks[e.block],i=this.dxf2.blocks[t.block],s=Date.now();this.isComparingDimension=!0,n=this.compareBlock(e,t,r,i),this.isComparingDimension=!1,de.debug(`[DxfCompare] compare block: ${a} cost ${(Date.now()-s)/1e3}s`)}else{if(!this.comparedBlocks.has(a)){let r=this.dxf1.blocks[a],i=this.dxf2.blocks[a],n=Date.now(),s=this.compareBlock(e,t,r,i);this.comparedBlocks.set(a,s),de.debug(`[DxfCompare] compare block: ${a} cost ${(Date.now()-n)/1e3}s`)}n=this.comparedBlocks.get(a)}return null==n||n.forEach((t=>{if(t.parentHandles||(t.parentHandles=[]),r&&i)"Added"===t.type?t.parentHandles.push(i):"Removed"===t.type&&t.parentHandles.push(r);else{let r=[...t.parentHandles,e.handle];("Added"===t.type||"Removed"===t.type)&&(this.changes[Co]=Ii(on({id:Co},t),{parentHandles:r})),Co++}})),!r&&!i&&(this.isComparingBlock=!1),n}compareBlock(e,t,r,i){var n,a;let s=[],o=[];null==(n=null==r?void 0:r.entities)||n.forEach((e=>{"ATTDEF"!==e.type&&!this.bIgnoreChildEntitiesOriginalType(e)&&s.push(e)})),null==(a=null==i?void 0:i.entities)||a.forEach((e=>{"ATTDEF"!==e.type&&!this.bIgnoreChildEntitiesOriginalType(e)&&o.push(e)}));let l=[],h=[];for(let r=0;r<s.length;r++){let i=s[r],n=!1;0===o.length&&(n=!0),this.isComparingDimension||(this.isComparingDimension="DIMENSION"===i.type);for(let r=0;r<o.length;r++){let a=o[r];if(this.entitiesEqual(i,a,e,t)){if("INSERT"===i.type&&"INSERT"===a.type||"DIMENSION"===i.type&&"DIMENSION"===a.type){let e=this.compareInsertOrDemensionEntities(i,a,i.handle,a.handle);e&&e.length>0&&l.push(...e),n=!1,o.splice(r--,1);break}n=!1,o.splice(r--,1);break}n=!0}n&&(l.push({type:"Removed",handle:i.handle}),h.push(i.handle))}return o.forEach((e=>{h.includes(e.handle)||l.push({type:"Added",handle:e.handle})})),l}compareEntities(e,t,r){return bt(this,null,(function*(){var i,n;let a=Ut.getUpdateProgressFuncForLoop(e.length,r);for(let r=0;r<e.length;r++){let s=e[r].handle;if(t.has(s)){let a=e[r],o=t.get(s),l={};if(this.entitiesEqual(a,o,void 0,void 0,l)){if(b0.includes(a.type)){if(this.bIgnoreChildEntitiesOriginalType(a)){t.delete(s),de.warn(`[DxfCompare] We cannot compare insert (handle '${a.handle}') yet, ignored!`);continue}this.compareInsertOrDemensionEntities(a,o)}}else{if(null!=(i=a.extendedData)&&i.originalType&&null!=(n=o.extendedData)&&n.originalType&&a.block!==o.block){t.delete(s);continue}this.changes[Co]={id:Co,type:"Modified",handle:s},this.enableDetailComparision&&Object.keys(l).length>0&&(this.changes[Co].detailChanges=l),Co++}t.delete(s)}else this.changes[Co]={id:Co,type:"Removed",handle:s},Co++;yield a(r)}for(let e of t){let t=e[0];this.changes[Co]={id:Co,type:"Added",handle:t},Co++}}))}bIgnoreChildEntitiesOriginalType(e){var t;return m_e.includes(null==(t=e.extendedData)?void 0:t.originalType)}entitiesEqual(e,t,r,i,n){if(!this.baseEntitiesEqual(e,t,r,i,n))return!1;let a=e.type,s=!0;return"CIRCLE"===a||"ARC"===a?s=this.arcsEqual(e,t):"LWPOLYLINE"===a||"LINE"===a?s=this.linesEqual(e,t,n):"POLYLINE"===a?s=this.polylinesEqual(e,t):"TEXT"===a?s=this.textsEqual(e,t):"SOLID"===a?s=this.solidsEqual(e,t):"POINT"===a?s=this.pointEntitiesEqual(e,t):"INSERT"===a?s=this.insertsEqual(e,t):"SPLINE"===a?s=this.splinesEqual(e,t):"MTEXT"===a?s=this.mtextsEqual(e,t):"ELLIPSE"===a?s=this.ellipsesEqual(e,t):"DIMENSION"===a?s=this.dimensionsEqual(e,t):"REGION"===a?s=this.regionsEqual(e,t):"ATTDEF"===a?s=this.attDefsEqual(e,t):"ATTRIB"===a?s=this.attribsEqual(e,t):"HATCH"===a?s=this.hatchesEqual(e,t):"VIEWPORT"===a?s=this.viewportsEqual(e,t):"LEADER"===a?s=this.leadersEqual(e,t):"MULTILEADER"===a?s=this.mleadersEqual(e,t):"OLE2FRAME"===a&&(s=this.ole2framesEqual(e,t)),s}getColor(e,t,r){var i,n,a,s,o,l;if(e.isTrueColor||e.colorIndex>0&&e.colorIndex<256)return e.color;if(0===e.colorIndex)return r?this.getColor(r,t):null==(n=null==(i=t.tables)?void 0:i.layer)?void 0:n.layers[0].color;let h=0;if(256===e.colorIndex){let i=null==(s=null==(a=t.tables)?void 0:a.layer)?void 0:s.layers,n=i&&i[e.layer],c=i&&r&&i[r.layer];h=n&&"0"!==n.name?n.color:c?c.color:n?n.color:null==(l=null==(o=t.tables)?void 0:o.layer)?void 0:l.layers[0].color}return h}getLineType(e,t,r){var i,n;if(r&&"DIMENSION"===r.type)return this.getLineType(r,t);if(e.lineType!==nb&&e.lineType!==ib)return e.lineType;if(e.lineType===ib)return r?this.getLineType(r,t):e.lineType;let a=null==(n=null==(i=t.tables)?void 0:i.layer)?void 0:n.layers;if("0"!==e.layer){let t=a&&a[e.layer];if(t)return t.lineType}else if(r){let e=a&&a[r.layer];if(e)return e.lineType}return"CONTINUOUS"}addModificationItem(e,t,r,i){i&&(i[r]={old:e,new:t})}baseEntitiesEqual(e,t,r,i,n){var a,s;let o=!0,l=this.getColor(e,this.dxf1,r),h=this.getColor(t,this.dxf2,i);if(l!==h){if(o=!1,!this.enableDetailComparision)return o;this.addModificationItem(l,h,"color",n)}let c=this.getLineType(e,this.dxf1,r),u=this.getLineType(t,this.dxf2,i);return c!==u?(o=!1,this.enableDetailComparision?(this.addModificationItem(c,u,"lineType",n),!1):o):!((null==(a=e.extendedData)?void 0:a.originalType)!==(null==(s=t.extendedData)?void 0:s.originalType)||!this.isComparingBlock&&!this.isComparingDimension&&e.handle!==t.handle||!this.isComparingDimension&&e.ownerHandle!==t.ownerHandle||e.type!==t.type)&&o}arcsEqual(e,t){return!!(this.vectorsEqual(e.center,t.center)&&this.numberEqual(e.radius,t.radius)&&this.numberEqual(e.startAngle,t.startAngle)&&this.numberEqual(e.endAngle,t.endAngle))}linesEqual(e,t,r){let i=!0,n=e.constantWidth,a=t.constantWidth;if(n!==a){if(i=!1,!this.enableDetailComparision)return!1;this.addModificationItem(n||0,a||0,"constantWidth",r)}return!(!this.verticesEqual(e.vertices,t.vertices)||e.shape!==t.shape)&&i}polylinesEqual(e,t){return!(!this.vertexEntitiesEqual(e.vertices,t.vertices)||e.shape!==t.shape||e.isPolyfaceMesh!==t.isPolyfaceMesh)}textsEqual(e,t){if(e.halign!==t.halign)return!1;if(3===e.halign||5===e.halign){if(!this.pointsEqual(e.startPoint,t.startPoint))return!1}else if(!this.pointsEqual(e.endPoint,t.endPoint))return!1;return e.text===t.text}solidsEqual(e,t){return!!this.verticesEqual(e.points,t.points)}pointEntitiesEqual(e,t){return!!this.pointsEqual(e.position,t.position)}splinesEqual(e,t){return!(!this.verticesEqual(e.controlPoints,t.controlPoints)||!this.numbersEqual(e.knotValues,t.knotValues)||!this.numberEqual(e.degreeOfSplineCurve,t.degreeOfSplineCurve))}mtextsEqual(e,t){return!(!this.pointsEqual(e.position,t.position)||e.text!==t.text||!this.numberEqual(e.rotation,t.rotation))}ellipsesEqual(e,t){return!!(this.pointsEqual(e.center,t.center)&&this.pointsEqual(e.majorAxisEndPoint,t.majorAxisEndPoint)&&this.numberEqual(e.axisRatio,t.axisRatio)&&this.numberEqual(e.startAngle,t.startAngle)&&this.numberEqual(e.endAngle,t.endAngle))}attDefsEqual(e,t){return!(!this.pointsEqual(e.startPoint,t.startPoint)||!this.pointsEqual(e.endPoint,t.endPoint)||!this.numberEqual(e.xScale,t.xScale)||e.text!==t.text||e.tag!==t.tag||e.prompt!==t.prompt)}attribsEqual(e,t){return this.attDefsEqual(e,t)}hatchesEqual(e,t){let r=e,i=t;return!!(this.numberEqual(r.elevationX,i.elevationX)&&this.numberEqual(r.elevationY,i.elevationY)&&this.numberEqual(r.elevationZ,i.elevationZ)&&this.hatchBoundaryPathArraysEqual(r.boundaryPaths,i.boundaryPaths))}viewportsEqual(e,t){let r=e,i=t;return!!(this.pointsEqual(r.centerPoint,i.centerPoint)&&this.pointsEqual(r.centerPoint_dcs,i.centerPoint_dcs)&&this.pointsEqual(r.viewDirection,i.viewDirection)&&this.numberEqual(r.viewHeight,i.viewHeight)&&r.width_paperSpace===i.width_paperSpace&&r.height_paperSpace===i.height_paperSpace)}leadersEqual(e,t){return!!(this.pointsEqual(e.position,t.position)&&this.verticesEqual(e.vertices,t.vertices)&&e.arrowHeadBlockHandle===t.arrowHeadBlockHandle&&this.numberEqual(e.arrowHeadSize,t.arrowHeadSize)&&this.numberEqual(e.rotation,t.rotation)&&e.block===t.block)}mleadersEqual(e,t){return!(e.arrowHeadId!==t.arrowHeadId||!this.numberEqual(e.arrowHeadSize,t.arrowHeadSize))&&this.mleaderContextEqual(e.contextData,t.contextData)}ole2framesEqual(e,t){return!(e.leftUpX!==t.leftUpX||e.leftUpY!==t.leftUpY||e.leftUpZ!==t.leftUpZ||e.rightDownX!==t.rightDownX||e.rightDownY!==t.rightDownY||e.rightDownZ!==t.rightDownZ)}insertsEqual(e,t){var r,i,n,a;return"INSERT"===(null==(r=e.extendedData)?void 0:r.originalType)&&"INSERT"===(null==(i=t.extendedData)?void 0:i.originalType)?(de.warn(`[DxfCompare] We cannot compare insert (handle '${e.handle}') yet, ignored!`),!0):!!(this.pointsEqual(e.position,t.position)&&this.numberEqual(void 0===e.xScale?1:e.xScale,void 0===t.xScale?1:t.xScale)&&this.numberEqual(void 0===e.yScale?1:e.yScale,void 0===t.yScale?1:t.yScale)&&this.numberEqual(void 0===e.zScale?1:e.zScale,void 0===t.zScale?1:t.zScale)&&e.block===t.block&&(null==(n=e.entities)?void 0:n.length)===(null==(a=t.entities)?void 0:a.length))}dimensionsEqual(e,t){return!!this.pointsEqual(e.anchorPoint,t.anchorPoint)}regionsEqual(e,t){return de.warn("Cannot compare region yet!"),!0}vectorsEqual(e,t){return!e&&!t||!(!e||!t)&&(this.numberEqual(e.x,t.x)&&this.numberEqual(e.y,t.y)&&this.numberEqual(e.z,t.z))}pointsEqual(e,t){return!e&&!t||!(!e||!t)&&(this.numberEqual(e.x,t.x)&&this.numberEqual(e.y,t.y)&&this.numberEqual(e.z,t.z)&&this.numberEqual(e.bulge,t.bulge))}vertexEntityEqual(e,t){return!e&&!t||!(!e||!t)&&!(!this.pointsEqual(e,t)||e.polyfaceMeshVertex!==t.polyfaceMeshVertex||e.threeDPolylineMesh!==t.threeDPolylineMesh)}numbersEqual(e,t){if(!e&&!t)return!0;if(e&&t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!this.numberEqual(e[r],t[r]))return!1;return!0}return!1}numberEqual(e,t){return null==e&&null==t||null!=e&&null!=t&&or.areNumbersEqual(e,t)}vectorArraysEqual(e,t){if(!e&&!t)return!0;if(e&&t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!this.vectorsEqual(e[r],t[r]))return!1;return!0}return!1}verticesEqual(e,t){if(!e&&!t)return!0;if(e&&t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!this.pointsEqual(e[r],t[r]))return!1;return!0}return!1}verticesArrayEqual(e,t){if(!e&&!t)return!0;if(e&&t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!this.verticesEqual(e[r],t[r]))return!1;return!0}return!1}vertexEntitiesEqual(e,t){if(!e&&!t)return!0;if(e&&t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!this.vertexEntityEqual(e[r],t[r]))return!1;return!0}return!1}hatchEdgesEqual(e,t){return!e&&!t||!(!e||!t)&&e.type===t.type}hatchEdgeArraysEqual(e,t){if(!e&&!t)return!0;if(e&&t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!this.hatchEdgesEqual(e[r],t[r]))return!1;return!0}return!1}hatchBoundaryPathsEqual(e,t){return!e&&!t||!(!e||!t)&&(e.pathTypeFlag===t.pathTypeFlag&&this.hatchEdgeArraysEqual(e.edges,t.edges))}hatchBoundaryPathArraysEqual(e,t){if(!e&&!t)return!0;if(e&&t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!this.hatchBoundaryPathsEqual(e[r],t[r]))return!1;return!0}return!1}mleaderLineEqual(e,t){return!e&&!t||!(!e||!t)&&!(!this.verticesArrayEqual(e.vertices,t.vertices)||e.leaderLineIndex!==t.leaderLineIndex)}mleaderLinesEqual(e,t){if(!e&&!t)return!0;if(e&&t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!this.mleaderLineEqual(e[r],t[r]))return!1;return!0}return!1}mleaderLeaderEqual(e,t){return!e&&!t||!(!e||!t)&&!(!this.pointsEqual(e.lastLeaderLinePoint,t.lastLeaderLinePoint)||!this.pointsEqual(e.doglegVector,t.doglegVector)||!this.mleaderLinesEqual(e.leaderLines,t.leaderLines))}mleaderLeadersEqual(e,t){if(!e&&!t)return!0;if(e&&t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!this.mleaderLeaderEqual(e[r],t[r]))return!1;return!0}return!1}mleaderContextEqual(e,t){return!e&&!t||!(!e||!t)&&!(!this.pointsEqual(e.contentBasePosition,t.contentBasePosition)||!this.pointsEqual(e.blockContentPosition,t.blockContentPosition)||!this.mleaderLeadersEqual(e.leaders,t.leaders))}compareHexStrings(e,t){return parseInt(e,16)-parseInt(t,16)}},Ea=aI;Ea.ENTITY_COLOR_ADDED=65280,Ea.ENTITY_COLOR_REMOVED=16711680,Ea.ENTITY_COLOR_NO_CHANGE=10066329,Ea.ENTITY_COLOR_MARKUP=16744231,Ea.ENTITY_TYPES_TO_IGNORE=["ATTRIB","SEQEND"];var bG=new Vt,xG=new lt,Ar=class{constructor(e=0){this.name="",this.type=0,this.matrix=new lt,this.children=[],this.layers=new Ep,this.renderOrder=0,this.userData={},this.type=e}add(e,...t){for(let e=0;e<t.length;e++)this.add(t[e]);return e===this?(console.error("object can't be added as a child of itself.",e),this):(e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),this)}remove(e,...t){for(let e=0;e<t.length;e++)this.remove(t[e]);let r=this.children.indexOf(e);return-1!==r&&(e.parent=void 0,this.children.splice(r,1)),this}removeFromParent(){let e=this.parent;return e&&e.remove(this),this}clear(){this.material=void 0,this.geometry=void 0;for(let e=0;e<this.children.length;e++){this.children[e].parent=void 0}return this.children.length=0,this}traverse(e){e(this);let t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}clone(e=!0){return(new Ar).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.type=e.type,this.matrix.copy(e.matrix),this.layers.mask=e.layers.mask,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),this.material=e.material,this.geometry=e.geometry,!0===t)for(let t=0;t<e.children.length;t++){let r=e.children[t];this.add(r.clone())}return this}convertToThreejsObject(e=!0){let t;switch(this.type){case 0:t=new yr;break;case 1:if(!this.geometry)return;t=new Di(this.geometry,this.material);break;case 2:if(!this.geometry)return;t=new jn(this.geometry,this.material);break;case 3:if(!this.geometry)return;t=new Wn(this.geometry,this.material);break;case 4:if(!this.geometry)return;t=new Ht(this.geometry,this.material)}if(t){if(t.name=this.name,t.matrixAutoUpdate=!1,t.applyMatrix4(this.matrix),t.layers.mask=this.layers.mask,t.renderOrder=this.renderOrder,t.userData=this.userData,!0===e)for(let r=0;r<this.children.length;r++){let i=this.children[r].convertToThreejsObject(e);i&&t.add(i)}return t}}static getBox(e,t,r){if(e.geometry)e.geometry.boundingBox||e.geometry.computeBoundingBox(),xG.copy(e.matrix),r&&xG.premultiply(r),bG.copy(e.geometry.boundingBox),bG.applyMatrix4(xG),t.union(bG);else if(e.children.length>0){e.matrixWorld||(e.matrixWorld=new lt),e.matrixWorld.copy(e.matrix),r&&e.matrixWorld.premultiply(r);let i=e.children;for(let r=0,n=i.length;r<n;r++)this.getBox(i[r],t,e.matrixWorld)}return t}},oI=new lt,VMt=new lt,Ou=class{static resetMergeInfo(){this.MergeInfo.removedObjects=0,this.MergeInfo.mergedMeshes=0,this.MergeInfo.mergedLines=0,this.MergeInfo.mergedPoints=0,this.MergeInfo.mergedUnknownTypeObjects=0,this.MergeInfo.elapsedTime=0}static merge(e,t=!0){let r=Date.now();this.mergeInner(e,t),this.MergeInfo.elapsedTime+=Date.now()-r}static mergeInner(e,t=!0){if(!e.children||e.children.length<1)return;let r=e.children.length,i={},n=[];for(let a=0;a<r;++a){let r=e.children[a];if(r.children.length>0){this.mergeInner(r,t);continue}if(r.userData.relativeToCenter||!r.geometry)continue;let s=!1,o=Object.values(i);for(let t=o.length-1;t>=0;--t){let r=o[t].indexes[0];if(s=this.tryHandleMergeableObjects(e,a,r,i,n),s)break}for(let t=n.length-1;!s&&t>=0;--t){let r=n[t];if(s=this.tryHandleMergeableObjects(e,a,r,i,n),s)break}s||n.push(a)}if(Object.keys(i).length<=0)return;let a=[],s=[],o=[],l=[];Object.values(i).forEach((r=>{let i,n=r.indexes,h=e.children[n[0]],c=[],u=0,d=0,p=0,f=[];if(n.forEach((r=>{var i,n,a,s;let o=e.children[r],l=null==(i=o.geometry)?void 0:i.clone();if(l.applyMatrix4(o.matrix),l.userData.isLineSegments=3===o.type,c.push(l),t){let e=null==(a=null==(n=l.attributes)?void 0:n.position)?void 0:a.count,t=(null==(s=l.index)?void 0:s.count)||0;f.push({batchId:u,positionStart:d,positionCount:e,indexStart:p,indexCount:t}),d+=e,p+=t,u++}})),0!==c.length){if(4===h.type){let e=qi(c);if(!e)return;e.userData={},i=new Ar(h.type),i.geometry=e,i.material=h.material,a.push(i)}else if(2===h.type||3===h.type){let e=Zi.mergeLineGeometries(c,t,h.material instanceof wh||h.material instanceof xr,f);if(!e)return;i=new Ar(3),i.geometry=e,i.material=h.material,s.push(i)}else if(1===h.type){let e=qi(c);if(!e)return;e.userData={},i=new Ar(h.type),i.geometry=e,i.material=h.material,o.push(i)}i&&(t?i.userData.batches=f:(i.userData=h.userData,i.userData.batches=void 0),i.userData.layerName=h.userData.layerName,i.name=`[Merged] ${h.name}`,i.renderOrder=h.renderOrder,i.layers.mask=h.layers.mask,l.push(...n)),c.forEach((e=>{e.dispose(),pr.releaseGeometryManually(e)})),c=[]}})),l.sort(((e,t)=>t-e)),l.forEach((t=>{let r=e.children[t];e.remove(r)})),[...a,...s,...o].forEach((t=>{e.add(t)})),this.MergeInfo.removedObjects+=l.length,this.MergeInfo.mergedMeshes+=a.length,this.MergeInfo.mergedLines+=s.length,this.MergeInfo.mergedPoints+=o.length}static tryHandleMergeableObjects(e,t,r,i,n){let a=!1,s=Array.isArray(e),o=s?e.length:e.children.length;if(t===r||t>=o||r>=o)return a;let l=s?e[t]:e.children[t],h=s?e[r]:e.children[r];return this.areObjectsMergeable(l,h)&&Zi.areGeometriesMergeable(l.geometry,h.geometry)&&$i.materialsEquals(l.material,h.material)&&(i[r]||(i[r]={indexes:[r]},this.removeFromArray(n,r)),i[r].indexes.push(t),a=!0),a}static isFilteredByOtherFactors(e,t){let r=e;if(4===r.type&&r.material&&r.material.isShaderMaterial)return!0;let i=!1,n=e;for(;n&&n!==t;){let e=n.userData;if(e.relativeToCenter||e.spatialFilterHandle){i=!0;break}n=n.parent}return i}static deepMerge(e,t=void 0,r=!0,i=!0,n=!0){let a={added:[],removed:[]};if(e.length<=1)return a;let s=Date.now(),o={},l=[];for(let r=0;r<e.length;++r){if(!e[r].geometry||this.isFilteredByOtherFactors(e[r],t))continue;let i=!1,n=Object.values(o);for(let t=n.length-1;t>=0;--t){let a=n[t].indexes[0];if(i=this.tryHandleMergeableObjects(e,r,a,o,l),i)break}for(let t=l.length-1;!i&&t>=0;--t){let n=l[t];if(i=this.tryHandleMergeableObjects(e,r,n,o,l),i)break}i||l.push(r)}if(Object.keys(o).length<=0)return a;de.debug(`[Merge] Built merged indexes for ${e.length} objects in ${(Date.now()-s)/1e3}s`),s=Date.now();let h=[],c=[],u=[],d=[];Object.values(o).forEach((r=>{let i=r.indexes;if(i.length<2)return;let a,s=e[i[0]],o=[],l=0,p=0,f=0,m=[];if(i.forEach((r=>{var i,a,h,c,u;let d=e[r],g=null==(i=d.geometry)?void 0:i.clone();if(s.material instanceof Yr&&g.deleteAttribute("lineDistance"),this.applyMatrix(g,d,t),g.userData.isLineSegments=3===d.type,o.push(g),n){let e,t=null==(h=null==(a=g.attributes)?void 0:a.position)?void 0:h.count,r=(null==(c=g.index)?void 0:c.count)||0;(2===s.type||3===s.type)&&(g.boundingSphere||g.computeBoundingSphere(),e=null==(u=g.boundingSphere)?void 0:u.clone()),m.push({batchId:l,positionStart:p,positionCount:t,indexStart:f,indexCount:r,boundingSphere:e}),p+=t,f+=r,l++}})),0!==o.length){if(4===s.type){let e=qi(o);if(!e)return;e.userData={},a=new Ar(s.type),a.geometry=e,a.material=s.material,h.push(a)}else if(2===s.type||3===s.type){let e=Zi.mergeLineGeometries(o,n,s.material instanceof wh||s.material instanceof xr,m);if(!e)return;a=new Ar(3),a.geometry=e,a.material=s.material,c.push(a)}else if(1===s.type){let e=qi(o);if(!e)return;e.userData={},a=new Ar(s.type),a.geometry=e,a.material=s.material,u.push(a)}a&&(n?a.userData.batches=m:(a.userData=s.userData,a.userData.batches=void 0),a.userData.layerName=s.userData.layerName,a.name=`[Merged] ${s.name}`,a.renderOrder=s.renderOrder,a.layers.mask=s.layers.mask,i.forEach((e=>d.push(e)))),o.forEach((e=>{e.dispose(),pr.releaseGeometryManually(e)})),o=[]}})),de.debug(`[Merge] Ran deepMerge() in ${(Date.now()-s)/1e3}s`);let p=a.removed;d.forEach((t=>{let i=e[t];p.push(i),r&&i.removeFromParent()}));let f=a.added;return[...h,...c,...u].forEach((e=>{f.push(e),r&&t&&t.add(e)})),this.MergeInfo.removedObjects+=d.length,this.MergeInfo.mergedMeshes+=h.length,this.MergeInfo.mergedLines+=c.length,this.MergeInfo.mergedPoints+=u.length,i&&t&&pn.removeEmptyObjects(t),a}static applyMatrix(e,t,r){let i=t;for(oI.identity();i&&i!==r&&(oI.premultiply(i.matrix),i.parent);)i=i.parent;return oI.equals(VMt)?e:e.applyMatrix4(oI)}static removeFromArray(e,t){for(let r=e.length-1;r>=0;--r)if(e[r]===t)return void e.splice(r,1)}static areObjectsMergeable(e,t){return e.layers.mask===t.layers.mask&&e.renderOrder===t.renderOrder&&e.userData.layerName===t.userData.layerName&&(e.type===t.type||!(2!==e.type&&3!==e.type||2!==t.type&&3!==t.type))}};function v_e(e,t,r,i,n=0){let a={u_cameraZoom:r,u_patternLines:{value:e},u_patternAngle:{value:t},u_color:{value:i}},s=`\n        uniform mat4 modelMatrix;\n        uniform float u_cameraZoom;\n        uniform vec3 u_color;\n        varying vec3 v_pos;\n\n        struct PatternLine {\n            vec2 origin;\n            vec2 delta;\n            float angle;\n            float pattern[MAX_PATTERN_SEGMENT_COUNT];\n            float patternSum[MAX_PATTERN_SEGMENT_COUNT+1];\n            float patternLength;\n        };\n\n        uniform PatternLine u_patternLines[${e.length}];\n        uniform float u_patternAngle;\n\n        #include <clipping_planes_pars_fragment>\n\n        // Clamp [0..1] range\n        #define saturate(a) clamp(a, 0.0, 1.0)\n\n        const float EPS = 1000.0;\n\n        vec2 getWorldScale() {\n            return vec2(length(modelMatrix[0].xyz), length(modelMatrix[1].xyz));\n        }\n\n        vec2 rotate(vec2 st, float rotation) {\n            const float PI = 3.1415926;\n            float angle = rotation * PI/180.0;\n            float sine = sin(angle), cosine = cos(angle);\n            return vec2(cosine * st.x - sine * st.y, cosine * st.y + sine * st.x);\n        }\n\n        vec2 translate(vec2 samplePosition, vec2 offset) {\n            //move sample point in the opposite direction that we want to move shapes in\n            return samplePosition - offset;\n        }\n\n        vec2 scale(vec2 samplePosition, float scale) {\n            return samplePosition / scale;\n        }\n\n        float sdfLine(vec2 st, vec2 a, vec2 b) {\n            vec2 ap = st - a;\n            vec2 ab = b - a;\n            return abs(((ap.x * ab.y) - (ab.x * ap.y))) / length(ab);\n        }\n\n        float drawSpaceLine(vec2 st, float distanceBetweenLines, float thick) {\n            float dist = sdfLine(st , vec2(0.0, 0.0) , vec2(1.0, 0.0));\n\n            //vec2 tt = dFdy(st);\n            //float scale = (abs(tt.x)+abs(tt.y))/2.0;\n            //float scale = length(fwidth(st)) * 0.5;\n            // close to a pixel\n            //float thick = 2.0;\n            //thick = (thick * 0.5 - 0.5) * scale;\n\n            float lineDistance = abs(fract(dist / distanceBetweenLines + 0.5) - 0.5) * distanceBetweenLines;\n            //float lineDistance = fract(dist / distanceBetweenLines);\n            //float distanceChange = fwidth(dist) * 0.5;\n            //float threshold = smoothstep(thick - distanceChange, thick + distanceChange, lineDistance);\n            //float threshold = step(thick, lineDistance);\n            // remove gradient\n            //float threshold = step(0.001, lineDistance);\n            float threshold = step(thick, lineDistance);\n\n            return threshold;\n        }\n\n        float drawSolidLine(PatternLine patternLine, float thick) {\n            vec2 origin = patternLine.origin;\n            vec2 delta = patternLine.delta;\n            float distanceBetweenLines = length(delta);\n\n            origin = rotate(origin,u_patternAngle);\n            vec2 st = rotate(v_pos.xy - origin, -(patternLine.angle + u_patternAngle));\n\n            return drawSpaceLine(st, distanceBetweenLines , thick);\n        }\n\n        int getPatternIndex(PatternLine patternLine, float u, out float distance ) {\n            //u = mod(u, patternLine.patternLength);\n            float y = floor(u/patternLine.patternLength);\n            u = u - patternLine.patternLength * y;\n            //float distance = 0.0;\n\n            #pragma unroll_loop_start\n            for(int i = 1; i < patternLine.patternSum.length(); i++){\n                if(u <= patternLine.patternSum[i]) {\n                    distance = u - patternLine.patternSum[i-1];\n                    return i - 1;\n                }\n            }\n            #pragma unroll_loop_end\n\n            return -1;\n        }\n\n        float drawDashedLine(PatternLine patternLine, float thick){\n            float threshold = 1.0;\n            vec2 origin = patternLine.origin;\n            vec2 delta = patternLine.delta;        \n            float distanceBetweenLines = abs(delta.y);\n\n            origin = rotate(origin, u_patternAngle);\n            vec2 st = rotate(v_pos.xy - origin, -(patternLine.angle + u_patternAngle));\n\n            float offsetX = st.y * delta.x/delta.y;\n            float u = st.x - offsetX;\n            float distance = 0.0;\n            int index = getPatternIndex(patternLine, u, distance);\n            if(index < 0) {\n                return threshold;\n            }\n\n            float size = patternLine.pattern[index];\n            if(size >= 0.0) {\n                threshold = drawSpaceLine(st, distanceBetweenLines , thick);\n                // Try to solve the problem caused by the precision after zooming out by drawing a part of the dashed line\n            } else if (distance < thick) {\n                //threshold = 0.8;\n                threshold = drawSpaceLine(st, distanceBetweenLines , thick);\n            }\n\n            return threshold;\n        }\n\n        float drawLine(PatternLine patternLine, float thick) {\n            float t = 0.0;\n            if(patternLine.patternLength > 0.0) {\n                t = drawDashedLine(patternLine, thick);\n            } else {\n                t = drawSolidLine(patternLine, thick);\n            }\n            return t;\n        }\n\n        void main() {\n            #include <clipping_planes_fragment>\n\n            // Idealy, the thickness of lines in hatch pattern should always be 1 pixel.\n            // In Viewer2d, it uses orthographic camera and always in top view,\n            // so we adjust thickness by cameraZoom (and also consider worldScale).\n            // While 3d view is more complex, it can use perspective camera,\n            // its camera position and direction is flexible. We cannot keep line thickness\n            // in a fixed pixel any more, and there is no proper way to adjust thickness as camera\n            // position changes. So, we need to use a fixed thickness in world coordinates.\n#if ${n} > 0\n            float thick = float(${n});\n#else\n            vec2 worldScale = getWorldScale();\n            float averageScale = (abs(worldScale.x) + abs(worldScale.y))/2.0;\n            // possible size of a pixel \n            float thick = (0.7 / averageScale) / u_cameraZoom;\n#endif\n\n            if(thick > EPS) {\n                gl_FragColor = vec4(u_color, 1.0);\n                #include <colorspace_fragment>\n                return;\n            }\n\n            float total = 0.0;\n\n#if ${e.length} > 1\n            #pragma unroll_loop_start\n            for (int i = 0; i < u_patternLines.length(); i++) {\n                PatternLine pl = u_patternLines[i];\n                float t = drawLine(pl, thick);\n                total += (1.0 - t);\n            }\n            #pragma unroll_loop_end\n#else\n            float t = drawLine(u_patternLines[0], thick);\n            total += (1.0 - t);\n#endif\n\n            total = saturate(total);\n            if (total < 0.001) {\n                discard;\n            }\n\n            gl_FragColor = vec4(u_color * total, 1.0);\n            #include <colorspace_fragment>\n        }\n        `;return new xr({uniforms:a,vertexShader:"\n        varying vec3 v_pos;\n\n        #include <clipping_planes_pars_vertex>\n        void main() {\n            //vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n            v_pos = position;\n\n            #include <begin_vertex>\n            #include <project_vertex>\n            #include <clipping_planes_vertex>\n        }",fragmentShader:s,clipping:!0})}Ou.MergeInfo={removedObjects:0,mergedMeshes:0,mergedLines:0,mergedPoints:0,mergedUnknownTypeObjects:0,elapsedTime:0};var lI=class{static createLineShaderMaterial(e,t,r,i,n){let a=0,s=[];for(let t=0;t<e.length;t++)s[t]=e[t],0===s[t]&&(s[t]=.5),s[t]*=r,a+=Math.abs(s[t]);let o=xi.merge([hr.common,{pattern:{type:"fv1",value:s},patternLength:{type:"f",value:a},u_color:{value:new dt(t)}}]);o.u_viewportScale=i,o.u_cameraZoom=n;let l=`\n            uniform mat4 modelMatrix;\n            uniform vec3 diffuse;\n            uniform vec3 u_color;\n            uniform float opacity;\n            uniform float pattern[${e.length}];\n            uniform float patternLength;\n            uniform float u_viewportScale;\n            uniform float u_cameraZoom;\n            varying float vLineDistance;\n\n            #include <clipping_planes_pars_fragment>\n\n            vec2 getWorldScale() {\n                return vec2(length(modelMatrix[0].xyz), length(modelMatrix[1].xyz));\n            }\n\n            void main() {\n\n                #include <clipping_planes_fragment>\n\n                // vec2 worldScale = getWorldScale();\n                // float averageScale = (abs(worldScale.x) + abs(worldScale.y))/2.0;\n                // When zoomed out to a certain extent, it is displayed as a solid line.\n                if(patternLength * u_viewportScale * u_cameraZoom/1.5 < 1.0){\n                    gl_FragColor = vec4(u_color, opacity);\n                    #include <colorspace_fragment>\n                    return;\n                }\n\n                float pos = mod(vLineDistance, patternLength * u_viewportScale);\n\n                for ( int i = 0; i < ${e.length}; i++ ) {\n                    pos = pos - abs(pattern[i] * u_viewportScale);\n                    if ( pos < 0.0 ) {\n                        if ( pattern[i] > 0.0 ) {\n                            gl_FragColor = vec4(u_color, opacity);\n                            break;\n                        }\n                        discard;\n                    }\n                }\n                #include <colorspace_fragment>\n            }`;return new xr({uniforms:o,vertexShader:"\n            attribute float lineDistance;\n            varying float vLineDistance;\n\n            #include <clipping_planes_pars_vertex>\n\n            void main() {\n                vLineDistance = lineDistance;\n\n                #include <begin_vertex>\n                #include <project_vertex>\n                #include <clipping_planes_vertex>\n            }",fragmentShader:l,clipping:!0})}},y_e=(e,t)=>{if(void 0===t||0==+t)return Math.round(e);let r=+e;if(t=+t,isNaN(r)||"number"!=typeof t||t%1!=0)return NaN;let i=r.toString().split("e");return r=Math.round(+(i[0]+"e"+(i[1]?+i[1]-t:-t))),i=r.toString().split("e"),+(i[0]+"e"+(i[1]?+i[1]+t:t))},b_e=(e,t,r,i,n)=>{let a=r.length,s=r[0].length;if(e<0||e>1)throw new Error("t out of bounds [0,1]: "+e);if(t<1)throw new Error("degree must be at least 1 (linear)");if(t>a-1)throw new Error("degree must be less than or equal to point count - 1");if(i){if(i.length!==a+t+1)throw new Error("bad knot vector length")}else{i=[];for(let e=0;e<a+t+1;e++)i[e]=e}let o,l=[t,i.length-1-t],h=i[l[0]],c=i[l[1]];for(e=e*(c-h)+h,e=Math.max(e,h),e=Math.min(e,c),o=l[0];o<l[1]&&!(e>=i[o]&&e<=i[o+1]);o++);let u,d=[];for(let e=0;e<a;e++){d[e]=[];let t=n?n[e]:1;for(let i=0;i<s;i++)d[e][i]=r[e][i]*t;d[e][s]=t}for(let r=1;r<=t+1;r++)for(let n=o;n>o-t-1+r;n--){u=(e-i[n])/(i[n+t+1-r]-i[n]);for(let e=0;e<s+1;e++)d[n][e]=(1-u)*d[n-1][e]+u*d[n][e]}let p=[];for(let e=0;e<s;e++)p[e]=y_e(d[o][e]/d[o][s],-9);return p},zMt={d:"°",c:"⌀",p:"±"},cI=(e,t)=>{if(!e)return[];e=e.replace(/%%(.)/g,((e,t)=>zMt[t]||t)).replace(/\^I/g,"    ");let r,i=null==t?void 0:t.encoding,n=i instanceof TextDecoder?i:void 0,a="",s=[],o=e=>{a&&(s.push(a),a=""),s.push(e)};for(let t=0;t<e.length;t++)switch(r=e[t]){default:a+=r;break;case"\\":switch(r=e[++t]){default:a+=r;break;case"p":{let r=e.slice(t,t=e.indexOf(";",t));r.startsWith("pxq")||r.startsWith("pxi")||r.startsWith("pxt")||r.startsWith("pt")||r.startsWith("pi")||(r.startsWith("psm")?o({[r.slice(0,r.length-1)]:r[r.length-1]}):r.startsWith("pq")?o({[r.slice(0,r.length-1)]:r[r.length-1]}):o({[r.slice(0,r.length-1)]:r[r.length-1]}));break}case"P":a+="\n";break;case"f":case"F":{let i="";for(;r=e[++t];){if(";"===r){o({f:i});break}if("|"===r){let r={f:i},n=e.indexOf(";",++t);for(let i of e.slice(t,n).split("|"))r[i[0]]=+i.slice(1);t=n,o(r);break}i+="\\"===r?e[++t]:r}break}case"S":{let i,n="",a="";for(;r=e[++t];){if(";"===r){i&&o("/"===i||"#"===i?n+"/"+a:n+a);break}"\\"===r?i?a+=e[++t]:n+=e[++t]:i?a+=r:"^"===r||"/"===r||"#"===r?i=r:n+=r}break}case"H":case"W":{let i=++t,[,n,a]=e.slice(i,t=e.indexOf(";",t)).match(/^(\d*(?:\.\d+)?)(\D*)$/);o({[r]:[+n,a]})}break;case"Q":case"A":case"C":case"c":case"T":{let i=++t;o({[r]:+e.slice(i,t=e.indexOf(";",t))});break}case"L":case"O":case"K":o({[r]:1});break;case"l":case"o":case"k":o({[r.toUpperCase()]:0});break;case"U":case"u":"+"===e[t+1]?(a+=String.fromCodePoint(parseInt(e.substr(t+2,4),16)),t+=5):a+=r;break;case"M":case"m":i?"+"!==e[t+1]||"0"!==e[t+2]&&"1"!==e[t+2]?a+=r:(a+=(n=n||new TextDecoder(i)).decode(new Uint8Array([parseInt(e.substr(t+3,2),16),parseInt(e.substr(t+5,2),16)])),t+=6):a+="\\"+r}break;case"{":{let i=1,n=t;for(;r=e[++t];)if("{"===r)i++;else if("}"===r){if(0==--i){o(cI(e.slice(n+1,t)));break}}else"\\"===r&&t++;break}}return a&&s.push(a),s},GMt={d:"°",c:"⌀",p:"±"},qMt=(e,t)=>(e=jMt(e),t?WMt(e,t):e),jMt=e=>e.replace(/\\[uU]\+([0-9a-fA-F]{4})/g,((e,t)=>String.fromCodePoint(parseInt(t,16)))),WMt=(e,t)=>{let r=t instanceof TextDecoder?t:new TextDecoder(t);return e.replace(/\\[mM]\+[0|1]([0-9a-fA-F]{2})([0-9a-fA-F]{2})/g,((e,i,n)=>(r=r||new TextDecoder(t)).decode(new Uint8Array([parseInt(i,16),parseInt(n,16)]))))},uI=(e,t)=>{let r=0,i={text:""},n=[i],a=(e=qMt(e,null==t?void 0:t.encoding)).matchAll(/%%(\d\d\d|.)/g);for(let t of a){i.text+=e.slice(r,t.index);let a=t[1].toLowerCase(),s=GMt[a];s?i.text+=s:3===a.length?i.text+=String.fromCodePoint(+a):"k"===a||"o"===a||"u"===a?(i=Ii(on({},i),{text:""}),i[a]?delete i[a]:i[a]=1,n.push(i)):i.text+=a,r=t.index+t[0].length}return i.text+=e.slice(r),n.filter((e=>e.text))},hI=(e=>(e.Unitless="Unitless",e.Inches="Inches",e.Feet="Feet",e.Millimeters="Millimeters",e.Centimeters="Centimeters",e.Meters="Meters",e))(hI||{}),x_e=e=>"Unitless"===e?1:"Inches"===e?.0254:"Feet"===e?.3048:"Millimeters"===e?.001:"Centimeters"===e?.01:("Meters"===e||console.warn(`[Units] Unsupported unit '${e}', will return 1 for unit scale.`),1),YZt=(e,t)=>x_e(e)/x_e(t),sb=class{constructor(){this.pointer=0,this.eof=!1}},E_e=1e3,jT=class extends sb{constructor(e){super(),this.int8Array=new Int8Array(E_e),this.caches=new Map,this.reader=new Mc(e);let t=this.reader.readBytes(22),r="";for(let e=0;e<18;e++)r+=String.fromCharCode(t[e]);if("AutoCAD Binary DXF"!=r)throw new Error("Invalid DXF file")}next(){if(!this.hasNext())throw this.eof?new Error("Cannot call 'next' after EOF group has been read"):new Error("Unexpected end of input: EOF group not read before end of file.");let e={code:this.reader.readInt16()};return e.value=this.parseGroupValue(e.code),0===e.code&&"EOF"===e.value&&(this.eof=!0),this.lastReadGroup=e,e}hasNext(){return!this.eof&&!this.reader.isEnd()}isEOF(){return this.eof}parseGroupValue(e){if(e>=0&&e<=9)return this.readNullTerminatedString();if(e>=10&&e<=59)return this.reader.readFloat64();if(e>=60&&e<=79)return this.reader.readInt16();if(e>=90&&e<=99)return this.reader.readInt32();if(e>=100&&e<=109)return this.readNullTerminatedString();if(e>=110&&e<=149)return this.reader.readFloat64();if(e>=160&&e<=169)return this.reader.readInt64();if(e>=170&&e<=179)return this.reader.readInt16();if(e>=210&&e<=239)return this.reader.readFloat64();if(e>=270&&e<=289)return this.reader.readInt16();if(e>=290&&e<=299)return this.reader.readInt8()>0;if(e>=300&&e<=309)return this.readNullTerminatedString();if(e>=310&&e<=319){return __e(this.ReadBinaryData())}if(e>=320&&e<=369)return this.readNullTerminatedString();if(e>=370&&e<=389)return this.reader.readInt16();if(e>=390&&e<=399)return this.readNullTerminatedString();if(e>=400&&e<=409)return this.reader.readInt16();if(e>=410&&e<=419)return this.readNullTerminatedString();if(e>=420&&e<=429)return this.reader.readInt32();if(e>=430&&e<=439)return this.readNullTerminatedString();if(e>=440&&e<=459)return this.reader.readInt32();if(e>=460&&e<=469)return this.reader.readFloat64();if(e>=470&&e<=481)return this.readNullTerminatedString();if(999===e)throw new Error("The comment group 999, is not used in binary DXF files at byte address!");if(1004===e){return __e(this.ReadBinaryData())}return e>=1e3&&e<=1009?this.readNullTerminatedString():e>=1010&&e<=1059?this.reader.readFloat64():e>=1060&&e<=1070?this.reader.readInt16():1071===e?this.reader.readInt32():void de.warn(`[DxfBinReader] Invalid code '${e}' at byte address ${this.reader.getPosition()}`)}readNullTerminatedString(){var e;this.decoder||(this.decoder=new TextDecoder("utf-8"));let t=0,r=this.reader.readInt8();for(;0!==r;)this.int8Array[t++]=r,r=this.reader.readInt8();if(0===t)return"";if(t>E_e)return de.warn(`[DxfBinReader] Failed to read string! The number of bytes is ${t} !`),"";let i=this.int8Array.subarray(0,t),n=i.toString();if(this.caches.get(n))return this.caches.get(n);let a=null==(e=this.decoder)?void 0:e.decode(i);return this.caches.set(n,a),a}ReadBinaryData(){let e=this.reader.readUint8();return this.reader.readBytes(e)}};function __e(e){return Array.prototype.map.call(e,(e=>("00"+e.toString(16)).slice(-2))).join("")}var ab=class extends sb{constructor(e){super(),this.data=e}next(){if(!this.hasNext())throw this.eof?new Error("Cannot call 'next' after EOF group has been read"):new Error("Unexpected end of input: EOF group not read before end of file. Ended on code "+this.data[this.pointer]);let e={code:parseInt(this.data[this.pointer])};return this.pointer++,e.value=XMt(e.code,this.data[this.pointer].trim()),this.pointer++,0===e.code&&"EOF"===e.value&&(this.eof=!0),this.lastReadGroup=e,e}hasNext(){return!(this.eof||this.pointer>this.data.length-2)}isEOF(){return this.eof}};function XMt(e,t){return e>=0&&e<=9?t:e>=10&&e<=59?parseFloat(t):e>=60&&e<=99?parseInt(t):e>=100&&e<=109?t:e>=110&&e<=149?parseFloat(t):e>=160&&e<=179?parseInt(t):e>=210&&e<=239?parseFloat(t):e>=270&&e<=289?parseInt(t):e>=290&&e<=299?YMt(t):e>=300&&e<=369?t:e>=370&&e<=389?parseInt(t):e>=390&&e<=399?t:e>=400&&e<=409?parseInt(t):e>=410&&e<=419?t:e>=420&&e<=429?parseInt(t):e>=430&&e<=439?t:e>=440&&e<=459?parseInt(t):e>=460&&e<=469?parseFloat(t):e>=470&&e<=481||999===e||e>=1e3&&e<=1009?t:e>=1010&&e<=1059?parseFloat(t):e>=1060&&e<=1071?parseInt(t):(de.info("WARNING: Group code does not have a defined type: %j",{code:e,value:t}),t)}function YMt(e){if("0"===e)return!1;if("1"===e)return!0;throw TypeError("String '"+e+"' cannot be cast to Boolean type")}var $Mt=e=>{if(null==e)return!0;for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0},WT=class{constructor(){this.ForEntityName="3DFACE"}parseEntity(e,t){let r={type:t.value,vertices:[]};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 70:if(0!==t.value){let e=Math.log2(t.value)-1;r.vertices.splice(e,1)}t=e.next();break;case 10:r.vertices=ZMt(e,t),t=e.lastReadGroup;break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}};function ZMt(e,t){let r=[],i=!1,n=!1;for(let a=0;a<=4;a++){let a={};for(;!e.isEOF()&&0!==t.code&&!n;){switch(t.code){case 10:case 11:case 12:case 13:if(i){n=!0;continue}a.x=t.value,i=!0;break;case 20:case 21:case 22:case 23:a.y=t.value;break;case 30:case 31:case 32:case 33:a.z=t.value;break;default:return r}t=e.next()}$Mt(a)||r.push(a),i=!1,n=!1}return r}var XT=class{constructor(){this.ForEntityName="ARC"}parseEntity(e,t){let r={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:r.center=Wt(e),t=e.lastReadGroup;break;case 40:r.radius=t.value,t=e.next();break;case 50:r.startAngle=Math.PI/180*t.value,t=e.next();break;case 51:r.endAngle=Math.PI/180*t.value,r.angleLength=r.endAngle-r.startAngle,t=e.next();break;case 210:r.extrusionDirectionX=t.value,t=e.next();break;case 220:r.extrusionDirectionY=t.value,t=e.next();break;case 230:r.extrusionDirectionZ=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}},YT=class{constructor(){this.ForEntityName="ATTDEF"}parseEntity(e,t){let r={type:t.value,xScale:1,textStyle:"STANDARD"};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 1:r.text=t.value,t=e.next();break;case 2:r.tag=t.value,t=e.next();break;case 3:r.prompt=t.value,t=e.next();break;case 7:r.textStyle=t.value,t=e.next();break;case 10:r.startPoint=Wt(e),t=e.lastReadGroup;break;case 11:r.endPoint=Wt(e),t=e.lastReadGroup;break;case 39:r.thickness=t.value,t=e.next();break;case 40:r.textHeight=t.value,t=e.next();break;case 41:r.xScale=t.value,t=e.next();break;case 50:r.rotation=t.value,t=e.next();break;case 51:r.obliqueAngle=t.value,t=e.next();break;case 70:r.invisible=!!(1&t.value),r.constant=!!(2&t.value),r.verificationRequired=!!(4&t.value),r.preset=!!(8&t.value),t=e.next();break;case 71:r.backwards=!!(2&t.value),r.mirrored=!!(4&t.value),t=e.next();break;case 72:r.horizontalJustification=t.value,t=e.next();break;case 73:r.fieldLength=t.value,t=e.next();break;case 74:r.verticalJustification=t.value,t=e.next();break;case 100:t=e.next();break;case 210:r.extrusionDirectionX=t.value,t=e.next();break;case 220:r.extrusionDirectionY=t.value,t=e.next();break;case 230:r.extrusionDirectionZ=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}},$T=class{constructor(){this.ForEntityName="ATTRIB"}parseEntity(e,t){let r={type:t.value,xScale:1,textStyle:"STANDARD"};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 1:r.text=t.value,t=e.next();break;case 2:r.tag=t.value,t=e.next();break;case 3:r.prompt=t.value,t=e.next();break;case 7:r.textStyle=t.value,t=e.next();break;case 10:r.startPoint=Wt(e),t=e.lastReadGroup;break;case 11:r.endPoint=Wt(e),t=e.lastReadGroup;break;case 39:r.thickness=t.value,t=e.next();break;case 40:r.textHeight=t.value,t=e.next();break;case 41:r.xScale=t.value,t=e.next();break;case 50:r.rotation=t.value,t=e.next();break;case 51:r.obliqueAngle=t.value,t=e.next();break;case 70:r.invisible=!!(1&t.value),r.constant=!!(2&t.value),r.verificationRequired=!!(4&t.value),r.preset=!!(8&t.value),t=e.next();break;case 71:r.backwards=!!(2&t.value),r.mirrored=!!(4&t.value),t=e.next();break;case 72:r.horizontalJustification=t.value,t=e.next();break;case 73:r.fieldLength=t.value,t=e.next();break;case 74:r.verticalJustification=t.value,t=e.next();break;case 100:t=e.next();break;case 210:r.extrusionDirectionX=t.value,t=e.next();break;case 220:r.extrusionDirectionY=t.value,t=e.next();break;case 230:r.extrusionDirectionZ=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}},ZT=class{constructor(){this.ForEntityName="CIRCLE"}parseEntity(e,t){let r={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:r.center=Wt(e),t=e.lastReadGroup;break;case 40:r.radius=t.value,t=e.next();break;case 50:r.startAngle=Math.PI/180*t.value,t=e.next();break;case 51:let i=Math.PI/180*t.value;i<r.startAngle?r.angleLength=i+2*Math.PI-r.startAngle:r.angleLength=i-r.startAngle,r.endAngle=i,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}},KT=class{constructor(){this.ForEntityName="DIMENSION"}parseEntity(e,t){let r={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 2:r.block=t.value,t=e.next();break;case 3:r.dimStyleName=t.value,t=e.next();break;case 10:r.anchorPoint=Wt(e),t=e.lastReadGroup;break;case 11:r.middleOfText=Wt(e),t=e.lastReadGroup;break;case 12:r.insertionPoint=Wt(e),t=e.lastReadGroup;break;case 13:r.linearOrAngularPoint1=Wt(e),t=e.lastReadGroup;break;case 14:r.linearOrAngularPoint2=Wt(e),t=e.lastReadGroup;break;case 15:r.diameterOrRadiusPoint=Wt(e),t=e.lastReadGroup;break;case 16:r.arcPoint=Wt(e),t=e.lastReadGroup;break;case 70:r.dimensionType=t.value,t=e.next();break;case 71:r.attachmentPoint=t.value,t=e.next();break;case 42:r.actualMeasurement=t.value,t=e.next();break;case 1:r.text=t.value,t=e.next();break;case 50:r.angle=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}},JT=class{constructor(){this.ForEntityName="ELLIPSE"}parseEntity(e,t){let r={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:r.center=Wt(e),t=e.lastReadGroup;break;case 11:r.majorAxisEndPoint=Wt(e),t=e.lastReadGroup;break;case 40:r.axisRatio=t.value,t=e.next();break;case 41:r.startAngle=t.value,t=e.next();break;case 42:r.endAngle=t.value,t=e.next();break;case 210:r.extrusionDirection=Wt(e),t=e.lastReadGroup;break;case 2:r.name=t.value,t=e.next();break;default:Gr(r,t),t=e.next()}return r}},E0=class{constructor(e){this.type=e,this.startPoint={x:0,y:0,z:0},this.endPoint={x:0,y:0,z:0}}},EG=class extends E0{constructor(){super(0),this.points=[],this.isClosed=!0}},_G=class extends E0{constructor(){super(1)}},TG=class extends E0{constructor(){super(2),this.center={x:0,y:0,z:0},this.radius=0,this.startAngle=0,this.endAngle=0,this.bCounterclockwise=!1}},wG=class extends E0{constructor(){super(3),this.center={x:0,y:0,z:0},this.majorAxisEndPoint={x:0,y:0,z:0},this.minorRatio=0,this.startAngle=0,this.endAngle=0,this.bCounterclockwise=!1}},SG=class extends E0{constructor(){super(4),this.controlPoints=[],this.numControlPoints=0,this.knotValues=[],this.numKnots=0,this.bPeriodic=!1,this.bRational=!1,this.degreeOfSplineCurve=0}},QT=class{constructor(){this.ForEntityName="HATCH"}parseEntity(e,t){let r={type:t.value,boundaryPaths:[]};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 2:r.patternName=t.value,t=e.next();break;case 10:r.elevationX=t.value,t=e.next();break;case 20:r.elevationY=t.value,t=e.next();break;case 30:r.elevationZ=t.value,t=e.next();break;case 41:r.patternScale=t.value,t=e.next();break;case 47:r.pixelSize=t.value,t=e.next();break;case 52:r.patternAngle=t.value,t=e.next();break;case 63:r.patternFillColor=t.value,t=e.next();break;case 70:r.solidFill=0!=(1&t.value),t=e.next();break;case 71:r.associativity=0!=(1&t.value),t=e.next();break;case 73:r.annotatedBoundary=0!=(1&t.value),t=e.next();break;case 75:r.style=t.value,t=e.next();break;case 76:r.patternType=t.value,t=e.next();break;case 78:r.patternLines=eAt(t.value,e),t=e.lastReadGroup;break;case 91:r.boundaryPathsCount=t.value,r.boundaryPaths=QMt(r.boundaryPathsCount,e),t=e.lastReadGroup;break;case 98:r.seedPointsCount=t.value,t=e.next();break;case 210:r.extrusionDirectionX=t.value,t=e.next();break;case 220:r.extrusionDirectionY=t.value,t=e.next();break;case 230:r.extrusionDirectionZ=t.value,t=e.next();break;case 450:r.isGradientColor=1===t.value,t=e.next();break;case 451:case 452:case 460:case 461:case 462:case 463:case 470:t=e.next();break;case 453:r.gradientColorCount=t.value,r.gradientColors=tAt(r.gradientColorCount,e),t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}};function KMt(e){let t=new EG,r=e.next(),i=0!==r.value;r=e.next(),t.isClosed=0!==r.value,r=e.next();let n=r.value;r=e.next();for(let a=0;a<n;a++){let n=Wt(e);r=e.lastReadGroup,i&&(n.bulge=r.value,r=e.next()),t.points.push(n)}r=e.lastReadGroup,console.assert(97===r.code,"The reference count code 97 was expected.");let a=r.value;r=e.next();for(let t=0;t<a;t++)console.assert(330===r.code,"The reference handle code 330 was expected."),r=e.next();return{edges:[t],pathTypeFlag:-1}}function JMt(e,t){let r=[],i=t.next();for(;r.length<e;)if(72===i.code)switch(i.value){case 1:{i=t.next();let e=new _G;e.startPoint=Wt(t),e.endPoint=Wt(t),i=t.lastReadGroup,r.push(e);break}case 2:{i=t.next();let e=new TG;e.center=Wt(t),i=t.lastReadGroup,e.radius=i.value,i=t.next(),e.startAngle=i.value,i=t.next(),e.endAngle=i.value,i=t.next(),e.bCounterclockwise=0!==i.value,i=t.next(),r.push(e);break}case 3:{i=t.next();let e=new wG;e.center=Wt(t),e.majorAxisEndPoint=Wt(t),i=t.lastReadGroup,e.minorRatio=i.value,i=t.next(),e.startAngle=i.value,i=t.next(),e.endAngle=i.value,i=t.next(),e.bCounterclockwise=0!==i.value,i=t.next(),r.push(e);break}case 4:{i=t.next();let e=new SG;e.degreeOfSplineCurve=i.value,i=t.next(),e.bRational=0!==i.value,i=t.next(),e.bPeriodic=0!==i.value,i=t.next(),e.numKnots=i.value,i=t.next(),e.numControlPoints=i.value,i=t.next();for(let r=0;r<e.numKnots;r++)e.knotValues.push(i.value),i=t.next();for(let r=0;r<e.numControlPoints;r++){let r=i.value;i=t.next();let n=i.value,a=1;i=t.next(),42===i.code&&(a=i.value,i=t.next()),e.controlPoints.push({x:r,y:n,z:a})}r.push(e);break}default:i=t.next()}else i=t.next();i=t.lastReadGroup,console.assert(97===i.code,"The reference count code 97 was expected.");let n=i.value;i=t.next();for(let e=0;e<n;e++)console.assert(330===i.code,"The reference handle code 330 was expected."),i=t.next();return{edges:r,pathTypeFlag:-1}}function QMt(e,t){let r=[],i=-1,n=t.next();for(;r.length<e;){let e;switch(n.code){case 92:if(i=n.value,2&i){if(e=KMt(t),!e)throw new Error("[Hatch] Failed to parse hatch polyline boundary path !");e.pathTypeFlag=i,r.push(e),n=t.lastReadGroup}else n=t.next();break;case 93:e=JMt(n.value,t),e.pathTypeFlag=i,r.push(e),n=t.lastReadGroup;break;default:n=t.next()}}return r}function eAt(e,t){if(e<=0)return void t.next();let r=[],i=t.next();for(let n=0;n<e;n++){let e=0,n={x:0,y:0},a={x:0,y:0},s=-1,o=[];for(;!t.isEOF()&&0!==i.code;){let r=!1;switch(i.code){case 53:e=i.value;break;case 43:n.x=i.value;break;case 44:n.y=i.value;break;case 45:a.x=i.value;break;case 46:a.y=i.value;break;case 79:s=i.value;break;case 49:o.push(i.value);break;default:r=!0}if(i=t.next(),r||o.length===s)break}s>=0&&r.push({angle:e,origin:n,delta:a,dashPattern:o})}return r}function tAt(e,t){let r=[],i=t.next();for(;r.length<e;)switch(i.code){case 63:default:i=t.next();break;case 421:r.push(i.value),i=t.next()}return r}var ew=class{constructor(){this.ForEntityName="IMAGE"}parseEntity(e,t){let r={type:t.value,clippingBoundaryPath:[]};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:r.position=Wt(e),t=e.lastReadGroup;break;case 11:r.uPixel=Wt(e),t=e.lastReadGroup;break;case 12:r.vPixel=Wt(e),t=e.lastReadGroup;break;case 13:r.imageSize=Wt(e),t=e.lastReadGroup;break;case 340:r.imageDefHandle=t.value,t=e.next();break;case 70:r.flags=t.value,t=e.next();break;case 280:r.clipping=t.value,t=e.next();break;case 281:r.brightness=t.value,t=e.next();break;case 282:r.contrast=t.value,t=e.next();break;case 283:r.fade=t.value,t=e.next();break;case 360:r.imageDefReactorHandle=t.value,t=e.next();break;case 71:r.clippingBoundaryType=t.value,t=e.next();break;case 91:r.countBoundaryPoints=t.value,t=e.next();break;case 14:r.clippingBoundaryPath.push(Wt(e)),t=e.lastReadGroup;break;case 290:r.clipMode=t.value,t=e.next();default:Gr(r,t),t=e.next()}return r}},tw=class{constructor(){this.ForEntityName="INSERT"}parseEntity(e,t){let r={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 2:r.block=t.value,t=e.next();break;case 66:r.attributesFollow=0!=t.value,t=e.next();break;case 41:r.xScale=t.value,t=e.next();break;case 42:r.yScale=t.value,t=e.next();break;case 43:r.zScale=t.value,t=e.next();break;case 10:r.position=Wt(e),t=e.lastReadGroup;break;case 50:r.rotation=t.value,t=e.next();break;case 70:r.columnCount=t.value,t=e.next();break;case 71:r.rowCount=t.value,t=e.next();break;case 44:r.columnSpacing=t.value,t=e.next();break;case 45:r.rowSpacing=t.value,t=e.next();break;case 210:r.extrusionDirection=Wt(e),t=e.lastReadGroup;break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}},rw=class{constructor(){this.ForEntityName="LEADER"}parseEntity(e,t){let r={type:t.value,arrowFlag:1,vertices:[]};t=e.next();let i=!1;for(;!e.isEOF()&&0!==t.code;)switch(t.code){case 10:r.vertices.push(Wt(e)),t=e.lastReadGroup;break;case 3:r.dimensionStyle=t.value,t=e.next();break;case 40:r.textHeight=t.value,t=e.next();break;case 41:r.textWidth=t.value,t=e.next();break;case 71:r.arrowFlag=t.value,t=e.next();break;case 72:r.pathType=t.value,t=e.next();break;case 73:r.creationFlag=t.value,t=e.next();break;case 74:r.direction=t.value,t=e.next();break;case 75:r.hasHookline=1===t.value,t=e.next();break;case 1001:i="ACAD"===t.value,t=e.next();break;case 1070:if(i){let i=rAt(t.value);i&&((1005==(t=e.next()).code||1040==t.code||1070==t.code)&&("DIMLDRBLK"===i&&(r.arrowHeadBlockHandle=t.value),"DIMASZ"===i&&(r.arrowHeight=t.value),"DIMSCALE"===i&&(r.arrowHeadScale=t.value),"DIMCLRD"===i&&t.value>0&&(r.colorIndex=t.value,r.color=x0(Math.abs(t.value)))))}t=e.next();break;default:Gr(r,t),t=e.next()}return r}};function rAt(e){switch(e){case 40:return"DIMSCALE";case 41:return"DIMASZ";case 42:return"DIMEXO";case 44:return"DIMEXE";case 75:return"DIMSE1";case 76:return"DIMSE2";case 77:return"DIMTAD";case 140:return"DIMTXT";case 144:return"DIMLFAC";case 147:return"DIMGAP";case 176:return"DIMCLRD";case 178:return"DIMCLRT";case 271:return"DIMDEC";case 341:return"DIMLDRBLK";default:return null}}var nw=class{constructor(){this.ForEntityName="LINE"}parseEntity(e,t){let r={type:t.value,vertices:[]};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:r.vertices.unshift(Wt(e)),t=e.lastReadGroup;break;case 11:r.vertices.push(Wt(e)),t=e.lastReadGroup;break;case 210:r.extrusionDirection=Wt(e),t=e.lastReadGroup;break;case 100:t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}},iw=class{constructor(){this.ForEntityName="LWPOLYLINE"}parseEntity(e,t){let r={type:t.value,vertices:[]},i=0;for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 38:r.elevation=t.value,t=e.next();break;case 39:r.thickness=t.value,t=e.next();break;case 70:r.shape=1==(1&t.value),r.hasContinuousLinetypePattern=128==(128&t.value),t=e.next();break;case 90:i=t.value,t=e.next();break;case 10:r.vertices.push(...nAt(i,e)),t=e.lastReadGroup;break;case 43:0!==t.value&&(r.constantWidth=t.value),t=e.next();break;case 210:r.extrusionDirectionX=t.value,t=e.next();break;case 220:r.extrusionDirectionY=t.value,t=e.next();break;case 230:r.extrusionDirectionZ=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}};function nAt(e,t){if(!e||e<=0)throw Error("n must be greater than 0 verticies");let r=[],i=!1,n=!1,a=t.lastReadGroup,s={};for(;!t.isEOF()&&0!==a.code&&!n;)switch(a.code){case 10:if(i){n=!0;continue}s.x=a.value,i=!0,a=t.next();break;case 20:s.y=a.value,a=t.next();break;case 30:s.z=a.value,a=t.next();break;case 40:s.startWidth=a.value,a=t.next();break;case 41:s.endWidth=a.value,a=t.next();break;case 42:0!=a.value&&(s.bulge=a.value),a=t.next();break;default:return i&&r.push(s),r}return r.push(s),i=!1,n=!1,r}var sw=class{constructor(){this.ForEntityName="MULTILEADER"}parseEntity(e,t){let r={type:t.value};function i(){for(;!e.isEOF();)switch(t.code){case 40:r.contextData.contentScale=t.value,t=e.next();break;case 10:r.contextData.contentBasePosition=Wt(e),t=e.lastReadGroup;break;case 145:r.contextData.landingGap=t.value,t=e.next();break;case 290:r.contextData.hasMText=t.value,t=e.next();break;case 304:r.contextData.defaultTextContents=t.value,t=e.next();break;case 11:r.contextData.textNormalDirection=Wt(e),t=e.lastReadGroup;break;case 12:r.contextData.textLocation=Wt(e),t=e.lastReadGroup;break;case 13:r.contextData.textDirection=Wt(e),t=e.lastReadGroup;break;case 140:r.contextData.arrowHeadSize=t.value,t=e.next();break;case 41:r.contextData.textHeight=t.value,t=e.next();break;case 42:r.contextData.textRotation=t.value,t=e.next();break;case 43:r.contextData.textWidth=t.value,t=e.next();break;case 44:default:t=e.next();break;case 45:r.contextData.textLineSpacingFactor=t.value,t=e.next();break;case 90:r.contextData.textColor=t.value,t=e.next();break;case 170:r.contextData.textLineSpacingStyle=t.value,t=e.next();break;case 171:r.contextData.textAttachment=t.value,t=e.next();break;case 172:r.contextData.textFlowDirection=t.value,t=e.next();break;case 141:r.contextData.textBackgroundScaleFactor=t.value,t=e.next();break;case 92:r.contextData.textBackgroundTransparency=t.value,t=e.next();break;case 291:r.contextData.textBackgroundColorOn=t.value,t=e.next();break;case 292:r.contextData.textBackgroundFillOn=t.value,t=e.next();break;case 293:r.contextData.textUseAutoHeight=t.value,t=e.next();break;case 173:r.contextData.textColumnType=t.value,t=e.next();break;case 142:r.contextData.textColumnWidth=t.value,t=e.next();break;case 143:r.contextData.textColumnGutterWidth=t.value,t=e.next();break;case 144:r.contextData.textColumnHeight=t.value,t=e.next();break;case 295:r.contextData.textUseWordBreak=t.value,t=e.next();break;case 296:r.contextData.hasBlock=t.value,t=e.next();break;case 341:r.contextData.blockContentId=t.value,t=e.next();break;case 14:r.contextData.blockContentNormalDirection=Wt(e),t=e.lastReadGroup;break;case 15:r.contextData.blockContentPosition=Wt(e),t=e.lastReadGroup;break;case 16:r.contextData.blockContentScale=t.value,t=e.next();break;case 46:r.contextData.blockContentRotation=t.value,t=e.next();break;case 93:r.contextData.blockContentColor=t.value,t=e.next();break;case 47:r.contextData.blockTransformationMatrix=g_e(e,47),t=e.lastReadGroup;break;case 110:r.contextData.planeOriginPoint=Wt(e),t=e.lastReadGroup;break;case 111:r.contextData.planeXAxisDirection=Wt(e),t=e.lastReadGroup;break;case 112:r.contextData.planeYAxisDirection=Wt(e),t=e.lastReadGroup;break;case 297:r.contextData.planeNormalReversed=t.value,t=e.next();break;case 301:return;case 302:n(),t=e.lastReadGroup}}function n(){let i={leaderLines:[]};for(r.contextData.leaders.push(i);!e.isEOF();)switch(t.code){case 290:i.hasSetLastLeaderLinePoint=t.value,t=e.next();break;case 291:i.hasSetDoglegVector=t.value,t=e.next();break;case 10:i.lastLeaderLinePoint=Wt(e),t=e.lastReadGroup;break;case 11:i.doglegVector=Wt(e),t=e.lastReadGroup;break;case 90:i.leaderBranchIndex=t.value,t=e.next();break;case 40:i.doglegLength=t.value,t=e.next();break;case 303:return;case 304:a(),t=e.lastReadGroup;break;default:t=e.next()}}function a(){let i={vertices:[[]]};for(r.contextData.leaders[r.contextData.leaders.length-1].leaderLines.push(i);!e.isEOF();)switch(t.code){case 10:i.vertices[0].push(Wt(e)),t=e.lastReadGroup;break;case 305:return;default:t=e.next()}}return r.contextData={leaders:[]},t=e.next(),function(){for(;!e.isEOF();)switch(t.code){case 0:return;case 340:r.leaderStyleId=t.value,t=e.next();break;case 170:r.leaderLineType=t.value,t=e.next();break;case 91:r.leaderLineColor=t.value,t=e.next();break;case 341:r.leaderLineTypeId=t.value,t=e.next();break;case 171:r.leaderLineWeight=t.value,t=e.next();break;case 41:r.doglegLength=t.value,t=e.next();break;case 290:r.enableLanding=t.value,t=e.next();break;case 291:r.enableDogLeg=t.value,t=e.next();break;case 342:r.arrowHeadId=t.value,t=e.next();break;case 42:r.arrowHeadSize=t.value,t=e.next();break;case 172:r.contentType=t.value,t=e.next();break;case 173:case 95:r.textLeftAttachmentType=t.value,t=e.next();break;case 174:r.textAngleType=t.value,t=e.next();break;case 175:r.textAlignmentType=t.value,t=e.next();break;case 343:r.textStyleId=t.value,t=e.next();break;case 92:r.textColor=t.value,t=e.next();break;case 292:r.enableFrameText=t.value,t=e.next();break;case 344:r.blockContentId=t.value,t=e.next();break;case 93:r.blockContentColor=t.value,t=e.next();break;case 10:r.blockContentScale=Wt(e),t=e.lastReadGroup;break;case 43:r.blockContentRotation=t.value,t=e.next();break;case 176:r.blockContentConnectionType=t.value,t=e.next();break;case 293:r.enableAnotationScale=t.value,t=e.next();break;case 94:r.arrowHeadIndex=t.value,t=e.next();break;case 177:r.blockAttributeIndex=t.value,t=e.next();break;case 44:r.blockAttributeWidth=t.value,t=e.next();break;case 302:r.blockAttributeTextString=t.value,t=e.next();break;case 294:r.textDirectionNegative=t.value,t=e.next();break;case 178:r.textAlignInIPE=t.value,t=e.next();break;case 179:r.textAttachmentPoint=t.value,t=e.next();break;case 271:r.textAttachmentDirectionMText=t.value,t=e.next();break;case 272:r.textAttachmentDirectionBottom=t.value,t=e.next();break;case 273:r.textAttachmentDirectionTop=t.value,t=e.next();break;case 300:i(),t=e.lastReadGroup;break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}}(),r}},aw=class{constructor(){this.ForEntityName="MTEXT"}parseEntity(e,t){let r={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 3:case 1:r.text?r.text+=t.value:r.text=t.value,t=e.next();break;case 10:r.position=Wt(e),t=e.lastReadGroup;break;case 7:r.textStyle=t.value,t=e.next();break;case 44:r.lineSpaceFactor=t.value,t=e.next();break;case 11:r.directionVector=Wt(e),r.rotation=void 0,t=e.lastReadGroup;break;case 40:r.height=t.value,t=e.next();break;case 41:r.width=t.value,t=e.next();break;case 50:r.rotation=t.value,r.directionVector=void 0,t=e.next();break;case 71:r.attachmentPoint=t.value,t=e.next();break;case 72:r.drawingDirection=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}},ow=class{constructor(){this.ForEntityName="OLE2FRAME"}parseEntity(e,t){let r={type:t.value,binaryData:""};for(t=e.next();"OLE"!==t.value&&0!==t.code;)switch(t.code){case 3:r.documentType=t.value,t=e.next();break;case 70:r.version=t.value,t=e.next();break;case 10:r.leftUpX=t.value,t=e.next();break;case 20:r.leftUpY=t.value,t=e.next();break;case 30:r.leftUpZ=t.value,t=e.next();break;case 11:r.rightDownX=t.value,t=e.next();break;case 21:r.rightDownY=t.value,t=e.next();break;case 31:r.rightDownZ=t.value,t=e.next();break;case 90:r.lengthOfBinaryData=t.value,t=e.next();break;case 310:r.binaryData+=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}},lw=class{constructor(){this.ForEntityName="POINT"}parseEntity(e,t){let r={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:r.position=Wt(e),t=e.lastReadGroup;break;case 39:r.thickness=t.value,t=e.next();break;case 210:r.extrusionDirection=Wt(e),t=e.lastReadGroup;break;case 100:t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}},cw=class{constructor(){this.ForEntityName="VERTEX"}parseEntity(e,t){var r={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:r.x=t.value,t=e.next();break;case 20:r.y=t.value,t=e.next();break;case 30:r.z=t.value,t=e.next();break;case 40:case 41:case 50:t=e.next();break;case 42:0!=t.value&&(r.bulge=t.value),t=e.next();break;case 70:r.curveFittingVertex=0!=(1&t.value),r.curveFitTangent=0!=(2&t.value),r.splineVertex=0!=(8&t.value),r.splineControlPoint=0!=(16&t.value),r.threeDPolylineVertex=0!=(32&t.value),r.threeDPolylineMesh=0!=(64&t.value),r.polyfaceMeshVertex=0!=(128&t.value),t=e.next();break;case 71:r.faceA=t.value,t=e.next();break;case 72:r.faceB=t.value,t=e.next();break;case 73:r.faceC=t.value,t=e.next();break;case 74:r.faceD=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}},uw=class{constructor(){this.ForEntityName="POLYLINE"}parseEntity(e,t){var r={type:t.value,vertices:[]};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:case 20:case 30:case 40:case 41:case 71:case 72:case 73:case 74:case 75:t=e.next();break;case 39:t=e.next(),r.thickness=t.value;break;case 70:r.shape=0!=(1&t.value),r.includesCurveFitVertices=0!=(2&t.value),r.includesSplineFitVertices=0!=(4&t.value),r.is3dPolyline=0!=(8&t.value),r.is3dPolygonMesh=0!=(16&t.value),r.is3dPolygonMeshClosed=0!=(32&t.value),r.isPolyfaceMesh=0!=(64&t.value),r.hasContinuousLinetypePattern=0!=(128&t.value),t=e.next();break;case 210:r.extrusionDirection=Wt(e),t=e.lastReadGroup;break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r.vertices=iAt(e,t),r}};function iAt(e,t){let r=new cw,i=[];for(;!e.isEOF();)if(0===t.code)if("VERTEX"===t.value)i.push(r.parseEntity(e,t)),t=e.lastReadGroup;else if("SEQEND"===t.value){sAt(e,t);break}return i}function sAt(e,t){let r={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)if(101===t.code)for(;0!=t.code;)t=e.next();else Gr(r,t),t=e.next();return r}var hw=class{constructor(){this.ForEntityName="RAY"}parseEntity(e,t){let r={type:t.value,vertices:[]};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:r.vertices.unshift(Wt(e)),t=e.lastReadGroup;break;case 11:r.directionVector=Wt(e),t=e.lastReadGroup;break;case 100:t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}},dw=class{constructor(){this.ForEntityName="REGION"}parseEntity(e,t){let r={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 70:r.modelerVersion=t.value,t=e.next();break;case 1:r.proprietaryData=t.value,t=e.next();break;case 3:r.proprietaryData+=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}},fw=class{constructor(){this.ForEntityName="SEQEND"}parseEntity(e,t){let r={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)if(-2===t.code);else Gr(r,t),t=e.next();return r}},pw=class{constructor(){this.ForEntityName="SOLID"}parseEntity(e,t){let r={type:t.value,points:[]};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:r.points[0]=Wt(e),t=e.lastReadGroup;break;case 11:r.points[1]=Wt(e),t=e.lastReadGroup;break;case 12:r.points[2]=Wt(e),t=e.lastReadGroup;break;case 13:r.points[3]=Wt(e),t=e.lastReadGroup;break;case 210:r.extrusionDirection=Wt(e),t=e.lastReadGroup;break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}},mw=class{constructor(){this.ForEntityName="SPLINE"}parseEntity(e,t){let r={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:r.controlPoints||(r.controlPoints=[]),r.controlPoints.push(Wt(e)),t=e.lastReadGroup;break;case 11:r.fitPoints||(r.fitPoints=[]),r.fitPoints.push(Wt(e)),t=e.lastReadGroup;break;case 12:r.startTangent=Wt(e),t=e.lastReadGroup;break;case 13:r.endTangent=Wt(e),t=e.lastReadGroup;break;case 40:r.knotValues||(r.knotValues=[]),r.knotValues.push(t.value),t=e.next();break;case 70:1&t.value&&(r.closed=!0),2&t.value&&(r.periodic=!0),4&t.value&&(r.rational=!0),8&t.value&&(r.planar=!0),16&t.value&&(r.planar=!0,r.linear=!0),t=e.next();break;case 71:r.degreeOfSplineCurve=t.value,t=e.next();break;case 72:r.numberOfKnots=t.value,t=e.next();break;case 73:r.numberOfControlPoints=t.value,t=e.next();break;case 74:r.numberOfFitPoints=t.value,t=e.next();break;case 210:r.normalVector=Wt(e),t=e.lastReadGroup;break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}},gw=class{constructor(){this.ForEntityName="ACAD_TABLE"}parseEntity(e,t){let r={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:r.startPoint=Wt(e),t=e.lastReadGroup;break;case 11:r.directionVector=Wt(e),t=e.lastReadGroup;break;case 90:r.tableValue=t.value,t=e.next();break;case 91:r.rowCount=t.value,t=e.next();break;case 92:r.columnCount=t.value,t=e.next();break;case 93:r.overrideFlag=t.value,t=e.next();break;case 94:r.borderColorOverrideFlag=t.value,t=e.next();break;case 95:r.borderLineWeightOverrideFlag=t.value,t=e.next();break;case 96:r.borderVisibilityOverrideFlag=t.value,t=e.next();break;case 141:r.rowHeightArr?r.rowHeightArr.push(t.value):r.rowHeightArr=[t.value],t=e.next();break;case 142:r.columnWidthArr?r.columnWidthArr.push(t.value):r.columnWidthArr=[t.value],t=e.next();break;case 280:r.version=t.value,t=e.next();break;case 342:r.tableStyleId=t.value,t=e.next();break;case 343:r.blockRecordHandle=t.value,t=e.next();break;case 171:r.cells?r.cells.push(T_e(t,e)):r.cells=[T_e(t,e)],t=e.lastReadGroup;break;default:console.log(t.code,t.value),Gr(r,t),t=e.next()}return r}};function T_e(e,t){let r=!1,i=!1,n={};for(;!t.isEOF()&&0!==e.code&&!i;)switch(e.code){case 171:if(r){i=!0;continue}n.cellType=e.value,r=!0,e=t.next();break;case 172:n.flagValue=e.value,e=t.next();break;case 173:n.mergedValue=e.value,e=t.next();break;case 174:n.autoFit=e.value,e=t.next();break;case 175:n.borderWidth=e.value,e=t.next();break;case 176:n.borderHeight=e.value,e=t.next();break;case 91:n.overrideFlag=e.value,e=t.next();break;case 178:n.virtualEdgeFlag=e.value,e=t.next();break;case 145:n.rotation=e.value,e=t.next();break;case 345:n.fieldObjetId=e.value,e=t.next();break;case 340:n.blockTableRecordId=e.value,e=t.next();break;case 146:n.blockScale=e.value,e=t.next();break;case 177:n.blockAttrNum=e.value,e=t.next();break;case 7:n.textStyle=e.value,e=t.next();break;case 140:n.textHeight=e.value,e=t.next();break;case 170:n.attachmentPoint=e.value,e=t.next();break;case 92:n.extendedCellFlags=e.value,e=t.next();break;case 301:aAt(e,n,t),e=t.next();break;default:return n}return r=!1,i=!1,n}function aAt(e,t,r){for(;304!==e.code;)switch(e.code){case 301:case 93:case 90:case 94:e=r.next();break;case 1:t.text=e.value,e=r.next();break;case 300:t.attrText=e.value,e=r.next();break;case 302:t.text=e.value?e.value:t.text,e=r.next();break;default:console.log(`[DXF ACAD_TABLE] ignore code: ${e.code}, value: ${e.value}`),e=r.next()}}var vw=class{constructor(){this.ForEntityName="TEXT"}parseEntity(e,t){let r={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:r.startPoint=Wt(e),t=e.lastReadGroup;break;case 11:r.endPoint=Wt(e),t=e.lastReadGroup;break;case 40:r.textHeight=t.value,t=e.next();break;case 41:r.xScale=t.value,t=e.next();break;case 50:r.rotation=t.value,t=e.next();break;case 1:r.text=t.value,t=e.next();break;case 72:r.halign=t.value,t=e.next();break;case 73:r.valign=t.value,t=e.next();break;case 7:r.textStyle=t.value,t=e.next();break;case 71:r.mirrored=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}},yw=class{constructor(){this.ForEntityName="VIEWPORT"}parseEntity(e,t){let r={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 68:r.viewportStatus=t.value,t=e.next();break;case 40:r.width_paperSpace=t.value,t=e.next();break;case 41:r.height_paperSpace=t.value,t=e.next();break;case 69:r.viewportId=t.value,t=e.next();break;case 10:r.centerPoint=Wt(e),t=e.lastReadGroup;break;case 12:r.centerPoint_dcs=Wt(e),t=e.lastReadGroup;break;case 13:r.snapBasePoint_dcs=Wt(e),t=e.lastReadGroup;break;case 14:r.snapSpacing_dcs=Wt(e),t=e.lastReadGroup;break;case 15:r.gridSpacing_dcs=Wt(e),t=e.lastReadGroup;break;case 16:r.viewDirection=Wt(e),t=e.lastReadGroup;break;case 17:r.viewTarget=Wt(e),t=e.lastReadGroup;break;case 42:r.perspectiveLens=t.value,t=e.next();break;case 43:r.frontClippingPlaneZ=t.value,t=e.next();break;case 44:r.backClippingPlaneZ=t.value,t=e.next();break;case 45:r.viewHeight=t.value,t=e.next();break;case 50:r.snapAngle=t.value,t=e.next();break;case 51:r.viewTwistAngle=t.value,t=e.next();break;case 72:r.circleZoomPercent=t.value,t=e.next();break;case 331:r.frozenLayerHandles=r.frozenLayerHandles||[],r.frozenLayerHandles.push(t.value),t=e.next();break;case 90:r.viewportStatusFlags=t.value,t=e.next();break;case 340:r.viewportClippingBoundaryhandleId=t.value,t=e.next();break;case 1:r.plotStyleSheetName=t.value,t=e.next();break;case 281:r.renderMode=t.value,t=e.next();break;case 71:r.viewportFlag_ucs=t.value,t=e.next();break;case 74:r.ucsIcon=t.value,t=e.next();break;case 110:r.ucsOrigin=Wt(e),t=e.lastReadGroup;break;case 111:r.ucsXAxis=Wt(e),t=e.lastReadGroup;break;case 112:r.ucsYAxis=Wt(e),t=e.lastReadGroup;break;case 345:r.ucsTableRecordHandle=t.value,t=e.next();break;case 346:r.baseUcsTableRecordHandle=t.value,t=e.next();break;case 79:r.orthographicType=t.value,t=e.next();break;case 146:r.elevation=t.value,t=e.next();break;case 170:r.shadePlotMode=t.value,t=e.next();break;case 61:r.frequency=t.value,t=e.next();break;case 292:r.lightingFlag=t.value,t=e.next();break;case 282:r.lightingType=t.value,t=e.next();break;case 141:r.viewBrightness=t.value,t=e.next();break;case 142:r.viewContrast=t.value,t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}},bw=class{constructor(){this.ForEntityName="XLINE"}parseEntity(e,t){let r={type:t.value,vertices:[]};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 10:r.vertices.unshift(Wt(e)),t=e.lastReadGroup;break;case 11:r.directionVector=Wt(e),t=e.lastReadGroup;break;case 100:t=e.next();break;case 101:for(;0!=t.code;)t=e.next();break;default:Gr(r,t),t=e.next()}return r}},dI=class{constructor(){this.ForObjectName="DICTIONARY"}parseObject(e,t){let r={type:t.value},i=[],n=[];for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 280:r.isHardOwner=1===t.value,t=e.next();break;case 281:r.cloningFlag=t.value,t=e.next();break;case 3:i.push(t.value),t=e.next();break;case 350:case 360:n.push(t.value),t=e.next();break;case 100:case 102:t=e.next();break;default:Ic(r,t),t=e.next()}if(i.length!==n.length)throw new Error("The number of Dictionary entries does not match !");return r.entries={},i.forEach(((e,t)=>{r.entries[n[t]]=e})),r}},fI=class{constructor(){this.ForObjectName="IMAGEDEF"}parseObject(e,t){let r={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 90:r.classVersion=t.value,t=e.next();break;case 1:r.filename=t.value,t=e.next();break;case 10:r.imageSize=Wt(e),t=e.next();break;case 11:r.pixelSize=Wt(e),t=e.next();break;case 280:r.loaded=t.value,t=e.next();break;case 281:r.resolutionUnits=t.value,t=e.next();break;default:Ic(r,t),t=e.next()}return r}},pI=class{constructor(){this.ForObjectName="LAYOUT"}parseObject(e,t){let r={type:t.value};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 100:t=e.next();break;case 1:r.layoutName=t.value,t=e.next();break;case 70:r.flag=t.value,t=e.next();break;case 71:r.tabOrder=t.value,t=e.next();break;case 76:r.orthographicType=t.value,t=e.next();break;case 10:r.minLimit=Wt(e),t=e.lastReadGroup;break;case 11:r.maxLimit=Wt(e),t=e.lastReadGroup;break;case 12:r.basePoint=Wt(e),t=e.lastReadGroup;break;case 13:r.origin=Wt(e),t=e.lastReadGroup;break;case 14:r.minExtent=Wt(e),t=e.lastReadGroup;break;case 15:r.maxExtent=Wt(e),t=e.lastReadGroup;break;case 16:r.XAxis=Wt(e),t=e.lastReadGroup;break;case 17:r.YAxis=Wt(e),t=e.lastReadGroup;break;case 146:r.elevation=t.value,t=e.next();break;case 331:r.viewportHandle=t.value,t=e.next();break;default:Ic(r,t),t=e.next()}return r.blockTableHandle=r.ownerHandle,r}},mI=class{constructor(){this.ForObjectName="SORTENTSTABLE"}parseObject(e,t){let r={type:t.value},i=!1;r.sortEntsObject={},r.sortEntsObject.entityHandles=[];let n=[];for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 5:i?(n.push(t.value),r.sortEntsObject.entityHandles.push(n),n=[]):r.handle=t.value,t=e.next();break;case 100:t=e.next(),i=!0;break;case 102:t=e.next();break;case 330:i?r.sortEntsObject.ownerHandle=t.value:r.ownerHandle=t.value,t=e.next();break;case 331:n.push(t.value),t=e.next();break;default:Ic(r,t),t=e.next()}return r}},gI=class{constructor(){this.ForObjectName="SPATIAL_FILTER"}parseObject(e,t){let r,i,n={type:t.value};for(n.vertices=[],t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 11:n.origin=Wt(e),t=e.lastReadGroup;break;case 70:n.numberOfPointsOnClipBoundary=t.value,2===n.numberOfPointsOnClipBoundary?(t=e.next(),r=Wt(e),t=e.lastReadGroup,i=Wt(e),t=e.lastReadGroup,n.vertices.push(r,{x:i.x,y:r.y},i,{x:r.x,y:i.y},r)):n.numberOfPointsOnClipBoundary>2?(n.vertices=oAt(n.numberOfPointsOnClipBoundary,e),t=e.lastReadGroup):t=e.next();break;case 71:n.clipBoundaryVisible=1===t.value,t=e.next();break;case 72:n.frontClippingPlaneFlag=1===t.value,t=e.next(),n.frontClippingPlaneFlag&&40===t.code&&(n.frontClippingPlaneDistance=t.value,t=e.next());break;case 73:n.backClippingPlaneFlag=1===t.value,t=e.next(),n.backClippingPlaneFlag&&41===t.code&&(n.backClippingPlaneDistance=t.value,t=e.next());break;case 100:case 102:t=e.next();break;case 210:n.extrusionDirectionX=t.value,t=e.next();break;case 220:n.extrusionDirectionY=t.value,t=e.next();break;case 230:n.extrusionDirectionZ=t.value,t=e.next();break;case 40:n.invertBlockMatrix=w_e(e,40),n.matrix=w_e(e,40),t=e.lastReadGroup;break;default:Ic(n,t),t=e.next()}return n}};function oAt(e,t){t.next();let r=[];for(;r.length<e;)r.push(Wt(t));return r}function w_e(e,t){let r=e.lastReadGroup,i=[];for(let n=0;n<12;n++){if(r.code!==t)throw new Error(`Expected code for matrix value to be ${t} but got ${r.code}`);i.push(r.value),r=e.next()}return i}var vI=class{constructor(){this.ForObjectName="XRECORD"}parseObject(e,t){let r={type:t.value,binaryData:""};for(t=e.next();!e.isEOF()&&0!==t.code;)switch(t.code){case 100:case 311:t=e.next();break;case 280:r.cloningFlag=t.value,t=e.next();break;case 310:r.binaryData+=t.value,t=e.next();break;default:Ic(r,t),t=e.next()}return r}};function lAt(e){e.registerEntityHandler(WT),e.registerEntityHandler(XT),e.registerEntityHandler(YT),e.registerEntityHandler($T),e.registerEntityHandler(ZT),e.registerEntityHandler(KT),e.registerEntityHandler(sw),e.registerEntityHandler(JT),e.registerEntityHandler(QT),e.registerEntityHandler(ew),e.registerEntityHandler(tw),e.registerEntityHandler(rw),e.registerEntityHandler(nw),e.registerEntityHandler(iw),e.registerEntityHandler(aw),e.registerEntityHandler(ow),e.registerEntityHandler(lw),e.registerEntityHandler(uw),e.registerEntityHandler(dw),e.registerEntityHandler(hw),e.registerEntityHandler(fw),e.registerEntityHandler(pw),e.registerEntityHandler(mw),e.registerEntityHandler(gw),e.registerEntityHandler(vw),e.registerEntityHandler(yw),e.registerEntityHandler(bw)}function cAt(e){e.registerObjectHandler(dI),e.registerObjectHandler(fI),e.registerObjectHandler(pI),e.registerObjectHandler(mI),e.registerObjectHandler(gI),e.registerObjectHandler(vI)}function uAt(e){let t=new Mc(e).readBytes(22),r="";for(let e=0;e<18;e++)r+=String.fromCharCode(t[e]);return"AutoCAD Binary DXF"===r}var _0=class{constructor(e){this._entityHandlers={},this._objectHandlers={},this._layoutBlocks={},this.unhandledSections={},this.unhandledObjects={},this.unhandledEntities={},this.unsupportedLineTypes={},this.encoding=e,lAt(this),cAt(this)}parse(e){if("string"==typeof e){let t=this.splitByLineSeparator(e),r=new ab(t);return this._parse(r)}{let t;if(uAt(e))t=new jT(e);else{let r=new TextDecoder(this.encoding).decode(e),i=Date.now(),n=this.splitByLineSeparator(r);de.info(`[DxfParser] string.split costed ${(Date.now()-i)/1e3}s, it is avoidable by using dxf in binary.`),t=new ab(n)}return this._parse(t)}}registerEntityHandler(e){let t=new e;this._entityHandlers[t.ForEntityName]=t}registerObjectHandler(e){let t=new e;this._objectHandlers[t.ForObjectName]=t}parseSync(e){return this.parse(e)}parseStream(e){let t="",r=this;return new Promise(((i,n)=>{e.on("data",(e=>{t+=e})),e.on("end",(()=>{try{i(r.parse(t))}catch(e){n(e)}})),e.on("error",(e=>{n(e)}))}))}_parse(e){let t={},r=0;if(!e.hasNext())throw Error("Empty file");let i,n=this;function a(){let t=null,r=null,n={};for(i=e.next();;){if(Fl(i,0,"ENDSEC")){t&&(n[t]=r);break}9===i.code?(t&&(n[t]=r),t=i.value):10===i.code?r={x:i.value}:20===i.code?r.y=i.value:30===i.code?r.z=i.value:r=i.value,i=e.next()}return i=e.next(),n}function s(){let t={};for(i=e.next();"EOF"!==i.value&&!Fl(i,0,"ENDSEC");)if(Fl(i,0,"BLOCK")){de.trace("block {");let e=o();de.trace("}"),m(e),e.name?t[e.name]=e:de.error(`[DxfParser] Block with handle '${e.handle}' is missing a name, ignored!`)}else pf(i),i=e.next();return t}function o(){let t={};for(i=e.next();"EOF"!==i.value;){switch(i.code){case 1:t.xrefPath=i.value,i=e.next();break;case 2:t.name=i.value,i=e.next();break;case 3:t.name2=i.value,i=e.next();break;case 4:t.description=i.value,i=e.next();break;case 5:t.handle=i.value,i=e.next();break;case 8:t.layer=i.value,i=e.next();break;case 10:t.position=f(i),i=e.lastReadGroup;break;case 67:t.paperSpace=!(!i.value||1!==i.value),i=e.next();break;case 70:t.blockType=i.value,i=e.next();break;case 100:i=e.next();break;case 330:t.ownerHandle=i.value,i=e.next();break;case 0:if("ENDBLK"==i.value)break;t.entities=d(!0);break;default:pf(i),i=e.next()}if(Fl(i,0,"ENDBLK")){i=e.next();break}}return t}function l(){let t={};for(i=e.next();"EOF"!==i.value&&!Fl(i,0,"ENDSEC");)Fl(i,0,"TABLE")?(i=e.next(),u[i.value]?(de.trace(i.value+" Table {"),t[u[i.value].tableName]=c(i),de.trace("}")):de.trace("Unhandled Table "+i.value)):i=e.next();return i=e.next(),t}let h="ENDTAB";function c(t){let r=u[t.value],n={},a=0;for(i=e.next();!Fl(i,0,h);)switch(i.code){case 5:n.handle=i.value,i=e.next();break;case 330:n.ownerHandle=i.value,i=e.next();break;case 100:"AcDbSymbolTable"===i.value||pf(i),i=e.next();break;case 70:a=i.value,i=e.next();break;case 0:i.value===r.dxfSymbolName?n[r.tableRecordsProperty]=r.parseTableRecords():(pf(i),i=e.next());break;default:pf(i),i=e.next()}let s=n[r.tableRecordsProperty];if(s){let e=s.constructor===Array?s.length:"object"==typeof s?Object.keys(s).length:void 0;a!==e&&de.warn(`[DxfParser] Parsed ${e} ${r.dxfSymbolName}s but expected ${a}`)}return i=e.next(),n}let u={VPORT:{tableRecordsProperty:"viewports",tableName:"viewport",dxfSymbolName:"VPORT",parseTableRecords:function(){let t=[],r={};for(de.trace("Viewport {"),i=e.next();!Fl(i,0,h);)switch(i.code){case 2:r.name=i.value,i=e.next();break;case 10:r.lowerLeftCorner=f(i),i=e.lastReadGroup;break;case 11:r.upperRightCorner=f(i),i=e.lastReadGroup;break;case 12:r.center=f(i),i=e.lastReadGroup;break;case 13:r.snapBasePoint=f(i),i=e.lastReadGroup;break;case 14:r.snapSpacing=f(i),i=e.lastReadGroup;break;case 15:r.gridSpacing=f(i),i=e.lastReadGroup;break;case 16:r.viewDirectionFromTarget=f(i),i=e.lastReadGroup;break;case 17:r.viewTarget=f(i),i=e.lastReadGroup;break;case 40:case 45:r.viewHeight=i.value,i=e.next();break;case 41:r.aspectRatio=i.value,i=e.next();break;case 42:r.lensLength=i.value,i=e.next();break;case 43:r.frontClippingPlane=i.value,i=e.next();break;case 44:r.backClippingPlane=i.value,i=e.next();break;case 50:r.snapRotationAngle=i.value,i=e.next();break;case 51:r.viewTwistAngle=i.value,i=e.next();break;case 79:r.orthographicType=i.value,i=e.next();break;case 110:r.ucsOrigin=f(i),i=e.lastReadGroup;break;case 111:r.ucsXAxis=f(i),i=e.lastReadGroup;break;case 112:r.ucsYAxis=f(i),i=e.lastReadGroup;break;case 281:r.renderMode=i.value,i=e.next();break;case 282:r.defaultLightingType=i.value,i=e.next();break;case 292:r.defaultLightingOn=i.value,i=e.next();break;case 330:r.ownerHandle=i.value,i=e.next();break;case 63:case 421:case 431:r.ambientColor=i.value,i=e.next();break;case 0:"VPORT"===i.value&&(de.trace("}"),t.push(r),de.trace("Viewport {"),r={},i=e.next());break;default:pf(i),i=e.next()}return de.trace("}"),t.push(r),t}},LTYPE:{tableRecordsProperty:"lineTypes",tableName:"lineType",dxfSymbolName:"LTYPE",parseTableRecords:function(){let t={},r={},a=0,s="",o=!1;for(de.trace("LType {"),i=e.next();!Fl(i,0,"ENDTAB");)switch(i.code){case 2:r.name=i.value.toUpperCase(),s=r.name,i=e.next();break;case 3:r.description=i.value,i=e.next();break;case 9:case 44:case 45:case 46:case 70:case 75:default:i=e.next();break;case 40:r.patternLength=i.value,i=e.next();break;case 49:let l=i.value;o&&(l=Math.abs(l),o=!1),r.pattern.push(l),i=e.next();break;case 73:a=i.value,a>0&&(r.pattern=[]),i=e.next();break;case 74:0!==i.value&&(o=!0,n.unsupportedLineTypes[r.name]?n.unsupportedLineTypes[r.name]++:n.unsupportedLineTypes[r.name]=1),i=e.next();break;case 0:de.trace("}"),a>0&&a!==r.pattern.length&&de.warn("[DxfParser] lengths do not match on LTYPE pattern"),t[s]=r,r={},de.trace("LType {"),i=e.next()}return de.trace("}"),t[s]=r,t}},LAYER:{tableRecordsProperty:"layers",tableName:"layer",dxfSymbolName:"LAYER",parseTableRecords:function(){let t,r={},n={};for(de.trace("Layer {"),i=e.next();!Fl(i,0,"ENDTAB");)switch(i.code){case 2:n.name=i.value,t=i.value,i=e.next();break;case 5:n.handle=i.value,i=e.next();break;case 62:n.visible=i.value>=0,n.colorIndex=Math.abs(i.value),n.color=hAt(n.colorIndex),i=e.next();break;case 70:n.flag=i.value,n.frozen=(1&n.flag)>0,i=e.next();break;case 420:n.color=Math.abs(i.value),i=e.next();break;case 6:n.lineType=i.value.toUpperCase(),i=e.next();break;case 370:n.lineweight=i.value,i=e.next();break;case 0:"LAYER"===i.value&&(de.trace("}"),t&&(r[t]=n),de.trace("Layer {"),n={},t=void 0,i=e.next());break;default:pf(i),i=e.next()}return de.trace("}"),t&&(r[t]=n),r}},BLOCK_RECORD:{tableRecordsProperty:"blockRecords",tableName:"blockRecord",dxfSymbolName:"BLOCK_RECORD",parseTableRecords:function(){let t,r={},a={};for(de.trace("BlockRecord {"),i=e.next();!Fl(i,0,"ENDTAB");)switch(i.code){case 5:a.handle=i.value,i=e.next();break;case 330:a.ownerHandle=i.value,i=e.next();break;case 2:a.blockName=i.value,t=a.blockName,i=e.next();break;case 340:a.layoutHandle=i.value,i=e.next();break;case 70:a.blockInsertUnits=i.value,i=e.next();break;case 280:a.blockExplodability=i.value,i=e.next();break;case 281:a.blockScalability=i.value,i=e.next();break;case 310:a.bitmap=i.value,i=e.next();break;case 0:if("BLOCK_RECORD"===i.value){de.trace("}"),t&&(r[t]=a);let s=a.layoutHandle;t&&s&&s.length>0&&"0"!==s&&(n._layoutBlocks[s]=a),de.trace("BlockRecord {"),a={},t=void 0,i=e.next()}else pf(i),i=e.next();break;default:pf(i),i=e.next()}de.trace("}"),t&&(r[t]=a);let s=a.layoutHandle;return t&&s&&s.length>0&&"0"!==s&&(n._layoutBlocks[s]=a),r}},STYLE:{tableRecordsProperty:"styles",tableName:"style",dxfSymbolName:"STYLE",parseTableRecords:function(){let t,r={},n={};for(de.trace("Style {"),i=e.next();!Fl(i,0,"ENDTAB");)switch(i.code){case 2:n.styleName=i.value,t=i.value,i=e.next();break;case 3:n.fontFile=i.value,i=e.next();break;case 4:n.bigFontFile=i.value,i=e.next();break;case 5:n.handle=i.value,i=e.next();break;case 40:n.textHeight=i.value,i=e.next();break;case 41:n.xScale=i.value,i=e.next();break;case 42:n.priorTextHeight=i.value,i=e.next();break;case 50:n.rotation=i.value,i=e.next();break;case 70:default:i=e.next();break;case 71:n.mirrorType=i.value,i=e.next();break;case 330:n.ownerHandle=i.value,i=e.next();break;case 0:"STYLE"===i.value&&(de.trace("}"),t&&(r[t]=n),de.trace("Style {"),n={},t=void 0,i=e.next())}return de.trace("}"),t&&(r[t]=n),r}},DIMSTYLE:{tableRecordsProperty:"dimStyles",tableName:"dimStyle",dxfSymbolName:"DIMSTYLE",parseTableRecords:function(){let t,r={},n={};for(de.trace("DimStyle {"),i=e.next();!Fl(i,0,"ENDTAB");)switch(i.code){case 2:n.styleName=i.value,t=i.value,i=e.next();break;case 40:n.DIMSCALE=i.value,i=e.next();break;case 41:n.DIMASZ=i.value,i=e.next();break;case 42:n.DIMEXO=i.value,i=e.next();break;case 44:n.DIMEXE=i.value,i=e.next();break;case 75:n.DIMSE1=i.value,i=e.next();break;case 76:n.DIMSE2=i.value,i=e.next();break;case 77:n.DIMTAD=i.value,i=e.next();break;case 140:n.DIMTXT=i.value,i=e.next();break;case 144:n.DIMLFAC=i.value,i=e.next();break;case 147:n.DIMGAP=i.value,i=e.next();break;case 176:n.DIMCLRD=i.value,i=e.next();break;case 178:n.DIMCLRT=i.value,i=e.next();break;case 271:n.DIMDEC=i.value,i=e.next();break;case 341:n.DIMLDRBLK=i.value,i=e.next();break;case 70:default:i=e.next();break;case 0:"DIMSTYLE"===i.value&&(de.trace("}"),t&&(r[t]=n),de.trace("DimStyle {"),n={},t=void 0,i=e.next())}return de.trace("}"),t&&(r[t]=n),r}}};function d(t){let r=[],a=t?"ENDBLK":"ENDSEC";for(t||(i=e.next());;)if(0===i.code){if(i.value===a)break;let t=n._entityHandlers[i.value];if(null==t){let t=i.value;n.unhandledEntities[t]||(n.unhandledEntities[t]=0),n.unhandledEntities[t]++,i=e.next();continue}{de.trace(i.value+" {");let n=t.parseEntity(e,i);n&&(n.layer||(n.layer="0"),void 0===n.colorIndex&&(n.colorIndex=256),n.lineType||(n.lineType=nb)),i=e.lastReadGroup,de.trace("}"),m(n),r.push(n)}}else i=e.next();return"ENDSEC"==a&&(i=e.next()),r}function p(){let t={};for(i=e.next();"EOF"!==i.value;)if(0===i.code){if("ENDSEC"===i.value)break;let r=n._objectHandlers[i.value];if(null==r){let t=i.value;n.unhandledObjects[t]||(n.unhandledObjects[t]=0),n.unhandledObjects[t]++,i=e.next();continue}{de.trace(i.value+" {");let n=r.parseObject(e,i),a=i.value;i=e.lastReadGroup,de.trace("}"),m(n),t[a]||(t[a]=[]),t[a].push(n)}}else i=e.next();return i=e.next(),t.LAYOUT&&(Object.keys(n._layoutBlocks).length!==t.LAYOUT.length&&de.warn("[DxfParser] The number of layout and block associations does not match!"),t.LAYOUT.forEach((e=>{n._layoutBlocks[e.handle]&&(e.associatedBlockName=n._layoutBlocks[e.handle].blockName)})),t.LAYOUT.sort(((e,t)=>e.tabOrder-t.tabOrder))),t}function f(t){let r={},i=t.code;if(r.x=t.value,i+=10,(t=e.next()).code!=i)throw new Error(`Expected code for point value to be ${i} but got ${t.code}.`);return r.y=t.value,i+=10,(t=e.next()).code!=i||(r.z=t.value,t=e.next()),r}function m(e){if(!e)throw new TypeError("entity cannot be undefined or null");e.handle||(e.handle=(r++).toString())}return function(){for(i=e.next();999===i.code;)i=e.next();for(;!e.isEOF();)if(0===i.code&&"SECTION"===i.value){if(i=e.next(),2!==i.code){de.error("Unexpected code %s after 0:SECTION",S_e(i)),i=e.next();continue}if("HEADER"===i.value)de.trace("> HEADER"),t.header=a(),de.trace("<");else if("TABLES"===i.value)de.trace("> TABLES"),t.tables=l(),de.trace("<");else if("BLOCKS"===i.value)de.trace("> BLOCKS"),t.blocks=s(),de.trace("<");else if("ENTITIES"===i.value)de.trace("> ENTITIES"),t.entities=d(!1),de.trace("<");else if("OBJECTS"===i.value)de.trace("> OBJECTS"),t.objects=p(),de.trace("<");else if("EOF"===i.value)de.trace("EOF");else{let e=i.value;n.unhandledSections[e]?n.unhandledSections[e]++:n.unhandledSections[e]=1}}else i=e.next();n.unhandledSections={},n.unhandledEntities={},n.unhandledObjects={},n.unsupportedLineTypes={}}(),t}splitByLineSeparator(e){let t=[],r=0;for(let i=0,n=e.length;i<n;++i){let n=e[i];if("\r"===n||"\n"===n){let a=e.substring(r,i);t.push(a),"\r"===n&&"\n"===e[i+1]&&i++,r=i+1}}return t.push(e.substring(r,e.length)),t}};function Fl(e,t,r){return e.code===t&&e.value===r}function pf(e){de.trace("unhandled group "+S_e(e))}function S_e(e){return e.code+":"+e.value}function hAt(e){return sI[e]}var Du=new F(1,0,0),MG=new F(0,1,0),ob=new F(0,0,1),M_e=new F(0,0,0),tm=16777215,dAt="CONTINUOUS",yI=new Ai({color:tm}),Fa=new Yr({color:tm}),lb=new Mr({color:tm}),A_e=(new Nt).setFromPoints([new F]),R_e=new lt,Jp=new lt,_a=new lt,Ur=new F,_i=new F,Qp=new F,xw=new Te,no=new dn,bI=new yr,em=new Vt,C_e=new Ai({color:65280,size:5,depthTest:!1}),P_e=new Ai({color:65280,depthTest:!1}),I_e=new Ai({color:65280,depthTest:!1}),fAt=e=>void 0!==e.viewDirectionFromTarget,pAt=e=>{if(e){let t=e.match(/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).*,.*/);if(t&&t.length>0){let r=t[1],i=e.replace("data:"+r+";","").split(",");if(i&&2===i.length&&"base64"===i[0]){let e=i[1];return $Ee.decode(e)}}}return null},O_e=(e,t)=>{let r=new Te(e.x,e.y),i=new Te(t.x,t.y);return i.sub(r),i.normalize(),i.y<0?-Math.acos(i.x):Math.acos(i.x)},D_e=(e,t,r)=>({x:e.x+t*Math.cos(r),y:e.y+t*Math.sin(r)}),mAt=(e,t,r,i)=>{let n=e?new Te(e.x,e.y):new Te(0,0),a=t?new Te(t.x,t.y):new Te(1,0);r=r||1;let s=4*Math.atan(r),o=n.distanceTo(a)/2/Math.sin(s/2),l=D_e(e,o,O_e(n,a)+(Math.PI/2-s/2));i=i||Math.max(Math.abs(Math.ceil(s/(Math.PI/18))),6);let h=O_e(l,n),c=s/i,u=[];u.push(new F(n.x,n.y,0));for(let e=1;e<=i-1;e++){let t=D_e(l,Math.abs(o),h+c*e);u.push(new F(t.x,t.y,0))}return u},L_e=(e,t,r,i=2*e.length,n)=>{let a=[],s=e.map((e=>[e.x,e.y]));for(let e=0;e<1;e+=1/i){let i=b_e(e,t,s,r,n);a.push(new F(i[0],i[1],0))}return a},AG=(e,t=!1)=>{let r=[],i=e.length;for(let n=0;n<i;n++){let a=e[n];if(a.bulge&&(n!==i-1||t)){let t=a.bulge,s=n+1<i?e[n+1]:r[0],o=mAt(a,s,t);r.push(...o)}else r.push(new F(a.x,a.y,0))}return r},gAt=e=>{let t=[];return e.faceA&&t.push(e.faceA),e.faceB&&t.push(e.faceB),e.faceC&&t.push(e.faceC),e.faceD&&t.push(e.faceD),t},vAt=e=>{let t=[],r=[];e.forEach((e=>{e.polyfaceMeshVertex&&(e.threeDPolylineMesh?t.push(new F(e.x,e.y,e.z)):r.push(gAt(e)))}));let i=[];for(let e=0;e<r.length;e++){let n=r[e];if(0===n.length)continue;let a=[],s=!0;for(let e=0;e<n.length;e++){let r=n[e]-1;if(r>=t.length||r<0){s=!1;break}a.push(t[r])}!s||0===a.length||(a.push(a[0]),i.push(a))}return i},An=class extends Mn{constructor(e,t){super(e),this.timer=Date.now(),this.ignorePaperSpace=!1,this.encoding="UTF-8",this.angBase=0,this.angDir=0,this.header=void 0,this.pointsMaterials={},this.lineBasicMaterials={},this.lineShaderMaterials={},this.meshBasicMaterials={},this.meshTextureMaterials={},this.hatchShaderMaterials=[],this.entityCount=0,this.curveCount=0,this.averageCurveSize=0,this.enableRenderOrder=!1,this.enableLocalCache=!0,this.enableReleaseData=!1,this.enableMerge=!0,this.enableRTC=!0,this.enablePlineWidth=!0,this.dxfDataId=void 0,this.compareContext=void 0,this.statsInfo={unsupportedEntity:{},unsupportedEntityTypes:{},unsupportedTextStyles:{},unsupportedHatchPatterns:{},unsupportedPolylineCount:0,invisibleEntities:{},ignoredFrozenLayersAndEntityCount:{},ignoredInserts:{},entityTypesAndMeshCount:{},ignoredPaperSpaceEntityTypesAndCount:{},rebasedEntityCount:0},this.blockReferencesCache={},this.blockRecordsCache=void 0,this.entitiesCache=void 0,this.blocksCache=void 0,this.dictionaryOwnerHandleAndSpatialFilterHandlesCache=void 0,this.spatialFiltersCache=void 0,this.entityThreejsCache=void 0,this.entityTypesAndTimes=void 0,this.nonSnapableTypes=new Set(["ATTDEF","ATTRIB","LEADER","MTEXT","MULTILEADER","OLE2FRAME","TEXT"]),this.layoutsSnapObjectsMap={},this.aborted=!1,this.entityHandlesWithRenderOrder={},this.addViewport=(e,t)=>{if("VIEWPORT"===e.type){t[e.ownerHandle]||(t[e.ownerHandle]=[]);let r=e;t[e.ownerHandle].push(r)}},t&&(this.ignorePaperSpace=!0===t.ignorePaperSpace,this.enableLocalCache=!1!==t.enableLocalCache,this.enableMerge=!1!==t.enableMerge,this.encoding=t.encoding||"UTF-8",null!=t.overrideColor&&(this.overrideColor=Br.rgb2Hex(t.overrideColor)),null!=t.overrideHatchPatternLineThickness&&(this.overrideHatchPatternLineThickness=t.overrideHatchPatternLineThickness)),this.pointsMaterials[tm]=yI,this.lineBasicMaterials[tm]=Fa,this.meshBasicMaterials[tm]=lb}setFont(e){this.font=e}download(e,t){return bt(this,null,(function*(){let r=pAt(e);if(!r){let i=Date.now(),n=new Hn(this.manager);n.setResponseType("arraybuffer"),n.setPath(this.path),r=yield n.loadAsync(e,t),de.info(`[Dxf] ${e} dxf file downloaded in ${(Date.now()-i)/1e3}s`)}return r}))}loadEx(e,t,r){return bt(this,null,(function*(){return this.enableLocalCache&&t&&(t=t.trim()).length>0&&(this.dxfDataId=t),this.loadAsync(e,r)}))}loadAsync(e,t){return bt(this,null,(function*(){let r=Ut.getUpdateSubProgressFunc(0,50,t),i=Ut.getUpdateSubProgressFunc(50,100,t),n=Ut.getUpdateSubProgressFunc(10,100,t);if(Pn.isBrowser&&this.enableLocalCache&&this.dxfDataId){let e;try{if(this.timer=Date.now(),e=yield this.getDxfDataFromIndexedDb(this.dxfDataId),e){this.tryFixDxfData(e),de.info(`[Dxf] Loaded DxfData from indexedDb in ${(Date.now()-this.timer)/1e3}s`);let t=yield this.loadEntities(e,n);return Promise.resolve(t)}}catch(e){de.warn("[Dxf] Failed to parse data from indexedDb",e)}}let a=yield this.parse(e,r);return this.tryFixDxfData(a),yield this.loadEntities(a,i)}))}parse(e,t){return bt(this,null,(function*(){let r=Ut.getUpdateProgressFunc(t),i=Ut.getUpdateSubProgressFunc(0,40,t),n=yield this.download(e,i);if(!n)return Promise.reject(`[Dxf] Failed to download ${e}`);if(this.aborted)return Promise.reject("[Dxf] Job aborted");this.timer=Date.now(),de.info("[Dxf] Start parsing...");let a=new _0(this.encoding).parseSync(n);if(this.tryFixDxfData(a),r(80),de.info(`[Dxf] Parsed in ${(Date.now()-this.timer)/1e3}s, creating entities...`),this.aborted)return Promise.reject("[Dxf] Job aborted");if(a&&Pn.isBrowser&&this.enableLocalCache&&this.dxfDataId){let e=Date.now();try{yield this.setDxfDataToIndexedDb(this.dxfDataId,a),de.info(`[Dxf] Saved to indexedDb in ${(Date.now()-e)/1e3}s`)}catch(e){de.warn(`[Dxf] Failed to save '${this.dxfDataId}' to indexedDb!`,e)}}return r(100),a}))}abort(){this.aborted=!0}isAborted(){return this.aborted}parseHeader(e){if(!e)return void de.error("[Dxf]: Invalid header!");this.header=e;let t=e.$ACADVER.toString();"AC1032"!==t&&de.warn(`[Dxf] Unexpected version: ${t}. But we'll try to continue.`),this.angBase=e.$ANGBASE||0,this.angDir=e.$ANGDIR||0}tryFixDxfData(e){e&&(e.objects||(de.warn("[Dxf] No objects found, Will add one."),e.objects={}),e.objects.LAYOUT||(de.warn("[Dxf] No layout defined! Will add a default 'Model' layout!"),e.objects.LAYOUT=[{layoutName:An.MODEL_LAYOUT_NAME}]),e.tables||(de.warn("[Dxf] No tables found, Will add one."),e.tables={}),e.tables.layer||(e.tables.layer={}),e.tables.layer.layers||(e.tables.layer.layers={}))}loadEntities(e,t){return bt(this,null,(function*(){let r=Date.now();this.parseHeader(e.header),this.enableRenderOrder&&(this.initRenderOrderInfo(e),this.enableMerge=!1),this.getFontFilesFromDxf(e);let i=0,n=e.entities.length;this.entityCount=n,Object.keys(e.blocks).forEach((t=>{var r;this.entityCount+=(null==(r=e.blocks[t].entities)?void 0:r.length)||0}));let a=Ut.getUpdateProgressFuncForLoop(n,t),s={},o=e=>{let t=e.userData.layerName,r=s[t];r||(r=[],s[t]=r),r.push(e)},l={},h={},c=new Ar;for(let t=0;t<n&&!this.aborted;t++){let r=e.entities[t];this.addViewport(r,l);let n=this.loadEntity(r,e);if(n||(yield a(t)),!n)continue;let s=this.getLayout(e,r).layoutName,u=c.children.find((e=>e.name===s));if(u||(u=new Ar,u.name=s,u.userData.isLayoutLevelObject=!0,c.add(u)),n.traverse((e=>{e.userData.isSnapObject&&(this.layoutsSnapObjectsMap[s]||(this.layoutsSnapObjectsMap[s]=[]),this.layoutsSnapObjectsMap[s].push(e))})),this.enableMerge){Ou.merge(n,!1),h[s]||(h[s]={object:u,layerObjects:{}});let e=h[s];if(n.geometry){let t=n.userData.layerName;e.layerObjects[t]||(e.layerObjects[t]=[]),e.layerObjects[t].push(n),n.children.forEach((e=>{e.userData.isSnapObject&&o(e)}))}else n.children.length>0&&(u.add(n),n.traverse((e=>{e.geometry&&o(e)})))}else u.add(n),n.traverse((e=>{e.geometry&&o(e)}));i++,yield a(t)}e.objects.LAYOUT.forEach((t=>{let r=t,i=r.layoutName;if(this.ignorePaperSpace&&i!==An.MODEL_LAYOUT_NAME)return;let n=r.associatedBlockName,a=e.blocks[n];a&&this.loadLayout(a,e,r,c,s,l)})),de.debug(`[Dxf] Drew entities in ${(Date.now()-r)/1e3}s`);for(let t in this.layoutsSnapObjectsMap){let r=c.children.find((e=>e.name===t)),i=new Ar;i.name=An.SNAP_GROUP_NAME,i.userData.isSnapGroup=!0,r.add(i);let n=this.layoutsSnapObjectsMap[t];for(let t=0;t<n.length;t++){let r=n[t],a=r.userData.layerName;!1===this.getLayerVisible(e,a)&&r.layers.disable(11),An.SHOW_SNAP_OBJECT&&(r.layers.enableAll(),r.material instanceof Ai?r.material=C_e:r.material instanceof Yr?r.material=P_e:r.material instanceof Mr&&(r.material=I_e));let s=r,o=_a.identity();for(;s&&!0!==s.userData.isLayoutLevelObject;)o.premultiply(s.matrix),s=s.parent;r.matrix.copy(o),i.add(r)}}if(this.enableMerge)for(let e in h){let t=h[e],r=t.object;for(let e in t.layerObjects){let i=t.layerObjects[e],n=Ou.deepMerge(i,void 0,!1,!1,!0),a=n.added,s=n.removed;if(s.length!==i.length){let e=s;s.length>=100&&(e=new Set(s));let t=t=>Array.isArray(e)?e.indexOf(t)>=0:e.has(t);for(let e=0,n=i.length;e<n;e++){let n=i[e];t(n)||(r.add(n),o(n))}}for(let e=0;e<a.length;e++){let t=a[e];r.add(t),o(t)}t.layerObjects[e]=[]}}this.printStatsInfo(),this.enableReleaseData&&(this.releaseCachedData(),this.releaseDxfData(e)),this.enableMerge&&An.mergeDxfObjects({root:c,layersAndObjects:s});let u=c.convertToThreejsObject();c.clear(),s={};let d={};e.objects.LAYOUT.forEach((e=>{let t=e;d[t.layoutName]=t}));let p={};u.children.forEach((t=>{if(pn.setSharedVariablesOfObject(t),!t.userData.isLayoutLevelObject)return;let r,i=t.name;if(i!==An.MODEL_LAYOUT_NAME){let e=d[i];e.directAssociatedLeafObjectSet||(e.directAssociatedLeafObjectSet=new Set),r=e.directAssociatedLeafObjectSet}t.traverse((t=>{if(pn.setSharedVariablesOfObject(t),t.userData.isSnapGroup&&(t.visible=An.SHOW_SNAP_OBJECT),t.geometry){let i=t.userData.layerName;!1===this.getLayerVisible(e,i)&&(t.visible=!1,t.userData.layerVisible=!1),(e=>{let t=e.userData.layerName,r=p[t];r||(r=[],p[t]=r),r.push(e)})(t),r&&r.add(t)}}))})),de.info(`[Dxf] loadEntities() done in ${(Date.now()-r)/1e3}s`);let f=Ii(on({},e),{threejsObject:u,layersAndThreejsObjects:p,loadedEntityCount:i,layoutViewportsMap:l});return Promise.resolve(f)}))}getFontFilesFromDxf(e){var t,r;let i=new Set,n=null==(r=null==(t=e.tables)?void 0:t.style)?void 0:r.styles;if(n)for(let e in n){let t=n[e],r=t.fontFile,a=t.bigFontFile;r&&i.add(r),a&&i.add(a)}de.info(`[Dxf] Fonts used by dxf: ${Array.from(i).join()}`)}loadEntitiesForCompare(e,t,r,i=!0,n){return bt(this,null,(function*(){let a=e.entities.length,s=t.entities.length,o=()=>bt(this,null,(function*(){var o;let l=this.compareContext,h=l.isTheFirstFile,c=h?e:t,u=new Ar,d=h?a:s,p=c.entities.length;this.entityCount=p,Object.keys(c.blocks).forEach((e=>{var t;this.entityCount+=(null==(t=c.blocks[e].entities)?void 0:t.length)||0}));let f=Math.round(Math.pow(d,.5)),m=Date.now(),g=e=>bt(this,null,(function*(){if(n&&(e%f==0||e===d-1)){let t=e+1;h||(t+=a),n(new ProgressEvent("parseProgress",{loaded:t,total:a+s}));let r=500,i=Date.now();(i-m>r||e===d-1)&&(yield Ut.sleep(0),m=i)}}));this.parseHeader(c.header);let v={};for(let e=0;e<d;e++){if(this.aborted)return;let t=c.entities[e],r=this.getLayout(c,t);if(r.layoutName!==An.MODEL_LAYOUT_NAME){yield g(e);continue}let i=this.loadEntity(t,c);if(!i){yield g(e);continue}let n=u.children.find((e=>e.name===An.MODEL_LAYOUT_NAME));n||(n=new Ar,n.name=An.MODEL_LAYOUT_NAME,n.userData.isLayoutLevelObject=!0,u.add(n)),n.add(i),i.traverse((e=>{if(e.geometry){let t=e.userData.layerName,n=this.getLayerVisible(c,t);e.userData.isSnapObject&&(this.layoutsSnapObjectsMap[r.layoutName]||(this.layoutsSnapObjectsMap[r.layoutName]=[]),this.layoutsSnapObjectsMap[r.layoutName].push(e),!1===n&&i.layers.disable(11));let a=v[t];a||(a=[],v[t]=a),a.push(e)}})),yield g(e)}i&&h&&(l.preservedHandles||(l.preservedHandles=new Set));for(let e in r){let t=r[e];h&&("Added"===t.type||"Modified"===t.type)&&(null==(o=l.preservedHandles)||o.add(t.handle),t.parentHandles&&t.parentHandles.forEach((e=>{var t;return null==(t=l.preservedHandles)?void 0:t.add(e)})));let i=this.entityThreejsCache&&this.entityThreejsCache[t.handle];if(t.parentHandles&&(i=this.entityThreejsCache&&this.entityThreejsCache[t.parentHandles[t.parentHandles.length-1]]),i){if(i.parent&&i.parent.userData.originalType){this.setObjectColorByChange(i,{type:"NoChange"});continue}i=this.setObjectColorByChange(i,t)}if("NoChange"!==t.type&&i){let e=i.parent,r=_a.identity();for(;e&&!0!==e.userData.isLayoutLevelObject;)r.premultiply(e.matrix),e=e.parent;em.makeEmpty();let n=Ar.getBox(i,em);n.applyMatrix4(r),"Added"===t.type?!h&&(t.box=(new Vt).copy(n)):"Removed"===t.type?h&&(t.box=(new Vt).copy(n)):"Modified"===t.type&&(t.box?t.box.union(n):t.box=(new Vt).copy(n))}}for(let e in this.layoutsSnapObjectsMap){let t=u.children.find((t=>t.name===e)),r=new Ar;r.name=An.SNAP_GROUP_NAME,t.add(r);let i=this.layoutsSnapObjectsMap[e];for(let e=0;e<i.length;e++){let t=i[e];An.SHOW_SNAP_OBJECT&&(t.layers.enableAll(),t.material instanceof Ai?t.material=C_e:t.material instanceof Yr?t.material=P_e:t.material instanceof Mr&&(t.material=I_e));let n=t,a=_a.identity();for(;n&&!0!==n.userData.isLayoutLevelObject;)a.premultiply(n.matrix),n=n.parent;t.matrix.copy(a),r.add(t)}}this.enableMerge&&An.mergeDxfObjects({root:u,layersAndObjects:v});let y=u.convertToThreejsObject();u.clear(),v={};let b={};y.children.forEach((e=>{pn.setSharedVariablesOfObject(e),e.userData.isLayoutLevelObject&&e.traverse((e=>{if(pn.setSharedVariablesOfObject(e),e.userData.isSnapGroup&&(e.visible=An.SHOW_SNAP_OBJECT),e.geometry){let t=e.userData.layerName;!1===this.getLayerVisible(c,t)&&(e.visible=!1,e.userData.layerVisible=!1),(e=>{let t=e.userData.layerName,r=b[t];r||(r=[],b[t]=r),r.push(e)})(e)}}))}));let x=c;x.threejsObject=y,x.layersAndThreejsObjects=b,x.layoutViewportsMap={}})),l=Date.now();this.compareContext={changes:r,isTheFirstFile:!0},Ut.printMemory("Before loading entities for first dxf"),yield o(),de.info(`[Dxf] loadEntities for first dxf in ${(Date.now()-l)/1e3}s`),Ut.printMemory("After loading entities for first dxf"),this.releaseCachedData(!1),this.releaseDxfData(e),Ut.printMemory("Before loading entities for second dxf"),l=Date.now(),this.compareContext.isTheFirstFile=!1,yield o(),de.info(`[Dxf] loadEntities for second dxf in ${(Date.now()-l)/1e3}s`),this.printStatsInfo();for(let e of Object.values(r))e.box||delete r[e.id];this.compareContext.preservedHandles=void 0,this.enableReleaseData&&(this.releaseCachedData(),this.releaseDxfData(t)),Ut.printMemory("After loading entities for second dxf")}))}setObjectColorByChange(e,t){let r=(e,t)=>{e.traverse((e=>{if(e.material)if(e.material instanceof Yr)e.material=this.getLineBasicMaterial(t);else if(e.material instanceof Mr)e.material=this.getMeshBasicMaterial(t);else if(e.material instanceof Ai)e.material=this.getPointsMaterial(t);else if(e.material instanceof xr){let r=e.material.clone();An.updateMaterialUniforms(r),r.uniforms.u_color.value.set(t),e.material=r}}))},i=(e=>{var t;let r=Ea.ENTITY_COLOR_NO_CHANGE;return"Added"===e.type?r=Ea.ENTITY_COLOR_ADDED:"Removed"===e.type?r=Ea.ENTITY_COLOR_REMOVED:"Modified"===e.type&&(r=null!=(t=this.compareContext)&&t.isTheFirstFile?Ea.ENTITY_COLOR_REMOVED:Ea.ENTITY_COLOR_ADDED),r})(t);return e.traverse((n=>{t.parentHandles?n.userData&&n.userData.handle&&n.userData.handle===t.handle&&(r(n,i),e=n):r(n,i)})),e}releaseCachedData(e=!0){e&&(this.pointsMaterials={},this.lineBasicMaterials={},this.lineShaderMaterials={},this.meshBasicMaterials={},this.meshTextureMaterials={},this.hatchShaderMaterials=[]),this.header=void 0,this.blockReferencesCache={},this.blockRecordsCache=void 0,this.blocksCache=void 0,this.entitiesCache=void 0,this.dictionaryOwnerHandleAndSpatialFilterHandlesCache=void 0,this.spatialFiltersCache=void 0,this.entityThreejsCache=void 0,this.entityTypesAndTimes=void 0,this.entityHandlesWithRenderOrder={},this.layoutsSnapObjectsMap={},this.statsInfo={unsupportedEntity:{},unsupportedEntityTypes:{},unsupportedTextStyles:{},unsupportedHatchPatterns:{},unsupportedPolylineCount:0,invisibleEntities:{},ignoredFrozenLayersAndEntityCount:{},ignoredInserts:{},entityTypesAndMeshCount:{},ignoredPaperSpaceEntityTypesAndCount:{},rebasedEntityCount:0}}releaseEntity(e){e.vertices&&(e.vertices=void 0),e.knotValues&&(e.knotValues=void 0),e.controlPoints&&(e.controlPoints=void 0),e.binaryData&&(e.binaryData=void 0),e.text&&(e.text=void 0),e.extendedData&&(e.extendedData=void 0),e.contextData&&(e.contextData=void 0);let t=e;t.boundaryPaths&&(t.boundaryPaths=[]),t.patternLines&&(t.patternLines=void 0)}releaseDxfData(e){delete e.objects.DICTIONARY,delete e.objects.SORTENTSTABLE,delete e.objects.XRECORD,e.tables&&(delete e.tables.dimStyle,delete e.tables.lineType,delete e.tables.style,delete e.tables.blockRecord),e.entities=[],e.blocks={}}loadEntity(e,t,r,i=!1){if(this.compareContext&&this.compareContext.preservedHandles&&this.compareContext.preservedHandles.has(e.handle)&&b0.includes(e.type)&&(i=!0),!i&&this.compareContext&&this.compareContext.preservedHandles&&!b0.includes(e.type)&&!this.compareContext.preservedHandles.has(e.handle)&&(!r||r&&!this.compareContext.preservedHandles.has(r.handle)))return;if(!0===this.getLayerFrozen(t,e)){let t=e.layer;return this.statsInfo.ignoredFrozenLayersAndEntityCount[t]||(this.statsInfo.ignoredFrozenLayersAndEntityCount[t]=0),void this.statsInfo.ignoredFrozenLayersAndEntityCount[t]++}if(!1===e.visible||e.invisible)return this.statsInfo.invisibleEntities[e.type]||(this.statsInfo.invisibleEntities[e.type]=0),void this.statsInfo.invisibleEntities[e.type]++;if(this.ignorePaperSpace&&e.inPaperSpace)return this.statsInfo.ignoredPaperSpaceEntityTypesAndCount[e.type]||(this.statsInfo.ignoredPaperSpaceEntityTypesAndCount[e.type]=0),void this.statsInfo.ignoredPaperSpaceEntityTypesAndCount[e.type]++;this.entityThreejsCache||(this.entityThreejsCache={});let n,a=Date.now(),s=!1;if(!this.compareContext&&this.entityThreejsCache[e.handle])n=this.entityThreejsCache[e.handle].clone(),s=!0;else if(!this.statsInfo.unsupportedEntity[e.handle]){if("CIRCLE"===e.type||"ARC"===e.type)n=this.loadArc(e,t,r);else if("LINE"===e.type||"POLYLINE"===e.type)n=this.loadLine(e);else if("XLINE"===e.type)n=this.loadXLine(e);else if("SEQEND"!==e.type)if("RAY"===e.type)n=this.loadRay(e);else if("LWPOLYLINE"===e.type)n=this.loadLWPolyline(e,t,r);else if("3DFACE"===e.type)n=this.load3DFace(e);else if("TEXT"===e.type)n=this.loadText(e,t,r);else if("SOLID"===e.type)n=this.loadSolid(e,t,r);else if("POINT"===e.type)n=this.loadPoint(e,t,r);else if("IMAGE"===e.type)n=this.loadImage(e,t,r);else if("INSERT"===e.type)n=this.loadInsert(e,t,r,i);else if("SPLINE"===e.type)n=this.loadSpline(e,r);else if("MTEXT"===e.type)n=this.loadMText(e,t,r);else if("ELLIPSE"===e.type)n=this.loadEllipse(e,t,r);else if("DIMENSION"===e.type)n=this.loadDimension(e,t);else if("REGION"!==e.type)if("ATTDEF"===e.type)n=this.loadAttDef(e,t,r);else if("ATTRIB"===e.type){if(!r)for(let i=0;i<t.entities.length;i++){let n=t.entities[i];if(e.ownerHandle===n.handle&&(r=n).attributesFollow)break}n=this.loadAttrib(e,t,r)}else"HATCH"===e.type?n=this.loadHatch(e,t,r):"VIEWPORT"===e.type?n=this.loadViewport(e,t,r):"LEADER"===e.type?n=this.loadLeader(e,t,r):"MULTILEADER"===e.type?n=this.loadMLeader(e,t,r):"OLE2FRAME"===e.type?n=this.loadOle2frame(e,t):"ACAD_TABLE"===e.type&&(n=this.loadTable(e,t));n&&(this.entityThreejsCache[e.handle]=n),this.enableReleaseData&&!this.compareContext&&this.releaseEntity(e)}if(n){let i=this.getLayerName(e,t,r);n.userData.handle=e.handle,"INSERT"!==e.type&&"DIMENSION"!==e.type&&n.traverse((n=>{n.geometry&&(n.userData.layerName=i,this.setMaterial(n,e,t,r))})),s||(this.nonSnapableTypes.has(e.type)&&n.traverse((e=>{e.layers.disable(11)})),this.enableRenderOrder&&(this.entityHandlesWithRenderOrder[e.handle]?n.renderOrder=parseInt(this.entityHandlesWithRenderOrder[e.handle],16)+.1:n.renderOrder=parseInt(e.handle,16)))}return b0.includes(e.type)||(this.entityTypesAndTimes||(this.entityTypesAndTimes={}),this.entityTypesAndTimes[e.type]||(this.entityTypesAndTimes[e.type]={createCount:0,totalTime:0,averageTime:0}),this.entityTypesAndTimes[e.type].createCount++,this.entityTypesAndTimes[e.type].totalTime+=Date.now()-a),n?this.statsInfo.entityTypesAndMeshCount[e.type]?this.statsInfo.entityTypesAndMeshCount[e.type]++:this.statsInfo.entityTypesAndMeshCount[e.type]=1:(this.statsInfo.unsupportedEntityTypes[e.type]?this.statsInfo.unsupportedEntityTypes[e.type]++:this.statsInfo.unsupportedEntityTypes[e.type]=1,b0.includes(e.type)||(this.statsInfo.unsupportedEntity[e.handle]?this.statsInfo.unsupportedEntity[e.handle]++:this.statsInfo.unsupportedEntity[e.handle]=1)),n}loadEllipse(e,t,r){if(!e.majorAxisEndPoint||!e.center||void 0===e.axisRatio||void 0===e.startAngle||void 0===e.endAngle)return;let i=e.startAngle,n=e.endAngle;if(e.extrusionDirection&&e.extrusionDirection.z<0&&(i=2*Math.PI-e.endAngle,n=2*Math.PI-e.startAngle),or.areNumbersEqual(i,n,1e-5))return void de.warn("[Dxf] Ellipse entity (handle '%s') contains the same start and end angle, ignored!",e.handle);let a=n-i;for(;a>2*Math.PI;)a-=2*Math.PI;Math.abs(a)<=1e-5&&(n=or.floorNumber(i+2*Math.PI,5));let s=Math.sqrt(Math.pow(e.majorAxisEndPoint.x,2)+Math.pow(e.majorAxisEndPoint.y,2)),o=s*e.axisRatio,l=Math.atan2(e.majorAxisEndPoint.y,e.majorAxisEndPoint.x),h=new Kd(e.center.x,e.center.y,s,o,i,n,!1,l),c=1,u=r;null!=u&&u.xScale&&null!=u&&u.yScale&&(c=Math.max(Math.abs(u.xScale),Math.abs(u.yScale)));let d=this.getDivision(i,n,Math.max(s,o)*c),p=h.getPoints(d),f=[],m=p.length;for(let e=0;e<m-1;e++)or.areVector2sEqual(p[e],p[e+1],1e-9)||f.push(p[e]);if(f.push(p[m-1]),f.length<2)return void de.warn("[Dxf] Ellipse entity (handle '%s') contains less than 2 points, ignored!",e.handle);let g=new F,v=!1;this.enableRTC&&(v=pr.checkAndRebasePositionsOnRTC(f,g));let y=(new Nt).setFromPoints(f),b=new Ar(2);b.geometry=y,b.material=Fa;let x=new Ar(1);return x.geometry=A_e,x.material=yI,x.matrix.setPosition(e.center.x,e.center.y,e.center.z),x.userData.isSnapObject=!0,x.userData.type="CircleCenter",x.layers.set(11),b.add(x),v&&(this.setRTCUserData(b),b.matrix.setPosition(g.x,g.y,0)),b.layers.enableAll(),b}loadMText(e,t,r){if(!e.text)return;if(!this.font)return void de.info("[Dxf] Font file not set, ignoring text entity.");let i=this.getTextStyle(t,e),n=cI(e.text,{encoding:this.getTextEncoding(i)}),a=this.getMTextGroup(n,e,i,t,r),s=a&&a.object;if(!s)return;s.matrix.decompose(_i,no,Qp),e.position&&(_i.x+=e.position.x,_i.y+=e.position.y,s.matrix.compose(_i,no,Qp)),em.makeEmpty();let o=Ar.getBox(s,em).getSize(Ur),l=e.width||o.x,h=e.height||o.y,c=0,u=0;switch(e.attachmentPoint){case 1:c=0,u=0;break;case 2:c-=l/2,u=0;break;case 3:c-=l,u=0;break;case 4:c=0,u+=h/2;break;case 5:c-=l/2,u+=h/2;break;case 6:c-=l,u+=h/2;break;case 7:c=0,u+=h;break;case 8:c-=l/2,u+=h;break;case 9:c-=l,u+=h;break;default:return}s.traverse((e=>{e.geometry&&e.geometry.translate(c,u,0),e.layers.enableAll()}));let d=0;if(e.rotation&&(d=e.rotation*Math.PI/180),e.directionVector){let t=e.directionVector,r=new F(t.x,t.y,t.z),i=r.clone().cross(Du),n=Du.angleTo(r);d=i.z>0?-n:n}pr.shouldRebasePositionOnRTC(_i)&&this.setRTCUserData(s),s.matrix.compose(_i,no,Qp);let p=e.position?_i.clone().sub(e.position):_i;return Jp.makeTranslation(-p.x,-p.y,0),_a.makeRotationZ(d),s.matrix.multiply(Jp),s.matrix.multiply(_a),s.matrix.multiply(Jp.invert()),s}getMTextGroup(e,t,r,i,n,a=0,s=0,o=[]){var l,h,c,u;if(0===e.length)return;let d=t.height||t.contextData&&t.contextData.textHeight||0;if(t.textStyle){if(r&&r.fontFile&&r.fontFile.endsWith(".shx")){let e=`${r.fontFile}_${r.styleName}`;this.statsInfo.unsupportedTextStyles[e]||(this.statsInfo.unsupportedTextStyles[e]=0),this.statsInfo.unsupportedTextStyles[e]++}d=d||r.textHeight}let p=t.lineSpaceFactor||1,f="Left";t.width&&t.attachmentPoint&&([1,4,7].includes(t.attachmentPoint)?f="Left":[2,5,8].includes(t.attachmentPoint)?f="Center":[3,6,9].includes(t.attachmentPoint)&&(f="Right"));let m,g=t.width||0,v=new Ar,y=r.fontFile,b=1,x=1,_=256,w=p*d*.3,S=w+d;for(let T=0;T<e.length;T++){let M=e[T];if("string"==typeof M){let e,T=[],E=e=>{let t;if(e.forEach(((e,r)=>{e.boundingBox||e.computeBoundingBox(),0===r?t=e.boundingBox:t.union(e.boundingBox)})),t){let r=t.getSize(Ur);switch(f){case"Left":default:break;case"Center":e.forEach((e=>e.translate((g-r.x)/2,0,0)));break;case"Right":e.forEach((e=>e.translate(g-r.x,0,0)))}}T.push(...e)};for(let t=0;t<M.length;t++){let i=M[t];if("\n"!==i)if(w=p*d*.3,S=w+d,e=null==(l=this.font)?void 0:l.getCharShape(i,y,d),r.bigFontFile&&!e&&(e=null==(h=this.font)?void 0:h.getCharShape(i,r.bigFontFile,d)),e||(e=null==(c=this.font)?void 0:c.getCharShape(i,"",d)),e||(e=null==(u=this.font)?void 0:u.getNotFoundTextShape(d)),e)if(e.translate(a,s,0),e.scale(b,1,1),a>(g||1/0))a=0,s-=S,o.length>0&&E(o),o=[];else{e.boundingBox||e.computeBoundingBox();let t=e.boundingBox.getSize(Ur).x;" "===i&&(t=d/2),a+=t+x*(d/6),o.push(e)}else a+=d+x*(d/6);else a=0,s-=S,o.length>0&&E(o),o=[]}o.length>0&&(E(o),o=[]);let A=new Ar;if(T.length>0){m||(m=t.colorIndex),void 0!==_&&256!==_?(t.color=x0(_),t.colorIndex=_):t.colorIndex=m;let e=this.getColor(t,i,n),r=T.filter((e=>e instanceof va)),a=T.filter((e=>!(e instanceof va)));if(r.length>0){let t=new Ar(4);t.geometry=qi(r),t.material=this.getMeshBasicMaterial(e),A.add(t)}if(a.length>0){let t=new Ar(3);t.geometry=qi(a),t.material=this.getLineBasicMaterial(e),A.add(t)}}A.matrix.makeTranslation(0,-d,0),v.add(A),b=1,x=1,_=256,p=t.lineSpaceFactor||1}else if(Array.isArray(M)){let e=this.getMTextGroup(M,t,r,i,n,a,s,o);e&&(v.add(e.object),a=e.hOffset,s=e.vOffset)}else"object"==typeof M&&(M.f&&(y=M.f,y&&y.includes(".shx")&&de.info(`[Dxf] Doesn't support custom fonts: ${y}`)),M.C&&(_=M.C),M.W&&(b="x"===M.W[1]?M.W[0]*t.width:M.W[0]),M.H&&(d="x"===M.H[1]?M.H[0]*t.height:M.H[0]),M.T&&(x=M.T))}return 0!==v.children.length?(Ou.merge(v,!1),m&&(t.colorIndex=m),1===v.children.length?{object:v.children[0],hOffset:a,vOffset:s}:{object:v,hOffset:a,vOffset:s}):void 0}mtextContentAndFormattingToTextAndStyle(e,t){let r={horizontalAlignment:"",textHeight:t.height||t.contextData&&t.contextData.textHeight},i={},n=1,a=[];for(let s=0;s<e.length;s++){let o=e[s];if("string"==typeof o){if(o.startsWith("\\pxq")&&o.endsWith(";"))-1!==o.indexOf("c")?r.horizontalAlignment="center":-1!==o.indexOf("l")?r.horizontalAlignment="left":-1!==o.indexOf("r")?r.horizontalAlignment="right":-1!==o.indexOf("j")&&(r.horizontalAlignment="justify");else if(!o.startsWith("pi")&&!o.startsWith("pxt")&&!o.startsWith("pt")){let e=this.getTextLineNum(o);a.push({font:i.f,colorIndex:i.C,text:o,lineNum:n}),n+=e}}else if(Array.isArray(o)){let e=this.mtextContentAndFormattingToTextAndStyle(o,t);e.text.forEach((e=>{a.push(e)})),n=e.lineLength}else if("object"==typeof o)if(o.S&&3===o.S.length){let e=o.S[0]+"/"+o.S[2],t=this.getTextLineNum(e);a.push({text:o.S[0]+"/"+o.S[2],lineNum:n}),n+=t}else void 0!==o.C?i.C=o.C:void 0!==o.W?i.W=o.W:void 0!==o.H?i.H=o.H:void 0!==o.f&&(i.f=o.f)}return{text:a,lineLength:n,style:r}}getTextLineNum(e){let t=e.match(new RegExp("\\n","g"));return t?t.length:0}load3DFace(e){if(!e.vertices||0===e.vertices.length)return void de.warn("[Dxf] Entity is missing vertices:",e.handle);let t=e.vertices.map((e=>new F(e.x,e.y,e.z)));if(0===t.length)return;or.areVector3sEqual(t[0],t[t.length-1])||t.push(t[0]);let r=new F,i=!1;this.enableRTC&&(i=pr.checkAndRebasePositionsOnRTC(t,r));let n=(new Nt).setFromPoints(t),a=new Ar(2);return a.geometry=n,a.material=Fa,i&&(this.setRTCUserData(a),a.matrix.setPosition(r.x,r.y,0)),a.layers.enableAll(),a}loadSpline(e,t){if(!e.controlPoints||!e.degreeOfSplineCurve||!e.knotValues)return;let r=1/0,i=1/0,n=-1/0,a=-1/0;for(let t of e.controlPoints)t.x<r&&(r=t.x),t.y<i&&(i=t.y),t.x>n&&(n=t.x),t.y>a&&(a=t.y);let s=1,o=t;null!=o&&o.xScale&&null!=o&&o.yScale&&(s=Math.max(Math.abs(o.xScale),Math.abs(o.yScale)));let l=Math.max(n-r,a-i),h=this.getBSplineInterpolationsPerSplineSegment(e.controlPoints.length,l*s),c=L_e(e.controlPoints,e.degreeOfSplineCurve,e.knotValues,h),u=new F,d=!1;this.enableRTC&&(d=pr.checkAndRebasePositionsOnRTC(c,u));let p=pr.getAdjacentNonRepeatPoints(c);if(p.length<2)return void de.warn("[Dxf] Spline entity (handle '%s') contains less than 2 points, ignored!",e.handle);let f=(new Nt).setFromPoints(p),m=new Ar(2);return m.geometry=f,m.material=Fa,d&&(this.setRTCUserData(m),m.matrix.setPosition(u.x,u.y,0)),m.layers.enableAll(),m}loadXLine(e){if(!e.vertices||0===e.vertices.length)return void de.warn("[Dxf] Entity is missing vertices:",e.handle);let t=Ut.arrayOrObjectToVector3(e.directionVector),r=new F(e.vertices[0].x,e.vertices[0].y,0),i=[];if(i.push(t.clone().multiplyScalar(-1e6).add(r)),i.push(t.clone().multiplyScalar(1e6).add(r)),0===i.length)return;let n=new F,a=!1;this.enableRTC&&(a=pr.checkAndRebasePositionsOnRTC(i,n));let s=(new Nt).setFromPoints(i),o=new Ar(2);return o.geometry=s,o.material=Fa,a&&(this.setRTCUserData(o),o.matrix.setPosition(n.x,n.y,0)),o.layers.enableAll(),o}loadRay(e){if(!e.vertices||0===e.vertices.length)return void de.warn("[Dxf] Entity is missing vertices:",e.handle);let t=Ut.arrayOrObjectToVector3(e.directionVector),r=e.vertices.map((e=>new F(e.x,e.y,0)));if(r.push(t.multiplyScalar(1e6).add(r[0])),0===r.length)return;let i=new F,n=!1;this.enableRTC&&(n=pr.checkAndRebasePositionsOnRTC(r,i));let a=(new Nt).setFromPoints(r),s=new Ar(2);return s.geometry=a,s.material=Fa,n&&(this.setRTCUserData(s),s.matrix.setPosition(i.x,i.y,0)),s.layers.enableAll(),s}loadLine(e){if(!e.vertices||0===e.vertices.length)return void de.warn("[Dxf] Entity is missing vertices:",e.handle);let t=[];if(e.isPolyfaceMesh)t=vAt(e.vertices);else{let r=AG(e.vertices,e.shape);e.shape&&r.length>0&&r.push(r[0]),r.length>0&&(t=[r])}if(0===t.length)return;let r=[];for(let e=0;e<t.length;){let[i,n]=t[e];or.areVector3sEqual(i,n)&&t[e].length<=2?(r.push(i),t.splice(e,1)):e++}let i,n=new F,a=!1;if(t.length>0){if(this.enableRTC){let e=0;t.forEach((t=>{t.forEach((t=>{n.add(t),e++}))})),n.divideScalar(e),a=pr.shouldRebasePositionOnRTC(n)}let e=[],r=[],s=0,o=0,l=0,h=0;t.forEach((t=>{for(let i=0;i<t.length;i++)a?(o=t[i].x-n.x,l=t[i].y-n.y,h=t[i].z-n.z,e.push(new F(o,l,h))):e.push(t[i]),i>0&&r.push(s+i-1,s+i);s=t.length}));let c=(new Nt).setFromPoints(e);c.setIndex(r),i=new Ar(3),i.geometry=c,i.material=Fa}if(r.length>0){this.enableRTC&&(a=pr.checkAndRebasePositionsOnRTC(r,n));let e=(new Nt).setFromPoints(r);i=new Ar(1),i.geometry=e,i.material=yI}return i?(a&&(this.setRTCUserData(i),i.matrix.setPosition(n.x,n.y,0)),i.layers.enableAll(),i):void 0}loadLWPolyline(e,t,r){var i,n,a;if(!e.vertices||e.vertices.length<2)return void de.warn("[Dxf] Invalid LWPolyline entity (handle '%s'), ignored!",e.handle);let s=e;if(void 0!==s.extrusionDirectionX&&void 0!==s.extrusionDirectionY&&void 0!==s.extrusionDirectionZ){Ur.set(s.extrusionDirectionX,s.extrusionDirectionY,s.extrusionDirectionZ);let e=An.getOcsMatrix(Ur).invert(),t=0;void 0!==s.elevation&&s.elevation>0&&(t=s.elevation),s.vertices.forEach((r=>{let i=Ur.set(r.x,r.y,t).applyMatrix4(e);r.x=i.x,r.y=i.y}))}let o=AG(e.vertices,e.shape);if(e.shape&&o.length>0&&!or.areVector3sEqual(o[0],o[o.length-1])&&o.push(o[0]),o.length<2)return void de.warn("[Dxf] Invalid LWPolyline entity (handle '%s'), ignored!",e.handle);let l=new Ar;if(null!=(i=e.extendedData)&&i.outlines){let t=e.extendedData.outlines,r=[];t.forEach((e=>{let t=new Ys;e.forEach(((e,r)=>{0===r?t.moveTo(e[0],e[1]):t.lineTo(e[0],e[1])})),t.closePath(),r.push(new hc(t))}));let i=qi(r),n=new Ar(4);n.geometry=i,n.material=lb,n.layers.enableAll(),l.add(n)}let h=new F,c=!1;this.enableRTC&&(c=pr.checkAndRebasePositionsOnRTC(o,h));let u=pr.getAdjacentNonRepeatPoints(o);if(u.length<2)return void de.warn("[Dxf] Invalid LWPolyline entity (handle '%s'), ignored!",e.handle);if(this.enablePlineWidth&&void 0!==s.constantWidth&&s.constantWidth>0){let i=null==(a=null==(n=t.tables)?void 0:n.lineType)?void 0:a.lineTypes,o=i&&i[this.getLineType(e,t,r)];if(!o||!o.pattern||0===o.pattern.length){this.statsInfo.unsupportedPolylineCount++;let t=pr.convertWidthLineToMeshGeometry(u,s.constantWidth);if(t){let e=new Ar(4);e.geometry=t,e.material=lb,e.layers.enableAll(),e.layers.disable(11),l.add(e);let r=pn.createOutline(t,Fa,e.matrix),i=new Ar(3);i.geometry=r.geometry,i.material=r.material,i.matrix=r.matrix,i.layers.enableAll(),i.layers.disable(11),l.add(i)}else de.warn("[Dxf] Failed to convert line with width to mesh geometry: %s",e.handle)}}let d=new Ar(2);return d.geometry=(new Nt).setFromPoints(u),d.material=Fa,d.layers.enableAll(),l.children.length>0?l.add(d):l=d,c&&(this.setRTCUserData(l),l.matrix.setPosition(h)),l}loadMLeader(e,t,r){var i,n,a,s,o,l,h;let c=t.tables.dimStyle.dimStyles[e.dimensionStyle]||this.getDefaultDimensionStyle(t),u=null==(i=e.contextData)?void 0:i.defaultTextContents;if(!u)return;let d=new Ar,p=cI(u),f=this.getTextStyle(t,e),m=this.getMTextGroup(p,e,f,t,r),g=m&&m.object;if(g){g.matrix.decompose(_i,no,Qp),null!=(n=e.contextData)&&n.textLocation&&(_i.x+=e.contextData.textLocation.x,_i.y+=e.contextData.textLocation.y,g.matrix.compose(_i,no,Qp)),em.makeEmpty();let t=Ar.getBox(g,em).getSize(Ur),r=t.x,i=t.y,l=0,h=0;switch(null==(a=e.contextData)?void 0:a.textAttachment){case 1:l=0,h=0;break;case 2:l-=r/2,h=0;break;case 3:l-=r,h=0;break;case 4:l=0,h+=i/2;break;case 5:l-=r/2,h+=i/2;break;case 6:l-=r,h+=i/2;break;case 7:l=0,h+=i;break;case 8:l-=r/2,h+=i;break;case 9:l-=r,h+=i;break;default:return}g.traverse((e=>{e.geometry&&e.geometry.translate(l,h,0)}));let c=0;if(null!=(s=e.contextData)&&s.textRotation&&(c=e.contextData.textRotation*Math.PI/180),null!=(o=e.contextData)&&o.textDirection){let t=e.contextData.textDirection,r=new F(t.x,t.y,t.z),i=r.clone().cross(Du),n=Du.angleTo(r);c+=i.z>0?-n:n}pr.shouldRebasePositionOnRTC(_i)&&this.setRTCUserData(g),g.matrix.compose(_i,no,Qp),e.contextData.textLocation?Ur.set(e.contextData.textLocation.x,e.contextData.textLocation.y,0):Ur.set(0,0,0);let u=_i.clone().sub(Ur);Jp.makeTranslation(-u.x,-u.y,0),_a.makeRotationZ(c),g.matrix.multiply(Jp),g.matrix.multiply(_a),g.matrix.multiply(Jp.invert()),g.renderOrder=5,d.add(g)}if(0===e.leaderLineType)return null==g||g.traverse((e=>{e.layers.enableAll()})),g;{let r=[],i=null==(l=e.contextData)?void 0:l.leaders[0];if(!i)return d;let n=i.lastLeaderLinePoint;if(e.enableDogLeg){let e=new F(n.x,n.y,n.z),t=i.doglegLength,a=new F(i.doglegVector.x,i.doglegVector.y,i.doglegVector.z).multiplyScalar(t),s=e.clone().add(a);r.push(s,e)}let a=(null==(h=e.contextData)?void 0:h.leaders[0].leaderLines)||[];for(let i=0;i<a.length;i++){let s=a[i].vertices[0].reverse().map((e=>new F(e.x,e.y,e.z))),o=new F(n.x,n.y,n.z);for(let e=0;e<s.length;e++)r.push(o,s[e]),o=s[e];let l=Ur.subVectors(r[0],r[1]).length(),h=(e.arrowHeadSize||c.DIMASZ||2.5)*(e.arrowHeadScale||c.DIMSCALE||1);e.leaderLineType;let u="";if(e.arrowHeadId?u=e.arrowHeadId:c&&c.DIMLDRBLK&&(u=c.DIMLDRBLK),u){let i=this.getBlockByHandle(t.blocks,u);if(i&&i.entities)for(let n=0;n<i.entities.length;n++){let a=this.loadEntity(i.entities[n],t,e);if(a){let e=new F(r[r.length-1].x,r[r.length-1].y,r[r.length-1].z),t=new F(r[r.length-2].x,r[r.length-2].y,r[r.length-2].z),i=Math.atan2(e.y-t.y,e.x-t.x);Ur.copy(e),_i.setScalar(h),no.setFromAxisAngle(ob,i),a.matrix.compose(Ur,no,_i),d.add(a)}}}else this.loadDefaultLeadArrow(r[r.length-2],r[r.length-1],l/2e3,r)}let s=new F,o=!1;this.enableRTC&&(o=pr.checkAndRebasePositionsOnRTC(r,s));let u=(new Nt).setFromPoints(r),p=new Ar(3);p.geometry=u,p.material=Fa,p.renderOrder=2,o&&(this.setRTCUserData(p),p.matrix.setPosition(s.x,s.y,0)),d.add(p)}return Ou.merge(d,!1),d.traverse((e=>{e.layers.enableAll()})),1===d.children.length?d.children[0]:d}loadLeader(e,t,r){let i=[];if(!e.vertices)return void de.warn("[Dxf] Entity is missing vertices:",e.handle);if(e.vertices.length<2)return void de.warn("leader's  vertices number must be greater than 2");let n=t.tables.dimStyle.dimStyles[e.dimensionStyle]||this.getDefaultDimensionStyle(t),a=e.vertices;if(1===e.pathType&&(a=new Ug(e.vertices).getPoints(50)),e.textWidth){let t=e.textWidth,r=new F(a[a.length-1].x,a[a.length-1].y,a[a.length-1].z);if(0===e.direction){let e=new F(1,0,0).multiplyScalar(t);a.push(e.add(r))}else{let e=new F(-1,0,0).multiplyScalar(t);a.push(e.add(r))}}for(let e=0;e<a.length-1;e++){let t=a[e],r=a[e+1];i.push(t,r)}let s=Ur.subVectors(i[0],i[1]).setZ(0).length(),o=(e.arrowHeight||n.DIMASZ||2.5)*(e.arrowHeadScale||n.DIMSCALE||1),l=new Ar;if(1===e.arrowFlag){let r="";e.arrowHeadBlockHandle?r=e.arrowHeadBlockHandle:n&&n.DIMLDRBLK&&(r=n.DIMLDRBLK);let a=this.getBlockByHandle(t.blocks,r);if(a&&a.entities){n&&(e.colorIndex=n.DIMCLRD||256,e.color=x0(e.colorIndex));for(let r=0;r<a.entities.length;r++){let n=this.loadEntity(a.entities[r],t,e);if(n){let e=new F(i[0].x,i[0].y,i[0].z),t=new F(i[1].x,i[1].y,i[1].z),r=Math.atan2(e.y-t.y,e.x-t.x);Ur.copy(e),_i.setScalar(o),no.setFromAxisAngle(ob,r),n.matrix.compose(Ur,no,_i),l.add(n)}}}else this.loadDefaultLeadArrow(i[1],i[0],o/s/2,i)}if(0===i.length)return;let h=new F,c=!1;this.enableRTC&&(c=pr.checkAndRebasePositionsOnRTC(i,h));let u=(new Nt).setFromPoints(i),d=new Ar(2);return d.geometry=u,d.material=Fa,d.renderOrder=2,c&&(this.setRTCUserData(d),d.matrix.setPosition(h.x,h.y,0)),l.children.length>0?(l.add(d),Ou.merge(l,!1),l.traverse((e=>{e.layers.enableAll()})),1===l.children.length?l.children[0]:l):(d.layers.enableAll(),d)}getTableTextOffset(e,t,r){let i=new F;switch(e){case 1:break;case 2:i.setX(t/2);break;case 3:i.setX(t);break;case 4:i.setY(-r/2);break;case 5:i.set(t/2,-r/2,0);break;case 6:i.set(t,-r/2,0);break;case 7:i.setY(-r);break;case 8:i.set(t/2,-r,0);break;case 9:i.set(t,-r,0)}return i}loadTable(e,t,r){if(!e.startPoint)return void de.warn("[Dxf] Entity is missing startPoint:",e.handle);if(0===e.cells.length)return void de.warn("[Dxf] Entity is missing cells:",e.handle);if(0===e.rowHeightArr.length)return void de.warn("[Dxf] Entity is missing rowHeightArr:",e.handle);if(0===e.columnWidthArr.length)return void de.warn("[Dxf] Entity is missing columnWidthArr:",e.handle);let i=new Ar,{cells:n,rowCount:a,columnCount:s,rowHeightArr:o,columnWidthArr:l}=e,h=[],c=0,u=0;for(let e=0;e<=a;e++){c+=e>0?o[e-1]:0,Ur.set(0,-c,0);let t=[Ur.clone()];for(let e=0;e<s;e++){_i.set(l[e],0,0);let r=Ur.add(_i);t.push(r.clone())}h.push(t)}for(let e=0;e<=s;e++){u+=e>0?l[e-1]:0,Ur.set(u,0,0);let t=[Ur.clone()];for(let e=0;e<a;e++){_i.set(0,-o[e],0);let r=Ur.add(_i);t.push(r.clone())}h.push(t)}let d=[];h.forEach((e=>{for(let t=0;t<e.length-1;t++)d.push(e[t],e[t+1])}));let p=(new Nt).setFromPoints(d),f=new Ar(3);f.geometry=p,f.material=Fa,f.layers.enableAll(),i.add(f),u=0;for(let h=0;h<s;h++){let d=l[h];u+=h>0?l[h-1]:0,c=0;for(let l=0;l<a;l++){let a=o[l];c+=l>0?o[l-1]:0,Ur.set(u,-c,0);let p=n[l*s+h];if(p){p.colorIndex=e.colorIndex,p.height=p.textHeight;let n=this.getTableTextOffset(p.attachmentPoint,d,a);p.position=Ur.clone().add(n);let s=this.loadMText(p,t,r);s&&i.add(s)}}}if(e.blockRecordHandle){let r=this.getBlockByHandle(t.blocks,e.blockRecordHandle);if(r&&r.entities)for(let n=0;n<r.entities.length;n++){let a=r.entities[n],s=this.loadEntity(a,t,e);s&&i.add(s)}}return i.matrix.decompose(Ur,no,Qp),Ur.x+=e.startPoint.x,Ur.y+=e.startPoint.y,i.matrix.compose(Ur,no,Qp),i}loadDefaultLeadArrow(e,t,r,i){let n=r*(e.x-t.x),a=r*(e.y-t.y),s=a,o=-n,l=new F(t.x+n+s/6,t.y+a+o/6,0),h=new F(t.x+n-s/6,t.y+a-o/6,0);i.push(t,l),i.push(t,h),i.push(l,h)}getBlockByHandle(e,t){if(!this.blocksCache){this.blocksCache={};for(let t in e){let r=e[t];this.blocksCache[r.ownerHandle]||(this.blocksCache[r.ownerHandle]=r)}}return this.blocksCache[t]}static updateMaterialUniforms(e){e instanceof xr&&(e.uniforms.u_cameraZoom&&(e.uniforms.u_cameraZoom=An.CameraZoomUniform),e.uniforms.u_viewportScale&&(e.uniforms.u_viewportScale=An.ViewportScaleUniform))}static transformAngleByOcsMatrix(e,t){let r=Ur.set(1*Math.cos(t),1*Math.sin(t),0).applyMatrix4(e);return Math.atan2(r.y,r.x)}static getArcAnglesByOcsMatrix(e,t,r){let i,n=or.getArcAngleSpanInRadian(t,r),a=An.transformAngleByOcsMatrix(e,t),s=An.transformAngleByOcsMatrix(e,r);if(or.areNumbersClose(n,Math.PI)){n=1;let r=An.transformAngleByOcsMatrix(e,t+n);i=or.getArcAngleSpanInRadian(a,r)}else{if(or.areNumbersClose(n,2*Math.PI))return[a,a+2*Math.PI];i=or.getArcAngleSpanInRadian(a,s)}return or.areNumbersClose(n,i,1e-5)?[a,s]:[s,a]}loadArc(e,t,r){var i,n,a;if(!e.radius||e.radius<.001)return void de.warn(`[Dxf] The radius of arc (handle '${e.handle}') is undefined, ignored!`);if(!e.radius||e.radius<.001)return void de.warn(`[Dxf] The radius of arc (handle '${e.handle}') is too small, ignored!`);let s=new F(0,0,1);void 0!==e.extrusionDirectionX&&void 0!==e.extrusionDirectionY&&void 0!==e.extrusionDirectionZ&&s.set(e.extrusionDirectionX,e.extrusionDirectionY,e.extrusionDirectionZ);let o,l,h=An.getOcsMatrix(s);if("CIRCLE"===e.type)o=e.startAngle||0,l=o+2*Math.PI;else{if(null==e.startAngle||null==e.endAngle||(o=e.startAngle,l=e.endAngle,or.areNumbersEqual(o,l,1e-6)))return;if(!or.areNumbersClose(or.getArcAngleSpanInRadian(o,l),2*Math.PI)){let e=An.getArcAnglesByOcsMatrix(h,o,l);o=e[0],l=e[1]}}let c=new Ng(0,0,e.radius,o,l,0!==this.angBase),u=1,d=r;null!=d&&d.xScale&&null!=d&&d.yScale&&(u=Math.max(Math.abs(d.xScale),Math.abs(d.yScale)));let p=this.getDivision(o,l,e.radius*u),f=c.getPoints(p),m=new F,g=!1;this.enableRTC&&(g=pr.checkAndRebasePositionsOnRTC(f,m));let v=(new Nt).setFromPoints(f),y=new Ar(2);y.geometry=v,y.material=Fa;let b=new F;e.center&&(b.x=e.center.x,b.y=e.center.y);let x=new F(null==(i=e.center)?void 0:i.x,null==(n=e.center)?void 0:n.y,null==(a=e.center)?void 0:a.z).applyMatrix4(h.invert());b.x=x.x,b.y=x.y;let _=b,w=new Ar(1);return w.geometry=A_e,w.material=yI,w.userData.handle=e.handle,w.userData.isSnapObject=!0,w.userData.type="CircleCenter",w.layers.set(11),y.add(w),g?(this.setRTCUserData(y),_.x+=m.x,_.y+=m.y):pr.shouldRebasePositionOnRTC(_)&&this.setRTCUserData(y),y.matrix.setPosition(_),y.layers.enableAll(),y}addTriangleFacingCamera(e,t,r,i){let n=new F,a=new F;n.subVectors(r,t),a.subVectors(i,t),n.cross(a);let s=new F(t.x,t.y,t.z),o=new F(r.x,r.y,r.z),l=new F(i.x,i.y,i.z);n.z<0?e.push(l,o,s):e.push(s,o,l)}loadSolid(e,t,r){let i=e.points;if(!i||i.length<4)return;if(e.extrusionDirection&&e.extrusionDirection.z){Ur.set(0,0,e.extrusionDirection.z);let t=An.getOcsMatrix(Ur).invert();i.forEach((e=>{let r=Ur.set(e.x,e.y,0).applyMatrix4(t);e.x=r.x,e.y=r.y}))}let n=[],a=[];this.addTriangleFacingCamera(n,i[0],i[1],i[2]),a.push(0,1,2),this.addTriangleFacingCamera(n,i[1],i[2],i[3]),a.push(3,4,5);let s=new F,o=!1;this.enableRTC&&(o=pr.checkAndRebasePositionsOnRTC(n,s));let l=(new Nt).setFromPoints(n);l.setIndex(a);let h=new Ar(4);return h.geometry=l,h.material=lb,o&&(this.setRTCUserData(h),h.matrix.setPosition(s.x,s.y,0)),h.layers.enableAll(),h}getTextStyle(e,t){var r,i;let n=null==(i=null==(r=e.tables)?void 0:r.style)?void 0:i.styles;return n&&(n[t.textStyle]||n.STANDARD||n.Standard)||{}}getDefaultDimensionStyle(e){return e.tables.dimStyle.dimStyles.STANDARD||e.tables.dimStyle.dimStyles.Standard||{}}getTextEncoding(e){return(null==e?void 0:e.bigFontFile)&&e.bigFontFile.toUpperCase().startsWith("GB")?"gbk":"utf8"}getTextMesh(e,t,r,i){if(!e)return;let n=(null==r?void 0:r.styleName)||"";if(r&&r.fontFile&&r.fontFile.endsWith(".shx")){let e=`${r.fontFile}_${r.styleName}`;this.statsInfo.unsupportedTextStyles[e]||(this.statsInfo.unsupportedTextStyles[e]=0),this.statsInfo.unsupportedTextStyles[e]++}let a=.67,s={_TCH_DIM:1.45,ROMANS:1};n&&s[n]&&(a=s[n]),i.xScale&&(a*=i.xScale),n&&(a*=(null==r?void 0:r.xScale)||1,t=t||(null==r?void 0:r.textHeight)||0),0===t&&(t=n?1:.2);let o=this.createTextMeshByText(e,r,t,0,t/8);return o.traverse((e=>{e.geometry&&e.geometry.scale(a,1,1)})),o}createTextMeshByText(e,t,r=12,i=0,n=0,a=1,s=1/0){var o,l,h;let c=new Ar,u=[],d=0,p=0,f=i+r;for(let i=0;i<e.length;i++){let c=e[i];if(" "===c){d+=r;continue}if("\n"===c){d=0,p-=f;continue}let m=null==(o=this.font)?void 0:o.getCharShape(c,t.fontFile,r);if(t.bigFontFile&&!m&&(m=null==(l=this.font)?void 0:l.getCharShape(c,t.bigFontFile,r)),m||(m=null==(h=this.font)?void 0:h.getNotFoundTextShape(r)),m){if(m.translate(d,p,0),m.scale(a,1,1),d>s)d=0,p-=f;else{m.boundingBox||m.computeBoundingBox(),d+=m.boundingBox.getSize(Ur).x+n}u.push(m)}}if(u.length>0){let e=u.filter((e=>e instanceof va)),t=u.filter((e=>!(e instanceof va)));if(e.length>0){let t=new Ar(4);t.geometry=qi(e),t.material=lb,c.add(t)}if(t.length>0){let e=new Ar(3);e.geometry=qi(t),e.material=Fa,c.add(e)}}return c}transformTextMesh(e,t){em.makeEmpty();let r=Ar.getBox(t,em).getSize(Ur),{halign:i,valign:n}=e;t.matrix.decompose(bI.position,bI.quaternion,bI.scale);let a=bI,s=e.width||e.textWidth||r.x,o=e.height||e.textHeight||r.y;if(void 0===i&&void 0===n&&e.startPoint||[3,5].includes(i)&&e.startPoint?(a.position.x+=e.startPoint.x,a.position.y+=e.startPoint.y,a.position.z+=e.startPoint.z):e.endPoint&&(a.position.x+=e.endPoint.x,a.position.y+=e.endPoint.y,a.position.z+=e.endPoint.z),3!==i&&5!==i){if(e.rotation){let t=e.rotation*Math.PI/180;a.rotateZ(t)}2===e.mirrored?a.rotateY(Math.PI):4===e.mirrored&&a.rotateX(Math.PI)}switch(i){case 0:default:break;case 1:a.translateX(-s/2);break;case 2:a.translateX(-s);break;case 3:if(e.startPoint&&e.endPoint){let t=new F(e.startPoint.x,e.startPoint.y,e.startPoint.z),r=new F(e.endPoint.x,e.endPoint.y,e.endPoint.z),i=(new F).subVectors(t,r),n=i.length()/s;a.scale.multiplyScalar(n);let o=i.clone().cross(Du),l=i.angleTo(Du);a.rotateZ(o.z>0?Math.PI-l:l-Math.PI),(2===e.mirrored||4===e.mirrored)&&a.rotateX(Math.PI)}break;case 4:a.translateX(-s/2),a.translateY(-o/2);break;case 5:if(e.startPoint&&e.endPoint){let t=new F(e.startPoint.x,e.startPoint.y,e.startPoint.z),r=new F(e.endPoint.x,e.endPoint.y,e.endPoint.z),i=(new F).subVectors(t,r),n=i.length()/s;a.scale.setX(n);let o=i.clone().cross(Du),l=i.angleTo(Du);a.rotateZ(o.z>0?Math.PI-l:l-Math.PI),(2===e.mirrored||4===e.mirrored)&&a.rotateX(Math.PI)}}switch(n){case 0:case 1:default:break;case 2:a.translateY(-o/2);break;case 3:a.translateY(-o)}return a.position.z=0,a.updateMatrix(),t.matrix.copy(a.matrix),t}loadText(e,t,r){let i=e.text;if(!i)return;if(!this.font)return void de.info("[Dxf] Font file not set, ignoring text entity.");let n=this.getTextStyle(t,e);i=uI(i,{encoding:this.getTextEncoding(n)}).map((e=>e.text)).join("");let a=this.getTextMesh(i,e.textHeight,n,e);if(!a||0===a.children.length)return;this.transformTextMesh(e,a),Ur.set(a.matrix.elements[12],a.matrix.elements[13],a.matrix.elements[14]);let s=pr.shouldRebasePositionOnRTC(Ur);return s&&this.setRTCUserData(a),a.traverse((e=>{let t=e.geometry;if(t){if(e instanceof Ht&&!t.getIndex()){let e=t.getAttribute("position"),r=[];for(let t=0;t<e.count;t+=3)r.push(t,t+1,t+2);t.setIndex(r)}if(t.hasAttribute("uv")&&t.deleteAttribute("uv"),t.hasAttribute("normal")&&t.deleteAttribute("normal"),!s){let r=pr.caculateGeometryCenter(t);r&&pr.shouldRebasePositionOnRTC(r)&&this.setRTCUserData(e)}}})),a.layers.enableAll(),a}loadAttDef(e,t,r){let i=e.tag||e.text||e.prompt;if(!i||!this.font)return;let n=this.getTextStyle(t,e);i=uI(i).map((e=>e.text)).join();let a=this.getTextMesh(i,e.textHeight,n,e);if(!a||0===a.children.length)return;this.transformTextMesh(e,a),Ur.set(a.matrix.elements[12],a.matrix.elements[13],a.matrix.elements[14]);let s=pr.shouldRebasePositionOnRTC(Ur);return s&&this.setRTCUserData(a),a.traverse((e=>{let t=e.geometry;if(t){if(e instanceof Ht&&!t.getIndex()){let e=t.getAttribute("position"),r=[];for(let t=0;t<e.count;t+=3)r.push(t,t+1,t+2);t.setIndex(r)}if(t.hasAttribute("uv")&&t.deleteAttribute("uv"),t.hasAttribute("normal")&&t.deleteAttribute("normal"),!s){let r=pr.caculateGeometryCenter(t);r&&pr.shouldRebasePositionOnRTC(r)&&this.setRTCUserData(e)}}})),a.layers.enableAll(),a}loadAttrib(e,t,r){let i=e.text;if(!i||!this.font)return;let n=this.getTextStyle(t,e);i=uI(i).map((e=>e.text)).join();let a=this.getTextMesh(i,e.textHeight,n,e);if(!a||0===a.children.length)return;this.transformTextMesh(e,a),Ur.set(a.matrix.elements[12],a.matrix.elements[13],a.matrix.elements[14]);let s=pr.shouldRebasePositionOnRTC(Ur);return s&&this.setRTCUserData(a),a.traverse((e=>{let t=e.geometry;if(t){if(e instanceof Ht&&!t.getIndex()){let e=t.getAttribute("position"),r=[];for(let t=0;t<e.count;t+=3)r.push(t,t+1,t+2);t.setIndex(r)}if(t.hasAttribute("uv")&&t.deleteAttribute("uv"),t.hasAttribute("normal")&&t.deleteAttribute("normal"),!s){let r=pr.caculateGeometryCenter(t);r&&pr.shouldRebasePositionOnRTC(r)&&this.setRTCUserData(e)}}})),a.layers.enableAll(),a}loadPoint(e,t,r){if(!e.position)return;let i=new Nt,n=[new F(e.position.x,e.position.y,e.position.z)];Ur.set(0,0,0);let a=Ur,s=!1;this.enableRTC&&(s=pr.checkAndRebasePositionsOnRTC(n,a)),i.setFromPoints(n);let o=new Ar(1);return o.geometry=i,o.material=Fa,s&&(this.setRTCUserData(o),o.matrix.setPosition(a.x,a.y,0)),o.layers.enableAll(),o}loadDimension(e,t){if(!e.block)return;let r=t.blocks[e.block];if(!r||!r.entities)return;let i=t.tables.dimStyle.dimStyles[e.dimStyleName]||this.getDefaultDimensionStyle(t);i&&i.DIMCLRD>0&&(e.colorIndex=i.DIMCLRD,e.color=x0(e.colorIndex));let n=new Ar;for(let i=0;i<r.entities.length;i++){let a=this.loadEntity(r.entities[i],t,e);a&&n.add(a)}if(0===n.children.length){let t=e.name||e.block;return this.statsInfo.ignoredInserts[t]||(this.statsInfo.ignoredInserts[t]=0),void this.statsInfo.ignoredInserts[t]++}this.blockReferencesCache[e.block]||(this.blockReferencesCache[e.block]={referenceCount:0}),this.blockReferencesCache[e.block].referenceCount++;n.name=`${e.type}<${r.name}>`,n.userData.entityType=e.type;let a=null==e?void 0:e.insertionPoint;return Ur.set(0,0,0),a&&Ur.set(a.x,a.y,0),pr.shouldRebasePositionOnRTC(Ur)&&this.setRTCUserData(n),n.matrix.setPosition(Ur),n}loadImage(e,t,r){var i;if(!e.imageSize||null==(i=t.objects.IMAGEDEF)||!i.length)return;let n=t.objects.IMAGEDEF.filter((t=>t.handle===e.imageDefHandle))[0];if(!n)return;console.log(e,n);let a=e.imageSize.x,s=e.imageSize.y,o=new Ar,l=!1;2===e.flags||4===e.flags||8===e.flags||(l=!0);let h=new vs(a,s);if(l){let e=new Ds(this.manager).load(n.filename,void 0,void 0,(()=>{console.warn("Please upload the pictures in the same folder, or use url link in the dxf file.")}));e.colorSpace=Zr;let t=new Mr({transparent:!0,side:zi,map:e}),r=new Ar(4);r.geometry=h,r.material=t,o.add(r)}let c=new _h(h),u=this.getColor(e,t,r),d=new Ar(2);d.geometry=c,d.material=this.getLineBasicMaterial(u);let p=e.uPixel?new F(e.uPixel.x,e.uPixel.y,e.uPixel.z):new F(n.pixelSize.x,0,0),f=e.vPixel?new F(e.vPixel.x,e.vPixel.y,e.vPixel.z):new F(n.pixelSize.y,0,0);if(o.add(d),_i.set(p.x,f.y,1),Ur.set(0,0,0),e.position){let t=new F(e.position.x,e.position.y,e.position.z);t.add(p.multiplyScalar(a/2)).add(f.multiplyScalar(s/2)),Ur.copy(t)}return pr.shouldRebasePositionOnRTC(Ur)&&this.setRTCUserData(o),no.identity(),o.matrix.compose(Ur,no,_i),o}loadInsert(e,t,r,i=!1){var n,a;if(!e.block)return;let s=t.blocks[e.block];if(!s.entities)return;r&&"0"===e.layer&&(e.layer=r.layer),e.blockPosition=s.position;let o=new Ar;for(let r=0;r<s.entities.length;r++){if("ATTDEF"===s.entities[r].type)continue;let n=this.loadEntity(s.entities[r],t,e,i);n&&o.add(n)}if(0===o.children.length){let t=e.name||e.block;return this.statsInfo.ignoredInserts[t]||(this.statsInfo.ignoredInserts[t]=0),void this.statsInfo.ignoredInserts[t]++}this.blockReferencesCache[e.block]||(this.blockReferencesCache[e.block]={referenceCount:0}),this.blockReferencesCache[e.block].referenceCount++;o.name=`${e.type}<${s.name}>`,o.userData.entityType=e.type,null!=(n=e.extendedData)&&n.originalType&&(o.userData.originalType=null==(a=e.extendedData)?void 0:a.originalType),null!=e&&e.blockPosition&&o.matrix.setPosition(-e.blockPosition.x,-e.blockPosition.y,0);let l=Ur.set(1,1,1);e.xScale&&(l.x=e.xScale),e.yScale&&(l.y=e.yScale);let h=new tn;e.rotation&&(h.z=e.rotation*Math.PI/180),no.setFromEuler(h,!1);let c=_i.set(0,0,0);e.position&&(c.x=e.position.x,c.y=e.position.y),_a.compose(c,no,l),e.extrusionDirection&&e.extrusionDirection.z<0&&_a.premultiply(R_e.identity().makeScale(-1,1,1)),Jp.copy(o.matrix),o.matrix.premultiply(_a),_i.set(o.matrix.elements[12],o.matrix.elements[13],o.matrix.elements[14]),pr.shouldRebasePositionOnRTC(_i)&&this.setRTCUserData(o);let u=this.findSpatialFilterByHandle(e.handle,t);if(u){this.loadSpatialFilter(u);let t=u;t&&t.clipPolylines&&t.clipPolylines.length>0&&(o.userData.spatialFilterHandle=u.handle,this.cloneMaterialsForSpatialFilter(o),de.debug("[Dxf] Spatial filter:",e.associatedSpatialFilter))}return o}loadSpatialFilter(e){let t=e;if(t.threejsObject)return t.threejsObject.clone();let r=e.invertBlockMatrix;_a.set(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],0,0,0,1);let i=[];e.vertices.forEach((e=>{i.push(new F(e.x,e.y,0))}));let n={polyline:[],bConcave:!1,bReversed:!1};if(2===e.numberOfPointsOnClipBoundary)n.polyline=i;else{let t=e.numberOfPointsOnClipBoundary,r=3;if(t<r)return void de.warn(`[Dxf] Invalid clipBoundary: ${e.handle} !`);let a=[],s=-1;for(let e=0;e<t;e++){let r=i[e];for(let n=t-1;n>e;n--){let o=i[n];if(or.areVector3sEqual(r,o)&&e+1<n-1&&e+1<t-1&&or.areVector3sEqual(i[e+1],i[n-1])){a.push(r),s=n;break}}if(s>0)break;a.push(r)}if(s>0)for(let e=s+1;e<t;e++)a.push(i[e]);if(a.length<r)return void de.warn(`[Dxf] Invalid clipBoundary: ${e.handle}!`);let o=[],l=[];if(a.forEach((e=>{o.push(new Te(e.x,e.y)),l.push([e.x,e.y])})),!pr.isConvex(o)){de.warn(`[Dxf] Concave polygon is not supported for spatial filter (handle '${e.handle}'), converting to convex polygon!`);let t=(0,k_e.default)(l,1/0);a=[],t.forEach((e=>{a.push(new F(e[0],e[1],0))}))}or.areVector3sEqual(a[0],a[a.length-1])||a.push(a[0]),n.polyline=a,n.bReversed=s>0}return this.enableReleaseData&&(e.vertices=[],e.matrix=[],e.invertBlockMatrix=[]),t.localMatrix=_a.clone(),t.clipPolylines=[],void t.clipPolylines.push(n)}loadLayout(e,t,r,i,n,a){if(!e.entities)return;let s=new Ar;for(let i=0;i<e.entities.length;i++){let o=e.entities[i];this.addViewport(o,a);let l=this.loadEntity(o,t);l&&(this.enableMerge&&Ou.merge(l,!1),s.add(l),l.traverse((e=>{if(e.geometry){let t=e.userData.layerName,i=n[t];i||(i=[],n[t]=i),i.push(e),e.userData.isSnapObject&&(this.layoutsSnapObjectsMap[r.layoutName]||(this.layoutsSnapObjectsMap[r.layoutName]=[]),this.layoutsSnapObjectsMap[r.layoutName].push(e))}})))}if(0===s.children.length)return;s.userData.layerName=e.layer;let o=r.layoutName,l=i.children.find((e=>e.name===o));l||(l=new Ar,l.name=o,l.userData.isLayoutLevelObject=!0,i.add(l)),l.add(s),e.position&&s.matrix.setPosition(e.position.x,e.position.y,e.position.z||0)}convertEdgeToPoints(e){let t=[];switch(e.type){case 1:{let r=e;t.push(new Te(r.startPoint.x,r.startPoint.y)),t.push(new Te(r.endPoint.x,r.endPoint.y));break}case 2:{let r=e,i=r.startAngle*Tr.DEG2RAD,n=r.endAngle*Tr.DEG2RAD;r.bCounterclockwise||(i=2*Math.PI-i,n=2*Math.PI-n);let a=new Ng(r.center.x,r.center.y,r.radius,i,n,!r.bCounterclockwise),s=this.getDivision(i,n,r.radius),o=a.getPoints(s);e.startPoint=o[0],e.endPoint=o[o.length-1],t.push(...o);break}case 3:{let r=e,i=Math.sqrt(Math.pow(r.majorAxisEndPoint.x,2)+Math.pow(r.majorAxisEndPoint.y,2)),n=i*r.minorRatio,a=Math.atan2(r.majorAxisEndPoint.y,r.majorAxisEndPoint.x),s=r.startAngle*Tr.DEG2RAD,o=r.endAngle*Tr.DEG2RAD;r.bCounterclockwise||(s=2*Math.PI-s,o=2*Math.PI-o);let l=new Kd(r.center.x,r.center.y,i,n,s,o,!r.bCounterclockwise,a),h=this.getDivision(s,o,Math.max(i,n)),c=l.getPoints(h);e.startPoint=c[0],e.endPoint=c[c.length-1],t.push(...c);break}case 4:{let r=e,i=L_e(r.controlPoints,r.degreeOfSplineCurve,r.knotValues);e.startPoint=i[0],e.endPoint=i[i.length-1],t.push(...i);break}case 0:{let r=e,i=AG(r.points,r.isClosed);e.startPoint=i[0],e.endPoint=i[i.length-1],t.push(...i);break}}return t}loadHatch(e,t,r){var i,n;let a=e;if(0==a.boundaryPaths.length)return;if(!(a.solidFill||null!=(i=a.patternLines)&&i.length))return void de.warn(`[Dxf] Hatch entity(handle: '${a.handle}') doesn't have solid fill, nor patternLines, ignored!`);let s=[],o=[],l=[],h=e=>{let t=[],r=[];r.push(...this.convertEdgeToPoints(e[0]));for(let i=1;i<e.length;i++){let n=this.convertEdgeToPoints(e[i]);if(r.push(...n),r.length>2){let a=this.convertEdgeToPoints(e[i-1]);or.areVector2sEqual(a[a.length-1],n[0])?or.areVector2sEqual(r[0],n[n.length-1],1e-5)&&(t.push(r),r=[]):or.areVector2sEqual(a[0],n[n.length-1])?or.areVector2sEqual(r[1],n[0],1e-5)&&(t.push(r),r=[]):r=[]}}return t};if(a.boundaryPaths.forEach(((e,t)=>{let r=[];if(this.IsfilteredByPathTypeFlag(e.pathTypeFlag)){let r="[Dxf] The %d path type flag is filtered at the %dth boundrayPath (hatch handle '%s')";return void de.info(r,e.pathTypeFlag,t,a.handle)}let i=e.edges;if(0===i.length)return;let n=[];for(let e=0;e<i.length;e++){let r=this.convertEdgeToPoints(i[e]);if(r.length<2){let r="[Dxf] The %dth edge of the %dth boundaryPath (hatch handle '%s') has less than 2 points, ignored!";de.warn(r,e,t,a.handle)}else n.push(...r)}if(n.length<3){let e="[Dxf] The %dth boundaryPath (hatch handle '%s') has less than 3 points, ignored!";de.warn(e,t,a.handle)}else if(r.push(n),e.pathTypeFlag>31&&(!(e=>{for(let t=1;t<e.length;++t){let r=e[t-1].endPoint,i=e[t].startPoint;if(!r||!i||!or.areVector2sEqual(r,i))return!1}return!0})(e.edges)||!a.associativity)&&(r=h(i),r.length<2)){let e="[Dxf] The %dth boundaryPath (hatch handle '%s') has unknown path, ignored!";de.warn(e,t,a.handle)}else r.forEach((e=>{or.areVector2sEqual(e[0],e[e.length-1])||e.push(e[0]);let t=e.map((e=>new Te(Ut.roundNumber(e.x,7),Ut.roundNumber(e.y,7))));if((null==t?void 0:t.length)>0){s.push(t);let e=(new ts).setFromPoints(t);o.push(e);let r=e.getSize(xw),i=r.x*r.y;l.push({area:i,index:s.length-1})}}))})),0===s.length)return;let c=new Te,u=this.checkAndRebasePolygonsOnRTC(s,c);l.sort(((e,t)=>e.area-t.area));let d=[];l.forEach((e=>{d.push(e.index)}));let p,f=this.buildContainHierarchyTree(s,o,d),m=[];if(this.buildHatchGeometry(s,f,m),m.length>0&&(p=qi(m)),!p||!p.getIndex()||0===(null==(n=p.getIndex())?void 0:n.count))return void de.warn("[Dxf] Failed to convert hatch boundaries!");let g=new Ar(4);g.geometry=p,g.material=lb,this.setHatchMaterial(g,a,t,c,r);let v=g;return u&&(this.setRTCUserData(v),v.matrix.setPosition(c.x,c.y,0)),v.traverse((e=>{e.layers.enableAll(),e.layers.disable(11)})),v}loadOle2frame(e,t){let{leftUpX:r,leftUpY:i,rightDownX:n,rightDownY:a}=e;if(!(r&&i&&n&&a))return;let s=[new Te(r,i),new Te(r,a),new Te(n,a),new Te(n,i),new Te(r,i)],o=new F,l=!1;this.enableRTC&&(l=pr.checkAndRebasePositionsOnRTC(s,o));let h=(new Nt).setFromPoints(s),c=this.getLineBasicMaterial(16777215),u=new Ar(2);u.geometry=h,u.material=c,u.layers.enableAll(),l&&(this.setRTCUserData(u),u.matrix.setPosition(o.x,o.y,0));let d=new Ar;d.add(u);let p,f,m=t.objects.DICTIONARY;for(let t of m){let r=t;for(let t in r.entries)if(r.entries[t]===e.handle){p=t;break}}if(p)if(this.meshTextureMaterials[p])f=this.meshTextureMaterials[p];else for(let e=0;e<t.objects.XRECORD.length;e++){let r=t.objects.XRECORD[e];if(r.handle===p){let e=r.binaryData,t="data:image/jpg;base64,"+Ut.hexToBase64(e),i=new Ds(this.manager).load(t);i.colorSpace=Zr;let n=new Mr({transparent:!0,map:i});this.meshTextureMaterials[p]=n,f=n;break}}if(f){let e=(new ts).setFromPoints(s),t=e.getSize(xw),r=new vs(t.x,t.y),i=new Ar(4);i.geometry=r,i.material=f;let n=e.getCenter(xw);Ur.set(n.x,n.y,0),l&&(this.setRTCUserData(i),Ur.x+=o.x,Ur.y+=o.y),i.matrix.setPosition(Ur),i.layers.enableAll(),d.add(i)}return d.children.length>1?d:u}static getOcsMatrix(e){let t=Du,r=MG,i=ob,n=new F(0,1,0),a=new F(0,0,1);return or.areVectorsClose(e,a)?_a.identity():(i=e.clone().normalize(),or.areVectorsClose(i,a)||(t=Math.abs(i.x)<1/64&&Math.abs(i.y)<1/64?n.cross(i).normalize():a.cross(i).normalize(),r=i.clone().cross(t).normalize()),_a.set(t.x,t.y,t.z,0,r.x,r.y,r.z,0,i.x,i.y,i.z,0,0,0,0,1))}static getDcs2WcsMatrix(e,t){let r;r=fAt(e)?e.viewDirectionFromTarget:e.viewDirection;let i,n,a,s=new F(or.roundNumber(r.x,7),or.roundNumber(r.y,7),r.z),o=new F(e.viewTarget.x,e.viewTarget.y,e.viewTarget.z),l=e.viewTwistAngle||0;a=s.clone().normalize(),i=ob.clone().cross(s),i.length()>0?(i.normalize(),n=a.clone().cross(i)):a.z<0?(i=Du.clone().negate(),n=MG,a=ob.clone().negate()):(i=Du,n=MG,a=ob);let h=new lt,c=_a.identity();return c.makeBasis(i,n,a),h.premultiply(c),h.premultiply(_a.identity().compose(o.clone(),(new dn).setFromAxisAngle(new F(0,0,1),Tr.degToRad(t?l:-l)),new F(1,1,1))),h}getViewportMsToPsMatrix(e){let t=new F(e.centerPoint_dcs.x,e.centerPoint_dcs.y,0),r=new F(e.centerPoint.x,e.centerPoint.y,e.centerPoint.z),i=e.viewHeight/e.height_paperSpace,n=An.getDcs2WcsMatrix(e,this.angDir),a=new lt;a.setPosition(M_e.clone().sub(r));let s=R_e.identity();s.scale(Ur.set(i,i,i));let o=Jp.identity().setPosition(M_e.clone().sub(r));s.premultiply(o.clone().invert()).multiply(o),a.multiply(s);let l=_a.identity();l.setPosition(t),n.multiply(l);let h=_a.identity();return a.invert().multiply(h).multiply(n.invert())}loadViewport(e,t,r){let i=e;if("1"==i.viewportId)return e.psBBox=new Vt,void(e.msToPsMatrix=new lt);let n=[],a=i.centerPoint,s=i.width_paperSpace/2,o=i.height_paperSpace/2;n.push(new F(a.x-s,a.y-o,0)),n.push(new F(a.x-s,a.y+o,0)),n.push(new F(a.x+s,a.y+o,0)),n.push(new F(a.x+s,a.y-o,0)),n.push(n[0]),e.psBBox=new Vt(n[0],n[2]),e.msToPsMatrix=this.getViewportMsToPsMatrix(i);let l=new F,h=!1;this.enableRTC&&(h=pr.checkAndRebasePositionsOnRTC(n,l));let c=(new Nt).setFromPoints(n),u=new Ar(2);u.geometry=c,u.material=Fa,h&&(this.setRTCUserData(u),u.matrix.setPosition(l.x,l.y,0)),u.userData.entityType=e.type,u.layers.enableAll();let d=new Ar;d.add(u);let p=e.psBBox.clone();p.applyMatrix4(e.msToPsMatrix.clone().invert()),p.min.z=0,p.max.z=0;let f=[];f.push(p.min),f.push(new F(p.min.x,p.max.y,0)),f.push(p.max),f.push(new F(p.max.x,p.min.y,0)),f.push(f[0]);let m=new F,g=!1;this.enableRTC&&(g=pr.checkAndRebasePositionsOnRTC(f,m));let v=(new Nt).setFromPoints(f),y=new Ar(2);return y.geometry=v,y.material=Fa,g&&(this.setRTCUserData(y),y.matrix.setPosition(m.x,m.y,0)),y.userData.entityType=e.type,y.userData.inPaperSpace=!0,y.layers.enableAll(),d.add(y),u}getColor(e,t,r){var i,n,a,s;if(this.compareContext)return Ea.ENTITY_COLOR_NO_CHANGE;if(null!=this.overrideColor)return this.overrideColor;let o=e;if(o&&o.isGradientColor){let t=o.gradientColors;if(t&&t.length>=2){if(t[0]!==t[1]){let t=`[Dxf] Gradient colors are not supported for hatch '${e.handle}', will use the first color!`;de.warn(t)}return t[0]}}if(e.isTrueColor||e.colorIndex>0&&e.colorIndex<256)return e.color;if(0===e.colorIndex)return r?this.getColor(r,t):null==(n=null==(i=t.tables)?void 0:i.layer)?void 0:n.layers[0].color;if(256===e.colorIndex){let i=null==(s=null==(a=t.tables)?void 0:a.layer)?void 0:s.layers,n=i&&i[e.layer],o=i&&r&&i[r.layer],l=tm;return n&&"0"!==n.name?l=n.color:o?l=o.color:n?l=n.color:i&&i[0].color&&(l=i[0].color),l}return de.warn("[Dxf] Unknown colorIndex"),tm}getLineType(e,t,r){var i,n;if(r&&"DIMENSION"===r.type)return this.getLineType(r,t);if(e.lineType!==nb&&e.lineType!==ib)return e.lineType;if(e.lineType===ib)return r?this.getLineType(r,t):e.lineType;let a=null==(n=null==(i=t.tables)?void 0:i.layer)?void 0:n.layers,s=dAt;if("0"!==e.layer){let t=a&&a[e.layer];if(t)return t.lineType}else if(r){let e=a&&a[r.layer];if(e)return e.lineType}return s}getLayerName(e,t,r){var i,n;let a=t=>{s&&t&&!s[e.layer]&&(console.warn(`[Dxf] Failed to find layer object for '${t}', adding a default one.`),s[t]={name:t,handle:"",colorIndex:256,lineType:"",visible:!0})},s=null==(n=null==(i=t.tables)?void 0:i.layer)?void 0:n.layers;a(e.layer);let o=s&&s[e.layer];a(null==r?void 0:r.layer);let l=s&&r&&s[r.layer],h=(null==o?void 0:o.name)||"";return o&&"0"===o.name&&l&&(h=l.name),h}setMaterial(e,t,r,i){var n,a;let s=e;if(!s.geometry||(this.setRenderOrderByObjectType(e),"OLE2FRAME"===t.type))return;if("MTEXT"===t.type)return void(e.renderOrder=5);if("HATCH"===t.type)return xw.set(0,0),void this.setHatchMaterial(e,t,r,xw,i);if("IMAGE"===t.type)return;let o,l=this.getColor(t,r,i);if("LWPOLYLINE"===t.type&&(s.isMesh?(o=this.getMeshBasicMaterial(l),e.renderOrder=1):e.userData.isOutline&&(o=this.getLineBasicMaterial(l),e.renderOrder=3),o))s.material=o;else{if("SOLID"===t.type)o=this.getMeshBasicMaterial(l);else if("TEXT"===t.type||"ATTDEF"===t.type||"ATTRIB"===t.type)o=this.getLineBasicMaterial(l),e.renderOrder=5;else if("LEADER"===t.type||"MULTILEADER"===t.type||"VIEWPORT"===t.type)o=this.getLineBasicMaterial(l);else if("POINT"===t.type)o=this.getPointsMaterial(l);else{if(e.material instanceof Ai)return o=this.getPointsMaterial(l),void(s.material=o);let h=null==(a=null==(n=r.tables)?void 0:n.lineType)?void 0:a.lineTypes,c=h&&h[this.getLineType(t,r,i)];if(c&&c.pattern&&0!==c.pattern.length){let r=t.lineTypeScale||1;o=this.getLineShaderMaterial(c,l,r),e.renderOrder=3}else o=this.getLineBasicMaterial(l)}s.material=o}}setHatchMaterial(e,t,r,i,n){let a=e;if(!a.geometry)return;let s=this.getColor(t,r,n);if(2===a.type||3===a.type)return void(a.material=this.getLineBasicMaterial(s));let o,l=-1;if(t.solidFill)o=this.getMeshBasicMaterial(s);else{if(a.material instanceof xr){o=a.material;let e=new dt(s);a.material.uniforms.u_color.value.equals(e)||(o=a.material.clone(),An.updateMaterialUniforms(o),o.uniforms.u_color.value.set(s))}else o=this.getHatchShaderMaterial(t,s,i);l=0}o||(o=this.getMeshBasicMaterial(s),l=-1),a.material=o,a.renderOrder=l}setRenderOrderByObjectType(e){let t=e,r=0;t.isMesh?r=-1:t.isLine?r=2:t.isPoints&&(r=4),e.renderOrder=r}getPointsMaterial(e){return this.pointsMaterials[e]||(this.pointsMaterials[e]=new Ai({size:.2,color:e})),this.pointsMaterials[e]}getLineBasicMaterial(e){return this.lineBasicMaterials[e]||(this.lineBasicMaterials[e]=new Yr({color:e})),this.lineBasicMaterials[e]}getLineShaderMaterial(e,t,r){let i=`${e.name}_${t}_${r}`;if(!this.lineShaderMaterials[i]){let n=this.getLineTypeScales(),a=n.ltScale*n.celtScale*r;this.lineShaderMaterials[i]=lI.createLineShaderMaterial(e.pattern,t,a,An.ViewportScaleUniform,An.CameraZoomUniform)}return this.lineShaderMaterials[i]}getMeshBasicMaterial(e){return this.meshBasicMaterials[e]||(this.meshBasicMaterials[e]=new Mr({color:e})),this.meshBasicMaterials[e]}getHatchShaderMaterial(e,t,r){if(!e.patternLines||e.patternLines.length<1)return;let i=this.findMatchedHatchShaderMaterial(e,t);if(i)return i;let n=2;e.patternLines.forEach((e=>{n=Math.max(e.dashPattern.length,n)}));let a=0,s=[],o=new Te;for(let t of e.patternLines){let i=new Te(t.origin.x,t.origin.y).sub(r).rotateAround(o,-Tr.degToRad(e.patternAngle)),l=new Te(t.delta.x,t.delta.y).rotateAround(o,-Tr.degToRad(t.angle));if(0===l.y)return void de.warn("[Dxf] delta.y is equal to zero !");let h=t.dashPattern.length,c=!0,u=0;for(let e=0;e<h;++e){let r=t.dashPattern[e];r>0&&(c=!1),u+=Math.abs(r)}let d=c?.05:.005,p=[],f=[],m=0;f[0]=m;for(let e=0;e<h;++e)p[e]=t.dashPattern[e],0===p[e]&&(p[e]=d*u),m+=Math.abs(p[e]),f[e+1]=m;for(let e=h;e<n;++e)p[e]=0;for(let e=f.length;e<n+1;++e)f[e]=m;let g={origin:i,delta:l,angle:t.angle-e.patternAngle,pattern:p,patternSum:f,patternLength:m};if(a+=4,a+=n,a+=n+1,a>An.MaxFragmentUniforms){de.warn("[Dxf] There will be warning in fragment shader when number of uniforms exceeds 1024, so extra hatch line patterns are ignored here!");break}s.push(g)}let l=v_e(s,e.patternAngle,An.CameraZoomUniform,new dt(t),this.overrideHatchPatternLineThickness);return l.defines={MAX_PATTERN_SEGMENT_COUNT:n},this.hatchShaderMaterials.push({patternLines:e.patternLines,patternAngle:e.patternAngle,color:t,material:l}),l}getDivision(e,t,r){let i=Math.round(5e4/this.entityCount);i=Math.max(i,2),i=Math.min(i,10);let n=5*i,a=2*i;if(this.averageCurveSize){a*=Math.pow(r/this.averageCurveSize,.5),a=Math.max(a,i),a=Math.min(a,n)}let s=t-e;s<0&&(s+=2*Math.PI),a=Math.ceil(a*(s/Math.PI));let o=8;return s<.087?o=2:s<.174?o=3:s<.52?o=4:s<1.57?o=5:s<3.14?o=6:s<4.71&&(o=7),a=Math.max(a,o),this.averageCurveSize=(this.averageCurveSize*this.curveCount+r)/(this.curveCount+1),this.curveCount++,Math.max(a,12)}getBSplineInterpolationsPerSplineSegment(e,t){let r=1;this.averageCurveSize&&(r=Math.pow(t/this.averageCurveSize,.5),r=Math.max(r,.5),r=Math.min(r,2)),this.averageCurveSize=(this.averageCurveSize*this.curveCount+t)/(this.curveCount+1),this.curveCount++;let i=2*e*r;if(e>20){i/=Math.log10(e)}return i}setDxfDataToIndexedDb(e,t){return bt(this,null,(function*(){let r={dxfDataId:e,dxf:t};return new Promise(((t,i)=>{$1.instance().add(r,(()=>{de.info(`[Dxf] Saved '${e}' to indexedDb`),t()}),(e=>{i(e)}))}))}))}getDxfDataFromIndexedDb(e){return bt(this,null,(function*(){return new Promise(((t,r)=>{$1.instance().query(e,(e=>{e&&e.length>0&&t(e[0].dxf),t(void 0)}),(()=>r()))}))}))}buildContainHierarchyTree(e,t,r){var i;let n=new Map,a=r.length;for(let e=0;e<a;e++)n.set(r[e],{index:r[e],children:[]});let s={index:-1,children:[]};for(let o=0;o<a;o++){let l=r[o],h=e[l],c=t[l],u=o+1;for(;u<a;u++){let a=r[u],s=e[a];if(t[a].containsBox(c)&&pr.isPointInPolygon(h[Ut.generateRandomInt(0,h.length-1)],s)){null==(i=n.get(a))||i.children.push(n.get(l));break}}u===a&&s.children.push(n.get(l))}return s}buildHatchGeometry(e,t,r){if(0===t.children.length)return;let i=[],n=new Map;t.children.forEach((e=>{0===e.children.length?i.push(e.index):n.set(e.index,e.children.map((e=>e.index)))}));let a=e=>{try{let t=new hc(e);t.hasAttribute("uv")&&t.deleteAttribute("uv"),t.hasAttribute("normal")&&t.deleteAttribute("normal"),r.push(t)}catch(t){de.warn(`[Dxf] triangulate shape error: ${e.getPoints().map((e=>e.toArray())).toString()}`)}};i.forEach((t=>{let r=e[t];if(0===r.length)return;let i=new Ys(r);a(i)}));let s=e=>e.map((e=>e.toArray()));for(let t of n){let r=new Ys(e[t[0]]),i={regions:[],inverted:!1},n=this.findIntersectHole(e,t[1]);n.forEach((t=>{let n={regions:[],inverted:!1};try{t.forEach(((t,a)=>{if(Oc.epsilon(or.getVector2RelativeEps(e[t][0]),1e-6),0===a)n=Oc.segments({regions:[s(e[t])],inverted:!1});else{let a=Oc.segments({regions:[s(e[t])],inverted:!1}),o=Oc.combine(n,a);i=Oc.polygon(Oc.selectUnion(o)),i.regions.length>0?i.regions.forEach((e=>{if(0===e.length)return;let t=e.map((e=>new Te(e[0],e[1])));r.holes.push(new xh(t))})):de.warn("[Dxf] mergedHoles.regions is empty")}}))}catch(e){de.warn(`[Dxf] polybooljs has error: ${e}, epsilon is ${Oc.epsilon()}`)}}));let o=n.flat(2);for(let i=0;i<t[1].length;i++){let n=t[1][i];o.includes(n)||r.holes.push(new xh(e[n]))}a(r)}t.children.forEach((t=>{t.children.forEach((t=>{this.buildHatchGeometry(e,t,r)}))}))}findIntersectHole(e,t){let r=t.length,i=[];for(let n=0;n<r;n++){let a=e[t[n]],s=!1,o=[];for(let i=n+1;i<r;i++){let r=e[t[i]];pr.arePolygonsIntersect(a,r)&&(s=!0,o.push(t[i]))}s&&(o.push(t[n]),i.push(o))}return i}checkAndRebasePolygonsOnRTC(e,t){if(!this.enableRTC||0===e.length)return!1;let r=0;e.forEach((e=>{e.forEach((e=>{t.add(e),r++}))})),t.divideScalar(r);let i=!1;if(this.enableRTC&&pr.shouldRebasePositionOnRTC(t)){i=!0;for(let r=0;r<e.length;r++){let i=e[r];for(let e=0;e<i.length;e++){let r=i[e].x-t.x,n=i[e].y-t.y;i[e]=new Te(r,n)}}}else t.set(0,0);return i}setRTCUserData(e){e.userData.relativeToCenter=!0,this.statsInfo.rebasedEntityCount++}IsfilteredByPathTypeFlag(e){return e<0}findSpatialFilterByHandle(e,t){let r=t.objects.DICTIONARY;if(!r)return;if(!this.dictionaryOwnerHandleAndSpatialFilterHandlesCache){this.dictionaryOwnerHandleAndSpatialFilterHandlesCache={};for(let e of r){let t=e,r="";for(let e in t.entries)if("ACAD_FILTER"===t.entries[e]){r=e;break}r&&(this.dictionaryOwnerHandleAndSpatialFilterHandlesCache[e.ownerHandle]&&de.warn("[Dxf] Why this.dictionaryObjectsCache[obj.ownerHandle] already exist?",e.ownerHandle),this.dictionaryOwnerHandleAndSpatialFilterHandlesCache[e.ownerHandle]=r)}}let i=this.dictionaryOwnerHandleAndSpatialFilterHandlesCache[e];if(i){if(!this.spatialFiltersCache){this.spatialFiltersCache={};let e=t.objects.SPATIAL_FILTER||[];for(let t of e){let e=t;e.numberOfPointsOnClipBoundary<2||(this.spatialFiltersCache[e.ownerHandle]&&de.warn("[Dxf] Why this.spatialFiltersCache[spatialFilterObj.ownerHandle] already exist?",i),this.spatialFiltersCache[e.ownerHandle]=e)}}return this.spatialFiltersCache[i]}}initRenderOrderInfo(e){let t=new Set,r=e.objects.DICTIONARY;for(let e of r){let r=e;Object.keys(r.entries).forEach((e=>{r.entries[e]&&"ACAD_SORTENTS"===r.entries[e]&&t.add(e)}))}if(0===t.size)return;let i=e.objects.SORTENTSTABLE;if(i)for(let e=0;e<i.length;++e){let r=i[e];if(t.has(r.handle)){for(let e=0;e<r.sortEntsObject.entityHandles.length;++e){let t=r.sortEntsObject.entityHandles[e];2!==t.length||this.entityHandlesWithRenderOrder[t[0]]?de.warn(`[Dxf] Failed to handle sortEntsTable: ${r.handle}.`):this.entityHandlesWithRenderOrder[t[0]]=t[1]}break}}}findMatchedHatchShaderMaterial(e,t){let r=e.patternLines;if(!r||r.length<1)return;let i=(e,t)=>Math.abs(e-t)<1e-5,n=(e,t)=>i(e.angle,t.angle)&&i(e.delta.x,t.delta.x)&&i(e.delta.y,t.delta.y)&&i(e.origin.x,t.origin.x)&&i(e.origin.y,t.origin.y)&&((e,t)=>{if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!i(e[r],t[r]))return!1;return!0})(e.dashPattern,t.dashPattern),a=this.hatchShaderMaterials.find((i=>i.color===t&&i.patternAngle===e.patternAngle&&((e,t)=>{if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!n(e[r],t[r]))return!1;return!0})(i.patternLines,r)));return null==a?void 0:a.material}getLayout(e,t){var r,i;if(!this.blockRecordsCache){this.blockRecordsCache={};let t=this.blockRecordsCache,n=null==(i=null==(r=e.tables)?void 0:r.blockRecord)?void 0:i.blockRecords;n&&Object.values(n).forEach((e=>{t[e.handle]=e.layoutHandle}))}let n=this.blockRecordsCache[t.ownerHandle];if(n){let t=e.objects.LAYOUT.find((e=>e.handle===n));if(t)return t}if(!this.entitiesCache){this.entitiesCache={};let t=this.entitiesCache;Object.values(e.entities).forEach((e=>{t[e.handle]=e}))}let a=this.entitiesCache[t.ownerHandle];return a?this.getLayout(e,a):(de.warn("[Dxf] Failed to find layout name for entity:",t),e.objects.LAYOUT.find((e=>e.layoutName===An.MODEL_LAYOUT_NAME)))}getLayerVisible(e,t){var r,i,n;let a=null==(i=null==(r=e.tables)?void 0:r.layer)?void 0:i.layers;return a&&(null==(n=a[t])?void 0:n.visible)}getLayerFrozen(e,t){var r,i,n;let a=null==(i=null==(r=e.tables)?void 0:r.layer)?void 0:i.layers;return a&&(null==(n=a[t.layer])?void 0:n.frozen)}cloneMaterialsForSpatialFilter(e){let t=new Map;e.traverse((e=>{e.material&&(e.material=(e=>{let r;return Array.isArray(e)?(r=[],e.forEach((e=>{if(t.has(e.id))r.push(t.get(e.id));else{let i=e.clone();An.updateMaterialUniforms(i),t.set(e.id,i),r.push(i)}}))):e&&(t.has(e.id)?r=t.get(e.id):(r=e.clone(),An.updateMaterialUniforms(r),t.set(e.id,r))),r})(e.material))}))}getLineTypeScales(){let e={ltScale:1,celtScale:1};return this.header&&(e.ltScale=this.header.$LTSCALE||1,e.celtScale=this.header.$CELTSCALE||1),e}static getDxfUnits(e){switch(e||0){case 0:return"Unitless";case 1:return"Inches";case 2:return"Feet";case 4:return"Millimeters";case 5:return"Centimeters";case 6:return"Meters";default:de.warn(`[Dxf] Unsupported $INSUNITS '${e}'`)}return"Unitless"}static computeLineDistance(e){let t=!0===e.isLineSegments,r=e.geometry,i=e.matrixWorld;if(r.index&&(de.debug(`[Dxf] Line with id '${e.id}' contains index buffer, going to convert it to non-indexed.`),r=pr.convertGeometryWithIndexedToNonIndexed(r),e.userData.batches&&e.userData.batches.length>0)){de.debug("[Dxf] This line has been merged!");let t=0;e.userData.batches.forEach((e=>{e.positionStart=t,e.positionCount=e.indexCount,e.indexStart=0,e.indexCount=0,t+=e.positionCount}))}if(null===r.index){let n=r.attributes.position;if(!n||0===n.count)return;let a=[];if(t)for(let e=0,t=n.count;e<t;e+=2)Ur.fromBufferAttribute(n,e).applyMatrix4(i),_i.fromBufferAttribute(n,e+1).applyMatrix4(i),a[e]=0===e?0:a[e-1],a[e+1]=a[e]+Ur.distanceTo(_i);else{a[0]=0;for(let e=1,t=n.count;e<t;e++)Ur.fromBufferAttribute(n,e-1).applyMatrix4(i),_i.fromBufferAttribute(n,e).applyMatrix4(i),a[e]=a[e-1],a[e]+=Ur.distanceTo(_i)}r.setAttribute("lineDistance",new zt(a,1)),e.geometry=r}else de.warn("[Dxf] computeLineDistances only possible with non-indexed BufferGeometry.")}static computeLineDistances(e){let t=Date.now();e.traverse((e=>{let t=e;t.isLine&&t.material instanceof xr&&An.computeLineDistance(t)})),de.debug(`[Dxf] Computed line distances in ${(Date.now()-t)/1e3}s`)}static mergeDxfObjects(e){let t=Date.now(),r={},i={},n=0,a=0,s=()=>{let e=Date.now();for(let e in r){let t=r[e];An.removeEmptyObjectsFromRemovingMarkedObjects2(t.children,t.object),t.children=[]}n=0,a+=Date.now()-e};for(let t in e.layersAndObjects){let o=e.layersAndObjects[t];if(o.length<=1)continue;let l=Date.now(),h={},c=[];for(let e of o){if(e.userData.isSnapObject){c.push(e);continue}let t,r=e;for(;r;){if(r.userData.isLayoutLevelObject){t=r;break}r=r.parent}if(!t)continue;let i=t.name;h[i]||(h[i]={object:t,children:[]}),h[i].children.push(e)}for(let e in h){let t=h[e],o=Ou.deepMerge(t.children,t.object,!1,!1,!0),l=o.added,u=o.removed;r[e]||(r[e]={object:t.object,children:[]}),i[e]||(i[e]={object:t.object,children:[]});let d=u.length>15e3;if(d){let e=Date.now();An.removeEmptyObjectsFromRemovingMarkedObjects2(u,t.object),a+=Date.now()-e}else n+=u.length;if(u.length===t.children.length)d||u.forEach((t=>{r[e].children.push(t)}));else{let i=u;u.length>=100&&(i=new Set(u));let n=e=>Array.isArray(i)?i.indexOf(e)>=0:i.has(e);for(let i=0;i<t.children.length;i++){let a=t.children[i];n(a)?d||r[e].children.push(a):c.push(a)}}for(let t=0;t<l.length;t++){let r=l[t];c.push(r),i[e].children.push(r)}n>15e3&&s()}e.layersAndObjects[t]=c,de.debug(`[Dxf] Merged layer '${t}' in ${(Date.now()-l)/1e3}s`)}n>0&&s();for(let t in i){let r=i[t];e.root.children.find((e=>e.name===t))||e.root.add(r.object),r.children.forEach((e=>{r.object.add(e)})),r.children=[]}de.debug(`[Dxf] MergeUtils.deepMerge costed ${Zi.MergeInfo.elapsedTime/1e3}s`),de.debug(`[Dxf] The remove operation of deep merge costed ${a/1e3}s`),de.debug(`[Dxf] Deep merge totally costed ${(Date.now()-t)/1e3}s`);let o=Zi.MergeInfo;de.debug(`[Dxf] Totally merged ${o.removedObjects} objects to ${o.mergedMeshes} meshes, ${o.mergedLines} lines, ${o.mergedPoints} points, ${o.mergedUnknownTypeObjects?o.mergedUnknownTypeObjects+" unknown type,":""} `)}static merge(e,t){return bt(this,null,(function*(){let r=Ut.getUpdateProgressFuncAsync(t),i={};e.objects.LAYOUT.forEach((e=>{var t;let r=e;i[r.layoutName]=r,null==(t=r.directAssociatedLeafObjectSet)||t.clear()}));let n=Date.now(),a={},s={},o=0,l=0,h=()=>{let e=Date.now();for(let e in a){let t=a[e];An.removeEmptyObjectsFromRemovingMarkedObjects(t.children,t.object),t.children=[]}o=0,l+=Date.now()-e},c=Object.keys(e.layersAndThreejsObjects).length,u=0;for(let t in e.layersAndThreejsObjects){let n=e.layersAndThreejsObjects[t];if(n.length<=1){yield r(++u/c*100);continue}let d=Date.now(),p={},f=[];for(let e of n){if(e.userData.isSnapObject){f.push(e);continue}let t,r=e;for(;r;){if(r.userData.isLayoutLevelObject){t=r;break}r=r.parent}if(!t)continue;let i=t.name;p[i]||(p[i]={object:t,children:[]}),p[i].children.push(e)}let m=Object.keys(p).length,g=0;for(let e in p){let t;if(e!==An.MODEL_LAYOUT_NAME){let r=i[e];r.directAssociatedLeafObjectSet||(r.directAssociatedLeafObjectSet=new Set),t=r.directAssociatedLeafObjectSet}let n=p[e],d=Zi.deepMerge(n.children,n.object,!1,!1,!0),v=d.added,y=d.removed;a[e]||(a[e]={object:n.object,children:[]}),s[e]||(s[e]={object:n.object,children:[]});let b=y.length>15e3;if(b){let e=Date.now();An.removeEmptyObjectsFromRemovingMarkedObjects(y,n.object),l+=Date.now()-e}else o+=y.length;if(y.length===n.children.length)b||y.forEach((t=>{a[e].children.push(t)}));else{let r=y;y.length>=100&&(r=new Set(y));let i=e=>Array.isArray(r)?r.indexOf(e)>=0:r.has(e);for(let r=0;r<n.children.length;r++){let s=n.children[r];i(s)?b||a[e].children.push(s):(f.push(s),t&&t.add(s))}}for(let r=0;r<v.length;r++){let i=v[r];pn.setSharedVariablesOfObject(i),f.push(i),s[e].children.push(i),t&&t.add(i)}o>15e3&&h(),yield r((u+ ++g/m)/c*100)}yield r(++u/c*100),e.layersAndThreejsObjects[t]=f,de.debug(`[Dxf] Merged layer '${t}' in ${(Date.now()-d)/1e3}s`)}o>0&&h();for(let t in s){let r=s[t],n=e.threejsObject.children.find((e=>e.name===t));if(n){let e=n.children.find((e=>e.name===An.SNAP_GROUP_NAME));if(e&&t!==An.MODEL_LAYOUT_NAME){let r=i[t];r.directAssociatedLeafObjectSet||(r.directAssociatedLeafObjectSet=new Set),e.children.forEach((e=>{var t;return null==(t=r.directAssociatedLeafObjectSet)?void 0:t.add(e)}))}}n||e.threejsObject.add(r.object),r.children.forEach((e=>{e.visible||(e.userData.layerVisible=!1),r.object.add(e),e.updateWorldMatrix(!1,!1)})),r.children=[]}de.debug(`[Dxf] MergeUtils.deepMerge costed ${Zi.MergeInfo.elapsedTime/1e3}s`),de.debug(`[Dxf] The remove operation of deep merge costed ${l/1e3}s`),de.debug(`[Dxf] Deep merge totally costed ${(Date.now()-n)/1e3}s`);let d=Zi.MergeInfo;de.debug(`[Dxf] Totally merged ${d.removedObjects} objects to ${d.mergedMeshes} meshes, ${d.mergedLines} lines, ${d.mergedPoints} points, ${d.mergedUnknownTypeObjects?d.mergedUnknownTypeObjects+" unknown type,":""} `),r(100)}))}printStatsInfo(){for(let e in this.entityTypesAndTimes)this.entityTypesAndTimes[e].averageTime=this.entityTypesAndTimes[e].totalTime/this.entityTypesAndTimes[e].createCount;de.debug("[Dxf] Entity types and cost times in ms:",this.entityTypesAndTimes),de.debug("[Dxf] Entity types and mesh count:",this.statsInfo.entityTypesAndMeshCount);let e=0;if(Object.values(this.statsInfo.entityTypesAndMeshCount).forEach((t=>{e+=t})),this.enableRTC&&de.debug(`[Dxf] Totally rebased ${this.statsInfo.rebasedEntityCount}(out of ${e}) entities`),this.enableMerge){let e=Zi.MergeInfo;de.debug(`[Dxf] Inner merged ${e.removedObjects} objects to ${e.mergedMeshes} meshes, ${e.mergedLines} lines, ${e.mergedPoints} points, ${e.mergedUnknownTypeObjects?e.mergedUnknownTypeObjects+" unknown type,":""} in ${e.elapsedTime/1e3}s`)}let t=(e,t,...r)=>{Object.keys(t).length};t(0,this.statsInfo.unsupportedEntityTypes),t(0,this.statsInfo.unsupportedTextStyles),t(0,this.statsInfo.unsupportedHatchPatterns),this.statsInfo.unsupportedPolylineCount&&de.warn(`[Dxf] Unsupported polyline (with both width and linetype) count: ${this.statsInfo.unsupportedPolylineCount}, linetype will be ignored.`),t(0,this.statsInfo.invisibleEntities),t(0,this.statsInfo.ignoredFrozenLayersAndEntityCount),t(0,this.statsInfo.ignoredInserts),this.ignorePaperSpace&&t(0,this.statsInfo.ignoredPaperSpaceEntityTypesAndCount),this.font&&t(0,this.font.getUnsupportedChar())}static statLayoutAndLayerObjects(e){let t=new WeakSet,r=0;for(let i in e.layersAndThreejsObjects)e.layersAndThreejsObjects[i].forEach((e=>{e.geometry&&(r++,t.has(e)?console.warn(e):t.add(e))}));let i=new WeakSet,n=0;if(e.threejsObject.traverse((e=>{e.geometry&&(n++,i.has(e)?console.warn(e):i.add(e))})),r!=n)for(let t in e.layersAndThreejsObjects)e.layersAndThreejsObjects[t].forEach((e=>{e.geometry&&(i.has(e)||console.warn(e))}));de.info(`[Dxf] The count of layer objects is ${r},The count of layout objects is ${n} `)}static removeEmptyObjectsFromRemovingMarkedObjects(e,t){if(0===e.length)return;let r=e=>{let i=[];for(let r of e){r.userData.validCount=0;let e=r.parent;e&&e!==t&&(void 0===e.userData.validCount&&(e.userData.validCount=e.children.length),0==--e.userData.validCount&&i.push(e))}i.length>0&&r(i)};r(e),this.removeEmptyObjectsFromMark(t)}static removeEmptyObjectsFromMark(e){if(0===e.userData.validCount||pn.isEmptyObject(e))return e.removeFromParent(),!0;for(let t=0;t<e.children.length;)this.removeEmptyObjectsFromMark(e.children[t])||++t;return!1}static removeEmptyObjectsFromRemovingMarkedObjects2(e,t){if(0===e.length)return;let r=e=>{let i=[];for(let r of e){r.userData.validCount=0;let e=r.parent;e&&e!==t&&(void 0===e.userData.validCount&&(e.userData.validCount=e.children.length),0==--e.userData.validCount&&i.push(e))}i.length>0&&r(i)};r(e),this.removeEmptyObjectsFromMark2(t)}static removeEmptyObjectsFromMark2(e){if(0===e.userData.validCount||0===e.type&&0===e.children.length)return e.removeFromParent(),!0;for(let t=0;t<e.children.length;)this.removeEmptyObjectsFromMark2(e.children[t])||++t;return!1}},Qr=An;Qr.MODEL_LAYOUT_NAME="Model",Qr.SNAP_GROUP_NAME="InvisibleObjectGroupForOSnap",Qr.SHOW_SNAP_OBJECT=!1,Qr.CameraZoomUniform={value:1},Qr.ViewportScaleUniform={value:1},Qr.TransformMatrixUniform={value:new lt},Qr.ResolutionUniform={value:new Te},Qr.MaxFragmentUniforms=1024;var T0=class{constructor(e){this.buffer=e,this.u8=new Uint8Array(e)}getBit(e){var t=7&e;return(this.u8[e>>3]&128>>t)>>7-t}setBit(e,t){var r=e>>3,i=this.u8[r],n=7&e;this.u8[r]=t?i|128>>n:i&~(128>>n)}getInt12(e){var t=e/8|0,r=this.u8[t],i=this.u8[t+1],n=this.u8[t+2],a=e%8,s=8-a,o=Math.min(12-s,8);return(((r&=~(255<<s))<<16)+((i&=255<<8-o)<<8)+(n&=255<<8-Math.max(12-s-o,0))>>12-a)-2048}setInt12(e,t){var r=e/8|0,i=e%8,n=(t+=2048)<<12-i,a=(16711680&n)>>16,s=(65280&n)>>8,o=255&n,l=8-i,h=Math.min(12-l,8),c=Math.max(12-l-h,0),u=255<<l;this.u8[r]=(this.u8[r]&u)+a;var d=~(255<<8-h);this.u8[r+1]=(this.u8[r+1]&d)+s;var p=~(255<<8-c);this.u8[r+2]=(this.u8[r+2]&p)+o}getInt6(e){var t=e/8|0,r=this.u8[t],i=this.u8[t+1],n=e%8,a=8-n;return(((r&=~((255<<a)+(255>>8-(2-n))))<<8)+(i&=255<<8-Math.max(6-a,0))>>10-n)-32}setInt6(e,t){var r=e/8|0,i=e%8,n=(t+=32)<<10-i,a=(65280&n)>>8,s=255&n,o=8-i,l=Math.max(6-o,0),h=(255<<o)+(255>>8-(2-i));this.u8[r]=(this.u8[r]&h)+a;var c=~(255<<8-l);this.u8[r+1]=(this.u8[r+1]&c)+s}test(){var e,t,r=new ArrayBuffer(3),i=new T0(r);for(t=0;t<12;t++)for(e=-2048;e<2048;e++)if(i.setInt12(t,e),i.getInt12(t)!=e){console.log("12-bit prob at",t,e),console.log("expected",e,"got",i.getInt12(t));break}for(t=0;t<18;t++)for(e=-32;e<32;e++)if(i.setInt6(t,e),i.getInt6(t)!=e){console.log("6-bit prob at",t,e),console.log("expected",e,"got",i.getInt6(t));break}return i}},xI=class{parse(e){var t={},r=new DataView(e),i=0;if(t.fileCode=r.getInt32(i,!1),9994!=t.fileCode)throw new Error("Unknown file code: "+t.fileCode);for(i+=24,t.wordLength=r.getInt32(i,!1),t.byteLength=2*t.wordLength,i+=4,t.version=r.getInt32(i,!0),i+=4,t.shapeType=r.getInt32(i,!0),i+=4,t.minX=r.getFloat64(i,!0),t.minY=r.getFloat64(i+8,!0),t.maxX=r.getFloat64(i+16,!0),t.maxY=r.getFloat64(i+24,!0),t.minZ=r.getFloat64(i+32,!0),t.maxZ=r.getFloat64(i+40,!0),t.minM=r.getFloat64(i+48,!0),t.maxM=r.getFloat64(i+56,!0),i+=64,t.records=[];i<t.byteLength;){var n={};n.number=r.getInt32(i,!1),i+=4,n.length=r.getInt32(i,!1),i+=4;try{n.shape=this.parseShape(r,i,n.length)}catch(e){console.log(e,n)}i+=2*n.length,t.records.push(n)}return t}parseShape(e,t,r){var i=0,n=null,a={};switch(a.type=e.getInt32(t,!0),t+=4,a.type){case 0:break;case 1:a.content={x:e.getFloat64(t,!0),y:e.getFloat64(t+8,!0)};break;case 3:case 5:for(n=a.content={minX:e.getFloat64(t,!0),minY:e.getFloat64(t+8,!0),maxX:e.getFloat64(t+16,!0),maxY:e.getFloat64(t+24,!0),parts:new Int32Array(e.getInt32(t+32,!0)),points:new Float64Array(2*e.getInt32(t+36,!0))},t+=40,i=0;i<n.parts.length;i++)n.parts[i]=e.getInt32(t,!0),t+=4;for(i=0;i<n.points.length;i++)n.points[i]=e.getFloat64(t,!0),t+=8;break;case 8:case 11:case 13:case 15:case 18:case 21:case 23:case 25:case 28:case 31:throw new Error("Shape type not supported: "+a.type+":"+ +a.type);default:throw new Error("Unknown shape type at "+(t-4)+": "+a.type)}return a}},EI=class{constructor(){this.LINE_MATERIAL=new Yr({color:0,linewidth:2,opacity:.8,transparent:!0}),this.MESH_MATERIAL=new Mr({color:1926655,opacity:.8,transparent:!0})}createModel(e){for(var t=[],r=[],i=0;i<e.records.length;i++){var n=e.records[i].shape;if(3===n.type||5===n.type)for(var a=n.content.points,s=n.content.parts,o=0;o<s.length;o++){let e=[];for(var l=s[o],h=s[o+1]||a.length/2;l<h;l++){var c=a[2*l],u=a[2*l+1];e.push(new F(c,u,0))}if(5===n.type){let i=$s.triangulateShape(e,[]),n=[];i.forEach((e=>n.push(...e)));let a=new Nt;a.setFromPoints(e),a.setIndex(n),t.push(a);let s=new Nt;e.length>2&&!e[0].equals(e[e.length-1])&&e.push(e[0]),s.setFromPoints(e),r.push(s)}else{let t=new Nt;t.setFromPoints(e),r.push(t)}}}var d=new yr;for(i=0;i<r.length;i++)d.add(new jn(r[i],this.LINE_MATERIAL));for(i=0;i<t.length;i++)d.add(new Ht(t[i],this.MESH_MATERIAL));return console.log("parsed",t.length,r.length),d}loadCompressed(e){for(var t=this.deltaDecode6(e),r=[],i=[],n=0;n<t.length;n++){let e=[];if(-32768!==t[n]){var a=180*t[n]/32767,s=180*t[n+1]/32767;n++,e.push(new F(a,s,0))}else{for(var o=[],l=1;l<e.length;l++)e[l-1].x==e[l].x&&e[l-1].y==e[l].y||o.push(e[l]);let t=new Nt;t.setFromPoints(o),r.push(t),e=[]}}var h=new yr;for(n=0;n<i.length;n++)h.add(new jn(i[n],this.LINE_MATERIAL));for(n=0;n<r.length;n++)h.add(new Ht(r[n],this.MESH_MATERIAL));return console.log("parsed compressed",r.length,i.length),h}compress(e){for(var t=[],r=0;r<e.records.length;r++){var i=e.records[r].shape;if(5===i.type)for(var n=i.content.points,a=i.content.parts,s=0;s<a.length;s++){for(var o=a[s],l=a[s+1]||n.length/2;o<l;o++){var h=n[2*o],c=n[2*o+1];t.push(h/180*32767,c/180*32767)}t.push(-32768)}}var u=new Int16Array(t);console.log("16-bit quantized byteLength",u.buffer.byteLength);var d=this.deltaEncode6(u);return console.log("delta-encoded byteLength",d.byteLength),d}deltaEncode(e){for(var t=[],r=[],i=[],n=0,a=0,s=0,o=0;o<e.length;o++)-32768!=e[o]?0==i.length?(n=e[o],a=e[o+1],i.push(n,a),s+=4,o++):Math.abs(n-e[o])>1023||Math.abs(a-e[o+1])>1023?(r.push(i),s+=1,i=[],n=e[o],a=e[o+1],i.push(n,a),s+=4,o++):(i.push((e[o]-n)/8,(e[o+1]-a)/8),n+=8*((e[o]-n)/8|0),a+=8*((e[o+1]-a)/8|0),s+=2,o++):(r.push(i),t.push(r),r=[],i=[],s+=3);return this.storeDeltas(s,t)}deltaEncode6(e){var t=[],r=[],i=[],n=0,a=0,s=0,o=0;for(s=0;s<e.length;s++)e[s]=0|e[s]/16;for(s=0;s<e.length;s++)-2048!==e[s]?0==i.length?(n=e[s],a=e[s+1],i.push(n,a),o+=4,s++):Math.abs(n-e[s])>31||Math.abs(a-e[s+1])>31?(r.push(i),o+=1,i=[],n=e[s],a=e[s+1],i.push(n,a),o+=4,s++):(i.push(e[s]-n,e[s+1]-a),n+=e[s]-n,a+=e[s+1]-a,o+=2,s++):(r.push(i),t.push(r),r=[],i=[],o+=3);return this.storeDeltas6(o,t)}storeDeltas(e,t){for(var r=new ArrayBuffer(e),i=new DataView(r),n=0,a=0;a<t.length;a++){for(var s=t[a],o=0;o<s.length;o++){var l=s[o];i.setInt16(n,l[0]),n+=2,i.setInt16(n,l[1]),n+=2;for(var h=2;h<l.length;h++)i.setInt8(n++,l[h]);i.setInt8(n,-128),n+=1}i.setInt16(n,-32768),n+=2}return r}deltaDecode(e){for(var t=new DataView(e),r=0,i=[];r<e.byteLength;){var n=t.getInt16(r);if(r+=2,-32768!==n){var a=t.getInt16(r);for(r+=2,i.push(n,a);r<e.byteLength;){var s=t.getInt8(r);if(r++,-128==s)break;var o=t.getInt8(r);r++,n+=8*s,a+=8*o,i.push(n,a)}}else i.push(-32768)}return i}storeDeltas6(e,t){for(var r=new ArrayBuffer(Math.ceil(.75*e)+4),i=new T0(r),n=32,a=0;a<t.length;a++){for(var s=t[a],o=0;o<s.length;o++){var l=s[o];i.setInt12(n,l[0]),n+=12,i.setInt12(n,l[1]),n+=12;for(var h=2;h<l.length;h++)i.setInt6(n,l[h]),n+=6;i.setInt6(n,-32),n+=6}i.setInt12(n,-2048),n+=12}return new DataView(r).setUint32(0,n),r}deltaDecode6(e){for(var t=new DataView(e).getUint32(0),r=new T0(e),i=32,n=[];i<t;){var a=r.getInt12(i);if(i+=12,-2048!==a){var s=r.getInt12(i);for(i+=12,n.push(a,s);i<t;){var o=r.getInt6(i);if(i+=6,-32===o)break;var l=r.getInt6(i);i+=6,a+=o,s+=l,n.push(a,s)}}else n.push(-2048)}for(var h=0;h<n.length;h++)n[h]*=16;return n}},_I=class{load(e,t,r,i){return bt(this,null,(function*(){this.updateProgress(r,0);let n=new XMLHttpRequest;n.responseType="arraybuffer",n.onload=()=>{this.updateProgress(r,50);let e=(new xI).parse(n.response),i=(new EI).createModel(e);this.updateProgress(r,99),t(i)},n.onerror=i,n.open("GET",e),n.send(null)}))}updateProgress(e,t){if(e){e(new ProgressEvent("progress",{lengthComputable:!0,loaded:t,total:100}))}}},TI=class{constructor(e){this.manager=e}setLoadManager(e){this.manager=e}loadLocalModel(e,t,r){return bt(this,null,(function*(){let i=t.toLowerCase();return i.endsWith("fbx")?this.loadFbx(e,r):i.endsWith("obj")?this.loadObj(e,r):i.endsWith("stl")?this.loadStl(e,r):i.endsWith("ifc")?(de.warn("[LoadingHelper] IFC is not supported directly since three.js r150!"),Promise.reject("Not supported!")):i.endsWith("shp")?this.loadShp(e,r):i.endsWith("dae")?this.loadDae(e,r):i.endsWith("3dm")?this.load3dm(e,r):i.endsWith("dxf")?this.loadDxf(e,r):i.endsWith("jpg")||i.endsWith("jpeg")||i.endsWith("png")?this.loadImage(e,r):this.loadGltf(e,r)}))}loadModel(e,t,r){return bt(this,null,(function*(){let i=e;if(!i)return Promise.resolve();let n=(null==t?void 0:t.toLowerCase())||"";if(!n){let e=i.split("?")[0].toLowerCase();if(e){let t=e.lastIndexOf(".");-1!==t&&(n=e.slice(t+1))}}return n.endsWith("fbx")?this.loadFbx(i,r):n.endsWith("obj")?this.loadObj(i,r):n.endsWith("stl")?this.loadStl(i,r):n.endsWith("ifc")?void de.warn("[LoadingHelper] IFC is not supported directly since three.js r150!"):n.endsWith("shp")?this.loadShp(i,r):n.endsWith("dae")?this.loadDae(i,r):n.endsWith("dxf")?this.loadDxf(i,r):n.endsWith("jpg")||n.endsWith("jpeg")||n.endsWith("png")?this.loadImage(i,r):this.loadGltf(i,r)}))}loadGltf(e,t){return bt(this,null,(function*(){let r=this.getGltfLoader();-1!==e.indexOf("#")&&console.warn(`[LoadingHelper] '#' is not allowed in filename ${e}`),e=e.replace(/#/g,encodeURIComponent("#"));let i=yield r.loadAsync(e,(e=>{0===e.total&&e.loaded>0||t&&t(e)}));return Promise.resolve(i.scene)}))}parseGltf(e,t,r,i){return this.getGltfLoader().parse(e,t,(e=>r(e.scene)),i)}loadFbx(e,t){return bt(this,null,(function*(){let r=yield new q3(this.manager).loadAsync(e,t);return Promise.resolve(r)}))}loadObj(e,t){return bt(this,null,(function*(){let r=new Z3(this.manager),i=new Y3(this.manager),n=e.replace(".obj",".mtl"),a=yield i.loadAsync(n,t);a.preload(),r.setMaterials(a);let s=yield r.loadAsync(e,t);return Promise.resolve(s)}))}loadStl(e,t){return bt(this,null,(function*(){let r=yield new J3(this.manager).loadAsync(e,t),i=new Ss({color:11184810,metalness:.1,roughness:.8}),n=new Ht(r,i);return Promise.resolve(n)}))}loadShp(e,t){return bt(this,null,(function*(){let r=new _I;return new Promise(((i,n)=>{r.load(e,(e=>{i(e)}),t,(e=>{n(e)}))}))}))}loadDae(e,t){return bt(this,null,(function*(){let r=yield new H3(this.manager).loadAsync(e,t);return Promise.resolve(r.scene)}))}load3dm(e,t){return bt(this,null,(function*(){let r=new U3(this.manager);r.setLibraryPath(TI.Rhino3dmLibraryPath);let i=yield r.loadAsync(e,t);return Promise.resolve(i)}))}loadDxf(e,t){return bt(this,null,(function*(){var r;this.font||console.warn("[LoadingHelper] Should set font first!");let i=new Qr(this.manager,{ignorePaperSpace:!0,enableLocalCache:!1,overrideHatchPatternLineThickness:2});i.setFont(this.font),yield null==(r=this.font)?void 0:r.getFontFromIndexeddb();try{let r=yield i.loadAsync(e,t);return Promise.resolve(r.threejsObject)}catch(e){let t=new ErrorEvent("");return Promise.reject(t)}}))}loadPly(e,t){return bt(this,null,(function*(){let r=yield new K3(this.manager).loadAsync(e,t);return Promise.resolve(new Ht(r))}))}loadImage(e,t){return bt(this,null,(function*(){let r=yield new Ds(this.manager).loadAsync(e,t);if(!r)return Promise.reject("Failed to load image!");let i=r.image,n=i&&i.height||10,a=i&&i.width||10;n*=10/a,a=10;let s=new Mr({map:r,side:ln,transparent:!0}),o=new vs(a,n),l=new Ht(o,s);return Promise.resolve(l)}))}loadDxfData(e,t,r,i,n){return bt(this,null,(function*(){var a;this.font||console.warn("[LoadingHelper] Should set font first!");let s=new Qr(this.manager,n);return s.setFont(this.font),yield null==(a=this.font)?void 0:a.getFontFromIndexeddb(),s.manager.onLoad=()=>{i&&i()},s.loadEx(e,t,r)}))}setFont(e){this.font=e}static setDracoDecoderPath(e){this.DecoderPath=e}static setRhino3dmLibraryPath(e){this.Rhino3dmLibraryPath=e}getGltfLoader(){if(!this.gltfLoader){this.gltfLoader=new zh(this.manager);let e=new V3(this.manager);e.setDecoderPath(TI.DecoderPath),this.gltfLoader.setDRACOLoader(e)}return this.gltfLoader}},Lu=TI;function RG(e){let t=new Blob([e],{type:"text/javascript"}),r=URL.createObjectURL(t),i=new Worker(r);return URL.revokeObjectURL(r),i}function CG(){return RG('var hl=Object.defineProperty,ul=Object.defineProperties;var fl=Object.getOwnPropertyDescriptors;var Ko=Object.getOwnPropertySymbols;var dl=Object.prototype.hasOwnProperty,pl=Object.prototype.propertyIsEnumerable;var Qo=(i,t,e)=>t in i?hl(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,Di=(i,t)=>{for(var e in t||(t={}))dl.call(t,e)&&Qo(i,e,t[e]);if(Ko)for(var e of Ko(t))pl.call(t,e)&&Qo(i,e,t[e]);return i},jo=(i,t)=>ul(i,fl(t));var Ao="159";var ml=0,ta=1,gl=2;var bc=1,_l=2,on=3,Xe=0,pe=1,ke=2;var Sn=0,fi=1,ea=2,na=3,ia=4,xl=5,On=100,yl=101,vl=102,sa=103,ra=104,Ml=200,Sl=201,bl=202,El=203,kr=204,Hr=205,Tl=206,Al=207,wl=208,Rl=209,Cl=210,Pl=211,Ll=212,Il=213,Ul=214,Dl=0,Nl=1,Fl=2,Ts=3,Ol=4,Bl=5,zl=6,Vl=7,Ec=0,kl=1,Hl=2,bn=0,Gl=1,Wl=2,Xl=3,ql=4,Yl=5;var Tc=300,mi=301,gi=302,Gr=303,Wr=304,qs=306,Xr=1e3,He=1001,qr=1002,ye=1003,oa=1004;var hr=1005;var De=1006,Zl=1007;var Gi=1008;var En=1009,Jl=1010,$l=1011,wo=1012,Ac=1013,vn=1014,Mn=1015,Wi=1016,wc=1017,Rc=1018,zn=1020,Kl=1021,Ge=1023,Ql=1024,jl=1025,Vn=1026,_i=1027,th=1028,Cc=1029,eh=1030,Pc=1031,Lc=1033,ur=33776,fr=33777,dr=33778,pr=33779,aa=35840,ca=35841,la=35842,ha=35843,Ic=36196,ua=37492,fa=37496,da=37808,pa=37809,ma=37810,ga=37811,_a=37812,xa=37813,ya=37814,va=37815,Ma=37816,Sa=37817,ba=37818,Ea=37819,Ta=37820,Aa=37821,mr=36492,wa=36494,Ra=36495,nh=36283,Ca=36284,Pa=36285,La=36286;var As=2300,ws=2301,gr=2302,Ia=2400,Ua=2401,Da=2402;var Uc=3e3,kn=3001,ih=3200,sh=3201,rh=0,oh=1,Ne="",le="srgb",ln="srgb-linear",Ro="display-p3",Ys="display-p3-linear",Rs="linear",Yt="srgb",Cs="rec709",Ps="p3";var Zn=7680;var Na=519,ah=512,ch=513,lh=514,Dc=515,hh=516,uh=517,fh=518,dh=519,Fa=35044;var Oa="300 es",Yr=1035,an=2e3,Ls=2001,Tn=class{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});let n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;let n=this._listeners;return n[t]!==void 0&&n[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;let s=this._listeners[t];if(s!==void 0){let r=s.indexOf(e);r!==-1&&s.splice(r,1)}}dispatchEvent(t){if(this._listeners===void 0)return;let n=this._listeners[t.type];if(n!==void 0){t.target=this;let s=n.slice(0);for(let r=0,a=s.length;r<a;r++)s[r].call(this,t);t.target=null}}},fe=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];var _r=Math.PI/180,Zr=180/Math.PI;function Yi(){let i=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(fe[i&255]+fe[i>>8&255]+fe[i>>16&255]+fe[i>>24&255]+"-"+fe[t&255]+fe[t>>8&255]+"-"+fe[t>>16&15|64]+fe[t>>24&255]+"-"+fe[e&63|128]+fe[e>>8&255]+"-"+fe[e>>16&255]+fe[e>>24&255]+fe[n&255]+fe[n>>8&255]+fe[n>>16&255]+fe[n>>24&255]).toLowerCase()}function ve(i,t,e){return Math.max(t,Math.min(e,i))}function ph(i,t){return(i%t+t)%t}function xr(i,t,e){return(1-e)*i+e*t}function Ba(i){return(i&i-1)===0&&i!==0}function Jr(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function Ni(i,t){switch(t.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function Se(i,t){switch(t.constructor){case Float32Array:return i;case Uint32Array:return Math.round(i*4294967295);case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int32Array:return Math.round(i*2147483647);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}var zt=class i{constructor(t=0,e=0){i.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let e=this.x,n=this.y,s=t.elements;return this.x=s[0]*e+s[3]*n+s[6],this.y=s[1]*e+s[4]*n+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;let n=this.dot(t)/e;return Math.acos(ve(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){let n=Math.cos(e),s=Math.sin(e),r=this.x-t.x,a=this.y-t.y;return this.x=r*n-a*s+t.x,this.y=r*s+a*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Ft=class i{constructor(t,e,n,s,r,a,o,c,l){i.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,n,s,r,a,o,c,l)}set(t,e,n,s,r,a,o,c,l){let h=this.elements;return h[0]=t,h[1]=s,h[2]=o,h[3]=e,h[4]=r,h[5]=c,h[6]=n,h[7]=a,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){let e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){let e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let n=t.elements,s=e.elements,r=this.elements,a=n[0],o=n[3],c=n[6],l=n[1],h=n[4],d=n[7],f=n[2],m=n[5],g=n[8],x=s[0],p=s[3],u=s[6],v=s[1],_=s[4],b=s[7],S=s[2],T=s[5],R=s[8];return r[0]=a*x+o*v+c*S,r[3]=a*p+o*_+c*T,r[6]=a*u+o*b+c*R,r[1]=l*x+h*v+d*S,r[4]=l*p+h*_+d*T,r[7]=l*u+h*b+d*R,r[2]=f*x+m*v+g*S,r[5]=f*p+m*_+g*T,r[8]=f*u+m*b+g*R,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){let t=this.elements,e=t[0],n=t[1],s=t[2],r=t[3],a=t[4],o=t[5],c=t[6],l=t[7],h=t[8];return e*a*h-e*o*l-n*r*h+n*o*c+s*r*l-s*a*c}invert(){let t=this.elements,e=t[0],n=t[1],s=t[2],r=t[3],a=t[4],o=t[5],c=t[6],l=t[7],h=t[8],d=h*a-o*l,f=o*c-h*r,m=l*r-a*c,g=e*d+n*f+s*m;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);let x=1/g;return t[0]=d*x,t[1]=(s*l-h*n)*x,t[2]=(o*n-s*a)*x,t[3]=f*x,t[4]=(h*e-s*c)*x,t[5]=(s*r-o*e)*x,t[6]=m*x,t[7]=(n*c-l*e)*x,t[8]=(a*e-n*r)*x,this}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){let e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,s,r,a,o){let c=Math.cos(r),l=Math.sin(r);return this.set(n*c,n*l,-n*(c*a+l*o)+a+t,-s*l,s*c,-s*(-l*a+c*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(yr.makeScale(t,e)),this}rotate(t){return this.premultiply(yr.makeRotation(-t)),this}translate(t,e){return this.premultiply(yr.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){let e=this.elements,n=t.elements;for(let s=0;s<9;s++)if(e[s]!==n[s])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){let n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}},yr=new Ft;function Nc(i){for(let t=i.length-1;t>=0;--t)if(i[t]>=65535)return!0;return!1}function Is(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function mh(){let i=Is("canvas");return i.style.display="block",i}var za={};function ki(i){i in za||(za[i]=!0,console.warn(i))}var Va=new Ft().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),ka=new Ft().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),es={[ln]:{transfer:Rs,primaries:Cs,toReference:i=>i,fromReference:i=>i},[le]:{transfer:Yt,primaries:Cs,toReference:i=>i.convertSRGBToLinear(),fromReference:i=>i.convertLinearToSRGB()},[Ys]:{transfer:Rs,primaries:Ps,toReference:i=>i.applyMatrix3(ka),fromReference:i=>i.applyMatrix3(Va)},[Ro]:{transfer:Yt,primaries:Ps,toReference:i=>i.convertSRGBToLinear().applyMatrix3(ka),fromReference:i=>i.applyMatrix3(Va).convertLinearToSRGB()}},gh=new Set([ln,Ys]),Xt={enabled:!0,_workingColorSpace:ln,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(i){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!i},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(i){if(!gh.has(i))throw new Error(`Unsupported working color space, "${i}".`);this._workingColorSpace=i},convert:function(i,t,e){if(this.enabled===!1||t===e||!t||!e)return i;let n=es[t].toReference,s=es[e].fromReference;return s(n(i))},fromWorkingColorSpace:function(i,t){return this.convert(i,this._workingColorSpace,t)},toWorkingColorSpace:function(i,t){return this.convert(i,t,this._workingColorSpace)},getPrimaries:function(i){return es[i].primaries},getTransfer:function(i){return i===Ne?Rs:es[i].transfer}};function di(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function vr(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}var Jn,Us=class{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement=="undefined")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{Jn===void 0&&(Jn=Is("canvas")),Jn.width=t.width,Jn.height=t.height;let n=Jn.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Jn}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement!="undefined"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&t instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&t instanceof ImageBitmap){let e=Is("canvas");e.width=t.width,e.height=t.height;let n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);let s=n.getImageData(0,0,t.width,t.height),r=s.data;for(let a=0;a<r.length;a++)r[a]=di(r[a]/255)*255;return n.putImageData(s,0,0),e}else if(t.data){let e=t.data.slice(0);for(let n=0;n<e.length;n++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[n]=Math.floor(di(e[n]/255)*255):e[n]=di(e[n]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}},_h=0,Ds=class{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_h++}),this.uuid=Yi(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){let e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];let n={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let a=0,o=s.length;a<o;a++)s[a].isDataTexture?r.push(Mr(s[a].image)):r.push(Mr(s[a]))}else r=Mr(s);n.url=r}return e||(t.images[this.uuid]=n),n}};function Mr(i){return typeof HTMLImageElement!="undefined"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&i instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&i instanceof ImageBitmap?Us.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var xh=0,qe=class i extends Tn{constructor(t=i.DEFAULT_IMAGE,e=i.DEFAULT_MAPPING,n=He,s=He,r=De,a=Gi,o=Ge,c=En,l=i.DEFAULT_ANISOTROPY,h=Ne){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:xh++}),this.uuid=Yi(),this.name="",this.source=new Ds(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=c,this.offset=new zt(0,0),this.repeat=new zt(1,1),this.center=new zt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ft,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof h=="string"?this.colorSpace=h:(ki("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=h===kn?le:Ne),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){let e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];let n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Tc)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Xr:t.x=t.x-Math.floor(t.x);break;case He:t.x=t.x<0?0:1;break;case qr:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Xr:t.y=t.y-Math.floor(t.y);break;case He:t.y=t.y<0?0:1;break;case qr:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return ki("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===le?kn:Uc}set encoding(t){ki("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===kn?le:Ne}};qe.DEFAULT_IMAGE=null;qe.DEFAULT_MAPPING=Tc;qe.DEFAULT_ANISOTROPY=1;var he=class i{constructor(t=0,e=0,n=0,s=1){i.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=s}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,s){return this.x=t,this.y=e,this.z=n,this.w=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){let e=this.x,n=this.y,s=this.z,r=this.w,a=t.elements;return this.x=a[0]*e+a[4]*n+a[8]*s+a[12]*r,this.y=a[1]*e+a[5]*n+a[9]*s+a[13]*r,this.z=a[2]*e+a[6]*n+a[10]*s+a[14]*r,this.w=a[3]*e+a[7]*n+a[11]*s+a[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);let e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,s,r,c=t.elements,l=c[0],h=c[4],d=c[8],f=c[1],m=c[5],g=c[9],x=c[2],p=c[6],u=c[10];if(Math.abs(h-f)<.01&&Math.abs(d-x)<.01&&Math.abs(g-p)<.01){if(Math.abs(h+f)<.1&&Math.abs(d+x)<.1&&Math.abs(g+p)<.1&&Math.abs(l+m+u-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;let _=(l+1)/2,b=(m+1)/2,S=(u+1)/2,T=(h+f)/4,R=(d+x)/4,I=(g+p)/4;return _>b&&_>S?_<.01?(n=0,s=.707106781,r=.707106781):(n=Math.sqrt(_),s=T/n,r=R/n):b>S?b<.01?(n=.707106781,s=0,r=.707106781):(s=Math.sqrt(b),n=T/s,r=I/s):S<.01?(n=.707106781,s=.707106781,r=0):(r=Math.sqrt(S),n=R/r,s=I/r),this.set(n,s,r,e),this}let v=Math.sqrt((p-g)*(p-g)+(d-x)*(d-x)+(f-h)*(f-h));return Math.abs(v)<.001&&(v=1),this.x=(p-g)/v,this.y=(d-x)/v,this.z=(f-h)/v,this.w=Math.acos((l+m+u-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},$r=class extends Tn{constructor(t=1,e=1,n={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new he(0,0,t,e),this.scissorTest=!1,this.viewport=new he(0,0,t,e);let s={width:t,height:e,depth:1};n.encoding!==void 0&&(ki("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===kn?le:Ne),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:De,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new qe(s,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(t,e,n=1){(this.width!==t||this.height!==e||this.depth!==n)&&(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;let e=Object.assign({},t.texture.image);return this.texture.source=new Ds(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},hn=class extends $r{constructor(t=1,e=1,n={}){super(t,e,n),this.isWebGLRenderTarget=!0}},Ns=class extends qe{constructor(t=null,e=1,n=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:s},this.magFilter=ye,this.minFilter=ye,this.wrapR=He,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};var Kr=class extends qe{constructor(t=null,e=1,n=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:n,depth:s},this.magFilter=ye,this.minFilter=ye,this.wrapR=He,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};var An=class{constructor(t=0,e=0,n=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=s}static slerpFlat(t,e,n,s,r,a,o){let c=n[s+0],l=n[s+1],h=n[s+2],d=n[s+3],f=r[a+0],m=r[a+1],g=r[a+2],x=r[a+3];if(o===0){t[e+0]=c,t[e+1]=l,t[e+2]=h,t[e+3]=d;return}if(o===1){t[e+0]=f,t[e+1]=m,t[e+2]=g,t[e+3]=x;return}if(d!==x||c!==f||l!==m||h!==g){let p=1-o,u=c*f+l*m+h*g+d*x,v=u>=0?1:-1,_=1-u*u;if(_>Number.EPSILON){let S=Math.sqrt(_),T=Math.atan2(S,u*v);p=Math.sin(p*T)/S,o=Math.sin(o*T)/S}let b=o*v;if(c=c*p+f*b,l=l*p+m*b,h=h*p+g*b,d=d*p+x*b,p===1-o){let S=1/Math.sqrt(c*c+l*l+h*h+d*d);c*=S,l*=S,h*=S,d*=S}}t[e]=c,t[e+1]=l,t[e+2]=h,t[e+3]=d}static multiplyQuaternionsFlat(t,e,n,s,r,a){let o=n[s],c=n[s+1],l=n[s+2],h=n[s+3],d=r[a],f=r[a+1],m=r[a+2],g=r[a+3];return t[e]=o*g+h*d+c*m-l*f,t[e+1]=c*g+h*f+l*d-o*m,t[e+2]=l*g+h*m+o*f-c*d,t[e+3]=h*g-o*d-c*f-l*m,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,s){return this._x=t,this._y=e,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){let n=t._x,s=t._y,r=t._z,a=t._order,o=Math.cos,c=Math.sin,l=o(n/2),h=o(s/2),d=o(r/2),f=c(n/2),m=c(s/2),g=c(r/2);switch(a){case"XYZ":this._x=f*h*d+l*m*g,this._y=l*m*d-f*h*g,this._z=l*h*g+f*m*d,this._w=l*h*d-f*m*g;break;case"YXZ":this._x=f*h*d+l*m*g,this._y=l*m*d-f*h*g,this._z=l*h*g-f*m*d,this._w=l*h*d+f*m*g;break;case"ZXY":this._x=f*h*d-l*m*g,this._y=l*m*d+f*h*g,this._z=l*h*g+f*m*d,this._w=l*h*d-f*m*g;break;case"ZYX":this._x=f*h*d-l*m*g,this._y=l*m*d+f*h*g,this._z=l*h*g-f*m*d,this._w=l*h*d+f*m*g;break;case"YZX":this._x=f*h*d+l*m*g,this._y=l*m*d+f*h*g,this._z=l*h*g-f*m*d,this._w=l*h*d-f*m*g;break;case"XZY":this._x=f*h*d-l*m*g,this._y=l*m*d-f*h*g,this._z=l*h*g+f*m*d,this._w=l*h*d+f*m*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){let n=e/2,s=Math.sin(n);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){let e=t.elements,n=e[0],s=e[4],r=e[8],a=e[1],o=e[5],c=e[9],l=e[2],h=e[6],d=e[10],f=n+o+d;if(f>0){let m=.5/Math.sqrt(f+1);this._w=.25/m,this._x=(h-c)*m,this._y=(r-l)*m,this._z=(a-s)*m}else if(n>o&&n>d){let m=2*Math.sqrt(1+n-o-d);this._w=(h-c)/m,this._x=.25*m,this._y=(s+a)/m,this._z=(r+l)/m}else if(o>d){let m=2*Math.sqrt(1+o-n-d);this._w=(r-l)/m,this._x=(s+a)/m,this._y=.25*m,this._z=(c+h)/m}else{let m=2*Math.sqrt(1+d-n-o);this._w=(a-s)/m,this._x=(r+l)/m,this._y=(c+h)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ve(this.dot(t),-1,1)))}rotateTowards(t,e){let n=this.angleTo(t);if(n===0)return this;let s=Math.min(1,e/n);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){let n=t._x,s=t._y,r=t._z,a=t._w,o=e._x,c=e._y,l=e._z,h=e._w;return this._x=n*h+a*o+s*l-r*c,this._y=s*h+a*c+r*o-n*l,this._z=r*h+a*l+n*c-s*o,this._w=a*h-n*o-s*c-r*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);let n=this._x,s=this._y,r=this._z,a=this._w,o=a*t._w+n*t._x+s*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=n,this._y=s,this._z=r,this;let c=1-o*o;if(c<=Number.EPSILON){let m=1-e;return this._w=m*a+e*this._w,this._x=m*n+e*this._x,this._y=m*s+e*this._y,this._z=m*r+e*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(c),h=Math.atan2(l,o),d=Math.sin((1-e)*h)/l,f=Math.sin(e*h)/l;return this._w=a*d+this._w*f,this._x=n*d+this._x*f,this._y=s*d+this._y*f,this._z=r*d+this._z*f,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){let t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(s),n*Math.sin(r),n*Math.cos(r),e*Math.sin(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},L=class i{constructor(t=0,e=0,n=0){i.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Ha.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Ha.setFromAxisAngle(t,e))}applyMatrix3(t){let e=this.x,n=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*s,this.y=r[1]*e+r[4]*n+r[7]*s,this.z=r[2]*e+r[5]*n+r[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let e=this.x,n=this.y,s=this.z,r=t.elements,a=1/(r[3]*e+r[7]*n+r[11]*s+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*s+r[12])*a,this.y=(r[1]*e+r[5]*n+r[9]*s+r[13])*a,this.z=(r[2]*e+r[6]*n+r[10]*s+r[14])*a,this}applyQuaternion(t){let e=this.x,n=this.y,s=this.z,r=t.x,a=t.y,o=t.z,c=t.w,l=2*(a*s-o*n),h=2*(o*e-r*s),d=2*(r*n-a*e);return this.x=e+c*l+a*d-o*h,this.y=n+c*h+o*l-r*d,this.z=s+c*d+r*h-a*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let e=this.x,n=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*s,this.y=r[1]*e+r[5]*n+r[9]*s,this.z=r[2]*e+r[6]*n+r[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){let n=t.x,s=t.y,r=t.z,a=e.x,o=e.y,c=e.z;return this.x=s*c-r*o,this.y=r*a-n*c,this.z=n*o-s*a,this}projectOnVector(t){let e=t.lengthSq();if(e===0)return this.set(0,0,0);let n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Sr.copy(this).projectOnVector(t),this.sub(Sr)}reflect(t){return this.sub(Sr.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;let n=this.dot(t)/e;return Math.acos(ve(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,n=this.y-t.y,s=this.z-t.z;return e*e+n*n+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){let s=Math.sin(e)*t;return this.x=s*Math.sin(n),this.y=Math.cos(e)*t,this.z=s*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){let e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},Sr=new L,Ha=new An,Me=class{constructor(t=new L(1/0,1/0,1/0),e=new L(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(Be.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(Be.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let n=Be.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);let n=t.geometry;if(n!==void 0){let r=n.getAttribute("position");if(e===!0&&r!==void 0&&t.isInstancedMesh!==!0)for(let a=0,o=r.count;a<o;a++)t.isMesh===!0?t.getVertexPosition(a,Be):Be.fromBufferAttribute(r,a),Be.applyMatrix4(t.matrixWorld),this.expandByPoint(Be);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),ns.copy(t.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),ns.copy(n.boundingBox)),ns.applyMatrix4(t.matrixWorld),this.union(ns)}let s=t.children;for(let r=0,a=s.length;r<a;r++)this.expandByObject(s[r],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Be),Be.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Fi),is.subVectors(this.max,Fi),$n.subVectors(t.a,Fi),Kn.subVectors(t.b,Fi),Qn.subVectors(t.c,Fi),mn.subVectors(Kn,$n),gn.subVectors(Qn,Kn),In.subVectors($n,Qn);let e=[0,-mn.z,mn.y,0,-gn.z,gn.y,0,-In.z,In.y,mn.z,0,-mn.x,gn.z,0,-gn.x,In.z,0,-In.x,-mn.y,mn.x,0,-gn.y,gn.x,0,-In.y,In.x,0];return!br(e,$n,Kn,Qn,is)||(e=[1,0,0,0,1,0,0,0,1],!br(e,$n,Kn,Qn,is))?!1:(ss.crossVectors(mn,gn),e=[ss.x,ss.y,ss.z],br(e,$n,Kn,Qn,is))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Be).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(Be).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(tn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),tn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),tn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),tn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),tn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),tn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),tn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),tn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(tn),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},tn=[new L,new L,new L,new L,new L,new L,new L,new L],Be=new L,ns=new Me,$n=new L,Kn=new L,Qn=new L,mn=new L,gn=new L,In=new L,Fi=new L,is=new L,ss=new L,Un=new L;function br(i,t,e,n,s){for(let r=0,a=i.length-3;r<=a;r+=3){Un.fromArray(i,r);let o=s.x*Math.abs(Un.x)+s.y*Math.abs(Un.y)+s.z*Math.abs(Un.z),c=t.dot(Un),l=e.dot(Un),h=n.dot(Un);if(Math.max(-Math.max(c,l,h),Math.min(c,l,h))>o)return!1}return!0}var yh=new Me,Oi=new L,Er=new L,Hn=class{constructor(t=new L,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){let n=this.center;e!==void 0?n.copy(e):yh.setFromPoints(t).getCenter(n);let s=0;for(let r=0,a=t.length;r<a;r++)s=Math.max(s,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(s),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){let e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){let n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Oi.subVectors(t,this.center);let e=Oi.lengthSq();if(e>this.radius*this.radius){let n=Math.sqrt(e),s=(n-this.radius)*.5;this.center.addScaledVector(Oi,s/n),this.radius+=s}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(Er.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Oi.copy(t.center).add(Er)),this.expandByPoint(Oi.copy(t.center).sub(Er))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}},en=new L,Tr=new L,rs=new L,_n=new L,Ar=new L,os=new L,wr=new L,Qr=class{constructor(t=new L,e=new L(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,en)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);let n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){let e=en.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(en.copy(this.origin).addScaledVector(this.direction,e),en.distanceToSquared(t))}distanceSqToSegment(t,e,n,s){Tr.copy(t).add(e).multiplyScalar(.5),rs.copy(e).sub(t).normalize(),_n.copy(this.origin).sub(Tr);let r=t.distanceTo(e)*.5,a=-this.direction.dot(rs),o=_n.dot(this.direction),c=-_n.dot(rs),l=_n.lengthSq(),h=Math.abs(1-a*a),d,f,m,g;if(h>0)if(d=a*c-o,f=a*o-c,g=r*h,d>=0)if(f>=-g)if(f<=g){let x=1/h;d*=x,f*=x,m=d*(d+a*f+2*o)+f*(a*d+f+2*c)+l}else f=r,d=Math.max(0,-(a*f+o)),m=-d*d+f*(f+2*c)+l;else f=-r,d=Math.max(0,-(a*f+o)),m=-d*d+f*(f+2*c)+l;else f<=-g?(d=Math.max(0,-(-a*r+o)),f=d>0?-r:Math.min(Math.max(-r,-c),r),m=-d*d+f*(f+2*c)+l):f<=g?(d=0,f=Math.min(Math.max(-r,-c),r),m=f*(f+2*c)+l):(d=Math.max(0,-(a*r+o)),f=d>0?r:Math.min(Math.max(-r,-c),r),m=-d*d+f*(f+2*c)+l);else f=a>0?-r:r,d=Math.max(0,-(a*f+o)),m=-d*d+f*(f+2*c)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,d),s&&s.copy(Tr).addScaledVector(rs,f),m}intersectSphere(t,e){en.subVectors(t.center,this.origin);let n=en.dot(this.direction),s=en.dot(en)-n*n,r=t.radius*t.radius;if(s>r)return null;let a=Math.sqrt(r-s),o=n-a,c=n+a;return c<0?null:o<0?this.at(c,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){let e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;let n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){let n=this.distanceToPlane(t);return n===null?null:this.at(n,e)}intersectsPlane(t){let e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,s,r,a,o,c,l=1/this.direction.x,h=1/this.direction.y,d=1/this.direction.z,f=this.origin;return l>=0?(n=(t.min.x-f.x)*l,s=(t.max.x-f.x)*l):(n=(t.max.x-f.x)*l,s=(t.min.x-f.x)*l),h>=0?(r=(t.min.y-f.y)*h,a=(t.max.y-f.y)*h):(r=(t.max.y-f.y)*h,a=(t.min.y-f.y)*h),n>a||r>s||((r>n||isNaN(n))&&(n=r),(a<s||isNaN(s))&&(s=a),d>=0?(o=(t.min.z-f.z)*d,c=(t.max.z-f.z)*d):(o=(t.max.z-f.z)*d,c=(t.min.z-f.z)*d),n>c||o>s)||((o>n||n!==n)&&(n=o),(c<s||s!==s)&&(s=c),s<0)?null:this.at(n>=0?n:s,e)}intersectsBox(t){return this.intersectBox(t,en)!==null}intersectTriangle(t,e,n,s,r){Ar.subVectors(e,t),os.subVectors(n,t),wr.crossVectors(Ar,os);let a=this.direction.dot(wr),o;if(a>0){if(s)return null;o=1}else if(a<0)o=-1,a=-a;else return null;_n.subVectors(this.origin,t);let c=o*this.direction.dot(os.crossVectors(_n,os));if(c<0)return null;let l=o*this.direction.dot(Ar.cross(_n));if(l<0||c+l>a)return null;let h=-o*_n.dot(wr);return h<0?null:this.at(h/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Kt=class i{constructor(t,e,n,s,r,a,o,c,l,h,d,f,m,g,x,p){i.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,n,s,r,a,o,c,l,h,d,f,m,g,x,p)}set(t,e,n,s,r,a,o,c,l,h,d,f,m,g,x,p){let u=this.elements;return u[0]=t,u[4]=e,u[8]=n,u[12]=s,u[1]=r,u[5]=a,u[9]=o,u[13]=c,u[2]=l,u[6]=h,u[10]=d,u[14]=f,u[3]=m,u[7]=g,u[11]=x,u[15]=p,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new i().fromArray(this.elements)}copy(t){let e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){let e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){let e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){let e=this.elements,n=t.elements,s=1/jn.setFromMatrixColumn(t,0).length(),r=1/jn.setFromMatrixColumn(t,1).length(),a=1/jn.setFromMatrixColumn(t,2).length();return e[0]=n[0]*s,e[1]=n[1]*s,e[2]=n[2]*s,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*a,e[9]=n[9]*a,e[10]=n[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){let e=this.elements,n=t.x,s=t.y,r=t.z,a=Math.cos(n),o=Math.sin(n),c=Math.cos(s),l=Math.sin(s),h=Math.cos(r),d=Math.sin(r);if(t.order==="XYZ"){let f=a*h,m=a*d,g=o*h,x=o*d;e[0]=c*h,e[4]=-c*d,e[8]=l,e[1]=m+g*l,e[5]=f-x*l,e[9]=-o*c,e[2]=x-f*l,e[6]=g+m*l,e[10]=a*c}else if(t.order==="YXZ"){let f=c*h,m=c*d,g=l*h,x=l*d;e[0]=f+x*o,e[4]=g*o-m,e[8]=a*l,e[1]=a*d,e[5]=a*h,e[9]=-o,e[2]=m*o-g,e[6]=x+f*o,e[10]=a*c}else if(t.order==="ZXY"){let f=c*h,m=c*d,g=l*h,x=l*d;e[0]=f-x*o,e[4]=-a*d,e[8]=g+m*o,e[1]=m+g*o,e[5]=a*h,e[9]=x-f*o,e[2]=-a*l,e[6]=o,e[10]=a*c}else if(t.order==="ZYX"){let f=a*h,m=a*d,g=o*h,x=o*d;e[0]=c*h,e[4]=g*l-m,e[8]=f*l+x,e[1]=c*d,e[5]=x*l+f,e[9]=m*l-g,e[2]=-l,e[6]=o*c,e[10]=a*c}else if(t.order==="YZX"){let f=a*c,m=a*l,g=o*c,x=o*l;e[0]=c*h,e[4]=x-f*d,e[8]=g*d+m,e[1]=d,e[5]=a*h,e[9]=-o*h,e[2]=-l*h,e[6]=m*d+g,e[10]=f-x*d}else if(t.order==="XZY"){let f=a*c,m=a*l,g=o*c,x=o*l;e[0]=c*h,e[4]=-d,e[8]=l*h,e[1]=f*d+x,e[5]=a*h,e[9]=m*d-g,e[2]=g*d-m,e[6]=o*h,e[10]=x*d+f}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(vh,t,Mh)}lookAt(t,e,n){let s=this.elements;return Re.subVectors(t,e),Re.lengthSq()===0&&(Re.z=1),Re.normalize(),xn.crossVectors(n,Re),xn.lengthSq()===0&&(Math.abs(n.z)===1?Re.x+=1e-4:Re.z+=1e-4,Re.normalize(),xn.crossVectors(n,Re)),xn.normalize(),as.crossVectors(Re,xn),s[0]=xn.x,s[4]=as.x,s[8]=Re.x,s[1]=xn.y,s[5]=as.y,s[9]=Re.y,s[2]=xn.z,s[6]=as.z,s[10]=Re.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let n=t.elements,s=e.elements,r=this.elements,a=n[0],o=n[4],c=n[8],l=n[12],h=n[1],d=n[5],f=n[9],m=n[13],g=n[2],x=n[6],p=n[10],u=n[14],v=n[3],_=n[7],b=n[11],S=n[15],T=s[0],R=s[4],I=s[8],y=s[12],A=s[1],D=s[5],z=s[9],X=s[13],C=s[2],F=s[6],Y=s[10],H=s[14],J=s[3],q=s[7],$=s[11],tt=s[15];return r[0]=a*T+o*A+c*C+l*J,r[4]=a*R+o*D+c*F+l*q,r[8]=a*I+o*z+c*Y+l*$,r[12]=a*y+o*X+c*H+l*tt,r[1]=h*T+d*A+f*C+m*J,r[5]=h*R+d*D+f*F+m*q,r[9]=h*I+d*z+f*Y+m*$,r[13]=h*y+d*X+f*H+m*tt,r[2]=g*T+x*A+p*C+u*J,r[6]=g*R+x*D+p*F+u*q,r[10]=g*I+x*z+p*Y+u*$,r[14]=g*y+x*X+p*H+u*tt,r[3]=v*T+_*A+b*C+S*J,r[7]=v*R+_*D+b*F+S*q,r[11]=v*I+_*z+b*Y+S*$,r[15]=v*y+_*X+b*H+S*tt,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){let t=this.elements,e=t[0],n=t[4],s=t[8],r=t[12],a=t[1],o=t[5],c=t[9],l=t[13],h=t[2],d=t[6],f=t[10],m=t[14],g=t[3],x=t[7],p=t[11],u=t[15];return g*(+r*c*d-s*l*d-r*o*f+n*l*f+s*o*m-n*c*m)+x*(+e*c*m-e*l*f+r*a*f-s*a*m+s*l*h-r*c*h)+p*(+e*l*d-e*o*m-r*a*d+n*a*m+r*o*h-n*l*h)+u*(-s*o*h-e*c*d+e*o*f+s*a*d-n*a*f+n*c*h)}transpose(){let t=this.elements,e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){let s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=n),this}invert(){let t=this.elements,e=t[0],n=t[1],s=t[2],r=t[3],a=t[4],o=t[5],c=t[6],l=t[7],h=t[8],d=t[9],f=t[10],m=t[11],g=t[12],x=t[13],p=t[14],u=t[15],v=d*p*l-x*f*l+x*c*m-o*p*m-d*c*u+o*f*u,_=g*f*l-h*p*l-g*c*m+a*p*m+h*c*u-a*f*u,b=h*x*l-g*d*l+g*o*m-a*x*m-h*o*u+a*d*u,S=g*d*c-h*x*c-g*o*f+a*x*f+h*o*p-a*d*p,T=e*v+n*_+s*b+r*S;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let R=1/T;return t[0]=v*R,t[1]=(x*f*r-d*p*r-x*s*m+n*p*m+d*s*u-n*f*u)*R,t[2]=(o*p*r-x*c*r+x*s*l-n*p*l-o*s*u+n*c*u)*R,t[3]=(d*c*r-o*f*r-d*s*l+n*f*l+o*s*m-n*c*m)*R,t[4]=_*R,t[5]=(h*p*r-g*f*r+g*s*m-e*p*m-h*s*u+e*f*u)*R,t[6]=(g*c*r-a*p*r-g*s*l+e*p*l+a*s*u-e*c*u)*R,t[7]=(a*f*r-h*c*r+h*s*l-e*f*l-a*s*m+e*c*m)*R,t[8]=b*R,t[9]=(g*d*r-h*x*r-g*n*m+e*x*m+h*n*u-e*d*u)*R,t[10]=(a*x*r-g*o*r+g*n*l-e*x*l-a*n*u+e*o*u)*R,t[11]=(h*o*r-a*d*r-h*n*l+e*d*l+a*n*m-e*o*m)*R,t[12]=S*R,t[13]=(h*x*s-g*d*s+g*n*f-e*x*f-h*n*p+e*d*p)*R,t[14]=(g*o*s-a*x*s-g*n*c+e*x*c+a*n*p-e*o*p)*R,t[15]=(a*d*s-h*o*s+h*n*c-e*d*c-a*n*f+e*o*f)*R,this}scale(t){let e=this.elements,n=t.x,s=t.y,r=t.z;return e[0]*=n,e[4]*=s,e[8]*=r,e[1]*=n,e[5]*=s,e[9]*=r,e[2]*=n,e[6]*=s,e[10]*=r,e[3]*=n,e[7]*=s,e[11]*=r,this}getMaxScaleOnAxis(){let t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,s))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){let e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){let e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){let n=Math.cos(e),s=Math.sin(e),r=1-n,a=t.x,o=t.y,c=t.z,l=r*a,h=r*o;return this.set(l*a+n,l*o-s*c,l*c+s*o,0,l*o+s*c,h*o+n,h*c-s*a,0,l*c-s*o,h*c+s*a,r*c*c+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,s,r,a){return this.set(1,n,r,0,t,1,a,0,e,s,1,0,0,0,0,1),this}compose(t,e,n){let s=this.elements,r=e._x,a=e._y,o=e._z,c=e._w,l=r+r,h=a+a,d=o+o,f=r*l,m=r*h,g=r*d,x=a*h,p=a*d,u=o*d,v=c*l,_=c*h,b=c*d,S=n.x,T=n.y,R=n.z;return s[0]=(1-(x+u))*S,s[1]=(m+b)*S,s[2]=(g-_)*S,s[3]=0,s[4]=(m-b)*T,s[5]=(1-(f+u))*T,s[6]=(p+v)*T,s[7]=0,s[8]=(g+_)*R,s[9]=(p-v)*R,s[10]=(1-(f+x))*R,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,n){let s=this.elements,r=jn.set(s[0],s[1],s[2]).length(),a=jn.set(s[4],s[5],s[6]).length(),o=jn.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),t.x=s[12],t.y=s[13],t.z=s[14],ze.copy(this);let l=1/r,h=1/a,d=1/o;return ze.elements[0]*=l,ze.elements[1]*=l,ze.elements[2]*=l,ze.elements[4]*=h,ze.elements[5]*=h,ze.elements[6]*=h,ze.elements[8]*=d,ze.elements[9]*=d,ze.elements[10]*=d,e.setFromRotationMatrix(ze),n.x=r,n.y=a,n.z=o,this}makePerspective(t,e,n,s,r,a,o=an){let c=this.elements,l=2*r/(e-t),h=2*r/(n-s),d=(e+t)/(e-t),f=(n+s)/(n-s),m,g;if(o===an)m=-(a+r)/(a-r),g=-2*a*r/(a-r);else if(o===Ls)m=-a/(a-r),g=-a*r/(a-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return c[0]=l,c[4]=0,c[8]=d,c[12]=0,c[1]=0,c[5]=h,c[9]=f,c[13]=0,c[2]=0,c[6]=0,c[10]=m,c[14]=g,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(t,e,n,s,r,a,o=an){let c=this.elements,l=1/(e-t),h=1/(n-s),d=1/(a-r),f=(e+t)*l,m=(n+s)*h,g,x;if(o===an)g=(a+r)*d,x=-2*d;else if(o===Ls)g=r*d,x=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-f,c[1]=0,c[5]=2*h,c[9]=0,c[13]=-m,c[2]=0,c[6]=0,c[10]=x,c[14]=-g,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(t){let e=this.elements,n=t.elements;for(let s=0;s<16;s++)if(e[s]!==n[s])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){let n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}},jn=new L,ze=new Kt,vh=new L(0,0,0),Mh=new L(1,1,1),xn=new L,as=new L,Re=new L,Ga=new Kt,Wa=new An,Fs=class i{constructor(t=0,e=0,n=0,s=i.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,s=this._order){return this._x=t,this._y=e,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){let s=t.elements,r=s[0],a=s[4],o=s[8],c=s[1],l=s[5],h=s[9],d=s[2],f=s[6],m=s[10];switch(e){case"XYZ":this._y=Math.asin(ve(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,m),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(f,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ve(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(o,m),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(ve(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,m),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(c,r));break;case"ZYX":this._y=Math.asin(-ve(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,m),this._z=Math.atan2(c,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(ve(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(o,m));break;case"XZY":this._z=Math.asin(-ve(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-h,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,n===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Ga.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ga,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Wa.setFromEuler(this),this.setFromQuaternion(Wa,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Fs.DEFAULT_ORDER="XYZ";var Os=class{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}},Sh=0,Xa=new L,ti=new An,nn=new Kt,cs=new L,Bi=new L,bh=new L,Eh=new An,qa=new L(1,0,0),Ya=new L(0,1,0),Za=new L(0,0,1),Th={type:"added"},Ah={type:"removed"},Ke=class i extends Tn{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Sh++}),this.uuid=Yi(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=i.DEFAULT_UP.clone();let t=new L,e=new Fs,n=new An,s=new L(1,1,1);function r(){n.setFromEuler(e,!1)}function a(){e.setFromQuaternion(n,void 0,!1)}e._onChange(r),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Kt},normalMatrix:{value:new Ft}}),this.matrix=new Kt,this.matrixWorld=new Kt,this.matrixAutoUpdate=i.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=i.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Os,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return ti.setFromAxisAngle(t,e),this.quaternion.multiply(ti),this}rotateOnWorldAxis(t,e){return ti.setFromAxisAngle(t,e),this.quaternion.premultiply(ti),this}rotateX(t){return this.rotateOnAxis(qa,t)}rotateY(t){return this.rotateOnAxis(Ya,t)}rotateZ(t){return this.rotateOnAxis(Za,t)}translateOnAxis(t,e){return Xa.copy(t).applyQuaternion(this.quaternion),this.position.add(Xa.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(qa,t)}translateY(t){return this.translateOnAxis(Ya,t)}translateZ(t){return this.translateOnAxis(Za,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(nn.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?cs.copy(t):cs.set(t,e,n);let s=this.parent;this.updateWorldMatrix(!0,!1),Bi.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?nn.lookAt(Bi,cs,this.up):nn.lookAt(cs,Bi,this.up),this.quaternion.setFromRotationMatrix(nn),s&&(nn.extractRotation(s.matrixWorld),ti.setFromRotationMatrix(nn),this.quaternion.premultiply(ti.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can\'t be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Th)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}let e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Ah)),this}removeFromParent(){let t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),nn.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),nn.multiply(t.parent.matrixWorld)),t.applyMatrix4(nn),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,s=this.children.length;n<s;n++){let a=this.children[n].getObjectByProperty(t,e);if(a!==void 0)return a}}getObjectsByProperty(t,e,n=[]){this[t]===e&&n.push(this);let s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Bi,t,bh),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Bi,Eh,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);let e=this.children;for(let n=0,s=e.length;n<s;n++)e[n].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);let e=this.children;for(let n=0,s=e.length;n<s;n++)e[n].traverseVisible(t)}traverseAncestors(t){let e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);let e=this.children;for(let n=0,s=e.length;n<s;n++){let r=e[n];(r.matrixWorldAutoUpdate===!0||t===!0)&&r.updateMatrixWorld(t)}}updateWorldMatrix(t,e){let n=this.parent;if(t===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){let s=this.children;for(let r=0,a=s.length;r<a;r++){let o=s[r];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(t){let e=t===void 0||typeof t=="string",n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});let s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),s.maxGeometryCount=this._maxGeometryCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(t),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function r(o,c){return o[c.uuid]===void 0&&(o[c.uuid]=c.toJSON(t)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(t.geometries,this.geometry);let o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){let c=o.shapes;if(Array.isArray(c))for(let l=0,h=c.length;l<h;l++){let d=c[l];r(t.shapes,d)}else r(t.shapes,c)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let o=[];for(let c=0,l=this.material.length;c<l;c++)o.push(r(t.materials,this.material[c]));s.material=o}else s.material=r(t.materials,this.material);if(this.children.length>0){s.children=[];for(let o=0;o<this.children.length;o++)s.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let o=0;o<this.animations.length;o++){let c=this.animations[o];s.animations.push(r(t.animations,c))}}if(e){let o=a(t.geometries),c=a(t.materials),l=a(t.textures),h=a(t.images),d=a(t.shapes),f=a(t.skeletons),m=a(t.animations),g=a(t.nodes);o.length>0&&(n.geometries=o),c.length>0&&(n.materials=c),l.length>0&&(n.textures=l),h.length>0&&(n.images=h),d.length>0&&(n.shapes=d),f.length>0&&(n.skeletons=f),m.length>0&&(n.animations=m),g.length>0&&(n.nodes=g)}return n.object=s,n;function a(o){let c=[];for(let l in o){let h=o[l];delete h.metadata,c.push(h)}return c}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let n=0;n<t.children.length;n++){let s=t.children[n];this.add(s.clone())}return this}};Ke.DEFAULT_UP=new L(0,1,0);Ke.DEFAULT_MATRIX_AUTO_UPDATE=!0;Ke.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var Ve=new L,sn=new L,Rr=new L,rn=new L,ei=new L,ni=new L,Ja=new L,Cr=new L,Pr=new L,Lr=new L,ls=!1,We=class i{constructor(t=new L,e=new L,n=new L){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,s){s.subVectors(n,e),Ve.subVectors(t,e),s.cross(Ve);let r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(t,e,n,s,r){Ve.subVectors(s,e),sn.subVectors(n,e),Rr.subVectors(t,e);let a=Ve.dot(Ve),o=Ve.dot(sn),c=Ve.dot(Rr),l=sn.dot(sn),h=sn.dot(Rr),d=a*l-o*o;if(d===0)return r.set(-2,-1,-1);let f=1/d,m=(l*c-o*h)*f,g=(a*h-o*c)*f;return r.set(1-m-g,g,m)}static containsPoint(t,e,n,s){return this.getBarycoord(t,e,n,s,rn),rn.x>=0&&rn.y>=0&&rn.x+rn.y<=1}static getUV(t,e,n,s,r,a,o,c){return ls===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),ls=!0),this.getInterpolation(t,e,n,s,r,a,o,c)}static getInterpolation(t,e,n,s,r,a,o,c){return this.getBarycoord(t,e,n,s,rn),c.setScalar(0),c.addScaledVector(r,rn.x),c.addScaledVector(a,rn.y),c.addScaledVector(o,rn.z),c}static isFrontFacing(t,e,n,s){return Ve.subVectors(n,e),sn.subVectors(t,e),Ve.cross(sn).dot(s)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,s){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[s]),this}setFromAttributeAndIndices(t,e,n,s){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,s),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Ve.subVectors(this.c,this.b),sn.subVectors(this.a,this.b),Ve.cross(sn).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return i.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return i.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,s,r){return ls===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),ls=!0),i.getInterpolation(t,this.a,this.b,this.c,e,n,s,r)}getInterpolation(t,e,n,s,r){return i.getInterpolation(t,this.a,this.b,this.c,e,n,s,r)}containsPoint(t){return i.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return i.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){let n=this.a,s=this.b,r=this.c,a,o;ei.subVectors(s,n),ni.subVectors(r,n),Cr.subVectors(t,n);let c=ei.dot(Cr),l=ni.dot(Cr);if(c<=0&&l<=0)return e.copy(n);Pr.subVectors(t,s);let h=ei.dot(Pr),d=ni.dot(Pr);if(h>=0&&d<=h)return e.copy(s);let f=c*d-h*l;if(f<=0&&c>=0&&h<=0)return a=c/(c-h),e.copy(n).addScaledVector(ei,a);Lr.subVectors(t,r);let m=ei.dot(Lr),g=ni.dot(Lr);if(g>=0&&m<=g)return e.copy(r);let x=m*l-c*g;if(x<=0&&l>=0&&g<=0)return o=l/(l-g),e.copy(n).addScaledVector(ni,o);let p=h*g-m*d;if(p<=0&&d-h>=0&&m-g>=0)return Ja.subVectors(r,s),o=(d-h)/(d-h+(m-g)),e.copy(s).addScaledVector(Ja,o);let u=1/(p+x+f);return a=x*u,o=f*u,e.copy(n).addScaledVector(ei,a).addScaledVector(ni,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},Fc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},yn={h:0,s:0,l:0},hs={h:0,s:0,l:0};function Ir(i,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?i+(t-i)*6*e:e<1/2?t:e<2/3?i+(t-i)*6*(2/3-e):i}var Ht=class{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(e===void 0&&n===void 0){let s=t;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=le){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Xt.toWorkingColorSpace(this,e),this}setRGB(t,e,n,s=Xt.workingColorSpace){return this.r=t,this.g=e,this.b=n,Xt.toWorkingColorSpace(this,s),this}setHSL(t,e,n,s=Xt.workingColorSpace){if(t=ph(t,1),e=ve(e,0,1),n=ve(n,0,1),e===0)this.r=this.g=this.b=n;else{let r=n<=.5?n*(1+e):n+e-n*e,a=2*n-r;this.r=Ir(a,r,t+1/3),this.g=Ir(a,r,t),this.b=Ir(a,r,t-1/3)}return Xt.toWorkingColorSpace(this,s),this}setStyle(t,e=le){function n(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let s;if(s=/^(\\w+)\\(([^\\)]*)\\)/.exec(t)){let r,a=s[1],o=s[2];switch(a){case"rgb":case"rgba":if(r=/^\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,e);if(r=/^\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*,\\s*(\\d+)\\%\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec(o))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,e);break;case"hsl":case"hsla":if(r=/^\\s*(\\d*\\.?\\d+)\\s*,\\s*(\\d*\\.?\\d+)\\%\\s*,\\s*(\\d*\\.?\\d+)\\%\\s*(?:,\\s*(\\d*\\.?\\d+)\\s*)?$/.exec(o))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(s=/^\\#([A-Fa-f\\d]+)$/.exec(t)){let r=s[1],a=r.length;if(a===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,e);if(a===6)return this.setHex(parseInt(r,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=le){let n=Fc[t.toLowerCase()];return n!==void 0?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=di(t.r),this.g=di(t.g),this.b=di(t.b),this}copyLinearToSRGB(t){return this.r=vr(t.r),this.g=vr(t.g),this.b=vr(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=le){return Xt.fromWorkingColorSpace(de.copy(this),t),Math.round(ve(de.r*255,0,255))*65536+Math.round(ve(de.g*255,0,255))*256+Math.round(ve(de.b*255,0,255))}getHexString(t=le){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Xt.workingColorSpace){Xt.fromWorkingColorSpace(de.copy(this),e);let n=de.r,s=de.g,r=de.b,a=Math.max(n,s,r),o=Math.min(n,s,r),c,l,h=(o+a)/2;if(o===a)c=0,l=0;else{let d=a-o;switch(l=h<=.5?d/(a+o):d/(2-a-o),a){case n:c=(s-r)/d+(s<r?6:0);break;case s:c=(r-n)/d+2;break;case r:c=(n-s)/d+4;break}c/=6}return t.h=c,t.s=l,t.l=h,t}getRGB(t,e=Xt.workingColorSpace){return Xt.fromWorkingColorSpace(de.copy(this),e),t.r=de.r,t.g=de.g,t.b=de.b,t}getStyle(t=le){Xt.fromWorkingColorSpace(de.copy(this),t);let e=de.r,n=de.g,s=de.b;return t!==le?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(n*255)},${Math.round(s*255)})`}offsetHSL(t,e,n){return this.getHSL(yn),this.setHSL(yn.h+t,yn.s+e,yn.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(yn),t.getHSL(hs);let n=xr(yn.h,hs.h,e),s=xr(yn.s,hs.s,e),r=xr(yn.l,hs.l,e);return this.setHSL(n,s,r),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){let e=this.r,n=this.g,s=this.b,r=t.elements;return this.r=r[0]*e+r[3]*n+r[6]*s,this.g=r[1]*e+r[4]*n+r[7]*s,this.b=r[2]*e+r[5]*n+r[8]*s,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}},de=new Ht;Ht.NAMES=Fc;var wh=0,xi=class extends Tn{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:wh++}),this.uuid=Yi(),this.name="",this.type="Material",this.blending=fi,this.side=Xe,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=kr,this.blendDst=Hr,this.blendEquation=On,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ht(0,0,0),this.blendAlpha=0,this.depthFunc=Ts,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Na,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Zn,this.stencilZFail=Zn,this.stencilZPass=Zn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(let e in t){let n=t[e];if(n===void 0){console.warn(`THREE.Material: parameter \'${e}\' has value of undefined.`);continue}let s=this[e];if(s===void 0){console.warn(`THREE.Material: \'${e}\' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(n):s&&s.isVector3&&n&&n.isVector3?s.copy(n):this[e]=n}}toJSON(t){let e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});let n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==fi&&(n.blending=this.blending),this.side!==Xe&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==kr&&(n.blendSrc=this.blendSrc),this.blendDst!==Hr&&(n.blendDst=this.blendDst),this.blendEquation!==On&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Ts&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Na&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Zn&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Zn&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Zn&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function s(r){let a=[];for(let o in r){let c=r[o];delete c.metadata,a.push(c)}return a}if(e){let r=s(t.textures),a=s(t.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;let e=t.clippingPlanes,n=null;if(e!==null){let s=e.length;n=new Array(s);for(let r=0;r!==s;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}},Bs=class extends xi{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ht(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ec,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}};var te=new L,us=new zt,ee=class{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=n,this.usage=Fa,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Mn,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}get updateRange(){return console.warn(\'THREE.BufferAttribute: "updateRange" is deprecated and removed in r169. Use "addUpdateRange()" instead.\'),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[t+s]=e.array[n+s];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,n=this.count;e<n;e++)us.fromBufferAttribute(this,e),us.applyMatrix3(t),this.setXY(e,us.x,us.y);else if(this.itemSize===3)for(let e=0,n=this.count;e<n;e++)te.fromBufferAttribute(this,e),te.applyMatrix3(t),this.setXYZ(e,te.x,te.y,te.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)te.fromBufferAttribute(this,e),te.applyMatrix4(t),this.setXYZ(e,te.x,te.y,te.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)te.fromBufferAttribute(this,e),te.applyNormalMatrix(t),this.setXYZ(e,te.x,te.y,te.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)te.fromBufferAttribute(this,e),te.transformDirection(t),this.setXYZ(e,te.x,te.y,te.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=Ni(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=Se(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Ni(e,this.array)),e}setX(t,e){return this.normalized&&(e=Se(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Ni(e,this.array)),e}setY(t,e){return this.normalized&&(e=Se(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Ni(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Se(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Ni(e,this.array)),e}setW(t,e){return this.normalized&&(e=Se(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=Se(e,this.array),n=Se(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,s){return t*=this.itemSize,this.normalized&&(e=Se(e,this.array),n=Se(n,this.array),s=Se(s,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=s,this}setXYZW(t,e,n,s,r){return t*=this.itemSize,this.normalized&&(e=Se(e,this.array),n=Se(n,this.array),s=Se(s,this.array),r=Se(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=s,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Fa&&(t.usage=this.usage),t}};var zs=class extends ee{constructor(t,e,n){super(new Uint16Array(t),e,n)}};var Vs=class extends ee{constructor(t,e,n){super(new Uint32Array(t),e,n)}};var cn=class extends ee{constructor(t,e,n){super(new Float32Array(t),e,n)}};var Rh=0,Ue=new Kt,Ur=new Ke,ii=new L,Ce=new Me,zi=new Me,oe=new L,un=class i extends Tn{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Rh++}),this.uuid=Yi(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Nc(t)?Vs:zs)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){let e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);let n=this.attributes.normal;if(n!==void 0){let r=new Ft().getNormalMatrix(t);n.applyNormalMatrix(r),n.needsUpdate=!0}let s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(t),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return Ue.makeRotationFromQuaternion(t),this.applyMatrix4(Ue),this}rotateX(t){return Ue.makeRotationX(t),this.applyMatrix4(Ue),this}rotateY(t){return Ue.makeRotationY(t),this.applyMatrix4(Ue),this}rotateZ(t){return Ue.makeRotationZ(t),this.applyMatrix4(Ue),this}translate(t,e,n){return Ue.makeTranslation(t,e,n),this.applyMatrix4(Ue),this}scale(t,e,n){return Ue.makeScale(t,e,n),this.applyMatrix4(Ue),this}lookAt(t){return Ur.lookAt(t),Ur.updateMatrix(),this.applyMatrix4(Ur.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ii).negate(),this.translate(ii.x,ii.y,ii.z),this}setFromPoints(t){let e=[];for(let n=0,s=t.length;n<s;n++){let r=t[n];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new cn(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Me);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error(\'THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".\',this),this.boundingBox.set(new L(-1/0,-1/0,-1/0),new L(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,s=e.length;n<s;n++){let r=e[n];Ce.setFromBufferAttribute(r),this.morphTargetsRelative?(oe.addVectors(this.boundingBox.min,Ce.min),this.boundingBox.expandByPoint(oe),oe.addVectors(this.boundingBox.max,Ce.max),this.boundingBox.expandByPoint(oe)):(this.boundingBox.expandByPoint(Ce.min),this.boundingBox.expandByPoint(Ce.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error(\'THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.\',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Hn);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error(\'THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".\',this),this.boundingSphere.set(new L,1/0);return}if(t){let n=this.boundingSphere.center;if(Ce.setFromBufferAttribute(t),e)for(let r=0,a=e.length;r<a;r++){let o=e[r];zi.setFromBufferAttribute(o),this.morphTargetsRelative?(oe.addVectors(Ce.min,zi.min),Ce.expandByPoint(oe),oe.addVectors(Ce.max,zi.max),Ce.expandByPoint(oe)):(Ce.expandByPoint(zi.min),Ce.expandByPoint(zi.max))}Ce.getCenter(n);let s=0;for(let r=0,a=t.count;r<a;r++)oe.fromBufferAttribute(t,r),s=Math.max(s,n.distanceToSquared(oe));if(e)for(let r=0,a=e.length;r<a;r++){let o=e[r],c=this.morphTargetsRelative;for(let l=0,h=o.count;l<h;l++)oe.fromBufferAttribute(o,l),c&&(ii.fromBufferAttribute(t,l),oe.add(ii)),s=Math.max(s,n.distanceToSquared(oe))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error(\'THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.\',this)}}computeTangents(){let t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let n=t.array,s=e.position.array,r=e.normal.array,a=e.uv.array,o=s.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ee(new Float32Array(4*o),4));let c=this.getAttribute("tangent").array,l=[],h=[];for(let A=0;A<o;A++)l[A]=new L,h[A]=new L;let d=new L,f=new L,m=new L,g=new zt,x=new zt,p=new zt,u=new L,v=new L;function _(A,D,z){d.fromArray(s,A*3),f.fromArray(s,D*3),m.fromArray(s,z*3),g.fromArray(a,A*2),x.fromArray(a,D*2),p.fromArray(a,z*2),f.sub(d),m.sub(d),x.sub(g),p.sub(g);let X=1/(x.x*p.y-p.x*x.y);isFinite(X)&&(u.copy(f).multiplyScalar(p.y).addScaledVector(m,-x.y).multiplyScalar(X),v.copy(m).multiplyScalar(x.x).addScaledVector(f,-p.x).multiplyScalar(X),l[A].add(u),l[D].add(u),l[z].add(u),h[A].add(v),h[D].add(v),h[z].add(v))}let b=this.groups;b.length===0&&(b=[{start:0,count:n.length}]);for(let A=0,D=b.length;A<D;++A){let z=b[A],X=z.start,C=z.count;for(let F=X,Y=X+C;F<Y;F+=3)_(n[F+0],n[F+1],n[F+2])}let S=new L,T=new L,R=new L,I=new L;function y(A){R.fromArray(r,A*3),I.copy(R);let D=l[A];S.copy(D),S.sub(R.multiplyScalar(R.dot(D))).normalize(),T.crossVectors(I,D);let X=T.dot(h[A])<0?-1:1;c[A*4]=S.x,c[A*4+1]=S.y,c[A*4+2]=S.z,c[A*4+3]=X}for(let A=0,D=b.length;A<D;++A){let z=b[A],X=z.start,C=z.count;for(let F=X,Y=X+C;F<Y;F+=3)y(n[F+0]),y(n[F+1]),y(n[F+2])}}computeVertexNormals(){let t=this.index,e=this.getAttribute("position");if(e!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new ee(new Float32Array(e.count*3),3),this.setAttribute("normal",n);else for(let f=0,m=n.count;f<m;f++)n.setXYZ(f,0,0,0);let s=new L,r=new L,a=new L,o=new L,c=new L,l=new L,h=new L,d=new L;if(t)for(let f=0,m=t.count;f<m;f+=3){let g=t.getX(f+0),x=t.getX(f+1),p=t.getX(f+2);s.fromBufferAttribute(e,g),r.fromBufferAttribute(e,x),a.fromBufferAttribute(e,p),h.subVectors(a,r),d.subVectors(s,r),h.cross(d),o.fromBufferAttribute(n,g),c.fromBufferAttribute(n,x),l.fromBufferAttribute(n,p),o.add(h),c.add(h),l.add(h),n.setXYZ(g,o.x,o.y,o.z),n.setXYZ(x,c.x,c.y,c.z),n.setXYZ(p,l.x,l.y,l.z)}else for(let f=0,m=e.count;f<m;f+=3)s.fromBufferAttribute(e,f+0),r.fromBufferAttribute(e,f+1),a.fromBufferAttribute(e,f+2),h.subVectors(a,r),d.subVectors(s,r),h.cross(d),n.setXYZ(f+0,h.x,h.y,h.z),n.setXYZ(f+1,h.x,h.y,h.z),n.setXYZ(f+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){let t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)oe.fromBufferAttribute(t,e),oe.normalize(),t.setXYZ(e,oe.x,oe.y,oe.z)}toNonIndexed(){function t(o,c){let l=o.array,h=o.itemSize,d=o.normalized,f=new l.constructor(c.length*h),m=0,g=0;for(let x=0,p=c.length;x<p;x++){o.isInterleavedBufferAttribute?m=c[x]*o.data.stride+o.offset:m=c[x]*h;for(let u=0;u<h;u++)f[g++]=l[m++]}return new ee(f,h,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let e=new i,n=this.index.array,s=this.attributes;for(let o in s){let c=s[o],l=t(c,n);e.setAttribute(o,l)}let r=this.morphAttributes;for(let o in r){let c=[],l=r[o];for(let h=0,d=l.length;h<d;h++){let f=l[h],m=t(f,n);c.push(m)}e.morphAttributes[o]=c}e.morphTargetsRelative=this.morphTargetsRelative;let a=this.groups;for(let o=0,c=a.length;o<c;o++){let l=a[o];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){let t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){let c=this.parameters;for(let l in c)c[l]!==void 0&&(t[l]=c[l]);return t}t.data={attributes:{}};let e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});let n=this.attributes;for(let c in n){let l=n[c];t.data.attributes[c]=l.toJSON(t.data)}let s={},r=!1;for(let c in this.morphAttributes){let l=this.morphAttributes[c],h=[];for(let d=0,f=l.length;d<f;d++){let m=l[d];h.push(m.toJSON(t.data))}h.length>0&&(s[c]=h,r=!0)}r&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);let a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));let o=this.boundingSphere;return o!==null&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let e={};this.name=t.name;let n=t.index;n!==null&&this.setIndex(n.clone(e));let s=t.attributes;for(let l in s){let h=s[l];this.setAttribute(l,h.clone(e))}let r=t.morphAttributes;for(let l in r){let h=[],d=r[l];for(let f=0,m=d.length;f<m;f++)h.push(d[f].clone(e));this.morphAttributes[l]=h}this.morphTargetsRelative=t.morphTargetsRelative;let a=t.groups;for(let l=0,h=a.length;l<h;l++){let d=a[l];this.addGroup(d.start,d.count,d.materialIndex)}let o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());let c=t.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}},$a=new Kt,Dn=new Qr,fs=new Hn,Ka=new L,si=new L,ri=new L,oi=new L,Dr=new L,ds=new L,ps=new zt,ms=new zt,gs=new zt,Qa=new L,ja=new L,tc=new L,_s=new L,xs=new L,$e=class extends Ke{constructor(t=new un,e=new Bs){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){let s=e[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=s.length;r<a;r++){let o=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}getVertexPosition(t,e){let n=this.geometry,s=n.attributes.position,r=n.morphAttributes.position,a=n.morphTargetsRelative;e.fromBufferAttribute(s,t);let o=this.morphTargetInfluences;if(r&&o){ds.set(0,0,0);for(let c=0,l=r.length;c<l;c++){let h=o[c],d=r[c];h!==0&&(Dr.fromBufferAttribute(d,t),a?ds.addScaledVector(Dr,h):ds.addScaledVector(Dr.sub(e),h))}e.add(ds)}return e}raycast(t,e){let n=this.geometry,s=this.material,r=this.matrixWorld;s!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),fs.copy(n.boundingSphere),fs.applyMatrix4(r),Dn.copy(t.ray).recast(t.near),!(fs.containsPoint(Dn.origin)===!1&&(Dn.intersectSphere(fs,Ka)===null||Dn.origin.distanceToSquared(Ka)>(t.far-t.near)**2))&&($a.copy(r).invert(),Dn.copy(t.ray).applyMatrix4($a),!(n.boundingBox!==null&&Dn.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(t,e,Dn)))}_computeIntersections(t,e,n){let s,r=this.geometry,a=this.material,o=r.index,c=r.attributes.position,l=r.attributes.uv,h=r.attributes.uv1,d=r.attributes.normal,f=r.groups,m=r.drawRange;if(o!==null)if(Array.isArray(a))for(let g=0,x=f.length;g<x;g++){let p=f[g],u=a[p.materialIndex],v=Math.max(p.start,m.start),_=Math.min(o.count,Math.min(p.start+p.count,m.start+m.count));for(let b=v,S=_;b<S;b+=3){let T=o.getX(b),R=o.getX(b+1),I=o.getX(b+2);s=ys(this,u,t,n,l,h,d,T,R,I),s&&(s.faceIndex=Math.floor(b/3),s.face.materialIndex=p.materialIndex,e.push(s))}}else{let g=Math.max(0,m.start),x=Math.min(o.count,m.start+m.count);for(let p=g,u=x;p<u;p+=3){let v=o.getX(p),_=o.getX(p+1),b=o.getX(p+2);s=ys(this,a,t,n,l,h,d,v,_,b),s&&(s.faceIndex=Math.floor(p/3),e.push(s))}}else if(c!==void 0)if(Array.isArray(a))for(let g=0,x=f.length;g<x;g++){let p=f[g],u=a[p.materialIndex],v=Math.max(p.start,m.start),_=Math.min(c.count,Math.min(p.start+p.count,m.start+m.count));for(let b=v,S=_;b<S;b+=3){let T=b,R=b+1,I=b+2;s=ys(this,u,t,n,l,h,d,T,R,I),s&&(s.faceIndex=Math.floor(b/3),s.face.materialIndex=p.materialIndex,e.push(s))}}else{let g=Math.max(0,m.start),x=Math.min(c.count,m.start+m.count);for(let p=g,u=x;p<u;p+=3){let v=p,_=p+1,b=p+2;s=ys(this,a,t,n,l,h,d,v,_,b),s&&(s.faceIndex=Math.floor(p/3),e.push(s))}}}};function Ch(i,t,e,n,s,r,a,o){let c;if(t.side===pe?c=n.intersectTriangle(a,r,s,!0,o):c=n.intersectTriangle(s,r,a,t.side===Xe,o),c===null)return null;xs.copy(o),xs.applyMatrix4(i.matrixWorld);let l=e.ray.origin.distanceTo(xs);return l<e.near||l>e.far?null:{distance:l,point:xs.clone(),object:i}}function ys(i,t,e,n,s,r,a,o,c,l){i.getVertexPosition(o,si),i.getVertexPosition(c,ri),i.getVertexPosition(l,oi);let h=Ch(i,t,e,n,si,ri,oi,_s);if(h){s&&(ps.fromBufferAttribute(s,o),ms.fromBufferAttribute(s,c),gs.fromBufferAttribute(s,l),h.uv=We.getInterpolation(_s,si,ri,oi,ps,ms,gs,new zt)),r&&(ps.fromBufferAttribute(r,o),ms.fromBufferAttribute(r,c),gs.fromBufferAttribute(r,l),h.uv1=We.getInterpolation(_s,si,ri,oi,ps,ms,gs,new zt),h.uv2=h.uv1),a&&(Qa.fromBufferAttribute(a,o),ja.fromBufferAttribute(a,c),tc.fromBufferAttribute(a,l),h.normal=We.getInterpolation(_s,si,ri,oi,Qa,ja,tc,new L),h.normal.dot(n.direction)>0&&h.normal.multiplyScalar(-1));let d={a:o,b:c,c:l,normal:new L,materialIndex:0};We.getNormal(si,ri,oi,d.normal),h.face=d}return h}var Xi=class i extends un{constructor(t=1,e=1,n=1,s=1,r=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:s,heightSegments:r,depthSegments:a};let o=this;s=Math.floor(s),r=Math.floor(r),a=Math.floor(a);let c=[],l=[],h=[],d=[],f=0,m=0;g("z","y","x",-1,-1,n,e,t,a,r,0),g("z","y","x",1,-1,n,e,-t,a,r,1),g("x","z","y",1,1,t,n,e,s,a,2),g("x","z","y",1,-1,t,n,-e,s,a,3),g("x","y","z",1,-1,t,e,n,s,r,4),g("x","y","z",-1,-1,t,e,-n,s,r,5),this.setIndex(c),this.setAttribute("position",new cn(l,3)),this.setAttribute("normal",new cn(h,3)),this.setAttribute("uv",new cn(d,2));function g(x,p,u,v,_,b,S,T,R,I,y){let A=b/R,D=S/I,z=b/2,X=S/2,C=T/2,F=R+1,Y=I+1,H=0,J=0,q=new L;for(let $=0;$<Y;$++){let tt=$*D-X;for(let ut=0;ut<F;ut++){let G=ut*A-z;q[x]=G*v,q[p]=tt*_,q[u]=C,l.push(q.x,q.y,q.z),q[x]=0,q[p]=0,q[u]=T>0?1:-1,h.push(q.x,q.y,q.z),d.push(ut/R),d.push(1-$/I),H+=1}}for(let $=0;$<I;$++)for(let tt=0;tt<R;tt++){let ut=f+tt+F*$,G=f+tt+F*($+1),Z=f+(tt+1)+F*($+1),ot=f+(tt+1)+F*$;c.push(ut,G,ot),c.push(G,Z,ot),J+=6}o.addGroup(m,J,y),m+=J,f+=H}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new i(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}};function yi(i){let t={};for(let e in i){t[e]={};for(let n in i[e]){let s=i[e][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[e][n]=null):t[e][n]=s.clone():Array.isArray(s)?t[e][n]=s.slice():t[e][n]=s}}return t}function xe(i){let t={};for(let e=0;e<i.length;e++){let n=yi(i[e]);for(let s in n)t[s]=n[s]}return t}function Ph(i){let t=[];for(let e=0;e<i.length;e++)t.push(i[e].clone());return t}function Oc(i){return i.getRenderTarget()===null?i.outputColorSpace:Xt.workingColorSpace}var Lh={clone:yi,merge:xe},Ih=`void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}`,Uh=`void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}`,fn=class extends xi{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Ih,this.fragmentShader=Uh,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=yi(t.uniforms),this.uniformsGroups=Ph(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){let e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(let s in this.uniforms){let a=this.uniforms[s].value;a&&a.isTexture?e.uniforms[s]={type:"t",value:a.toJSON(t).uuid}:a&&a.isColor?e.uniforms[s]={type:"c",value:a.getHex()}:a&&a.isVector2?e.uniforms[s]={type:"v2",value:a.toArray()}:a&&a.isVector3?e.uniforms[s]={type:"v3",value:a.toArray()}:a&&a.isVector4?e.uniforms[s]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?e.uniforms[s]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?e.uniforms[s]={type:"m4",value:a.toArray()}:e.uniforms[s]={value:a}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;let n={};for(let s in this.extensions)this.extensions[s]===!0&&(n[s]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}},ks=class extends Ke{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Kt,this.projectionMatrix=new Kt,this.projectionMatrixInverse=new Kt,this.coordinateSystem=an}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},Pe=class extends ks{constructor(t=50,e=1,n=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){let e=.5*this.getFilmHeight()/t;this.fov=Zr*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){let t=Math.tan(_r*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return Zr*2*Math.atan(Math.tan(_r*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,s,r,a){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=this.near,e=t*Math.tan(_r*.5*this.fov)/this.zoom,n=2*e,s=this.aspect*n,r=-.5*s,a=this.view;if(this.view!==null&&this.view.enabled){let c=a.fullWidth,l=a.fullHeight;r+=a.offsetX*s/c,e-=a.offsetY*n/l,s*=a.width/c,n*=a.height/l}let o=this.filmOffset;o!==0&&(r+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,e,e-n,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}},ai=-90,ci=1,jr=class extends Ke{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;let s=new Pe(ai,ci,t,e);s.layers=this.layers,this.add(s);let r=new Pe(ai,ci,t,e);r.layers=this.layers,this.add(r);let a=new Pe(ai,ci,t,e);a.layers=this.layers,this.add(a);let o=new Pe(ai,ci,t,e);o.layers=this.layers,this.add(o);let c=new Pe(ai,ci,t,e);c.layers=this.layers,this.add(c);let l=new Pe(ai,ci,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){let t=this.coordinateSystem,e=this.children.concat(),[n,s,r,a,o,c]=e;for(let l of e)this.remove(l);if(t===an)n.up.set(0,1,0),n.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(t===Ls)n.up.set(0,-1,0),n.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(let l of e)this.add(l),l.updateMatrixWorld()}update(t,e){this.parent===null&&this.updateMatrixWorld();let{renderTarget:n,activeMipmapLevel:s}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());let[r,a,o,c,l,h]=this.children,d=t.getRenderTarget(),f=t.getActiveCubeFace(),m=t.getActiveMipmapLevel(),g=t.xr.enabled;t.xr.enabled=!1;let x=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0,s),t.render(e,r),t.setRenderTarget(n,1,s),t.render(e,a),t.setRenderTarget(n,2,s),t.render(e,o),t.setRenderTarget(n,3,s),t.render(e,c),t.setRenderTarget(n,4,s),t.render(e,l),n.texture.generateMipmaps=x,t.setRenderTarget(n,5,s),t.render(e,h),t.setRenderTarget(d,f,m),t.xr.enabled=g,n.texture.needsPMREMUpdate=!0}},Hs=class extends qe{constructor(t,e,n,s,r,a,o,c,l,h){t=t!==void 0?t:[],e=e!==void 0?e:mi,super(t,e,n,s,r,a,o,c,l,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}},to=class extends hn{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;let n={width:t,height:t,depth:1},s=[n,n,n,n,n,n];e.encoding!==void 0&&(ki("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),e.colorSpace=e.encoding===kn?le:Ne),this.texture=new Hs(s,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:De}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;let n={uniforms:{tEquirect:{value:null}},vertexShader:`\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t`,fragmentShader:`\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t`},s=new Xi(5,5,5),r=new fn({name:"CubemapFromEquirect",uniforms:yi(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:pe,blending:Sn});r.uniforms.tEquirect.value=e;let a=new $e(s,r),o=e.minFilter;return e.minFilter===Gi&&(e.minFilter=De),new jr(1,10,this).update(t,a),e.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(t,e,n,s){let r=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(e,n,s);t.setRenderTarget(r)}},Nr=new L,Dh=new L,Nh=new Ft,Le=class{constructor(t=new L(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,s){return this.normal.set(t,e,n),this.constant=s,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){let s=Nr.subVectors(n,e).cross(Dh.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(s,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){let t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){let n=t.delta(Nr),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;let r=-(t.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:e.copy(t.start).addScaledVector(n,r)}intersectsLine(t){let e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){let n=e||Nh.getNormalMatrix(t),s=this.coplanarPoint(Nr).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}},Nn=new Hn,vs=new L,Gs=class{constructor(t=new Le,e=new Le,n=new Le,s=new Le,r=new Le,a=new Le){this.planes=[t,e,n,s,r,a]}set(t,e,n,s,r,a){let o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(s),o[4].copy(r),o[5].copy(a),this}copy(t){let e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t,e=an){let n=this.planes,s=t.elements,r=s[0],a=s[1],o=s[2],c=s[3],l=s[4],h=s[5],d=s[6],f=s[7],m=s[8],g=s[9],x=s[10],p=s[11],u=s[12],v=s[13],_=s[14],b=s[15];if(n[0].setComponents(c-r,f-l,p-m,b-u).normalize(),n[1].setComponents(c+r,f+l,p+m,b+u).normalize(),n[2].setComponents(c+a,f+h,p+g,b+v).normalize(),n[3].setComponents(c-a,f-h,p-g,b-v).normalize(),n[4].setComponents(c-o,f-d,p-x,b-_).normalize(),e===an)n[5].setComponents(c+o,f+d,p+x,b+_).normalize();else if(e===Ls)n[5].setComponents(o,d,x,_).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),Nn.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{let e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),Nn.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(Nn)}intersectsSprite(t){return Nn.center.set(0,0,0),Nn.radius=.7071067811865476,Nn.applyMatrix4(t.matrixWorld),this.intersectsSphere(Nn)}intersectsSphere(t){let e=this.planes,n=t.center,s=-t.radius;for(let r=0;r<6;r++)if(e[r].distanceToPoint(n)<s)return!1;return!0}intersectsBox(t){let e=this.planes;for(let n=0;n<6;n++){let s=e[n];if(vs.x=s.normal.x>0?t.max.x:t.min.x,vs.y=s.normal.y>0?t.max.y:t.min.y,vs.z=s.normal.z>0?t.max.z:t.min.z,s.distanceToPoint(vs)<0)return!1}return!0}containsPoint(t){let e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function Bc(){let i=null,t=!1,e=null,n=null;function s(r,a){e(r,a),n=i.requestAnimationFrame(s)}return{start:function(){t!==!0&&e!==null&&(n=i.requestAnimationFrame(s),t=!0)},stop:function(){i.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(r){e=r},setContext:function(r){i=r}}}function Fh(i,t){let e=t.isWebGL2,n=new WeakMap;function s(l,h){let d=l.array,f=l.usage,m=d.byteLength,g=i.createBuffer();i.bindBuffer(h,g),i.bufferData(h,d,f),l.onUploadCallback();let x;if(d instanceof Float32Array)x=i.FLOAT;else if(d instanceof Uint16Array)if(l.isFloat16BufferAttribute)if(e)x=i.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else x=i.UNSIGNED_SHORT;else if(d instanceof Int16Array)x=i.SHORT;else if(d instanceof Uint32Array)x=i.UNSIGNED_INT;else if(d instanceof Int32Array)x=i.INT;else if(d instanceof Int8Array)x=i.BYTE;else if(d instanceof Uint8Array)x=i.UNSIGNED_BYTE;else if(d instanceof Uint8ClampedArray)x=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:g,type:x,bytesPerElement:d.BYTES_PER_ELEMENT,version:l.version,size:m}}function r(l,h,d){let f=h.array,m=h._updateRange,g=h.updateRanges;if(i.bindBuffer(d,l),m.count===-1&&g.length===0&&i.bufferSubData(d,0,f),g.length!==0){for(let x=0,p=g.length;x<p;x++){let u=g[x];e?i.bufferSubData(d,u.start*f.BYTES_PER_ELEMENT,f,u.start,u.count):i.bufferSubData(d,u.start*f.BYTES_PER_ELEMENT,f.subarray(u.start,u.start+u.count))}h.clearUpdateRanges()}m.count!==-1&&(e?i.bufferSubData(d,m.offset*f.BYTES_PER_ELEMENT,f,m.offset,m.count):i.bufferSubData(d,m.offset*f.BYTES_PER_ELEMENT,f.subarray(m.offset,m.offset+m.count)),m.count=-1),h.onUploadCallback()}function a(l){return l.isInterleavedBufferAttribute&&(l=l.data),n.get(l)}function o(l){l.isInterleavedBufferAttribute&&(l=l.data);let h=n.get(l);h&&(i.deleteBuffer(h.buffer),n.delete(l))}function c(l,h){if(l.isGLBufferAttribute){let f=n.get(l);(!f||f.version<l.version)&&n.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}l.isInterleavedBufferAttribute&&(l=l.data);let d=n.get(l);if(d===void 0)n.set(l,s(l,h));else if(d.version<l.version){if(d.size!==l.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute\'s array buffer does not match the original size. Resizing buffer attributes is not supported.");r(d.buffer,l,h),d.version=l.version}}return{get:a,remove:o,update:c}}var eo=class i extends un{constructor(t=1,e=1,n=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:s};let r=t/2,a=e/2,o=Math.floor(n),c=Math.floor(s),l=o+1,h=c+1,d=t/o,f=e/c,m=[],g=[],x=[],p=[];for(let u=0;u<h;u++){let v=u*f-a;for(let _=0;_<l;_++){let b=_*d-r;g.push(b,-v,0),x.push(0,0,1),p.push(_/o),p.push(1-u/c)}}for(let u=0;u<c;u++)for(let v=0;v<o;v++){let _=v+l*u,b=v+l*(u+1),S=v+1+l*(u+1),T=v+1+l*u;m.push(_,b,T),m.push(b,S,T)}this.setIndex(m),this.setAttribute("position",new cn(g,3)),this.setAttribute("normal",new cn(x,3)),this.setAttribute("uv",new cn(p,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new i(t.width,t.height,t.widthSegments,t.heightSegments)}},Oh=`#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif`,Bh=`#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif`,zh=`#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif`,Vh=`#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif`,kh=`#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif`,Hh=`#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif`,Gh=`#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif`,Wh=`#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif`,Xh=`#ifdef USE_BATCHING\n\tattribute float batchId;\n\tuniform highp sampler2D batchingTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif`,qh=`#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif`,Yh=`vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif`,Zh=`vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif`,Jh=`float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated`,$h=`#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif`,Kh=`#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif`,Qh=`#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif`,jh=`#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif`,tu=`#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif`,eu=`#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif`,nu=`#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif`,iu=`#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif`,su=`#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif`,ru=`#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif`,ou=`#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated`,au=`#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif`,cu=`vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif`,lu=`#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif`,hu=`#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif`,uu=`#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif`,fu=`#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif`,du="gl_FragColor = linearToOutputTexel( gl_FragColor );",pu=`\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}`,mu=`#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif`,gu=`#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif`,_u=`#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif`,xu=`#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif`,yu=`#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif`,vu=`#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif`,Mu=`#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif`,Su=`#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif`,bu=`#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif`,Eu=`#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}`,Tu=`#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif`,Au=`#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif`,wu=`LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;`,Ru=`varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert`,Cu=`uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif`,Pu=`#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif`,Lu=`ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;`,Iu=`varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon`,Uu=`BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;`,Du=`varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong`,Nu=`PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif`,Fu=`struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}`,Ou=`\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif`,Bu=`#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif`,zu=`#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif`,Vu=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif`,ku=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif`,Hu=`#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif`,Gu=`#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif`,Wu=`#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif`,Xu=`#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif`,qu=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif`,Yu=`#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif`,Zu=`float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif`,Ju=`#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif`,$u=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif`,Ku=`#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif`,Qu=`#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif`,ju=`#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif`,tf=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;`,ef=`#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif`,nf=`#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif`,sf=`#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif`,rf=`#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif`,of=`#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif`,af=`#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif`,cf=`#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif`,lf=`#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif`,hf=`#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif`,uf=`#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );`,ff=`vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}`,df=`#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif`,pf=`vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;`,mf=`#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif`,gf=`#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif`,_f=`float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif`,xf=`#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif`,yf=`#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif`,vf=`#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif`,Mf=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif`,Sf=`float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}`,bf=`#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif`,Ef=`#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif`,Tf=`#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif`,Af=`#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif`,wf=`float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif`,Rf=`#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif`,Cf=`#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif`,Pf=`#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }`,Lf=`#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif`,If=`#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif`,Uf=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif`,Df=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif`,Nf=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif`,Ff=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif`,Of=`varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}`,Bf=`uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}`,zf=`varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}`,Vf=`#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}`,kf=`varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}`,Hf=`uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}`,Gf=`#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}`,Wf=`#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}`,Xf=`#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}`,qf=`#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}`,Yf=`varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}`,Zf=`uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}`,Jf=`uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}`,$f=`uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}`,Kf=`#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}`,Qf=`uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}`,jf=`#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}`,td=`#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}`,ed=`#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}`,nd=`#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}`,id=`#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}`,sd=`#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}`,rd=`#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}`,od=`#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}`,ad=`#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}`,cd=`#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}`,ld=`#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}`,hd=`#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}`,ud=`uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}`,fd=`uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}`,dd=`#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}`,pd=`uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}`,md=`uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}`,gd=`uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}`,Lt={alphahash_fragment:Oh,alphahash_pars_fragment:Bh,alphamap_fragment:zh,alphamap_pars_fragment:Vh,alphatest_fragment:kh,alphatest_pars_fragment:Hh,aomap_fragment:Gh,aomap_pars_fragment:Wh,batching_pars_vertex:Xh,batching_vertex:qh,begin_vertex:Yh,beginnormal_vertex:Zh,bsdfs:Jh,iridescence_fragment:$h,bumpmap_pars_fragment:Kh,clipping_planes_fragment:Qh,clipping_planes_pars_fragment:jh,clipping_planes_pars_vertex:tu,clipping_planes_vertex:eu,color_fragment:nu,color_pars_fragment:iu,color_pars_vertex:su,color_vertex:ru,common:ou,cube_uv_reflection_fragment:au,defaultnormal_vertex:cu,displacementmap_pars_vertex:lu,displacementmap_vertex:hu,emissivemap_fragment:uu,emissivemap_pars_fragment:fu,colorspace_fragment:du,colorspace_pars_fragment:pu,envmap_fragment:mu,envmap_common_pars_fragment:gu,envmap_pars_fragment:_u,envmap_pars_vertex:xu,envmap_physical_pars_fragment:Pu,envmap_vertex:yu,fog_vertex:vu,fog_pars_vertex:Mu,fog_fragment:Su,fog_pars_fragment:bu,gradientmap_pars_fragment:Eu,lightmap_fragment:Tu,lightmap_pars_fragment:Au,lights_lambert_fragment:wu,lights_lambert_pars_fragment:Ru,lights_pars_begin:Cu,lights_toon_fragment:Lu,lights_toon_pars_fragment:Iu,lights_phong_fragment:Uu,lights_phong_pars_fragment:Du,lights_physical_fragment:Nu,lights_physical_pars_fragment:Fu,lights_fragment_begin:Ou,lights_fragment_maps:Bu,lights_fragment_end:zu,logdepthbuf_fragment:Vu,logdepthbuf_pars_fragment:ku,logdepthbuf_pars_vertex:Hu,logdepthbuf_vertex:Gu,map_fragment:Wu,map_pars_fragment:Xu,map_particle_fragment:qu,map_particle_pars_fragment:Yu,metalnessmap_fragment:Zu,metalnessmap_pars_fragment:Ju,morphcolor_vertex:$u,morphnormal_vertex:Ku,morphtarget_pars_vertex:Qu,morphtarget_vertex:ju,normal_fragment_begin:tf,normal_fragment_maps:ef,normal_pars_fragment:nf,normal_pars_vertex:sf,normal_vertex:rf,normalmap_pars_fragment:of,clearcoat_normal_fragment_begin:af,clearcoat_normal_fragment_maps:cf,clearcoat_pars_fragment:lf,iridescence_pars_fragment:hf,opaque_fragment:uf,packing:ff,premultiplied_alpha_fragment:df,project_vertex:pf,dithering_fragment:mf,dithering_pars_fragment:gf,roughnessmap_fragment:_f,roughnessmap_pars_fragment:xf,shadowmap_pars_fragment:yf,shadowmap_pars_vertex:vf,shadowmap_vertex:Mf,shadowmask_pars_fragment:Sf,skinbase_vertex:bf,skinning_pars_vertex:Ef,skinning_vertex:Tf,skinnormal_vertex:Af,specularmap_fragment:wf,specularmap_pars_fragment:Rf,tonemapping_fragment:Cf,tonemapping_pars_fragment:Pf,transmission_fragment:Lf,transmission_pars_fragment:If,uv_pars_fragment:Uf,uv_pars_vertex:Df,uv_vertex:Nf,worldpos_vertex:Ff,background_vert:Of,background_frag:Bf,backgroundCube_vert:zf,backgroundCube_frag:Vf,cube_vert:kf,cube_frag:Hf,depth_vert:Gf,depth_frag:Wf,distanceRGBA_vert:Xf,distanceRGBA_frag:qf,equirect_vert:Yf,equirect_frag:Zf,linedashed_vert:Jf,linedashed_frag:$f,meshbasic_vert:Kf,meshbasic_frag:Qf,meshlambert_vert:jf,meshlambert_frag:td,meshmatcap_vert:ed,meshmatcap_frag:nd,meshnormal_vert:id,meshnormal_frag:sd,meshphong_vert:rd,meshphong_frag:od,meshphysical_vert:ad,meshphysical_frag:cd,meshtoon_vert:ld,meshtoon_frag:hd,points_vert:ud,points_frag:fd,shadow_vert:dd,shadow_frag:pd,sprite_vert:md,sprite_frag:gd},rt={common:{diffuse:{value:new Ht(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ft},alphaMap:{value:null},alphaMapTransform:{value:new Ft},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ft}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ft}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ft}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ft},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ft},normalScale:{value:new zt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ft},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ft}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ft}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ft}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ht(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ht(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ft},alphaTest:{value:0},uvTransform:{value:new Ft}},sprite:{diffuse:{value:new Ht(16777215)},opacity:{value:1},center:{value:new zt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ft},alphaMap:{value:null},alphaMapTransform:{value:new Ft},alphaTest:{value:0}}},Je={basic:{uniforms:xe([rt.common,rt.specularmap,rt.envmap,rt.aomap,rt.lightmap,rt.fog]),vertexShader:Lt.meshbasic_vert,fragmentShader:Lt.meshbasic_frag},lambert:{uniforms:xe([rt.common,rt.specularmap,rt.envmap,rt.aomap,rt.lightmap,rt.emissivemap,rt.bumpmap,rt.normalmap,rt.displacementmap,rt.fog,rt.lights,{emissive:{value:new Ht(0)}}]),vertexShader:Lt.meshlambert_vert,fragmentShader:Lt.meshlambert_frag},phong:{uniforms:xe([rt.common,rt.specularmap,rt.envmap,rt.aomap,rt.lightmap,rt.emissivemap,rt.bumpmap,rt.normalmap,rt.displacementmap,rt.fog,rt.lights,{emissive:{value:new Ht(0)},specular:{value:new Ht(1118481)},shininess:{value:30}}]),vertexShader:Lt.meshphong_vert,fragmentShader:Lt.meshphong_frag},standard:{uniforms:xe([rt.common,rt.envmap,rt.aomap,rt.lightmap,rt.emissivemap,rt.bumpmap,rt.normalmap,rt.displacementmap,rt.roughnessmap,rt.metalnessmap,rt.fog,rt.lights,{emissive:{value:new Ht(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Lt.meshphysical_vert,fragmentShader:Lt.meshphysical_frag},toon:{uniforms:xe([rt.common,rt.aomap,rt.lightmap,rt.emissivemap,rt.bumpmap,rt.normalmap,rt.displacementmap,rt.gradientmap,rt.fog,rt.lights,{emissive:{value:new Ht(0)}}]),vertexShader:Lt.meshtoon_vert,fragmentShader:Lt.meshtoon_frag},matcap:{uniforms:xe([rt.common,rt.bumpmap,rt.normalmap,rt.displacementmap,rt.fog,{matcap:{value:null}}]),vertexShader:Lt.meshmatcap_vert,fragmentShader:Lt.meshmatcap_frag},points:{uniforms:xe([rt.points,rt.fog]),vertexShader:Lt.points_vert,fragmentShader:Lt.points_frag},dashed:{uniforms:xe([rt.common,rt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Lt.linedashed_vert,fragmentShader:Lt.linedashed_frag},depth:{uniforms:xe([rt.common,rt.displacementmap]),vertexShader:Lt.depth_vert,fragmentShader:Lt.depth_frag},normal:{uniforms:xe([rt.common,rt.bumpmap,rt.normalmap,rt.displacementmap,{opacity:{value:1}}]),vertexShader:Lt.meshnormal_vert,fragmentShader:Lt.meshnormal_frag},sprite:{uniforms:xe([rt.sprite,rt.fog]),vertexShader:Lt.sprite_vert,fragmentShader:Lt.sprite_frag},background:{uniforms:{uvTransform:{value:new Ft},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Lt.background_vert,fragmentShader:Lt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Lt.backgroundCube_vert,fragmentShader:Lt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Lt.cube_vert,fragmentShader:Lt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Lt.equirect_vert,fragmentShader:Lt.equirect_frag},distanceRGBA:{uniforms:xe([rt.common,rt.displacementmap,{referencePosition:{value:new L},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Lt.distanceRGBA_vert,fragmentShader:Lt.distanceRGBA_frag},shadow:{uniforms:xe([rt.lights,rt.fog,{color:{value:new Ht(0)},opacity:{value:1}}]),vertexShader:Lt.shadow_vert,fragmentShader:Lt.shadow_frag}};Je.physical={uniforms:xe([Je.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ft},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ft},clearcoatNormalScale:{value:new zt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ft},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ft},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ft},sheen:{value:0},sheenColor:{value:new Ht(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ft},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ft},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ft},transmissionSamplerSize:{value:new zt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ft},attenuationDistance:{value:0},attenuationColor:{value:new Ht(0)},specularColor:{value:new Ht(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ft},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ft},anisotropyVector:{value:new zt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ft}}]),vertexShader:Lt.meshphysical_vert,fragmentShader:Lt.meshphysical_frag};var Ms={r:0,b:0,g:0};function _d(i,t,e,n,s,r,a){let o=new Ht(0),c=r===!0?0:1,l,h,d=null,f=0,m=null;function g(p,u){let v=!1,_=u.isScene===!0?u.background:null;_&&_.isTexture&&(_=(u.backgroundBlurriness>0?e:t).get(_)),_===null?x(o,c):_&&_.isColor&&(x(_,1),v=!0);let b=i.xr.getEnvironmentBlendMode();b==="additive"?n.buffers.color.setClear(0,0,0,1,a):b==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,a),(i.autoClear||v)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),_&&(_.isCubeTexture||_.mapping===qs)?(h===void 0&&(h=new $e(new Xi(1,1,1),new fn({name:"BackgroundCubeMaterial",uniforms:yi(Je.backgroundCube.uniforms),vertexShader:Je.backgroundCube.vertexShader,fragmentShader:Je.backgroundCube.fragmentShader,side:pe,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(S,T,R){this.matrixWorld.copyPosition(R.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(h)),h.material.uniforms.envMap.value=_,h.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=u.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=u.backgroundIntensity,h.material.toneMapped=Xt.getTransfer(_.colorSpace)!==Yt,(d!==_||f!==_.version||m!==i.toneMapping)&&(h.material.needsUpdate=!0,d=_,f=_.version,m=i.toneMapping),h.layers.enableAll(),p.unshift(h,h.geometry,h.material,0,0,null)):_&&_.isTexture&&(l===void 0&&(l=new $e(new eo(2,2),new fn({name:"BackgroundMaterial",uniforms:yi(Je.background.uniforms),vertexShader:Je.background.vertexShader,fragmentShader:Je.background.fragmentShader,side:Xe,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(l)),l.material.uniforms.t2D.value=_,l.material.uniforms.backgroundIntensity.value=u.backgroundIntensity,l.material.toneMapped=Xt.getTransfer(_.colorSpace)!==Yt,_.matrixAutoUpdate===!0&&_.updateMatrix(),l.material.uniforms.uvTransform.value.copy(_.matrix),(d!==_||f!==_.version||m!==i.toneMapping)&&(l.material.needsUpdate=!0,d=_,f=_.version,m=i.toneMapping),l.layers.enableAll(),p.unshift(l,l.geometry,l.material,0,0,null))}function x(p,u){p.getRGB(Ms,Oc(i)),n.buffers.color.setClear(Ms.r,Ms.g,Ms.b,u,a)}return{getClearColor:function(){return o},setClearColor:function(p,u=1){o.set(p),c=u,x(o,c)},getClearAlpha:function(){return c},setClearAlpha:function(p){c=p,x(o,c)},render:g}}function xd(i,t,e,n){let s=i.getParameter(i.MAX_VERTEX_ATTRIBS),r=n.isWebGL2?null:t.get("OES_vertex_array_object"),a=n.isWebGL2||r!==null,o={},c=p(null),l=c,h=!1;function d(C,F,Y,H,J){let q=!1;if(a){let $=x(H,Y,F);l!==$&&(l=$,m(l.object)),q=u(C,H,Y,J),q&&v(C,H,Y,J)}else{let $=F.wireframe===!0;(l.geometry!==H.id||l.program!==Y.id||l.wireframe!==$)&&(l.geometry=H.id,l.program=Y.id,l.wireframe=$,q=!0)}J!==null&&e.update(J,i.ELEMENT_ARRAY_BUFFER),(q||h)&&(h=!1,I(C,F,Y,H),J!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.get(J).buffer))}function f(){return n.isWebGL2?i.createVertexArray():r.createVertexArrayOES()}function m(C){return n.isWebGL2?i.bindVertexArray(C):r.bindVertexArrayOES(C)}function g(C){return n.isWebGL2?i.deleteVertexArray(C):r.deleteVertexArrayOES(C)}function x(C,F,Y){let H=Y.wireframe===!0,J=o[C.id];J===void 0&&(J={},o[C.id]=J);let q=J[F.id];q===void 0&&(q={},J[F.id]=q);let $=q[H];return $===void 0&&($=p(f()),q[H]=$),$}function p(C){let F=[],Y=[],H=[];for(let J=0;J<s;J++)F[J]=0,Y[J]=0,H[J]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:F,enabledAttributes:Y,attributeDivisors:H,object:C,attributes:{},index:null}}function u(C,F,Y,H){let J=l.attributes,q=F.attributes,$=0,tt=Y.getAttributes();for(let ut in tt)if(tt[ut].location>=0){let Z=J[ut],ot=q[ut];if(ot===void 0&&(ut==="instanceMatrix"&&C.instanceMatrix&&(ot=C.instanceMatrix),ut==="instanceColor"&&C.instanceColor&&(ot=C.instanceColor)),Z===void 0||Z.attribute!==ot||ot&&Z.data!==ot.data)return!0;$++}return l.attributesNum!==$||l.index!==H}function v(C,F,Y,H){let J={},q=F.attributes,$=0,tt=Y.getAttributes();for(let ut in tt)if(tt[ut].location>=0){let Z=q[ut];Z===void 0&&(ut==="instanceMatrix"&&C.instanceMatrix&&(Z=C.instanceMatrix),ut==="instanceColor"&&C.instanceColor&&(Z=C.instanceColor));let ot={};ot.attribute=Z,Z&&Z.data&&(ot.data=Z.data),J[ut]=ot,$++}l.attributes=J,l.attributesNum=$,l.index=H}function _(){let C=l.newAttributes;for(let F=0,Y=C.length;F<Y;F++)C[F]=0}function b(C){S(C,0)}function S(C,F){let Y=l.newAttributes,H=l.enabledAttributes,J=l.attributeDivisors;Y[C]=1,H[C]===0&&(i.enableVertexAttribArray(C),H[C]=1),J[C]!==F&&((n.isWebGL2?i:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](C,F),J[C]=F)}function T(){let C=l.newAttributes,F=l.enabledAttributes;for(let Y=0,H=F.length;Y<H;Y++)F[Y]!==C[Y]&&(i.disableVertexAttribArray(Y),F[Y]=0)}function R(C,F,Y,H,J,q,$){$===!0?i.vertexAttribIPointer(C,F,Y,J,q):i.vertexAttribPointer(C,F,Y,H,J,q)}function I(C,F,Y,H){if(n.isWebGL2===!1&&(C.isInstancedMesh||H.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;_();let J=H.attributes,q=Y.getAttributes(),$=F.defaultAttributeValues;for(let tt in q){let ut=q[tt];if(ut.location>=0){let G=J[tt];if(G===void 0&&(tt==="instanceMatrix"&&C.instanceMatrix&&(G=C.instanceMatrix),tt==="instanceColor"&&C.instanceColor&&(G=C.instanceColor)),G!==void 0){let Z=G.normalized,ot=G.itemSize,pt=e.get(G);if(pt===void 0)continue;let mt=pt.buffer,Pt=pt.type,Tt=pt.bytesPerElement,Et=n.isWebGL2===!0&&(Pt===i.INT||Pt===i.UNSIGNED_INT||G.gpuType===Ac);if(G.isInterleavedBufferAttribute){let It=G.data,N=It.stride,me=G.offset;if(It.isInstancedInterleavedBuffer){for(let gt=0;gt<ut.locationSize;gt++)S(ut.location+gt,It.meshPerAttribute);C.isInstancedMesh!==!0&&H._maxInstanceCount===void 0&&(H._maxInstanceCount=It.meshPerAttribute*It.count)}else for(let gt=0;gt<ut.locationSize;gt++)b(ut.location+gt);i.bindBuffer(i.ARRAY_BUFFER,mt);for(let gt=0;gt<ut.locationSize;gt++)R(ut.location+gt,ot/ut.locationSize,Pt,Z,N*Tt,(me+ot/ut.locationSize*gt)*Tt,Et)}else{if(G.isInstancedBufferAttribute){for(let It=0;It<ut.locationSize;It++)S(ut.location+It,G.meshPerAttribute);C.isInstancedMesh!==!0&&H._maxInstanceCount===void 0&&(H._maxInstanceCount=G.meshPerAttribute*G.count)}else for(let It=0;It<ut.locationSize;It++)b(ut.location+It);i.bindBuffer(i.ARRAY_BUFFER,mt);for(let It=0;It<ut.locationSize;It++)R(ut.location+It,ot/ut.locationSize,Pt,Z,ot*Tt,ot/ut.locationSize*It*Tt,Et)}}else if($!==void 0){let Z=$[tt];if(Z!==void 0)switch(Z.length){case 2:i.vertexAttrib2fv(ut.location,Z);break;case 3:i.vertexAttrib3fv(ut.location,Z);break;case 4:i.vertexAttrib4fv(ut.location,Z);break;default:i.vertexAttrib1fv(ut.location,Z)}}}}T()}function y(){z();for(let C in o){let F=o[C];for(let Y in F){let H=F[Y];for(let J in H)g(H[J].object),delete H[J];delete F[Y]}delete o[C]}}function A(C){if(o[C.id]===void 0)return;let F=o[C.id];for(let Y in F){let H=F[Y];for(let J in H)g(H[J].object),delete H[J];delete F[Y]}delete o[C.id]}function D(C){for(let F in o){let Y=o[F];if(Y[C.id]===void 0)continue;let H=Y[C.id];for(let J in H)g(H[J].object),delete H[J];delete Y[C.id]}}function z(){X(),h=!0,l!==c&&(l=c,m(l.object))}function X(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:d,reset:z,resetDefaultState:X,dispose:y,releaseStatesOfGeometry:A,releaseStatesOfProgram:D,initAttributes:_,enableAttribute:b,disableUnusedAttributes:T}}function yd(i,t,e,n){let s=n.isWebGL2,r;function a(h){r=h}function o(h,d){i.drawArrays(r,h,d),e.update(d,r,1)}function c(h,d,f){if(f===0)return;let m,g;if(s)m=i,g="drawArraysInstanced";else if(m=t.get("ANGLE_instanced_arrays"),g="drawArraysInstancedANGLE",m===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[g](r,h,d,f),e.update(d,r,f)}function l(h,d,f){if(f===0)return;let m=t.get("WEBGL_multi_draw");if(m===null)for(let g=0;g<f;g++)this.render(h[g],d[g]);else{m.multiDrawArraysWEBGL(r,h,0,d,0,f);let g=0;for(let x=0;x<f;x++)g+=d[x];e.update(g,r,1)}}this.setMode=a,this.render=o,this.renderInstances=c,this.renderMultiDraw=l}function vd(i,t,e){let n;function s(){if(n!==void 0)return n;if(t.has("EXT_texture_filter_anisotropic")===!0){let R=t.get("EXT_texture_filter_anisotropic");n=i.getParameter(R.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function r(R){if(R==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";R="mediump"}return R==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let a=typeof WebGL2RenderingContext!="undefined"&&i.constructor.name==="WebGL2RenderingContext",o=e.precision!==void 0?e.precision:"highp",c=r(o);c!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",c,"instead."),o=c);let l=a||t.has("WEBGL_draw_buffers"),h=e.logarithmicDepthBuffer===!0,d=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),f=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=i.getParameter(i.MAX_TEXTURE_SIZE),g=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),x=i.getParameter(i.MAX_VERTEX_ATTRIBS),p=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),u=i.getParameter(i.MAX_VARYING_VECTORS),v=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),_=f>0,b=a||t.has("OES_texture_float"),S=_&&b,T=a?i.getParameter(i.MAX_SAMPLES):0;return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:s,getMaxPrecision:r,precision:o,logarithmicDepthBuffer:h,maxTextures:d,maxVertexTextures:f,maxTextureSize:m,maxCubemapSize:g,maxAttributes:x,maxVertexUniforms:p,maxVaryings:u,maxFragmentUniforms:v,vertexTextures:_,floatFragmentTextures:b,floatVertexTextures:S,maxSamples:T}}function Md(i){let t=this,e=null,n=0,s=!1,r=!1,a=new Le,o=new Ft,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(d,f){let m=d.length!==0||f||n!==0||s;return s=f,n=d.length,m},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(d,f){e=h(d,f,0)},this.setState=function(d,f,m){let g=d.clippingPlanes,x=d.clipIntersection,p=d.clipShadows,u=i.get(d);if(!s||g===null||g.length===0||r&&!p)r?h(null):l();else{let v=r?0:n,_=v*4,b=u.clippingState||null;c.value=b,b=h(g,f,_,m);for(let S=0;S!==_;++S)b[S]=e[S];u.clippingState=b,this.numIntersection=x?this.numPlanes:0,this.numPlanes+=v}};function l(){c.value!==e&&(c.value=e,c.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function h(d,f,m,g){let x=d!==null?d.length:0,p=null;if(x!==0){if(p=c.value,g!==!0||p===null){let u=m+x*4,v=f.matrixWorldInverse;o.getNormalMatrix(v),(p===null||p.length<u)&&(p=new Float32Array(u));for(let _=0,b=m;_!==x;++_,b+=4)a.copy(d[_]).applyMatrix4(v,o),a.normal.toArray(p,b),p[b+3]=a.constant}c.value=p,c.needsUpdate=!0}return t.numPlanes=x,t.numIntersection=0,p}}function Sd(i){let t=new WeakMap;function e(a,o){return o===Gr?a.mapping=mi:o===Wr&&(a.mapping=gi),a}function n(a){if(a&&a.isTexture){let o=a.mapping;if(o===Gr||o===Wr)if(t.has(a)){let c=t.get(a).texture;return e(c,a.mapping)}else{let c=a.image;if(c&&c.height>0){let l=new to(c.height/2);return l.fromEquirectangularTexture(i,a),t.set(a,l),a.addEventListener("dispose",s),e(l.texture,a.mapping)}else return null}}return a}function s(a){let o=a.target;o.removeEventListener("dispose",s);let c=t.get(o);c!==void 0&&(t.delete(o),c.dispose())}function r(){t=new WeakMap}return{get:n,dispose:r}}var no=class extends ks{constructor(t=-1,e=1,n=1,s=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=s,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,n,s,r,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2,r=n-t,a=n+t,o=s+e,c=s-e;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=l*this.view.offsetX,a=r+l*this.view.width,o-=h*this.view.offsetY,c=o-h*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}},hi=4,ec=[.125,.215,.35,.446,.526,.582],Bn=20,Fr=new no,nc=new Ht,Or=null,Br=0,zr=0,Fn=(1+Math.sqrt(5))/2,li=1/Fn,ic=[new L(1,1,1),new L(-1,1,1),new L(1,1,-1),new L(-1,1,-1),new L(0,Fn,li),new L(0,Fn,-li),new L(li,0,Fn),new L(-li,0,Fn),new L(Fn,li,0),new L(-Fn,li,0)],Ws=class{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,s=100){Or=this._renderer.getRenderTarget(),Br=this._renderer.getActiveCubeFace(),zr=this._renderer.getActiveMipmapLevel(),this._setSize(256);let r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,n,s,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=oc(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=rc(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Or,Br,zr),t.scissorTest=!1,Ss(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===mi||t.mapping===gi?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Or=this._renderer.getRenderTarget(),Br=this._renderer.getActiveCubeFace(),zr=this._renderer.getActiveMipmapLevel();let n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){let t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:De,minFilter:De,generateMipmaps:!1,type:Wi,format:Ge,colorSpace:ln,depthBuffer:!1},s=sc(t,e,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=sc(t,e,n);let{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=bd(r)),this._blurMaterial=Ed(r,t,e)}return s}_compileMaterial(t){let e=new $e(this._lodPlanes[0],t);this._renderer.compile(e,Fr)}_sceneToCubeUV(t,e,n,s){let o=new Pe(90,1,e,n),c=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,f=h.toneMapping;h.getClearColor(nc),h.toneMapping=bn,h.autoClear=!1;let m=new Bs({name:"PMREM.Background",side:pe,depthWrite:!1,depthTest:!1}),g=new $e(new Xi,m),x=!1,p=t.background;p?p.isColor&&(m.color.copy(p),t.background=null,x=!0):(m.color.copy(nc),x=!0);for(let u=0;u<6;u++){let v=u%3;v===0?(o.up.set(0,c[u],0),o.lookAt(l[u],0,0)):v===1?(o.up.set(0,0,c[u]),o.lookAt(0,l[u],0)):(o.up.set(0,c[u],0),o.lookAt(0,0,l[u]));let _=this._cubeSize;Ss(s,v*_,u>2?_:0,_,_),h.setRenderTarget(s),x&&h.render(g,o),h.render(t,o)}g.geometry.dispose(),g.material.dispose(),h.toneMapping=f,h.autoClear=d,t.background=p}_textureToCubeUV(t,e){let n=this._renderer,s=t.mapping===mi||t.mapping===gi;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=oc()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=rc());let r=s?this._cubemapMaterial:this._equirectMaterial,a=new $e(this._lodPlanes[0],r),o=r.uniforms;o.envMap.value=t;let c=this._cubeSize;Ss(e,0,0,3*c,2*c),n.setRenderTarget(e),n.render(a,Fr)}_applyPMREM(t){let e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let s=1;s<this._lodPlanes.length;s++){let r=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=ic[(s-1)%ic.length];this._blur(t,s-1,s,r,a)}e.autoClear=n}_blur(t,e,n,s,r){let a=this._pingPongRenderTarget;this._halfBlur(t,a,e,n,s,"latitudinal",r),this._halfBlur(a,t,n,n,s,"longitudinal",r)}_halfBlur(t,e,n,s,r,a,o){let c=this._renderer,l=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let h=3,d=new $e(this._lodPlanes[s],l),f=l.uniforms,m=this._sizeLods[n]-1,g=isFinite(r)?Math.PI/(2*m):2*Math.PI/(2*Bn-1),x=r/g,p=isFinite(r)?1+Math.floor(h*x):Bn;p>Bn&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${p} samples when the maximum is set to ${Bn}`);let u=[],v=0;for(let R=0;R<Bn;++R){let I=R/x,y=Math.exp(-I*I/2);u.push(y),R===0?v+=y:R<p&&(v+=2*y)}for(let R=0;R<u.length;R++)u[R]=u[R]/v;f.envMap.value=t.texture,f.samples.value=p,f.weights.value=u,f.latitudinal.value=a==="latitudinal",o&&(f.poleAxis.value=o);let{_lodMax:_}=this;f.dTheta.value=g,f.mipInt.value=_-n;let b=this._sizeLods[s],S=3*b*(s>_-hi?s-_+hi:0),T=4*(this._cubeSize-b);Ss(e,S,T,3*b,2*b),c.setRenderTarget(e),c.render(d,Fr)}};function bd(i){let t=[],e=[],n=[],s=i,r=i-hi+1+ec.length;for(let a=0;a<r;a++){let o=Math.pow(2,s);e.push(o);let c=1/o;a>i-hi?c=ec[a-i+hi-1]:a===0&&(c=0),n.push(c);let l=1/(o-2),h=-l,d=1+l,f=[h,h,d,h,d,d,h,h,d,d,h,d],m=6,g=6,x=3,p=2,u=1,v=new Float32Array(x*g*m),_=new Float32Array(p*g*m),b=new Float32Array(u*g*m);for(let T=0;T<m;T++){let R=T%3*2/3-1,I=T>2?0:-1,y=[R,I,0,R+2/3,I,0,R+2/3,I+1,0,R,I,0,R+2/3,I+1,0,R,I+1,0];v.set(y,x*g*T),_.set(f,p*g*T);let A=[T,T,T,T,T,T];b.set(A,u*g*T)}let S=new un;S.setAttribute("position",new ee(v,x)),S.setAttribute("uv",new ee(_,p)),S.setAttribute("faceIndex",new ee(b,u)),t.push(S),s>hi&&s--}return{lodPlanes:t,sizeLods:e,sigmas:n}}function sc(i,t,e){let n=new hn(i,t,e);return n.texture.mapping=qs,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Ss(i,t,e,n,s){i.viewport.set(t,e,n,s),i.scissor.set(t,e,n,s)}function Ed(i,t,e){let n=new Float32Array(Bn),s=new L(0,1,0);return new fn({name:"SphericalGaussianBlur",defines:{n:Bn,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/e,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:Co(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues\' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t`,blending:Sn,depthTest:!1,depthWrite:!1})}function rc(){return new fn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Co(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t`,blending:Sn,depthTest:!1,depthWrite:!1})}function oc(){return new fn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Co(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t`,blending:Sn,depthTest:!1,depthWrite:!1})}function Co(){return`\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t`}function Td(i){let t=new WeakMap,e=null;function n(o){if(o&&o.isTexture){let c=o.mapping,l=c===Gr||c===Wr,h=c===mi||c===gi;if(l||h)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let d=t.get(o);return e===null&&(e=new Ws(i)),d=l?e.fromEquirectangular(o,d):e.fromCubemap(o,d),t.set(o,d),d.texture}else{if(t.has(o))return t.get(o).texture;{let d=o.image;if(l&&d&&d.height>0||h&&d&&s(d)){e===null&&(e=new Ws(i));let f=l?e.fromEquirectangular(o):e.fromCubemap(o);return t.set(o,f),o.addEventListener("dispose",r),f.texture}else return null}}}return o}function s(o){let c=0,l=6;for(let h=0;h<l;h++)o[h]!==void 0&&c++;return c===l}function r(o){let c=o.target;c.removeEventListener("dispose",r);let l=t.get(c);l!==void 0&&(t.delete(c),l.dispose())}function a(){t=new WeakMap,e!==null&&(e.dispose(),e=null)}return{get:n,dispose:a}}function Ad(i){let t={};function e(n){if(t[n]!==void 0)return t[n];let s;switch(n){case"WEBGL_depth_texture":s=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=i.getExtension(n)}return t[n]=s,s}return{has:function(n){return e(n)!==null},init:function(n){n.isWebGL2?e("EXT_color_buffer_float"):(e("WEBGL_depth_texture"),e("OES_texture_float"),e("OES_texture_half_float"),e("OES_texture_half_float_linear"),e("OES_standard_derivatives"),e("OES_element_index_uint"),e("OES_vertex_array_object"),e("ANGLE_instanced_arrays")),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float"),e("WEBGL_multisampled_render_to_texture")},get:function(n){let s=e(n);return s===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),s}}}function wd(i,t,e,n){let s={},r=new WeakMap;function a(d){let f=d.target;f.index!==null&&t.remove(f.index);for(let g in f.attributes)t.remove(f.attributes[g]);for(let g in f.morphAttributes){let x=f.morphAttributes[g];for(let p=0,u=x.length;p<u;p++)t.remove(x[p])}f.removeEventListener("dispose",a),delete s[f.id];let m=r.get(f);m&&(t.remove(m),r.delete(f)),n.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,e.memory.geometries--}function o(d,f){return s[f.id]===!0||(f.addEventListener("dispose",a),s[f.id]=!0,e.memory.geometries++),f}function c(d){let f=d.attributes;for(let g in f)t.update(f[g],i.ARRAY_BUFFER);let m=d.morphAttributes;for(let g in m){let x=m[g];for(let p=0,u=x.length;p<u;p++)t.update(x[p],i.ARRAY_BUFFER)}}function l(d){let f=[],m=d.index,g=d.attributes.position,x=0;if(m!==null){let v=m.array;x=m.version;for(let _=0,b=v.length;_<b;_+=3){let S=v[_+0],T=v[_+1],R=v[_+2];f.push(S,T,T,R,R,S)}}else if(g!==void 0){let v=g.array;x=g.version;for(let _=0,b=v.length/3-1;_<b;_+=3){let S=_+0,T=_+1,R=_+2;f.push(S,T,T,R,R,S)}}else return;let p=new(Nc(f)?Vs:zs)(f,1);p.version=x;let u=r.get(d);u&&t.remove(u),r.set(d,p)}function h(d){let f=r.get(d);if(f){let m=d.index;m!==null&&f.version<m.version&&l(d)}else l(d);return r.get(d)}return{get:o,update:c,getWireframeAttribute:h}}function Rd(i,t,e,n){let s=n.isWebGL2,r;function a(m){r=m}let o,c;function l(m){o=m.type,c=m.bytesPerElement}function h(m,g){i.drawElements(r,g,o,m*c),e.update(g,r,1)}function d(m,g,x){if(x===0)return;let p,u;if(s)p=i,u="drawElementsInstanced";else if(p=t.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",p===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}p[u](r,g,o,m*c,x),e.update(g,r,x)}function f(m,g,x){if(x===0)return;let p=t.get("WEBGL_multi_draw");if(p===null)for(let u=0;u<x;u++)this.render(m[u]/c,g[u]);else{p.multiDrawElementsWEBGL(r,g,0,o,m,0,x);let u=0;for(let v=0;v<x;v++)u+=g[v];e.update(u,r,1)}}this.setMode=a,this.setIndex=l,this.render=h,this.renderInstances=d,this.renderMultiDraw=f}function Cd(i){let t={geometries:0,textures:0},e={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,a,o){switch(e.calls++,a){case i.TRIANGLES:e.triangles+=o*(r/3);break;case i.LINES:e.lines+=o*(r/2);break;case i.LINE_STRIP:e.lines+=o*(r-1);break;case i.LINE_LOOP:e.lines+=o*r;break;case i.POINTS:e.points+=o*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function s(){e.calls=0,e.triangles=0,e.points=0,e.lines=0}return{memory:t,render:e,programs:null,autoReset:!0,reset:s,update:n}}function Pd(i,t){return i[0]-t[0]}function Ld(i,t){return Math.abs(t[1])-Math.abs(i[1])}function Id(i,t,e){let n={},s=new Float32Array(8),r=new WeakMap,a=new he,o=[];for(let l=0;l<8;l++)o[l]=[l,0];function c(l,h,d){let f=l.morphTargetInfluences;if(t.isWebGL2===!0){let m=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,g=m!==void 0?m.length:0,x=r.get(h);if(x===void 0||x.count!==g){let C=function(){z.dispose(),r.delete(h),h.removeEventListener("dispose",C)};x!==void 0&&x.texture.dispose();let v=h.morphAttributes.position!==void 0,_=h.morphAttributes.normal!==void 0,b=h.morphAttributes.color!==void 0,S=h.morphAttributes.position||[],T=h.morphAttributes.normal||[],R=h.morphAttributes.color||[],I=0;v===!0&&(I=1),_===!0&&(I=2),b===!0&&(I=3);let y=h.attributes.position.count*I,A=1;y>t.maxTextureSize&&(A=Math.ceil(y/t.maxTextureSize),y=t.maxTextureSize);let D=new Float32Array(y*A*4*g),z=new Ns(D,y,A,g);z.type=Mn,z.needsUpdate=!0;let X=I*4;for(let F=0;F<g;F++){let Y=S[F],H=T[F],J=R[F],q=y*A*4*F;for(let $=0;$<Y.count;$++){let tt=$*X;v===!0&&(a.fromBufferAttribute(Y,$),D[q+tt+0]=a.x,D[q+tt+1]=a.y,D[q+tt+2]=a.z,D[q+tt+3]=0),_===!0&&(a.fromBufferAttribute(H,$),D[q+tt+4]=a.x,D[q+tt+5]=a.y,D[q+tt+6]=a.z,D[q+tt+7]=0),b===!0&&(a.fromBufferAttribute(J,$),D[q+tt+8]=a.x,D[q+tt+9]=a.y,D[q+tt+10]=a.z,D[q+tt+11]=J.itemSize===4?a.w:1)}}x={count:g,texture:z,size:new zt(y,A)},r.set(h,x),h.addEventListener("dispose",C)}let p=0;for(let v=0;v<f.length;v++)p+=f[v];let u=h.morphTargetsRelative?1:1-p;d.getUniforms().setValue(i,"morphTargetBaseInfluence",u),d.getUniforms().setValue(i,"morphTargetInfluences",f),d.getUniforms().setValue(i,"morphTargetsTexture",x.texture,e),d.getUniforms().setValue(i,"morphTargetsTextureSize",x.size)}else{let m=f===void 0?0:f.length,g=n[h.id];if(g===void 0||g.length!==m){g=[];for(let _=0;_<m;_++)g[_]=[_,0];n[h.id]=g}for(let _=0;_<m;_++){let b=g[_];b[0]=_,b[1]=f[_]}g.sort(Ld);for(let _=0;_<8;_++)_<m&&g[_][1]?(o[_][0]=g[_][0],o[_][1]=g[_][1]):(o[_][0]=Number.MAX_SAFE_INTEGER,o[_][1]=0);o.sort(Pd);let x=h.morphAttributes.position,p=h.morphAttributes.normal,u=0;for(let _=0;_<8;_++){let b=o[_],S=b[0],T=b[1];S!==Number.MAX_SAFE_INTEGER&&T?(x&&h.getAttribute("morphTarget"+_)!==x[S]&&h.setAttribute("morphTarget"+_,x[S]),p&&h.getAttribute("morphNormal"+_)!==p[S]&&h.setAttribute("morphNormal"+_,p[S]),s[_]=T,u+=T):(x&&h.hasAttribute("morphTarget"+_)===!0&&h.deleteAttribute("morphTarget"+_),p&&h.hasAttribute("morphNormal"+_)===!0&&h.deleteAttribute("morphNormal"+_),s[_]=0)}let v=h.morphTargetsRelative?1:1-u;d.getUniforms().setValue(i,"morphTargetBaseInfluence",v),d.getUniforms().setValue(i,"morphTargetInfluences",s)}}return{update:c}}function Ud(i,t,e,n){let s=new WeakMap;function r(c){let l=n.render.frame,h=c.geometry,d=t.get(c,h);if(s.get(d)!==l&&(t.update(d),s.set(d,l)),c.isInstancedMesh&&(c.hasEventListener("dispose",o)===!1&&c.addEventListener("dispose",o),s.get(c)!==l&&(e.update(c.instanceMatrix,i.ARRAY_BUFFER),c.instanceColor!==null&&e.update(c.instanceColor,i.ARRAY_BUFFER),s.set(c,l))),c.isSkinnedMesh){let f=c.skeleton;s.get(f)!==l&&(f.update(),s.set(f,l))}return d}function a(){s=new WeakMap}function o(c){let l=c.target;l.removeEventListener("dispose",o),e.remove(l.instanceMatrix),l.instanceColor!==null&&e.remove(l.instanceColor)}return{update:r,dispose:a}}var Xs=class extends qe{constructor(t,e,n,s,r,a,o,c,l,h){if(h=h!==void 0?h:Vn,h!==Vn&&h!==_i)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&h===Vn&&(n=vn),n===void 0&&h===_i&&(n=zn),super(null,s,r,a,o,c,h,n,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=o!==void 0?o:ye,this.minFilter=c!==void 0?c:ye,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){let e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}},zc=new qe,Vc=new Xs(1,1);Vc.compareFunction=Dc;var kc=new Ns,Hc=new Kr,Gc=new Hs,ac=[],cc=[],lc=new Float32Array(16),hc=new Float32Array(9),uc=new Float32Array(4);function Mi(i,t,e){let n=i[0];if(n<=0||n>0)return i;let s=t*e,r=ac[s];if(r===void 0&&(r=new Float32Array(s),ac[s]=r),t!==0){n.toArray(r,0);for(let a=1,o=0;a!==t;++a)o+=e,i[a].toArray(r,o)}return r}function ne(i,t){if(i.length!==t.length)return!1;for(let e=0,n=i.length;e<n;e++)if(i[e]!==t[e])return!1;return!0}function ie(i,t){for(let e=0,n=t.length;e<n;e++)i[e]=t[e]}function Zs(i,t){let e=cc[t];e===void 0&&(e=new Int32Array(t),cc[t]=e);for(let n=0;n!==t;++n)e[n]=i.allocateTextureUnit();return e}function Dd(i,t){let e=this.cache;e[0]!==t&&(i.uniform1f(this.addr,t),e[0]=t)}function Nd(i,t){let e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(i.uniform2f(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(ne(e,t))return;i.uniform2fv(this.addr,t),ie(e,t)}}function Fd(i,t){let e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(i.uniform3f(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else if(t.r!==void 0)(e[0]!==t.r||e[1]!==t.g||e[2]!==t.b)&&(i.uniform3f(this.addr,t.r,t.g,t.b),e[0]=t.r,e[1]=t.g,e[2]=t.b);else{if(ne(e,t))return;i.uniform3fv(this.addr,t),ie(e,t)}}function Od(i,t){let e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(i.uniform4f(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(ne(e,t))return;i.uniform4fv(this.addr,t),ie(e,t)}}function Bd(i,t){let e=this.cache,n=t.elements;if(n===void 0){if(ne(e,t))return;i.uniformMatrix2fv(this.addr,!1,t),ie(e,t)}else{if(ne(e,n))return;uc.set(n),i.uniformMatrix2fv(this.addr,!1,uc),ie(e,n)}}function zd(i,t){let e=this.cache,n=t.elements;if(n===void 0){if(ne(e,t))return;i.uniformMatrix3fv(this.addr,!1,t),ie(e,t)}else{if(ne(e,n))return;hc.set(n),i.uniformMatrix3fv(this.addr,!1,hc),ie(e,n)}}function Vd(i,t){let e=this.cache,n=t.elements;if(n===void 0){if(ne(e,t))return;i.uniformMatrix4fv(this.addr,!1,t),ie(e,t)}else{if(ne(e,n))return;lc.set(n),i.uniformMatrix4fv(this.addr,!1,lc),ie(e,n)}}function kd(i,t){let e=this.cache;e[0]!==t&&(i.uniform1i(this.addr,t),e[0]=t)}function Hd(i,t){let e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(i.uniform2i(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(ne(e,t))return;i.uniform2iv(this.addr,t),ie(e,t)}}function Gd(i,t){let e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(i.uniform3i(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(ne(e,t))return;i.uniform3iv(this.addr,t),ie(e,t)}}function Wd(i,t){let e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(i.uniform4i(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(ne(e,t))return;i.uniform4iv(this.addr,t),ie(e,t)}}function Xd(i,t){let e=this.cache;e[0]!==t&&(i.uniform1ui(this.addr,t),e[0]=t)}function qd(i,t){let e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(i.uniform2ui(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(ne(e,t))return;i.uniform2uiv(this.addr,t),ie(e,t)}}function Yd(i,t){let e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(i.uniform3ui(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(ne(e,t))return;i.uniform3uiv(this.addr,t),ie(e,t)}}function Zd(i,t){let e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(i.uniform4ui(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(ne(e,t))return;i.uniform4uiv(this.addr,t),ie(e,t)}}function Jd(i,t,e){let n=this.cache,s=e.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s);let r=this.type===i.SAMPLER_2D_SHADOW?Vc:zc;e.setTexture2D(t||r,s)}function $d(i,t,e){let n=this.cache,s=e.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),e.setTexture3D(t||Hc,s)}function Kd(i,t,e){let n=this.cache,s=e.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),e.setTextureCube(t||Gc,s)}function Qd(i,t,e){let n=this.cache,s=e.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),e.setTexture2DArray(t||kc,s)}function jd(i){switch(i){case 5126:return Dd;case 35664:return Nd;case 35665:return Fd;case 35666:return Od;case 35674:return Bd;case 35675:return zd;case 35676:return Vd;case 5124:case 35670:return kd;case 35667:case 35671:return Hd;case 35668:case 35672:return Gd;case 35669:case 35673:return Wd;case 5125:return Xd;case 36294:return qd;case 36295:return Yd;case 36296:return Zd;case 35678:case 36198:case 36298:case 36306:case 35682:return Jd;case 35679:case 36299:case 36307:return $d;case 35680:case 36300:case 36308:case 36293:return Kd;case 36289:case 36303:case 36311:case 36292:return Qd}}function tp(i,t){i.uniform1fv(this.addr,t)}function ep(i,t){let e=Mi(t,this.size,2);i.uniform2fv(this.addr,e)}function np(i,t){let e=Mi(t,this.size,3);i.uniform3fv(this.addr,e)}function ip(i,t){let e=Mi(t,this.size,4);i.uniform4fv(this.addr,e)}function sp(i,t){let e=Mi(t,this.size,4);i.uniformMatrix2fv(this.addr,!1,e)}function rp(i,t){let e=Mi(t,this.size,9);i.uniformMatrix3fv(this.addr,!1,e)}function op(i,t){let e=Mi(t,this.size,16);i.uniformMatrix4fv(this.addr,!1,e)}function ap(i,t){i.uniform1iv(this.addr,t)}function cp(i,t){i.uniform2iv(this.addr,t)}function lp(i,t){i.uniform3iv(this.addr,t)}function hp(i,t){i.uniform4iv(this.addr,t)}function up(i,t){i.uniform1uiv(this.addr,t)}function fp(i,t){i.uniform2uiv(this.addr,t)}function dp(i,t){i.uniform3uiv(this.addr,t)}function pp(i,t){i.uniform4uiv(this.addr,t)}function mp(i,t,e){let n=this.cache,s=t.length,r=Zs(e,s);ne(n,r)||(i.uniform1iv(this.addr,r),ie(n,r));for(let a=0;a!==s;++a)e.setTexture2D(t[a]||zc,r[a])}function gp(i,t,e){let n=this.cache,s=t.length,r=Zs(e,s);ne(n,r)||(i.uniform1iv(this.addr,r),ie(n,r));for(let a=0;a!==s;++a)e.setTexture3D(t[a]||Hc,r[a])}function _p(i,t,e){let n=this.cache,s=t.length,r=Zs(e,s);ne(n,r)||(i.uniform1iv(this.addr,r),ie(n,r));for(let a=0;a!==s;++a)e.setTextureCube(t[a]||Gc,r[a])}function xp(i,t,e){let n=this.cache,s=t.length,r=Zs(e,s);ne(n,r)||(i.uniform1iv(this.addr,r),ie(n,r));for(let a=0;a!==s;++a)e.setTexture2DArray(t[a]||kc,r[a])}function yp(i){switch(i){case 5126:return tp;case 35664:return ep;case 35665:return np;case 35666:return ip;case 35674:return sp;case 35675:return rp;case 35676:return op;case 5124:case 35670:return ap;case 35667:case 35671:return cp;case 35668:case 35672:return lp;case 35669:case 35673:return hp;case 5125:return up;case 36294:return fp;case 36295:return dp;case 36296:return pp;case 35678:case 36198:case 36298:case 36306:case 35682:return mp;case 35679:case 36299:case 36307:return gp;case 35680:case 36300:case 36308:case 36293:return _p;case 36289:case 36303:case 36311:case 36292:return xp}}var io=class{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.setValue=jd(e.type)}},so=class{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=yp(e.type)}},ro=class{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,n){let s=this.seq;for(let r=0,a=s.length;r!==a;++r){let o=s[r];o.setValue(t,e[o.id],n)}}},Vr=/(\\w+)(\\])?(\\[|\\.)?/g;function fc(i,t){i.seq.push(t),i.map[t.id]=t}function vp(i,t,e){let n=i.name,s=n.length;for(Vr.lastIndex=0;;){let r=Vr.exec(n),a=Vr.lastIndex,o=r[1],c=r[2]==="]",l=r[3];if(c&&(o=o|0),l===void 0||l==="["&&a+2===s){fc(e,l===void 0?new io(o,i,t):new so(o,i,t));break}else{let d=e.map[o];d===void 0&&(d=new ro(o),fc(e,d)),e=d}}}var pi=class{constructor(t,e){this.seq=[],this.map={};let n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let s=0;s<n;++s){let r=t.getActiveUniform(e,s),a=t.getUniformLocation(e,r.name);vp(r,a,this)}}setValue(t,e,n,s){let r=this.map[e];r!==void 0&&r.setValue(t,n,s)}setOptional(t,e,n){let s=e[n];s!==void 0&&this.setValue(t,n,s)}static upload(t,e,n,s){for(let r=0,a=e.length;r!==a;++r){let o=e[r],c=n[o.id];c.needsUpdate!==!1&&o.setValue(t,c.value,s)}}static seqWithValue(t,e){let n=[];for(let s=0,r=t.length;s!==r;++s){let a=t[s];a.id in e&&n.push(a)}return n}};function dc(i,t,e){let n=i.createShader(t);return i.shaderSource(n,e),i.compileShader(n),n}var Mp=37297,Sp=0;function bp(i,t){let e=i.split(`\n`),n=[],s=Math.max(t-6,0),r=Math.min(t+6,e.length);for(let a=s;a<r;a++){let o=a+1;n.push(`${o===t?">":" "} ${o}: ${e[a]}`)}return n.join(`\n`)}function Ep(i){let t=Xt.getPrimaries(Xt.workingColorSpace),e=Xt.getPrimaries(i),n;switch(t===e?n="":t===Ps&&e===Cs?n="LinearDisplayP3ToLinearSRGB":t===Cs&&e===Ps&&(n="LinearSRGBToLinearDisplayP3"),i){case ln:case Ys:return[n,"LinearTransferOETF"];case le:case Ro:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",i),[n,"LinearTransferOETF"]}}function pc(i,t,e){let n=i.getShaderParameter(t,i.COMPILE_STATUS),s=i.getShaderInfoLog(t).trim();if(n&&s==="")return"";let r=/ERROR: 0:(\\d+)/.exec(s);if(r){let a=parseInt(r[1]);return e.toUpperCase()+`\n\n`+s+`\n\n`+bp(i.getShaderSource(t),a)}else return s}function Tp(i,t){let e=Ep(t);return`vec4 ${i}( vec4 value ) { return ${e[0]}( ${e[1]}( value ) ); }`}function Ap(i,t){let e;switch(t){case Gl:e="Linear";break;case Wl:e="Reinhard";break;case Xl:e="OptimizedCineon";break;case ql:e="ACESFilmic";break;case Yl:e="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),e="Linear"}return"vec3 "+i+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}function wp(i){return[i.extensionDerivatives||i.envMapCubeUVHeight||i.bumpMap||i.normalMapTangentSpace||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Vi).join(`\n`)}function Rp(i){let t=[];for(let e in i){let n=i[e];n!==!1&&t.push("#define "+e+" "+n)}return t.join(`\n`)}function Cp(i,t){let e={},n=i.getProgramParameter(t,i.ACTIVE_ATTRIBUTES);for(let s=0;s<n;s++){let r=i.getActiveAttrib(t,s),a=r.name,o=1;r.type===i.FLOAT_MAT2&&(o=2),r.type===i.FLOAT_MAT3&&(o=3),r.type===i.FLOAT_MAT4&&(o=4),e[a]={type:r.type,location:i.getAttribLocation(t,a),locationSize:o}}return e}function Vi(i){return i!==""}function mc(i,t){let e=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,e).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function gc(i,t){return i.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Pp=/^[ \\t]*#include +<([\\w\\d./]+)>/gm;function oo(i){return i.replace(Pp,Ip)}var Lp=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function Ip(i,t){let e=Lt[t];if(e===void 0){let n=Lp.get(t);if(n!==void 0)e=Lt[n],console.warn(\'THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.\',t,n);else throw new Error("Can not resolve #include <"+t+">")}return oo(e)}var Up=/#pragma unroll_loop_start\\s+for\\s*\\(\\s*int\\s+i\\s*=\\s*(\\d+)\\s*;\\s*i\\s*<\\s*(\\d+)\\s*;\\s*i\\s*\\+\\+\\s*\\)\\s*{([\\s\\S]+?)}\\s+#pragma unroll_loop_end/g;function _c(i){return i.replace(Up,Dp)}function Dp(i,t,e,n){let s="";for(let r=parseInt(t);r<parseInt(e);r++)s+=n.replace(/\\[\\s*i\\s*\\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function xc(i){let t="precision "+i.precision+` float;\nprecision `+i.precision+" int;";return i.precision==="highp"?t+=`\n#define HIGH_PRECISION`:i.precision==="mediump"?t+=`\n#define MEDIUM_PRECISION`:i.precision==="lowp"&&(t+=`\n#define LOW_PRECISION`),t}function Np(i){let t="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===bc?t="SHADOWMAP_TYPE_PCF":i.shadowMapType===_l?t="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===on&&(t="SHADOWMAP_TYPE_VSM"),t}function Fp(i){let t="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case mi:case gi:t="ENVMAP_TYPE_CUBE";break;case qs:t="ENVMAP_TYPE_CUBE_UV";break}return t}function Op(i){let t="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case gi:t="ENVMAP_MODE_REFRACTION";break}return t}function Bp(i){let t="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case Ec:t="ENVMAP_BLENDING_MULTIPLY";break;case kl:t="ENVMAP_BLENDING_MIX";break;case Hl:t="ENVMAP_BLENDING_ADD";break}return t}function zp(i){let t=i.envMapCubeUVHeight;if(t===null)return null;let e=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:n,maxMip:e}}function Vp(i,t,e,n){let s=i.getContext(),r=e.defines,a=e.vertexShader,o=e.fragmentShader,c=Np(e),l=Fp(e),h=Op(e),d=Bp(e),f=zp(e),m=e.isWebGL2?"":wp(e),g=Rp(r),x=s.createProgram(),p,u,v=e.glslVersion?"#version "+e.glslVersion+`\n`:"";e.isRawShaderMaterial?(p=["#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,g].filter(Vi).join(`\n`),p.length>0&&(p+=`\n`),u=[m,"#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,g].filter(Vi).join(`\n`),u.length>0&&(u+=`\n`)):(p=[xc(e),"#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,g,e.batching?"#define USE_BATCHING":"",e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+h:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.displacementMap?"#define USE_DISPLACEMENTMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.anisotropy?"#define USE_ANISOTROPY":"",e.anisotropyMap?"#define USE_ANISOTROPYMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaHash?"#define USE_ALPHAHASH":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.mapUv?"#define MAP_UV "+e.mapUv:"",e.alphaMapUv?"#define ALPHAMAP_UV "+e.alphaMapUv:"",e.lightMapUv?"#define LIGHTMAP_UV "+e.lightMapUv:"",e.aoMapUv?"#define AOMAP_UV "+e.aoMapUv:"",e.emissiveMapUv?"#define EMISSIVEMAP_UV "+e.emissiveMapUv:"",e.bumpMapUv?"#define BUMPMAP_UV "+e.bumpMapUv:"",e.normalMapUv?"#define NORMALMAP_UV "+e.normalMapUv:"",e.displacementMapUv?"#define DISPLACEMENTMAP_UV "+e.displacementMapUv:"",e.metalnessMapUv?"#define METALNESSMAP_UV "+e.metalnessMapUv:"",e.roughnessMapUv?"#define ROUGHNESSMAP_UV "+e.roughnessMapUv:"",e.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+e.anisotropyMapUv:"",e.clearcoatMapUv?"#define CLEARCOATMAP_UV "+e.clearcoatMapUv:"",e.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+e.clearcoatNormalMapUv:"",e.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+e.clearcoatRoughnessMapUv:"",e.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+e.iridescenceMapUv:"",e.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+e.iridescenceThicknessMapUv:"",e.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+e.sheenColorMapUv:"",e.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+e.sheenRoughnessMapUv:"",e.specularMapUv?"#define SPECULARMAP_UV "+e.specularMapUv:"",e.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+e.specularColorMapUv:"",e.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+e.specularIntensityMapUv:"",e.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+e.transmissionMapUv:"",e.thicknessMapUv?"#define THICKNESSMAP_UV "+e.thicknessMapUv:"",e.vertexTangents&&e.flatShading===!1?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUv1s?"#define USE_UV1":"",e.vertexUv2s?"#define USE_UV2":"",e.vertexUv3s?"#define USE_UV3":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&e.flatShading===!1?"#define USE_MORPHNORMALS":"",e.morphColors&&e.isWebGL2?"#define USE_MORPHCOLORS":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+e.morphTextureStride:"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_COUNT "+e.morphTargetsCount:"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+c:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.numLightProbes>0?"#define USE_LIGHT_PROBES":"",e.useLegacyLights?"#define LEGACY_LIGHTS":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif",`\n`].filter(Vi).join(`\n`),u=[m,xc(e),"#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,g,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+l:"",e.envMap?"#define "+h:"",e.envMap?"#define "+d:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.anisotropy?"#define USE_ANISOTROPY":"",e.anisotropyMap?"#define USE_ANISOTROPYMAP":"",e.clearcoat?"#define USE_CLEARCOAT":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescence?"#define USE_IRIDESCENCE":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaTest?"#define USE_ALPHATEST":"",e.alphaHash?"#define USE_ALPHAHASH":"",e.sheen?"#define USE_SHEEN":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.vertexTangents&&e.flatShading===!1?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUv1s?"#define USE_UV1":"",e.vertexUv2s?"#define USE_UV2":"",e.vertexUv3s?"#define USE_UV3":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+c:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.numLightProbes>0?"#define USE_LIGHT_PROBES":"",e.useLegacyLights?"#define LEGACY_LIGHTS":"",e.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",e.toneMapping!==bn?"#define TONE_MAPPING":"",e.toneMapping!==bn?Lt.tonemapping_pars_fragment:"",e.toneMapping!==bn?Ap("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.opaque?"#define OPAQUE":"",Lt.colorspace_pars_fragment,Tp("linearToOutputTexel",e.outputColorSpace),e.useDepthPacking?"#define DEPTH_PACKING "+e.depthPacking:"",`\n`].filter(Vi).join(`\n`)),a=oo(a),a=mc(a,e),a=gc(a,e),o=oo(o),o=mc(o,e),o=gc(o,e),a=_c(a),o=_c(o),e.isWebGL2&&e.isRawShaderMaterial!==!0&&(v=`#version 300 es\n`,p=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`\n`)+`\n`+p,u=["precision mediump sampler2DArray;","#define varying in",e.glslVersion===Oa?"":"layout(location = 0) out highp vec4 pc_fragColor;",e.glslVersion===Oa?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`\n`)+`\n`+u);let _=v+p+a,b=v+u+o,S=dc(s,s.VERTEX_SHADER,_),T=dc(s,s.FRAGMENT_SHADER,b);s.attachShader(x,S),s.attachShader(x,T),e.index0AttributeName!==void 0?s.bindAttribLocation(x,0,e.index0AttributeName):e.morphTargets===!0&&s.bindAttribLocation(x,0,"position"),s.linkProgram(x);function R(D){if(i.debug.checkShaderErrors){let z=s.getProgramInfoLog(x).trim(),X=s.getShaderInfoLog(S).trim(),C=s.getShaderInfoLog(T).trim(),F=!0,Y=!0;if(s.getProgramParameter(x,s.LINK_STATUS)===!1)if(F=!1,typeof i.debug.onShaderError=="function")i.debug.onShaderError(s,x,S,T);else{let H=pc(s,S,"vertex"),J=pc(s,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(x,s.VALIDATE_STATUS)+`\n\nProgram Info Log: `+z+`\n`+H+`\n`+J)}else z!==""?console.warn("THREE.WebGLProgram: Program Info Log:",z):(X===""||C==="")&&(Y=!1);Y&&(D.diagnostics={runnable:F,programLog:z,vertexShader:{log:X,prefix:p},fragmentShader:{log:C,prefix:u}})}s.deleteShader(S),s.deleteShader(T),I=new pi(s,x),y=Cp(s,x)}let I;this.getUniforms=function(){return I===void 0&&R(this),I};let y;this.getAttributes=function(){return y===void 0&&R(this),y};let A=e.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return A===!1&&(A=s.getProgramParameter(x,Mp)),A},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(x),this.program=void 0},this.type=e.shaderType,this.name=e.shaderName,this.id=Sp++,this.cacheKey=t,this.usedTimes=1,this.program=x,this.vertexShader=S,this.fragmentShader=T,this}var kp=0,ao=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){let e=t.vertexShader,n=t.fragmentShader,s=this._getShaderStage(e),r=this._getShaderStage(n),a=this._getShaderCacheForMaterial(t);return a.has(s)===!1&&(a.add(s),s.usedTimes++),a.has(r)===!1&&(a.add(r),r.usedTimes++),this}remove(t){let e=this.materialCache.get(t);for(let n of e)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){let e=this.materialCache,n=e.get(t);return n===void 0&&(n=new Set,e.set(t,n)),n}_getShaderStage(t){let e=this.shaderCache,n=e.get(t);return n===void 0&&(n=new co(t),e.set(t,n)),n}},co=class{constructor(t){this.id=kp++,this.code=t,this.usedTimes=0}};function Hp(i,t,e,n,s,r,a){let o=new Os,c=new ao,l=[],h=s.isWebGL2,d=s.logarithmicDepthBuffer,f=s.vertexTextures,m=s.precision,g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function x(y){return y===0?"uv":`uv${y}`}function p(y,A,D,z,X){let C=z.fog,F=X.geometry,Y=y.isMeshStandardMaterial?z.environment:null,H=(y.isMeshStandardMaterial?e:t).get(y.envMap||Y),J=H&&H.mapping===qs?H.image.height:null,q=g[y.type];y.precision!==null&&(m=s.getMaxPrecision(y.precision),m!==y.precision&&console.warn("THREE.WebGLProgram.getParameters:",y.precision,"not supported, using",m,"instead."));let $=F.morphAttributes.position||F.morphAttributes.normal||F.morphAttributes.color,tt=$!==void 0?$.length:0,ut=0;F.morphAttributes.position!==void 0&&(ut=1),F.morphAttributes.normal!==void 0&&(ut=2),F.morphAttributes.color!==void 0&&(ut=3);let G,Z,ot,pt;if(q){let ge=Je[q];G=ge.vertexShader,Z=ge.fragmentShader}else G=y.vertexShader,Z=y.fragmentShader,c.update(y),ot=c.getVertexShaderID(y),pt=c.getFragmentShaderID(y);let mt=i.getRenderTarget(),Pt=X.isInstancedMesh===!0,Tt=X.isBatchedMesh===!0,Et=!!y.map,It=!!y.matcap,N=!!H,me=!!y.aoMap,gt=!!y.lightMap,Ot=!!y.bumpMap,vt=!!y.normalMap,Jt=!!y.displacementMap,Dt=!!y.emissiveMap,Rt=!!y.metalnessMap,Gt=!!y.roughnessMap,ae=y.anisotropy>0,ce=y.clearcoat>0,w=y.iridescence>0,M=y.sheen>0,O=y.transmission>0,et=ae&&!!y.anisotropyMap,K=ce&&!!y.clearcoatMap,nt=ce&&!!y.clearcoatNormalMap,ft=ce&&!!y.clearcoatRoughnessMap,st=w&&!!y.iridescenceMap,at=w&&!!y.iridescenceThicknessMap,Mt=M&&!!y.sheenColorMap,kt=M&&!!y.sheenRoughnessMap,j=!!y.specularMap,Wt=!!y.specularColorMap,At=!!y.specularIntensityMap,St=O&&!!y.transmissionMap,_t=O&&!!y.thicknessMap,ht=!!y.gradientMap,Bt=!!y.alphaMap,P=y.alphaTest>0,ct=!!y.alphaHash,Q=!!y.extensions,W=!!F.attributes.uv1,it=!!F.attributes.uv2,yt=!!F.attributes.uv3,Vt=bn;return y.toneMapped&&(mt===null||mt.isXRRenderTarget===!0)&&(Vt=i.toneMapping),{isWebGL2:h,shaderID:q,shaderType:y.type,shaderName:y.name,vertexShader:G,fragmentShader:Z,defines:y.defines,customVertexShaderID:ot,customFragmentShaderID:pt,isRawShaderMaterial:y.isRawShaderMaterial===!0,glslVersion:y.glslVersion,precision:m,batching:Tt,instancing:Pt,instancingColor:Pt&&X.instanceColor!==null,supportsVertexTextures:f,outputColorSpace:mt===null?i.outputColorSpace:mt.isXRRenderTarget===!0?mt.texture.colorSpace:ln,map:Et,matcap:It,envMap:N,envMapMode:N&&H.mapping,envMapCubeUVHeight:J,aoMap:me,lightMap:gt,bumpMap:Ot,normalMap:vt,displacementMap:f&&Jt,emissiveMap:Dt,normalMapObjectSpace:vt&&y.normalMapType===oh,normalMapTangentSpace:vt&&y.normalMapType===rh,metalnessMap:Rt,roughnessMap:Gt,anisotropy:ae,anisotropyMap:et,clearcoat:ce,clearcoatMap:K,clearcoatNormalMap:nt,clearcoatRoughnessMap:ft,iridescence:w,iridescenceMap:st,iridescenceThicknessMap:at,sheen:M,sheenColorMap:Mt,sheenRoughnessMap:kt,specularMap:j,specularColorMap:Wt,specularIntensityMap:At,transmission:O,transmissionMap:St,thicknessMap:_t,gradientMap:ht,opaque:y.transparent===!1&&y.blending===fi,alphaMap:Bt,alphaTest:P,alphaHash:ct,combine:y.combine,mapUv:Et&&x(y.map.channel),aoMapUv:me&&x(y.aoMap.channel),lightMapUv:gt&&x(y.lightMap.channel),bumpMapUv:Ot&&x(y.bumpMap.channel),normalMapUv:vt&&x(y.normalMap.channel),displacementMapUv:Jt&&x(y.displacementMap.channel),emissiveMapUv:Dt&&x(y.emissiveMap.channel),metalnessMapUv:Rt&&x(y.metalnessMap.channel),roughnessMapUv:Gt&&x(y.roughnessMap.channel),anisotropyMapUv:et&&x(y.anisotropyMap.channel),clearcoatMapUv:K&&x(y.clearcoatMap.channel),clearcoatNormalMapUv:nt&&x(y.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ft&&x(y.clearcoatRoughnessMap.channel),iridescenceMapUv:st&&x(y.iridescenceMap.channel),iridescenceThicknessMapUv:at&&x(y.iridescenceThicknessMap.channel),sheenColorMapUv:Mt&&x(y.sheenColorMap.channel),sheenRoughnessMapUv:kt&&x(y.sheenRoughnessMap.channel),specularMapUv:j&&x(y.specularMap.channel),specularColorMapUv:Wt&&x(y.specularColorMap.channel),specularIntensityMapUv:At&&x(y.specularIntensityMap.channel),transmissionMapUv:St&&x(y.transmissionMap.channel),thicknessMapUv:_t&&x(y.thicknessMap.channel),alphaMapUv:Bt&&x(y.alphaMap.channel),vertexTangents:!!F.attributes.tangent&&(vt||ae),vertexColors:y.vertexColors,vertexAlphas:y.vertexColors===!0&&!!F.attributes.color&&F.attributes.color.itemSize===4,vertexUv1s:W,vertexUv2s:it,vertexUv3s:yt,pointsUvs:X.isPoints===!0&&!!F.attributes.uv&&(Et||Bt),fog:!!C,useFog:y.fog===!0,fogExp2:C&&C.isFogExp2,flatShading:y.flatShading===!0,sizeAttenuation:y.sizeAttenuation===!0,logarithmicDepthBuffer:d,skinning:X.isSkinnedMesh===!0,morphTargets:F.morphAttributes.position!==void 0,morphNormals:F.morphAttributes.normal!==void 0,morphColors:F.morphAttributes.color!==void 0,morphTargetsCount:tt,morphTextureStride:ut,numDirLights:A.directional.length,numPointLights:A.point.length,numSpotLights:A.spot.length,numSpotLightMaps:A.spotLightMap.length,numRectAreaLights:A.rectArea.length,numHemiLights:A.hemi.length,numDirLightShadows:A.directionalShadowMap.length,numPointLightShadows:A.pointShadowMap.length,numSpotLightShadows:A.spotShadowMap.length,numSpotLightShadowsWithMaps:A.numSpotLightShadowsWithMaps,numLightProbes:A.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:y.dithering,shadowMapEnabled:i.shadowMap.enabled&&D.length>0,shadowMapType:i.shadowMap.type,toneMapping:Vt,useLegacyLights:i._useLegacyLights,decodeVideoTexture:Et&&y.map.isVideoTexture===!0&&Xt.getTransfer(y.map.colorSpace)===Yt,premultipliedAlpha:y.premultipliedAlpha,doubleSided:y.side===ke,flipSided:y.side===pe,useDepthPacking:y.depthPacking>=0,depthPacking:y.depthPacking||0,index0AttributeName:y.index0AttributeName,extensionDerivatives:Q&&y.extensions.derivatives===!0,extensionFragDepth:Q&&y.extensions.fragDepth===!0,extensionDrawBuffers:Q&&y.extensions.drawBuffers===!0,extensionShaderTextureLOD:Q&&y.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:h||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||n.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:y.customProgramCacheKey()}}function u(y){let A=[];if(y.shaderID?A.push(y.shaderID):(A.push(y.customVertexShaderID),A.push(y.customFragmentShaderID)),y.defines!==void 0)for(let D in y.defines)A.push(D),A.push(y.defines[D]);return y.isRawShaderMaterial===!1&&(v(A,y),_(A,y),A.push(i.outputColorSpace)),A.push(y.customProgramCacheKey),A.join()}function v(y,A){y.push(A.precision),y.push(A.outputColorSpace),y.push(A.envMapMode),y.push(A.envMapCubeUVHeight),y.push(A.mapUv),y.push(A.alphaMapUv),y.push(A.lightMapUv),y.push(A.aoMapUv),y.push(A.bumpMapUv),y.push(A.normalMapUv),y.push(A.displacementMapUv),y.push(A.emissiveMapUv),y.push(A.metalnessMapUv),y.push(A.roughnessMapUv),y.push(A.anisotropyMapUv),y.push(A.clearcoatMapUv),y.push(A.clearcoatNormalMapUv),y.push(A.clearcoatRoughnessMapUv),y.push(A.iridescenceMapUv),y.push(A.iridescenceThicknessMapUv),y.push(A.sheenColorMapUv),y.push(A.sheenRoughnessMapUv),y.push(A.specularMapUv),y.push(A.specularColorMapUv),y.push(A.specularIntensityMapUv),y.push(A.transmissionMapUv),y.push(A.thicknessMapUv),y.push(A.combine),y.push(A.fogExp2),y.push(A.sizeAttenuation),y.push(A.morphTargetsCount),y.push(A.morphAttributeCount),y.push(A.numDirLights),y.push(A.numPointLights),y.push(A.numSpotLights),y.push(A.numSpotLightMaps),y.push(A.numHemiLights),y.push(A.numRectAreaLights),y.push(A.numDirLightShadows),y.push(A.numPointLightShadows),y.push(A.numSpotLightShadows),y.push(A.numSpotLightShadowsWithMaps),y.push(A.numLightProbes),y.push(A.shadowMapType),y.push(A.toneMapping),y.push(A.numClippingPlanes),y.push(A.numClipIntersection),y.push(A.depthPacking)}function _(y,A){o.disableAll(),A.isWebGL2&&o.enable(0),A.supportsVertexTextures&&o.enable(1),A.instancing&&o.enable(2),A.instancingColor&&o.enable(3),A.matcap&&o.enable(4),A.envMap&&o.enable(5),A.normalMapObjectSpace&&o.enable(6),A.normalMapTangentSpace&&o.enable(7),A.clearcoat&&o.enable(8),A.iridescence&&o.enable(9),A.alphaTest&&o.enable(10),A.vertexColors&&o.enable(11),A.vertexAlphas&&o.enable(12),A.vertexUv1s&&o.enable(13),A.vertexUv2s&&o.enable(14),A.vertexUv3s&&o.enable(15),A.vertexTangents&&o.enable(16),A.anisotropy&&o.enable(17),A.alphaHash&&o.enable(18),A.batching&&o.enable(19),y.push(o.mask),o.disableAll(),A.fog&&o.enable(0),A.useFog&&o.enable(1),A.flatShading&&o.enable(2),A.logarithmicDepthBuffer&&o.enable(3),A.skinning&&o.enable(4),A.morphTargets&&o.enable(5),A.morphNormals&&o.enable(6),A.morphColors&&o.enable(7),A.premultipliedAlpha&&o.enable(8),A.shadowMapEnabled&&o.enable(9),A.useLegacyLights&&o.enable(10),A.doubleSided&&o.enable(11),A.flipSided&&o.enable(12),A.useDepthPacking&&o.enable(13),A.dithering&&o.enable(14),A.transmission&&o.enable(15),A.sheen&&o.enable(16),A.opaque&&o.enable(17),A.pointsUvs&&o.enable(18),A.decodeVideoTexture&&o.enable(19),y.push(o.mask)}function b(y){let A=g[y.type],D;if(A){let z=Je[A];D=Lh.clone(z.uniforms)}else D=y.uniforms;return D}function S(y,A){let D;for(let z=0,X=l.length;z<X;z++){let C=l[z];if(C.cacheKey===A){D=C,++D.usedTimes;break}}return D===void 0&&(D=new Vp(i,A,y,r),l.push(D)),D}function T(y){if(--y.usedTimes===0){let A=l.indexOf(y);l[A]=l[l.length-1],l.pop(),y.destroy()}}function R(y){c.remove(y)}function I(){c.dispose()}return{getParameters:p,getProgramCacheKey:u,getUniforms:b,acquireProgram:S,releaseProgram:T,releaseShaderCache:R,programs:l,dispose:I}}function Gp(){let i=new WeakMap;function t(r){let a=i.get(r);return a===void 0&&(a={},i.set(r,a)),a}function e(r){i.delete(r)}function n(r,a,o){i.get(r)[a]=o}function s(){i=new WeakMap}return{get:t,remove:e,update:n,dispose:s}}function Wp(i,t){return i.groupOrder!==t.groupOrder?i.groupOrder-t.groupOrder:i.renderOrder!==t.renderOrder?i.renderOrder-t.renderOrder:i.material.id!==t.material.id?i.material.id-t.material.id:i.z!==t.z?i.z-t.z:i.id-t.id}function yc(i,t){return i.groupOrder!==t.groupOrder?i.groupOrder-t.groupOrder:i.renderOrder!==t.renderOrder?i.renderOrder-t.renderOrder:i.z!==t.z?t.z-i.z:i.id-t.id}function vc(){let i=[],t=0,e=[],n=[],s=[];function r(){t=0,e.length=0,n.length=0,s.length=0}function a(d,f,m,g,x,p){let u=i[t];return u===void 0?(u={id:d.id,object:d,geometry:f,material:m,groupOrder:g,renderOrder:d.renderOrder,z:x,group:p},i[t]=u):(u.id=d.id,u.object=d,u.geometry=f,u.material=m,u.groupOrder=g,u.renderOrder=d.renderOrder,u.z=x,u.group=p),t++,u}function o(d,f,m,g,x,p){let u=a(d,f,m,g,x,p);m.transmission>0?n.push(u):m.transparent===!0?s.push(u):e.push(u)}function c(d,f,m,g,x,p){let u=a(d,f,m,g,x,p);m.transmission>0?n.unshift(u):m.transparent===!0?s.unshift(u):e.unshift(u)}function l(d,f){e.length>1&&e.sort(d||Wp),n.length>1&&n.sort(f||yc),s.length>1&&s.sort(f||yc)}function h(){for(let d=t,f=i.length;d<f;d++){let m=i[d];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:e,transmissive:n,transparent:s,init:r,push:o,unshift:c,finish:h,sort:l}}function Xp(){let i=new WeakMap;function t(n,s){let r=i.get(n),a;return r===void 0?(a=new vc,i.set(n,[a])):s>=r.length?(a=new vc,r.push(a)):a=r[s],a}function e(){i=new WeakMap}return{get:t,dispose:e}}function qp(){let i={};return{get:function(t){if(i[t.id]!==void 0)return i[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new L,color:new Ht};break;case"SpotLight":e={position:new L,direction:new L,color:new Ht,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new L,color:new Ht,distance:0,decay:0};break;case"HemisphereLight":e={direction:new L,skyColor:new Ht,groundColor:new Ht};break;case"RectAreaLight":e={color:new Ht,position:new L,halfWidth:new L,halfHeight:new L};break}return i[t.id]=e,e}}}function Yp(){let i={};return{get:function(t){if(i[t.id]!==void 0)return i[t.id];let e;switch(t.type){case"DirectionalLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new zt};break;case"SpotLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new zt};break;case"PointLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new zt,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[t.id]=e,e}}}var Zp=0;function Jp(i,t){return(t.castShadow?2:0)-(i.castShadow?2:0)+(t.map?1:0)-(i.map?1:0)}function $p(i,t){let e=new qp,n=Yp(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let h=0;h<9;h++)s.probe.push(new L);let r=new L,a=new Kt,o=new Kt;function c(h,d){let f=0,m=0,g=0;for(let z=0;z<9;z++)s.probe[z].set(0,0,0);let x=0,p=0,u=0,v=0,_=0,b=0,S=0,T=0,R=0,I=0,y=0;h.sort(Jp);let A=d===!0?Math.PI:1;for(let z=0,X=h.length;z<X;z++){let C=h[z],F=C.color,Y=C.intensity,H=C.distance,J=C.shadow&&C.shadow.map?C.shadow.map.texture:null;if(C.isAmbientLight)f+=F.r*Y*A,m+=F.g*Y*A,g+=F.b*Y*A;else if(C.isLightProbe){for(let q=0;q<9;q++)s.probe[q].addScaledVector(C.sh.coefficients[q],Y);y++}else if(C.isDirectionalLight){let q=e.get(C);if(q.color.copy(C.color).multiplyScalar(C.intensity*A),C.castShadow){let $=C.shadow,tt=n.get(C);tt.shadowBias=$.bias,tt.shadowNormalBias=$.normalBias,tt.shadowRadius=$.radius,tt.shadowMapSize=$.mapSize,s.directionalShadow[x]=tt,s.directionalShadowMap[x]=J,s.directionalShadowMatrix[x]=C.shadow.matrix,b++}s.directional[x]=q,x++}else if(C.isSpotLight){let q=e.get(C);q.position.setFromMatrixPosition(C.matrixWorld),q.color.copy(F).multiplyScalar(Y*A),q.distance=H,q.coneCos=Math.cos(C.angle),q.penumbraCos=Math.cos(C.angle*(1-C.penumbra)),q.decay=C.decay,s.spot[u]=q;let $=C.shadow;if(C.map&&(s.spotLightMap[R]=C.map,R++,$.updateMatrices(C),C.castShadow&&I++),s.spotLightMatrix[u]=$.matrix,C.castShadow){let tt=n.get(C);tt.shadowBias=$.bias,tt.shadowNormalBias=$.normalBias,tt.shadowRadius=$.radius,tt.shadowMapSize=$.mapSize,s.spotShadow[u]=tt,s.spotShadowMap[u]=J,T++}u++}else if(C.isRectAreaLight){let q=e.get(C);q.color.copy(F).multiplyScalar(Y),q.halfWidth.set(C.width*.5,0,0),q.halfHeight.set(0,C.height*.5,0),s.rectArea[v]=q,v++}else if(C.isPointLight){let q=e.get(C);if(q.color.copy(C.color).multiplyScalar(C.intensity*A),q.distance=C.distance,q.decay=C.decay,C.castShadow){let $=C.shadow,tt=n.get(C);tt.shadowBias=$.bias,tt.shadowNormalBias=$.normalBias,tt.shadowRadius=$.radius,tt.shadowMapSize=$.mapSize,tt.shadowCameraNear=$.camera.near,tt.shadowCameraFar=$.camera.far,s.pointShadow[p]=tt,s.pointShadowMap[p]=J,s.pointShadowMatrix[p]=C.shadow.matrix,S++}s.point[p]=q,p++}else if(C.isHemisphereLight){let q=e.get(C);q.skyColor.copy(C.color).multiplyScalar(Y*A),q.groundColor.copy(C.groundColor).multiplyScalar(Y*A),s.hemi[_]=q,_++}}v>0&&(t.isWebGL2||i.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=rt.LTC_FLOAT_1,s.rectAreaLTC2=rt.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=rt.LTC_HALF_1,s.rectAreaLTC2=rt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=f,s.ambient[1]=m,s.ambient[2]=g;let D=s.hash;(D.directionalLength!==x||D.pointLength!==p||D.spotLength!==u||D.rectAreaLength!==v||D.hemiLength!==_||D.numDirectionalShadows!==b||D.numPointShadows!==S||D.numSpotShadows!==T||D.numSpotMaps!==R||D.numLightProbes!==y)&&(s.directional.length=x,s.spot.length=u,s.rectArea.length=v,s.point.length=p,s.hemi.length=_,s.directionalShadow.length=b,s.directionalShadowMap.length=b,s.pointShadow.length=S,s.pointShadowMap.length=S,s.spotShadow.length=T,s.spotShadowMap.length=T,s.directionalShadowMatrix.length=b,s.pointShadowMatrix.length=S,s.spotLightMatrix.length=T+R-I,s.spotLightMap.length=R,s.numSpotLightShadowsWithMaps=I,s.numLightProbes=y,D.directionalLength=x,D.pointLength=p,D.spotLength=u,D.rectAreaLength=v,D.hemiLength=_,D.numDirectionalShadows=b,D.numPointShadows=S,D.numSpotShadows=T,D.numSpotMaps=R,D.numLightProbes=y,s.version=Zp++)}function l(h,d){let f=0,m=0,g=0,x=0,p=0,u=d.matrixWorldInverse;for(let v=0,_=h.length;v<_;v++){let b=h[v];if(b.isDirectionalLight){let S=s.directional[f];S.direction.setFromMatrixPosition(b.matrixWorld),r.setFromMatrixPosition(b.target.matrixWorld),S.direction.sub(r),S.direction.transformDirection(u),f++}else if(b.isSpotLight){let S=s.spot[g];S.position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(u),S.direction.setFromMatrixPosition(b.matrixWorld),r.setFromMatrixPosition(b.target.matrixWorld),S.direction.sub(r),S.direction.transformDirection(u),g++}else if(b.isRectAreaLight){let S=s.rectArea[x];S.position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(u),o.identity(),a.copy(b.matrixWorld),a.premultiply(u),o.extractRotation(a),S.halfWidth.set(b.width*.5,0,0),S.halfHeight.set(0,b.height*.5,0),S.halfWidth.applyMatrix4(o),S.halfHeight.applyMatrix4(o),x++}else if(b.isPointLight){let S=s.point[m];S.position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(u),m++}else if(b.isHemisphereLight){let S=s.hemi[p];S.direction.setFromMatrixPosition(b.matrixWorld),S.direction.transformDirection(u),p++}}}return{setup:c,setupView:l,state:s}}function Mc(i,t){let e=new $p(i,t),n=[],s=[];function r(){n.length=0,s.length=0}function a(d){n.push(d)}function o(d){s.push(d)}function c(d){e.setup(n,d)}function l(d){e.setupView(n,d)}return{init:r,state:{lightsArray:n,shadowsArray:s,lights:e},setupLights:c,setupLightsView:l,pushLight:a,pushShadow:o}}function Kp(i,t){let e=new WeakMap;function n(r,a=0){let o=e.get(r),c;return o===void 0?(c=new Mc(i,t),e.set(r,[c])):a>=o.length?(c=new Mc(i,t),o.push(c)):c=o[a],c}function s(){e=new WeakMap}return{get:n,dispose:s}}var lo=class extends xi{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=ih,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}},ho=class extends xi{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}},Qp=`void main() {\n\tgl_Position = vec4( position, 1.0 );\n}`,jp=`uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}`;function tm(i,t,e){let n=new Gs,s=new zt,r=new zt,a=new he,o=new lo({depthPacking:sh}),c=new ho,l={},h=e.maxTextureSize,d={[Xe]:pe,[pe]:Xe,[ke]:ke},f=new fn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new zt},radius:{value:4}},vertexShader:Qp,fragmentShader:jp}),m=f.clone();m.defines.HORIZONTAL_PASS=1;let g=new un;g.setAttribute("position",new ee(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let x=new $e(g,f),p=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=bc;let u=this.type;this.render=function(S,T,R){if(p.enabled===!1||p.autoUpdate===!1&&p.needsUpdate===!1||S.length===0)return;let I=i.getRenderTarget(),y=i.getActiveCubeFace(),A=i.getActiveMipmapLevel(),D=i.state;D.setBlending(Sn),D.buffers.color.setClear(1,1,1,1),D.buffers.depth.setTest(!0),D.setScissorTest(!1);let z=u!==on&&this.type===on,X=u===on&&this.type!==on;for(let C=0,F=S.length;C<F;C++){let Y=S[C],H=Y.shadow;if(H===void 0){console.warn("THREE.WebGLShadowMap:",Y,"has no shadow.");continue}if(H.autoUpdate===!1&&H.needsUpdate===!1)continue;s.copy(H.mapSize);let J=H.getFrameExtents();if(s.multiply(J),r.copy(H.mapSize),(s.x>h||s.y>h)&&(s.x>h&&(r.x=Math.floor(h/J.x),s.x=r.x*J.x,H.mapSize.x=r.x),s.y>h&&(r.y=Math.floor(h/J.y),s.y=r.y*J.y,H.mapSize.y=r.y)),H.map===null||z===!0||X===!0){let $=this.type!==on?{minFilter:ye,magFilter:ye}:{};H.map!==null&&H.map.dispose(),H.map=new hn(s.x,s.y,$),H.map.texture.name=Y.name+".shadowMap",H.camera.updateProjectionMatrix()}i.setRenderTarget(H.map),i.clear();let q=H.getViewportCount();for(let $=0;$<q;$++){let tt=H.getViewport($);a.set(r.x*tt.x,r.y*tt.y,r.x*tt.z,r.y*tt.w),D.viewport(a),H.updateMatrices(Y,$),n=H.getFrustum(),b(T,R,H.camera,Y,this.type)}H.isPointLightShadow!==!0&&this.type===on&&v(H,R),H.needsUpdate=!1}u=this.type,p.needsUpdate=!1,i.setRenderTarget(I,y,A)};function v(S,T){let R=t.update(x);f.defines.VSM_SAMPLES!==S.blurSamples&&(f.defines.VSM_SAMPLES=S.blurSamples,m.defines.VSM_SAMPLES=S.blurSamples,f.needsUpdate=!0,m.needsUpdate=!0),S.mapPass===null&&(S.mapPass=new hn(s.x,s.y)),f.uniforms.shadow_pass.value=S.map.texture,f.uniforms.resolution.value=S.mapSize,f.uniforms.radius.value=S.radius,i.setRenderTarget(S.mapPass),i.clear(),i.renderBufferDirect(T,null,R,f,x,null),m.uniforms.shadow_pass.value=S.mapPass.texture,m.uniforms.resolution.value=S.mapSize,m.uniforms.radius.value=S.radius,i.setRenderTarget(S.map),i.clear(),i.renderBufferDirect(T,null,R,m,x,null)}function _(S,T,R,I){let y=null,A=R.isPointLight===!0?S.customDistanceMaterial:S.customDepthMaterial;if(A!==void 0)y=A;else if(y=R.isPointLight===!0?c:o,i.localClippingEnabled&&T.clipShadows===!0&&Array.isArray(T.clippingPlanes)&&T.clippingPlanes.length!==0||T.displacementMap&&T.displacementScale!==0||T.alphaMap&&T.alphaTest>0||T.map&&T.alphaTest>0){let D=y.uuid,z=T.uuid,X=l[D];X===void 0&&(X={},l[D]=X);let C=X[z];C===void 0&&(C=y.clone(),X[z]=C),y=C}if(y.visible=T.visible,y.wireframe=T.wireframe,I===on?y.side=T.shadowSide!==null?T.shadowSide:T.side:y.side=T.shadowSide!==null?T.shadowSide:d[T.side],y.alphaMap=T.alphaMap,y.alphaTest=T.alphaTest,y.map=T.map,y.clipShadows=T.clipShadows,y.clippingPlanes=T.clippingPlanes,y.clipIntersection=T.clipIntersection,y.displacementMap=T.displacementMap,y.displacementScale=T.displacementScale,y.displacementBias=T.displacementBias,y.wireframeLinewidth=T.wireframeLinewidth,y.linewidth=T.linewidth,R.isPointLight===!0&&y.isMeshDistanceMaterial===!0){let D=i.properties.get(y);D.light=R}return y}function b(S,T,R,I,y){if(S.visible===!1)return;if(S.layers.test(T.layers)&&(S.isMesh||S.isLine||S.isPoints)&&(S.castShadow||S.receiveShadow&&y===on)&&(!S.frustumCulled||n.intersectsObject(S))){S.modelViewMatrix.multiplyMatrices(R.matrixWorldInverse,S.matrixWorld);let z=t.update(S),X=S.material;if(Array.isArray(X)){let C=z.groups;for(let F=0,Y=C.length;F<Y;F++){let H=C[F],J=X[H.materialIndex];if(J&&J.visible){let q=_(S,J,I,y);S.onBeforeShadow(i,S,T,R,z,q,H),i.renderBufferDirect(R,null,z,q,S,H),S.onAfterShadow(i,S,T,R,z,q,H)}}}else if(X.visible){let C=_(S,X,I,y);S.onBeforeShadow(i,S,T,R,z,C,null),i.renderBufferDirect(R,null,z,C,S,null),S.onAfterShadow(i,S,T,R,z,C,null)}}let D=S.children;for(let z=0,X=D.length;z<X;z++)b(D[z],T,R,I,y)}}function em(i,t,e){let n=e.isWebGL2;function s(){let P=!1,ct=new he,Q=null,W=new he(0,0,0,0);return{setMask:function(it){Q!==it&&!P&&(i.colorMask(it,it,it,it),Q=it)},setLocked:function(it){P=it},setClear:function(it,yt,Vt,se,ge){ge===!0&&(it*=se,yt*=se,Vt*=se),ct.set(it,yt,Vt,se),W.equals(ct)===!1&&(i.clearColor(it,yt,Vt,se),W.copy(ct))},reset:function(){P=!1,Q=null,W.set(-1,0,0,0)}}}function r(){let P=!1,ct=null,Q=null,W=null;return{setTest:function(it){it?Tt(i.DEPTH_TEST):Et(i.DEPTH_TEST)},setMask:function(it){ct!==it&&!P&&(i.depthMask(it),ct=it)},setFunc:function(it){if(Q!==it){switch(it){case Dl:i.depthFunc(i.NEVER);break;case Nl:i.depthFunc(i.ALWAYS);break;case Fl:i.depthFunc(i.LESS);break;case Ts:i.depthFunc(i.LEQUAL);break;case Ol:i.depthFunc(i.EQUAL);break;case Bl:i.depthFunc(i.GEQUAL);break;case zl:i.depthFunc(i.GREATER);break;case Vl:i.depthFunc(i.NOTEQUAL);break;default:i.depthFunc(i.LEQUAL)}Q=it}},setLocked:function(it){P=it},setClear:function(it){W!==it&&(i.clearDepth(it),W=it)},reset:function(){P=!1,ct=null,Q=null,W=null}}}function a(){let P=!1,ct=null,Q=null,W=null,it=null,yt=null,Vt=null,se=null,ge=null;return{setTest:function(qt){P||(qt?Tt(i.STENCIL_TEST):Et(i.STENCIL_TEST))},setMask:function(qt){ct!==qt&&!P&&(i.stencilMask(qt),ct=qt)},setFunc:function(qt,_e,Ze){(Q!==qt||W!==_e||it!==Ze)&&(i.stencilFunc(qt,_e,Ze),Q=qt,W=_e,it=Ze)},setOp:function(qt,_e,Ze){(yt!==qt||Vt!==_e||se!==Ze)&&(i.stencilOp(qt,_e,Ze),yt=qt,Vt=_e,se=Ze)},setLocked:function(qt){P=qt},setClear:function(qt){ge!==qt&&(i.clearStencil(qt),ge=qt)},reset:function(){P=!1,ct=null,Q=null,W=null,it=null,yt=null,Vt=null,se=null,ge=null}}}let o=new s,c=new r,l=new a,h=new WeakMap,d=new WeakMap,f={},m={},g=new WeakMap,x=[],p=null,u=!1,v=null,_=null,b=null,S=null,T=null,R=null,I=null,y=new Ht(0,0,0),A=0,D=!1,z=null,X=null,C=null,F=null,Y=null,H=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS),J=!1,q=0,$=i.getParameter(i.VERSION);$.indexOf("WebGL")!==-1?(q=parseFloat(/^WebGL (\\d)/.exec($)[1]),J=q>=1):$.indexOf("OpenGL ES")!==-1&&(q=parseFloat(/^OpenGL ES (\\d)/.exec($)[1]),J=q>=2);let tt=null,ut={},G=i.getParameter(i.SCISSOR_BOX),Z=i.getParameter(i.VIEWPORT),ot=new he().fromArray(G),pt=new he().fromArray(Z);function mt(P,ct,Q,W){let it=new Uint8Array(4),yt=i.createTexture();i.bindTexture(P,yt),i.texParameteri(P,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(P,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let Vt=0;Vt<Q;Vt++)n&&(P===i.TEXTURE_3D||P===i.TEXTURE_2D_ARRAY)?i.texImage3D(ct,0,i.RGBA,1,1,W,0,i.RGBA,i.UNSIGNED_BYTE,it):i.texImage2D(ct+Vt,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,it);return yt}let Pt={};Pt[i.TEXTURE_2D]=mt(i.TEXTURE_2D,i.TEXTURE_2D,1),Pt[i.TEXTURE_CUBE_MAP]=mt(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(Pt[i.TEXTURE_2D_ARRAY]=mt(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),Pt[i.TEXTURE_3D]=mt(i.TEXTURE_3D,i.TEXTURE_3D,1,1)),o.setClear(0,0,0,1),c.setClear(1),l.setClear(0),Tt(i.DEPTH_TEST),c.setFunc(Ts),Dt(!1),Rt(ta),Tt(i.CULL_FACE),vt(Sn);function Tt(P){f[P]!==!0&&(i.enable(P),f[P]=!0)}function Et(P){f[P]!==!1&&(i.disable(P),f[P]=!1)}function It(P,ct){return m[P]!==ct?(i.bindFramebuffer(P,ct),m[P]=ct,n&&(P===i.DRAW_FRAMEBUFFER&&(m[i.FRAMEBUFFER]=ct),P===i.FRAMEBUFFER&&(m[i.DRAW_FRAMEBUFFER]=ct)),!0):!1}function N(P,ct){let Q=x,W=!1;if(P)if(Q=g.get(ct),Q===void 0&&(Q=[],g.set(ct,Q)),P.isWebGLMultipleRenderTargets){let it=P.texture;if(Q.length!==it.length||Q[0]!==i.COLOR_ATTACHMENT0){for(let yt=0,Vt=it.length;yt<Vt;yt++)Q[yt]=i.COLOR_ATTACHMENT0+yt;Q.length=it.length,W=!0}}else Q[0]!==i.COLOR_ATTACHMENT0&&(Q[0]=i.COLOR_ATTACHMENT0,W=!0);else Q[0]!==i.BACK&&(Q[0]=i.BACK,W=!0);W&&(e.isWebGL2?i.drawBuffers(Q):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(Q))}function me(P){return p!==P?(i.useProgram(P),p=P,!0):!1}let gt={[On]:i.FUNC_ADD,[yl]:i.FUNC_SUBTRACT,[vl]:i.FUNC_REVERSE_SUBTRACT};if(n)gt[sa]=i.MIN,gt[ra]=i.MAX;else{let P=t.get("EXT_blend_minmax");P!==null&&(gt[sa]=P.MIN_EXT,gt[ra]=P.MAX_EXT)}let Ot={[Ml]:i.ZERO,[Sl]:i.ONE,[bl]:i.SRC_COLOR,[kr]:i.SRC_ALPHA,[Cl]:i.SRC_ALPHA_SATURATE,[wl]:i.DST_COLOR,[Tl]:i.DST_ALPHA,[El]:i.ONE_MINUS_SRC_COLOR,[Hr]:i.ONE_MINUS_SRC_ALPHA,[Rl]:i.ONE_MINUS_DST_COLOR,[Al]:i.ONE_MINUS_DST_ALPHA,[Pl]:i.CONSTANT_COLOR,[Ll]:i.ONE_MINUS_CONSTANT_COLOR,[Il]:i.CONSTANT_ALPHA,[Ul]:i.ONE_MINUS_CONSTANT_ALPHA};function vt(P,ct,Q,W,it,yt,Vt,se,ge,qt){if(P===Sn){u===!0&&(Et(i.BLEND),u=!1);return}if(u===!1&&(Tt(i.BLEND),u=!0),P!==xl){if(P!==v||qt!==D){if((_!==On||T!==On)&&(i.blendEquation(i.FUNC_ADD),_=On,T=On),qt)switch(P){case fi:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case ea:i.blendFunc(i.ONE,i.ONE);break;case na:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case ia:i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",P);break}else switch(P){case fi:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case ea:i.blendFunc(i.SRC_ALPHA,i.ONE);break;case na:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case ia:i.blendFunc(i.ZERO,i.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",P);break}b=null,S=null,R=null,I=null,y.set(0,0,0),A=0,v=P,D=qt}return}it=it||ct,yt=yt||Q,Vt=Vt||W,(ct!==_||it!==T)&&(i.blendEquationSeparate(gt[ct],gt[it]),_=ct,T=it),(Q!==b||W!==S||yt!==R||Vt!==I)&&(i.blendFuncSeparate(Ot[Q],Ot[W],Ot[yt],Ot[Vt]),b=Q,S=W,R=yt,I=Vt),(se.equals(y)===!1||ge!==A)&&(i.blendColor(se.r,se.g,se.b,ge),y.copy(se),A=ge),v=P,D=!1}function Jt(P,ct){P.side===ke?Et(i.CULL_FACE):Tt(i.CULL_FACE);let Q=P.side===pe;ct&&(Q=!Q),Dt(Q),P.blending===fi&&P.transparent===!1?vt(Sn):vt(P.blending,P.blendEquation,P.blendSrc,P.blendDst,P.blendEquationAlpha,P.blendSrcAlpha,P.blendDstAlpha,P.blendColor,P.blendAlpha,P.premultipliedAlpha),c.setFunc(P.depthFunc),c.setTest(P.depthTest),c.setMask(P.depthWrite),o.setMask(P.colorWrite);let W=P.stencilWrite;l.setTest(W),W&&(l.setMask(P.stencilWriteMask),l.setFunc(P.stencilFunc,P.stencilRef,P.stencilFuncMask),l.setOp(P.stencilFail,P.stencilZFail,P.stencilZPass)),ae(P.polygonOffset,P.polygonOffsetFactor,P.polygonOffsetUnits),P.alphaToCoverage===!0?Tt(i.SAMPLE_ALPHA_TO_COVERAGE):Et(i.SAMPLE_ALPHA_TO_COVERAGE)}function Dt(P){z!==P&&(P?i.frontFace(i.CW):i.frontFace(i.CCW),z=P)}function Rt(P){P!==ml?(Tt(i.CULL_FACE),P!==X&&(P===ta?i.cullFace(i.BACK):P===gl?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):Et(i.CULL_FACE),X=P}function Gt(P){P!==C&&(J&&i.lineWidth(P),C=P)}function ae(P,ct,Q){P?(Tt(i.POLYGON_OFFSET_FILL),(F!==ct||Y!==Q)&&(i.polygonOffset(ct,Q),F=ct,Y=Q)):Et(i.POLYGON_OFFSET_FILL)}function ce(P){P?Tt(i.SCISSOR_TEST):Et(i.SCISSOR_TEST)}function w(P){P===void 0&&(P=i.TEXTURE0+H-1),tt!==P&&(i.activeTexture(P),tt=P)}function M(P,ct,Q){Q===void 0&&(tt===null?Q=i.TEXTURE0+H-1:Q=tt);let W=ut[Q];W===void 0&&(W={type:void 0,texture:void 0},ut[Q]=W),(W.type!==P||W.texture!==ct)&&(tt!==Q&&(i.activeTexture(Q),tt=Q),i.bindTexture(P,ct||Pt[P]),W.type=P,W.texture=ct)}function O(){let P=ut[tt];P!==void 0&&P.type!==void 0&&(i.bindTexture(P.type,null),P.type=void 0,P.texture=void 0)}function et(){try{i.compressedTexImage2D.apply(i,arguments)}catch(P){console.error("THREE.WebGLState:",P)}}function K(){try{i.compressedTexImage3D.apply(i,arguments)}catch(P){console.error("THREE.WebGLState:",P)}}function nt(){try{i.texSubImage2D.apply(i,arguments)}catch(P){console.error("THREE.WebGLState:",P)}}function ft(){try{i.texSubImage3D.apply(i,arguments)}catch(P){console.error("THREE.WebGLState:",P)}}function st(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(P){console.error("THREE.WebGLState:",P)}}function at(){try{i.compressedTexSubImage3D.apply(i,arguments)}catch(P){console.error("THREE.WebGLState:",P)}}function Mt(){try{i.texStorage2D.apply(i,arguments)}catch(P){console.error("THREE.WebGLState:",P)}}function kt(){try{i.texStorage3D.apply(i,arguments)}catch(P){console.error("THREE.WebGLState:",P)}}function j(){try{i.texImage2D.apply(i,arguments)}catch(P){console.error("THREE.WebGLState:",P)}}function Wt(){try{i.texImage3D.apply(i,arguments)}catch(P){console.error("THREE.WebGLState:",P)}}function At(P){ot.equals(P)===!1&&(i.scissor(P.x,P.y,P.z,P.w),ot.copy(P))}function St(P){pt.equals(P)===!1&&(i.viewport(P.x,P.y,P.z,P.w),pt.copy(P))}function _t(P,ct){let Q=d.get(ct);Q===void 0&&(Q=new WeakMap,d.set(ct,Q));let W=Q.get(P);W===void 0&&(W=i.getUniformBlockIndex(ct,P.name),Q.set(P,W))}function ht(P,ct){let W=d.get(ct).get(P);h.get(ct)!==W&&(i.uniformBlockBinding(ct,W,P.__bindingPointIndex),h.set(ct,W))}function Bt(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),n===!0&&(i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),f={},tt=null,ut={},m={},g=new WeakMap,x=[],p=null,u=!1,v=null,_=null,b=null,S=null,T=null,R=null,I=null,y=new Ht(0,0,0),A=0,D=!1,z=null,X=null,C=null,F=null,Y=null,ot.set(0,0,i.canvas.width,i.canvas.height),pt.set(0,0,i.canvas.width,i.canvas.height),o.reset(),c.reset(),l.reset()}return{buffers:{color:o,depth:c,stencil:l},enable:Tt,disable:Et,bindFramebuffer:It,drawBuffers:N,useProgram:me,setBlending:vt,setMaterial:Jt,setFlipSided:Dt,setCullFace:Rt,setLineWidth:Gt,setPolygonOffset:ae,setScissorTest:ce,activeTexture:w,bindTexture:M,unbindTexture:O,compressedTexImage2D:et,compressedTexImage3D:K,texImage2D:j,texImage3D:Wt,updateUBOMapping:_t,uniformBlockBinding:ht,texStorage2D:Mt,texStorage3D:kt,texSubImage2D:nt,texSubImage3D:ft,compressedTexSubImage2D:st,compressedTexSubImage3D:at,scissor:At,viewport:St,reset:Bt}}function nm(i,t,e,n,s,r,a){let o=s.isWebGL2,c=s.maxTextures,l=s.maxCubemapSize,h=s.maxTextureSize,d=s.maxSamples,f=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,m=typeof navigator=="undefined"?!1:/OculusBrowser/g.test(navigator.userAgent),g=new WeakMap,x,p=new WeakMap,u=!1;try{u=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch(w){}function v(w,M){return u?new OffscreenCanvas(w,M):Is("canvas")}function _(w,M,O,et){let K=1;if((w.width>et||w.height>et)&&(K=et/Math.max(w.width,w.height)),K<1||M===!0)if(typeof HTMLImageElement!="undefined"&&w instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&w instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&w instanceof ImageBitmap){let nt=M?Jr:Math.floor,ft=nt(K*w.width),st=nt(K*w.height);x===void 0&&(x=v(ft,st));let at=O?v(ft,st):x;return at.width=ft,at.height=st,at.getContext("2d").drawImage(w,0,0,ft,st),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+w.width+"x"+w.height+") to ("+ft+"x"+st+")."),at}else return"data"in w&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+w.width+"x"+w.height+")."),w;return w}function b(w){return Ba(w.width)&&Ba(w.height)}function S(w){return o?!1:w.wrapS!==He||w.wrapT!==He||w.minFilter!==ye&&w.minFilter!==De}function T(w,M){return w.generateMipmaps&&M&&w.minFilter!==ye&&w.minFilter!==De}function R(w){i.generateMipmap(w)}function I(w,M,O,et,K=!1){if(o===!1)return M;if(w!==null){if(i[w]!==void 0)return i[w];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format \'"+w+"\'")}let nt=M;if(M===i.RED&&(O===i.FLOAT&&(nt=i.R32F),O===i.HALF_FLOAT&&(nt=i.R16F),O===i.UNSIGNED_BYTE&&(nt=i.R8)),M===i.RED_INTEGER&&(O===i.UNSIGNED_BYTE&&(nt=i.R8UI),O===i.UNSIGNED_SHORT&&(nt=i.R16UI),O===i.UNSIGNED_INT&&(nt=i.R32UI),O===i.BYTE&&(nt=i.R8I),O===i.SHORT&&(nt=i.R16I),O===i.INT&&(nt=i.R32I)),M===i.RG&&(O===i.FLOAT&&(nt=i.RG32F),O===i.HALF_FLOAT&&(nt=i.RG16F),O===i.UNSIGNED_BYTE&&(nt=i.RG8)),M===i.RGBA){let ft=K?Rs:Xt.getTransfer(et);O===i.FLOAT&&(nt=i.RGBA32F),O===i.HALF_FLOAT&&(nt=i.RGBA16F),O===i.UNSIGNED_BYTE&&(nt=ft===Yt?i.SRGB8_ALPHA8:i.RGBA8),O===i.UNSIGNED_SHORT_4_4_4_4&&(nt=i.RGBA4),O===i.UNSIGNED_SHORT_5_5_5_1&&(nt=i.RGB5_A1)}return(nt===i.R16F||nt===i.R32F||nt===i.RG16F||nt===i.RG32F||nt===i.RGBA16F||nt===i.RGBA32F)&&t.get("EXT_color_buffer_float"),nt}function y(w,M,O){return T(w,O)===!0||w.isFramebufferTexture&&w.minFilter!==ye&&w.minFilter!==De?Math.log2(Math.max(M.width,M.height))+1:w.mipmaps!==void 0&&w.mipmaps.length>0?w.mipmaps.length:w.isCompressedTexture&&Array.isArray(w.image)?M.mipmaps.length:1}function A(w){return w===ye||w===oa||w===hr?i.NEAREST:i.LINEAR}function D(w){let M=w.target;M.removeEventListener("dispose",D),X(M),M.isVideoTexture&&g.delete(M)}function z(w){let M=w.target;M.removeEventListener("dispose",z),F(M)}function X(w){let M=n.get(w);if(M.__webglInit===void 0)return;let O=w.source,et=p.get(O);if(et){let K=et[M.__cacheKey];K.usedTimes--,K.usedTimes===0&&C(w),Object.keys(et).length===0&&p.delete(O)}n.remove(w)}function C(w){let M=n.get(w);i.deleteTexture(M.__webglTexture);let O=w.source,et=p.get(O);delete et[M.__cacheKey],a.memory.textures--}function F(w){let M=w.texture,O=n.get(w),et=n.get(M);if(et.__webglTexture!==void 0&&(i.deleteTexture(et.__webglTexture),a.memory.textures--),w.depthTexture&&w.depthTexture.dispose(),w.isWebGLCubeRenderTarget)for(let K=0;K<6;K++){if(Array.isArray(O.__webglFramebuffer[K]))for(let nt=0;nt<O.__webglFramebuffer[K].length;nt++)i.deleteFramebuffer(O.__webglFramebuffer[K][nt]);else i.deleteFramebuffer(O.__webglFramebuffer[K]);O.__webglDepthbuffer&&i.deleteRenderbuffer(O.__webglDepthbuffer[K])}else{if(Array.isArray(O.__webglFramebuffer))for(let K=0;K<O.__webglFramebuffer.length;K++)i.deleteFramebuffer(O.__webglFramebuffer[K]);else i.deleteFramebuffer(O.__webglFramebuffer);if(O.__webglDepthbuffer&&i.deleteRenderbuffer(O.__webglDepthbuffer),O.__webglMultisampledFramebuffer&&i.deleteFramebuffer(O.__webglMultisampledFramebuffer),O.__webglColorRenderbuffer)for(let K=0;K<O.__webglColorRenderbuffer.length;K++)O.__webglColorRenderbuffer[K]&&i.deleteRenderbuffer(O.__webglColorRenderbuffer[K]);O.__webglDepthRenderbuffer&&i.deleteRenderbuffer(O.__webglDepthRenderbuffer)}if(w.isWebGLMultipleRenderTargets)for(let K=0,nt=M.length;K<nt;K++){let ft=n.get(M[K]);ft.__webglTexture&&(i.deleteTexture(ft.__webglTexture),a.memory.textures--),n.remove(M[K])}n.remove(M),n.remove(w)}let Y=0;function H(){Y=0}function J(){let w=Y;return w>=c&&console.warn("THREE.WebGLTextures: Trying to use "+w+" texture units while this GPU supports only "+c),Y+=1,w}function q(w){let M=[];return M.push(w.wrapS),M.push(w.wrapT),M.push(w.wrapR||0),M.push(w.magFilter),M.push(w.minFilter),M.push(w.anisotropy),M.push(w.internalFormat),M.push(w.format),M.push(w.type),M.push(w.generateMipmaps),M.push(w.premultiplyAlpha),M.push(w.flipY),M.push(w.unpackAlignment),M.push(w.colorSpace),M.join()}function $(w,M){let O=n.get(w);if(w.isVideoTexture&&ae(w),w.isRenderTargetTexture===!1&&w.version>0&&O.__version!==w.version){let et=w.image;if(et===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(et.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Tt(O,w,M);return}}e.bindTexture(i.TEXTURE_2D,O.__webglTexture,i.TEXTURE0+M)}function tt(w,M){let O=n.get(w);if(w.version>0&&O.__version!==w.version){Tt(O,w,M);return}e.bindTexture(i.TEXTURE_2D_ARRAY,O.__webglTexture,i.TEXTURE0+M)}function ut(w,M){let O=n.get(w);if(w.version>0&&O.__version!==w.version){Tt(O,w,M);return}e.bindTexture(i.TEXTURE_3D,O.__webglTexture,i.TEXTURE0+M)}function G(w,M){let O=n.get(w);if(w.version>0&&O.__version!==w.version){Et(O,w,M);return}e.bindTexture(i.TEXTURE_CUBE_MAP,O.__webglTexture,i.TEXTURE0+M)}let Z={[Xr]:i.REPEAT,[He]:i.CLAMP_TO_EDGE,[qr]:i.MIRRORED_REPEAT},ot={[ye]:i.NEAREST,[oa]:i.NEAREST_MIPMAP_NEAREST,[hr]:i.NEAREST_MIPMAP_LINEAR,[De]:i.LINEAR,[Zl]:i.LINEAR_MIPMAP_NEAREST,[Gi]:i.LINEAR_MIPMAP_LINEAR},pt={[ah]:i.NEVER,[dh]:i.ALWAYS,[ch]:i.LESS,[Dc]:i.LEQUAL,[lh]:i.EQUAL,[fh]:i.GEQUAL,[hh]:i.GREATER,[uh]:i.NOTEQUAL};function mt(w,M,O){if(O?(i.texParameteri(w,i.TEXTURE_WRAP_S,Z[M.wrapS]),i.texParameteri(w,i.TEXTURE_WRAP_T,Z[M.wrapT]),(w===i.TEXTURE_3D||w===i.TEXTURE_2D_ARRAY)&&i.texParameteri(w,i.TEXTURE_WRAP_R,Z[M.wrapR]),i.texParameteri(w,i.TEXTURE_MAG_FILTER,ot[M.magFilter]),i.texParameteri(w,i.TEXTURE_MIN_FILTER,ot[M.minFilter])):(i.texParameteri(w,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(w,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),(w===i.TEXTURE_3D||w===i.TEXTURE_2D_ARRAY)&&i.texParameteri(w,i.TEXTURE_WRAP_R,i.CLAMP_TO_EDGE),(M.wrapS!==He||M.wrapT!==He)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(w,i.TEXTURE_MAG_FILTER,A(M.magFilter)),i.texParameteri(w,i.TEXTURE_MIN_FILTER,A(M.minFilter)),M.minFilter!==ye&&M.minFilter!==De&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),M.compareFunction&&(i.texParameteri(w,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(w,i.TEXTURE_COMPARE_FUNC,pt[M.compareFunction])),t.has("EXT_texture_filter_anisotropic")===!0){let et=t.get("EXT_texture_filter_anisotropic");if(M.magFilter===ye||M.minFilter!==hr&&M.minFilter!==Gi||M.type===Mn&&t.has("OES_texture_float_linear")===!1||o===!1&&M.type===Wi&&t.has("OES_texture_half_float_linear")===!1)return;(M.anisotropy>1||n.get(M).__currentAnisotropy)&&(i.texParameterf(w,et.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(M.anisotropy,s.getMaxAnisotropy())),n.get(M).__currentAnisotropy=M.anisotropy)}}function Pt(w,M){let O=!1;w.__webglInit===void 0&&(w.__webglInit=!0,M.addEventListener("dispose",D));let et=M.source,K=p.get(et);K===void 0&&(K={},p.set(et,K));let nt=q(M);if(nt!==w.__cacheKey){K[nt]===void 0&&(K[nt]={texture:i.createTexture(),usedTimes:0},a.memory.textures++,O=!0),K[nt].usedTimes++;let ft=K[w.__cacheKey];ft!==void 0&&(K[w.__cacheKey].usedTimes--,ft.usedTimes===0&&C(M)),w.__cacheKey=nt,w.__webglTexture=K[nt].texture}return O}function Tt(w,M,O){let et=i.TEXTURE_2D;(M.isDataArrayTexture||M.isCompressedArrayTexture)&&(et=i.TEXTURE_2D_ARRAY),M.isData3DTexture&&(et=i.TEXTURE_3D);let K=Pt(w,M),nt=M.source;e.bindTexture(et,w.__webglTexture,i.TEXTURE0+O);let ft=n.get(nt);if(nt.version!==ft.__version||K===!0){e.activeTexture(i.TEXTURE0+O);let st=Xt.getPrimaries(Xt.workingColorSpace),at=M.colorSpace===Ne?null:Xt.getPrimaries(M.colorSpace),Mt=M.colorSpace===Ne||st===at?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,M.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,M.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,M.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,Mt);let kt=S(M)&&b(M.image)===!1,j=_(M.image,kt,!1,h);j=ce(M,j);let Wt=b(j)||o,At=r.convert(M.format,M.colorSpace),St=r.convert(M.type),_t=I(M.internalFormat,At,St,M.colorSpace,M.isVideoTexture);mt(et,M,Wt);let ht,Bt=M.mipmaps,P=o&&M.isVideoTexture!==!0&&_t!==Ic,ct=ft.__version===void 0||K===!0,Q=y(M,j,Wt);if(M.isDepthTexture)_t=i.DEPTH_COMPONENT,o?M.type===Mn?_t=i.DEPTH_COMPONENT32F:M.type===vn?_t=i.DEPTH_COMPONENT24:M.type===zn?_t=i.DEPTH24_STENCIL8:_t=i.DEPTH_COMPONENT16:M.type===Mn&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),M.format===Vn&&_t===i.DEPTH_COMPONENT&&M.type!==wo&&M.type!==vn&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),M.type=vn,St=r.convert(M.type)),M.format===_i&&_t===i.DEPTH_COMPONENT&&(_t=i.DEPTH_STENCIL,M.type!==zn&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),M.type=zn,St=r.convert(M.type))),ct&&(P?e.texStorage2D(i.TEXTURE_2D,1,_t,j.width,j.height):e.texImage2D(i.TEXTURE_2D,0,_t,j.width,j.height,0,At,St,null));else if(M.isDataTexture)if(Bt.length>0&&Wt){P&&ct&&e.texStorage2D(i.TEXTURE_2D,Q,_t,Bt[0].width,Bt[0].height);for(let W=0,it=Bt.length;W<it;W++)ht=Bt[W],P?e.texSubImage2D(i.TEXTURE_2D,W,0,0,ht.width,ht.height,At,St,ht.data):e.texImage2D(i.TEXTURE_2D,W,_t,ht.width,ht.height,0,At,St,ht.data);M.generateMipmaps=!1}else P?(ct&&e.texStorage2D(i.TEXTURE_2D,Q,_t,j.width,j.height),e.texSubImage2D(i.TEXTURE_2D,0,0,0,j.width,j.height,At,St,j.data)):e.texImage2D(i.TEXTURE_2D,0,_t,j.width,j.height,0,At,St,j.data);else if(M.isCompressedTexture)if(M.isCompressedArrayTexture){P&&ct&&e.texStorage3D(i.TEXTURE_2D_ARRAY,Q,_t,Bt[0].width,Bt[0].height,j.depth);for(let W=0,it=Bt.length;W<it;W++)ht=Bt[W],M.format!==Ge?At!==null?P?e.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,W,0,0,0,ht.width,ht.height,j.depth,At,ht.data,0,0):e.compressedTexImage3D(i.TEXTURE_2D_ARRAY,W,_t,ht.width,ht.height,j.depth,0,ht.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):P?e.texSubImage3D(i.TEXTURE_2D_ARRAY,W,0,0,0,ht.width,ht.height,j.depth,At,St,ht.data):e.texImage3D(i.TEXTURE_2D_ARRAY,W,_t,ht.width,ht.height,j.depth,0,At,St,ht.data)}else{P&&ct&&e.texStorage2D(i.TEXTURE_2D,Q,_t,Bt[0].width,Bt[0].height);for(let W=0,it=Bt.length;W<it;W++)ht=Bt[W],M.format!==Ge?At!==null?P?e.compressedTexSubImage2D(i.TEXTURE_2D,W,0,0,ht.width,ht.height,At,ht.data):e.compressedTexImage2D(i.TEXTURE_2D,W,_t,ht.width,ht.height,0,ht.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):P?e.texSubImage2D(i.TEXTURE_2D,W,0,0,ht.width,ht.height,At,St,ht.data):e.texImage2D(i.TEXTURE_2D,W,_t,ht.width,ht.height,0,At,St,ht.data)}else if(M.isDataArrayTexture)P?(ct&&e.texStorage3D(i.TEXTURE_2D_ARRAY,Q,_t,j.width,j.height,j.depth),e.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,j.width,j.height,j.depth,At,St,j.data)):e.texImage3D(i.TEXTURE_2D_ARRAY,0,_t,j.width,j.height,j.depth,0,At,St,j.data);else if(M.isData3DTexture)P?(ct&&e.texStorage3D(i.TEXTURE_3D,Q,_t,j.width,j.height,j.depth),e.texSubImage3D(i.TEXTURE_3D,0,0,0,0,j.width,j.height,j.depth,At,St,j.data)):e.texImage3D(i.TEXTURE_3D,0,_t,j.width,j.height,j.depth,0,At,St,j.data);else if(M.isFramebufferTexture){if(ct)if(P)e.texStorage2D(i.TEXTURE_2D,Q,_t,j.width,j.height);else{let W=j.width,it=j.height;for(let yt=0;yt<Q;yt++)e.texImage2D(i.TEXTURE_2D,yt,_t,W,it,0,At,St,null),W>>=1,it>>=1}}else if(Bt.length>0&&Wt){P&&ct&&e.texStorage2D(i.TEXTURE_2D,Q,_t,Bt[0].width,Bt[0].height);for(let W=0,it=Bt.length;W<it;W++)ht=Bt[W],P?e.texSubImage2D(i.TEXTURE_2D,W,0,0,At,St,ht):e.texImage2D(i.TEXTURE_2D,W,_t,At,St,ht);M.generateMipmaps=!1}else P?(ct&&e.texStorage2D(i.TEXTURE_2D,Q,_t,j.width,j.height),e.texSubImage2D(i.TEXTURE_2D,0,0,0,At,St,j)):e.texImage2D(i.TEXTURE_2D,0,_t,At,St,j);T(M,Wt)&&R(et),ft.__version=nt.version,M.onUpdate&&M.onUpdate(M)}w.__version=M.version}function Et(w,M,O){if(M.image.length!==6)return;let et=Pt(w,M),K=M.source;e.bindTexture(i.TEXTURE_CUBE_MAP,w.__webglTexture,i.TEXTURE0+O);let nt=n.get(K);if(K.version!==nt.__version||et===!0){e.activeTexture(i.TEXTURE0+O);let ft=Xt.getPrimaries(Xt.workingColorSpace),st=M.colorSpace===Ne?null:Xt.getPrimaries(M.colorSpace),at=M.colorSpace===Ne||ft===st?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,M.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,M.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,M.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,at);let Mt=M.isCompressedTexture||M.image[0].isCompressedTexture,kt=M.image[0]&&M.image[0].isDataTexture,j=[];for(let W=0;W<6;W++)!Mt&&!kt?j[W]=_(M.image[W],!1,!0,l):j[W]=kt?M.image[W].image:M.image[W],j[W]=ce(M,j[W]);let Wt=j[0],At=b(Wt)||o,St=r.convert(M.format,M.colorSpace),_t=r.convert(M.type),ht=I(M.internalFormat,St,_t,M.colorSpace),Bt=o&&M.isVideoTexture!==!0,P=nt.__version===void 0||et===!0,ct=y(M,Wt,At);mt(i.TEXTURE_CUBE_MAP,M,At);let Q;if(Mt){Bt&&P&&e.texStorage2D(i.TEXTURE_CUBE_MAP,ct,ht,Wt.width,Wt.height);for(let W=0;W<6;W++){Q=j[W].mipmaps;for(let it=0;it<Q.length;it++){let yt=Q[it];M.format!==Ge?St!==null?Bt?e.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+W,it,0,0,yt.width,yt.height,St,yt.data):e.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+W,it,ht,yt.width,yt.height,0,yt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Bt?e.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+W,it,0,0,yt.width,yt.height,St,_t,yt.data):e.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+W,it,ht,yt.width,yt.height,0,St,_t,yt.data)}}}else{Q=M.mipmaps,Bt&&P&&(Q.length>0&&ct++,e.texStorage2D(i.TEXTURE_CUBE_MAP,ct,ht,j[0].width,j[0].height));for(let W=0;W<6;W++)if(kt){Bt?e.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,0,0,j[W].width,j[W].height,St,_t,j[W].data):e.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,ht,j[W].width,j[W].height,0,St,_t,j[W].data);for(let it=0;it<Q.length;it++){let Vt=Q[it].image[W].image;Bt?e.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+W,it+1,0,0,Vt.width,Vt.height,St,_t,Vt.data):e.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+W,it+1,ht,Vt.width,Vt.height,0,St,_t,Vt.data)}}else{Bt?e.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,0,0,St,_t,j[W]):e.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,ht,St,_t,j[W]);for(let it=0;it<Q.length;it++){let yt=Q[it];Bt?e.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+W,it+1,0,0,St,_t,yt.image[W]):e.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+W,it+1,ht,St,_t,yt.image[W])}}}T(M,At)&&R(i.TEXTURE_CUBE_MAP),nt.__version=K.version,M.onUpdate&&M.onUpdate(M)}w.__version=M.version}function It(w,M,O,et,K,nt){let ft=r.convert(O.format,O.colorSpace),st=r.convert(O.type),at=I(O.internalFormat,ft,st,O.colorSpace);if(!n.get(M).__hasExternalTextures){let kt=Math.max(1,M.width>>nt),j=Math.max(1,M.height>>nt);K===i.TEXTURE_3D||K===i.TEXTURE_2D_ARRAY?e.texImage3D(K,nt,at,kt,j,M.depth,0,ft,st,null):e.texImage2D(K,nt,at,kt,j,0,ft,st,null)}e.bindFramebuffer(i.FRAMEBUFFER,w),Gt(M)?f.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,et,K,n.get(O).__webglTexture,0,Rt(M)):(K===i.TEXTURE_2D||K>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&K<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,et,K,n.get(O).__webglTexture,nt),e.bindFramebuffer(i.FRAMEBUFFER,null)}function N(w,M,O){if(i.bindRenderbuffer(i.RENDERBUFFER,w),M.depthBuffer&&!M.stencilBuffer){let et=o===!0?i.DEPTH_COMPONENT24:i.DEPTH_COMPONENT16;if(O||Gt(M)){let K=M.depthTexture;K&&K.isDepthTexture&&(K.type===Mn?et=i.DEPTH_COMPONENT32F:K.type===vn&&(et=i.DEPTH_COMPONENT24));let nt=Rt(M);Gt(M)?f.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,nt,et,M.width,M.height):i.renderbufferStorageMultisample(i.RENDERBUFFER,nt,et,M.width,M.height)}else i.renderbufferStorage(i.RENDERBUFFER,et,M.width,M.height);i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,w)}else if(M.depthBuffer&&M.stencilBuffer){let et=Rt(M);O&&Gt(M)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,et,i.DEPTH24_STENCIL8,M.width,M.height):Gt(M)?f.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,et,i.DEPTH24_STENCIL8,M.width,M.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,M.width,M.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,w)}else{let et=M.isWebGLMultipleRenderTargets===!0?M.texture:[M.texture];for(let K=0;K<et.length;K++){let nt=et[K],ft=r.convert(nt.format,nt.colorSpace),st=r.convert(nt.type),at=I(nt.internalFormat,ft,st,nt.colorSpace),Mt=Rt(M);O&&Gt(M)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,Mt,at,M.width,M.height):Gt(M)?f.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,Mt,at,M.width,M.height):i.renderbufferStorage(i.RENDERBUFFER,at,M.width,M.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function me(w,M){if(M&&M.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(i.FRAMEBUFFER,w),!(M.depthTexture&&M.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(M.depthTexture).__webglTexture||M.depthTexture.image.width!==M.width||M.depthTexture.image.height!==M.height)&&(M.depthTexture.image.width=M.width,M.depthTexture.image.height=M.height,M.depthTexture.needsUpdate=!0),$(M.depthTexture,0);let et=n.get(M.depthTexture).__webglTexture,K=Rt(M);if(M.depthTexture.format===Vn)Gt(M)?f.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,et,0,K):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,et,0);else if(M.depthTexture.format===_i)Gt(M)?f.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,et,0,K):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,et,0);else throw new Error("Unknown depthTexture format")}function gt(w){let M=n.get(w),O=w.isWebGLCubeRenderTarget===!0;if(w.depthTexture&&!M.__autoAllocateDepthBuffer){if(O)throw new Error("target.depthTexture not supported in Cube render targets");me(M.__webglFramebuffer,w)}else if(O){M.__webglDepthbuffer=[];for(let et=0;et<6;et++)e.bindFramebuffer(i.FRAMEBUFFER,M.__webglFramebuffer[et]),M.__webglDepthbuffer[et]=i.createRenderbuffer(),N(M.__webglDepthbuffer[et],w,!1)}else e.bindFramebuffer(i.FRAMEBUFFER,M.__webglFramebuffer),M.__webglDepthbuffer=i.createRenderbuffer(),N(M.__webglDepthbuffer,w,!1);e.bindFramebuffer(i.FRAMEBUFFER,null)}function Ot(w,M,O){let et=n.get(w);M!==void 0&&It(et.__webglFramebuffer,w,w.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),O!==void 0&&gt(w)}function vt(w){let M=w.texture,O=n.get(w),et=n.get(M);w.addEventListener("dispose",z),w.isWebGLMultipleRenderTargets!==!0&&(et.__webglTexture===void 0&&(et.__webglTexture=i.createTexture()),et.__version=M.version,a.memory.textures++);let K=w.isWebGLCubeRenderTarget===!0,nt=w.isWebGLMultipleRenderTargets===!0,ft=b(w)||o;if(K){O.__webglFramebuffer=[];for(let st=0;st<6;st++)if(o&&M.mipmaps&&M.mipmaps.length>0){O.__webglFramebuffer[st]=[];for(let at=0;at<M.mipmaps.length;at++)O.__webglFramebuffer[st][at]=i.createFramebuffer()}else O.__webglFramebuffer[st]=i.createFramebuffer()}else{if(o&&M.mipmaps&&M.mipmaps.length>0){O.__webglFramebuffer=[];for(let st=0;st<M.mipmaps.length;st++)O.__webglFramebuffer[st]=i.createFramebuffer()}else O.__webglFramebuffer=i.createFramebuffer();if(nt)if(s.drawBuffers){let st=w.texture;for(let at=0,Mt=st.length;at<Mt;at++){let kt=n.get(st[at]);kt.__webglTexture===void 0&&(kt.__webglTexture=i.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&w.samples>0&&Gt(w)===!1){let st=nt?M:[M];O.__webglMultisampledFramebuffer=i.createFramebuffer(),O.__webglColorRenderbuffer=[],e.bindFramebuffer(i.FRAMEBUFFER,O.__webglMultisampledFramebuffer);for(let at=0;at<st.length;at++){let Mt=st[at];O.__webglColorRenderbuffer[at]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,O.__webglColorRenderbuffer[at]);let kt=r.convert(Mt.format,Mt.colorSpace),j=r.convert(Mt.type),Wt=I(Mt.internalFormat,kt,j,Mt.colorSpace,w.isXRRenderTarget===!0),At=Rt(w);i.renderbufferStorageMultisample(i.RENDERBUFFER,At,Wt,w.width,w.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+at,i.RENDERBUFFER,O.__webglColorRenderbuffer[at])}i.bindRenderbuffer(i.RENDERBUFFER,null),w.depthBuffer&&(O.__webglDepthRenderbuffer=i.createRenderbuffer(),N(O.__webglDepthRenderbuffer,w,!0)),e.bindFramebuffer(i.FRAMEBUFFER,null)}}if(K){e.bindTexture(i.TEXTURE_CUBE_MAP,et.__webglTexture),mt(i.TEXTURE_CUBE_MAP,M,ft);for(let st=0;st<6;st++)if(o&&M.mipmaps&&M.mipmaps.length>0)for(let at=0;at<M.mipmaps.length;at++)It(O.__webglFramebuffer[st][at],w,M,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+st,at);else It(O.__webglFramebuffer[st],w,M,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+st,0);T(M,ft)&&R(i.TEXTURE_CUBE_MAP),e.unbindTexture()}else if(nt){let st=w.texture;for(let at=0,Mt=st.length;at<Mt;at++){let kt=st[at],j=n.get(kt);e.bindTexture(i.TEXTURE_2D,j.__webglTexture),mt(i.TEXTURE_2D,kt,ft),It(O.__webglFramebuffer,w,kt,i.COLOR_ATTACHMENT0+at,i.TEXTURE_2D,0),T(kt,ft)&&R(i.TEXTURE_2D)}e.unbindTexture()}else{let st=i.TEXTURE_2D;if((w.isWebGL3DRenderTarget||w.isWebGLArrayRenderTarget)&&(o?st=w.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),e.bindTexture(st,et.__webglTexture),mt(st,M,ft),o&&M.mipmaps&&M.mipmaps.length>0)for(let at=0;at<M.mipmaps.length;at++)It(O.__webglFramebuffer[at],w,M,i.COLOR_ATTACHMENT0,st,at);else It(O.__webglFramebuffer,w,M,i.COLOR_ATTACHMENT0,st,0);T(M,ft)&&R(st),e.unbindTexture()}w.depthBuffer&&gt(w)}function Jt(w){let M=b(w)||o,O=w.isWebGLMultipleRenderTargets===!0?w.texture:[w.texture];for(let et=0,K=O.length;et<K;et++){let nt=O[et];if(T(nt,M)){let ft=w.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D,st=n.get(nt).__webglTexture;e.bindTexture(ft,st),R(ft),e.unbindTexture()}}}function Dt(w){if(o&&w.samples>0&&Gt(w)===!1){let M=w.isWebGLMultipleRenderTargets?w.texture:[w.texture],O=w.width,et=w.height,K=i.COLOR_BUFFER_BIT,nt=[],ft=w.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,st=n.get(w),at=w.isWebGLMultipleRenderTargets===!0;if(at)for(let Mt=0;Mt<M.length;Mt++)e.bindFramebuffer(i.FRAMEBUFFER,st.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Mt,i.RENDERBUFFER,null),e.bindFramebuffer(i.FRAMEBUFFER,st.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Mt,i.TEXTURE_2D,null,0);e.bindFramebuffer(i.READ_FRAMEBUFFER,st.__webglMultisampledFramebuffer),e.bindFramebuffer(i.DRAW_FRAMEBUFFER,st.__webglFramebuffer);for(let Mt=0;Mt<M.length;Mt++){nt.push(i.COLOR_ATTACHMENT0+Mt),w.depthBuffer&&nt.push(ft);let kt=st.__ignoreDepthValues!==void 0?st.__ignoreDepthValues:!1;if(kt===!1&&(w.depthBuffer&&(K|=i.DEPTH_BUFFER_BIT),w.stencilBuffer&&(K|=i.STENCIL_BUFFER_BIT)),at&&i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,st.__webglColorRenderbuffer[Mt]),kt===!0&&(i.invalidateFramebuffer(i.READ_FRAMEBUFFER,[ft]),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[ft])),at){let j=n.get(M[Mt]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,j,0)}i.blitFramebuffer(0,0,O,et,0,0,O,et,K,i.NEAREST),m&&i.invalidateFramebuffer(i.READ_FRAMEBUFFER,nt)}if(e.bindFramebuffer(i.READ_FRAMEBUFFER,null),e.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),at)for(let Mt=0;Mt<M.length;Mt++){e.bindFramebuffer(i.FRAMEBUFFER,st.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Mt,i.RENDERBUFFER,st.__webglColorRenderbuffer[Mt]);let kt=n.get(M[Mt]).__webglTexture;e.bindFramebuffer(i.FRAMEBUFFER,st.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Mt,i.TEXTURE_2D,kt,0)}e.bindFramebuffer(i.DRAW_FRAMEBUFFER,st.__webglMultisampledFramebuffer)}}function Rt(w){return Math.min(d,w.samples)}function Gt(w){let M=n.get(w);return o&&w.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&M.__useRenderToTexture!==!1}function ae(w){let M=a.render.frame;g.get(w)!==M&&(g.set(w,M),w.update())}function ce(w,M){let O=w.colorSpace,et=w.format,K=w.type;return w.isCompressedTexture===!0||w.isVideoTexture===!0||w.format===Yr||O!==ln&&O!==Ne&&(Xt.getTransfer(O)===Yt?o===!1?t.has("EXT_sRGB")===!0&&et===Ge?(w.format=Yr,w.minFilter=De,w.generateMipmaps=!1):M=Us.sRGBToLinear(M):(et!==Ge||K!==En)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",O)),M}this.allocateTextureUnit=J,this.resetTextureUnits=H,this.setTexture2D=$,this.setTexture2DArray=tt,this.setTexture3D=ut,this.setTextureCube=G,this.rebindTextures=Ot,this.setupRenderTarget=vt,this.updateRenderTargetMipmap=Jt,this.updateMultisampleRenderTarget=Dt,this.setupDepthRenderbuffer=gt,this.setupFrameBufferTexture=It,this.useMultisampledRTT=Gt}function im(i,t,e){let n=e.isWebGL2;function s(r,a=Ne){let o,c=Xt.getTransfer(a);if(r===En)return i.UNSIGNED_BYTE;if(r===wc)return i.UNSIGNED_SHORT_4_4_4_4;if(r===Rc)return i.UNSIGNED_SHORT_5_5_5_1;if(r===Jl)return i.BYTE;if(r===$l)return i.SHORT;if(r===wo)return i.UNSIGNED_SHORT;if(r===Ac)return i.INT;if(r===vn)return i.UNSIGNED_INT;if(r===Mn)return i.FLOAT;if(r===Wi)return n?i.HALF_FLOAT:(o=t.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(r===Kl)return i.ALPHA;if(r===Ge)return i.RGBA;if(r===Ql)return i.LUMINANCE;if(r===jl)return i.LUMINANCE_ALPHA;if(r===Vn)return i.DEPTH_COMPONENT;if(r===_i)return i.DEPTH_STENCIL;if(r===Yr)return o=t.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(r===th)return i.RED;if(r===Cc)return i.RED_INTEGER;if(r===eh)return i.RG;if(r===Pc)return i.RG_INTEGER;if(r===Lc)return i.RGBA_INTEGER;if(r===ur||r===fr||r===dr||r===pr)if(c===Yt)if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(r===ur)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===fr)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===dr)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===pr)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=t.get("WEBGL_compressed_texture_s3tc"),o!==null){if(r===ur)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===fr)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===dr)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===pr)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===aa||r===ca||r===la||r===ha)if(o=t.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(r===aa)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===ca)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===la)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===ha)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===Ic)return o=t.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===ua||r===fa)if(o=t.get("WEBGL_compressed_texture_etc"),o!==null){if(r===ua)return c===Yt?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(r===fa)return c===Yt?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===da||r===pa||r===ma||r===ga||r===_a||r===xa||r===ya||r===va||r===Ma||r===Sa||r===ba||r===Ea||r===Ta||r===Aa)if(o=t.get("WEBGL_compressed_texture_astc"),o!==null){if(r===da)return c===Yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===pa)return c===Yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===ma)return c===Yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===ga)return c===Yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===_a)return c===Yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===xa)return c===Yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===ya)return c===Yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===va)return c===Yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===Ma)return c===Yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===Sa)return c===Yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===ba)return c===Yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===Ea)return c===Yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===Ta)return c===Yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===Aa)return c===Yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===mr||r===wa||r===Ra)if(o=t.get("EXT_texture_compression_bptc"),o!==null){if(r===mr)return c===Yt?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===wa)return o.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===Ra)return o.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===nh||r===Ca||r===Pa||r===La)if(o=t.get("EXT_texture_compression_rgtc"),o!==null){if(r===mr)return o.COMPRESSED_RED_RGTC1_EXT;if(r===Ca)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===Pa)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===La)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===zn?n?i.UNSIGNED_INT_24_8:(o=t.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):i[r]!==void 0?i[r]:null}return{convert:s}}var uo=class extends Pe{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}},ui=class extends Ke{constructor(){super(),this.isGroup=!0,this.type="Group"}},sm={type:"move"},Hi=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ui,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ui,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new L,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new L),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ui,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new L,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new L),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){let e=this._hand;if(e)for(let n of t.hand.values())this._getHandJoint(e,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,n){let s=null,r=null,a=null,o=this._targetRay,c=this._grip,l=this._hand;if(t&&e.session.visibilityState!=="visible-blurred"){if(l&&t.hand){a=!0;for(let x of t.hand.values()){let p=e.getJointPose(x,n),u=this._getHandJoint(l,x);p!==null&&(u.matrix.fromArray(p.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,u.jointRadius=p.radius),u.visible=p!==null}let h=l.joints["index-finger-tip"],d=l.joints["thumb-tip"],f=h.position.distanceTo(d.position),m=.02,g=.005;l.inputState.pinching&&f>m+g?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&f<=m-g&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else c!==null&&t.gripSpace&&(r=e.getPose(t.gripSpace,n),r!==null&&(c.matrix.fromArray(r.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,r.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(r.linearVelocity)):c.hasLinearVelocity=!1,r.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(r.angularVelocity)):c.hasAngularVelocity=!1));o!==null&&(s=e.getPose(t.targetRaySpace,n),s===null&&r!==null&&(s=r),s!==null&&(o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,s.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(s.linearVelocity)):o.hasLinearVelocity=!1,s.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(s.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(sm)))}return o!==null&&(o.visible=s!==null),c!==null&&(c.visible=r!==null),l!==null&&(l.visible=a!==null),this}_getHandJoint(t,e){if(t.joints[e.jointName]===void 0){let n=new ui;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[e.jointName]=n,t.add(n)}return t.joints[e.jointName]}},fo=class extends Tn{constructor(t,e){super();let n=this,s=null,r=1,a=null,o="local-floor",c=1,l=null,h=null,d=null,f=null,m=null,g=null,x=e.getContextAttributes(),p=null,u=null,v=[],_=[],b=new zt,S=null,T=new Pe;T.layers.enable(1),T.viewport=new he;let R=new Pe;R.layers.enable(2),R.viewport=new he;let I=[T,R],y=new uo;y.layers.enable(1),y.layers.enable(2);let A=null,D=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(G){let Z=v[G];return Z===void 0&&(Z=new Hi,v[G]=Z),Z.getTargetRaySpace()},this.getControllerGrip=function(G){let Z=v[G];return Z===void 0&&(Z=new Hi,v[G]=Z),Z.getGripSpace()},this.getHand=function(G){let Z=v[G];return Z===void 0&&(Z=new Hi,v[G]=Z),Z.getHandSpace()};function z(G){let Z=_.indexOf(G.inputSource);if(Z===-1)return;let ot=v[Z];ot!==void 0&&(ot.update(G.inputSource,G.frame,l||a),ot.dispatchEvent({type:G.type,data:G.inputSource}))}function X(){s.removeEventListener("select",z),s.removeEventListener("selectstart",z),s.removeEventListener("selectend",z),s.removeEventListener("squeeze",z),s.removeEventListener("squeezestart",z),s.removeEventListener("squeezeend",z),s.removeEventListener("end",X),s.removeEventListener("inputsourceschange",C);for(let G=0;G<v.length;G++){let Z=_[G];Z!==null&&(_[G]=null,v[G].disconnect(Z))}A=null,D=null,t.setRenderTarget(p),m=null,f=null,d=null,s=null,u=null,ut.stop(),n.isPresenting=!1,t.setPixelRatio(S),t.setSize(b.width,b.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(G){r=G,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(G){o=G,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(G){l=G},this.getBaseLayer=function(){return f!==null?f:m},this.getBinding=function(){return d},this.getFrame=function(){return g},this.getSession=function(){return s},this.setSession=async function(G){if(s=G,s!==null){if(p=t.getRenderTarget(),s.addEventListener("select",z),s.addEventListener("selectstart",z),s.addEventListener("selectend",z),s.addEventListener("squeeze",z),s.addEventListener("squeezestart",z),s.addEventListener("squeezeend",z),s.addEventListener("end",X),s.addEventListener("inputsourceschange",C),x.xrCompatible!==!0&&await e.makeXRCompatible(),S=t.getPixelRatio(),t.getSize(b),s.renderState.layers===void 0||t.capabilities.isWebGL2===!1){let Z={antialias:s.renderState.layers===void 0?x.antialias:!0,alpha:!0,depth:x.depth,stencil:x.stencil,framebufferScaleFactor:r};m=new XRWebGLLayer(s,e,Z),s.updateRenderState({baseLayer:m}),t.setPixelRatio(1),t.setSize(m.framebufferWidth,m.framebufferHeight,!1),u=new hn(m.framebufferWidth,m.framebufferHeight,{format:Ge,type:En,colorSpace:t.outputColorSpace,stencilBuffer:x.stencil})}else{let Z=null,ot=null,pt=null;x.depth&&(pt=x.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,Z=x.stencil?_i:Vn,ot=x.stencil?zn:vn);let mt={colorFormat:e.RGBA8,depthFormat:pt,scaleFactor:r};d=new XRWebGLBinding(s,e),f=d.createProjectionLayer(mt),s.updateRenderState({layers:[f]}),t.setPixelRatio(1),t.setSize(f.textureWidth,f.textureHeight,!1),u=new hn(f.textureWidth,f.textureHeight,{format:Ge,type:En,depthTexture:new Xs(f.textureWidth,f.textureHeight,ot,void 0,void 0,void 0,void 0,void 0,void 0,Z),stencilBuffer:x.stencil,colorSpace:t.outputColorSpace,samples:x.antialias?4:0});let Pt=t.properties.get(u);Pt.__ignoreDepthValues=f.ignoreDepthValues}u.isXRRenderTarget=!0,this.setFoveation(c),l=null,a=await s.requestReferenceSpace(o),ut.setContext(s),ut.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode};function C(G){for(let Z=0;Z<G.removed.length;Z++){let ot=G.removed[Z],pt=_.indexOf(ot);pt>=0&&(_[pt]=null,v[pt].disconnect(ot))}for(let Z=0;Z<G.added.length;Z++){let ot=G.added[Z],pt=_.indexOf(ot);if(pt===-1){for(let Pt=0;Pt<v.length;Pt++)if(Pt>=_.length){_.push(ot),pt=Pt;break}else if(_[Pt]===null){_[Pt]=ot,pt=Pt;break}if(pt===-1)break}let mt=v[pt];mt&&mt.connect(ot)}}let F=new L,Y=new L;function H(G,Z,ot){F.setFromMatrixPosition(Z.matrixWorld),Y.setFromMatrixPosition(ot.matrixWorld);let pt=F.distanceTo(Y),mt=Z.projectionMatrix.elements,Pt=ot.projectionMatrix.elements,Tt=mt[14]/(mt[10]-1),Et=mt[14]/(mt[10]+1),It=(mt[9]+1)/mt[5],N=(mt[9]-1)/mt[5],me=(mt[8]-1)/mt[0],gt=(Pt[8]+1)/Pt[0],Ot=Tt*me,vt=Tt*gt,Jt=pt/(-me+gt),Dt=Jt*-me;Z.matrixWorld.decompose(G.position,G.quaternion,G.scale),G.translateX(Dt),G.translateZ(Jt),G.matrixWorld.compose(G.position,G.quaternion,G.scale),G.matrixWorldInverse.copy(G.matrixWorld).invert();let Rt=Tt+Jt,Gt=Et+Jt,ae=Ot-Dt,ce=vt+(pt-Dt),w=It*Et/Gt*Rt,M=N*Et/Gt*Rt;G.projectionMatrix.makePerspective(ae,ce,w,M,Rt,Gt),G.projectionMatrixInverse.copy(G.projectionMatrix).invert()}function J(G,Z){Z===null?G.matrixWorld.copy(G.matrix):G.matrixWorld.multiplyMatrices(Z.matrixWorld,G.matrix),G.matrixWorldInverse.copy(G.matrixWorld).invert()}this.updateCamera=function(G){if(s===null)return;y.near=R.near=T.near=G.near,y.far=R.far=T.far=G.far,(A!==y.near||D!==y.far)&&(s.updateRenderState({depthNear:y.near,depthFar:y.far}),A=y.near,D=y.far);let Z=G.parent,ot=y.cameras;J(y,Z);for(let pt=0;pt<ot.length;pt++)J(ot[pt],Z);ot.length===2?H(y,T,R):y.projectionMatrix.copy(T.projectionMatrix),q(G,y,Z)};function q(G,Z,ot){ot===null?G.matrix.copy(Z.matrixWorld):(G.matrix.copy(ot.matrixWorld),G.matrix.invert(),G.matrix.multiply(Z.matrixWorld)),G.matrix.decompose(G.position,G.quaternion,G.scale),G.updateMatrixWorld(!0),G.projectionMatrix.copy(Z.projectionMatrix),G.projectionMatrixInverse.copy(Z.projectionMatrixInverse),G.isPerspectiveCamera&&(G.fov=Zr*2*Math.atan(1/G.projectionMatrix.elements[5]),G.zoom=1)}this.getCamera=function(){return y},this.getFoveation=function(){if(!(f===null&&m===null))return c},this.setFoveation=function(G){c=G,f!==null&&(f.fixedFoveation=G),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=G)};let $=null;function tt(G,Z){if(h=Z.getViewerPose(l||a),g=Z,h!==null){let ot=h.views;m!==null&&(t.setRenderTargetFramebuffer(u,m.framebuffer),t.setRenderTarget(u));let pt=!1;ot.length!==y.cameras.length&&(y.cameras.length=0,pt=!0);for(let mt=0;mt<ot.length;mt++){let Pt=ot[mt],Tt=null;if(m!==null)Tt=m.getViewport(Pt);else{let It=d.getViewSubImage(f,Pt);Tt=It.viewport,mt===0&&(t.setRenderTargetTextures(u,It.colorTexture,f.ignoreDepthValues?void 0:It.depthStencilTexture),t.setRenderTarget(u))}let Et=I[mt];Et===void 0&&(Et=new Pe,Et.layers.enable(mt),Et.viewport=new he,I[mt]=Et),Et.matrix.fromArray(Pt.transform.matrix),Et.matrix.decompose(Et.position,Et.quaternion,Et.scale),Et.projectionMatrix.fromArray(Pt.projectionMatrix),Et.projectionMatrixInverse.copy(Et.projectionMatrix).invert(),Et.viewport.set(Tt.x,Tt.y,Tt.width,Tt.height),mt===0&&(y.matrix.copy(Et.matrix),y.matrix.decompose(y.position,y.quaternion,y.scale)),pt===!0&&y.cameras.push(Et)}}for(let ot=0;ot<v.length;ot++){let pt=_[ot],mt=v[ot];pt!==null&&mt!==void 0&&mt.update(pt,Z,l||a)}$&&$(G,Z),Z.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:Z}),g=null}let ut=new Bc;ut.setAnimationLoop(tt),this.setAnimationLoop=function(G){$=G},this.dispose=function(){}}};function rm(i,t){function e(p,u){p.matrixAutoUpdate===!0&&p.updateMatrix(),u.value.copy(p.matrix)}function n(p,u){u.color.getRGB(p.fogColor.value,Oc(i)),u.isFog?(p.fogNear.value=u.near,p.fogFar.value=u.far):u.isFogExp2&&(p.fogDensity.value=u.density)}function s(p,u,v,_,b){u.isMeshBasicMaterial||u.isMeshLambertMaterial?r(p,u):u.isMeshToonMaterial?(r(p,u),d(p,u)):u.isMeshPhongMaterial?(r(p,u),h(p,u)):u.isMeshStandardMaterial?(r(p,u),f(p,u),u.isMeshPhysicalMaterial&&m(p,u,b)):u.isMeshMatcapMaterial?(r(p,u),g(p,u)):u.isMeshDepthMaterial?r(p,u):u.isMeshDistanceMaterial?(r(p,u),x(p,u)):u.isMeshNormalMaterial?r(p,u):u.isLineBasicMaterial?(a(p,u),u.isLineDashedMaterial&&o(p,u)):u.isPointsMaterial?c(p,u,v,_):u.isSpriteMaterial?l(p,u):u.isShadowMaterial?(p.color.value.copy(u.color),p.opacity.value=u.opacity):u.isShaderMaterial&&(u.uniformsNeedUpdate=!1)}function r(p,u){p.opacity.value=u.opacity,u.color&&p.diffuse.value.copy(u.color),u.emissive&&p.emissive.value.copy(u.emissive).multiplyScalar(u.emissiveIntensity),u.map&&(p.map.value=u.map,e(u.map,p.mapTransform)),u.alphaMap&&(p.alphaMap.value=u.alphaMap,e(u.alphaMap,p.alphaMapTransform)),u.bumpMap&&(p.bumpMap.value=u.bumpMap,e(u.bumpMap,p.bumpMapTransform),p.bumpScale.value=u.bumpScale,u.side===pe&&(p.bumpScale.value*=-1)),u.normalMap&&(p.normalMap.value=u.normalMap,e(u.normalMap,p.normalMapTransform),p.normalScale.value.copy(u.normalScale),u.side===pe&&p.normalScale.value.negate()),u.displacementMap&&(p.displacementMap.value=u.displacementMap,e(u.displacementMap,p.displacementMapTransform),p.displacementScale.value=u.displacementScale,p.displacementBias.value=u.displacementBias),u.emissiveMap&&(p.emissiveMap.value=u.emissiveMap,e(u.emissiveMap,p.emissiveMapTransform)),u.specularMap&&(p.specularMap.value=u.specularMap,e(u.specularMap,p.specularMapTransform)),u.alphaTest>0&&(p.alphaTest.value=u.alphaTest);let v=t.get(u).envMap;if(v&&(p.envMap.value=v,p.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,p.reflectivity.value=u.reflectivity,p.ior.value=u.ior,p.refractionRatio.value=u.refractionRatio),u.lightMap){p.lightMap.value=u.lightMap;let _=i._useLegacyLights===!0?Math.PI:1;p.lightMapIntensity.value=u.lightMapIntensity*_,e(u.lightMap,p.lightMapTransform)}u.aoMap&&(p.aoMap.value=u.aoMap,p.aoMapIntensity.value=u.aoMapIntensity,e(u.aoMap,p.aoMapTransform))}function a(p,u){p.diffuse.value.copy(u.color),p.opacity.value=u.opacity,u.map&&(p.map.value=u.map,e(u.map,p.mapTransform))}function o(p,u){p.dashSize.value=u.dashSize,p.totalSize.value=u.dashSize+u.gapSize,p.scale.value=u.scale}function c(p,u,v,_){p.diffuse.value.copy(u.color),p.opacity.value=u.opacity,p.size.value=u.size*v,p.scale.value=_*.5,u.map&&(p.map.value=u.map,e(u.map,p.uvTransform)),u.alphaMap&&(p.alphaMap.value=u.alphaMap,e(u.alphaMap,p.alphaMapTransform)),u.alphaTest>0&&(p.alphaTest.value=u.alphaTest)}function l(p,u){p.diffuse.value.copy(u.color),p.opacity.value=u.opacity,p.rotation.value=u.rotation,u.map&&(p.map.value=u.map,e(u.map,p.mapTransform)),u.alphaMap&&(p.alphaMap.value=u.alphaMap,e(u.alphaMap,p.alphaMapTransform)),u.alphaTest>0&&(p.alphaTest.value=u.alphaTest)}function h(p,u){p.specular.value.copy(u.specular),p.shininess.value=Math.max(u.shininess,1e-4)}function d(p,u){u.gradientMap&&(p.gradientMap.value=u.gradientMap)}function f(p,u){p.metalness.value=u.metalness,u.metalnessMap&&(p.metalnessMap.value=u.metalnessMap,e(u.metalnessMap,p.metalnessMapTransform)),p.roughness.value=u.roughness,u.roughnessMap&&(p.roughnessMap.value=u.roughnessMap,e(u.roughnessMap,p.roughnessMapTransform)),t.get(u).envMap&&(p.envMapIntensity.value=u.envMapIntensity)}function m(p,u,v){p.ior.value=u.ior,u.sheen>0&&(p.sheenColor.value.copy(u.sheenColor).multiplyScalar(u.sheen),p.sheenRoughness.value=u.sheenRoughness,u.sheenColorMap&&(p.sheenColorMap.value=u.sheenColorMap,e(u.sheenColorMap,p.sheenColorMapTransform)),u.sheenRoughnessMap&&(p.sheenRoughnessMap.value=u.sheenRoughnessMap,e(u.sheenRoughnessMap,p.sheenRoughnessMapTransform))),u.clearcoat>0&&(p.clearcoat.value=u.clearcoat,p.clearcoatRoughness.value=u.clearcoatRoughness,u.clearcoatMap&&(p.clearcoatMap.value=u.clearcoatMap,e(u.clearcoatMap,p.clearcoatMapTransform)),u.clearcoatRoughnessMap&&(p.clearcoatRoughnessMap.value=u.clearcoatRoughnessMap,e(u.clearcoatRoughnessMap,p.clearcoatRoughnessMapTransform)),u.clearcoatNormalMap&&(p.clearcoatNormalMap.value=u.clearcoatNormalMap,e(u.clearcoatNormalMap,p.clearcoatNormalMapTransform),p.clearcoatNormalScale.value.copy(u.clearcoatNormalScale),u.side===pe&&p.clearcoatNormalScale.value.negate())),u.iridescence>0&&(p.iridescence.value=u.iridescence,p.iridescenceIOR.value=u.iridescenceIOR,p.iridescenceThicknessMinimum.value=u.iridescenceThicknessRange[0],p.iridescenceThicknessMaximum.value=u.iridescenceThicknessRange[1],u.iridescenceMap&&(p.iridescenceMap.value=u.iridescenceMap,e(u.iridescenceMap,p.iridescenceMapTransform)),u.iridescenceThicknessMap&&(p.iridescenceThicknessMap.value=u.iridescenceThicknessMap,e(u.iridescenceThicknessMap,p.iridescenceThicknessMapTransform))),u.transmission>0&&(p.transmission.value=u.transmission,p.transmissionSamplerMap.value=v.texture,p.transmissionSamplerSize.value.set(v.width,v.height),u.transmissionMap&&(p.transmissionMap.value=u.transmissionMap,e(u.transmissionMap,p.transmissionMapTransform)),p.thickness.value=u.thickness,u.thicknessMap&&(p.thicknessMap.value=u.thicknessMap,e(u.thicknessMap,p.thicknessMapTransform)),p.attenuationDistance.value=u.attenuationDistance,p.attenuationColor.value.copy(u.attenuationColor)),u.anisotropy>0&&(p.anisotropyVector.value.set(u.anisotropy*Math.cos(u.anisotropyRotation),u.anisotropy*Math.sin(u.anisotropyRotation)),u.anisotropyMap&&(p.anisotropyMap.value=u.anisotropyMap,e(u.anisotropyMap,p.anisotropyMapTransform))),p.specularIntensity.value=u.specularIntensity,p.specularColor.value.copy(u.specularColor),u.specularColorMap&&(p.specularColorMap.value=u.specularColorMap,e(u.specularColorMap,p.specularColorMapTransform)),u.specularIntensityMap&&(p.specularIntensityMap.value=u.specularIntensityMap,e(u.specularIntensityMap,p.specularIntensityMapTransform))}function g(p,u){u.matcap&&(p.matcap.value=u.matcap)}function x(p,u){let v=t.get(u).light;p.referencePosition.value.setFromMatrixPosition(v.matrixWorld),p.nearDistance.value=v.shadow.camera.near,p.farDistance.value=v.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:s}}function om(i,t,e,n){let s={},r={},a=[],o=e.isWebGL2?i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS):0;function c(v,_){let b=_.program;n.uniformBlockBinding(v,b)}function l(v,_){let b=s[v.id];b===void 0&&(g(v),b=h(v),s[v.id]=b,v.addEventListener("dispose",p));let S=_.program;n.updateUBOMapping(v,S);let T=t.render.frame;r[v.id]!==T&&(f(v),r[v.id]=T)}function h(v){let _=d();v.__bindingPointIndex=_;let b=i.createBuffer(),S=v.__size,T=v.usage;return i.bindBuffer(i.UNIFORM_BUFFER,b),i.bufferData(i.UNIFORM_BUFFER,S,T),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,_,b),b}function d(){for(let v=0;v<o;v++)if(a.indexOf(v)===-1)return a.push(v),v;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(v){let _=s[v.id],b=v.uniforms,S=v.__cache;i.bindBuffer(i.UNIFORM_BUFFER,_);for(let T=0,R=b.length;T<R;T++){let I=b[T];if(m(I,T,S)===!0){let y=I.__offset,A=Array.isArray(I.value)?I.value:[I.value],D=0;for(let z=0;z<A.length;z++){let X=A[z],C=x(X);typeof X=="number"?(I.__data[0]=X,i.bufferSubData(i.UNIFORM_BUFFER,y+D,I.__data)):X.isMatrix3?(I.__data[0]=X.elements[0],I.__data[1]=X.elements[1],I.__data[2]=X.elements[2],I.__data[3]=X.elements[0],I.__data[4]=X.elements[3],I.__data[5]=X.elements[4],I.__data[6]=X.elements[5],I.__data[7]=X.elements[0],I.__data[8]=X.elements[6],I.__data[9]=X.elements[7],I.__data[10]=X.elements[8],I.__data[11]=X.elements[0]):(X.toArray(I.__data,D),D+=C.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,y,I.__data)}}i.bindBuffer(i.UNIFORM_BUFFER,null)}function m(v,_,b){let S=v.value;if(b[_]===void 0){if(typeof S=="number")b[_]=S;else{let T=Array.isArray(S)?S:[S],R=[];for(let I=0;I<T.length;I++)R.push(T[I].clone());b[_]=R}return!0}else if(typeof S=="number"){if(b[_]!==S)return b[_]=S,!0}else{let T=Array.isArray(b[_])?b[_]:[b[_]],R=Array.isArray(S)?S:[S];for(let I=0;I<T.length;I++){let y=T[I];if(y.equals(R[I])===!1)return y.copy(R[I]),!0}}return!1}function g(v){let _=v.uniforms,b=0,S=16,T=0;for(let R=0,I=_.length;R<I;R++){let y=_[R],A={boundary:0,storage:0},D=Array.isArray(y.value)?y.value:[y.value];for(let z=0,X=D.length;z<X;z++){let C=D[z],F=x(C);A.boundary+=F.boundary,A.storage+=F.storage}if(y.__data=new Float32Array(A.storage/Float32Array.BYTES_PER_ELEMENT),y.__offset=b,R>0){T=b%S;let z=S-T;T!==0&&z-A.boundary<0&&(b+=S-T,y.__offset=b)}b+=A.storage}return T=b%S,T>0&&(b+=S-T),v.__size=b,v.__cache={},this}function x(v){let _={boundary:0,storage:0};return typeof v=="number"?(_.boundary=4,_.storage=4):v.isVector2?(_.boundary=8,_.storage=8):v.isVector3||v.isColor?(_.boundary=16,_.storage=12):v.isVector4?(_.boundary=16,_.storage=16):v.isMatrix3?(_.boundary=48,_.storage=48):v.isMatrix4?(_.boundary=64,_.storage=64):v.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",v),_}function p(v){let _=v.target;_.removeEventListener("dispose",p);let b=a.indexOf(_.__bindingPointIndex);a.splice(b,1),i.deleteBuffer(s[_.id]),delete s[_.id],delete r[_.id]}function u(){for(let v in s)i.deleteBuffer(s[v]);a=[],s={},r={}}return{bind:c,update:l,dispose:u}}var po=class{constructor(t={}){let{canvas:e=mh(),context:n=null,depth:s=!0,stencil:r=!0,alpha:a=!1,antialias:o=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:d=!1}=t;this.isWebGLRenderer=!0;let f;n!==null?f=n.getContextAttributes().alpha:f=a;let m=new Uint32Array(4),g=new Int32Array(4),x=null,p=null,u=[],v=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=le,this._useLegacyLights=!1,this.toneMapping=bn,this.toneMappingExposure=1;let _=this,b=!1,S=0,T=0,R=null,I=-1,y=null,A=new he,D=new he,z=null,X=new Ht(0),C=0,F=e.width,Y=e.height,H=1,J=null,q=null,$=new he(0,0,F,Y),tt=new he(0,0,F,Y),ut=!1,G=new Gs,Z=!1,ot=!1,pt=null,mt=new Kt,Pt=new zt,Tt=new L,Et={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function It(){return R===null?H:1}let N=n;function me(E,U){for(let V=0;V<E.length;V++){let k=E[V],B=e.getContext(k,U);if(B!==null)return B}return null}try{let E={alpha:!0,depth:s,stencil:r,antialias:o,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:d};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Ao}`),e.addEventListener("webglcontextlost",Bt,!1),e.addEventListener("webglcontextrestored",P,!1),e.addEventListener("webglcontextcreationerror",ct,!1),N===null){let U=["webgl2","webgl","experimental-webgl"];if(_.isWebGL1Renderer===!0&&U.shift(),N=me(U,E),N===null)throw me(U)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext!="undefined"&&N instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),N.getShaderPrecisionFormat===void 0&&(N.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(E){throw console.error("THREE.WebGLRenderer: "+E.message),E}let gt,Ot,vt,Jt,Dt,Rt,Gt,ae,ce,w,M,O,et,K,nt,ft,st,at,Mt,kt,j,Wt,At,St;function _t(){gt=new Ad(N),Ot=new vd(N,gt,t),gt.init(Ot),Wt=new im(N,gt,Ot),vt=new em(N,gt,Ot),Jt=new Cd(N),Dt=new Gp,Rt=new nm(N,gt,vt,Dt,Ot,Wt,Jt),Gt=new Sd(_),ae=new Td(_),ce=new Fh(N,Ot),At=new xd(N,gt,ce,Ot),w=new wd(N,ce,Jt,At),M=new Ud(N,w,ce,Jt),Mt=new Id(N,Ot,Rt),ft=new Md(Dt),O=new Hp(_,Gt,ae,gt,Ot,At,ft),et=new rm(_,Dt),K=new Xp,nt=new Kp(gt,Ot),at=new _d(_,Gt,ae,vt,M,f,c),st=new tm(_,M,Ot),St=new om(N,Jt,Ot,vt),kt=new yd(N,gt,Jt,Ot),j=new Rd(N,gt,Jt,Ot),Jt.programs=O.programs,_.capabilities=Ot,_.extensions=gt,_.properties=Dt,_.renderLists=K,_.shadowMap=st,_.state=vt,_.info=Jt}_t();let ht=new fo(_,N);this.xr=ht,this.getContext=function(){return N},this.getContextAttributes=function(){return N.getContextAttributes()},this.forceContextLoss=function(){let E=gt.get("WEBGL_lose_context");E&&E.loseContext()},this.forceContextRestore=function(){let E=gt.get("WEBGL_lose_context");E&&E.restoreContext()},this.getPixelRatio=function(){return H},this.setPixelRatio=function(E){E!==void 0&&(H=E,this.setSize(F,Y,!1))},this.getSize=function(E){return E.set(F,Y)},this.setSize=function(E,U,V=!0){if(ht.isPresenting){console.warn("THREE.WebGLRenderer: Can\'t change size while VR device is presenting.");return}F=E,Y=U,e.width=Math.floor(E*H),e.height=Math.floor(U*H),V===!0&&(e.style.width=E+"px",e.style.height=U+"px"),this.setViewport(0,0,E,U)},this.getDrawingBufferSize=function(E){return E.set(F*H,Y*H).floor()},this.setDrawingBufferSize=function(E,U,V){F=E,Y=U,H=V,e.width=Math.floor(E*V),e.height=Math.floor(U*V),this.setViewport(0,0,E,U)},this.getCurrentViewport=function(E){return E.copy(A)},this.getViewport=function(E){return E.copy($)},this.setViewport=function(E,U,V,k){E.isVector4?$.set(E.x,E.y,E.z,E.w):$.set(E,U,V,k),vt.viewport(A.copy($).multiplyScalar(H).floor())},this.getScissor=function(E){return E.copy(tt)},this.setScissor=function(E,U,V,k){E.isVector4?tt.set(E.x,E.y,E.z,E.w):tt.set(E,U,V,k),vt.scissor(D.copy(tt).multiplyScalar(H).floor())},this.getScissorTest=function(){return ut},this.setScissorTest=function(E){vt.setScissorTest(ut=E)},this.setOpaqueSort=function(E){J=E},this.setTransparentSort=function(E){q=E},this.getClearColor=function(E){return E.copy(at.getClearColor())},this.setClearColor=function(){at.setClearColor.apply(at,arguments)},this.getClearAlpha=function(){return at.getClearAlpha()},this.setClearAlpha=function(){at.setClearAlpha.apply(at,arguments)},this.clear=function(E=!0,U=!0,V=!0){let k=0;if(E){let B=!1;if(R!==null){let lt=R.texture.format;B=lt===Lc||lt===Pc||lt===Cc}if(B){let lt=R.texture.type,dt=lt===En||lt===vn||lt===wo||lt===zn||lt===wc||lt===Rc,xt=at.getClearColor(),bt=at.getClearAlpha(),Ut=xt.r,wt=xt.g,Ct=xt.b;dt?(m[0]=Ut,m[1]=wt,m[2]=Ct,m[3]=bt,N.clearBufferuiv(N.COLOR,0,m)):(g[0]=Ut,g[1]=wt,g[2]=Ct,g[3]=bt,N.clearBufferiv(N.COLOR,0,g))}else k|=N.COLOR_BUFFER_BIT}U&&(k|=N.DEPTH_BUFFER_BIT),V&&(k|=N.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),N.clear(k)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Bt,!1),e.removeEventListener("webglcontextrestored",P,!1),e.removeEventListener("webglcontextcreationerror",ct,!1),K.dispose(),nt.dispose(),Dt.dispose(),Gt.dispose(),ae.dispose(),M.dispose(),At.dispose(),St.dispose(),O.dispose(),ht.dispose(),ht.removeEventListener("sessionstart",ge),ht.removeEventListener("sessionend",qt),pt&&(pt.dispose(),pt=null),_e.stop()};function Bt(E){E.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function P(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;let E=Jt.autoReset,U=st.enabled,V=st.autoUpdate,k=st.needsUpdate,B=st.type;_t(),Jt.autoReset=E,st.enabled=U,st.autoUpdate=V,st.needsUpdate=k,st.type=B}function ct(E){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",E.statusMessage)}function Q(E){let U=E.target;U.removeEventListener("dispose",Q),W(U)}function W(E){it(E),Dt.remove(E)}function it(E){let U=Dt.get(E).programs;U!==void 0&&(U.forEach(function(V){O.releaseProgram(V)}),E.isShaderMaterial&&O.releaseShaderCache(E))}this.renderBufferDirect=function(E,U,V,k,B,lt){U===null&&(U=Et);let dt=B.isMesh&&B.matrixWorld.determinant()<0,xt=ol(E,U,V,k,B);vt.setMaterial(k,dt);let bt=V.index,Ut=1;if(k.wireframe===!0){if(bt=w.getWireframeAttribute(V),bt===void 0)return;Ut=2}let wt=V.drawRange,Ct=V.attributes.position,jt=wt.start*Ut,we=(wt.start+wt.count)*Ut;lt!==null&&(jt=Math.max(jt,lt.start*Ut),we=Math.min(we,(lt.start+lt.count)*Ut)),bt!==null?(jt=Math.max(jt,0),we=Math.min(we,bt.count)):Ct!=null&&(jt=Math.max(jt,0),we=Math.min(we,Ct.count));let re=we-jt;if(re<0||re===1/0)return;At.setup(B,k,xt,V,bt);let je,$t=kt;if(bt!==null&&(je=ce.get(bt),$t=j,$t.setIndex(je)),B.isMesh)k.wireframe===!0?(vt.setLineWidth(k.wireframeLinewidth*It()),$t.setMode(N.LINES)):$t.setMode(N.TRIANGLES);else if(B.isLine){let Nt=k.linewidth;Nt===void 0&&(Nt=1),vt.setLineWidth(Nt*It()),B.isLineSegments?$t.setMode(N.LINES):B.isLineLoop?$t.setMode(N.LINE_LOOP):$t.setMode(N.LINE_STRIP)}else B.isPoints?$t.setMode(N.POINTS):B.isSprite&&$t.setMode(N.TRIANGLES);if(B.isBatchedMesh)$t.renderMultiDraw(B._multiDrawStarts,B._multiDrawCounts,B._multiDrawCount);else if(B.isInstancedMesh)$t.renderInstances(jt,re,B.count);else if(V.isInstancedBufferGeometry){let Nt=V._maxInstanceCount!==void 0?V._maxInstanceCount:1/0,or=Math.min(V.instanceCount,Nt);$t.renderInstances(jt,re,or)}else $t.render(jt,re)};function yt(E,U,V){E.transparent===!0&&E.side===ke&&E.forceSinglePass===!1?(E.side=pe,E.needsUpdate=!0,ts(E,U,V),E.side=Xe,E.needsUpdate=!0,ts(E,U,V),E.side=ke):ts(E,U,V)}this.compile=function(E,U,V=null){V===null&&(V=E),p=nt.get(V),p.init(),v.push(p),V.traverseVisible(function(B){B.isLight&&B.layers.test(U.layers)&&(p.pushLight(B),B.castShadow&&p.pushShadow(B))}),E!==V&&E.traverseVisible(function(B){B.isLight&&B.layers.test(U.layers)&&(p.pushLight(B),B.castShadow&&p.pushShadow(B))}),p.setupLights(_._useLegacyLights);let k=new Set;return E.traverse(function(B){let lt=B.material;if(lt)if(Array.isArray(lt))for(let dt=0;dt<lt.length;dt++){let xt=lt[dt];yt(xt,V,B),k.add(xt)}else yt(lt,V,B),k.add(lt)}),v.pop(),p=null,k},this.compileAsync=function(E,U,V=null){let k=this.compile(E,U,V);return new Promise(B=>{function lt(){if(k.forEach(function(dt){Dt.get(dt).currentProgram.isReady()&&k.delete(dt)}),k.size===0){B(E);return}setTimeout(lt,10)}gt.get("KHR_parallel_shader_compile")!==null?lt():setTimeout(lt,10)})};let Vt=null;function se(E){Vt&&Vt(E)}function ge(){_e.stop()}function qt(){_e.start()}let _e=new Bc;_e.setAnimationLoop(se),typeof self!="undefined"&&_e.setContext(self),this.setAnimationLoop=function(E){Vt=E,ht.setAnimationLoop(E),E===null?_e.stop():_e.start()},ht.addEventListener("sessionstart",ge),ht.addEventListener("sessionend",qt),this.render=function(E,U){if(U!==void 0&&U.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(b===!0)return;E.matrixWorldAutoUpdate===!0&&E.updateMatrixWorld(),U.parent===null&&U.matrixWorldAutoUpdate===!0&&U.updateMatrixWorld(),ht.enabled===!0&&ht.isPresenting===!0&&(ht.cameraAutoUpdate===!0&&ht.updateCamera(U),U=ht.getCamera()),E.isScene===!0&&E.onBeforeRender(_,E,U,R),p=nt.get(E,v.length),p.init(),v.push(p),mt.multiplyMatrices(U.projectionMatrix,U.matrixWorldInverse),G.setFromProjectionMatrix(mt),ot=this.localClippingEnabled,Z=ft.init(this.clippingPlanes,ot),x=K.get(E,u.length),x.init(),u.push(x),Ze(E,U,0,_.sortObjects),x.finish(),_.sortObjects===!0&&x.sort(J,q),this.info.render.frame++,Z===!0&&ft.beginShadows();let V=p.state.shadowsArray;if(st.render(V,E,U),Z===!0&&ft.endShadows(),this.info.autoReset===!0&&this.info.reset(),at.render(x,E),p.setupLights(_._useLegacyLights),U.isArrayCamera){let k=U.cameras;for(let B=0,lt=k.length;B<lt;B++){let dt=k[B];Xo(x,E,dt,dt.viewport)}}else Xo(x,E,U);R!==null&&(Rt.updateMultisampleRenderTarget(R),Rt.updateRenderTargetMipmap(R)),E.isScene===!0&&E.onAfterRender(_,E,U),At.resetDefaultState(),I=-1,y=null,v.pop(),v.length>0?p=v[v.length-1]:p=null,u.pop(),u.length>0?x=u[u.length-1]:x=null};function Ze(E,U,V,k){if(E.visible===!1)return;if(E.layers.test(U.layers)){if(E.isGroup)V=E.renderOrder;else if(E.isLOD)E.autoUpdate===!0&&E.update(U);else if(E.isLight)p.pushLight(E),E.castShadow&&p.pushShadow(E);else if(E.isSprite){if(!E.frustumCulled||G.intersectsSprite(E)){k&&Tt.setFromMatrixPosition(E.matrixWorld).applyMatrix4(mt);let dt=M.update(E),xt=E.material;xt.visible&&x.push(E,dt,xt,V,Tt.z,null)}}else if((E.isMesh||E.isLine||E.isPoints)&&(!E.frustumCulled||G.intersectsObject(E))){let dt=M.update(E),xt=E.material;if(k&&(E.boundingSphere!==void 0?(E.boundingSphere===null&&E.computeBoundingSphere(),Tt.copy(E.boundingSphere.center)):(dt.boundingSphere===null&&dt.computeBoundingSphere(),Tt.copy(dt.boundingSphere.center)),Tt.applyMatrix4(E.matrixWorld).applyMatrix4(mt)),Array.isArray(xt)){let bt=dt.groups;for(let Ut=0,wt=bt.length;Ut<wt;Ut++){let Ct=bt[Ut],jt=xt[Ct.materialIndex];jt&&jt.visible&&x.push(E,dt,jt,V,Tt.z,Ct)}}else xt.visible&&x.push(E,dt,xt,V,Tt.z,null)}}let lt=E.children;for(let dt=0,xt=lt.length;dt<xt;dt++)Ze(lt[dt],U,V,k)}function Xo(E,U,V,k){let B=E.opaque,lt=E.transmissive,dt=E.transparent;p.setupLightsView(V),Z===!0&&ft.setGlobalState(_.clippingPlanes,V),lt.length>0&&rl(B,lt,U,V),k&&vt.viewport(A.copy(k)),B.length>0&&ji(B,U,V),lt.length>0&&ji(lt,U,V),dt.length>0&&ji(dt,U,V),vt.buffers.depth.setTest(!0),vt.buffers.depth.setMask(!0),vt.buffers.color.setMask(!0),vt.setPolygonOffset(!1)}function rl(E,U,V,k){if((V.isScene===!0?V.overrideMaterial:null)!==null)return;let lt=Ot.isWebGL2;pt===null&&(pt=new hn(1,1,{generateMipmaps:!0,type:gt.has("EXT_color_buffer_half_float")?Wi:En,minFilter:Gi,samples:lt?4:0})),_.getDrawingBufferSize(Pt),lt?pt.setSize(Pt.x,Pt.y):pt.setSize(Jr(Pt.x),Jr(Pt.y));let dt=_.getRenderTarget();_.setRenderTarget(pt),_.getClearColor(X),C=_.getClearAlpha(),C<1&&_.setClearColor(16777215,.5),_.clear();let xt=_.toneMapping;_.toneMapping=bn,ji(E,V,k),Rt.updateMultisampleRenderTarget(pt),Rt.updateRenderTargetMipmap(pt);let bt=!1;for(let Ut=0,wt=U.length;Ut<wt;Ut++){let Ct=U[Ut],jt=Ct.object,we=Ct.geometry,re=Ct.material,je=Ct.group;if(re.side===ke&&jt.layers.test(k.layers)){let $t=re.side;re.side=pe,re.needsUpdate=!0,qo(jt,V,k,we,re,je),re.side=$t,re.needsUpdate=!0,bt=!0}}bt===!0&&(Rt.updateMultisampleRenderTarget(pt),Rt.updateRenderTargetMipmap(pt)),_.setRenderTarget(dt),_.setClearColor(X,C),_.toneMapping=xt}function ji(E,U,V){let k=U.isScene===!0?U.overrideMaterial:null;for(let B=0,lt=E.length;B<lt;B++){let dt=E[B],xt=dt.object,bt=dt.geometry,Ut=k===null?dt.material:k,wt=dt.group;xt.layers.test(V.layers)&&qo(xt,U,V,bt,Ut,wt)}}function qo(E,U,V,k,B,lt){E.onBeforeRender(_,U,V,k,B,lt),E.modelViewMatrix.multiplyMatrices(V.matrixWorldInverse,E.matrixWorld),E.normalMatrix.getNormalMatrix(E.modelViewMatrix),B.onBeforeRender(_,U,V,k,E,lt),B.transparent===!0&&B.side===ke&&B.forceSinglePass===!1?(B.side=pe,B.needsUpdate=!0,_.renderBufferDirect(V,U,k,B,E,lt),B.side=Xe,B.needsUpdate=!0,_.renderBufferDirect(V,U,k,B,E,lt),B.side=ke):_.renderBufferDirect(V,U,k,B,E,lt),E.onAfterRender(_,U,V,k,B,lt)}function ts(E,U,V){U.isScene!==!0&&(U=Et);let k=Dt.get(E),B=p.state.lights,lt=p.state.shadowsArray,dt=B.state.version,xt=O.getParameters(E,B.state,lt,U,V),bt=O.getProgramCacheKey(xt),Ut=k.programs;k.environment=E.isMeshStandardMaterial?U.environment:null,k.fog=U.fog,k.envMap=(E.isMeshStandardMaterial?ae:Gt).get(E.envMap||k.environment),Ut===void 0&&(E.addEventListener("dispose",Q),Ut=new Map,k.programs=Ut);let wt=Ut.get(bt);if(wt!==void 0){if(k.currentProgram===wt&&k.lightsStateVersion===dt)return Zo(E,xt),wt}else xt.uniforms=O.getUniforms(E),E.onBuild(V,xt,_),E.onBeforeCompile(xt,_),wt=O.acquireProgram(xt,bt),Ut.set(bt,wt),k.uniforms=xt.uniforms;let Ct=k.uniforms;return(!E.isShaderMaterial&&!E.isRawShaderMaterial||E.clipping===!0)&&(Ct.clippingPlanes=ft.uniform),Zo(E,xt),k.needsLights=cl(E),k.lightsStateVersion=dt,k.needsLights&&(Ct.ambientLightColor.value=B.state.ambient,Ct.lightProbe.value=B.state.probe,Ct.directionalLights.value=B.state.directional,Ct.directionalLightShadows.value=B.state.directionalShadow,Ct.spotLights.value=B.state.spot,Ct.spotLightShadows.value=B.state.spotShadow,Ct.rectAreaLights.value=B.state.rectArea,Ct.ltc_1.value=B.state.rectAreaLTC1,Ct.ltc_2.value=B.state.rectAreaLTC2,Ct.pointLights.value=B.state.point,Ct.pointLightShadows.value=B.state.pointShadow,Ct.hemisphereLights.value=B.state.hemi,Ct.directionalShadowMap.value=B.state.directionalShadowMap,Ct.directionalShadowMatrix.value=B.state.directionalShadowMatrix,Ct.spotShadowMap.value=B.state.spotShadowMap,Ct.spotLightMatrix.value=B.state.spotLightMatrix,Ct.spotLightMap.value=B.state.spotLightMap,Ct.pointShadowMap.value=B.state.pointShadowMap,Ct.pointShadowMatrix.value=B.state.pointShadowMatrix),k.currentProgram=wt,k.uniformsList=null,wt}function Yo(E){if(E.uniformsList===null){let U=E.currentProgram.getUniforms();E.uniformsList=pi.seqWithValue(U.seq,E.uniforms)}return E.uniformsList}function Zo(E,U){let V=Dt.get(E);V.outputColorSpace=U.outputColorSpace,V.batching=U.batching,V.instancing=U.instancing,V.instancingColor=U.instancingColor,V.skinning=U.skinning,V.morphTargets=U.morphTargets,V.morphNormals=U.morphNormals,V.morphColors=U.morphColors,V.morphTargetsCount=U.morphTargetsCount,V.numClippingPlanes=U.numClippingPlanes,V.numIntersection=U.numClipIntersection,V.vertexAlphas=U.vertexAlphas,V.vertexTangents=U.vertexTangents,V.toneMapping=U.toneMapping}function ol(E,U,V,k,B){U.isScene!==!0&&(U=Et),Rt.resetTextureUnits();let lt=U.fog,dt=k.isMeshStandardMaterial?U.environment:null,xt=R===null?_.outputColorSpace:R.isXRRenderTarget===!0?R.texture.colorSpace:ln,bt=(k.isMeshStandardMaterial?ae:Gt).get(k.envMap||dt),Ut=k.vertexColors===!0&&!!V.attributes.color&&V.attributes.color.itemSize===4,wt=!!V.attributes.tangent&&(!!k.normalMap||k.anisotropy>0),Ct=!!V.morphAttributes.position,jt=!!V.morphAttributes.normal,we=!!V.morphAttributes.color,re=bn;k.toneMapped&&(R===null||R.isXRRenderTarget===!0)&&(re=_.toneMapping);let je=V.morphAttributes.position||V.morphAttributes.normal||V.morphAttributes.color,$t=je!==void 0?je.length:0,Nt=Dt.get(k),or=p.state.lights;if(Z===!0&&(ot===!0||E!==y)){let Ie=E===y&&k.id===I;ft.setState(k,E,Ie)}let Qt=!1;k.version===Nt.__version?(Nt.needsLights&&Nt.lightsStateVersion!==or.state.version||Nt.outputColorSpace!==xt||B.isBatchedMesh&&Nt.batching===!1||!B.isBatchedMesh&&Nt.batching===!0||B.isInstancedMesh&&Nt.instancing===!1||!B.isInstancedMesh&&Nt.instancing===!0||B.isSkinnedMesh&&Nt.skinning===!1||!B.isSkinnedMesh&&Nt.skinning===!0||B.isInstancedMesh&&Nt.instancingColor===!0&&B.instanceColor===null||B.isInstancedMesh&&Nt.instancingColor===!1&&B.instanceColor!==null||Nt.envMap!==bt||k.fog===!0&&Nt.fog!==lt||Nt.numClippingPlanes!==void 0&&(Nt.numClippingPlanes!==ft.numPlanes||Nt.numIntersection!==ft.numIntersection)||Nt.vertexAlphas!==Ut||Nt.vertexTangents!==wt||Nt.morphTargets!==Ct||Nt.morphNormals!==jt||Nt.morphColors!==we||Nt.toneMapping!==re||Ot.isWebGL2===!0&&Nt.morphTargetsCount!==$t)&&(Qt=!0):(Qt=!0,Nt.__version=k.version);let Pn=Nt.currentProgram;Qt===!0&&(Pn=ts(k,U,B));let Jo=!1,Ui=!1,ar=!1,ue=Pn.getUniforms(),Ln=Nt.uniforms;if(vt.useProgram(Pn.program)&&(Jo=!0,Ui=!0,ar=!0),k.id!==I&&(I=k.id,Ui=!0),Jo||y!==E){ue.setValue(N,"projectionMatrix",E.projectionMatrix),ue.setValue(N,"viewMatrix",E.matrixWorldInverse);let Ie=ue.map.cameraPosition;Ie!==void 0&&Ie.setValue(N,Tt.setFromMatrixPosition(E.matrixWorld)),Ot.logarithmicDepthBuffer&&ue.setValue(N,"logDepthBufFC",2/(Math.log(E.far+1)/Math.LN2)),(k.isMeshPhongMaterial||k.isMeshToonMaterial||k.isMeshLambertMaterial||k.isMeshBasicMaterial||k.isMeshStandardMaterial||k.isShaderMaterial)&&ue.setValue(N,"isOrthographic",E.isOrthographicCamera===!0),y!==E&&(y=E,Ui=!0,ar=!0)}if(B.isSkinnedMesh){ue.setOptional(N,B,"bindMatrix"),ue.setOptional(N,B,"bindMatrixInverse");let Ie=B.skeleton;Ie&&(Ot.floatVertexTextures?(Ie.boneTexture===null&&Ie.computeBoneTexture(),ue.setValue(N,"boneTexture",Ie.boneTexture,Rt)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}B.isBatchedMesh&&(ue.setOptional(N,B,"batchingTexture"),ue.setValue(N,"batchingTexture",B._matricesTexture,Rt));let cr=V.morphAttributes;if((cr.position!==void 0||cr.normal!==void 0||cr.color!==void 0&&Ot.isWebGL2===!0)&&Mt.update(B,V,Pn),(Ui||Nt.receiveShadow!==B.receiveShadow)&&(Nt.receiveShadow=B.receiveShadow,ue.setValue(N,"receiveShadow",B.receiveShadow)),k.isMeshGouraudMaterial&&k.envMap!==null&&(Ln.envMap.value=bt,Ln.flipEnvMap.value=bt.isCubeTexture&&bt.isRenderTargetTexture===!1?-1:1),Ui&&(ue.setValue(N,"toneMappingExposure",_.toneMappingExposure),Nt.needsLights&&al(Ln,ar),lt&&k.fog===!0&&et.refreshFogUniforms(Ln,lt),et.refreshMaterialUniforms(Ln,k,H,Y,pt),pi.upload(N,Yo(Nt),Ln,Rt)),k.isShaderMaterial&&k.uniformsNeedUpdate===!0&&(pi.upload(N,Yo(Nt),Ln,Rt),k.uniformsNeedUpdate=!1),k.isSpriteMaterial&&ue.setValue(N,"center",B.center),ue.setValue(N,"modelViewMatrix",B.modelViewMatrix),ue.setValue(N,"normalMatrix",B.normalMatrix),ue.setValue(N,"modelMatrix",B.matrixWorld),k.isShaderMaterial||k.isRawShaderMaterial){let Ie=k.uniformsGroups;for(let lr=0,ll=Ie.length;lr<ll;lr++)if(Ot.isWebGL2){let $o=Ie[lr];St.update($o,Pn),St.bind($o,Pn)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Pn}function al(E,U){E.ambientLightColor.needsUpdate=U,E.lightProbe.needsUpdate=U,E.directionalLights.needsUpdate=U,E.directionalLightShadows.needsUpdate=U,E.pointLights.needsUpdate=U,E.pointLightShadows.needsUpdate=U,E.spotLights.needsUpdate=U,E.spotLightShadows.needsUpdate=U,E.rectAreaLights.needsUpdate=U,E.hemisphereLights.needsUpdate=U}function cl(E){return E.isMeshLambertMaterial||E.isMeshToonMaterial||E.isMeshPhongMaterial||E.isMeshStandardMaterial||E.isShadowMaterial||E.isShaderMaterial&&E.lights===!0}this.getActiveCubeFace=function(){return S},this.getActiveMipmapLevel=function(){return T},this.getRenderTarget=function(){return R},this.setRenderTargetTextures=function(E,U,V){Dt.get(E.texture).__webglTexture=U,Dt.get(E.depthTexture).__webglTexture=V;let k=Dt.get(E);k.__hasExternalTextures=!0,k.__hasExternalTextures&&(k.__autoAllocateDepthBuffer=V===void 0,k.__autoAllocateDepthBuffer||gt.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),k.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(E,U){let V=Dt.get(E);V.__webglFramebuffer=U,V.__useDefaultFramebuffer=U===void 0},this.setRenderTarget=function(E,U=0,V=0){R=E,S=U,T=V;let k=!0,B=null,lt=!1,dt=!1;if(E){let bt=Dt.get(E);bt.__useDefaultFramebuffer!==void 0?(vt.bindFramebuffer(N.FRAMEBUFFER,null),k=!1):bt.__webglFramebuffer===void 0?Rt.setupRenderTarget(E):bt.__hasExternalTextures&&Rt.rebindTextures(E,Dt.get(E.texture).__webglTexture,Dt.get(E.depthTexture).__webglTexture);let Ut=E.texture;(Ut.isData3DTexture||Ut.isDataArrayTexture||Ut.isCompressedArrayTexture)&&(dt=!0);let wt=Dt.get(E).__webglFramebuffer;E.isWebGLCubeRenderTarget?(Array.isArray(wt[U])?B=wt[U][V]:B=wt[U],lt=!0):Ot.isWebGL2&&E.samples>0&&Rt.useMultisampledRTT(E)===!1?B=Dt.get(E).__webglMultisampledFramebuffer:Array.isArray(wt)?B=wt[V]:B=wt,A.copy(E.viewport),D.copy(E.scissor),z=E.scissorTest}else A.copy($).multiplyScalar(H).floor(),D.copy(tt).multiplyScalar(H).floor(),z=ut;if(vt.bindFramebuffer(N.FRAMEBUFFER,B)&&Ot.drawBuffers&&k&&vt.drawBuffers(E,B),vt.viewport(A),vt.scissor(D),vt.setScissorTest(z),lt){let bt=Dt.get(E.texture);N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.TEXTURE_CUBE_MAP_POSITIVE_X+U,bt.__webglTexture,V)}else if(dt){let bt=Dt.get(E.texture),Ut=U||0;N.framebufferTextureLayer(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,bt.__webglTexture,V||0,Ut)}I=-1},this.readRenderTargetPixels=function(E,U,V,k,B,lt,dt){if(!(E&&E.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let xt=Dt.get(E).__webglFramebuffer;if(E.isWebGLCubeRenderTarget&&dt!==void 0&&(xt=xt[dt]),xt){vt.bindFramebuffer(N.FRAMEBUFFER,xt);try{let bt=E.texture,Ut=bt.format,wt=bt.type;if(Ut!==Ge&&Wt.convert(Ut)!==N.getParameter(N.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Ct=wt===Wi&&(gt.has("EXT_color_buffer_half_float")||Ot.isWebGL2&&gt.has("EXT_color_buffer_float"));if(wt!==En&&Wt.convert(wt)!==N.getParameter(N.IMPLEMENTATION_COLOR_READ_TYPE)&&!(wt===Mn&&(Ot.isWebGL2||gt.has("OES_texture_float")||gt.has("WEBGL_color_buffer_float")))&&!Ct){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}U>=0&&U<=E.width-k&&V>=0&&V<=E.height-B&&N.readPixels(U,V,k,B,Wt.convert(Ut),Wt.convert(wt),lt)}finally{let bt=R!==null?Dt.get(R).__webglFramebuffer:null;vt.bindFramebuffer(N.FRAMEBUFFER,bt)}}},this.copyFramebufferToTexture=function(E,U,V=0){let k=Math.pow(2,-V),B=Math.floor(U.image.width*k),lt=Math.floor(U.image.height*k);Rt.setTexture2D(U,0),N.copyTexSubImage2D(N.TEXTURE_2D,V,0,0,E.x,E.y,B,lt),vt.unbindTexture()},this.copyTextureToTexture=function(E,U,V,k=0){let B=U.image.width,lt=U.image.height,dt=Wt.convert(V.format),xt=Wt.convert(V.type);Rt.setTexture2D(V,0),N.pixelStorei(N.UNPACK_FLIP_Y_WEBGL,V.flipY),N.pixelStorei(N.UNPACK_PREMULTIPLY_ALPHA_WEBGL,V.premultiplyAlpha),N.pixelStorei(N.UNPACK_ALIGNMENT,V.unpackAlignment),U.isDataTexture?N.texSubImage2D(N.TEXTURE_2D,k,E.x,E.y,B,lt,dt,xt,U.image.data):U.isCompressedTexture?N.compressedTexSubImage2D(N.TEXTURE_2D,k,E.x,E.y,U.mipmaps[0].width,U.mipmaps[0].height,dt,U.mipmaps[0].data):N.texSubImage2D(N.TEXTURE_2D,k,E.x,E.y,dt,xt,U.image),k===0&&V.generateMipmaps&&N.generateMipmap(N.TEXTURE_2D),vt.unbindTexture()},this.copyTextureToTexture3D=function(E,U,V,k,B=0){if(_.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let lt=E.max.x-E.min.x+1,dt=E.max.y-E.min.y+1,xt=E.max.z-E.min.z+1,bt=Wt.convert(k.format),Ut=Wt.convert(k.type),wt;if(k.isData3DTexture)Rt.setTexture3D(k,0),wt=N.TEXTURE_3D;else if(k.isDataArrayTexture)Rt.setTexture2DArray(k,0),wt=N.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}N.pixelStorei(N.UNPACK_FLIP_Y_WEBGL,k.flipY),N.pixelStorei(N.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k.premultiplyAlpha),N.pixelStorei(N.UNPACK_ALIGNMENT,k.unpackAlignment);let Ct=N.getParameter(N.UNPACK_ROW_LENGTH),jt=N.getParameter(N.UNPACK_IMAGE_HEIGHT),we=N.getParameter(N.UNPACK_SKIP_PIXELS),re=N.getParameter(N.UNPACK_SKIP_ROWS),je=N.getParameter(N.UNPACK_SKIP_IMAGES),$t=V.isCompressedTexture?V.mipmaps[0]:V.image;N.pixelStorei(N.UNPACK_ROW_LENGTH,$t.width),N.pixelStorei(N.UNPACK_IMAGE_HEIGHT,$t.height),N.pixelStorei(N.UNPACK_SKIP_PIXELS,E.min.x),N.pixelStorei(N.UNPACK_SKIP_ROWS,E.min.y),N.pixelStorei(N.UNPACK_SKIP_IMAGES,E.min.z),V.isDataTexture||V.isData3DTexture?N.texSubImage3D(wt,B,U.x,U.y,U.z,lt,dt,xt,bt,Ut,$t.data):V.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),N.compressedTexSubImage3D(wt,B,U.x,U.y,U.z,lt,dt,xt,bt,$t.data)):N.texSubImage3D(wt,B,U.x,U.y,U.z,lt,dt,xt,bt,Ut,$t),N.pixelStorei(N.UNPACK_ROW_LENGTH,Ct),N.pixelStorei(N.UNPACK_IMAGE_HEIGHT,jt),N.pixelStorei(N.UNPACK_SKIP_PIXELS,we),N.pixelStorei(N.UNPACK_SKIP_ROWS,re),N.pixelStorei(N.UNPACK_SKIP_IMAGES,je),B===0&&k.generateMipmaps&&N.generateMipmap(wt),vt.unbindTexture()},this.initTexture=function(E){E.isCubeTexture?Rt.setTextureCube(E,0):E.isData3DTexture?Rt.setTexture3D(E,0):E.isDataArrayTexture||E.isCompressedArrayTexture?Rt.setTexture2DArray(E,0):Rt.setTexture2D(E,0),vt.unbindTexture()},this.resetState=function(){S=0,T=0,R=null,vt.reset(),At.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return an}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;let e=this.getContext();e.drawingBufferColorSpace=t===Ro?"display-p3":"srgb",e.unpackColorSpace=Xt.workingColorSpace===Ys?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(t){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!t}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===le?kn:Uc}set outputEncoding(t){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=t===kn?le:ln}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(t){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=t}},mo=class extends po{};mo.prototype.isWebGL1Renderer=!0;function bs(i,t,e){return!i||!e&&i.constructor===t?i:typeof t.BYTES_PER_ELEMENT=="number"?new t(i):Array.prototype.slice.call(i)}function am(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}var vi=class{constructor(t,e,n,s){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){let e=this.parameterPositions,n=this._cachedIndex,s=e[n],r=e[n-1];n:{t:{let a;e:{i:if(!(t<s)){for(let o=n+2;;){if(s===void 0){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(r=s,s=e[++n],t<s)break t}a=e.length;break e}if(!(t>=r)){let o=e[1];t<o&&(n=2,r=o);for(let c=n-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===c)break;if(s=r,r=e[--n-1],t>=r)break t}a=n,n=0;break e}break n}for(;n<a;){let o=n+a>>>1;t<e[o]?a=o:n=o+1}if(s=e[n],r=e[n-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,s)}return this.interpolate_(n,r,t,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){let e=this.resultBuffer,n=this.sampleValues,s=this.valueSize,r=t*s;for(let a=0;a!==s;++a)e[a]=n[r+a];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},go=class extends vi{constructor(t,e,n,s){super(t,e,n,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Ia,endingEnd:Ia}}intervalChanged_(t,e,n){let s=this.parameterPositions,r=t-2,a=t+1,o=s[r],c=s[a];if(o===void 0)switch(this.getSettings_().endingStart){case Ua:r=t,o=2*e-n;break;case Da:r=s.length-2,o=e+s[r]-s[r+1];break;default:r=t,o=n}if(c===void 0)switch(this.getSettings_().endingEnd){case Ua:a=t,c=2*n-e;break;case Da:a=1,c=n+s[1]-s[0];break;default:a=t-1,c=e}let l=(n-e)*.5,h=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(c-n),this._offsetPrev=r*h,this._offsetNext=a*h}interpolate_(t,e,n,s){let r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,c=t*o,l=c-o,h=this._offsetPrev,d=this._offsetNext,f=this._weightPrev,m=this._weightNext,g=(n-e)/(s-e),x=g*g,p=x*g,u=-f*p+2*f*x-f*g,v=(1+f)*p+(-1.5-2*f)*x+(-.5+f)*g+1,_=(-1-m)*p+(1.5+m)*x+.5*g,b=m*p-m*x;for(let S=0;S!==o;++S)r[S]=u*a[h+S]+v*a[l+S]+_*a[c+S]+b*a[d+S];return r}},_o=class extends vi{constructor(t,e,n,s){super(t,e,n,s)}interpolate_(t,e,n,s){let r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,c=t*o,l=c-o,h=(n-e)/(s-e),d=1-h;for(let f=0;f!==o;++f)r[f]=a[l+f]*d+a[c+f]*h;return r}},xo=class extends vi{constructor(t,e,n,s){super(t,e,n,s)}interpolate_(t){return this.copySampleValue_(t-1)}},Ye=class{constructor(t,e,n,s){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=bs(e,this.TimeBufferType),this.values=bs(n,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(t){let e=t.constructor,n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:bs(t.times,Array),values:bs(t.values,Array)};let s=t.getInterpolation();s!==t.DefaultInterpolation&&(n.interpolation=s)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new xo(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new _o(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new go(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case As:e=this.InterpolantFactoryMethodDiscrete;break;case ws:e=this.InterpolantFactoryMethodLinear;break;case gr:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){let n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return As;case this.InterpolantFactoryMethodLinear:return ws;case this.InterpolantFactoryMethodSmooth:return gr}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){let e=this.times;for(let n=0,s=e.length;n!==s;++n)e[n]+=t}return this}scale(t){if(t!==1){let e=this.times;for(let n=0,s=e.length;n!==s;++n)e[n]*=t}return this}trim(t,e){let n=this.times,s=n.length,r=0,a=s-1;for(;r!==s&&n[r]<t;)++r;for(;a!==-1&&n[a]>e;)--a;if(++a,r!==0||a!==s){r>=a&&(a=Math.max(a,1),r=a-1);let o=this.getValueSize();this.times=n.slice(r,a),this.values=this.values.slice(r*o,a*o)}return this}validate(){let t=!0,e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);let n=this.times,s=this.values,r=n.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let o=0;o!==r;o++){let c=n[o];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,c),t=!1;break}if(a!==null&&a>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,c,a),t=!1;break}a=c}if(s!==void 0&&am(s))for(let o=0,c=s.length;o!==c;++o){let l=s[o];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,l),t=!1;break}}return t}optimize(){let t=this.times.slice(),e=this.values.slice(),n=this.getValueSize(),s=this.getInterpolation()===gr,r=t.length-1,a=1;for(let o=1;o<r;++o){let c=!1,l=t[o],h=t[o+1];if(l!==h&&(o!==1||l!==t[0]))if(s)c=!0;else{let d=o*n,f=d-n,m=d+n;for(let g=0;g!==n;++g){let x=e[d+g];if(x!==e[f+g]||x!==e[m+g]){c=!0;break}}}if(c){if(o!==a){t[a]=t[o];let d=o*n,f=a*n;for(let m=0;m!==n;++m)e[f+m]=e[d+m]}++a}}if(r>0){t[a]=t[r];for(let o=r*n,c=a*n,l=0;l!==n;++l)e[c+l]=e[o+l];++a}return a!==t.length?(this.times=t.slice(0,a),this.values=e.slice(0,a*n)):(this.times=t,this.values=e),this}clone(){let t=this.times.slice(),e=this.values.slice(),n=this.constructor,s=new n(this.name,t,e);return s.createInterpolant=this.createInterpolant,s}};Ye.prototype.TimeBufferType=Float32Array;Ye.prototype.ValueBufferType=Float32Array;Ye.prototype.DefaultInterpolation=ws;var Gn=class extends Ye{};Gn.prototype.ValueTypeName="bool";Gn.prototype.ValueBufferType=Array;Gn.prototype.DefaultInterpolation=As;Gn.prototype.InterpolantFactoryMethodLinear=void 0;Gn.prototype.InterpolantFactoryMethodSmooth=void 0;var yo=class extends Ye{};yo.prototype.ValueTypeName="color";var vo=class extends Ye{};vo.prototype.ValueTypeName="number";var Mo=class extends vi{constructor(t,e,n,s){super(t,e,n,s)}interpolate_(t,e,n,s){let r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,c=(n-e)/(s-e),l=t*o;for(let h=l+o;l!==h;l+=4)An.slerpFlat(r,0,a,l-o,a,l,c);return r}},qi=class extends Ye{InterpolantFactoryMethodLinear(t){return new Mo(this.times,this.values,this.getValueSize(),t)}};qi.prototype.ValueTypeName="quaternion";qi.prototype.DefaultInterpolation=ws;qi.prototype.InterpolantFactoryMethodSmooth=void 0;var Wn=class extends Ye{};Wn.prototype.ValueTypeName="string";Wn.prototype.ValueBufferType=Array;Wn.prototype.DefaultInterpolation=As;Wn.prototype.InterpolantFactoryMethodLinear=void 0;Wn.prototype.InterpolantFactoryMethodSmooth=void 0;var So=class extends Ye{};So.prototype.ValueTypeName="vector";var bo=class{constructor(t,e,n){let s=this,r=!1,a=0,o=0,c,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(h){o++,r===!1&&s.onStart!==void 0&&s.onStart(h,a,o),r=!0},this.itemEnd=function(h){a++,s.onProgress!==void 0&&s.onProgress(h,a,o),a===o&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(h){s.onError!==void 0&&s.onError(h)},this.resolveURL=function(h){return c?c(h):h},this.setURLModifier=function(h){return c=h,this},this.addHandler=function(h,d){return l.push(h,d),this},this.removeHandler=function(h){let d=l.indexOf(h);return d!==-1&&l.splice(d,2),this},this.getHandler=function(h){for(let d=0,f=l.length;d<f;d+=2){let m=l[d],g=l[d+1];if(m.global&&(m.lastIndex=0),m.test(h))return g}return null}}},cm=new bo,Eo=class{constructor(t){this.manager=t!==void 0?t:cm,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){let n=this;return new Promise(function(s,r){n.load(t,s,e,r)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}};Eo.DEFAULT_MATERIAL_NAME="__DEFAULT";var Po="\\\\[\\\\]\\\\.:\\\\/",lm=new RegExp("["+Po+"]","g"),Lo="[^"+Po+"]",hm="[^"+Po.replace("\\\\.","")+"]",um=/((?:WC+[\\/:])*)/.source.replace("WC",Lo),fm=/(WCOD+)?/.source.replace("WCOD",hm),dm=/(?:\\.(WC+)(?:\\[(.+)\\])?)?/.source.replace("WC",Lo),pm=/\\.(WC+)(?:\\[(.+)\\])?/.source.replace("WC",Lo),mm=new RegExp("^"+um+fm+dm+pm+"$"),gm=["material","materials","bones","map"],To=class{constructor(t,e,n){let s=n||Zt.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,s)}getValue(t,e){this.bind();let n=this._targetGroup.nCachedObjects_,s=this._bindings[n];s!==void 0&&s.getValue(t,e)}setValue(t,e){let n=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=n.length;s!==r;++s)n[s].setValue(t,e)}bind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},Zt=class i{constructor(t,e,n){this.path=e,this.parsedPath=n||i.parseTrackName(e),this.node=i.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new i.Composite(t,e,n):new i(t,e,n)}static sanitizeNodeName(t){return t.replace(/\\s/g,"_").replace(lm,"")}static parseTrackName(t){let e=mm.exec(t);if(e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);let n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},s=n.nodeName&&n.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){let r=n.nodeName.substring(s+1);gm.indexOf(r)!==-1&&(n.nodeName=n.nodeName.substring(0,s),n.objectName=r)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(e===void 0||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){let n=t.skeleton.getBoneByName(e);if(n!==void 0)return n}if(t.children){let n=function(r){for(let a=0;a<r.length;a++){let o=r[a];if(o.name===e||o.uuid===e)return o;let c=n(o.children);if(c)return c}return null},s=n(t.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){let n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)t[e++]=n[s]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){let n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=t[e++]}_setValue_array_setNeedsUpdate(t,e){let n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){let n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node,e=this.parsedPath,n=e.objectName,s=e.propertyName,r=e.propertyIndex;if(t||(t=i.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let l=e.objectIndex;switch(n){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let h=0;h<t.length;h++)if(t[h].name===l){l=h;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[n]}if(l!==void 0){if(t[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[l]}}let a=t[s];if(a===void 0){let l=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+s+" but it wasn\'t found.",t);return}let o=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(r!==void 0){if(s==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[r]!==void 0&&(r=t.morphTargetDictionary[r])}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else a.fromArray!==void 0&&a.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};Zt.Composite=To;Zt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Zt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Zt.prototype.GetterByBindingType=[Zt.prototype._getValue_direct,Zt.prototype._getValue_array,Zt.prototype._getValue_arrayElement,Zt.prototype._getValue_toArray];Zt.prototype.SetterByBindingTypeAndVersioning=[[Zt.prototype._setValue_direct,Zt.prototype._setValue_direct_setNeedsUpdate,Zt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Zt.prototype._setValue_array,Zt.prototype._setValue_array_setNeedsUpdate,Zt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Zt.prototype._setValue_arrayElement,Zt.prototype._setValue_arrayElement_setNeedsUpdate,Zt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Zt.prototype._setValue_fromArray,Zt.prototype._setValue_fromArray_setNeedsUpdate,Zt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Bm=new Float32Array(1);var Sc=new L,Es=new L,be=class{constructor(t=new L,e=new L){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Sc.subVectors(t,this.start),Es.subVectors(this.end,this.start);let n=Es.dot(Es),r=Es.dot(Sc)/n;return e&&(r=ve(r,0,1)),r}closestPointToPoint(t,e,n){let s=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(s).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}};typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Ao}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Ao);var Wc=Math.pow(2,-24);var Xn=class{constructor(){}};function Fe(i,t,e){return e.min.x=t[i],e.min.y=t[i+1],e.min.z=t[i+2],e.max.x=t[i+3],e.max.y=t[i+4],e.max.z=t[i+5],e}function Io(i){let t=-1,e=-1/0;for(let n=0;n<3;n++){let s=i[n+3]-i[n];s>e&&(e=s,t=n)}return t}function Uo(i,t){t.set(i)}function Do(i,t,e){let n,s;for(let r=0;r<3;r++){let a=r+3;n=i[r],s=t[r],e[r]=n<s?n:s,n=i[a],s=t[a],e[a]=n>s?n:s}}function Zi(i,t,e){for(let n=0;n<3;n++){let s=t[i+2*n],r=t[i+2*n+1],a=s-r,o=s+r;a<e[n]&&(e[n]=a),o>e[n+3]&&(e[n+3]=o)}}function Si(i){let t=i[3]-i[0],e=i[4]-i[1],n=i[5]-i[2];return 2*(t*e+e*n+n*t)}function ym(i,t){if(!i.index){let e=i.attributes.position.count,n=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,s;e>65535?s=new Uint32Array(new n(4*e)):s=new Uint16Array(new n(2*e)),i.setIndex(new ee(s,1));for(let r=0;r<e;r++)s[r]=r}}function vm(i){if(!i.groups||!i.groups.length)return[{offset:0,count:i.index.count/3}];let t=[],e=new Set;for(let s of i.groups)e.add(s.start),e.add(s.start+s.count);let n=Array.from(e.values()).sort((s,r)=>s-r);for(let s=0;s<n.length-1;s++){let r=n[s],a=n[s+1];t.push({offset:r/3,count:(a-r)/3})}return t}function Fo(i,t,e,n,s=null){let r=1/0,a=1/0,o=1/0,c=-1/0,l=-1/0,h=-1/0,d=1/0,f=1/0,m=1/0,g=-1/0,x=-1/0,p=-1/0,u=s!==null;for(let v=t*6,_=(t+e)*6;v<_;v+=6){let b=i[v+0],S=i[v+1],T=b-S,R=b+S;T<r&&(r=T),R>c&&(c=R),u&&b<d&&(d=b),u&&b>g&&(g=b);let I=i[v+2],y=i[v+3],A=I-y,D=I+y;A<a&&(a=A),D>l&&(l=D),u&&I<f&&(f=I),u&&I>x&&(x=I);let z=i[v+4],X=i[v+5],C=z-X,F=z+X;C<o&&(o=C),F>h&&(h=F),u&&z<m&&(m=z),u&&z>p&&(p=z)}n[0]=r,n[1]=a,n[2]=o,n[3]=c,n[4]=l,n[5]=h,u&&(s[0]=d,s[1]=f,s[2]=m,s[3]=g,s[4]=x,s[5]=p)}function Mm(i,t,e,n){let s=1/0,r=1/0,a=1/0,o=-1/0,c=-1/0,l=-1/0;for(let h=t*6,d=(t+e)*6;h<d;h+=6){let f=i[h+0];f<s&&(s=f),f>o&&(o=f);let m=i[h+2];m<r&&(r=m),m>c&&(c=m);let g=i[h+4];g<a&&(a=g),g>l&&(l=g)}n[0]=s,n[1]=r,n[2]=a,n[3]=o,n[4]=c,n[5]=l}function Sm(i,t,e,n,s){let r=e,a=e+n-1,o=s.pos,c=s.axis*2;for(;;){for(;r<=a&&t[r*6+c]<o;)r++;for(;r<=a&&t[a*6+c]>=o;)a--;if(r<a){for(let l=0;l<3;l++){let h=i[r*3+l];i[r*3+l]=i[a*3+l],i[a*3+l]=h;let d=t[r*6+l*2+0];t[r*6+l*2+0]=t[a*6+l*2+0],t[a*6+l*2+0]=d;let f=t[r*6+l*2+1];t[r*6+l*2+1]=t[a*6+l*2+1],t[a*6+l*2+1]=f}r++,a--}else return r}}var dn=32,bm=(i,t)=>i.candidate-t.candidate,wn=new Array(dn).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Js=new Float32Array(6);function Em(i,t,e,n,s,r){let a=-1,o=0;if(r===0)a=Io(t),a!==-1&&(o=(t[a]+t[a+3])/2);else if(r===1)a=Io(i),a!==-1&&(o=Tm(e,n,s,a));else if(r===2){let c=Si(i),l=1.25*s,h=n*6,d=(n+s)*6;for(let f=0;f<3;f++){let m=t[f],p=(t[f+3]-m)/dn;if(s<dn/4){let u=[...wn];u.length=s;let v=0;for(let b=h;b<d;b+=6,v++){let S=u[v];S.candidate=e[b+2*f],S.count=0;let{bounds:T,leftCacheBounds:R,rightCacheBounds:I}=S;for(let y=0;y<3;y++)I[y]=1/0,I[y+3]=-1/0,R[y]=1/0,R[y+3]=-1/0,T[y]=1/0,T[y+3]=-1/0;Zi(b,e,T)}u.sort(bm);let _=s;for(let b=0;b<_;b++){let S=u[b];for(;b+1<_&&u[b+1].candidate===S.candidate;)u.splice(b+1,1),_--}for(let b=h;b<d;b+=6){let S=e[b+2*f];for(let T=0;T<_;T++){let R=u[T];S>=R.candidate?Zi(b,e,R.rightCacheBounds):(Zi(b,e,R.leftCacheBounds),R.count++)}}for(let b=0;b<_;b++){let S=u[b],T=S.count,R=s-S.count,I=S.leftCacheBounds,y=S.rightCacheBounds,A=0;T!==0&&(A=Si(I)/c);let D=0;R!==0&&(D=Si(y)/c);let z=1+1.25*(A*T+D*R);z<l&&(a=f,l=z,o=S.candidate)}}else{for(let _=0;_<dn;_++){let b=wn[_];b.count=0,b.candidate=m+p+_*p;let S=b.bounds;for(let T=0;T<3;T++)S[T]=1/0,S[T+3]=-1/0}for(let _=h;_<d;_+=6){let T=~~((e[_+2*f]-m)/p);T>=dn&&(T=dn-1);let R=wn[T];R.count++,Zi(_,e,R.bounds)}let u=wn[dn-1];Uo(u.bounds,u.rightCacheBounds);for(let _=dn-2;_>=0;_--){let b=wn[_],S=wn[_+1];Do(b.bounds,S.rightCacheBounds,b.rightCacheBounds)}let v=0;for(let _=0;_<dn-1;_++){let b=wn[_],S=b.count,T=b.bounds,I=wn[_+1].rightCacheBounds;S!==0&&(v===0?Uo(T,Js):Do(T,Js,Js)),v+=S;let y=0,A=0;v!==0&&(y=Si(Js)/c);let D=s-v;D!==0&&(A=Si(I)/c);let z=1+1.25*(y*v+A*D);z<l&&(a=f,l=z,o=b.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${r} used.`);return{axis:a,pos:o}}function Tm(i,t,e,n){let s=0;for(let r=t,a=t+e;r<a;r++)s+=i[r*6+n*2];return s/e}function Am(i,t){let e=i.attributes.position,n=i.index.array,s=n.length/3,r=new Float32Array(s*6),a=e.normalized,o=e.array,c=e.offset||0,l=3;e.isInterleavedBufferAttribute&&(l=e.data.stride);let h=["getX","getY","getZ"];for(let d=0;d<s;d++){let f=d*3,m=d*6,g,x,p;a?(g=n[f+0],x=n[f+1],p=n[f+2]):(g=n[f+0]*l+c,x=n[f+1]*l+c,p=n[f+2]*l+c);for(let u=0;u<3;u++){let v,_,b;a?(v=e[h[u]](g),_=e[h[u]](x),b=e[h[u]](p)):(v=o[g+u],_=o[x+u],b=o[p+u]);let S=v;_<S&&(S=_),b<S&&(S=b);let T=v;_>T&&(T=_),b>T&&(T=b);let R=(T-S)/2,I=u*2;r[m+I+0]=S+R,r[m+I+1]=R+(Math.abs(S)+R)*Wc,S<t[u]&&(t[u]=S),T>t[u+3]&&(t[u+3]=T)}}return r}function wm(i,t){function e(u){f&&f(u/m)}function n(u,v,_,b=null,S=0){if(!g&&S>=c&&(g=!0,l&&(console.warn(`MeshBVH: Max depth of ${c} reached when generating BVH. Consider increasing maxDepth.`),console.warn(i))),_<=h||S>=c)return e(v+_),u.offset=v,u.count=_,u;let T=Em(u.boundingData,b,a,v,_,d);if(T.axis===-1)return e(v+_),u.offset=v,u.count=_,u;let R=Sm(o,a,v,_,T);if(R===v||R===v+_)e(v+_),u.offset=v,u.count=_;else{u.splitAxis=T.axis;let I=new Xn,y=v,A=R-v;u.left=I,I.boundingData=new Float32Array(6),Fo(a,y,A,I.boundingData,r),n(I,y,A,r,S+1);let D=new Xn,z=R,X=_-A;u.right=D,D.boundingData=new Float32Array(6),Fo(a,z,X,D.boundingData,r),n(D,z,X,r,S+1)}return u}ym(i,t);let s=new Float32Array(6),r=new Float32Array(6),a=Am(i,s),o=i.index.array,c=t.maxDepth,l=t.verbose,h=t.maxLeafTris,d=t.strategy,f=t.onProgress,m=i.index.count/3,g=!1,x=[],p=vm(i);if(p.length===1){let u=p[0],v=new Xn;v.boundingData=s,Mm(a,u.offset,u.count,r),n(v,u.offset,u.count,r),x.push(v)}else for(let u of p){let v=new Xn;v.boundingData=new Float32Array(6),Fo(a,u.offset,u.count,v.boundingData,r),n(v,u.offset,u.count,r),x.push(v)}return x}function Yc(i,t){let e=wm(i,t),n,s,r,a=[],o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let h=0;h<e.length;h++){let d=e[h],f=c(d),m=new o(32*f);n=new Float32Array(m),s=new Uint32Array(m),r=new Uint16Array(m),l(0,d),a.push(m)}return a;function c(h){return h.count?1:1+c(h.left)+c(h.right)}function l(h,d){let f=h/4,m=h/2,g=!!d.count,x=d.boundingData;for(let p=0;p<6;p++)n[f+p]=x[p];if(g){let p=d.offset,u=d.count;return s[f+6]=p,r[m+14]=u,r[m+15]=65535,h+32}else{let p=d.left,u=d.right,v=d.splitAxis,_;if(_=l(h+32,p),_/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return s[f+6]=_/4,_=l(_,u),s[f+7]=v,_}}}var Ee=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let n=1/0,s=-1/0;for(let r=0,a=t.length;r<a;r++){let c=t[r][e];n=c<n?c:n,s=c>s?c:s}this.min=n,this.max=s}setFromPoints(t,e){let n=1/0,s=-1/0;for(let r=0,a=e.length;r<a;r++){let o=e[r],c=t.dot(o);n=c<n?c:n,s=c>s?c:s}this.min=n,this.max=s}isSeparated(t){return this.min>t.max||t.min>this.max}};Ee.prototype.setFromBox=function(){let i=new L;return function(e,n){let s=n.min,r=n.max,a=1/0,o=-1/0;for(let c=0;c<=1;c++)for(let l=0;l<=1;l++)for(let h=0;h<=1;h++){i.x=s.x*c+r.x*(1-c),i.y=s.y*l+r.y*(1-l),i.z=s.z*h+r.z*(1-h);let d=e.dot(i);a=Math.min(d,a),o=Math.max(d,o)}this.min=a,this.max=o}}();var $m=function(){let i=new Ee;return function(e,n){let s=e.points,r=e.satAxes,a=e.satBounds,o=n.points,c=n.satAxes,l=n.satBounds;for(let h=0;h<3;h++){let d=a[h],f=r[h];if(i.setFromPoints(f,o),d.isSeparated(i))return!1}for(let h=0;h<3;h++){let d=l[h],f=c[h];if(i.setFromPoints(f,s),d.isSeparated(i))return!1}}}();var Rm=function(){let i=new L,t=new L,e=new L;return function(s,r,a){let o=s.start,c=i,l=r.start,h=t;e.subVectors(o,l),i.subVectors(s.end,s.start),t.subVectors(r.end,r.start);let d=e.dot(h),f=h.dot(c),m=h.dot(h),g=e.dot(c),p=c.dot(c)*m-f*f,u,v;p!==0?u=(d*f-g*m)/p:u=0,v=(d+u*f)/m,a.x=u,a.y=v}}(),Ji=function(){let i=new zt,t=new L,e=new L;return function(s,r,a,o){Rm(s,r,i);let c=i.x,l=i.y;if(c>=0&&c<=1&&l>=0&&l<=1){s.at(c,a),r.at(l,o);return}else if(c>=0&&c<=1){l<0?r.at(0,o):r.at(1,o),s.closestPointToPoint(o,!0,a);return}else if(l>=0&&l<=1){c<0?s.at(0,a):s.at(1,a),r.closestPointToPoint(a,!0,o);return}else{let h;c<0?h=s.start:h=s.end;let d;l<0?d=r.start:d=r.end;let f=t,m=e;if(s.closestPointToPoint(d,!0,t),r.closestPointToPoint(h,!0,e),f.distanceToSquared(d)<=m.distanceToSquared(h)){a.copy(f),o.copy(d);return}else{a.copy(h),o.copy(m);return}}}}(),Zc=function(){let i=new L,t=new L,e=new Le,n=new be;return function(r,a){let{radius:o,center:c}=r,{a:l,b:h,c:d}=a;if(n.start=l,n.end=h,n.closestPointToPoint(c,!0,i).distanceTo(c)<=o||(n.start=l,n.end=d,n.closestPointToPoint(c,!0,i).distanceTo(c)<=o)||(n.start=h,n.end=d,n.closestPointToPoint(c,!0,i).distanceTo(c)<=o))return!0;let x=a.getPlane(e);if(Math.abs(x.distanceToPoint(c))<=o){let u=x.projectPoint(c,t);if(a.containsPoint(u))return!0}return!1}}();var Cm=1e-15;function bi(i){return Math.abs(i)<Cm}var Te=class extends We{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new L),this.satBounds=new Array(4).fill().map(()=>new Ee),this.points=[this.a,this.b,this.c],this.sphere=new Hn,this.plane=new Le,this.needsUpdate=!0}intersectsSphere(t){return Zc(t,this)}update(){let t=this.a,e=this.b,n=this.c,s=this.points,r=this.satAxes,a=this.satBounds,o=r[0],c=a[0];this.getNormal(o),c.setFromPoints(o,s);let l=r[1],h=a[1];l.subVectors(t,e),h.setFromPoints(l,s);let d=r[2],f=a[2];d.subVectors(e,n),f.setFromPoints(d,s);let m=r[3],g=a[3];m.subVectors(n,t),g.setFromPoints(m,s),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,t),this.needsUpdate=!1}};Te.prototype.closestPointToSegment=function(){let i=new L,t=new L,e=new be;return function(s,r=null,a=null){let{start:o,end:c}=s,l=this.points,h,d=1/0;for(let f=0;f<3;f++){let m=(f+1)%3;e.start.copy(l[f]),e.end.copy(l[m]),Ji(e,s,i,t),h=i.distanceToSquared(t),h<d&&(d=h,r&&r.copy(i),a&&a.copy(t))}return this.closestPointToPoint(o,i),h=o.distanceToSquared(i),h<d&&(d=h,r&&r.copy(i),a&&a.copy(o)),this.closestPointToPoint(c,i),h=c.distanceToSquared(i),h<d&&(d=h,r&&r.copy(i),a&&a.copy(c)),Math.sqrt(d)}}();Te.prototype.intersectsTriangle=function(){let i=new Te,t=new Array(3),e=new Array(3),n=new Ee,s=new Ee,r=new L,a=new L,o=new L,c=new L,l=new be,h=new be,d=new be;return function(m,g=null,x=!1){this.needsUpdate&&this.update(),m.isExtendedTriangle?m.needsUpdate&&m.update():(i.copy(m),i.update(),m=i);let p=this.plane,u=m.plane;if(Math.abs(p.normal.dot(u.normal))>1-1e-10){let v=this.satBounds,_=this.satAxes;e[0]=m.a,e[1]=m.b,e[2]=m.c;for(let T=0;T<4;T++){let R=v[T],I=_[T];if(n.setFromPoints(I,e),R.isSeparated(n))return!1}let b=m.satBounds,S=m.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let T=0;T<4;T++){let R=b[T],I=S[T];if(n.setFromPoints(I,t),R.isSeparated(n))return!1}for(let T=0;T<4;T++){let R=_[T];for(let I=0;I<4;I++){let y=S[I];if(r.crossVectors(R,y),n.setFromPoints(r,t),s.setFromPoints(r,e),n.isSeparated(s))return!1}}return g&&(x||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),g.start.set(0,0,0),g.end.set(0,0,0)),!0}else{let v=this.points,_=!1,b=0;for(let C=0;C<3;C++){let F=v[C],Y=v[(C+1)%3];l.start.copy(F),l.end.copy(Y),l.delta(a);let H=_?h.start:h.end,J=bi(u.distanceToPoint(F));if(bi(u.normal.dot(a))&&J){h.copy(l),b=2;break}if((u.intersectLine(l,H)||J)&&!bi(H.distanceTo(Y))){if(b++,_)break;_=!0}}if(b===1&&m.containsPoint(h.end))return g&&(g.start.copy(h.end),g.end.copy(h.end)),!0;if(b!==2)return!1;let S=m.points,T=!1,R=0;for(let C=0;C<3;C++){let F=S[C],Y=S[(C+1)%3];l.start.copy(F),l.end.copy(Y),l.delta(o);let H=T?d.start:d.end,J=bi(p.distanceToPoint(F));if(bi(p.normal.dot(o))&&J){d.copy(l),R=2;break}if((p.intersectLine(l,H)||J)&&!bi(H.distanceTo(Y))){if(R++,T)break;T=!0}}if(R===1&&this.containsPoint(d.end))return g&&(g.start.copy(d.end),g.end.copy(d.end)),!0;if(R!==2)return!1;if(h.delta(a),d.delta(o),a.dot(o)<0){let C=d.start;d.start=d.end,d.end=C}let I=h.start.dot(a),y=h.end.dot(a),A=d.start.dot(a),D=d.end.dot(a),z=y<A,X=I<D;return I!==D&&A!==y&&z===X?!1:(g&&(c.subVectors(h.start,d.start),c.dot(a)>0?g.start.copy(h.start):g.start.copy(d.start),c.subVectors(h.end,d.end),c.dot(a)<0?g.end.copy(h.end):g.end.copy(d.end)),!0)}}}();Te.prototype.distanceToPoint=function(){let i=new L;return function(e){return this.closestPointToPoint(e,i),e.distanceTo(i)}}();Te.prototype.distanceToTriangle=function(){let i=new L,t=new L,e=["a","b","c"],n=new be,s=new be;return function(a,o=null,c=null){let l=o||c?n:null;if(this.intersectsTriangle(a,l))return(o||c)&&(o&&l.getCenter(o),c&&l.getCenter(c)),0;let h=1/0;for(let d=0;d<3;d++){let f,m=e[d],g=a[m];this.closestPointToPoint(g,i),f=g.distanceToSquared(i),f<h&&(h=f,o&&o.copy(i),c&&c.copy(g));let x=this[m];a.closestPointToPoint(x,i),f=x.distanceToSquared(i),f<h&&(h=f,o&&o.copy(x),c&&c.copy(i))}for(let d=0;d<3;d++){let f=e[d],m=e[(d+1)%3];n.set(this[f],this[m]);for(let g=0;g<3;g++){let x=e[g],p=e[(g+1)%3];s.set(a[x],a[p]),Ji(n,s,i,t);let u=i.distanceToSquared(t);u<h&&(h=u,o&&o.copy(i),c&&c.copy(t))}}return Math.sqrt(h)}}();var Ae=class{constructor(t,e,n){this.isOrientedBox=!0,this.min=new L,this.max=new L,this.matrix=new Kt,this.invMatrix=new Kt,this.points=new Array(8).fill().map(()=>new L),this.satAxes=new Array(3).fill().map(()=>new L),this.satBounds=new Array(3).fill().map(()=>new Ee),this.alignedSatBounds=new Array(3).fill().map(()=>new Ee),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),n&&this.matrix.copy(n)}set(t,e,n){this.min.copy(t),this.max.copy(e),this.matrix.copy(n),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}};Ae.prototype.update=function(){return function(){let t=this.matrix,e=this.min,n=this.max,s=this.points;for(let l=0;l<=1;l++)for(let h=0;h<=1;h++)for(let d=0;d<=1;d++){let f=1*l|2*h|4*d,m=s[f];m.x=l?n.x:e.x,m.y=h?n.y:e.y,m.z=d?n.z:e.z,m.applyMatrix4(t)}let r=this.satBounds,a=this.satAxes,o=s[0];for(let l=0;l<3;l++){let h=a[l],d=r[l],f=1<<l,m=s[f];h.subVectors(o,m),d.setFromPoints(h,s)}let c=this.alignedSatBounds;c[0].setFromPointsField(s,"x"),c[1].setFromPointsField(s,"y"),c[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Ae.prototype.intersectsBox=function(){let i=new Ee;return function(e){this.needsUpdate&&this.update();let n=e.min,s=e.max,r=this.satBounds,a=this.satAxes,o=this.alignedSatBounds;if(i.min=n.x,i.max=s.x,o[0].isSeparated(i)||(i.min=n.y,i.max=s.y,o[1].isSeparated(i))||(i.min=n.z,i.max=s.z,o[2].isSeparated(i)))return!1;for(let c=0;c<3;c++){let l=a[c],h=r[c];if(i.setFromBox(l,e),h.isSeparated(i))return!1}return!0}}();Ae.prototype.intersectsTriangle=function(){let i=new Te,t=new Array(3),e=new Ee,n=new Ee,s=new L;return function(a){this.needsUpdate&&this.update(),a.isExtendedTriangle?a.needsUpdate&&a.update():(i.copy(a),i.update(),a=i);let o=this.satBounds,c=this.satAxes;t[0]=a.a,t[1]=a.b,t[2]=a.c;for(let f=0;f<3;f++){let m=o[f],g=c[f];if(e.setFromPoints(g,t),m.isSeparated(e))return!1}let l=a.satBounds,h=a.satAxes,d=this.points;for(let f=0;f<3;f++){let m=l[f],g=h[f];if(e.setFromPoints(g,d),m.isSeparated(e))return!1}for(let f=0;f<3;f++){let m=c[f];for(let g=0;g<4;g++){let x=h[g];if(s.crossVectors(m,x),e.setFromPoints(s,t),n.setFromPoints(s,d),e.isSeparated(n))return!1}}return!0}}();Ae.prototype.closestPointToPoint=function(){return function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();Ae.prototype.distanceToPoint=function(){let i=new L;return function(e){return this.closestPointToPoint(e,i),e.distanceTo(i)}}();Ae.prototype.distanceToBox=function(){let i=["x","y","z"],t=new Array(12).fill().map(()=>new be),e=new Array(12).fill().map(()=>new be),n=new L,s=new L;return function(a,o=0,c=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(a))return(c||l)&&(a.getCenter(s),this.closestPointToPoint(s,n),a.closestPointToPoint(n,s),c&&c.copy(n),l&&l.copy(s)),0;let h=o*o,d=a.min,f=a.max,m=this.points,g=1/0;for(let p=0;p<8;p++){let u=m[p];s.copy(u).clamp(d,f);let v=u.distanceToSquared(s);if(v<g&&(g=v,c&&c.copy(u),l&&l.copy(s),v<h))return Math.sqrt(v)}let x=0;for(let p=0;p<3;p++)for(let u=0;u<=1;u++)for(let v=0;v<=1;v++){let _=(p+1)%3,b=(p+2)%3,S=u<<_|v<<b,T=1<<p|u<<_|v<<b,R=m[S],I=m[T];t[x].set(R,I);let A=i[p],D=i[_],z=i[b],X=e[x],C=X.start,F=X.end;C[A]=d[A],C[D]=u?d[D]:f[D],C[z]=v?d[z]:f[D],F[A]=f[A],F[D]=u?d[D]:f[D],F[z]=v?d[z]:f[D],x++}for(let p=0;p<=1;p++)for(let u=0;u<=1;u++)for(let v=0;v<=1;v++){s.x=p?f.x:d.x,s.y=u?f.y:d.y,s.z=v?f.z:d.z,this.closestPointToPoint(s,n);let _=s.distanceToSquared(n);if(_<g&&(g=_,c&&c.copy(n),l&&l.copy(s),_<h))return Math.sqrt(_)}for(let p=0;p<12;p++){let u=t[p];for(let v=0;v<12;v++){let _=e[v];Ji(u,_,n,s);let b=n.distanceToSquared(s);if(b<g&&(g=b,c&&c.copy(n),l&&l.copy(s),b<h))return Math.sqrt(b)}}return Math.sqrt(g)}}();var Ks=new L,Qs=new L,js=new L,Jc=new zt,$c=new zt,Kc=new zt,Qc=new L;function Pm(i,t,e,n,s,r){let a;return r===pe?a=i.intersectTriangle(n,e,t,!0,s):a=i.intersectTriangle(t,e,n,r!==ke,s),a===null?null:{distance:i.origin.distanceTo(s),point:s.clone()}}function Lm(i,t,e,n,s,r,a){Ks.fromBufferAttribute(t,n),Qs.fromBufferAttribute(t,s),js.fromBufferAttribute(t,r);let o=Pm(i,Ks,Qs,js,Qc,a);if(o){e&&(Jc.fromBufferAttribute(e,n),$c.fromBufferAttribute(e,s),Kc.fromBufferAttribute(e,r),o.uv=We.getUV(Qc,Ks,Qs,js,Jc,$c,Kc,new zt));let c={a:n,b:s,c:r,normal:new L,materialIndex:0};We.getNormal(Ks,Qs,js,c.normal),o.face=c,o.faceIndex=n}return o}function Bo(i,t,e,n,s){let r=n*3,a=i.index.getX(r),o=i.index.getX(r+1),c=i.index.getX(r+2),l=Lm(e,i.attributes.position,i.attributes.uv,a,o,c,t);return l?(l.faceIndex=n,s&&s.push(l),l):null}function jc(i,t,e,n,s,r){for(let a=n,o=n+s;a<o;a++)Bo(i,t,e,a,r)}function tl(i,t,e,n,s){let r=1/0,a=null;for(let o=n,c=n+s;o<c;o++){let l=Bo(i,t,e,o);l&&l.distance<r&&(a=l,r=l.distance)}return a}function Oe(i,t,e,n){let s=i.a,r=i.b,a=i.c,o=t,c=t+1,l=t+2;e&&(o=e.getX(t),c=e.getX(t+1),l=e.getX(t+2)),s.x=n.getX(o),s.y=n.getY(o),s.z=n.getZ(o),r.x=n.getX(c),r.y=n.getY(c),r.z=n.getZ(c),a.x=n.getX(l),a.y=n.getY(l),a.z=n.getZ(l)}function zo(i,t,e,n,s,r,a){let o=e.index,c=e.attributes.position;for(let l=i,h=t+i;l<h;l++)if(Oe(a,l*3,o,c),a.needsUpdate=!0,n(a,l,s,r))return!0;return!1}var Ei=class{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){let t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}};function pn(i,t){return t[i+15]===65535}function qn(i,t){return t[i+6]}function Ti(i,t){return t[i+14]}function Ai(i){return i+8}function wi(i,t){return t[i+6]}function el(i,t){return t[i+7]}var Ri=new Me,er=new L,Um=["x","y","z"];function nr(i,t,e,n,s){let r=i*2,a=Ci,o=Rn,c=Cn;if(pn(r,o)){let h=qn(i,c),d=Ti(r,o);jc(t,e,n,h,d,s)}else{let h=Ai(i);sr(h,a,n,er)&&nr(h,t,e,n,s);let d=wi(i,c);sr(d,a,n,er)&&nr(d,t,e,n,s)}}function ir(i,t,e,n){let s=i*2,r=Ci,a=Rn,o=Cn;if(pn(s,a)){let l=qn(i,o),h=Ti(s,a);return tl(t,e,n,l,h)}else{let l=el(i,o),h=Um[l],f=n.direction[h]>=0,m,g;f?(m=Ai(i),g=wi(i,o)):(m=wi(i,o),g=Ai(i));let p=sr(m,r,n,er)?ir(m,t,e,n):null;if(p){let _=p.point[h];if(f?_<=r[g+l]:_>=r[g+l+3])return p}let v=sr(g,r,n,er)?ir(g,t,e,n):null;return p&&v?p.distance<=v.distance?p:v:p||v||null}}var nl=function(){let i,t,e=[],n=new Ei(()=>new Me);return function(...a){i=n.getPrimitive(),t=n.getPrimitive(),e.push(i,t);let o=s(...a);n.releasePrimitive(i),n.releasePrimitive(t),e.pop(),e.pop();let c=e.length;return c>0&&(t=e[c-1],i=e[c-2]),o};function s(r,a,o,c,l=null,h=0,d=0){function f(_){let b=_*2,S=Rn,T=Cn;for(;!pn(b,S);)_=Ai(_),b=_*2;return qn(_,T)}function m(_){let b=_*2,S=Rn,T=Cn;for(;!pn(b,S);)_=wi(_,T),b=_*2;return qn(_,T)+Ti(b,S)}let g=r*2,x=Ci,p=Rn,u=Cn;if(pn(g,p)){let _=qn(r,u),b=Ti(g,p);return Fe(r,x,i),c(_,b,!1,d,h+r,i)}else{let _=Ai(r),b=wi(r,u),S=_,T=b,R,I,y,A;if(l&&(y=i,A=t,Fe(S,x,y),Fe(T,x,A),R=l(y),I=l(A),I<R)){S=b,T=_;let H=R;R=I,I=H,y=A}y||(y=i,Fe(S,x,y));let D=pn(S*2,p),z=o(y,D,R,d+1,h+S),X;if(z===2){let H=f(S),q=m(S)-H;X=c(H,q,!0,d+1,h+S,y)}else X=z&&s(S,a,o,c,l,h,d+1);if(X)return!0;A=t,Fe(T,x,A);let C=pn(T*2,p),F=o(A,C,I,d+1,h+T),Y;if(F===2){let H=f(T),q=m(T)-H;Y=c(H,q,!0,d+1,h+T,A)}else Y=F&&s(T,a,o,c,l,h,d+1);return!!Y}}}(),il=function(){let i=new Te,t=new Te,e=new Kt,n=new Ae,s=new Ae;return function r(a,o,c,l,h=null){let d=a*2,f=Ci,m=Rn,g=Cn;if(h===null&&(c.boundingBox||c.computeBoundingBox(),n.set(c.boundingBox.min,c.boundingBox.max,l),h=n),pn(d,m)){let p=o,u=p.index,v=p.attributes.position,_=c.index,b=c.attributes.position,S=qn(a,g),T=Ti(d,m);if(e.copy(l).invert(),c.boundsTree)return Fe(a,f,s),s.matrix.copy(e),s.needsUpdate=!0,c.boundsTree.shapecast({intersectsBounds:I=>s.intersectsBox(I),intersectsTriangle:I=>{I.a.applyMatrix4(l),I.b.applyMatrix4(l),I.c.applyMatrix4(l),I.needsUpdate=!0;for(let y=S*3,A=(T+S)*3;y<A;y+=3)if(Oe(t,y,u,v),t.needsUpdate=!0,I.intersectsTriangle(t))return!0;return!1}});for(let R=S*3,I=T+S*3;R<I;R+=3){Oe(i,R,u,v),i.a.applyMatrix4(e),i.b.applyMatrix4(e),i.c.applyMatrix4(e),i.needsUpdate=!0;for(let y=0,A=_.count;y<A;y+=3)if(Oe(t,y,_,b),t.needsUpdate=!0,i.intersectsTriangle(t))return!0}}else{let p=a+8,u=g[a+6];return Fe(p,f,Ri),!!(h.intersectsBox(Ri)&&r(p,o,c,l,h)||(Fe(u,f,Ri),h.intersectsBox(Ri)&&r(u,o,c,l,h)))}}}();function sr(i,t,e,n){return Fe(i,t,Ri),e.intersectBox(Ri,n)}var Vo=[],tr,Ci,Rn,Cn;function Pi(i){tr&&Vo.push(tr),tr=i,Ci=new Float32Array(i),Rn=new Uint16Array(i),Cn=new Uint32Array(i)}function $i(){tr=null,Ci=null,Rn=null,Cn=null,Vo.length&&Pi(Vo.pop())}var ko=Symbol("skip tree generation"),Ho=new Me,Go=new Me,Li=new Kt,Yn=new Ae,Ki=new Ae,Qi=new L,rr=new L,Dm=new L,Nm=new L,Fm=new L,sl=new Me,Qe=new Ei(()=>new Te),Ii=class i{static serialize(t,e={}){if(e.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),i.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});e=Di({cloneBuffers:!0},e);let n=t.geometry,s=t._roots,r=n.getIndex(),a;return e.cloneBuffers?a={roots:s.map(o=>o.slice()),index:r.array.slice()}:a={roots:s,index:r.array},a}static deserialize(t,e,n={}){if(typeof n=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),i.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});n=Di({setIndex:!0},n);let{index:s,roots:r}=t,a=new i(e,jo(Di({},n),{[ko]:!0}));if(a._roots=r,n.setIndex){let o=e.getIndex();if(o===null){let c=new ee(t.index,1,!1);e.setIndex(c)}else o.array!==s&&(o.array.set(s),o.needsUpdate=!0)}return a}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[ko]:!1},e),e.useSharedArrayBuffer&&typeof SharedArrayBuffer=="undefined")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,e[ko]||(this._roots=Yc(t,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new Me))),this.geometry=t}refit(t=null){t&&Array.isArray(t)&&(t=new Set(t));let e=this.geometry,n=e.index.array,s=e.attributes.position,r,a,o,c,l=0,h=this._roots;for(let f=0,m=h.length;f<m;f++)r=h[f],a=new Uint32Array(r),o=new Uint16Array(r),c=new Float32Array(r),d(0,l),l+=r.byteLength;function d(f,m,g=!1){let x=f*2;if(o[x+15]===65535){let u=a[f+6],v=o[x+14],_=1/0,b=1/0,S=1/0,T=-1/0,R=-1/0,I=-1/0;for(let y=3*u,A=3*(u+v);y<A;y++){let D=n[y],z=s.getX(D),X=s.getY(D),C=s.getZ(D);z<_&&(_=z),z>T&&(T=z),X<b&&(b=X),X>R&&(R=X),C<S&&(S=C),C>I&&(I=C)}return c[f+0]!==_||c[f+1]!==b||c[f+2]!==S||c[f+3]!==T||c[f+4]!==R||c[f+5]!==I?(c[f+0]=_,c[f+1]=b,c[f+2]=S,c[f+3]=T,c[f+4]=R,c[f+5]=I,!0):!1}else{let u=f+8,v=a[f+6],_=u+m,b=v+m,S=g,T=!1,R=!1;t?S||(T=t.has(_),R=t.has(b),S=!T&&!R):(T=!0,R=!0);let I=S||T,y=S||R,A=!1;I&&(A=d(u,m,S));let D=!1;y&&(D=d(v,m,S));let z=A||D;if(z)for(let X=0;X<3;X++){let C=u+X,F=v+X,Y=c[C],H=c[C+3],J=c[F],q=c[F+3];c[f+X]=Y<J?Y:J,c[f+X+3]=H>q?H:q}return z}}}traverse(t,e=0){let n=this._roots[e],s=new Uint32Array(n),r=new Uint16Array(n);a(0);function a(o,c=0){let l=o*2,h=r[l+15]===65535;if(h){let d=s[o+6],f=r[l+14];t(c,h,new Float32Array(n,o*4,6),d,f)}else{let d=o+32/4,f=s[o+6],m=s[o+7];t(c,h,new Float32Array(n,o*4,6),m)||(a(d,c+1),a(f,c+1))}}}raycast(t,e=Xe){let n=this._roots,s=this.geometry,r=[],a=e.isMaterial,o=Array.isArray(e),c=s.groups,l=a?e.side:e;for(let h=0,d=n.length;h<d;h++){let f=o?e[c[h].materialIndex].side:l,m=r.length;if(Pi(n[h]),nr(0,s,f,t,r),$i(),o){let g=c[h].materialIndex;for(let x=m,p=r.length;x<p;x++)r[x].face.materialIndex=g}}return r}raycastFirst(t,e=Xe){let n=this._roots,s=this.geometry,r=e.isMaterial,a=Array.isArray(e),o=null,c=s.groups,l=r?e.side:e;for(let h=0,d=n.length;h<d;h++){let f=a?e[c[h].materialIndex].side:l;Pi(n[h]);let m=ir(0,s,f,t);$i(),m!=null&&(o==null||m.distance<o.distance)&&(o=m,a&&(m.face.materialIndex=c[h].materialIndex))}return o}intersectsGeometry(t,e){let n=this.geometry,s=!1;for(let r of this._roots)if(Pi(r),s=il(0,n,t,e),$i(),s)break;return s}shapecast(t,e,n){let s=this.geometry;if(t instanceof Function){if(e){let f=e;e=(m,g,x,p)=>{let u=g*3;return f(m,u,u+1,u+2,x,p)}}t={boundsTraverseOrder:n,intersectsBounds:t,intersectsTriangle:e,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let r=Qe.getPrimitive(),{boundsTraverseOrder:a,intersectsBounds:o,intersectsRange:c,intersectsTriangle:l}=t;if(c&&l){let f=c;c=(m,g,x,p,u)=>f(m,g,x,p,u)?!0:zo(m,g,s,l,x,p,r)}else c||(l?c=(f,m,g,x)=>zo(f,m,s,l,g,x,r):c=(f,m,g)=>g);let h=!1,d=0;for(let f of this._roots){if(Pi(f),h=nl(0,s,o,c,a,d),$i(),h)break;d+=f.byteLength}return Qe.releasePrimitive(r),h}bvhcast(t,e,n){let{intersectsRanges:s,intersectsTriangles:r}=n,a=this.geometry.index,o=this.geometry.attributes.position,c=t.geometry.index,l=t.geometry.attributes.position;Li.copy(e).invert();let h=Qe.getPrimitive(),d=Qe.getPrimitive();if(r){let m=function(g,x,p,u,v,_,b,S){for(let T=p,R=p+u;T<R;T++){Oe(d,T*3,c,l),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let I=g,y=g+x;I<y;I++)if(Oe(h,I*3,a,o),h.needsUpdate=!0,r(h,d,I,T,v,_,b,S))return!0}return!1};if(s){let g=s;s=function(x,p,u,v,_,b,S,T){return g(x,p,u,v,_,b,S,T)?!0:m(x,p,u,v,_,b,S,T)}}else s=m}t.getBoundingBox(Go),Go.applyMatrix4(e);let f=this.shapecast({intersectsBounds:m=>Go.intersectsBox(m),intersectsRange:(m,g,x,p,u,v)=>(Ho.copy(v),Ho.applyMatrix4(Li),t.shapecast({intersectsBounds:_=>Ho.intersectsBox(_),intersectsRange:(_,b,S,T,R)=>s(m,g,_,b,p,u,T,R)}))});return Qe.releasePrimitive(h),Qe.releasePrimitive(d),f}intersectsBox(t,e){return Yn.set(t.min,t.max,e),Yn.needsUpdate=!0,this.shapecast({intersectsBounds:n=>Yn.intersectsBox(n),intersectsTriangle:n=>Yn.intersectsTriangle(n)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,n={},s={},r=0,a=1/0){t.boundingBox||t.computeBoundingBox(),Yn.set(t.boundingBox.min,t.boundingBox.max,e),Yn.needsUpdate=!0;let o=this.geometry,c=o.attributes.position,l=o.index,h=t.attributes.position,d=t.index,f=Qe.getPrimitive(),m=Qe.getPrimitive(),g=rr,x=Dm,p=null,u=null;s&&(p=Nm,u=Fm);let v=1/0,_=null,b=null;return Li.copy(e).invert(),Ki.matrix.copy(Li),this.shapecast({boundsTraverseOrder:S=>Yn.distanceToBox(S),intersectsBounds:(S,T,R)=>R<v&&R<a?(T&&(Ki.min.copy(S.min),Ki.max.copy(S.max),Ki.needsUpdate=!0),!0):!1,intersectsRange:(S,T)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:R=>Ki.distanceToBox(R),intersectsBounds:(R,I,y)=>y<v&&y<a,intersectsRange:(R,I)=>{for(let y=R*3,A=(R+I)*3;y<A;y+=3){Oe(m,y,d,h),m.a.applyMatrix4(e),m.b.applyMatrix4(e),m.c.applyMatrix4(e),m.needsUpdate=!0;for(let D=S*3,z=(S+T)*3;D<z;D+=3){Oe(f,D,l,c),f.needsUpdate=!0;let X=f.distanceToTriangle(m,g,p);if(X<v&&(x.copy(g),u&&u.copy(p),v=X,_=D/3,b=y/3),X<r)return!0}}}});{let R=d?d.count:h.count;for(let I=0,y=R;I<y;I+=3){Oe(m,I,d,h),m.a.applyMatrix4(e),m.b.applyMatrix4(e),m.c.applyMatrix4(e),m.needsUpdate=!0;for(let A=S*3,D=(S+T)*3;A<D;A+=3){Oe(f,A,l,c),f.needsUpdate=!0;let z=f.distanceToTriangle(m,g,p);if(z<v&&(x.copy(g),u&&u.copy(p),v=z,_=A/3,b=I/3),z<r)return!0}}}}}),Qe.releasePrimitive(f),Qe.releasePrimitive(m),v===1/0?null:(n.point?n.point.copy(x):n.point=x.clone(),n.distance=v,n.faceIndex=_,s&&(s.point?s.point.copy(u):s.point=u.clone(),s.point.applyMatrix4(Li),x.applyMatrix4(Li),s.distance=x.sub(s.point).length(),s.faceIndex=b),n)}closestPointToPoint(t,e={},n=0,s=1/0){let r=n*n,a=s*s,o=1/0,c=null;if(this.shapecast({boundsTraverseOrder:h=>(Qi.copy(t).clamp(h.min,h.max),Qi.distanceToSquared(t)),intersectsBounds:(h,d,f)=>f<o&&f<a,intersectsTriangle:(h,d)=>{h.closestPointToPoint(t,Qi);let f=t.distanceToSquared(Qi);return f<o&&(rr.copy(Qi),o=f,c=d),f<r}}),o===1/0)return null;let l=Math.sqrt(o);return e.point?e.point.copy(rr):e.point=rr.clone(),e.distance=l,e.faceIndex=c,e}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(n=>{Fe(0,new Float32Array(n),sl),t.union(sl)}),t}};var Wo=self;Wo.addEventListener("message",async function({data:i}){let t=performance.now();function e(o){let c=performance.now();(c-t>=10||o===1)&&(postMessage({error:void 0,serialized:void 0,position:void 0,progress:o}),t=c)}let{id:n,index:s,position:r,options:a}=i;try{let o=new un;if(o.setAttribute("position",new ee(r,3,!1)),s&&o.setIndex(new ee(s,1,!1)),a.includedProgressCallback&&(a.onProgress=e),a.groups){let h=a.groups;for(let d in h){let f=h[d];o.addGroup(f.start,f.count,f.materialIndex)}}let c=new Ii(o,a),l=Ii.serialize(c,{cloneBuffers:!1});Wo.postMessage({id:n,error:void 0,serialized:l,position:r,progress:1},[l.index.buffer,r.buffer,...l.roots])}catch(o){Wo.postMessage({id:n,error:o,serialized:void 0,position:void 0,progress:1})}});\n/*! Bundled license information:\n\nthree/build/three.module.js:\n  (**\n   * @license\n   * Copyright 2010-2023 Three.js Authors\n   * SPDX-License-Identifier: MIT\n   *)\n*/\n')}Lu.DecoderPath="libs/draco/gltf/",Lu.Rhino3dmLibraryPath="https://unpkg.com/rhino3dm@8.0.0-beta2/";var wI=class{constructor(){this.running=!1,this.worker=new CG,this.worker.onerror=e=>{throw e.message?new Error(`[GenerateMeshBVHWorker] Could not create Web Worker with error "${e.message}"`):new Error("[GenerateMeshBVHWorker] Could not create Web Worker.")}}isRunning(){return this.running}generate(e,t={}){if(this.running)return void de.warn("[GenerateMeshBVHWorker] Already running job.");if(!this.worker)return void de.warn("[GenerateMeshBVHWorker] Worker has been disposed.");let{worker:r}=this;this.running=!0;let i=new Map;e.forEach((e=>{i.set(e.id,e)}));let n=0;return new Promise(((e,a)=>{let s=()=>{++n===i.size&&(this.running=!1,r.onmessage=null,e())};r.onerror=e=>{de.warn(`[GenerateMeshBVHWorker] ${e.message}`),a(new Error(`[GenerateMeshBVHWorker] ${e.message}`)),this.running=!1},r.onmessage=e=>{this.running=!1;let{data:r}=e;if(r.error)de.warn(r.error),s();else if(r.serialized){let{serialized:e,position:n,id:a}=r,o=i.get(a),l=bu.deserialize(e,o,{setIndex:!1}),h=Object.assign({setBoundingBox:!0},t);if(h.transferred&&(o.attributes.position.array=n),o.index)t.saveOriginalIndex&&!o.userData.originalIndex&&(o.userData.originalIndex=o.index.array),de.debug("before update, index:",o.index.array),o.index.array=e.index;else{let t=new fr(e.index,1,!1);o.setIndex(t)}o.index&&(de.debug("after update, index:",o.index.array),o.index.needsUpdate=!0),h.setBoundingBox&&!o.boundingBox&&(o.boundingBox=l.getBoundingBox(new Vt)),o.boundsTree=l,s()}else t.onProgress&&t.onProgress(r.progress)};for(let e of i){let i=e[0],n=e[1],a=n.index?n.index.array:void 0,o=n.attributes.position,l=o.array;if(o.isInterleavedBufferAttribute||a&&a.isInterleavedBufferAttribute){de.warn("[GenerateMeshBVHWorker] InterleavedBufferAttribute are not supported for the geometry attributes."),s();continue}let h=[];t.transferred&&(h.push(l),a&&(h.push(a),t.saveOriginalIndex&&(n.userData.originalIndex=a.slice()))),r.postMessage({id:i,index:a,position:l,options:Ii(on({},t),{onProgress:null,includedProgressCallback:Boolean(t.onProgress),groups:[...n.groups]})},h.length>0?h.map((e=>e.buffer)):[])}}))}dispose(){this.worker.terminate(),this.worker=void 0}},SI=class{constructor(e){this.running=!1,this.workers=[];let t=1;e?t=e:window.navigator&&(t=Math.max(t,window.navigator.hardwareConcurrency-1));for(let e=0;e<t;e++)this.workers[e]=new wI}isRunning(){return this.running}generate(e){return bt(this,arguments,(function*(e,t={}){if(this.running)de.warn("[BVHHelper] Already running job.");else{if(0!==this.workers.length)return this.running=!0,new Promise((r=>{let i=this.workers.length,n=e.length,a=[],s=Math.floor(n/i),o=n%i,l=0,h=0;for(let r=0;r<i;r++){let i=this.workers[r];if(r<o?(l=r*s+r,h=l+s+1):(l=r*s+o,h=l+s),l=Math.min(l,n),h=Math.min(h,n),l>=h)break;de.debug("startIndex: "+l+" endIndex: "+h),a.push(i.generate(e.slice(l,h),t))}Promise.allSettled(a).then((()=>{this.running=!1,r()}))}));de.warn("[BVHHelper] Worker has been disposed.")}}))}dispose(){for(let e=0;e<this.workers.length;e++)this.workers[e].dispose();this.workers=[]}static createMeshBvhSync(e,t={}){let r=new Set;e.forEach((e=>{e.traverse((e=>{let i=e;if(i.isMesh&&i.geometry&&Zi.isMergedMesh(i)&&!(i instanceof ls)){if(r.has(i.geometry.id))return;i.geometry.index&&t.saveOriginalIndex&&(i.geometry.userData.originalIndex=i.geometry.index.array.slice()),i.geometry.boundsTree=new bu(i.geometry,t),r.add(i.geometry.id)}}))}))}static createMeshBvhAsync(e,t={}){let r=new Set,i=[];e.forEach((e=>{e.traverse((e=>{let t=e;if(t.isMesh&&t.geometry&&Zi.isMergedMesh(t)&&!(t instanceof ls)){if(r.has(t.geometry.id))return;i.push(t.geometry),r.add(t.geometry.id)}}))}));let n=new SI;return n.generate(i,t).then((()=>{n.dispose()}))}},F_e=class{constructor(e,t,r,i,n){this.targetPixelHeight=100,this.canvasHeight=800,this.camera=e,this.object=r,this.targetPixelHeight=i,this.canvasHeight=n,this.adjustSize(),t.addEventListener("update",(()=>{this.adjustSize()}))}adjustSize(){let e=new Vt;if(this.object.updateMatrix(),e.expandByObject(this.object),!e)return;let t=e.max.x-e.min.x,r=this.camera.position.distanceTo(this.object.position),i=yAt(t,r,this.canvasHeight);if(Math.abs(i-this.targetPixelHeight)<5)return;let n=this.object.scale.x;n*=this.targetPixelHeight/i,this.object.scale.set(n,n,n),this.object.updateMatrix()}},yAt=(e,t,r=800,i=45)=>{let n=i*(Math.PI/180);return r*(e/(2*Math.tan(n/2)*t))},MI,AI=new Te,RI=new Te,CI=new Te,B_e=new Te,bAt=new Te,xAt=new Te,il=class extends Ki{constructor(e){super(Ut.guid()),this.needsFrustumCulled=!1,this.renderOrder=1e3,this.snapType="TripleCross",this.snapLineVisible=!1,this.snapType=e,this.drawSnapFunctions={TripleCross:this.drawTripleCorss.bind(this),Square:this.drawSquare.bind(this),Triangle:this.drawTriangle.bind(this),CircleWithCross:this.drawCircleWithCross.bind(this),Cross:this.drawCross.bind(this),Perpendicular:this.drawPerpendicular.bind(this)}}setSnapLineVisible(e){this.snapLineVisible=e}draw(e,t){this.osnapInfo&&(this.snapLineVisible&&this.drawSnapLine(e,t),e.save(),e.fillStyle=il.FILL_COLOR_NONE,e.strokeStyle=il.lineColor,e.lineWidth=il.lineWidth,e.beginPath(),this.drawSnapFunctions[this.snapType](e,t),MI&&this.drawDebug(e,t),e.closePath(),e.fill(),e.stroke(),e.restore())}drawDebug(e,t){null==MI||MI.forEach((r=>{let i=this.transToScreenCoord(r.start,t),n=this.transToScreenCoord(r.end,t);e.moveTo(i.x,i.y),e.lineTo(n.x,n.y)}))}drawSelect(e,t){}isPointInPath(e){return!1}drawSnapLine(e,t){e.save(),e.strokeStyle=il.SNAP_LINE_COLOR,e.lineWidth=il.lineWidth;let r=this.osnapInfo.line;if(!r)return;let i=this.transToScreenCoord(r.start,t),n=this.transToScreenCoord(r.end,t);e.moveTo(i.x,i.y),e.lineTo(n.x,n.y),e.stroke(),e.restore()}drawTripleCorss(e,t){let r=this.transToScreenCoord(this.osnapInfo.point,t),i=il.iconSize/1.6,n=AI.set(r.x,r.y-i),a=RI.set(r.x-.87*i,r.y+i/1.4),s=CI.set(r.x+.87*i,r.y+i/1.4);e.moveTo(r.x,r.y),e.lineTo(n.x,n.y),e.moveTo(r.x,r.y),e.lineTo(a.x,a.y),e.moveTo(r.x,r.y),e.lineTo(s.x,s.y)}drawSquare(e,t){let r=this.transToScreenCoord(this.osnapInfo.point,t),i=il.iconSize,n=il.iconSize;e.rect(r.x-i/2,r.y-n/2,i,n)}drawTriangle(e,t){let r=this.transToScreenCoord(this.osnapInfo.point,t),i=il.iconSize/1.6,n=AI.set(r.x,r.y-i),a=RI.set(r.x-.87*i,r.y+i/2),s=CI.set(r.x+.87*i,r.y+i/2);e.moveTo(n.x,n.y),e.lineTo(a.x,a.y),e.lineTo(s.x,s.y)}drawCircleWithCross(e,t){let r=this.transToScreenCoord(this.osnapInfo.point,t),i=il.iconSize/2;e.arc(r.x,r.y,i,0,2*Math.PI),e.moveTo(r.x-i/1.8,r.y),e.lineTo(r.x+i/1.8,r.y),e.moveTo(r.x,r.y-i/1.8),e.lineTo(r.x,r.y+i/1.8)}drawCross(e,t){let r=this.transToScreenCoord(this.osnapInfo.point,t),i=il.iconSize/2,n=AI.set(r.x-i,r.y-i),a=RI.set(r.x+i,r.y+i),s=CI.set(r.x+i,r.y-i),o=B_e.set(r.x-i,r.y+i);e.moveTo(n.x,n.y),e.lineTo(a.x,a.y),e.moveTo(s.x,s.y),e.lineTo(o.x,o.y)}drawPerpendicular(e,t){let r=this.transToScreenCoord(this.osnapInfo.point,t),i=il.iconSize/2,n=AI.set(r.x,r.y),a=RI.set(r.x-i,r.y),s=CI.set(r.x,r.y+i),o=B_e.set(r.x-i,r.y-i),l=bAt.set(r.x-i,r.y+i),h=xAt.set(r.x+i,r.y+i);e.moveTo(a.x,a.y),e.lineTo(n.x,n.y),e.lineTo(s.x,s.y),e.moveTo(o.x,o.y),e.lineTo(l.x,l.y),e.lineTo(h.x,h.y),e.lineTo(o.x,o.y)}update(e){this.osnapInfo=e}getClassType(){return"SnapDrawable"}},Ks=il;Ks.lineColor="rgba(255, 119, 0, 1)",Ks.FILL_COLOR_NONE="rgba(0, 0, 0, 0)",Ks.SNAP_LINE_COLOR="rgba(255, 240, 0, 0.3)",Ks.lineWidth=2,Ks.iconSize=14,Jr._registerDrawableClass(Ks);var PG=(e=>(e[e.None=0]="None",e[e.Vertex=1]="Vertex",e[e.MiddlePoint=2]="MiddlePoint",e[e.Edge=4]="Edge",e[e.Face=8]="Face",e[e.FootOfPerpendicular=16]="FootOfPerpendicular",e[e.Intersection=32]="Intersection",e[e.CircleCenter=64]="CircleCenter",e))(PG||{}),EAt=1e-5,ys=new F,Ba=new F,cb=new F,Ew=new F,w0=new lt,_w=new La;function _At(e,t){let r=Number.MAX_VALUE,i=0;for(let n=0;n<e.vertices.length;n++){let a=t.distanceTo(e.vertices[n]);a<r&&(i=n,r=a)}return{vertex:e.vertices[i],distance:r}}function TAt(e){if(!(e.object instanceof Ht&&e.face))return;let t=e.object,r=t.geometry.attributes.position,i=t.geometry.index;if(r.count<3)return;let n=Zi.getBatchByFaceIndex(t,e.faceIndex);t.geometry.boundsTree&&(i=new fr(t.geometry.userData.originalIndex,1,!1)),w0.identity(),t instanceof ls&&void 0!==e.instanceId&&t.getMatrixAt(e.instanceId,w0),w0.premultiply(t.matrixWorld);let a,s=t.geometry.drawRange,o=r.array;if(i){let e=Math.max(0,s.start),t=Math.min(i.count,s.start+s.count);if(a=i.array,n){e=Math.max(e,n.indexStart),t=Math.min(t,n.indexStart+n.indexCount),a=i.array.slice(e,t),o=r.array.slice(3*n.positionStart,3*(n.positionStart+n.positionCount));for(let e=0;e<a.length;e++)a[e]=a[e]-n.positionStart}else(0!==e||t!==i.count)&&(a=i.array.slice(e,t))}else{let e=Math.max(0,s.start),t=Math.min(r.count,s.start+s.count);n?(e=Math.max(e,n.positionStart),t=Math.min(t,n.positionStart+n.positionCount),o=r.array.slice(3*n.positionStart,3*(n.positionStart+n.positionCount))):(0!==e||t!==r.count)&&(o=r.array.slice(3*e,3*t));let i=o.length/3;a=i>65535?new Uint32Array(i):new Uint16Array(i);for(let e=0,t=i;e<t;e++)a[e]=e}let l=CP.buildEdge(o,a,20),h=Number.MAX_VALUE,c=0;for(let t=0;t<l.length;t+=2){let r=l[t],i=l[t+1];ys.set(o[3*r],o[3*r+1],o[3*r+2]),ys.applyMatrix4(w0),Ba.set(o[3*i],o[3*i+1],o[3*i+2]),Ba.applyMatrix4(w0),_w.set(ys,Ba),_w.closestPointToPoint(e.point,!0,cb);let n=e.point.distanceTo(cb);n<h&&(c=t,h=n,Ew.copy(cb))}let u=l[c],d=l[c+1];return ys.set(o[3*u],o[3*u+1],o[3*u+2]),ys.applyMatrix4(w0),Ba.set(o[3*d],o[3*d+1],o[3*d+2]),Ba.applyMatrix4(w0),{vertices:[ys.clone(),Ba.clone()],vertex:Ew.clone(),distance:h}}var PI=class{constructor(e){var t;this.drawableList=new Ol("snap"),this.markers={},this.activeOSnapType=0,this.snapToleranceInWorldCoord=1,this.intersectionLimit=10,this.osnapTypePriorities={1:0,2:1,64:2,32:3,16:4,4:5,8:6,0:100},this.enabledOSnapTypes=127,this.overlayRender=e,null==(t=this.overlayRender)||t.addDrawableList(this.drawableList),this.initOSnapMarkers()}initOSnapMarkers(){let e=new Ks("TripleCross"),t=new Ks("Square"),r=new Ks("Triangle"),i=new Ks("CircleWithCross"),n=new Ks("Cross"),a=new Ks("Perpendicular");this.markers[1]=t,this.markers[2]=r,this.markers[4]=e,this.markers[32]=n,this.markers[64]=i,this.markers[16]=a,Object.values(this.markers).forEach((e=>{e.visible=!1,this.drawableList.addDrawable(e)}))}isOSnapTypeEnabled(e){return!!(this.enabledOSnapTypes&e)}setOSnapTypeEnabled(e,t){if(t)this.enabledOSnapTypes|=e;else{let t=~e;this.enabledOSnapTypes&=t}}setSnapTolerance(e){this.snapToleranceInWorldCoord=e}getSnapTolerance(){return this.snapToleranceInWorldCoord}setIntersectionLimit(e){this.intersectionLimit=e}getIntersectionLimit(){return this.intersectionLimit}getMarkerLineColor(){return Br.colorStr2Rgba(Ks.lineColor)}setMarkerLineColor(e){Ks.lineColor=Br.rgba2Color(e)}getMarkerLineWidth(){return Ks.lineWidth}setMarkerLineWidth(e){Ks.lineWidth=e}getMarkerIconSize(){return Ks.iconSize}setMarkerIconSize(e){Ks.iconSize=e}getMarker(e){return this.markers[e]}setAllSnapLinesVisible(e){Object.values(this.markers).forEach((t=>{t.setSnapLineVisible(e)}))}deactivate(){var e;this.activeOSnapType&&(this.markers[this.activeOSnapType].visible=!1,null==(e=this.overlayRender)||e.render()),this.activeOSnapType=0}destroy(){}handleSnap(e,t,r){if(!e||e.length<1)return void this.deactivate();de.debug("[OSnap] intersections before handleSnap:",e);let i,n=[],a=!1;for(let t of e)t.object instanceof Ht?(i||(i=t.point),!a&&"groundPlane"!==t.object.name&&(n.push(t),a=!0)):n.push(t);if(!t&&i){i.setZ(0);for(let e of n)e.point.z=0,e.distance=e.point.distanceTo(i);let e=e=>e instanceof Di?0:e instanceof Wn?2:e instanceof jn?1:3;n.sort(((t,r)=>{let i=e(t.object),n=e(r.object);return i!==n?i-n:t.distance-r.distance}))}i||(de.warn("[OSnap] Potential to produce erroneous snap results"),i=n[0].point),de.debug("[OSnap] intersections:",n),de.debug("[OSnap] mousePosition:",i);let s=this.getSnapPointAndUpdateMarker(i,n,t,r);return(null==s?void 0:s.clone())||i}getSnapPointAndUpdateMarker(e,t,r,i){if(!t.length)return void this.activateMarker(0);let n=this.getSnapInfo(e,t,r,i);if(n&&0!==n.type)return this.activateMarker(n.type,n),n.point;this.activateMarker(0)}activateMarker(e,t){var r;this.activeOSnapType&&(this.markers[this.activeOSnapType].visible=!1),this.activeOSnapType=e;let i=this.markers[e];i&&t&&(i.update(t),i.visible=!0),null==(r=this.overlayRender)||r.render()}getFootOfPerpendicular(e,t,r=EAt){let{start:i,end:n}=t,a=i.x-n.x,s=i.y-n.y,o=i.z-n.z;if(i.distanceTo(n)<r)return i.clone();let l=(e.x-i.x)*(i.x-n.x)+(e.y-i.y)*(i.y-n.y)+(e.z-i.z)*(i.z-n.z);return l/=a*a+s*s+o*o,new F(i.x+l*a,i.y+l*s,i.z+l*o)}getSnapInfo(e,t,r,i){let n=2*this.snapToleranceInWorldCoord;de.debug("[OSnap] snap radius:",n);let a=[],s={line:void 0},o=this.osnapTypePriorities[0];for(let l=0;l<t.length&&l<this.intersectionLimit;++l){let h,c=t[l],u=c.object;u instanceof Ht?h=this.getOsnapInfoListFromMesh(e,c,n,o):u instanceof jn?h=this.getOsnapInfoListFromLine(e,c,r,n,s,o,i):u instanceof Di&&(h=this.getOsnapInfoListFromPoint(e,c,r,n,o)),h&&(o=this.osnapTypePriorities[h.type],a.push(h))}if(0!==a.length)return a.sort(((e,t)=>{let r=this.osnapTypePriorities[e.type],i=this.osnapTypePriorities[t.type];return r!==i?r-i:e.distance-t.distance})),a[0]}getOsnapInfoListFromMesh(e,t,r,i){if(i<this.osnapTypePriorities[1])return;let n=Date.now(),a=TAt(t);if(!a)return void de.warn("[OSnap] Failed to get edge !");let s=Date.now();de.debug(`[OSnap] getEdgeSnappingInfo costs ${(s-n)/1e3}s `),de.debug("[OSnap] edge:",a);let o=_At(a,e);if(de.debug("[OSnap] vertex:",o),o.distance<=r&&this.isOSnapTypeEnabled(1))return{distance:o.distance,type:1,point:o.vertex};if(a.distance<=r){if(this.isOSnapTypeEnabled(2)&&i<this.osnapTypePriorities[2])return;ys.copy(a.vertices[0]),ys.add(a.vertices[1]),ys.divideScalar(2);let t=ys.distanceTo(e);return t<=r&&this.isOSnapTypeEnabled(2)?{distance:t,type:2,point:ys.clone()}:!this.isOSnapTypeEnabled(4)||i<this.osnapTypePriorities[4]?void 0:{distance:a.distance,type:4,point:a.vertex,line:{start:a.vertices[0],end:a.vertices[1]}}}de.debug("[OSnap] Face")}getOsnapInfoFromSegment(e,t,r,i,n,a,s){let o={start:t,end:r};if(s&&a>=this.osnapTypePriorities[16]&&this.isOSnapTypeEnabled(16)){let t=this.getFootOfPerpendicular(s,o,i),r=e.distanceTo(t);if(r<=i)return{distance:or.floorNumber(r,7),type:16,point:t.clone()}}if(a<this.osnapTypePriorities[1])return;_w.set(t,r),_w.closestPointToPoint(e,!0,cb);let l=e.distanceTo(cb);if(l>i)return;let h=e.distanceTo(t),c=e.distanceTo(r);if(Math.min(h,c)<=i&&this.isOSnapTypeEnabled(1)){let e=h,i=t;return c<h&&(e=c,i=r),{distance:or.floorNumber(e,7),type:1,point:i.clone()}}if(a<this.osnapTypePriorities[2])return;_w.getCenter(Ew);let u=e.distanceTo(Ew);if(u<i&&this.isOSnapTypeEnabled(2))return{point:Ew.clone(),distance:or.floorNumber(u,7),type:2};if(!(a<this.osnapTypePriorities[4])){if(n.line&&this.isOSnapTypeEnabled(32)){let t=pr.getLineSegmentsIntersectingPoint(n.line,o);if(!t)return;let r=e.distanceTo(t)/2;return r<i?(n.line=void 0,{point:t.clone(),distance:or.floorNumber(r,7),type:32}):void 0}if(this.isOSnapTypeEnabled(4))return n.line={start:t.clone(),end:r.clone()},{point:cb.clone(),distance:or.floorNumber(l,7),type:4,line:{start:t.clone(),end:r.clone()}}}}getOsnapInfoListFromLine(e,t,r,i,n,a,s){let o=[],l=t.object,h=l instanceof Wn?2:1,c=l.geometry.index,u=l.geometry.attributes.position,d=l.geometry.drawRange,p=Zi.getBatchByLineIndex(l,t.index);if(c){let t=Math.max(0,d.start),f=Math.min(c.count,d.start+d.count);p&&(t=Math.max(t,p.indexStart),f=Math.min(f,p.indexStart+p.indexCount));for(let d=t,p=f;d<p-1;d+=h){let t=c.getX(d),h=c.getX(d+1);ys.fromBufferAttribute(u,t),Ba.fromBufferAttribute(u,h),ys.applyMatrix4(l.matrixWorld),Ba.applyMatrix4(l.matrixWorld),r||(ys.setZ(0),Ba.setZ(0));let p=this.getOsnapInfoFromSegment(e,ys,Ba,i,n,a,s);p&&(a=this.osnapTypePriorities[p.type],o.push(p))}}else{let t=Math.max(0,d.start),c=Math.min(u.count,d.start+d.count);p&&(t=Math.max(t,p.positionStart),c=Math.min(c,p.positionStart+p.positionCount));for(let d=t,p=c;d<p-1;d+=h){ys.fromBufferAttribute(u,d),Ba.fromBufferAttribute(u,d+1),ys.applyMatrix4(l.matrixWorld),Ba.applyMatrix4(l.matrixWorld),r||(ys.setZ(0),Ba.setZ(0));let t=this.getOsnapInfoFromSegment(e,ys,Ba,i,n,a,s);t&&(a=this.osnapTypePriorities[t.type],o.push(t))}}if(0!==o.length)return o.sort(((e,t)=>{let r=this.osnapTypePriorities[e.type],i=this.osnapTypePriorities[t.type];return r!==i?r-i:e.distance-t.distance})),o[0]}getOsnapInfoListFromPoint(e,t,r,i,n){if(n<this.osnapTypePriorities[1])return;let a=t.object,s=a.geometry.getAttribute("position");ys.fromBufferAttribute(s,t.index),ys.applyMatrix4(a.matrixWorld),Ba.copy(e),r||(ys.setZ(0),Ba.setZ(0));let o=Ba.distanceTo(ys);if(o>i)return;let l={distance:o,point:ys.clone(),type:1};if("CircleCenter"===a.userData.type){if(!this.isOSnapTypeEnabled(64))return;l.type=64}else if(de.debug("[OSnap] Other types of vertices !"),!this.isOSnapTypeEnabled(1))return;return l}getIntersectsIncludeOutline(e,t){let r=e.slice(),i=[];for(let t=0;t<e.length&&t<this.intersectionLimit;t++){let r=e[t].object;if(r.updateWorldMatrix(!0,!1),r instanceof Ht&&!pn.hasOutline(r,!1)){let e=pn.createOutline(r.geometry);e.visible=!1,r.add(e),e.updateWorldMatrix(!0,!1),i.push(e)}}let n=[];return i.length>0&&(n=t.intersectObjects(i)||[],de.debug("[OSnap] Intersected with newly created edges: ",n),n.length>0&&r.push(...n)),r.sort(((e,t)=>e.distance-t.distance)),r}},Dc=class{constructor(e,t,r){this.follow=e=>{this.node.style.left=e.offsetX+15+"px",this.node.style.top=e.offsetY-30+"px"},this.show=()=>this.node.hasAttribute("hidden")&&this.node.removeAttribute("hidden"),this.hide=()=>!this.node.hasAttribute("hidden")&&this.node.setAttribute("hidden",""),this.destroy=()=>{this.target?this.target.removeEventListener("mousemove",this.follow):document.removeEventListener("mousemove",this.follow),this.parentNode.removeChild(this.node)},this.node=document.createElement("div"),this.node.id=e,t&&this.node.append(t),this.childNode=document.createElement("div"),this.target=null==r?void 0:r.target,this.parentNode=(null==r?void 0:r.parentNode)||document.body,null!=r&&r.followPointer&&(this.node.classList.add("follow-tooltip"),this.target?this.target.addEventListener("mousemove",this.follow):document.addEventListener("mousemove",this.follow)),this.parentNode.appendChild(this.node),(null==r||!r.showOnCreate)&&this.node.setAttribute("hidden","")}setContent(e){this.node.textContent&&(this.node.textContent=null);for(let e=0;e<this.node.children.length;++e){let t=this.node.children[e];this.node.removeChild(t)}this.node.append(e),this.node.appendChild(this.childNode)}updateChildContent(e){this.childNode.textContent&&(this.childNode.textContent=null);for(let e=0;e<this.node.children.length;++e){let t=this.node.children[e];this.node.removeChild(t)}this.childNode.append(e)}},II=class{constructor(e){this.active=!1,this.isResolvedOrRejected=!1,this.mouseClicked=e=>{if(e.markupData){let t=e.markupData.id,r=this.viewer.getOverlayRender().getDrawableById(t);if(r){let e=r.getBounds();e=e.clone().expandByScalar(20*this.viewer.getPixelSizeInWorldCoord());let t=Nr.world2NormalizedScreen(e.min,this.camera,this.viewerContainer),i=Nr.world2NormalizedScreen(e.max,this.camera,this.viewerContainer),n=new ts(new Te(Math.min(t.x,i.x),Math.min(t.y,i.y)),new Te(Math.max(t.x,i.x),Math.max(t.y,i.y)));n.min.x=Math.max(n.min.x,0)*this.viewerContainer.clientWidth,n.min.y=Math.max(n.min.y,0)*this.viewerContainer.clientHeight,n.max.x=Math.min(n.max.x,1)*this.viewerContainer.clientWidth,n.max.y=Math.min(n.max.y,1)*this.viewerContainer.clientHeight,this.resolve&&(this.resolve(n),this.isResolvedOrRejected=!0),this.deactivate();let a=this.viewer;"function"==typeof a.clearSelection&&a.clearSelection()}}},this.keydown=e=>{"Escape"===e.code&&this.deactivate()},this.viewer=e}get viewerContainer(){return this.viewer.viewerContainer}get camera(){return this.viewer.camera}isActive(){return this.active}activate(){var e,t;if(this.isActive())return void(this.reject&&(this.deactivate(),this.reject("PickMarkupHelper is already actived!"),this.isResolvedOrRejected=!0));this.active=!0,this.viewer.addEventListener("mouseclick",this.mouseClicked),null==(e=this.viewer.getInputManager())||e.addEventListener("keydown",this.keydown),this.tooltip=new Dc("pick-markup-tooltip",xn("Tooltip.pickMarkup"),{followPointer:!0,showOnCreate:!0,parentNode:this.viewer.widgetContainer,target:this.viewerContainer});let r=document.getElementById("pick-markup-tooltip");r&&(r.style.pointerEvents="none");let i=xn("Tooltip.pickMarkup");i&&this.tooltip&&(null==(t=this.tooltip)||t.setContent(i)),this.viewer.dispatchEvent("pickmarkupactivate")}deactivate(){var e,t,r;this.active=!1,this.viewer.removeEventListener("mouseclick",this.mouseClicked),null==(e=this.viewer.getInputManager())||e.removeEventListener("keydown",this.keydown),null==(t=this.tooltip)||t.hide(),null==(r=this.tooltip)||r.destroy(),this.tooltip=void 0,this.viewer.dispatchEvent("pickmarkupdeactivate"),this.resolve&&!this.isResolvedOrRejected&&(this.resolve(void 0),this.isResolvedOrRejected=!0)}pick(){return bt(this,null,(function*(){return new Promise(((e,t)=>{this.resolve=e,this.reject=t,this.activate()}))}))}destroy(){this.deactivate(),this.isResolvedOrRejected||this.reject&&this.reject("PickMarkupHelper is not done for some reason!")}},OI=class{constructor(e){this.mouseDown=!1,this.mouseMove=!1,this.mouseDownPositionX=-1,this.mouseDownPositionY=-1,this.tempEnableRotate=!1,this.active=!1,this.isResolvedOrRejected=!1,this.mousedown=e=>{var t,r;if(0===e.button){this.mouseDown=!0;let i=new Te(e.x,e.y);this.mouseDownPositionX=i.x,this.mouseDownPositionY=i.y,null==(t=this.tooltip)||t.hide(),null==(r=this.tooltip)||r.destroy(),this.tooltip=void 0}},this.mousemove=e=>{if(!this.mouseDown)return;let t=new Te(e.x,e.y);if(this.mouseDownPositionX>=0&&this.mouseDownPositionY>=0&&(Math.abs(t.x-this.mouseDownPositionX)>=5||Math.abs(t.y-this.mouseDownPositionY)>=5)){this.mouseMove=!0;let e=new Te(Math.min(this.mouseDownPositionX,t.x),Math.min(this.mouseDownPositionY,t.y)),r=new Te(Math.max(this.mouseDownPositionX,t.x),Math.max(this.mouseDownPositionY,t.y));this.drawRect(e,r)}},this.mouseup=e=>{if(this.mouseDown&&this.mouseMove){let t=new Te(e.x,e.y),r=new Te(Math.min(this.mouseDownPositionX,t.x),Math.min(this.mouseDownPositionY,t.y)),i=new Te(Math.max(this.mouseDownPositionX,t.x),Math.max(this.mouseDownPositionY,t.y)),n=new ts(r,i);this.resolve&&(this.resolve(n),this.isResolvedOrRejected=!0),this.deactivate(),this.setRectDomVisible(!1)}this.mouseDown=!1,this.mouseMove=!1,this.mouseDownPositionX=-1,this.mouseDownPositionY=-1},this.keydown=e=>{"Escape"===e.code&&this.deactivate()},this.viewer=e,this.input=e.getInputManager()}get viewerContainer(){return this.viewer.viewerContainer}isActive(){return this.active}activate(){var e;if(this.isActive())return void(this.reject&&(this.deactivate(),this.reject("BoxSelectHelper is already actived!"),this.isResolvedOrRejected=!0));this.active=!0,this.input.addEventListener("pointerdown",this.mousedown),this.input.addEventListener("pointermove",this.mousemove),this.input.addEventListener("pointerup",this.mouseup),this.input.addEventListener("keydown",this.keydown),this.viewer.getCameraManager().enableMouseLeft(!1),this.tooltip=new Dc("box-select-tooltip",xn("Tooltip.boxSelect"),{followPointer:!0,showOnCreate:!0,parentNode:this.viewer.widgetContainer,target:this.viewerContainer});let t=document.getElementById("box-select-tooltip");t&&(t.style.pointerEvents="none");let r=xn("Tooltip.boxSelect");r&&this.tooltip&&(null==(e=this.tooltip)||e.setContent(r)),this.viewer.dispatchEvent("boxselectactivate")}deactivate(){var e,t;this.active=!1,this.input.removeEventListener("pointerdown",this.mousedown),this.input.removeEventListener("pointermove",this.mousemove),this.input.removeEventListener("pointerup",this.mouseup),this.input.removeEventListener("keydown",this.keydown),null==(e=this.tooltip)||e.hide(),null==(t=this.tooltip)||t.destroy(),this.tooltip=void 0,this.viewer.getCameraManager().enableMouseLeft(!0),this.viewer.dispatchEvent("boxselectdeactivate"),this.resolve&&!this.isResolvedOrRejected&&(this.resolve(void 0),this.isResolvedOrRejected=!0)}drawRect(e,t){this.rectDom||(this.rectDom=document.createElement("div"),this.rectDom.style.cssText=`position: absolute;border: ${OI.BORDER_WIDTH} solid ${OI.BORDER_COLOR};`,this.viewerContainer.appendChild(this.rectDom)),this.setRectDomVisible(!0),this.rectDom.style.left=`${e.x}px`,this.rectDom.style.top=`${e.y}px`;let r=Math.abs(t.x-e.x),i=Math.abs(t.y-e.y);this.rectDom.style.width=`${r}px`,this.rectDom.style.height=`${i}px`}setRectDomVisible(e){this.rectDom&&(this.rectDom.style.display=e?"inline-block":"none")}select(){return bt(this,null,(function*(){return new Promise(((e,t)=>{this.resolve=e,this.reject=t,this.activate()}))}))}destroy(){var e;this.deactivate(),null==(e=this.rectDom)||e.remove(),this.rectDom=void 0,this.isResolvedOrRejected||this.reject&&this.reject("BoxSelectHelper is not done for some reason!")}},rm=OI;rm.BORDER_COLOR="#fff000",rm.BORDER_WIDTH="2px";var DI=class{constructor(e){this.active=!1,this.viewer=e,this.boxSelectHelper=new rm(e)}get viewerContainer(){return this.viewer.viewerContainer}get camera(){return this.viewer.camera}get raycaster(){return this.viewer.getRaycaster()}isActive(){return this.active}activate(){var e;this.active=!0,null==(e=this.boxSelectHelper)||e.select().then((e=>{e&&this.handleZoomToRect(e.min,e.max)}))}deactivate(){var e;this.active=!1,null==(e=this.boxSelectHelper)||e.deactivate()}pickPositionByScreenPoint(e){var t;return null==(t=this.viewer.pickObject(e))?void 0:t.point}handleZoomToRect(e,t){let r=this.pickPositionByScreenPoint(e),i=this.pickPositionByScreenPoint(t);if(r&&i){let e=new F(Math.min(r.x,i.x),Math.min(r.y,i.y),Math.min(r.z,i.z)),t=new F(Math.max(r.x,i.x),Math.max(r.y,i.y),Math.max(r.z,i.z)),n=new Vt(e,t);this.viewer.zoomToBBox(n)}}destroy(){var e;null==(e=this.boxSelectHelper)||e.destroy(),this.boxSelectHelper=void 0}},LI=class extends Ki{constructor(e){super("MobileHelper"),this.needsFrustumCulled=!1,this.renderOrder=1e3,this.position=e}setPosition(e){this.position=e}isPointInPath(e,t){return!1}draw(e,t){this.drawInnerCircle(e),this.drawOuterRing(e),this.drawSnapTriangle(e)}drawInnerCircle(e){let{x:t,y:r}=this.position;e.save(),e.fillStyle="rgba(137, 137, 138, 0.8)",e.beginPath(),e.arc(t,r,25,0,2*Math.PI),e.closePath(),e.fill(),e.restore()}drawOuterRing(e){let{x:t,y:r}=this.position;e.save(),e.strokeStyle="rgba(17, 17, 19, 0.8)",e.lineWidth=10,e.beginPath(),e.arc(t,r,30,0,2*Math.PI),e.closePath(),e.stroke(),e.restore(),e.save(),e.strokeStyle="rgba(173, 173, 174, 0.8)",e.lineWidth=3,e.beginPath(),e.arc(t,r,35,0,2*Math.PI),e.closePath(),e.stroke(),e.restore()}drawSnapTriangle(e){let{x:t,y:r}=this.position;e.save(),e.fillStyle="rgba(17, 17, 19, 0.8)",e.strokeStyle="rgba(137, 137, 138, 0.8)",e.lineWidth=2,e.beginPath(),e.moveTo(t-35,r-35),e.lineTo(t-35+12,r-35),e.lineTo(t-35,r-35+12),e.closePath(),e.fill(),e.stroke(),e.restore()}translate(e,t){this.position.add(new Te(e,t))}getTouchPoint(){return{x:this.position.x-35,y:this.position.y-35}}isIntersect(e){return this.position.x-35<e.x&&this.position.y-35<e.y&&this.position.x+35>e.x&&this.position.y+35>e.y}drawSelect(e,t){}getClassType(){return"MobileTouchHelperDrawable"}},mf=class extends ba{constructor(e){super(),this.enabled=!0,this.keyboardEnabled=!0,this.mouseDownPositionX=0,this.mouseDownPositionY=0,this.lastLeftPointerUpTime=0,this.pointers=[],this.handleClick=e=>{if(!this.enabled)return;let t=this.getBaseEvent(e);this.dispatchEvent("click",t)},this.handlePointerDown=e=>{if(!this.enabled)return;this.stop(e);let t=this.getBaseEvent(e);this.isDoubleClick(t)?(this.lastLeftPointerUpTime=0,this.mouseDownPositionX=-1,this.mouseDownPositionY=-1,this.dispatchEvent("dblclick",t)):(this.mouseDownPositionX=t.x,this.mouseDownPositionY=t.y),this.dispatchEvent("pointerdown",t),"touch"===e.pointerType?(this.pointers.push(t),t.pointers=this.pointers,this.dispatchEvent("touchstart",t)):this.dispatchEvent("mousedown",t)},this.handlePointerMove=e=>{if(!this.enabled)return;this.stop(e);let t=this.getBaseEvent(e);this.isCloseToLastPosition(t)||(this.dispatchEvent("pointermove",t),"touch"===e.pointerType?(this.updatePointers(t),t.pointers=this.pointers,this.dispatchEvent("touchmove",t)):this.dispatchEvent("mousemove",t))},this.handlePointerUp=e=>{if(!this.enabled)return;this.stop(e);let t=this.getBaseEvent(e);0===t.button&&(this.lastLeftPointerUpTime=t.timestamp),this.dispatchEvent("pointerup",t),"touch"===e.pointerType?(this.removePointers(t),t.pointers=this.pointers,this.dispatchEvent("touchend",t)):this.dispatchEvent("mouseup",t)},this.handlePointerCancel=e=>{this.enabled&&(this.stop(e),this.dispatchEvent("pointercancel",this.getBaseEvent(e)))},this.handleMouseWheel=e=>{this.enabled&&(this.stop(e),this.dispatchEvent("wheel",this.getBaseEvent(e)))},this.handleContextMenu=e=>{if(this.enabled)return this.stop(e),this.dispatchEvent("contextmenu",this.getBaseEvent(e)),!1},this.handlePointerEnter=e=>{this.enabled&&(this.stop(e),this.dispatchEvent("pointerenter",this.getBaseEvent(e)))},this.handlePointerLeave=e=>{this.enabled&&(this.stop(e),this.dispatchEvent("pointerleave",this.getBaseEvent(e)))},this.handleResize=e=>{this.enabled&&(this.stop(e),this.dispatchEvent("resize",this.getBaseEvent(e)))},this.handleKeydown=e=>{!this.enabled||!this.keyboardEnabled||this.dispatchEvent("keydown",this.getBaseEvent(e))},this.handleKeyup=e=>{!this.enabled||!this.keyboardEnabled||this.dispatchEvent("keyup",this.getBaseEvent(e))},this.style={},this.element=e,this.bindEvents()}getEnabled(){return this.enabled}setEnabled(e){this.enabled=e}getkKeyboardEnabled(){return this.keyboardEnabled}setkKeyboardEnabled(e){this.keyboardEnabled=e}setCursor(e){this.element.style&&(this.element.style.cursor=e||"default")}bindEvents(){this.element.style.touchAction="none",this.element.style.userSelect="none",this.element.style.webkitUserSelect="none",this.element.addEventListener("click",this.handleClick),this.element.addEventListener("pointerdown",this.handlePointerDown),this.element.addEventListener("pointermove",this.handlePointerMove),this.element.addEventListener("pointerup",this.handlePointerUp),this.element.addEventListener("pointercancel",this.handlePointerCancel),this.element.addEventListener("pointerenter",this.handlePointerEnter),this.element.addEventListener("pointerleave",this.handlePointerLeave),this.element.addEventListener("contextmenu",this.handleContextMenu),this.element.addEventListener("wheel",this.handleMouseWheel),window.addEventListener("resize",this.handleResize),window.addEventListener("keydown",this.handleKeydown),window.addEventListener("keyup",this.handleKeyup)}unBindEvents(){this.element.removeEventListener("pointerdown",this.handlePointerDown),this.element.removeEventListener("pointermove",this.handlePointerMove),this.element.removeEventListener("pointerup",this.handlePointerUp),this.element.removeEventListener("pointerenter",this.handlePointerEnter),this.element.removeEventListener("pointerleave",this.handlePointerLeave),this.element.removeEventListener("contextmenu",this.handleContextMenu),this.element.removeEventListener("wheel",this.handleMouseWheel),window.removeEventListener("resize",this.handleResize),window.removeEventListener("keydown",this.handleKeydown),window.removeEventListener("keyup",this.handleKeyup),this.element.style.touchAction="",this.element.style.userSelect="",this.element.style.webkitUserSelect=""}getBaseEvent(e){let t={x:0,y:0,pageX:0,pageY:0,clientX:0,clientY:0,deltaX:0,deltaY:0,movementX:0,movementY:0,deltaMode:0,pointerId:0,timestamp:0,buttons:0,pointerType:"mouse",altKey:!1,ctrlKey:!1,shiftKey:!1,metaKey:!1,originalEvent:e};if(t.timestamp=e.timeStamp,kI(e,"clientX"))if(t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.clientX=e.clientX,t.clientY=e.clientY,t.button=e.button,kI(e,"pointerId")){t.pointerType=e.pointerType,t.buttons=e.buttons,t.pageX=e.pageX,t.pageY=e.pageY,t.pointerId=e.pointerId;let r=Nr.getScreenCoordinateByEvent(e,this.element);t.x=r.x,t.y=r.y,t.movementX=e.movementX,t.movementY=e.movementY}else kI(e,"deltaX")&&(t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY);else kI(e,"code")&&(t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.metaKey=e.metaKey,t.code=e.code);return t}stop(e){e.preventDefault()}updatePointers(e){for(let t=0;t<this.pointers.length;t++)if(e.pointerId==this.pointers[t].pointerId){this.pointers[t]=e;break}}removePointers(e){for(let t=0;t<this.pointers.length;t++)if(this.pointers[t].pointerId==e.pointerId){this.pointers.splice(t,1);break}}getBoundingClientRect(){return this.element.getBoundingClientRect()}isCloseToLastPosition(e){return-1!==this.mouseDownPositionX&&-1!==this.mouseDownPositionY&&(Math.abs(e.x-this.mouseDownPositionX)<5&&Math.abs(e.y-this.mouseDownPositionY)<5)}isDoubleClick(e){let t=e.timestamp-this.lastLeftPointerUpTime;return!!(0===e.button&&t<300&&this.isCloseToLastPosition(e))}};function kI(e,t){return void 0!==e[t]}function FI(e){return(new TextDecoder).decode(e)}function IG(e,t){return((255&e)<<24)+(16777215&t)}function N_e(e){return e[3]}function U_e(e){return(e[0]<<16)+(e[1]<<8)+e[2]}function BI(e){let t=(1<<8*e.BYTES_PER_ELEMENT-1)-1,r=e.length/2,i=new Te,n=new F,a=new Float32Array(3*r);for(let s=0;s<r;s++)i.fromArray(e,2*s),or.OctDecode(i,n,t),n.toArray(a,3*s);return a}var ub=class{constructor(e){this.CLEAR_COLOR=(new dt).setRGB(1,1,1),this.CLEAR_COLOR_ALPHA=1,this.EMPTY_MODEL_ID=255,this.viewer=e,this.raycaster=new vu,this.pickingTexture=new yn(1,1)}get scene(){return this.viewer.scene}get camera(){return this.viewer.camera}get renderer(){return this.viewer.renderer}get overlayRender(){return this.viewer.getOverlayRender()}get viewerContainer(){return this.viewer.viewerContainer}getRaycaster(){return this.raycaster}pickObjectsByNdc(e,t,r){return t&&0!==t.length?(this.raycaster.setFromCamera(e,this.camera),this.setLayerChannels(r),this.raycaster.intersectObjects(t,!0)||[]):[]}pickObject(e,t,r){let i=this.pickObjects(e,t,r);if(0!==i.length)return i[0]}pickObjects(e,t,r){let i=Nr.screen2Ndc(e,this.camera,this.viewerContainer);return this.pickObjectsByNdc(i,t,r)}pickDrawable(e){return this.overlayRender.getDrawablesByPosition(e)}pick(e,t){let r=this.pickBuffer(e,t),i=[r[0],r[1],r[2],r[3]],n=N_e(i),a=U_e(i);if(n!==this.EMPTY_MODEL_ID)return de.info(`[PickMgr] Picked: tilesetId(${n}), userId(${a})`),{tilesetId:n,userId:a}}setLayerChannels(e){e&&e.length>0?(this.raycaster.layers.disableAll(),e.forEach((e=>{this.raycaster.layers.enable(e)}))):this.raycaster.layers.enableAll()}pickBuffer(e,t,r=1,i=1){let{pickingTexture:n,renderer:a,camera:s}=this;n.setSize(r,i);let o=a.getPixelRatio(),l=a.getContext().drawingBufferWidth,h=a.getContext().drawingBufferHeight,c=e.x*o|0,u=e.y*o|0;s.setViewOffset(l,h,c,u,r,i),a.setRenderTarget(n);let d=new dt;a.getClearColor(d);let p=a.getClearAlpha();a.setClearColor(this.CLEAR_COLOR,this.CLEAR_COLOR_ALPHA),a.render(t,s);let f=new Uint8Array(4*r*i);return a.readRenderTargetPixels(n,0,0,r,i,f),a.setRenderTarget(null),s.clearViewOffset(),a.setClearColor(d,p),f}},H_e=new F,NI=class{constructor(e){this.viewer=e;let t=new Xi;t.matrixAutoUpdate=!1,t.matrixWorldAutoUpdate=!1,this.scene=t,this.modelGroup=new Xr,this.modelGroup.name="models",this.scene.add(this.modelGroup);let{width:r,height:i,viewerContainer:n}=e.container,a=new Ka({antialias:!0,preserveDrawingBuffer:!0});a.setPixelRatio(window.devicePixelRatio),a.setSize(r,i),a.outputColorSpace=Zr,a.toneMappingExposure=1,a.localClippingEnabled=!0,a.shadowMap.enabled=!1,a.shadowMap.type=a1,a.shadowMap.autoUpdate=!1,a.domElement.style.outlineWidth="0",null==n||n.appendChild(a.domElement),this.renderer=a,Ut.printGpuInfo(a.getContext())}initLights(){let e=new Xr;e.name="lights";let t=16777215,r=new ya(t,1.5);r.name="sun",r.castShadow=!0,r.position.set(-2,2,4),r.shadow.autoUpdate=!1,r.shadow.mapSize.width=1024,r.shadow.mapSize.height=1024;let i=new $o(t);i.name="ambient";let n=new Mh(t,14540253,.2);n.name="hemisphere",n.position.set(0,300,0);let a=new Xr;a.name="lightHelpers",a.visible=!1;let s=new i1(r),o=new s1(r.shadow.camera);return a.add(s),a.add(o),e.add(r),e.add(r.target),e.add(i),e.add(n),e.add(a),this.scene.add(e),this.lights=e,e}initPMREMGenerator(){this.pmremGenerator=new Wd(this.renderer),this.pmremGenerator.compileEquirectangularShader()}get maxFragmentUniforms(){return this.renderer.capabilities.maxFragmentUniforms-20}addModel(e){this.modelGroup.add(e.getModelObject())}enableShadow(e){this.renderer.shadowMap.enabled=e,this.directionalLight.castShadow=e,e&&(this.tryAdjustDirectionalLight(),this.updateDirectionalLightShadow()),this.modelGroup.traverse((t=>{t.isMesh&&(t.castShadow=e,t.receiveShadow=e)}))}enableClipping(e){this.renderer.localClippingEnabled=e}setClipPlanes(e){this.renderer.clippingPlanes=e}enableLights(e){let t=this.lights;t||(t=this.initLights()),t.visible=e}debugLights(e){!this.lights||!this.lightHelpers||(this.lightHelpers.visible=e)}setBackground(e){this.scene.background=e}get directionalLight(){var e;return null==(e=this.lights)?void 0:e.getObjectByName("sun")}get ambientLight(){var e;return null==(e=this.lights)?void 0:e.getObjectByName("ambient")}get hemisphereLight(){var e;return null==(e=this.lights)?void 0:e.getObjectByName("hemisphere")}get lightHelpers(){var e;return null==(e=this.lights)?void 0:e.getObjectByName("lightHelpers")}get directionalLightHelper(){var e;let t;for(let r=0;this.lightHelpers&&r<(null==(e=this.lightHelpers)?void 0:e.children.length);++r){let e=this.lightHelpers.children[r];if(e instanceof i1){t=e;break}}return t}get cameraHelper(){var e;let t;for(let r=0;this.lightHelpers&&r<(null==(e=this.lightHelpers)?void 0:e.children.length);++r){let e=this.lightHelpers.children[r];e instanceof s1&&(t=e)}return t}setEnvironmentFromData(e){return bt(this,null,(function*(){this.pmremGenerator||this.initPMREMGenerator();let t=yield kp.createEnvTextureFromDataArray(this.pmremGenerator,e);this.scene.environment=t}))}setEnvironment(e){return bt(this,null,(function*(){this.pmremGenerator||this.initPMREMGenerator();let t=yield kp.createEnvTexture(this.pmremGenerator,e);this.scene.environment&&this.scene.environment.dispose(),this.scene.environment=t}))}resize(){let{width:e,height:t}=this.viewer.container;this.renderer.setSize(e,t)}getRaycastableObjects(){let e=[];return this.modelGroup.traverse((t=>{e.push(t)})),e}tryAdjustDirectionalLight(){let e=this.directionalLight;if(!e)return;let t=this.viewer.getBBox(),r=new Sn;t.getBoundingSphere(r);let i=r.center,n=r.radius,a=e.shadow.camera;a.zoom=1,a.top=n,a.bottom=-n,a.right=n,a.left=-n,a.near=.1,a.far=2*n,a.updateProjectionMatrix();let s=new F(-1,-.5,1);s.normalize().multiplyScalar(n),e.position.copy(i).addScaledVector(s,-1),e.target.position.copy(i),de.debug("[Scene] directionalLight.position",e.position),de.debug("[Scene] directionalLight.target.position",e.target.position),this.updateDirectionalLight(),this.viewer.enableRender()}updateDirectionalLight(){var e,t;let r=this.directionalLight;if(r&&(r.updateMatrixWorld(),r.target.updateMatrixWorld(),this.directionalLightHelper&&(this.directionalLightHelper.update(),!(null!=(e=this.scene)&&e.matrixAutoUpdate)&&this.directionalLightHelper.updateWorldMatrix(!1,!0)),r.shadow.needsUpdate=!0,r.shadow.camera.updateProjectionMatrix(),this.cameraHelper&&(this.cameraHelper.update(),null==(t=this.scene)||!t.matrixAutoUpdate))){let e=r.shadow.camera;e.position.setFromMatrixPosition(r.matrixWorld),H_e.setFromMatrixPosition(r.target.matrixWorld),e.lookAt(H_e),e.updateMatrixWorld(),this.cameraHelper.updateWorldMatrix(!1,!0)}}updateDirectionalLightShadow(){this.directionalLight&&(this.directionalLight.shadow.needsUpdate=!0)}showDirectionalLightHelper(e){this.directionalLightHelper&&(this.directionalLightHelper.visible=e),this.cameraHelper&&(this.cameraHelper.visible=e)}destroy(){var e,t,r,i,n,a,s;null==(e=this.lightHelpers)||e.clear(),null==(t=this.lightHelpers)||t.removeFromParent(),null==(r=this.lightHelpers)||r.traverse((e=>{var t;null==(t=e.dispose)||t.call(e)})),null==(i=this.lights)||i.clear(),null==(n=this.lights)||n.removeFromParent(),null==(a=this.lights)||a.traverse((e=>{var t;null==(t=e.dispose)||t.call(e)})),this.lights=void 0,null==(s=this.pmremGenerator)||s.dispose(),this.renderer.domElement.remove(),this.renderer.clear(),this.renderer.dispose(),this.renderer.forceContextLoss(),this.scene.clear()}},UI=class{constructor(e){this.history=[],this.step=0,this.maxCount=50,this.isBatchCommand=!1,this.batchCommands=[],this.maxCount=e||this.maxCount}addCommand(e){this.isBatchCommand?this.batchCommands.push(e):(this.history.length===this.maxCount&&this.history.shift(),this.step!==this.history.length&&this.history.splice(this.step),this.history.push(e),this.step++)}startTransaction(){this.isBatchCommand=!0}endTransaction(){this.history.length===this.maxCount&&this.history.shift(),this.step!==this.history.length&&this.history.splice(this.step),this.batchCommands.length>0&&(this.history.push(this.batchCommands.slice()),this.step++),this.isBatchCommand=!1,this.batchCommands=[]}undo(){if(this.canUndo())return!1;this.step--;let e=this.history[this.step];return e&&(Array.isArray(e)?e.forEach((e=>e.undo())):e.undo()),!0}redo(){if(this.canRedo())return!1;this.step++;let e=this.history[this.step-1];return e&&(Array.isArray(e)?e.forEach((e=>e.redo())):e.redo()),!0}getCommands(){return this.history}canUndo(){return this.step<=0}canRedo(){return this.step>=this.history.length}clear(){this.history=[],this.step=0}destroy(){this.clear(),this.maxCount=0}},Tw=class extends Ec{constructor(e,t){super("AddMeasurement"),this.manager=e,this.data=t}undo(){let e=this.manager.getById(this.data.id);return!!e&&(this.manager.remove(e),!0)}redo(){let e=this.manager.create(this.data);return!!e&&(this.manager.add(e),!0)}},HI=class extends Ec{constructor(e,t){super("RemoveMeasurement"),this.manager=e,this.data=t}undo(){let e=this.manager.create(this.data);return!!e&&(this.manager.add(e),!0)}redo(){let e=this.manager.getById(this.data.id);return!!e&&(this.manager.remove(e),!0)}},nm=class extends ba{constructor(e){super(),this.name="BaseViewer",this.clock=new mc,this.targetMaxFps=60,this.timeStamp=0,this.renderEnabled=!0,this.plugins=[],this.loadedModels=[],this.raf=new K1,this._enableSelection=!0,this.enableRender=(e=1e3)=>{this.renderEnabled=!0,this.raf&&(this.timeoutSymbol&&this.raf.clearTimeout(this.timeoutSymbol),this.timeoutSymbol=this.raf.setTimeout((()=>{this.renderEnabled=!1}),e))},this.viewerCfg=e,this.initLogLevel(),this.initLocalization(),this.container=new L1(e.containerId),e.enableProgressBar&&(this.progressBar=new k1(this.container)),this.spinner=new o3(this.container),this.sceneManager=new NI(this),this.pickManager=new ub(this),this.overlayRender=new Jr(this),this.css2dRenderer=this.initCSS2DRenderer(),this.inputManager=new mf(this.viewerContainer),this.cameraManager=new g3(this),this.loaderHelper=new Lu,this.undoManager=new UI,this.resize(),this.clock.start(),this.animate()}initLogLevel(){let e=this.viewerCfg.logLevel;e&&rye(e)}initLocalization(){var e;let t=(null==(e=this.viewerCfg)?void 0:e.language)||"cn";return a0.init({lng:t,debug:!1,resources:{en:{translation:Nye},cn:{translation:Uye}}}),a0.t}get viewerContainer(){return this.container.viewerContainer}get widgetContainer(){return this.container.widgetContainer}getUndoManager(){return this.undoManager}getInputManager(){return this.inputManager}getCameraManager(){return this.cameraManager}getOverlayRender(){return this.overlayRender}get renderer(){return this.sceneManager.renderer}get camera(){return this.cameraManager.camera}get scene(){return this.sceneManager.scene}getRaycaster(){return this.pickManager.getRaycaster()}getViewerConfig(){return this.viewerCfg}getSpinner(){return this.spinner}getFontManager(){return this.fontManager}initCSS2DRenderer(){var e;let t=new M1,{width:r,height:i}=this.viewerContainer.getBoundingClientRect();return t.setSize(r,i),t.domElement.style.height="0",t.domElement.style.width="0",t.domElement.style.position="absolute",t.domElement.style.top="0",t.domElement.style.left="0",t.domElement.style.overflow="visible",t.domElement.classList.add("css2d-renderer"),null==(e=this.viewerContainer)||e.appendChild(t.domElement),t}animate(){if(Date.now()-this.timeStamp<1/this.targetMaxFps)return void(this.requestAnimationFrameHandle=requestAnimationFrame(this.animate.bind(this)));let e=this.cameraManager.update(this.clock.getDelta());this.container.needResize&&(this.resize(),this.renderEnabled=!0),(this.renderEnabled||e)&&(this.dispatchEvent("beforerender"),this.renderer.render(this.scene,this.camera),this.css2dRenderer.render(this.scene,this.camera),this.dispatchEvent("afterrender"),this.renderEnabled=!1),this.requestAnimationFrameHandle=requestAnimationFrame(this.animate.bind(this)),this.timeStamp=Date.now(),this.dispatchEvent("onanimate")}resize(){this.sceneManager.resize(),this.cameraManager.updateAspect();let{clientWidth:e,clientHeight:t}=this.viewerContainer;this.css2dRenderer.setSize(e,t),this.overlayRender.setSize(e,t)}setDracoDecoderPath(e){Lu.setDracoDecoderPath(e)}addModel(e){let t=e.getModelObject();t.name=e.modelId,this.sceneManager.addModel(e),t.matrixAutoUpdate=!1,t.updateMatrix(),t.updateMatrixWorld(!0),this.loadedModels.push(e),this.enableRender(0)}setFont(e){return bt(this,null,(function*(){this.fontManager||(this.fontManager=new kl),yield this.fontManager.loadFonts(e)}))}is3d(){return!1}getPixelSizeInWorldCoord(){let e=this.camera,{clientWidth:t,clientHeight:r}=this.viewerContainer,i=1;if("OrthographicCamera"===e.type){let n=e;i=Math.max(n.right-n.left,n.top-n.bottom)/n.zoom/Math.max(t,r)}else if("PerspectiveCamera"===e.type){let t=e,n=new F;e.getWorldPosition(n);let a=this.cameraManager.getTarget();n&&a&&(i=n.distanceTo(a)*Math.tan(t.fov/2*Math.PI/180)*2/r)}return i}zoomToRect(){this.zoomToRectHelper||(this.zoomToRectHelper=new DI(this)),this.zoomToRectHelper.activate()}deactivateZoomRect(){var e;null==(e=this.zoomToRectHelper)||e.deactivate()}getUniqueModelId(e){let t=e,r=e=>!!this.loadedModels.find((t=>t.modelId===e));if(r(t)){let e=1;for(;r(`${t}_${e}`);)e++;t=`${t}_${e}`,de.warn(`[Viewer] Model '${t}' is loaded more than once!`)}return t}getBBox(){let e=new Vt;return this.loadedModels.forEach((t=>{e.union(t.getBBox())})),e}flyToObject(e){this.cameraManager.flyToObject(e)}flyToObjects(e){let t=new Vt;e.forEach((e=>{let r=(new Vt).setFromObject(e);t.union(r)}));let r=new Sn;t.getBoundingSphere(r),this.cameraManager.fitToSphere(r)}flyTo(e,t){let r=this.camera;if(e.equals(t))return void de.error("[Viewer] camera position and lookAt cannot be the same!");if(!Ut.isVectorValid(e)||!Ut.isVectorValid(t))return void de.error("[Viewer] invalid position or lookAt!");let i=e.distanceTo(t);i<r.near?(e=e.clone().sub(t).normalize().multiplyScalar(1.1*r.near),de.warn("[Viewer] camera could be too close to see the object!")):i>r.far&&(e=e.clone().sub(t).normalize().multiplyScalar(.9*r.far),de.warn("[Viewer] camera could be too far to see the object!")),this.cameraManager.flyTo(e,t)}flyToDirection(e){let t=this.getBBox(),r=t.getSize(new F),i=Math.max(r.x,r.y,r.z)/2;0===i&&(i=1);let n=this.cameraManager.getDistanceToFitSphere(i),a=new F;t.getCenter(a);let s=a.clone().add(e.clone().multiplyScalar(n));this.flyTo(s,a)}goToHomeView(){if(this.homeView)this.cameraManager.flyToViewpoint(this.homeView);else{let e=new F(1,.5,1);this.flyToDirection(e)}}viewFitAll(){let e=this.getBBox(),t=new Sn;e.getBoundingSphere(t),this.cameraManager.fitToSphere(t)}zoomToBBox(e){this.cameraManager.flyToBox(e)}pickObject(e,t){var r;let i=this.pickManager.pickObject(e,this.getRaycastableObjects(),t);return this.renderer&&this.renderer.clippingPlanes.length>0&&null!=(r=this.renderer)&&r.clippingPlanes.every((e=>{i&&e.distanceToPoint(i.point)}))&&(i=void 0),i}pickObjects(e,t){let r=this.pickManager.pickObjects(e,this.getRaycastableObjects(),t);return r&&this.renderer.clippingPlanes.length>0&&(r=r.filter((e=>this.renderer.clippingPlanes.every((function(t){return t.distanceToPoint(e.point)>0}))))),r}getRaycastableObjects(){return this.sceneManager.getRaycastableObjects()}setBackgroundColor(e,t,r){if(this.scene.background||(this.scene.background=new dt(e,t,r)),this.scene.background instanceof dt){let i=new dt;i.setRGB(e,t,r,this.renderer.outputColorSpace),this.scene.background.copy(i)}this.enableRender()}setGlobalClipPlanes(e){}getCameraProjection(){return this.cameraManager.getProjection()}setCameraProjection(e){this.cameraManager.setProjection(e)}enableControl(e){this.cameraManager.enableControl(e)}enableRotate(e){this.cameraManager.enableRotate=e}enableZoom(e){this.cameraManager.enableZoom(e)}enablePan(e){this.cameraManager.enablePan(e)}getHomeView(){return this.homeView}setHomeView(e){this.homeView=e}getCameraConfig(){return this.cameraManager.getCameraConfig()}setCameraConfig(e){return this.cameraManager.setCameraConfig(e)}getCameraDirection(){return this.cameraManager.getCameraDirection()}getRenderInfo(){var e;let t=this.renderer.info;return{drawCalls:t.render.calls,lines:t.render.lines,points:t.render.points,triangles:t.render.triangles,geometries:t.memory.geometries,textures:t.memory.textures,materials:(null==(e=t.programs)?void 0:e.length)||0}}destroy(){var e;this.requestAnimationFrameHandle&&cancelAnimationFrame(this.requestAnimationFrameHandle),this.css2dRenderer.domElement.remove(),this.container.destroy(),this.sceneManager.destroy(),this.cameraManager.destroy(),this.overlayRender.destroy(),this.spinner.destroy(),null==(e=this.progressBar)||e.destroy(),this.undoManager.destroy()}addPlugin(e){this.plugins.find((t=>t.id===e.id))?de.warn(`[Viewer] Plugin already exist: ${e.id}`):(this.plugins.push(e),de.debug(`[Viewer] Added plugin: ${e.id}`))}removePlugin(e){for(let t=0,r=this.plugins.length;t<r;t++)if(this.plugins[t]===e)return void this.plugins.splice(t,1)}clearPlugins(){this.plugins=[]}findPlugin(e){return this.plugins.find((t=>t.id===e))}},ww=new F,Sw=new F,V_e=new Wr,VI=class extends Wn{constructor(e,t=1,r=16711680){let i=new Nt,n=e.geometry.attributes.normal.count,a=new zt(2*n*3,3);i.setAttribute("position",a),super(i,new Yr({color:r,toneMapped:!1})),this.object=e,this.size=t,this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0),V_e.getNormalMatrix(this.object.matrixWorld);let e=this.object.matrixWorld,t=this.geometry.attributes.position,r=this.object.geometry;if(r){let i=r.attributes.position,n=r.attributes.normal,a=0;for(let r=0,s=i.count;r<s;r++)ww.fromBufferAttribute(i,r).applyMatrix4(e),Sw.fromBufferAttribute(n,r),Sw.applyMatrix3(V_e).normalize().multiplyScalar(this.size).add(ww),t.setXYZ(a,ww.x,ww.y,ww.z),a+=1,t.setXYZ(a,Sw.x,Sw.y,Sw.z),a+=1}t.needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},Gs=class{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}},wAt=new Gi(-1,1,1,-1,0,1),OG=class extends Nt{constructor(){super(),this.setAttribute("position",new zt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new zt([0,2,0,0,2,0],2))}},SAt=new OG,io=class{constructor(e){this._mesh=new Ht(SAt,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,wAt)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}},DG={name:"ConvolutionShader",defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new Te(.001953125,0)},cKernel:{value:[]}},vertexShader:"\n\n\t\tuniform vec2 uImageIncrement;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float cKernel[ KERNEL_SIZE_INT ];\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec2 uImageIncrement;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec2 imageCoord = vUv;\n\t\t\tvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\n\n\t\t\tfor( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {\n\n\t\t\t\tsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];\n\t\t\t\timageCoord += uImageIncrement;\n\n\t\t\t}\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}",buildKernel:function(e){let t=2*Math.ceil(3*e)+1;t>25&&(t=25);let r=.5*(t-1),i=new Array(t),n=0;for(let a=0;a<t;++a)i[a]=MAt(a-r,e),n+=i[a];for(let e=0;e<t;++e)i[e]/=n;return i}};function MAt(e,t){return Math.exp(-e*e/(2*t*t))}var Gh=class extends Gs{constructor(e=1,t=25,r=4){super(),this.renderTargetX=new yn(1,1,{type:Cn}),this.renderTargetX.texture.name="BloomPass.x",this.renderTargetY=new yn(1,1,{type:Cn}),this.renderTargetY.texture.name="BloomPass.y",this.combineUniforms=xi.clone(zI.uniforms),this.combineUniforms.strength.value=e,this.materialCombine=new xr({name:zI.name,uniforms:this.combineUniforms,vertexShader:zI.vertexShader,fragmentShader:zI.fragmentShader,blending:du,transparent:!0});let i=DG;this.convolutionUniforms=xi.clone(i.uniforms),this.convolutionUniforms.uImageIncrement.value=Gh.blurX,this.convolutionUniforms.cKernel.value=DG.buildKernel(r),this.materialConvolution=new xr({name:i.name,uniforms:this.convolutionUniforms,vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,defines:{KERNEL_SIZE_FLOAT:t.toFixed(1),KERNEL_SIZE_INT:t.toFixed(0)}}),this.needsSwap=!1,this.fsQuad=new io(null)}render(e,t,r,i,n){n&&e.state.buffers.stencil.setTest(!1),this.fsQuad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=r.texture,this.convolutionUniforms.uImageIncrement.value=Gh.blurX,e.setRenderTarget(this.renderTargetX),e.clear(),this.fsQuad.render(e),this.convolutionUniforms.tDiffuse.value=this.renderTargetX.texture,this.convolutionUniforms.uImageIncrement.value=Gh.blurY,e.setRenderTarget(this.renderTargetY),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCombine,this.combineUniforms.tDiffuse.value=this.renderTargetY.texture,n&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(r),this.clear&&e.clear(),this.fsQuad.render(e)}setSize(e,t){this.renderTargetX.setSize(e,t),this.renderTargetY.setSize(e,t)}dispose(){this.renderTargetX.dispose(),this.renderTargetY.dispose(),this.materialCombine.dispose(),this.materialConvolution.dispose(),this.fsQuad.dispose()}},zI={name:"CombineShader",uniforms:{tDiffuse:{value:null},strength:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float strength;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = strength * texel;\n\n\t\t}"};Gh.blurX=new Te(.001953125,0),Gh.blurY=new Te(0,.001953125);var so={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\n\t\t}"},hb=class extends Gs{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof xr?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=xi.clone(e.uniforms),this.material=new xr({name:void 0!==e.name?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new io(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}},Mw=class extends Gs{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){let i,n,a=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0),this.inverse?(i=0,n=1):(i=1,n=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),s.buffers.stencil.setFunc(a.ALWAYS,i,4294967295),s.buffers.stencil.setClear(n),s.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(a.EQUAL,1,4294967295),s.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),s.buffers.stencil.setLocked(!0)}},GI=class extends Gs{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}},qI=class{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),void 0===t){let r=e.getSize(new Te);this._width=r.width,this._height=r.height,(t=new yn(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Cn})).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new hb(so),this.copyPass.material.blending=Oi,this.clock=new mc}swapBuffers(){let e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){let t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());let t=this.renderer.getRenderTarget(),r=!1;for(let t=0,i=this.passes.length;t<i;t++){let i=this.passes[t];if(!1!==i.enabled){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),i.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),i.needsSwap){if(r){let t=this.renderer.getContext(),r=this.renderer.state.buffers.stencil;r.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),r.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==Mw&&(i instanceof Mw?r=!0:i instanceof GI&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){let t=this.renderer.getSize(new Te);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;let r=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(r,i),this.renderTarget2.setSize(r,i);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(r,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}},ku=class extends Gs{constructor(e,t,r,i){super(),this.renderScene=t,this.renderCamera=r,this.selectedObjects=void 0!==i?i:[],this.visibleEdgeColor=new dt(1,1,1),this.hiddenEdgeColor=new dt(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this.resolution=void 0!==e?new Te(e.x,e.y):new Te(256,256);let n=Math.round(this.resolution.x/this.downSampleRatio),a=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new yn(this.resolution.x,this.resolution.y),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new Yd,this.depthMaterial.side=ln,this.depthMaterial.depthPacking=W2,this.depthMaterial.blending=Oi,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=ln,this.prepareMaskMaterial.fragmentShader=function(e,t){let r=t.isPerspectiveCamera?"perspective":"orthographic";return e.replace(/DEPTH_TO_VIEW_Z/g,r+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new yn(this.resolution.x,this.resolution.y,{type:Cn}),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new yn(n,a,{type:Cn}),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new yn(n,a,{type:Cn}),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new yn(Math.round(n/2),Math.round(a/2),{type:Cn}),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new yn(n,a,{type:Cn}),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new yn(Math.round(n/2),Math.round(a/2),{type:Cn}),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value.set(n,a),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(n/2),Math.round(a/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial();let s=so;this.copyUniforms=xi.clone(s.uniforms),this.materialCopy=new xr({uniforms:this.copyUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,blending:Oi,depthTest:!1,depthWrite:!1}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new dt,this.oldClearAlpha=1,this.fsQuad=new io(null),this.tempPulseColor1=new dt,this.tempPulseColor2=new dt,this.textureMatrix=new lt}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose(),this.depthMaterial.dispose(),this.prepareMaskMaterial.dispose(),this.edgeDetectionMaterial.dispose(),this.separableBlurMaterial1.dispose(),this.separableBlurMaterial2.dispose(),this.overlayMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}setSize(e,t){this.renderTargetMaskBuffer.setSize(e,t),this.renderTargetDepthBuffer.setSize(e,t);let r=Math.round(e/this.downSampleRatio),i=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(r,i),this.renderTargetBlurBuffer1.setSize(r,i),this.renderTargetEdgeBuffer1.setSize(r,i),this.separableBlurMaterial1.uniforms.texSize.value.set(r,i),r=Math.round(r/2),i=Math.round(i/2),this.renderTargetBlurBuffer2.setSize(r,i),this.renderTargetEdgeBuffer2.setSize(r,i),this.separableBlurMaterial2.uniforms.texSize.value.set(r,i)}changeVisibilityOfSelectedObjects(e){let t=this._visibilityCache;function r(r){r.isMesh&&(!0===e?r.visible=t.get(r):(t.set(r,r.visible),r.visible=e))}for(let e=0;e<this.selectedObjects.length;e++)this.selectedObjects[e].traverse(r)}changeVisibilityOfNonSelectedObjects(e){let t=this._visibilityCache,r=[];function i(e){e.isMesh&&r.push(e)}for(let e=0;e<this.selectedObjects.length;e++)this.selectedObjects[e].traverse(i);this.renderScene.traverse((function(i){if(i.isMesh||i.isSprite){let n=!1;for(let e=0;e<r.length;e++)if(r[e].id===i.id){n=!0;break}if(!1===n){let r=i.visible;(!1===e||!0===t.get(i))&&(i.visible=e),t.set(i,r)}}else(i.isPoints||i.isLine)&&(!0===e?i.visible=t.get(i):(t.set(i,i.visible),i.visible=e))}))}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(e,t,r,i,n){if(this.selectedObjects.length>0){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();let t=e.autoClear;e.autoClear=!1,n&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);let i=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=i,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){let e=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(e),this.tempPulseColor2.multiplyScalar(e)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=ku.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=ku.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=ku.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=ku.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,n&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(r),this.fsQuad.render(e),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=t}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=r.texture,e.setRenderTarget(null),this.fsQuad.render(e))}getPrepareMaskMaterial(){return new xr({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new Te(.5,.5)},textureMatrix:{value:null}},vertexShader:"#include <morphtarget_pars_vertex>\n\t\t\t\t#include <skinning_pars_vertex>\n\n\t\t\t\tvarying vec4 projTexCoord;\n\t\t\t\tvarying vec4 vPosition;\n\t\t\t\tuniform mat4 textureMatrix;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <morphtarget_vertex>\n\t\t\t\t\t#include <skinning_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t\tvPosition = mvPosition;\n\n\t\t\t\t\tvec4 worldPosition = vec4( transformed, 1.0 );\n\n\t\t\t\t\t#ifdef USE_INSTANCING\n\n\t\t\t\t\t\tworldPosition = instanceMatrix * worldPosition;\n\n\t\t\t\t\t#endif\n\t\t\t\t\t\n\t\t\t\t\tworldPosition = modelMatrix * worldPosition;\n\n\t\t\t\t\tprojTexCoord = textureMatrix * worldPosition;\n\n\t\t\t\t}",fragmentShader:"#include <packing>\n\t\t\t\tvarying vec4 vPosition;\n\t\t\t\tvarying vec4 projTexCoord;\n\t\t\t\tuniform sampler2D depthTexture;\n\t\t\t\tuniform vec2 cameraNearFar;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tfloat depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));\n\t\t\t\t\tfloat viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );\n\t\t\t\t\tfloat depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;\n\t\t\t\t\tgl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);\n\n\t\t\t\t}"})}getEdgeDetectionMaterial(){return new xr({uniforms:{maskTexture:{value:null},texSize:{value:new Te(.5,.5)},visibleEdgeColor:{value:new F(1,1,1)},hiddenEdgeColor:{value:new F(1,1,1)}},vertexShader:"varying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\n\t\t\t\tuniform sampler2D maskTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec3 visibleEdgeColor;\n\t\t\t\tuniform vec3 hiddenEdgeColor;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tvec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\n\t\t\t\t\tvec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\n\t\t\t\t\tvec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\n\t\t\t\t\tvec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\n\t\t\t\t\tvec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\n\t\t\t\t\tfloat diff1 = (c1.r - c2.r)*0.5;\n\t\t\t\t\tfloat diff2 = (c3.r - c4.r)*0.5;\n\t\t\t\t\tfloat d = length( vec2(diff1, diff2) );\n\t\t\t\t\tfloat a1 = min(c1.g, c2.g);\n\t\t\t\t\tfloat a2 = min(c3.g, c4.g);\n\t\t\t\t\tfloat visibilityFactor = min(a1, a2);\n\t\t\t\t\tvec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\n\t\t\t\t\tgl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\n\t\t\t\t}"})}getSeperableBlurMaterial(e){return new xr({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new Te(.5,.5)},direction:{value:new Te(.5,.5)},kernelRadius:{value:1}},vertexShader:"varying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float kernelRadius;\n\n\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\n\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\n\t\t\t\t\tfloat sigma = kernelRadius/2.0;\n\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, sigma);\n\t\t\t\t\tvec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;\n\t\t\t\t\tvec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\n\t\t\t\t\tvec2 uvOffset = delta;\n\t\t\t\t\tfor( int i = 1; i <= MAX_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = kernelRadius * float(i) / float(MAX_RADIUS);\n\t\t\t\t\t\tfloat w = gaussianPdf(x, sigma);\n\t\t\t\t\t\tvec4 sample1 = texture2D( colorTexture, vUv + uvOffset);\n\t\t\t\t\t\tvec4 sample2 = texture2D( colorTexture, vUv - uvOffset);\n\t\t\t\t\t\tdiffuseSum += ((sample1 + sample2) * w);\n\t\t\t\t\t\tweightSum += (2.0 * w);\n\t\t\t\t\t\tuvOffset += delta;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = diffuseSum/weightSum;\n\t\t\t\t}"})}getOverlayMaterial(){return new xr({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:"varying vec2 vUv;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\n\t\t\t\tuniform sampler2D maskTexture;\n\t\t\t\tuniform sampler2D edgeTexture1;\n\t\t\t\tuniform sampler2D edgeTexture2;\n\t\t\t\tuniform sampler2D patternTexture;\n\t\t\t\tuniform float edgeStrength;\n\t\t\t\tuniform float edgeGlow;\n\t\t\t\tuniform bool usePatternTexture;\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tvec4 edgeValue1 = texture2D(edgeTexture1, vUv);\n\t\t\t\t\tvec4 edgeValue2 = texture2D(edgeTexture2, vUv);\n\t\t\t\t\tvec4 maskColor = texture2D(maskTexture, vUv);\n\t\t\t\t\tvec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\n\t\t\t\t\tfloat visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\n\t\t\t\t\tvec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\n\t\t\t\t\tvec4 finalColor = edgeStrength * maskColor.r * edgeValue;\n\t\t\t\t\tif(usePatternTexture)\n\t\t\t\t\t\tfinalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\n\t\t\t\t\tgl_FragColor = finalColor;\n\t\t\t\t}",blending:du,depthTest:!1,depthWrite:!1,transparent:!0})}};ku.BlurDirectionX=new Te(1,0),ku.BlurDirectionY=new Te(0,1);var jI=class extends Gs{constructor(e,t,r=null,i=null,n=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=n,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new dt}render(e,t,r){let i,n,a=e.autoClear;e.autoClear=!1,null!==this.overrideMaterial&&(n=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),null!==this.clearColor&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor)),null!==this.clearAlpha&&(i=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),1==this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),!0===this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),null!==this.clearColor&&e.setClearColor(this._oldClearColor),null!==this.clearAlpha&&e.setClearAlpha(i),null!==this.overrideMaterial&&(this.scene.overrideMaterial=n),e.autoClear=a}},Aw={name:"SAOShader",defines:{NUM_SAMPLES:7,NUM_RINGS:4,DIFFUSE_TEXTURE:0,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new Te(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new lt},cameraInverseProjectionMatrix:{value:new lt},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\n\t\tvarying vec2 vUv;\n\n\t\t#if DIFFUSE_TEXTURE == 1\n\t\tuniform sampler2D tDiffuse;\n\t\t#endif\n\n\t\tuniform sampler2D tDepth;\n\t\tuniform sampler2D tNormal;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform mat4 cameraProjectionMatrix;\n\t\tuniform mat4 cameraInverseProjectionMatrix;\n\n\t\tuniform float scale;\n\t\tuniform float intensity;\n\t\tuniform float bias;\n\t\tuniform float kernelRadius;\n\t\tuniform float minResolution;\n\t\tuniform vec2 size;\n\t\tuniform float randomSeed;\n\n\t\t// RGBA depth\n\n\t\t#include <packing>\n\n\t\tvec4 getDefaultColor( const in vec2 screenPosition ) {\n\t\t\t#if DIFFUSE_TEXTURE == 1\n\t\t\treturn texture2D( tDiffuse, vUv );\n\t\t\t#else\n\t\t\treturn vec4( 1.0 );\n\t\t\t#endif\n\t\t}\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#else\n\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#endif\n\t\t}\n\n\t\tvec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {\n\t\t\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\n\t\t\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );\n\t\t\tclipPosition *= clipW; // unprojection.\n\n\t\t\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;\n\t\t}\n\n\t\tvec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {\n\t\t\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );\n\t\t}\n\n\t\tfloat scaleDividedByCameraFar;\n\t\tfloat minResolutionMultipliedByCameraFar;\n\n\t\tfloat getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {\n\t\t\tvec3 viewDelta = sampleViewPosition - centerViewPosition;\n\t\t\tfloat viewDistance = length( viewDelta );\n\t\t\tfloat scaledScreenDistance = scaleDividedByCameraFar * viewDistance;\n\n\t\t\treturn max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );\n\t\t}\n\n\t\t// moving costly divides into consts\n\t\tconst float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );\n\t\tconst float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );\n\n\t\tfloat getAmbientOcclusion( const in vec3 centerViewPosition ) {\n\t\t\t// precompute some variables require in getOcclusion.\n\t\t\tscaleDividedByCameraFar = scale / cameraFar;\n\t\t\tminResolutionMultipliedByCameraFar = minResolution * cameraFar;\n\t\t\tvec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );\n\n\t\t\t// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/\n\t\t\tfloat angle = rand( vUv + randomSeed ) * PI2;\n\t\t\tvec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;\n\t\t\tvec2 radiusStep = radius;\n\n\t\t\tfloat occlusionSum = 0.0;\n\t\t\tfloat weightSum = 0.0;\n\n\t\t\tfor( int i = 0; i < NUM_SAMPLES; i ++ ) {\n\t\t\t\tvec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;\n\t\t\t\tradius += radiusStep;\n\t\t\t\tangle += ANGLE_STEP;\n\n\t\t\t\tfloat sampleDepth = getDepth( sampleUv );\n\t\t\t\tif( sampleDepth >= ( 1.0 - EPSILON ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfloat sampleViewZ = getViewZ( sampleDepth );\n\t\t\t\tvec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );\n\t\t\t\tocclusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );\n\t\t\t\tweightSum += 1.0;\n\t\t\t}\n\n\t\t\tif( weightSum == 0.0 ) discard;\n\n\t\t\treturn occlusionSum * ( intensity / weightSum );\n\t\t}\n\n\t\tvoid main() {\n\t\t\tfloat centerDepth = getDepth( vUv );\n\t\t\tif( centerDepth >= ( 1.0 - EPSILON ) ) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat centerViewZ = getViewZ( centerDepth );\n\t\t\tvec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );\n\n\t\t\tfloat ambientOcclusion = getAmbientOcclusion( viewPosition );\n\n\t\t\tgl_FragColor = getDefaultColor( vUv );\n\t\t\tgl_FragColor.xyz *=  1.0 - ambientOcclusion;\n\t\t}"},gf={name:"DepthLimitedBlurShader",defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new Te(512,512)},sampleUvOffsets:{value:[new Te(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:"\n\n\t\t#include <common>\n\n\t\tuniform vec2 size;\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec2 vInvSize;\n\n\t\tvoid main() {\n\t\t\tvUv = uv;\n\t\t\tvInvSize = 1.0 / size;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t}",fragmentShader:"\n\n\t\t#include <common>\n\t\t#include <packing>\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform sampler2D tDepth;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform float depthCutoff;\n\n\t\tuniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];\n\t\tuniform float sampleWeights[ KERNEL_RADIUS + 1 ];\n\n\t\tvarying vec2 vUv;\n\t\tvarying vec2 vInvSize;\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\t\t\t#if DEPTH_PACKING == 1\n\t\t\treturn unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );\n\t\t\t#else\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\t\t\t#endif\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#else\n\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\t\t\t#endif\n\t\t}\n\n\t\tvoid main() {\n\t\t\tfloat depth = getDepth( vUv );\n\t\t\tif( depth >= ( 1.0 - EPSILON ) ) {\n\t\t\t\tdiscard;\n\t\t\t}\n\n\t\t\tfloat centerViewZ = -getViewZ( depth );\n\t\t\tbool rBreak = false, lBreak = false;\n\n\t\t\tfloat weightSum = sampleWeights[0];\n\t\t\tvec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;\n\n\t\t\tfor( int i = 1; i <= KERNEL_RADIUS; i ++ ) {\n\n\t\t\t\tfloat sampleWeight = sampleWeights[i];\n\t\t\t\tvec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;\n\n\t\t\t\tvec2 sampleUv = vUv + sampleUvOffset;\n\t\t\t\tfloat viewZ = -getViewZ( getDepth( sampleUv ) );\n\n\t\t\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;\n\n\t\t\t\tif( ! rBreak ) {\n\t\t\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;\n\t\t\t\t\tweightSum += sampleWeight;\n\t\t\t\t}\n\n\t\t\t\tsampleUv = vUv - sampleUvOffset;\n\t\t\t\tviewZ = -getViewZ( getDepth( sampleUv ) );\n\n\t\t\t\tif( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;\n\n\t\t\t\tif( ! lBreak ) {\n\t\t\t\t\tdiffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;\n\t\t\t\t\tweightSum += sampleWeight;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tgl_FragColor = diffuseSum / weightSum;\n\t\t}"},Rw={createSampleWeights:function(e,t){let r=[];for(let i=0;i<=e;i++)r.push(AAt(i,t));return r},createSampleOffsets:function(e,t){let r=[];for(let i=0;i<=e;i++)r.push(t.clone().multiplyScalar(i));return r},configure:function(e,t,r,i){e.defines.KERNEL_RADIUS=t,e.uniforms.sampleUvOffsets.value=Rw.createSampleOffsets(t,i),e.uniforms.sampleWeights.value=Rw.createSampleWeights(t,r),e.needsUpdate=!0}};function AAt(e,t){return Math.exp(-e*e/(t*t*2))/(Math.sqrt(2*Math.PI)*t)}var im=class extends Gs{constructor(e,t,r=new Te(256,256)){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.originalClearColor=new dt,this._oldClearColor=new dt,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=new Te(r.x,r.y),this.saoRenderTarget=new yn(this.resolution.x,this.resolution.y,{type:Cn}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone();let i=new Xd;i.format=pu,i.type=oc,this.normalRenderTarget=new yn(this.resolution.x,this.resolution.y,{minFilter:ni,magFilter:ni,type:Cn,depthTexture:i}),this.normalMaterial=new Tp,this.normalMaterial.blending=Oi,this.saoMaterial=new xr({defines:Object.assign({},Aw.defines),fragmentShader:Aw.fragmentShader,vertexShader:Aw.vertexShader,uniforms:xi.clone(Aw.uniforms)}),this.saoMaterial.extensions.derivatives=!0,this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=i,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=Oi,this.vBlurMaterial=new xr({uniforms:xi.clone(gf.uniforms),defines:Object.assign({},gf.defines),vertexShader:gf.vertexShader,fragmentShader:gf.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=0,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=i,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=Oi,this.hBlurMaterial=new xr({uniforms:xi.clone(gf.uniforms),defines:Object.assign({},gf.defines),vertexShader:gf.vertexShader,fragmentShader:gf.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=0,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=i,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=Oi,this.materialCopy=new xr({uniforms:xi.clone(so.uniforms),vertexShader:so.vertexShader,fragmentShader:so.fragmentShader,blending:Oi}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=Yg,this.materialCopy.blendSrc=l1,this.materialCopy.blendDst=wp,this.materialCopy.blendEquation=jo,this.materialCopy.blendSrcAlpha=o1,this.materialCopy.blendDstAlpha=wp,this.materialCopy.blendEquationAlpha=jo,this.fsQuad=new io(null)}render(e,t,r){this.renderToScreen&&(this.materialCopy.blending=Oi,this.materialCopy.uniforms.tDiffuse.value=r.texture,this.materialCopy.needsUpdate=!0,this.renderPass(e,this.materialCopy,null)),e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();let i=e.autoClear;e.autoClear=!1,this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;let n=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=n,this.hBlurMaterial.uniforms.depthCutoff.value=n,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),(this.prevStdDev!==this.params.saoBlurStdDev||this.prevNumSamples!==this.params.saoBlurRadius)&&(Rw.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Te(0,1)),Rw.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Te(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(e,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(e,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(e,this.hBlurMaterial,this.saoRenderTarget,16777215,1));let a=this.materialCopy;this.params.output===im.OUTPUT.Normal?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),this.params.output===im.OUTPUT.Default?a.blending=Yg:a.blending=Oi,this.renderPass(e,a,this.renderToScreen?null:r),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=i}renderPass(e,t,r,i,n){e.getClearColor(this.originalClearColor);let a=e.getClearAlpha(),s=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,null!=i&&(e.setClearColor(i),e.setClearAlpha(n||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=s,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}renderOverride(e,t,r,i,n){e.getClearColor(this.originalClearColor);let a=e.getClearAlpha(),s=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,i=t.clearColor||i,n=t.clearAlpha||n,null!=i&&(e.setClearColor(i),e.setClearAlpha(n||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=s,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}setSize(e,t){this.saoRenderTarget.setSize(e,t),this.blurIntermediateRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.saoMaterial.uniforms.size.value.set(e,t),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(e,t),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(e,t),this.hBlurMaterial.needsUpdate=!0}dispose(){this.saoRenderTarget.dispose(),this.blurIntermediateRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.normalMaterial.dispose(),this.saoMaterial.dispose(),this.vBlurMaterial.dispose(),this.hBlurMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}};im.OUTPUT={Default:0,SAO:1,Normal:2};var WI=class extends Gs{constructor(e,t,r,i){super(),this.scene=e,this.camera=t,this.sampleLevel=4,this.unbiased=!0,this.clearColor=void 0!==r?r:0,this.clearAlpha=void 0!==i?i:0,this._oldClearColor=new dt;let n=so;this.copyUniforms=xi.clone(n.uniforms),this.copyMaterial=new xr({uniforms:this.copyUniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,premultipliedAlpha:!0,blending:du}),this.fsQuad=new io(this.copyMaterial)}dispose(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null),this.copyMaterial.dispose(),this.fsQuad.dispose()}setSize(e,t){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(e,t)}render(e,t,r){this.sampleRenderTarget||(this.sampleRenderTarget=new yn(r.width,r.height,{type:Cn}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");let i=RAt[Math.max(0,Math.min(this.sampleLevel,5))],n=e.autoClear;e.autoClear=!1,e.getClearColor(this._oldClearColor);let a=e.getClearAlpha(),s=1/i.length;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;let o={fullWidth:r.width,fullHeight:r.height,offsetX:0,offsetY:0,width:r.width,height:r.height},l=Object.assign({},this.camera.view);l.enabled&&Object.assign(o,l);for(let r=0;r<i.length;r++){let n=i[r];this.camera.setViewOffset&&this.camera.setViewOffset(o.fullWidth,o.fullHeight,o.offsetX+.0625*n[0],o.offsetY+.0625*n[1],o.width,o.height);let a=s;if(this.unbiased){a+=.03125*((r+.5)/i.length-.5)}this.copyUniforms.opacity.value=a,e.setClearColor(this.clearColor,this.clearAlpha),e.setRenderTarget(this.sampleRenderTarget),e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(this.renderToScreen?null:t),0===r&&(e.setClearColor(0,0),e.clear()),this.fsQuad.render(e)}this.camera.setViewOffset&&l.enabled?this.camera.setViewOffset(l.fullWidth,l.fullHeight,l.offsetX,l.offsetY,l.width,l.height):this.camera.clearViewOffset&&this.camera.clearViewOffset(),e.autoClear=n,e.setClearColor(this._oldClearColor,a)}},RAt=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]],XI=class{constructor(e=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());this.perm=[];for(let e=0;e<512;e++)this.perm[e]=this.p[255&e];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(e,t,r){return e[0]*t+e[1]*r}dot3(e,t,r,i){return e[0]*t+e[1]*r+e[2]*i}dot4(e,t,r,i,n){return e[0]*t+e[1]*r+e[2]*i+e[3]*n}noise(e,t){let r,i,n,a,s,o=(e+t)*(.5*(Math.sqrt(3)-1)),l=Math.floor(e+o),h=Math.floor(t+o),c=(3-Math.sqrt(3))/6,u=(l+h)*c,d=e-(l-u),p=t-(h-u);d>p?(a=1,s=0):(a=0,s=1);let f=d-a+c,m=p-s+c,g=d-1+2*c,v=p-1+2*c,y=255&l,b=255&h,x=this.perm[y+this.perm[b]]%12,_=this.perm[y+a+this.perm[b+s]]%12,w=this.perm[y+1+this.perm[b+1]]%12,S=.5-d*d-p*p;S<0?r=0:(S*=S,r=S*S*this.dot(this.grad3[x],d,p));let T=.5-f*f-m*m;T<0?i=0:(T*=T,i=T*T*this.dot(this.grad3[_],f,m));let M=.5-g*g-v*v;return M<0?n=0:(M*=M,n=M*M*this.dot(this.grad3[w],g,v)),70*(r+i+n)}noise3d(e,t,r){let i,n,a,s,o,l,h,c,u,d,p=.3333333333333333*(e+t+r),f=Math.floor(e+p),m=Math.floor(t+p),g=Math.floor(r+p),v=1/6,y=(f+m+g)*v,b=e-(f-y),x=t-(m-y),_=r-(g-y);b>=x?x>=_?(o=1,l=0,h=0,c=1,u=1,d=0):b>=_?(o=1,l=0,h=0,c=1,u=0,d=1):(o=0,l=0,h=1,c=1,u=0,d=1):x<_?(o=0,l=0,h=1,c=0,u=1,d=1):b<_?(o=0,l=1,h=0,c=0,u=1,d=1):(o=0,l=1,h=0,c=1,u=1,d=0);let w=b-o+v,S=x-l+v,T=_-h+v,M=b-c+2*v,E=x-u+2*v,A=_-d+2*v,C=b-1+.5,P=x-1+.5,R=_-1+.5,I=255&f,O=255&m,L=255&g,D=this.perm[I+this.perm[O+this.perm[L]]]%12,k=this.perm[I+o+this.perm[O+l+this.perm[L+h]]]%12,F=this.perm[I+c+this.perm[O+u+this.perm[L+d]]]%12,N=this.perm[I+1+this.perm[O+1+this.perm[L+1]]]%12,U=.6-b*b-x*x-_*_;U<0?i=0:(U*=U,i=U*U*this.dot3(this.grad3[D],b,x,_));let B=.6-w*w-S*S-T*T;B<0?n=0:(B*=B,n=B*B*this.dot3(this.grad3[k],w,S,T));let z=.6-M*M-E*E-A*A;z<0?a=0:(z*=z,a=z*z*this.dot3(this.grad3[F],M,E,A));let H=.6-C*C-P*P-R*R;return H<0?s=0:(H*=H,s=H*H*this.dot3(this.grad3[N],C,P,R)),32*(i+n+a+s)}noise4d(e,t,r,i){let n,a,s,o,l,h=this.grad4,c=this.simplex,u=this.perm,d=(Math.sqrt(5)-1)/4,p=(5-Math.sqrt(5))/20,f=(e+t+r+i)*d,m=Math.floor(e+f),g=Math.floor(t+f),v=Math.floor(r+f),y=Math.floor(i+f),b=(m+g+v+y)*p,x=e-(m-b),_=t-(g-b),w=r-(v-b),S=i-(y-b),T=(x>_?32:0)+(x>w?16:0)+(_>w?8:0)+(x>S?4:0)+(_>S?2:0)+(w>S?1:0),M=c[T][0]>=3?1:0,E=c[T][1]>=3?1:0,A=c[T][2]>=3?1:0,C=c[T][3]>=3?1:0,P=c[T][0]>=2?1:0,R=c[T][1]>=2?1:0,I=c[T][2]>=2?1:0,O=c[T][3]>=2?1:0,L=c[T][0]>=1?1:0,D=c[T][1]>=1?1:0,k=c[T][2]>=1?1:0,F=c[T][3]>=1?1:0,N=x-M+p,U=_-E+p,B=w-A+p,z=S-C+p,H=x-P+2*p,V=_-R+2*p,j=w-I+2*p,G=S-O+2*p,W=x-L+3*p,X=_-D+3*p,q=w-k+3*p,Y=S-F+3*p,$=x-1+4*p,Z=_-1+4*p,K=w-1+4*p,J=S-1+4*p,Q=255&m,ee=255&g,te=255&v,re=255&y,ie=u[Q+u[ee+u[te+u[re]]]]%32,ne=u[Q+M+u[ee+E+u[te+A+u[re+C]]]]%32,ae=u[Q+P+u[ee+R+u[te+I+u[re+O]]]]%32,se=u[Q+L+u[ee+D+u[te+k+u[re+F]]]]%32,oe=u[Q+1+u[ee+1+u[te+1+u[re+1]]]]%32,le=.6-x*x-_*_-w*w-S*S;le<0?n=0:(le*=le,n=le*le*this.dot4(h[ie],x,_,w,S));let he=.6-N*N-U*U-B*B-z*z;he<0?a=0:(he*=he,a=he*he*this.dot4(h[ne],N,U,B,z));let ce=.6-H*H-V*V-j*j-G*G;ce<0?s=0:(ce*=ce,s=ce*ce*this.dot4(h[ae],H,V,j,G));let ue=.6-W*W-X*X-q*q-Y*Y;ue<0?o=0:(ue*=ue,o=ue*ue*this.dot4(h[se],W,X,q,Y));let de=.6-$*$-Z*Z-K*K-J*J;return de<0?l=0:(de*=de,l=de*de*this.dot4(h[oe],$,Z,K,J)),27*(n+a+s+o+l)}},Cw={name:"SSAOShader",defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new Te},cameraProjectionMatrix:{value:new lt},cameraInverseProjectionMatrix:{value:new lt},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tNormal;\n\t\tuniform sampler2D tDepth;\n\t\tuniform sampler2D tNoise;\n\n\t\tuniform vec3 kernel[ KERNEL_SIZE ];\n\n\t\tuniform vec2 resolution;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\t\tuniform mat4 cameraProjectionMatrix;\n\t\tuniform mat4 cameraInverseProjectionMatrix;\n\n\t\tuniform float kernelRadius;\n\t\tuniform float minDistance; // avoid artifacts caused by neighbour fragments with minimal depth difference\n\t\tuniform float maxDistance; // avoid the influence of fragments which are too far away\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tfloat getDepth( const in vec2 screenPosition ) {\n\n\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t}\n\n\t\tfloat getLinearDepth( const in vec2 screenPosition ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tfloat getViewZ( const in float depth ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\treturn perspectiveDepthToViewZ( depth, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn orthographicDepthToViewZ( depth, cameraNear, cameraFar );\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tvec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {\n\n\t\t\tfloat clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];\n\n\t\t\tvec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );\n\n\t\t\tclipPosition *= clipW; // unprojection.\n\n\t\t\treturn ( cameraInverseProjectionMatrix * clipPosition ).xyz;\n\n\t\t}\n\n\t\tvec3 getViewNormal( const in vec2 screenPosition ) {\n\n\t\t\treturn unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = getDepth( vUv );\n\n\t\t\tif ( depth == 1.0 ) {\n\n\t\t\t\tgl_FragColor = vec4( 1.0 ); // don't influence background\n\t\t\t\t\n\t\t\t} else {\n\n\t\t\t\tfloat viewZ = getViewZ( depth );\n\n\t\t\t\tvec3 viewPosition = getViewPosition( vUv, depth, viewZ );\n\t\t\t\tvec3 viewNormal = getViewNormal( vUv );\n\n\t\t\t\tvec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );\n\t\t\t\tvec3 random = vec3( texture2D( tNoise, vUv * noiseScale ).r );\n\n\t\t\t\t// compute matrix used to reorient a kernel vector\n\n\t\t\t\tvec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );\n\t\t\t\tvec3 bitangent = cross( viewNormal, tangent );\n\t\t\t\tmat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );\n\n\t\t\t\tfloat occlusion = 0.0;\n\n\t\t\t\tfor ( int i = 0; i < KERNEL_SIZE; i ++ ) {\n\n\t\t\t\t\tvec3 sampleVector = kernelMatrix * kernel[ i ]; // reorient sample vector in view space\n\t\t\t\t\tvec3 samplePoint = viewPosition + ( sampleVector * kernelRadius ); // calculate sample point\n\n\t\t\t\t\tvec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 ); // project point and calculate NDC\n\t\t\t\t\tsamplePointNDC /= samplePointNDC.w;\n\n\t\t\t\t\tvec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5; // compute uv coordinates\n\n\t\t\t\t\tfloat realDepth = getLinearDepth( samplePointUv ); // get linear depth from depth texture\n\t\t\t\t\tfloat sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar ); // compute linear depth of the sample view Z value\n\t\t\t\t\tfloat delta = sampleDepth - realDepth;\n\n\t\t\t\t\tif ( delta > minDistance && delta < maxDistance ) { // if fragment is before sample point, increase occlusion\n\n\t\t\t\t\t\tocclusion += 1.0;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tocclusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );\n\n\t\t\t\tgl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );\n\n\t\t\t}\n\n\t\t}"},Pw={name:"SSAODepthShader",defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:"varying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"uniform sampler2D tDepth;\n\n\t\tuniform float cameraNear;\n\t\tuniform float cameraFar;\n\n\t\tvarying vec2 vUv;\n\n\t\t#include <packing>\n\n\t\tfloat getLinearDepth( const in vec2 screenPosition ) {\n\n\t\t\t#if PERSPECTIVE_CAMERA == 1\n\n\t\t\t\tfloat fragCoordZ = texture2D( tDepth, screenPosition ).x;\n\t\t\t\tfloat viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );\n\t\t\t\treturn viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t\t#else\n\n\t\t\t\treturn texture2D( tDepth, screenPosition ).x;\n\n\t\t\t#endif\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tfloat depth = getLinearDepth( vUv );\n\t\t\tgl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );\n\n\t\t}"},Iw={name:"SSAOBlurShader",uniforms:{tDiffuse:{value:null},resolution:{value:new Te}},vertexShader:"varying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"uniform sampler2D tDiffuse;\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec2 texelSize = ( 1.0 / resolution );\n\t\t\tfloat result = 0.0;\n\n\t\t\tfor ( int i = - 2; i <= 2; i ++ ) {\n\n\t\t\t\tfor ( int j = - 2; j <= 2; j ++ ) {\n\n\t\t\t\t\tvec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;\n\t\t\t\t\tresult += texture2D( tDiffuse, vUv + offset ).r;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tgl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );\n\n\t\t}"},Fu=class extends Gs{constructor(e,t,r,i,n=32){super(),this.width=void 0!==r?r:512,this.height=void 0!==i?i:512,this.clear=!0,this.camera=t,this.scene=e,this.kernelRadius=8,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this._visibilityCache=new Map,this.generateSampleKernel(n),this.generateRandomKernelRotations();let a=new Xd;a.format=pu,a.type=oc,this.normalRenderTarget=new yn(this.width,this.height,{minFilter:ni,magFilter:ni,type:Cn,depthTexture:a}),this.ssaoRenderTarget=new yn(this.width,this.height,{type:Cn}),this.blurRenderTarget=this.ssaoRenderTarget.clone(),this.ssaoMaterial=new xr({defines:Object.assign({},Cw.defines),uniforms:xi.clone(Cw.uniforms),vertexShader:Cw.vertexShader,fragmentShader:Cw.fragmentShader,blending:Oi}),this.ssaoMaterial.defines.KERNEL_SIZE=n,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new Tp,this.normalMaterial.blending=Oi,this.blurMaterial=new xr({defines:Object.assign({},Iw.defines),uniforms:xi.clone(Iw.uniforms),vertexShader:Iw.vertexShader,fragmentShader:Iw.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new xr({defines:Object.assign({},Pw.defines),uniforms:xi.clone(Pw.uniforms),vertexShader:Pw.vertexShader,fragmentShader:Pw.fragmentShader,blending:Oi}),this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new xr({uniforms:xi.clone(so.uniforms),vertexShader:so.vertexShader,fragmentShader:so.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:l1,blendDst:wp,blendEquation:jo,blendSrcAlpha:o1,blendDstAlpha:wp,blendEquationAlpha:jo}),this.fsQuad=new io(null),this.originalClearColor=new dt}dispose(){this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(e,t,r){switch(!1===e.capabilities.isWebGL2&&(this.noiseTexture.format=q2),this.overrideVisibility(),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility(),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(e,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.output){case Fu.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=Oi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case Fu.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=Oi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case Fu.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case Fu.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=Oi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case Fu.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=r.texture,this.copyMaterial.blending=Oi,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=Yg,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;default:console.warn("THREE.SSAOPass: Unknown output type.")}}renderPass(e,t,r,i,n){e.getClearColor(this.originalClearColor);let a=e.getClearAlpha(),s=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,null!=i&&(e.setClearColor(i),e.setClearAlpha(n||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=s,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}renderOverride(e,t,r,i,n){e.getClearColor(this.originalClearColor);let a=e.getClearAlpha(),s=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,i=t.clearColor||i,n=t.clearAlpha||n,null!=i&&(e.setClearColor(i),e.setClearAlpha(n||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=s,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}setSize(e,t){this.width=e,this.height=t,this.ssaoRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.ssaoMaterial.uniforms.resolution.value.set(e,t),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(e,t)}generateSampleKernel(e){let t=this.kernel;for(let r=0;r<e;r++){let i=new F;i.x=2*Math.random()-1,i.y=2*Math.random()-1,i.z=Math.random(),i.normalize();let n=r/e;n=Tr.lerp(.1,1,n*n),i.multiplyScalar(n),t.push(i)}}generateRandomKernelRotations(){let e=new XI,t=new Float32Array(16);for(let r=0;r<16;r++){let i=2*Math.random()-1,n=2*Math.random()-1,a=0;t[r]=e.noise3d(i,n,a)}this.noiseTexture=new _o(t,4,4,u1,Us),this.noiseTexture.wrapS=ui,this.noiseTexture.wrapT=ui,this.noiseTexture.needsUpdate=!0}overrideVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse((function(e){t.set(e,e.visible),(e.isPoints||e.isLine)&&(e.visible=!1)}))}restoreVisibility(){let e=this.scene,t=this._visibilityCache;e.traverse((function(e){let r=t.get(e);e.visible=r})),t.clear()}};Fu.OUTPUT={Default:0,SSAO:1,Blur:2,Depth:3,Normal:4};var z_e={name:"LuminosityHighPassShader",shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new dt(0)},defaultOpacity:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform vec3 defaultColor;\n\t\tuniform float defaultOpacity;\n\t\tuniform float luminosityThreshold;\n\t\tuniform float smoothWidth;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\n\t\t\tvec3 luma = vec3( 0.299, 0.587, 0.114 );\n\n\t\t\tfloat v = dot( texel.xyz, luma );\n\n\t\t\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n\n\t\t\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n\n\t\t\tgl_FragColor = mix( outputColor, texel, alpha );\n\n\t\t}"},vf=class extends Gs{constructor(e,t,r,i){super(),this.strength=void 0!==t?t:1,this.radius=r,this.threshold=i,this.resolution=void 0!==e?new Te(e.x,e.y):new Te(256,256),this.clearColor=new dt(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let n=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);this.renderTargetBright=new yn(n,a,{type:Cn}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let e=0;e<this.nMips;e++){let t=new yn(n,a,{type:Cn});t.texture.name="UnrealBloomPass.h"+e,t.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(t);let r=new yn(n,a,{type:Cn});r.texture.name="UnrealBloomPass.v"+e,r.texture.generateMipmaps=!1,this.renderTargetsVertical.push(r),n=Math.round(n/2),a=Math.round(a/2)}let s=z_e;this.highPassUniforms=xi.clone(s.uniforms),this.highPassUniforms.luminosityThreshold.value=i,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new xr({uniforms:this.highPassUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}),this.separableBlurMaterials=[];let o=[3,5,7,9,11];n=Math.round(this.resolution.x/2),a=Math.round(this.resolution.y/2);for(let e=0;e<this.nMips;e++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(o[e])),this.separableBlurMaterials[e].uniforms.invSize.value=new Te(1/n,1/a),n=Math.round(n/2),a=Math.round(a/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new F(1,1,1),new F(1,1,1),new F(1,1,1),new F(1,1,1),new F(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;let l=so;this.copyUniforms=xi.clone(l.uniforms),this.blendMaterial=new xr({uniforms:this.copyUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,blending:du,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new dt,this.oldClearAlpha=1,this.basic=new Mr,this.fsQuad=new io(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,t){let r=Math.round(e/2),i=Math.round(t/2);this.renderTargetBright.setSize(r,i);for(let e=0;e<this.nMips;e++)this.renderTargetsHorizontal[e].setSize(r,i),this.renderTargetsVertical[e].setSize(r,i),this.separableBlurMaterials[e].uniforms.invSize.value=new Te(1/r,1/i),r=Math.round(r/2),i=Math.round(i/2)}render(e,t,r,i,n){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();let a=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),n&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let s=this.renderTargetBright;for(let t=0;t<this.nMips;t++)this.fsQuad.material=this.separableBlurMaterials[t],this.separableBlurMaterials[t].uniforms.colorTexture.value=s.texture,this.separableBlurMaterials[t].uniforms.direction.value=vf.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[t]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[t].uniforms.colorTexture.value=this.renderTargetsHorizontal[t].texture,this.separableBlurMaterials[t].uniforms.direction.value=vf.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[t]),e.clear(),this.fsQuad.render(e),s=this.renderTargetsVertical[t];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,n&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=a}getSeperableBlurMaterial(e){let t=[];for(let r=0;r<e;r++)t.push(.39894*Math.exp(-.5*r*r/(e*e))/e);return new xr({defines:{KERNEL_RADIUS:e},uniforms:{colorTexture:{value:null},invSize:{value:new Te(.5,.5)},direction:{value:new Te(.5,.5)},gaussianCoefficients:{value:t}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\n\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 invSize;\n\t\t\t\tuniform vec2 direction;\n\t\t\t\tuniform float gaussianCoefficients[KERNEL_RADIUS];\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tfloat weightSum = gaussianCoefficients[0];\n\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;\n\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n\t\t\t\t\t\tfloat x = float(i);\n\t\t\t\t\t\tfloat w = gaussianCoefficients[i];\n\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\n\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;\n\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;\n\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\n\t\t\t\t\t\tweightSum += 2.0 * w;\n\t\t\t\t\t}\n\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})}getCompositeMaterial(e){return new xr({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\n\t\t\t\tuniform sampler2D blurTexture1;\n\t\t\t\tuniform sampler2D blurTexture2;\n\t\t\t\tuniform sampler2D blurTexture3;\n\t\t\t\tuniform sampler2D blurTexture4;\n\t\t\t\tuniform sampler2D blurTexture5;\n\t\t\t\tuniform float bloomStrength;\n\t\t\t\tuniform float bloomRadius;\n\t\t\t\tuniform float bloomFactors[NUM_MIPS];\n\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\n\n\t\t\t\tfloat lerpBloomFactor(const in float factor) {\n\t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\n\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\n\t\t\t\t\t\tlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n\t\t\t\t}"})}};vf.BlurDirectionX=new Te(1,0),vf.BlurDirectionY=new Te(0,1);var G_e={name:"FXAAShader",uniforms:{tDiffuse:{value:null},resolution:{value:new Te(1/1024,1/512)}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\t\tprecision highp float;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tuniform vec2 resolution;\n\n\t\tvarying vec2 vUv;\n\n\t\t// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)\n\n\t\t//----------------------------------------------------------------------------------\n\t\t// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag\n\t\t// SDK Version: v3.00\n\t\t// Email:       gameworks@nvidia.com\n\t\t// Site:        http://developer.nvidia.com/\n\t\t//\n\t\t// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\n\t\t//\n\t\t// Redistribution and use in source and binary forms, with or without\n\t\t// modification, are permitted provided that the following conditions\n\t\t// are met:\n\t\t//  * Redistributions of source code must retain the above copyright\n\t\t//    notice, this list of conditions and the following disclaimer.\n\t\t//  * Redistributions in binary form must reproduce the above copyright\n\t\t//    notice, this list of conditions and the following disclaimer in the\n\t\t//    documentation and/or other materials provided with the distribution.\n\t\t//  * Neither the name of NVIDIA CORPORATION nor the names of its\n\t\t//    contributors may be used to endorse or promote products derived\n\t\t//    from this software without specific prior written permission.\n\t\t//\n\t\t// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ''AS IS'' AND ANY\n\t\t// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n\t\t// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n\t\t// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n\t\t// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n\t\t// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n\t\t// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n\t\t// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n\t\t// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n\t\t// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n\t\t// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\t\t//\n\t\t//----------------------------------------------------------------------------------\n\n\t\t#ifndef FXAA_DISCARD\n\t\t\t//\n\t\t\t// Only valid for PC OpenGL currently.\n\t\t\t// Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n\t\t\t//\n\t\t\t// 1 = Use discard on pixels which don't need AA.\n\t\t\t//     For APIs which enable concurrent TEX+ROP from same surface.\n\t\t\t// 0 = Return unchanged color on pixels which don't need AA.\n\t\t\t//\n\t\t\t#define FXAA_DISCARD 0\n\t\t#endif\n\n\t\t/*--------------------------------------------------------------------------*/\n\t\t#define FxaaTexTop(t, p) texture2D(t, p, -100.0)\n\t\t#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), -100.0)\n\t\t/*--------------------------------------------------------------------------*/\n\n\t\t#define NUM_SAMPLES 5\n\n\t\t// assumes colors have premultipliedAlpha, so that the calculated color contrast is scaled by alpha\n\t\tfloat contrast( vec4 a, vec4 b ) {\n\t\t\tvec4 diff = abs( a - b );\n\t\t\treturn max( max( max( diff.r, diff.g ), diff.b ), diff.a );\n\t\t}\n\n\t\t/*============================================================================\n\n\t\t\t\t\t\t\t\t\tFXAA3 QUALITY - PC\n\n\t\t============================================================================*/\n\n\t\t/*--------------------------------------------------------------------------*/\n\t\tvec4 FxaaPixelShader(\n\t\t\tvec2 posM,\n\t\t\tsampler2D tex,\n\t\t\tvec2 fxaaQualityRcpFrame,\n\t\t\tfloat fxaaQualityEdgeThreshold,\n\t\t\tfloat fxaaQualityinvEdgeThreshold\n\t\t) {\n\t\t\tvec4 rgbaM = FxaaTexTop(tex, posM);\n\t\t\tvec4 rgbaS = FxaaTexOff(tex, posM, vec2( 0.0, 1.0), fxaaQualityRcpFrame.xy);\n\t\t\tvec4 rgbaE = FxaaTexOff(tex, posM, vec2( 1.0, 0.0), fxaaQualityRcpFrame.xy);\n\t\t\tvec4 rgbaN = FxaaTexOff(tex, posM, vec2( 0.0,-1.0), fxaaQualityRcpFrame.xy);\n\t\t\tvec4 rgbaW = FxaaTexOff(tex, posM, vec2(-1.0, 0.0), fxaaQualityRcpFrame.xy);\n\t\t\t// . S .\n\t\t\t// W M E\n\t\t\t// . N .\n\n\t\t\tbool earlyExit = max( max( max(\n\t\t\t\t\tcontrast( rgbaM, rgbaN ),\n\t\t\t\t\tcontrast( rgbaM, rgbaS ) ),\n\t\t\t\t\tcontrast( rgbaM, rgbaE ) ),\n\t\t\t\t\tcontrast( rgbaM, rgbaW ) )\n\t\t\t\t\t< fxaaQualityEdgeThreshold;\n\t\t\t// . 0 .\n\t\t\t// 0 0 0\n\t\t\t// . 0 .\n\n\t\t\t#if (FXAA_DISCARD == 1)\n\t\t\t\tif(earlyExit) FxaaDiscard;\n\t\t\t#else\n\t\t\t\tif(earlyExit) return rgbaM;\n\t\t\t#endif\n\n\t\t\tfloat contrastN = contrast( rgbaM, rgbaN );\n\t\t\tfloat contrastS = contrast( rgbaM, rgbaS );\n\t\t\tfloat contrastE = contrast( rgbaM, rgbaE );\n\t\t\tfloat contrastW = contrast( rgbaM, rgbaW );\n\n\t\t\tfloat relativeVContrast = ( contrastN + contrastS ) - ( contrastE + contrastW );\n\t\t\trelativeVContrast *= fxaaQualityinvEdgeThreshold;\n\n\t\t\tbool horzSpan = relativeVContrast > 0.;\n\t\t\t// . 1 .\n\t\t\t// 0 0 0\n\t\t\t// . 1 .\n\n\t\t\t// 45 deg edge detection and corners of objects, aka V/H contrast is too similar\n\t\t\tif( abs( relativeVContrast ) < .3 ) {\n\t\t\t\t// locate the edge\n\t\t\t\tvec2 dirToEdge;\n\t\t\t\tdirToEdge.x = contrastE > contrastW ? 1. : -1.;\n\t\t\t\tdirToEdge.y = contrastS > contrastN ? 1. : -1.;\n\t\t\t\t// . 2 .      . 1 .\n\t\t\t\t// 1 0 2  ~=  0 0 1\n\t\t\t\t// . 1 .      . 0 .\n\n\t\t\t\t// tap 2 pixels and see which ones are \"outside\" the edge, to\n\t\t\t\t// determine if the edge is vertical or horizontal\n\n\t\t\t\tvec4 rgbaAlongH = FxaaTexOff(tex, posM, vec2( dirToEdge.x, -dirToEdge.y ), fxaaQualityRcpFrame.xy);\n\t\t\t\tfloat matchAlongH = contrast( rgbaM, rgbaAlongH );\n\t\t\t\t// . 1 .\n\t\t\t\t// 0 0 1\n\t\t\t\t// . 0 H\n\n\t\t\t\tvec4 rgbaAlongV = FxaaTexOff(tex, posM, vec2( -dirToEdge.x, dirToEdge.y ), fxaaQualityRcpFrame.xy);\n\t\t\t\tfloat matchAlongV = contrast( rgbaM, rgbaAlongV );\n\t\t\t\t// V 1 .\n\t\t\t\t// 0 0 1\n\t\t\t\t// . 0 .\n\n\t\t\t\trelativeVContrast = matchAlongV - matchAlongH;\n\t\t\t\trelativeVContrast *= fxaaQualityinvEdgeThreshold;\n\n\t\t\t\tif( abs( relativeVContrast ) < .3 ) { // 45 deg edge\n\t\t\t\t\t// 1 1 .\n\t\t\t\t\t// 0 0 1\n\t\t\t\t\t// . 0 1\n\n\t\t\t\t\t// do a simple blur\n\t\t\t\t\treturn mix(\n\t\t\t\t\t\trgbaM,\n\t\t\t\t\t\t(rgbaN + rgbaS + rgbaE + rgbaW) * .25,\n\t\t\t\t\t\t.4\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\thorzSpan = relativeVContrast > 0.;\n\t\t\t}\n\n\t\t\tif(!horzSpan) rgbaN = rgbaW;\n\t\t\tif(!horzSpan) rgbaS = rgbaE;\n\t\t\t// . 0 .      1\n\t\t\t// 1 0 1  ->  0\n\t\t\t// . 0 .      1\n\n\t\t\tbool pairN = contrast( rgbaM, rgbaN ) > contrast( rgbaM, rgbaS );\n\t\t\tif(!pairN) rgbaN = rgbaS;\n\n\t\t\tvec2 offNP;\n\t\t\toffNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n\t\t\toffNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n\n\t\t\tbool doneN = false;\n\t\t\tbool doneP = false;\n\n\t\t\tfloat nDist = 0.;\n\t\t\tfloat pDist = 0.;\n\n\t\t\tvec2 posN = posM;\n\t\t\tvec2 posP = posM;\n\n\t\t\tint iterationsUsed = 0;\n\t\t\tint iterationsUsedN = 0;\n\t\t\tint iterationsUsedP = 0;\n\t\t\tfor( int i = 0; i < NUM_SAMPLES; i++ ) {\n\t\t\t\titerationsUsed = i;\n\n\t\t\t\tfloat increment = float(i + 1);\n\n\t\t\t\tif(!doneN) {\n\t\t\t\t\tnDist += increment;\n\t\t\t\t\tposN = posM + offNP * nDist;\n\t\t\t\t\tvec4 rgbaEndN = FxaaTexTop(tex, posN.xy);\n\t\t\t\t\tdoneN = contrast( rgbaEndN, rgbaM ) > contrast( rgbaEndN, rgbaN );\n\t\t\t\t\titerationsUsedN = i;\n\t\t\t\t}\n\n\t\t\t\tif(!doneP) {\n\t\t\t\t\tpDist += increment;\n\t\t\t\t\tposP = posM - offNP * pDist;\n\t\t\t\t\tvec4 rgbaEndP = FxaaTexTop(tex, posP.xy);\n\t\t\t\t\tdoneP = contrast( rgbaEndP, rgbaM ) > contrast( rgbaEndP, rgbaN );\n\t\t\t\t\titerationsUsedP = i;\n\t\t\t\t}\n\n\t\t\t\tif(doneN || doneP) break;\n\t\t\t}\n\n\n\t\t\tif ( !doneP && !doneN ) return rgbaM; // failed to find end of edge\n\n\t\t\tfloat dist = min(\n\t\t\t\tdoneN ? float( iterationsUsedN ) / float( NUM_SAMPLES - 1 ) : 1.,\n\t\t\t\tdoneP ? float( iterationsUsedP ) / float( NUM_SAMPLES - 1 ) : 1.\n\t\t\t);\n\n\t\t\t// hacky way of reduces blurriness of mostly diagonal edges\n\t\t\t// but reduces AA quality\n\t\t\tdist = pow(dist, .5);\n\n\t\t\tdist = 1. - dist;\n\n\t\t\treturn mix(\n\t\t\t\trgbaM,\n\t\t\t\trgbaN,\n\t\t\t\tdist * .5\n\t\t\t);\n\t\t}\n\n\t\tvoid main() {\n\t\t\tconst float edgeDetectionQuality = .2;\n\t\t\tconst float invEdgeDetectionQuality = 1. / edgeDetectionQuality;\n\n\t\t\tgl_FragColor = FxaaPixelShader(\n\t\t\t\tvUv,\n\t\t\t\ttDiffuse,\n\t\t\t\tresolution,\n\t\t\t\tedgeDetectionQuality, // [0,1] contrast needed, otherwise early discard\n\t\t\t\tinvEdgeDetectionQuality\n\t\t\t);\n\n\t\t}\n\t"},sm=class{},db=new lt,LG=new Vt,Lc=class extends sm{constructor(e){var t,r;super(),this.modelData=e,this.modelId=e.modelId,this.modelObject=(null==(t=e.dxfData)?void 0:t.threejsObject)||(null==(r=e.pdfData)?void 0:r.threejsObject),this.modelObject.name=this.modelId,this.modelObject.userData.modelId=this.modelId}get pdfData(){return this.modelData.pdfData}get dxfData(){return this.modelData.dxfData}get msTransformMatrix(){return this.modelData.msTransformMatrix}set msTransformMatrix(e){this.modelData.msTransformMatrix=e}get loadedEntityCount(){var e,t;return(null==(e=this.dxfData)?void 0:e.loadedEntityCount)||(null==(t=this.pdfData)?void 0:t.loadedEntityCount)||0}get header(){var e;return null==(e=this.dxfData)?void 0:e.header}get viewports(){var e;return null==(e=this.dxfData)?void 0:e.tables.viewport.viewports}get layers(){var e;let t=this.dxfData||this.pdfData;return(null==(e=t.tables)?void 0:e.layer.layers)||t.layers}get layoutViewportsMap(){var e;return null==(e=this.dxfData)?void 0:e.layoutViewportsMap}getModelObject(){let e=this.dxfData||this.pdfData;if(!e)throw new Error(`Failed to find model by modelId '${this.modelId}'!`);return e.threejsObject}getBBox(){if(!this.bbox){let e=new Vt,t=this.getModelObject();e.setFromObject(t),this.bbox=e}return this.bbox}getUnits(){if(!this.dxfData)return"Unitless";let e=this.dxfData.header;if(!e)return de.warn("DxfData or its header is undefined!"),"Unitless";let t=e.$INSUNITS;return Qr.getDxfUnits(t)}getModelSpaceExtent(){let e=this.header,t=new F,r=new F;if(!e)return void de.error(`Header is undefined in ${this.modelId}!`);let i=this.viewports,n=e.$EXTMIN,a=e.$EXTMAX,s=e.$ANGDIR;if(i&&i.length>0)for(let e=0;e<i.length;e++){let t=i[e];if("*ACTIVE"===t.name.toLocaleUpperCase()){let{center:e,viewHeight:r,aspectRatio:i}=t,o=r*i,l=Qr.getDcs2WcsMatrix(t,s),h=new F(e.x,e.y,0);h.applyMatrix4(l),n={x:h.x-o/2,y:h.y-r/2,z:0},a={x:h.x+o/2,y:h.y+r/2,z:0};break}}return t.set(n.x,n.y,n.z),r.set(a.x,a.y,a.z),new Vt(t,r)}getLayer(e){if(this.layers)return this.layers[e]}getObjectsByLayer(e){let t=this.dxfData||this.pdfData;return(null==t?void 0:t.layersAndThreejsObjects)&&t.layersAndThreejsObjects[e]}getLayouts(){let e=[],t=this.dxfData,r=null==t?void 0:t.objects.LAYOUT;return null==r||r.forEach((t=>{e.push(t)})),e}getLayoutByName(e){let t,r=this.getLayouts();for(let i of r)if(i.layoutName===e){t=i;break}return t}getLayoutExtent(e){let t=this.header,r=new F,i=new F;if(!t)throw new Error(`Header is undefined in ${this.modelId}!`);let n=this.getLayoutViewports(e),a=t.$PEXTMIN,s=t.$PEXTMAX,o=t.$ANGDIR;if(n&&n.length>0){let e,t=n.filter((e=>1===parseInt(e.viewportId)));e=t.length>0?t[0]:n[0];let{centerPoint:r,width_paperSpace:i,height_paperSpace:l}=e,h=Qr.getDcs2WcsMatrix(e,o),c=new F(r.x,r.y,0);c.applyMatrix4(h),a={x:c.x-i/2,y:c.y-l/2,z:0},s={x:c.x+i/2,y:c.y+l/2,z:0}}return r.set(a.x,a.y,a.z),i.set(s.x,s.y,s.z),new Vt(r,i)}getLayoutViewports(e){return this.layoutViewportsMap[e.ownerHandle]||[]}getLayoutLevelObject(e){let t=this.getModelObject();return null==t?void 0:t.children.find((t=>t.name===e))}setVisible(e){this.getModelObject().visible=e}setLayerVisible(e,t,r,i){let n=this.getLayer(e);n?n.visible=t:de.warn(`[Viewer] Layer '${e}' not found from modelData!`);let a=this.getObjectsByLayer(e);if(a)for(let e=0;e<a.length;e++){let n=a[e];r&&t&&i&&n.userData.visibleMinZoom&&i<n.userData.visibleMinZoom||(n.visible=t),(!1===t||null!=n.userData.layerVisible)&&(n.userData.layerVisible=t),n.userData.isSnapObject&&(n.visible?Qr.SHOW_SNAP_OBJECT?n.layers.enableAll():n.layers.set(11):Qr.SHOW_SNAP_OBJECT?n.layers.disableAll():n.layers.disable(11))}else de.info(`[Viewer] No object found for layer '${e}'`)}setLayerOpacity(e,t){if(!this.getLayer(e))throw new Error(`Failed to find layer by layerName '${e}'!`);let r=this.getObjectsByLayer(e);r?r.forEach((e=>{let r=e;if(r.material){r.userData.originalMaterial||(r.userData.originalMaterial=$i.cloneMaterial(r.material));let e=$i.cloneMaterial(r.material);$i.setMaterialOpacity(e,t),Qr.updateMaterialUniforms(e),r.material=e}})):de.info(`[Viewer] No object found for layer '${e}'`)}setLayerColor(e,t){if(!this.getLayer(e))throw new Error(`Failed to find layer by layerName '${e}'!`);let r=this.getObjectsByLayer(e);r?r.forEach((e=>{let r=e;if(r.material){r.userData.originalMaterial||(r.userData.originalMaterial=$i.cloneMaterial(r.material));let e=$i.cloneMaterial(r.material);$i.setMaterialColor(e,new dt(t)),Qr.updateMaterialUniforms(e),r.material=e}})):de.info(`[Viewer] No object found for layer '${e}'`)}resetLayerColor(e){if(!this.getLayer(e))throw new Error(`Failed to find layer by layerName '${e}'!`);let t=this.getObjectsByLayer(e);t?t.forEach((e=>{let t=e;t.material&&t.userData.originalMaterial&&(t.material.dispose(),t.material=t.userData.originalMaterial,delete t.userData.originalMaterial)})):de.info(`[Viewer] No object found for layer '${e}'`)}switchTransformMs(e){let t=this.msTransformMatrix;if(db.identity(),!t||!Ut.isMatrixValid(t)||t.equals(db))return;let r=this.getLayoutLevelObject(Qr.MODEL_LAYOUT_NAME);r&&(e===Qr.MODEL_LAYOUT_NAME?r.applyMatrix4(t):r.applyMatrix4(t.clone().invert()),r.updateMatrixWorld(!0))}activateLayout(e=Qr.MODEL_LAYOUT_NAME,t){this.switchTransformMs(e);let r=this.getLayoutByName(e);if(r){if(!t){let t=this.getLayoutViewports(r),i=[];t.length>0&&(i=t[0].frozenLayerHandles);let n=e!==Qr.MODEL_LAYOUT_NAME,a=this.getLayoutLevelObject(e);if(a){let t=[];a.traverse((r=>{this.addSpatialFilterSection(r,this.dxfData);let a=r;if(n&&a.material&&a.geometry){let r=a.userData.layerName;if(!this.isLayerFrozenForViewport(r,i))return;t.push(a);let n=-1,s=this.getObjectsByLayer(r);s&&(n=s.indexOf(a),n>=0&&s.splice(n,1)),n<0&&de.warn(`[Viewer] Failed to find object for modelId '${this.modelId}', layer '${r}', layout '${e}'`)}})),t.forEach((e=>{e.removeFromParent()}))}let s=this.getFilteredViewports(r);de.debug("[Viewer] Active layout:",e,", viewports:",s);let o=Date.now();s.forEach((t=>{this.generateObjectsByViewport(e,t,this)})),de.info(`[Viewer] generateObjectsByViewport in ${(Date.now()-o)/1e3}s`)}this.showLayoutObjects(e)}}getFilteredViewports(e){let t=this.getLayoutViewports(e),r=t.filter((e=>"1"!==e.viewportId));return r.length===t.length&&(r=t.filter(((e,t)=>0!==t))),r}generateObjectsByViewport(e,t,r,i=[]){let n=t;if("1"==t.viewportId)return;if(!n.psBBox||!n.msToPsMatrix)throw new Error("The bbox or matrix is invalid in the viewport!");Qr.TransformMatrixUniform={value:n.msToPsMatrix},Qr.ViewportScaleUniform={value:t.viewHeight/t.height_paperSpace};let a=n.psBBox.clone();a.applyMatrix4(n.msToPsMatrix.clone().invert()),a.min.setZ(-1),a.max.setZ(1);let s=this.getObjectsByBoundingBox(a);if(0===s.length)return;let o,l=n.psBBox.min,h=n.psBBox.max,c=new ts(new Te(l.x,l.y),new Te(h.x,h.y)),u=Ih.generateSectionPlanesByBox(c),d=[],p=e=>(d[e.id]||(d[e.id]=e.clone(),this.setMaterialUniforms(d[e.id],r.dxfData),Ih.setMaterialSection(d[e.id],u)),d[e.id]),f=[...i,...t.frozenLayerHandles||[]];if(e!==Qr.MODEL_LAYOUT_NAME){let e=t;e.associatedLeafObjectSet||(e.associatedLeafObjectSet=new Set),o=e.associatedLeafObjectSet}let m=new Xr;m.name=t.viewportId;let g=[];if(s.forEach((t=>{let i=t.clone();i.traverse((t=>{if(t.material&&t.geometry){let i=t.userData.layerName;if(this.isLayerFrozenForViewport(i,f))return void g.push(t);!1!==t.userData.layerVisible&&(t.visible=!0),t.material=(e=>{if(Array.isArray(e)){let t=[];return e.forEach((e=>{let r=p(e);t.push(r)})),t}return p(e)})(t.material),null==o||o.add(t);let n=r.getObjectsByLayer(i);n?n.push(t):de.warn(`[Viewer] Failed to find object for modelId '${this.modelId}', layer '${i}', layout '${e}'`)}})),m.add(i)})),o&&0===o.size)return;let v=r.getModelObject(),y=r.getLayoutLevelObject(e);y||(y=new Xr,pn.setSharedVariablesOfObject(y),y.name=e,null==v||v.add(y)),y.add(m),m.applyMatrix4(n.msToPsMatrix),m.updateMatrixWorld(!0);let b=y.children.find((e=>e.name===Qr.SNAP_GROUP_NAME));b||(b=new Xr,b.visible=Qr.SHOW_SNAP_OBJECT,b.name=Qr.SNAP_GROUP_NAME,y.add(b));let x=r.getLayoutLevelObject(Qr.MODEL_LAYOUT_NAME),_=null==x?void 0:x.children.find((e=>e.name===Qr.SNAP_GROUP_NAME));_&&_.traverse((e=>{if(!e.geometry)return;let t=e.userData.layerName;if(this.isLayerFrozenForViewport(t,f)||(LG.makeEmpty(),LG.expandByObject(e),!a.intersectsBox(LG)))return;let i=e.clone();pn.setSharedVariablesOfObject(i);let s=i.parent,l=db.identity();for(;s&&!0!==s.userData.isLayoutLevelObject;)l.premultiply(s.matrix),s=s.parent;l.premultiply(n.msToPsMatrix),i.applyMatrix4(l),null==b||b.add(i),null==o||o.add(i);let h=r.getObjectsByLayer(t);h&&h.push(i)})),g.length>0&&pn.removeEmptyObjectsFromRemovingObjects(g,m),m.traverse((e=>{pn.setSharedVariablesOfObject(e),this.addSpatialFilterSection(e,r.dxfData,!0)}))}setMaterialUniforms(e,t){e instanceof xr&&(e.uniforms.u_cameraZoom&&(e.uniforms.u_cameraZoom=Qr.CameraZoomUniform),e.uniforms.u_viewportScale&&1===(null==t?void 0:t.header.$PSLTSCALE)&&(e.uniforms.u_viewportScale=Qr.ViewportScaleUniform))}getObjectsByBoundingBox(e){let t=[];if(e.isEmpty())return de.warn("[Viewer] bbox is empty !"),t;let r=this.getLayoutLevelObject(Qr.MODEL_LAYOUT_NAME);return r&&r.children.forEach((r=>{r.name!==Qr.SNAP_GROUP_NAME&&(r=>{let i=bc.getBoundingBox(r,!1);e.intersectsBox(i)&&t.push(r)})(r)})),t}showLayoutObjects(e){let t=0,r=0,i=this.getModelObject();i.children.forEach((i=>{let n=i.name===e;i.visible=n,n?t++:r++})),de.debug(`[Viewer] showLayoutObjects('${e}') sets ${t} layout level object(s) to visible and ${r} to hidden for model '${null==i?void 0:i.name}'`)}isLayerFrozenForViewport(e,t){let r=this.getLayer(e);return!!(r&&(1&r.flag)>0)||!(!t||t.length<=0)&&(r&&t.indexOf(r.handle)>=0)}addSpatialFilterSection(e,t,r=!1){if("INSERT"!==e.userData.entityType||!e.userData.spatialFilterHandle)return;let i=this.findSpatialFilter(e.userData.spatialFilterHandle,t);if(i){let t=r,n=!1,a=this.getAnyMaterial(e);if(a&&(a.clippingPlanes&&(t=a.clippingPlanes.length>0),n=a.clipIntersection),t&&n!==i.clipPolylines[0].bReversed)return void de.warn("[Viewer] Material cannot set clipIntersection to different values at the same time. clipIntersection needs to be set to true here!");n=i.clipPolylines[0].bReversed;let s=this.generateSectionsBySpatialFilter(i,e.matrixWorld);if(s){let r=e=>{let t=0;return e.clippingPlanes&&(t=e.clippingPlanes.length),t+s.length>Qr.MaxFragmentUniforms},i=new Set,a=e=>{i.has(e.id)||(i.add(e.id),r(e)||Ih.setMaterialSection(e,s,t,n))};e.traverse((e=>{let t=e.material;Array.isArray(t)?t.forEach((e=>{a(e)})):t&&a(t)}))}}}findSpatialFilter(e,t){let r,i=t.objects.SPATIAL_FILTER;if(i){for(let t of i)if(t.handle===e){r=t;break}return r}}getAnyMaterial(e){let t,r=e;if(r.material)return Array.isArray(r.material)?r.material[0]:r.material;for(let r=0;r<e.children.length&&(t=this.getAnyMaterial(e.children[r]),!t);r++);return t}generateSectionsBySpatialFilter(e,t){let r=e.clipPolylines[0];if(r.bConcave)return void de.warn("[Viewer] clipPolyline.bConcave = true is not supported yet in spatialFilter !");db.copy(t),e.localMatrix&&db.multiply(e.localMatrix);let i=r.polyline,n=[];i.forEach((e=>{let t=e.clone().applyMatrix4(db);n.push(new Te(t.x,t.y))}));let a=$s.isClockWise(n),s=!a&&!r.bReversed||a&&r.bReversed;return Ih.generateSectionPlanesByPoints(n,s)}hasObject(e){return!!this.modelObject.getObjectById(e.id)}hasObjectWithId(e){return!!this.modelObject.getObjectById(e)}highlightObject(e){if(!this.hasObject(e))return;let t=$i.clonedHighlightMaterials(e,{depthTest:!1});t&&(e.userData.originalMaterial=e.material,e.material=t)}unHighlightObject(e){if(!this.hasObject(e))return;let t=e.material;e.material=e.userData.originalMaterial,delete e.userData.originalMaterial,Array.isArray(t)?t.forEach((e=>e.dispose())):t instanceof qn&&t.dispose()}clearHighlight(){}},fb=class extends sm{constructor(e){super(),this.modelId=e.modelId,this.bbox=e.bbox,this.modelObject=e.object,this.rootObject=new Xr,this.rootObject.name=`rootObject-${this.modelId}`,this.rootObject.userData.modelId=this.modelId,this.highlighUsage=new Xr,this.highlighUsage.name=`highlighUsage-${this.modelId}`,this.highlighUsage.layers.disable(12),this.transparentUsage=new Xr,this.transparentUsage.name=`transparentUsage-${this.modelId}`,this.transparentUsage.layers.disable(12),this.rootObject.add(this.modelObject),this.rootObject.add(this.highlighUsage),this.rootObject.add(this.transparentUsage)}getModelObject(){return this.rootObject}getBBox(){return this.bbox||(this.bbox=new Vt,this.bbox.setFromObject(this.getModelObject())),this.bbox}enableEdges(e,t){return bt(this,null,(function*(){e&&(this.edges||(this.edges=yield pn.createOutlines(this.getModelObject(),void 0,t))),this.edges&&this.edges.forEach((t=>t.visible=e))}))}setObjectColor(e,t){this.hasObject(e)&&e.material.color.set(t)}setObjectOpacity(e,t=.5,r,i){if(this.hasObject(e)){if(e instanceof ls&&i){let r=this.createInstanceMeshById(e,i,{opacity:t});r.material.opacity*=t,e.userData.instanceId=i,e.userData.transparentedMesh=r,this.transparentUsage.add(r)}else if(Zi.isMergedMesh(e)&&r){let i=this.createBatchMeshById(e,r,{opacity:t});i.material.opacity*=t,e.userData.batchId=r,e.userData.transparentedMesh=i,this.transparentUsage.add(i)}else{let t=new Mr({color:0,transparent:!0,opacity:.05});t&&(e.userData.originalMaterial=e.material,e.material=t)}e.userData.isTransparent=!0}}clearObjectOpacity(e,t,r){if(!this.isObjectTransparent(e))return;let{transparentedMesh:i,originalMaterial:n}=e.userData;i&&(this.transparentUsage.remove(i),delete e.userData.batchId,delete e.userData.instanceId,delete e.userData.transparentedMesh),n&&(e.material=n),delete e.userData.isTransparent}isObjectTransparent(e){let{isTransparent:t}=e.userData;return!!t}setOpacity(e=.5){this.getModelObject().traverse((t=>{t instanceof Ht&&this.setObjectOpacity(t,e)}))}clearOpacity(){this.getModelObject().traverse((e=>{e instanceof Ht&&this.clearObjectOpacity(e)}))}highlightObjectById(e,t,r){if(!this.hasObjectWithId(e))return;let i=this.getModelObject().getObjectById(e);i&&this.highlightObject(i,t,r)}highlightObject(e,t,r){if(!this.hasObject(e))return;let i=new dt(583902);if(e instanceof ls&&r){let t=this.createInstanceMeshById(e,r,{depthTest:!1});t.material.opacity=.7,$i.setMaterialColor(t.material,i),e.userData.instanceId=r,e.userData.clonedMesh=t,this.highlighUsage.add(t)}else if(Zi.isMergedMesh(e)&&t){let r=this.createBatchMeshById(e,t,{depthTest:!1});r.material.opacity=.7,$i.setMaterialColor(r.material,i),e.userData.batchId=t,e.userData.clonedMesh=r,this.highlighUsage.add(r)}else{let t=$i.clonedHighlightMaterials(e,{depthTest:!1});t&&(e.userData.originalMaterial=e.material,e.material=t)}e.userData.isHighlight=!0,this.highlighedObject=e}clearHighlight(){if(this.highlighedObject&&this.highlighedObject.userData){let e=this.highlighedObject.userData,{clonedMesh:t,originalMaterial:r,instanceId:i,originalMatrix:n}=e;t&&(t.removeFromParent(),t.geometry.dispose(),delete e.clonedMesh),i&&n&&(this.highlighedObject.setMatrixAt(i,n),delete e.instanceId,delete e.originalMatrix),r&&(this.highlighedObject.material=r,delete e.originalMaterial),delete e.isHighlight}this.highlighUsage.clear(),this.highlighedObject=void 0}setObjectVisible(e,t){this.hasObject(e)&&(e.visible=t)}setVisible(e){this.getModelObject().traverse((t=>{t instanceof Ht&&(t.visible=e)}))}hasVisibleObject(){let e=0;return this.modelObject.traverseVisible((t=>{t instanceof Ht&&e++})),e>0}hasInvisibleObject(){let e=0;return this.modelObject.traverse((t=>{t instanceof Ht&&e++})),this.modelObject.traverseVisible((t=>{t instanceof Ht&&e--})),e>0}createBatchMeshById(e,t,{opacity:r=1,depthTest:i=!0}){let n=Zi.getBatchByBatchId(e,t),a=`[Viewer] Clicked on merged mesh(id: ${e.id}).`;a+=` batchId: ${t}, object name: ${null==n?void 0:n.name}`,null!=n&&n.userData&&(a+=`\nuserData: ${JSON.stringify(n.userData)}`),null!=n&&n.parentUserData&&(a+=`\nparentUserData: ${JSON.stringify(n.parentUserData)}`),de.info(a);let s=$i.cloneMaterial(e.material);s.opacity=r,s.transparent=r<1,i||(s.depthTest=i,s.depthWrite=i,s.side=ln);let o=Zi.cloneGeometryForBatch(e,n),l=new Ht(o,s);return l.applyMatrix4(e.matrixWorld),l.matrixWorldNeedsUpdate=!0,l.name="Cloned mesh for highlighting",l.layers.enableAll(),l}createInstanceMeshById(e,t,{opacity:r=1,depthTest:i=!0}){let n=e,a=new lt,s=new lt;s.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),n.getMatrixAt(t,a);let o=$i.cloneMaterial(n.material);o.opacity=r,o.transparent=r<1,i||(o.depthTest=i,o.depthWrite=i,o.side=ln);let l=new Ht(n.geometry.clone(),o);l.applyMatrix4(e.matrixWorld.multiply(a)),l.matrixWorldNeedsUpdate=!0,l.name="Cloned mesh for highlighting",l.layers.enableAll();let h=a.clone();return h.multiplyMatrices(a,s),n.setMatrixAt(t,h),n.instanceMatrix.needsUpdate=!0,n.updateMatrix(),e.userData.originalMatrix=a,l}setClipPlanes(e){this.getModelObject().traverse((t=>{t.material&&(Array.isArray(t.material)?t.material.forEach((t=>{t.clippingPlanes=e,t.clipIntersection=!1})):t.material&&(t.material.clippingPlanes=e,t.material.clipIntersection=!1))}))}getObjectTree(){}hasObject(e){return!!this.modelObject.getObjectById(e.id)}hasObjectWithId(e){return!!this.modelObject.getObjectById(e)}},Ow=class extends Ss{constructor(e){super(e),this.isBimTilesMaterial=!0,this.type="BimTilesMaterial",this.defaultOutlineColor=new dt(Q_[0],Q_[1],Q_[2]),this.useBCOutline=!1,this.outlineVisible=!0;let t=e.stateTexture;this.stateTexture=t;let{uniforms:r,fragmentShader:i,vertexShader:n}=Ia.standard;this.uniforms=xi.merge([r,{uTextureWidth:{value:t.image.width},uTextureHeight:{value:t.image.height},outlineColor:{value:this.defaultOutlineColor}}]),this.uniforms.uStateTexture={value:t},this.vertexShader=n.replace("#include <common>","\n                #include <common>\n                #include <id_pars_vertex>\n                #include <outline_bc_pars_vertex>").replace("#include <color_vertex>","\n                #include <color_vertex>\n                #include <id_vertex>\n                #include <outline_bc_vertex>"),this.fragmentShader=i.replace("#include <common>","\n                #include <common>\n                #include <common_ex>\n                #include <state_pars_fragment>\n                #include <outline_bc_pars_fragment>").replace("#include <logdepthbuf_fragment>","\n                #include <state_fragment>\n                #include <logdepthbuf_fragment>").replace("#include <dithering_fragment>","\n                #include <dithering_fragment>\n                #include <outline_bc_fragment>")}setOutlineVisible(e){this.outlineVisible=e,this.useBCOutline&&this.outlineVisible?this.defines.USE_BC_OUTLINE="":delete this.defines.USE_BC_OUTLINE}enableOutline(e){this.useBCOutline=e,this.useBCOutline&&this.outlineVisible?this.defines.USE_BC_OUTLINE="":delete this.defines.USE_BC_OUTLINE}setOutLineColor(e){let t=e||this.defaultOutlineColor;this.uniforms.outlineColor={value:t}}setValues(e){this.stateTexture=e.stateTexture,super.setValues(e)}},YI=class extends xr{constructor(e){super(e),this.isBimTilesPickMaterial=!0,this.type="BimTilesPickMaterial";let t=e.stateTexture;this.stateTexture=t,this.uniforms={uTextureWidth:{value:t.image.width},uTextureHeight:{value:t.image.height},uStateTexture:{value:t}},this.vertexShader=yP,this.fragmentShader=bP,this.clipping=!0}setValues(e){this.stateTexture=e.stateTexture,super.setValues(e)}},$I=class extends Ss{constructor(e){super(e),this.isBimTilesHighlightMaterial=!0,this.type="BimTilesHighlightMaterial",this.transparent=!0,this.opacity=Ph,this.depthTest=!1,this.side=ln;let t=e.stateTexture;this.stateTexture=t;let{uniforms:r,fragmentShader:i,vertexShader:n}=Ia.standard;this.uniforms=xi.merge([r,{uTextureWidth:{value:t.image.width},uTextureHeight:{value:t.image.height}}]),this.uniforms.uStateTexture={value:t},this.vertexShader=n.replace("#include <common>","\n                #include <common>\n                #include <id_pars_vertex>").replace("#include <begin_vertex>","\n                #include <begin_vertex>\n                #include <id_vertex>"),this.fragmentShader=i.replace("#include <common>","\n                #include <common>\n                #include <common_ex>\n                #include <state_pars_fragment>\n                ").replace("#include <logdepthbuf_fragment>","\n                #include <state_highlight_fragment>\n                #include <logdepthbuf_fragment>")}setValues(e){this.stateTexture=e.stateTexture,super.setValues(e)}},ZI=class extends Ss{constructor(e){super(e),this.isBimTilesTransparentMaterial=!0,this.type="BimTilesTransparentMaterial",this.transparent=!0,this.opacity=Ph,this.side=zi;let t=e.stateTexture;this.stateTexture=t;let{uniforms:r,fragmentShader:i,vertexShader:n}=Ia.standard;this.uniforms=xi.merge([r,{uTextureWidth:{value:t.image.width},uTextureHeight:{value:t.image.height}}]),this.uniforms.uStateTexture={value:t},this.vertexShader=n.replace("#include <common>","\n                #include <common>\n                #include <id_pars_vertex>").replace("#include <begin_vertex>","\n                #include <begin_vertex>\n                #include <id_vertex>"),this.fragmentShader=i.replace("#include <common>","\n                #include <common>\n                #include <common_ex>\n                #include <state_pars_fragment>\n                ").replace("#include <logdepthbuf_fragment>","\n                #include <state_transparent_fragment>\n                #include <logdepthbuf_fragment>")}setValues(e){this.stateTexture=e.stateTexture,super.setValues(e)}},KI=class{constructor(e,t){this.batchMaterialMap=new Map,this.instanceMaterialMap=new Map,this.tileRenderer=e,this.stateTexture=this.createStateTexture(t.maxId)}createBatchMaterial(e,t={},r=!1){let i=e+Number(r);if(!this.batchMaterialMap.get(i)){let e=new Ow(Ii(on({},t),{vertexColors:!0,stateTexture:this.stateTexture}));r&&e.enableOutline(!0),this.batchMaterialMap.set(i,e)}return this.batchMaterialMap.get(i)}createInstanceMaterial(e,t={},r=!1){let i=e+Number(r);if(!this.instanceMaterialMap.get(i)){let e=new Ow(Ii(on({},t),{stateTexture:this.stateTexture}));r&&e.enableOutline(!0),this.instanceMaterialMap.set(i,e)}return this.instanceMaterialMap.get(i)}get highlightMaterial(){return this._highlightMaterial||(this._highlightMaterial=new $I({transparent:!0,color:0,stateTexture:this.stateTexture})),this._highlightMaterial}get transparentMaterial(){return this._transparentMaterial||(this._transparentMaterial=new ZI({transparent:!0,color:0,stateTexture:this.stateTexture})),this._transparentMaterial}get pickMaterial(){return this._pickMaterial||(this._pickMaterial=new YI({stateTexture:this.stateTexture})),this._pickMaterial}createStateTexture(e){e+=1;let t=Tr.ceilPowerOfTwo(Math.sqrt(e)),r=Tr.ceilPowerOfTwo(Math.ceil(e/t));return new _o(new Uint8Array(t*r*4),t,r,gs,wl)}updateState(e,t,r,i){let n=this.stateTexture.image.data;for(let a=0;a<t.length;a++){let s=4*t[a];switch(e){case 0:case 3:n[s]=this.setFlag(n[s],e,r);break;case 1:{n[s]=this.setFlag(n[s],e,r);let t=0;r&&null!=i&&(t=this.opacity2Int8(i)),n[s+1]=t,n[s]=this.setFlag(n[s],3,!1),n[s]=this.setFlag(n[s],2,!1)}break;case 2:n[s]=this.setFlag(n[s],3,!1),n[s]=this.setFlag(n[s],e,r)}}switch(e){case 1:this.setHiddenForTransparent(t,r);break;case 2:this.updateHighlightMesh()}this.updateMaterialStates()}setHiddenForTransparent(e,t){if(0===e.length)return;let r=Date.now(),i=this.stateTexture.image,n=this.stateTexture.image.data;for(let e=0;e<i.width*i.height;e++){let t=4*e;this.getFlag(n[t],1)?n[t+2]=this.setFlag(n[t],0,!1):n[t+2]=this.setFlag(n[t],0,!0)}t?this.updateClonedTransparentMesh(e):this.clearClonedTransparentMesh(e),de.info(`[BimTiles] setHiddenForTransparent costs ${(Date.now()-r)/1e3}s`)}updateClonedTransparentMesh(e){0!==e.length&&this.tileRenderer.forEachLoadedModel(((t,r)=>{let i=r.cached.scene.children,n=i.length;for(let r=0;r<n;r++){let n=i[r],a=n.userData.userIds;if(!a||n.sourceMesh)continue;let s=n.clonedMesh;for(let r=0;r<e.length;r++){let i=e[r];if(a.indexOf(i)>-1){if(s){s.userData.handleUserIds.has(i)||s.userData.handleUserIds.add(i);continue}this.cloneMeshForTransparent(t,n),n.clonedMesh.userData.handleUserIds.clear(),n.clonedMesh.userData.handleUserIds.add(i)}}}}))}clearClonedTransparentMesh(e){0!==e.length&&this.tileRenderer.forEachLoadedModel(((t,r)=>{let i=r.cached.scene.children,n=i.length;for(let t=0;t<n;t++){let r=i[t];if(!r||!r.userData.userIds||r.sourceMesh)continue;let n=r.clonedMesh;for(let t=0;t<e.length;t++){let r=e[t];n&&n.userData.handleUserIds.has(r)&&n.userData.handleUserIds.delete(r)}n&&0===n.userData.handleUserIds.size&&this.disposeClonedTransparentMesh(r)}}))}cloneMeshForTransparent(e,t){if(t.clonedMesh)return;let r=t.clone();r.userData={},r.userData.handleUserIds=new Set(t.userData.userIds),r.sourceMesh=t;let i=new Nt,n=t.geometry.getAttribute("position"),a=t.geometry.index,s=t.geometry.getAttribute("tileObjectId");i.setAttribute("position",n),i.setAttribute("tileObjectId",s),a&&i.setIndex(a),r.geometry=i,r.material=this.transparentMaterial,t.clonedMesh=r,e.add(r)}disposeClonedTransparentMesh(e){e.clonedMesh&&(e.clonedMesh.removeFromParent(),e.clonedMesh=void 0)}updateAllClonedTransparentMesh(){this.tileRenderer.forEachLoadedModel(((e,t)=>{let r=t.cached.scene.children,i=r.length;for(let t=0;t<i;t++){let i=r[t];if(!i)break;!i.userData.userIds||i.sourceMesh||i.clonedMesh||this.cloneMeshForTransparent(e,i)}}))}clearAllClonedTransparentMesh(){let e=[];this.tileRenderer.forEachLoadedModel(((t,r)=>{let i=r.cached.scene.children,n=i.length;for(let t=0;t<n;t++){let r=i[t];if(!r)break;!r.userData.userIds||r.sourceMesh||r.clonedMesh&&e.push(r)}}));for(let t=0;t<e.length;t++)this.disposeClonedTransparentMesh(e[t])}setHidden(e){let t=this.stateTexture.image,r=this.stateTexture.image.data;for(let i=0;i<t.width*t.height;i++){let t=4*i;r[t]=this.setFlag(r[t],0,e)}this.updateMaterialStates(),this.updateHighlightMesh()}setOpacity(e){let t=Date.now(),r=this.opacity2Int8(e),i=e<1,n=this.stateTexture.image,a=this.stateTexture.image.data;for(let e=0;e<n.width*n.height;e++){let t=4*e;a[t]=this.setFlag(a[t],1,i),a[t]=this.setFlag(a[t],3,!1),a[t]=this.setFlag(a[t],2,!1),a[t+1]=r,a[t+2]=this.setFlag(a[t],0,!i)}i?this.updateAllClonedTransparentMesh():this.clearAllClonedTransparentMesh(),this.updateMaterialStates(),de.info(`[BimTiles] setOpacity costs ${(Date.now()-t)/1e3}s`)}clearHovered(){let e=this.stateTexture.image,t=this.stateTexture.image.data;for(let r=0;r<e.width*e.height;r++){let e=4*r;t[e]=this.setFlag(t[e],3,!1)}this.updateMaterialStates()}updateHighlightMesh(){this.highlightMesh&&this.clearHighlightMesh();let e=this.getHighlightUserIds();if(0===e.length)return;let t=this.tileRenderer.getGeometryByUserIds(e);t?(this.highlightMesh=new Ht(t,this.highlightMaterial),this.tileRenderer.transparentUsage.add(this.highlightMesh)):de.warn("[BimTiles] Failed to get geometry by userIds:",e)}clearHighlightMesh(){this.disposeMesh(this.highlightMesh),this.highlightMesh=void 0}clearState(e){let t=this.stateTexture.image.data;for(let r=0;r<t.length;r+=4)t[r]=this.setFlag(t[r],e,!1);switch(e){case 1:this.setOpacity(1);break;case 2:this.updateHighlightMesh()}this.updateMaterialStates()}setClipPlanes(e){let t=e.length>0;this.batchMaterialMap.forEach((r=>{r.clippingPlanes=t?e:[],r.clipIntersection=!1,r.clipShadows=!0})),this.instanceMaterialMap.forEach((r=>{r.clippingPlanes=t?e:[],r.clipIntersection=!1,r.clipShadows=!0})),this.highlightMaterial.clippingPlanes=t?e:[],this.highlightMaterial.clipIntersection=!1,this.highlightMaterial.clipShadows=!0,this.pickMaterial.clippingPlanes=t?e:[],this.pickMaterial.clipIntersection=!1,this.pickMaterial.clipShadows=!0}resetState(){this.clearAllClonedTransparentMesh(),this.clearHighlightMesh(),this.clearHovered(),this.stateTexture.image.data.fill(0),this.updateMaterialStates()}updateMaterialStates(){this.stateTexture.needsUpdate=!0}dispose(){this.stateTexture.dispose(),this.batchMaterialMap.forEach((e=>e.dispose())),this.instanceMaterialMap.forEach((e=>e.dispose())),this.pickMaterial.dispose(),this.highlightMaterial.dispose(),this.transparentMaterial.dispose()}disposeMesh(e){e&&(e.removeFromParent(),e.geometry.dispose(),e.geometry.attributes={},e.geometry.index=null)}hasVisibleObject(){if(!this.stateTexture)return!1;let e=this.stateTexture.image,t=this.stateTexture.image.data;for(let r=0;r<e.width*e.height;r++){let e=4*r;if(this.getFlag(t[e],0))return!0}return!1}hasInvisibleObject(){if(!this.stateTexture)return!1;let e=this.stateTexture.image,t=this.stateTexture.image.data;for(let r=0;r<e.width*e.height;r++){let e=4*r;if(!this.getFlag(t[e],0))return!0}return!1}getTransparentUserIds(){if(!this.stateTexture)return[];let e=[],t=this.stateTexture.image,r=this.stateTexture.image.data;for(let i=0;i<t.width*t.height;i++){let t=4*i;this.getFlag(r[t],1)&&e.push(i)}return e}getHighlightUserIds(){if(!this.stateTexture)return[];let e=[],t=this.stateTexture.image,r=this.stateTexture.image.data;for(let i=0;i<t.width*t.height;i++){let t=4*i;this.getFlag(r[t],2)&&e.push(i)}return e}getHoveredObject(){if(!this.stateTexture)return;let e=this.stateTexture.image,t=this.stateTexture.image.data;for(let r=0;r<e.width*e.height;r++){let e=4*r;if(this.getFlag(t[e],3)){let e=r;return{tilesetId:this.tileRenderer.tilesetId,userId:e}}}}opacity2Int8(e){let t=Math.floor(255*e);return t<=0?t=1:t>=255&&(t=0),t}setFlag(e,t,r){let i=Number(t);if(r){return e|1<<i}return e&~(1<<i)}getFlag(e,t){return 0!=(e&1<<Number(t))}};function kG(e){let t;try{t=new URL(e,"http://fakehost.com/")}catch(e){return null}let r=t.pathname.split("/").pop(),i=r.lastIndexOf(".");return-1===i||i===r.length-1?null:r.substring(i+1)}function CAt(e){Promise.resolve().then(e)}var JI=class{constructor(){this.maxSize=800,this.minSize=600,this.unloadPercent=.05,this.itemSet=new Map,this.itemList=[],this.usedSet=new Set,this.callbacks=new Map,this.unloadPriorityCallback=null;let e=this.itemSet;this.defaultPriorityCallback=t=>e.get(t)}isFull(){return this.itemSet.size>=this.maxSize}add(e,t){let r=this.itemSet;if(r.has(e)||this.isFull())return!1;let i=this.usedSet,n=this.itemList,a=this.callbacks;return n.push(e),i.add(e),r.set(e,Date.now()),a.set(e,t),!0}remove(e){let t=this.usedSet,r=this.itemSet,i=this.itemList,n=this.callbacks;if(r.has(e)){n.get(e)(e);let a=i.indexOf(e);return i.splice(a,1),t.delete(e),r.delete(e),n.delete(e),!0}return!1}markUsed(e){let t=this.itemSet,r=this.usedSet;t.has(e)&&!r.has(e)&&(t.set(e,Date.now()),r.add(e))}markAllUnused(){this.usedSet.clear()}unloadUnusedContent(){let e=this.unloadPercent,t=this.minSize,r=this.itemList,i=this.itemSet,n=this.usedSet,a=this.callbacks,s=r.length-n.size,o=r.length-t,l=this.unloadPriorityCallback||this.defaultPriorityCallback;if(o>0&&s>0){r.sort(((e,t)=>{let r=n.has(e),i=n.has(t);return r&&i?0:r||i?r?1:-1:l(t)-l(e)}));let h=Math.min(o,s),c=Math.max(t*e,h*e),u=Math.min(c,s);u=Math.ceil(u);let d=r.splice(0,u);for(let e=0,t=d.length;e<t;e++){let t=d[e];a.get(t)(t),i.delete(t),a.delete(t)}}}scheduleUnload(e=!0){this.scheduled||(this.scheduled=!0,CAt((()=>{this.scheduled=!1,this.unloadUnusedContent(),e&&this.markAllUnused()})))}},Dw=class{constructor(){this.maxJobs=6,this.items=[],this.callbacks=new Map,this.currJobs=0,this.scheduled=!1,this.autoUpdate=!0,this.priorityCallback=()=>{throw new Error("PriorityQueue: PriorityCallback function not defined.")},this.schedulingCallback=e=>{requestAnimationFrame(e)},this._runjobs=()=>{this.tryRunJobs(),this.scheduled=!1}}sort(){let e=this.priorityCallback;this.items.sort(e)}add(e,t){return new Promise(((r,i)=>{let n=this.items,a=this.callbacks;n.push(e),a.set(e,((...e)=>t(...e).then(r).catch(i))),this.autoUpdate&&this.scheduleJobRun()}))}remove(e){let t=this.items,r=this.callbacks,i=t.indexOf(e);-1!==i&&(t.splice(i,1),r.delete(e))}tryRunJobs(){this.sort();let e=this.items,t=this.callbacks,r=this.maxJobs,i=this.currJobs;for(;r>i&&e.length>0;){i++;let r=e.pop(),n=t.get(r);t.delete(r),n(r).then((()=>{this.currJobs--,this.autoUpdate&&this.scheduleJobRun()})).catch((()=>{this.currJobs--,this.autoUpdate&&this.scheduleJobRun()}))}this.currJobs=i}scheduleJobRun(){this.scheduled||(this.schedulingCallback(this._runjobs),this.scheduled=!0)}},PAt=.0033528106647474805,q_e=-(6378137*PAt-6378137);function BG(e){return 3===e||4===e}function S0(e,t){return e.__lastFrameVisited===t&&e.__used}function j_e(e,t){e.__lastFrameVisited!==t&&(e.__lastFrameVisited=t,e.__used=!1,e.__inFrustum=!1,e.__isLeaf=!1,e.__visible=!1,e.__active=!1,e.__error=1/0,e.__distanceFromCamera=1/0,e.__childrenWereVisible=!1,e.__allChildrenLoaded=!1)}function W_e(e,t,r,i){if(i.ensureChildrenArePreprocessed(e),j_e(e,t),e.__used=!0,r.markUsed(e),e.__contentEmpty){let n=e.children;for(let e=0,a=n.length;e<a;e++)W_e(n[e],t,r,i)}}function X_e(e,t,r){if(r.ensureChildrenArePreprocessed(e),!e.__contentEmpty||e.__externalTileSet&&!BG(e.__loadingState))r.requestTileContents(e);else{let i=e.children;for(let e=0,n=i.length;e<n;e++){let n=i[e];n.__depthFromRenderedParent=t,X_e(n,t,r)}}}function NG(e,t=null,r=null,i=null,n=0){if(t&&t(e,i,n))return void(r&&r(e,i,n));let a=e.children;for(let i=0,s=a.length;i<s;i++)NG(a[i],t,r,e,n+1);r&&r(e,i,n)}function UG(e,t){t.ensureChildrenArePreprocessed(e);let r=t.stats,i=t.frameCount,n=t.errorTarget,a=t.maxDepth,s=t.loadSiblings,o=t.lruCache,l=t.stopAtEmptyTiles;if(j_e(e,i),!1===t.tileInView(e))return!1;if(e.__used=!0,o.markUsed(e),e.__inFrustum=!0,r.inFrustum++,(l||!e.__contentEmpty)&&!e.__externalTileSet&&(t.calculateError(e),e.__error<=n||t.maxDepth>0&&e.__depth+1>=a))return!0;let h=!1,c=e.children;for(let e=0,r=c.length;e<r;e++){let r=UG(c[e],t);h=h||r}if(h&&s)for(let e=0,r=c.length;e<r;e++){W_e(c[e],i,o,t)}return!0}function HG(e,t){let r=t.stats,i=t.frameCount;if(!S0(e,i))return;r.used++;let n=e.children,a=!1;for(let e=0,t=n.length;e<t;e++){let t=n[e];a=a||S0(t,i)}if(a){let r=!1,a=!0;for(let e=0,s=n.length;e<s;e++){let s=n[e];if(HG(s,t),r=r||s.__wasSetVisible||s.__childrenWereVisible,S0(s,i)){let e=s.__allChildrenLoaded||!s.__contentEmpty&&BG(s.__loadingState)||s.__externalTileSet&&4===s.__loadingState;a=a&&e}}e.__childrenWereVisible=r,e.__allChildrenLoaded=a}else e.__isLeaf=!0}function VG(e,t){let r=t.stats,i=t.frameCount;if(!S0(e,i))return;let n=e.parent,a=n?n.__depthFromRenderedParent:-1;e.__depthFromRenderedParent=a;let s=t.lruCache;if(e.__isLeaf)return e.__depthFromRenderedParent++,void(3===e.__loadingState?(e.__inFrustum&&(e.__visible=!0,r.visible++),e.__active=!0,r.active++):!s.isFull()&&(!e.__contentEmpty||e.__externalTileSet)&&t.requestTileContents(e));let o=(t.errorTarget+1)*t.errorThreshold,l=e.__error<=o,h=l||"ADD"===e.refine,c=!e.__contentEmpty,u=c||e.__externalTileSet,d=BG(e.__loadingState)&&u,p=e.__childrenWereVisible,f=e.children,m=e.__allChildrenLoaded;if(h&&c&&e.__depthFromRenderedParent++,h&&!d&&!s.isFull()&&u&&t.requestTileContents(e),(l&&!m&&!p&&d||"ADD"===e.refine&&d)&&(e.__inFrustum&&(e.__visible=!0,r.visible++),e.__active=!0,r.active++),"ADD"!==e.refine&&l&&!m&&d)for(let r=0,n=f.length;r<n;r++){let n=f[r];S0(n,i)&&!s.isFull()&&(n.__depthFromRenderedParent=e.__depthFromRenderedParent+1,X_e(n,n.__depthFromRenderedParent,t))}else for(let e=0,r=f.length;e<r;e++){let r=f[e];S0(r,i)&&VG(r,t)}}function zG(e,t){let r=S0(e,t.frameCount);if(r||e.__usedLastFrame){let i=!1,n=!1;r&&(i=e.__active,n=t.displayActiveTiles&&e.__active||e.__visible),!e.__contentEmpty&&3===e.__loadingState&&(e.__wasSetActive!==i&&t.setTileActive(e,i),e.__wasSetVisible!==n&&t.setTileVisible(e,n)),e.__wasSetActive=i,e.__wasSetVisible=n,e.__usedLastFrame=r;let a=e.children;for(let e=0,r=a.length;e<r;e++){zG(a[e],t)}}}var $_e=(e,t)=>e.__depth!==t.__depth?e.__depth>t.__depth?-1:1:e.__inFrustum!==t.__inFrustum?e.__inFrustum?1:-1:e.__used!==t.__used?e.__used?1:-1:e.__error!==t.__error?e.__error>t.__error?1:-1:e.__distanceFromCamera!==t.__distanceFromCamera?e.__distanceFromCamera>t.__distanceFromCamera?-1:1:0,IAt=e=>1/(e.__depthFromRenderedParent+1),eO=class{get rootTileSet(){let e=this.tileSets[this.rootURL];return!e||e instanceof Promise?null:e}get root(){let e=this.rootTileSet;return e?e.root:null}constructor(e){this.tileSets={},this.rootURL=e,this.fetchOptions={},this.preprocessURL=null;let t=new JI;t.unloadPriorityCallback=IAt;let r=new Dw;r.maxJobs=4,r.priorityCallback=$_e;let i=new Dw;i.maxJobs=1,i.priorityCallback=$_e,this.lruCache=t,this.downloadQueue=r,this.parseQueue=i,this.stats={parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0,this.errorTarget=6,this.errorThreshold=1/0,this.loadSiblings=!0,this.displayActiveTiles=!1,this.maxDepth=1/0,this.stopAtEmptyTiles=!0}traverse(e,t){let r=this.tileSets[this.rootURL];!r||!r.root||NG(r.root,((t,...r)=>(this.ensureChildrenArePreprocessed(t),!!e&&e(t,...r))),t)}update(){let e=this.stats,t=this.lruCache,r=this.tileSets,i=r[this.rootURL];if(!(this.rootURL in r))return void this.loadRootTileSet(this.rootURL);if(!i||!i.root)return;let n=i.root;e.inFrustum=0,e.used=0,e.active=0,e.visible=0,this.frameCount++,UG(n,this),HG(n,this),VG(n,this),zG(n,this),t.scheduleUnload()}parseTile(e,t,r){return null}disposeTile(e){}preprocessNode(e,t,r=null){if(e.content&&(!("uri"in e.content)&&"url"in e.content&&(e.content.uri=e.content.url,delete e.content.url),e.content.uri&&(e.content.uri=new URL(e.content.uri,t+"/").toString()),e.content.boundingVolume&&!("box"in e.content.boundingVolume||"sphere"in e.content.boundingVolume||"region"in e.content.boundingVolume)&&delete e.content.boundingVolume),e.parent=r,e.children=e.children||[],e.content&&e.content.uri){let t=kG(e.content.uri),r=Boolean(t&&"json"===t.toLowerCase());e.__externalTileSet=r,e.__contentEmpty=r}else e.__externalTileSet=!1,e.__contentEmpty=!0;e.__distanceFromCamera=1/0,e.__error=1/0,e.__inFrustum=!1,e.__isLeaf=!1,e.__usedLastFrame=!1,e.__used=!1,e.__wasSetVisible=!1,e.__visible=!1,e.__childrenWereVisible=!1,e.__allChildrenLoaded=!1,e.__wasSetActive=!1,e.__active=!1,e.__loadingState=0,e.__loadIndex=0,e.__loadAbort=null,e.__depthFromRenderedParent=-1,null===r?(e.__depth=0,e.refine=e.refine||"REPLACE"):(e.__depth=r.__depth+1,e.refine=e.refine||r.refine),e.__basePath=t}setTileActive(e,t){}setTileVisible(e,t){}calculateError(e){return 0}tileInView(e){return!0}ensureChildrenArePreprocessed(e){let t=e.children;for(let r=0,i=t.length;r<i;r++){let i=t[r];if("__depth"in i)break;this.preprocessNode(i,e.__basePath,e)}}resetFailedTiles(){let e=this.stats;0!==e.failed&&(this.traverse((e=>{4===e.__loadingState&&(e.__loadingState=0)})),e.failed=0)}fetchTileSet(e,t,r=null){return fetch(e,t).then((t=>{if(t.ok)return t.json();throw new Error(`TilesRenderer: Failed to load tileset "${e}" with status ${t.status} : ${t.statusText}`)})).then((t=>{let i=t.asset.version,[n,a]=i.split(".").map((e=>parseInt(e)));console.assert(n<=1,"TilesRenderer: asset.version is expected to be a 1.x or a compatible version."),1===n&&a>0&&console.warn("TilesRenderer: tiles versions at 1.1 or higher have limited support. Some new extensions and features may not be supported.");let s=e.replace(/\/[^\/]*\/?$/,"");return s=new URL(s,window.location.href).toString(),this.preprocessNode(t.root,s,r),t}))}loadRootTileSet(e){let t=this.tileSets;if(e in t)return t[e]instanceof Error?Promise.reject(t[e]):Promise.resolve(t[e]);{let r=this.fetchTileSet(this.preprocessURL?this.preprocessURL(e):e,this.fetchOptions).then((r=>{t[e]=r}));return r.catch((r=>{console.error(r),t[e]=r})),t[e]=r,r}}requestTileContents(e){if(0!==e.__loadingState)return;let t=this.stats,r=this.lruCache,i=this.downloadQueue,n=this.parseQueue,a=e.__externalTileSet;r.add(e,(e=>{1===e.__loadingState?(e.__loadAbort.abort(),e.__loadAbort=null):a?e.children.length=0:this.disposeTile(e),1===e.__loadingState?t.downloading--:2===e.__loadingState&&t.parsing--,e.__loadingState=0,e.__loadIndex++,n.remove(e),i.remove(e)})),e.__loadIndex++;let s=e.__loadIndex,o=new AbortController,l=o.signal;t.downloading++,e.__loadAbort=o,e.__loadingState=1;let h=a=>{e.__loadIndex===s&&("AbortError"!==a.name?(n.remove(e),i.remove(e),2===e.__loadingState?t.parsing--:1===e.__loadingState&&t.downloading--,t.failed++,console.error(`TilesRenderer : Failed to load tile at url "${e.content.uri}".`),console.error(a),e.__loadingState=4):r.remove(e))};a?i.add(e,(e=>{if(e.__loadIndex!==s)return Promise.resolve();let t=this.preprocessURL?this.preprocessURL(e.content.uri):e.content.uri;return this.fetchTileSet(t,Object.assign({signal:l},this.fetchOptions),e)})).then((r=>{e.__loadIndex===s&&(t.downloading--,e.__loadAbort=null,e.__loadingState=3,e.children.push(r.root))})).catch(h):i.add(e,(e=>{if(e.__loadIndex!==s)return Promise.resolve();let t=this.preprocessURL?this.preprocessURL(e.content.uri):e.content.uri;return fetch(t,Object.assign({signal:l},this.fetchOptions))})).then((t=>{if(e.__loadIndex===s){if(t.ok)return t.arrayBuffer();throw new Error(`Failed to load model with error code ${t.status}`)}})).then((r=>{if(e.__loadIndex===s)return t.downloading--,t.parsing++,e.__loadAbort=null,e.__loadingState=2,n.add(e,(e=>{if(e.__loadIndex!==s)return Promise.resolve();let t=kG(e.content.uri);return this.parseTile(r,e,t)}))})).then((()=>{e.__loadIndex===s&&(t.parsing--,e.__loadingState=3,e.__wasSetVisible&&this.setTileVisible(e,!0),e.__wasSetActive&&this.setTileActive(e,!0))})).catch(h)}dispose(){let e=this.lruCache,t=[];this.traverse((e=>(t.push(e),!1)));for(let r=0,i=t.length;r<i;r++)e.remove(t[r]);this.stats={parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0}};function tO(e){return(new TextDecoder).decode(e)}var yf=class{constructor(e,t,r,i){this.buffer=e,this.binOffset=t+r,this.binLength=i;let n=null;if(0!==r){let i=new Uint8Array(e,t,r);n=JSON.parse(tO(i))}else n={};this.header=n}getKeys(){return Object.keys(this.header)}getData(e,t,r=null,i=null){let n=this.header;if(!(e in n))return null;let a=n[e];if(a instanceof Object){if(Array.isArray(a))return a;{let n,{buffer:s,binOffset:o,binLength:l}=this,h=a.byteOffset||0,c=a.type||i,u=a.componentType||r;if("type"in a&&i&&a.type!==i)throw new Error("FeatureTable: Specified type does not match expected type.");switch(c){case"SCALAR":n=1;break;case"VEC2":n=2;break;case"VEC3":n=3;break;case"VEC4":n=4;break;default:throw new Error(`FeatureTable : Feature type not provided for "${e}".`)}let d,p=o+h,f=t*n;switch(u){case"BYTE":d=new Int8Array(s,p,f);break;case"UNSIGNED_BYTE":d=new Uint8Array(s,p,f);break;case"SHORT":d=new Int16Array(s,p,f);break;case"UNSIGNED_SHORT":d=new Uint16Array(s,p,f);break;case"INT":d=new Int32Array(s,p,f);break;case"UNSIGNED_INT":d=new Uint32Array(s,p,f);break;case"FLOAT":d=new Float32Array(s,p,f);break;case"DOUBLE":d=new Float64Array(s,p,f);break;default:throw new Error(`FeatureTable : Feature component type not provided for "${e}".`)}if(p+f*d.BYTES_PER_ELEMENT>o+l)throw new Error("FeatureTable: Feature data read outside binary body length.");return d}}return a}getBuffer(e,t){let{buffer:r,binOffset:i}=this;return r.slice(i+e,i+e+t)}},am=class extends yf{constructor(e,t,r,i,n){super(e,r,i,n),this.batchSize=t}getData(e,t=null,r=null){return super.getData(e,this.batchSize,t,r)}},kc=class{constructor(){this.fetchOptions={},this.workingPath=""}load(e){return fetch(e,this.fetchOptions).then((t=>{if(!t.ok)throw new Error(`Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()})).then((t=>(""===this.workingPath&&(this.workingPath=this.workingPathForURL(e)),this.parse(t))))}resolveExternalURL(e){return/^[^\\/]/.test(e)?this.workingPath+"/"+e:e}workingPathForURL(e){let t=e.split(/[\\/]/g);return t.pop(),t.join("/")+"/"}parse(e){throw new Error("LoaderBase: Parse not implemented.")}};function Bu(e){let t;if(t=e instanceof DataView?e:new DataView(e),"{"===String.fromCharCode(t.getUint8(0)))return null;let r="";for(let e=0;e<4;e++)r+=String.fromCharCode(t.getUint8(e));return r}var rO=class extends kc{parse(e){let t=new DataView(e),r=Bu(t);console.assert("b3dm"===r);let i=t.getUint32(4,!0);console.assert(1===i);let n=t.getUint32(8,!0);console.assert(n===e.byteLength);let a=t.getUint32(12,!0),s=t.getUint32(16,!0),o=t.getUint32(20,!0),l=t.getUint32(24,!0),h=e.slice(28,28+a+s),c=new yf(h,0,a,s),u=28+a+s,d=e.slice(u,u+o+l),p=new am(d,c.getData("BATCH_LENGTH"),0,o,l),f=u+o+l;return{version:i,featureTable:c,batchTable:p,glbBytes:new Uint8Array(e,f,n-f)}}},pb=class extends rO{constructor(e=Zo){super(),this.manager=e,this.adjustmentTransform=new lt}parse(e){let t=super.parse(e),r=t.glbBytes.slice().buffer;return new Promise(((e,i)=>{let n=this.manager,a=this.fetchOptions,s=n.getHandler("path.gltf")||new zh(n);"include"===a.credentials&&"cors"===a.mode&&s.setCrossOrigin("use-credentials"),"credentials"in a&&s.setWithCredentials("include"===a.credentials),a.headers&&s.setRequestHeader(a.headers);let o=this.workingPath;!/[\\/]$/.test(o)&&o.length&&(o+="/");let l=this.adjustmentTransform;s.parse(r,o,(r=>{let{batchTable:i,featureTable:n}=t,{scene:a}=r,s=n.getData("RTC_CENTER");s&&(a.position.x+=s[0],a.position.y+=s[1],a.position.z+=s[2]),r.scene.updateMatrix(),r.scene.matrix.multiply(l),r.scene.matrix.decompose(r.scene.position,r.scene.quaternion,r.scene.scale),r.batchTable=i,r.featureTable=n,a.batchTable=i,a.featureTable=n,e(r)}),i)}))}},nO=class extends kc{parse(e){let t=new DataView(e),r=Bu(t);console.assert("pnts"===r);let i=t.getUint32(4,!0);console.assert(1===i);let n=t.getUint32(8,!0);console.assert(n===e.byteLength);let a=t.getUint32(12,!0),s=t.getUint32(16,!0),o=t.getUint32(20,!0),l=t.getUint32(24,!0),h=e.slice(28,28+a+s),c=new yf(h,0,a,s),u=28+a+s,d=e.slice(u,u+o+l),p=new am(d,c.getData("BATCH_LENGTH")||c.getData("POINTS_LENGTH"),0,o,l);return Promise.resolve({version:i,featureTable:c,batchTable:p})}};function Z_e(e){let t=e>>11,r=e>>5&63,i=31&e;return[Math.round(t/31*255),Math.round(r/63*255),Math.round(i/31*255)]}var K_e={RGB:"color",POSITION:"position"},mb=class extends nO{constructor(e=Zo){super(),this.manager=e}parse(e){return super.parse(e).then((e=>bt(this,null,(function*(){let t,{featureTable:r}=e,i=new Ai,n=r.header.extensions,a=new F;if(n&&n["3DTILES_draco_point_compression"]){let{byteOffset:e,byteLength:a,properties:s}=n["3DTILES_draco_point_compression"],o=this.manager.getHandler("draco.drc");if(null==o)throw new Error("PNTSLoader: dracoLoader not available.");let l={};for(let e in s)if(e in K_e&&e in s){l[K_e[e]]=s[e]}let h={attributeIDs:l,attributeTypes:{position:"Float32Array",color:"Uint8Array"},useUniqueIDs:!0},c=r.getBuffer(e,a);t=yield o.decodeGeometry(c,h),t.attributes.color&&(i.vertexColors=!0)}else{let e=r.getData("POINTS_LENGTH"),n=r.getData("POSITION",e,"FLOAT","VEC3"),s=r.getData("RGB",e,"UNSIGNED_BYTE","VEC3"),o=r.getData("RGBA",e,"UNSIGNED_BYTE","VEC4"),l=r.getData("RGB565",e,"UNSIGNED_SHORT","SCALAR"),h=r.getData("CONSTANT_RGBA",e,"UNSIGNED_BYTE","VEC4"),c=r.getData("POSITION_QUANTIZED",e,"UNSIGNED_SHORT","VEC3"),u=r.getData("QUANTIZED_VOLUME_SCALE",e,"FLOAT","VEC3"),d=r.getData("QUANTIZED_VOLUME_OFFSET",e,"FLOAT","VEC3");if(t=new Nt,c){let r=new Float32Array(3*e);for(let t=0;t<e;t++)for(let e=0;e<3;e++){let i=3*t+e;r[i]=c[i]/65535*u[e]}a.x=d[0],a.y=d[1],a.z=d[2],t.setAttribute("position",new fr(r,3,!1))}else t.setAttribute("position",new fr(n,3,!1));if(null!==o)t.setAttribute("color",new fr(o,4,!0)),i.vertexColors=!0,i.transparent=!0,i.depthWrite=!1;else if(null!==s)t.setAttribute("color",new fr(s,3,!0)),i.vertexColors=!0;else if(null!==l){let r=new Uint8Array(3*e);for(let t=0;t<e;t++){let e=Z_e(l[t]);for(let i=0;i<3;i++){r[3*t+i]=e[i]}}t.setAttribute("color",new fr(r,3,!0)),i.vertexColors=!0}else if(null!==h){let e=new dt(h[0],h[1],h[2]);i.color=e;let t=h[3]/255;t<1&&(i.opacity=t,i.transparent=!0,i.depthWrite=!1)}}["BATCH_LENGTH","NORMAL","NORMAL_OCT16P"].forEach((e=>{e in r.header&&console.warn(`PNTSLoader: Unsupported FeatureTable feature "${e}" detected.`)}));let s=new Di(t,i);s.position.copy(a),e.scene=s,e.scene.featureTable=r;let o=r.getData("RTC_CENTER");return o&&(e.scene.position.x+=o[0],e.scene.position.y+=o[1],e.scene.position.z+=o[2]),e}))))}},iO=class extends kc{parse(e){let t=new DataView(e),r=Bu(t);console.assert("i3dm"===r);let i=t.getUint32(4,!0);console.assert(1===i);let n=t.getUint32(8,!0);console.assert(n===e.byteLength);let a=t.getUint32(12,!0),s=t.getUint32(16,!0),o=t.getUint32(20,!0),l=t.getUint32(24,!0),h=t.getUint32(28,!0),c=e.slice(32,32+a+s),u=new yf(c,0,a,s),d=32+a+s,p=e.slice(d,d+o+l),f=new am(p,u.getData("INSTANCES_LENGTH"),0,o,l),m=d+o+l,g=new Uint8Array(e,m,n-m),v=null,y=null;if(h)v=g,y=Promise.resolve();else{let e=this.resolveExternalURL(tO(g));y=fetch(e,this.fetchOptions).then((t=>{if(!t.ok)throw new Error(`I3DMLoaderBase : Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()})).then((e=>{v=new Uint8Array(e)}))}return y.then((()=>({version:i,featureTable:u,batchTable:f,glbBytes:v})))}},J_e=new F,jG=new F,WG=new F,Q_e=new F,XG=new dn,sO=new F,aO=new lt,gb=class extends iO{constructor(e=Zo){super(),this.manager=e,this.adjustmentTransform=new lt}resolveExternalURL(e){return this.manager.resolveURL(super.resolveExternalURL(e))}parse(e){return super.parse(e).then((e=>{let{featureTable:t,batchTable:r}=e,i=e.glbBytes.slice().buffer;return new Promise(((e,n)=>{let a=this.fetchOptions,s=this.manager,o=s.getHandler("path.gltf")||new zh(s);"include"===a.credentials&&"cors"===a.mode&&o.setCrossOrigin("use-credentials"),"credentials"in a&&o.setWithCredentials("include"===a.credentials),a.headers&&o.setRequestHeader(a.headers);let l=this.workingPath;/[\\/]$/.test(l)||(l+="/");let h=this.adjustmentTransform;o.parse(i,l,(i=>{let n=t.getData("INSTANCES_LENGTH"),a=t.getData("POSITION",n,"FLOAT","VEC3"),s=t.getData("NORMAL_UP",n,"FLOAT","VEC3"),o=t.getData("NORMAL_RIGHT",n,"FLOAT","VEC3"),l=t.getData("SCALE_NON_UNIFORM",n,"FLOAT","VEC3"),c=t.getData("SCALE",n,"FLOAT","SCALAR");["RTC_CENTER","QUANTIZED_VOLUME_OFFSET","QUANTIZED_VOLUME_SCALE","EAST_NORTH_UP","POSITION_QUANTIZED","NORMAL_UP_OCT32P","NORMAL_RIGHT_OCT32P"].forEach((e=>{e in t.header&&console.warn(`I3DMLoader: Unsupported FeatureTable feature "${e}" detected.`)}));let u=new Map,d=[];i.scene.traverse((e=>{if(e.isMesh){let{geometry:t,material:r}=e,i=new ls(t,r,n);i.position.copy(e.position),i.rotation.copy(e.rotation),i.scale.copy(e.scale),d.push(i),u.set(e,i)}}));let p=new F;for(let e=0;e<n;e++)p.x+=a[3*e+0]/n,p.y+=a[3*e+1]/n,p.z+=a[3*e+2]/n;u.forEach(((e,t)=>{let r=t.parent;r&&(r.remove(t),r.add(e),e.updateMatrixWorld(),e.position.copy(p).applyMatrix4(e.matrixWorld))}));for(let e=0;e<n;e++){Q_e.set(a[3*e+0]-p.x,a[3*e+1]-p.y,a[3*e+2]-p.z),s?(jG.set(s[3*e+0],s[3*e+1],s[3*e+2]),WG.set(o[3*e+0],o[3*e+1],o[3*e+2]),J_e.crossVectors(WG,jG).normalize(),aO.makeBasis(WG,jG,J_e),XG.setFromRotationMatrix(aO)):XG.set(0,0,0,1),c?sO.setScalar(c[e]):l?sO.set(l[3*e+0],l[3*e+1],l[3*e+2]):sO.set(1,1,1),aO.compose(Q_e,XG,sO).multiply(h);for(let t=0,r=d.length;t<r;t++)d[t].setMatrixAt(e,aO)}i.batchTable=r,i.featureTable=t,i.scene.batchTable=r,i.scene.featureTable=t,e(i)}),n)}))}))}},oO=class extends kc{parse(e){let t=new DataView(e),r=Bu(t);console.assert("cmpt"===r,'CMPTLoader: The magic bytes equal "cmpt".');let i=t.getUint32(4,!0);console.assert(1===i,'CMPTLoader: The version listed in the header is "1".');let n=t.getUint32(8,!0);console.assert(n===e.byteLength,"CMPTLoader: The contents buffer length listed in the header matches the file.");let a=t.getUint32(12,!0),s=[],o=16;for(let t=0;t<a;t++){let t=new DataView(e,o,12),r=Bu(t),i=t.getUint32(4,!0),n=t.getUint32(8,!0),a=new Uint8Array(e,o,n);s.push({type:r,buffer:a,version:i}),o+=n}return{version:i,tiles:s}}},lO=class extends oO{constructor(e=Zo){super(),this.manager=e,this.adjustmentTransform=new lt}parse(e){let t=super.parse(e),r=this.manager,i=this.adjustmentTransform,n=[];for(let e in t.tiles){let{type:a,buffer:s}=t.tiles[e];switch(a){case"b3dm":{let e=s.slice(),t=new pb(r);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions,t.adjustmentTransform.copy(i);let a=t.parse(e.buffer);n.push(a);break}case"pnts":{let e=s.slice(),t=new mb(r);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions;let i=t.parse(e.buffer);n.push(i);break}case"i3dm":{let e=s.slice(),t=new gb(r);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions,t.adjustmentTransform.copy(i);let a=t.parse(e.buffer);n.push(a);break}}}return Promise.all(n).then((e=>{let t=new Xr;return e.forEach((e=>{t.add(e.scene)})),{tiles:e,scene:t}}))}},cO=class{constructor(){this.name="CESIUM_RTC"}afterRoot(e){if(e.parser.json.extensions&&e.parser.json.extensions.CESIUM_RTC){let{center:t}=e.parser.json.extensions.CESIUM_RTC;t&&(e.scene.position.x+=t[0],e.scene.position.y+=t[1],e.scene.position.z+=t[2])}}},uO=class extends kc{constructor(e=Zo){super(),this.manager=e}parse(e){return new Promise(((t,r)=>{let i=this.manager,n=this.fetchOptions,a=i.getHandler("path.gltf")||i.getHandler("path.glb");a||(a=new zh(i),a.register((()=>new cO)),"include"===n.credentials&&"cors"===n.mode&&a.setCrossOrigin("use-credentials"),"credentials"in n&&a.setWithCredentials("include"===n.credentials),n.headers&&a.setRequestHeader(n.headers));let s=a.resourcePath||a.path||this.workingPath;!/[\\/]$/.test(s)&&s.length&&(s+="/"),a.parse(e,s,(e=>{t(e)}),r)}))}},hO=new lt,dO=class extends Xr{constructor(e){super(),this.name="TilesRenderer.TilesGroup",this.tilesRenderer=e}raycast(e,t){this.tilesRenderer.optimizeRaycast&&this.tilesRenderer.raycast(e,t)}updateMatrixWorld(e){if(this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldNeedsUpdate||e){null===this.parent?hO.copy(this.matrix):hO.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1;let e=hO.elements,t=this.matrixWorld.elements,r=!1;for(let i=0;i<16;i++){let n=e[i],a=t[i];if(Math.abs(n-a)>Number.EPSILON){r=!0;break}}if(r){this.matrixWorld.copy(hO);let e=this.children;for(let t=0,r=e.length;t<r;t++)e[t].updateMatrixWorld()}}}},pO=new lt,eTe=new Za,YG=new F,fO=[];function tTe(e,t){return e.distance-t.distance}function rTe(e,t,r){e.traverse((e=>{Object.getPrototypeOf(e).raycast.call(e,t,r)}))}function OAt(e,t){rTe(e,t,fO),fO.sort(tTe);let r=fO[0]||null;return fO.length=0,r}function $G(e,t,r,i=null){let{group:n,activeTiles:a}=e;e.ensureChildrenArePreprocessed(t),null===i&&(i=eTe,pO.copy(n.matrixWorld).invert(),i.copy(r.ray).applyMatrix4(pO));let s=[],o=t.children;for(let e=0,t=o.length;e<t;e++){let t=o[e];t.__used&&(null!==t.cached.boundingVolume.intersectRay(i,YG)&&(YG.applyMatrix4(n.matrixWorld),s.push({distance:YG.distanceToSquared(r.ray.origin),tile:t})))}s.sort(tTe);let l=null,h=1/0;if(a.has(t)){let e=OAt(t.cached.scene,r);e&&(l=e,h=e.distance*e.distance)}for(let t=0,n=s.length;t<n;t++){let n=s[t],a=n.distance,o=n.tile;if(a>h)break;let c=$G(e,o,r,i);if(c){let e=c.distance*c.distance;e<h&&(l=c,h=e)}}return l}function ZG(e,t,r,i,n=null){let{group:a,activeTiles:s}=e,{scene:o,boundingVolume:l}=t.cached;if(e.ensureChildrenArePreprocessed(t),null===n&&(n=eTe,pO.copy(a.matrixWorld).invert(),n.copy(r.ray).applyMatrix4(pO)),!t.__used||!l.intersectsRay(n))return;s.has(t)&&rTe(o,r,i);let h=t.children;for(let t=0,a=h.length;t<a;t++)ZG(e,h[t],r,i,n)}var Lw=class{constructor(e=new Vt,t=new lt){this.box=e.clone(),this.transform=t.clone(),this.inverseTransform=new lt,this.points=new Array(8).fill().map((()=>new F))}update(){let{points:e,inverseTransform:t,transform:r,box:i}=this;t.copy(r).invert();let{min:n,max:a}=i,s=0;for(let t=-1;t<=1;t+=2)for(let i=-1;i<=1;i+=2)for(let o=-1;o<=1;o+=2)e[s].set(t<0?n.x:a.x,i<0?n.y:a.y,o<0?n.z:a.z).applyMatrix4(r),s++}intersectsFrustum(e){let{points:t}=this,{planes:r}=e;for(let e=0;e<6;e++){let i=r[e],n=-1/0;for(let e=0;e<8;e++){let r=t[e],a=i.distanceToPoint(r);n=n<a?a:n}if(n<0)return!1}return!0}},$ir=new Wg,Zir=new F;function nTe(e){let{x:t,y:r,z:i}=e;e.x=i,e.y=t,e.z=r}function iTe(e){return-e+Math.PI/2}var sTe=new Wg,om=new F,Nu=new F,KG=new F,DAt=new F,aTe=new F,JG=new F,QG=new F,oTe=new F,LAt=1e-12,kAt=.1,mO=class{constructor(e=1,t=1,r=1){this.radius=new F(e,t,r)}constructLatLonFrame(e,t,r){return this.getCartographicToPosition(e,t,0,oTe),this.getCartographicToNormal(e,t,QG),this.getNorthernTangent(e,t,JG),aTe.crossVectors(JG,QG),r.makeBasis(aTe,JG,QG).setPosition(oTe)}getNorthernTangent(e,t,r,i=DAt){let n=1,a=e+1e-7;e>Math.PI/4&&(n=-1,a=e-1e-7);let s=this.getCartographicToNormal(e,t,Nu).normalize(),o=this.getCartographicToNormal(a,t,KG).normalize();return i.crossVectors(s,o).normalize().multiplyScalar(n),r.crossVectors(i,s).normalize()}getCartographicToPosition(e,t,r,i){this.getCartographicToNormal(e,t,om);let n=this.radius;Nu.copy(om),Nu.x*=Ga(n.x,2),Nu.y*=Ga(n.y,2),Nu.z*=Ga(n.z,2);let a=Math.sqrt(om.dot(Nu));return Nu.divideScalar(a),i.copy(Nu).addScaledVector(om,r)}getPositionToCartographic(e,t){this.getPositionToSurfacePoint(e,Nu),this.getPositionToNormal(e,om);let r=KG.subVectors(e,Nu);return t.lon=Math.atan2(om.y,om.x),t.lat=Math.asin(om.z),t.height=Math.sign(r.dot(e))*r.length(),t}getCartographicToNormal(e,t,r){return sTe.set(1,iTe(e),t),r.setFromSpherical(sTe).normalize(),nTe(r),r}getPositionToNormal(e,t){let r=this.radius;return t.copy(e),t.x/=Ga(r.x,2),t.y/=Ga(r.y,2),t.z/=Ga(r.z,2),t.normalize(),t}getPositionToSurfacePoint(e,t){let r=this.radius,i=1/Ga(r.x,2),n=1/Ga(r.y,2),a=1/Ga(r.z,2),s=e.x*e.x*i,o=e.y*e.y*n,l=e.z*e.z*a,h=s+o+l,c=Math.sqrt(1/h),u=Nu.copy(e).multiplyScalar(c);if(h<kAt)return isFinite(c)?t.copy(u):null;let d,p,f,m,g,v,y,b,x,_,w,S=KG.set(u.x*i*2,u.y*n*2,u.z*a*2),T=(1-c)*e.length()/(.5*S.length()),M=0;do{T-=M,f=1/(1+T*i),m=1/(1+T*n),g=1/(1+T*a),v=f*f,y=m*m,b=g*g,x=v*f,_=y*m,w=b*g,d=s*v+o*y+l*b-1,p=s*x*i+o*_*n+l*w*a,M=d/(-2*p)}while(Math.abs(d)>LAt);return t.set(e.x*f,e.y*m,e.z*g)}},lm=Math.PI,gO=lm/2,kw=new F,vb=new F,yb=new F,lTe=new lt,Fw=0,e7=[];function FAt(e=!1){return e?(e7[Fw]||(e7[Fw]=new F),Fw++,e7[Fw-1]):new F}function cTe(){Fw=0}var vO=class extends mO{constructor(e,t,r,i=-gO,n=gO,a=0,s=2*lm,o=0,l=0){super(e,t,r),this.latStart=i,this.latEnd=n,this.lonStart=a,this.lonEnd=s,this.heightStart=o,this.heightEnd=l}_getPoints(e=!1){let{latStart:t,latEnd:r,lonStart:i,lonEnd:n,heightStart:a,heightEnd:s}=this,o=Tr.mapLinear(.5,0,1,t,r),l=Tr.mapLinear(.5,0,1,i,n),h=Math.floor(i/gO)*gO,c=[[-lm/2,0],[lm/2,0],[0,h],[0,h+lm/2],[0,h+lm],[0,h+3*lm/2],[t,n],[r,n],[t,i],[r,i],[0,i],[0,n],[o,l],[t,l],[r,l],[o,i],[o,n]],u=[],d=c.length;for(let o=0;o<=1;o++){let l=Tr.mapLinear(o,0,1,a,s);for(let a=0,s=d;a<s;a++){let[s,o]=c[a];if(s>=t&&s<=r&&o>=i&&o<=n){let t=FAt(e);u.push(t),this.getCartographicToPosition(s,o,l,t)}}}return u}getBoundingBox(e,t){cTe();let{latStart:r,latEnd:i,lonStart:n,lonEnd:a}=this;if(i-r<lm/2){let e=Tr.mapLinear(.5,0,1,r,i),s=Tr.mapLinear(.5,0,1,n,a);this.getCartographicToNormal(e,s,yb),vb.set(0,0,1),kw.crossVectors(vb,yb),vb.crossVectors(kw,yb),t.makeBasis(kw,vb,yb)}else kw.set(1,0,0),vb.set(0,1,0),yb.set(0,0,1),t.makeBasis(kw,vb,yb);lTe.copy(t).invert();let s=this._getPoints(!0);for(let e=0,t=s.length;e<t;e++)s[e].applyMatrix4(lTe);e.makeEmpty(),e.setFromPoints(s)}getBoundingSphere(e,t){cTe();let r=this._getPoints(!0);e.makeEmpty(),e.setFromPoints(r,t)}},bf=new F,xf=new F,Ef=new F,hTe=new F,dTe=new F,fTe=new F,bb=new Za,yO=class{constructor(){this.sphere=null,this.obb=null,this.region=null,this.regionObb=null}intersectsRay(e){let t=this.sphere,r=this.obb||this.regionObb;return!(t&&!e.intersectsSphere(t)||r&&(bb.copy(e).applyMatrix4(r.inverseTransform),!bb.intersectsBox(r.box)))}intersectRay(e,t=null){let r=this.sphere,i=this.obb||this.regionObb,n=-1/0,a=-1/0;r&&e.intersectSphere(r,dTe)&&(n=r.containsPoint(e.origin)?0:e.origin.distanceToSquared(dTe)),i&&(bb.copy(e).applyMatrix4(i.inverseTransform),bb.intersectBox(i.box,fTe)&&(a=i.box.containsPoint(bb.origin)?0:bb.origin.distanceToSquared(fTe)));let s=Math.max(n,a);return s===-1/0?null:(e.at(Math.sqrt(s),t),t)}distanceToPoint(e){let t=this.sphere,r=this.obb||this.regionObb,i=-1/0,n=-1/0;return t&&(i=Math.max(t.distanceToPoint(e),0)),r&&(hTe.copy(e).applyMatrix4(r.inverseTransform),n=r.box.distanceToPoint(hTe)),i>n?i:n}intersectsFrustum(e){let t=this.obb||this.regionObb,r=this.sphere;return!(r&&!e.intersectsSphere(r)||t&&!t.intersectsFrustum(e))&&Boolean(r||t)}getOBB(e,t){let r=this.obb||this.regionObb;r?(e.copy(r.box),t.copy(r.transform)):(this.getAABB(e),t.identity())}getAABB(e){if(this.sphere)this.sphere.getBoundingBox(e);else{let t=this.obb||this.regionObb;e.copy(t.box).applyMatrix4(t.transform)}}getSphere(e){if(this.sphere)e.copy(this.sphere);else if(this.region)this.region.getBoundingSphere(e);else{let t=this.obb||this.regionObb;t.box.getBoundingSphere(e),e.applyMatrix4(t.transform)}}setObbData(e,t){let r=new Lw;bf.set(e[3],e[4],e[5]),xf.set(e[6],e[7],e[8]),Ef.set(e[9],e[10],e[11]);let i=bf.length(),n=xf.length(),a=Ef.length();bf.normalize(),xf.normalize(),Ef.normalize(),0===i&&bf.crossVectors(xf,Ef),0===n&&xf.crossVectors(bf,Ef),0===a&&Ef.crossVectors(bf,xf),r.transform.set(bf.x,xf.x,Ef.x,e[0],bf.y,xf.y,Ef.y,e[1],bf.z,xf.z,Ef.z,e[2],0,0,0,1).premultiply(t),r.box.min.set(-i,-n,-a),r.box.max.set(i,n,a),r.update(),this.obb=r}setSphereData(e,t,r,i,n){let a=new Sn;a.center.set(e,t,r),a.radius=i,a.applyMatrix4(n),this.sphere=a}setRegionData(e,t,r,i,n,a){let s=new vO(6378137,6378137,q_e,t,i,e,r,n,a),o=new Lw;s.getBoundingBox(o.box,o.transform),o.update(),this.region=s,this.regionObb=o}},mTe=Symbol("INITIAL_FRUSTUM_CULLED"),bO=new lt,t7=new lt,xb=new F,BAt=new F(1,0,0),NAt=new F(0,1,0);function pTe(e,t){e.traverse((e=>{e.frustumCulled=e[mTe]&&t}))}var Bw=class extends eO{get autoDisableRendererCulling(){return this._autoDisableRendererCulling}set autoDisableRendererCulling(e){this._autoDisableRendererCulling!==e&&(super._autoDisableRendererCulling=e,this.forEachLoadedModel((t=>{pTe(t,!e)})))}constructor(...e){super(...e),this.group=new dO(this),this.cameras=[],this.cameraMap=new Map,this.cameraInfo=[],this.activeTiles=new Set,this.visibleTiles=new Set,this._autoDisableRendererCulling=!0,this.optimizeRaycast=!0,this.onLoadTileSet=null,this.onLoadModel=null,this.onDisposeModel=null,this.onTileVisibilityChange=null;let t=new Sh;t.setURLModifier((e=>this.preprocessURL?this.preprocessURL(e):e)),this.manager=t;let r=this;this._overridenRaycast=function(e,t){r.optimizeRaycast||Object.getPrototypeOf(this).raycast.call(this,e,t)}}getBounds(e){if(!this.root)return!1;let t=this.root.cached.boundingVolume;return t&&t.getAABB(e),!0}getOrientedBounds(e,t){if(!this.root)return!1;let r=this.root.cached.boundingVolume;return r&&r.getOBB(e,t),!0}getBoundingSphere(e){if(!this.root)return!1;let t=this.root.cached.boundingVolume;return!!t&&(t.getSphere(e),!0)}forEachLoadedModel(e){this.traverse((t=>{let r=t.cached.scene;r&&e(r,t)}))}raycast(e,t){if(this.root)if(e.firstHitOnly){let r=$G(this,this.root,e);r&&t.push(r)}else ZG(this,this.root,e,t)}hasCamera(e){return this.cameraMap.has(e)}setCamera(e){let t=this.cameras,r=this.cameraMap;return!r.has(e)&&(r.set(e,new Te),t.push(e),!0)}setResolution(e,t,r){let i=this.cameraMap;return!!i.has(e)&&(t instanceof Te?i.get(e).copy(t):i.get(e).set(t,r),!0)}setResolutionFromRenderer(e,t){let r=this.cameraMap;if(!r.has(e))return!1;let i=r.get(e);return t.getSize(i),i.multiplyScalar(t.getPixelRatio()),!0}deleteCamera(e){let t=this.cameras,r=this.cameraMap;if(r.has(e)){let i=t.indexOf(e);return t.splice(i,1),r.delete(e),!0}return!1}fetchTileSet(e,...t){let r=super.fetchTileSet(e,...t);return r.then((t=>{this.onLoadTileSet&&Promise.resolve().then((()=>{this.onLoadTileSet(t,e)}))})),r}update(){let e=this.group,t=this.cameras,r=this.cameraMap,i=this.cameraInfo;if(0===t.length)return void console.warn("TilesRenderer: no cameras defined. Cannot update 3d tiles.");for(;i.length>t.length;)i.pop();for(;i.length<t.length;)i.push({frustum:new Ml,isOrthographic:!1,sseDenominator:-1,position:new F,invScale:-1,pixelSize:0});t7.copy(e.matrixWorld).invert(),xb.setFromMatrixScale(t7);let n=xb.x;Math.abs(Math.max(xb.x-xb.y,xb.x-xb.z))>1e-6&&console.warn("ThreeTilesRenderer : Non uniform scale used for tile which may cause issues when calculating screen space error.");for(let a=0,s=i.length;a<s;a++){let s=t[a],o=i[a],l=o.frustum,h=o.position,c=r.get(s);(0===c.width||0===c.height)&&console.warn("TilesRenderer: resolution for camera error calculation is not set.");let u=s.projectionMatrix.elements;if(o.isOrthographic=1===u[15],o.isOrthographic){let e=2/u[0],t=2/u[5];o.pixelSize=Math.max(t/c.height,e/c.width)}else o.sseDenominator=2/u[5]/c.height;o.invScale=n,bO.copy(e.matrixWorld),bO.premultiply(s.matrixWorldInverse),bO.premultiply(s.projectionMatrix),l.setFromProjectionMatrix(bO),h.set(0,0,0),h.applyMatrix4(s.matrixWorld),h.applyMatrix4(t7)}super.update()}preprocessNode(e,t,r=null){super.preprocessNode(e,t,r);let i=new lt;if(e.transform){let t=e.transform;for(let e=0;e<16;e++)i.elements[e]=t[e]}else i.identity();r&&i.premultiply(r.cached.transform);let n=(new lt).copy(i).invert(),a=new yO;"sphere"in e.boundingVolume&&a.setSphereData(...e.boundingVolume.sphere,i),"box"in e.boundingVolume&&a.setObbData(e.boundingVolume.box,i),"region"in e.boundingVolume&&a.setRegionData(...e.boundingVolume.region),e.cached={loadIndex:0,transform:i,transformInverse:n,active:!1,inFrustum:[],boundingVolume:a,scene:null,geometry:null,material:null}}parseTile(e,t,r){t._loadIndex=t._loadIndex||0,t._loadIndex++;let i=t.content.uri.split(/[\\\/]/g);i.pop();let n=i.join("/"),a=this.fetchOptions,s=this.manager,o=t._loadIndex,l=null,h=this.rootTileSet.asset&&this.rootTileSet.asset.gltfUpAxis||"y",c=t.cached,u=c.transform,d=new lt;switch(h.toLowerCase()){case"x":d.makeRotationAxis(NAt,-Math.PI/2);break;case"y":d.makeRotationAxis(BAt,Math.PI/2);break;case"z":d.identity()}let p=(Bu(e)||r).toLowerCase();switch(p){case"b3dm":{let t=new pb(s);t.workingPath=n,t.fetchOptions=a,t.adjustmentTransform.copy(d),l=t.parse(e);break}case"pnts":{let t=new mb(s);t.workingPath=n,t.fetchOptions=a,l=t.parse(e);break}case"i3dm":{let t=new gb(s);t.workingPath=n,t.fetchOptions=a,t.adjustmentTransform.copy(d),l=t.parse(e);break}case"cmpt":{let t=new lO(s);t.workingPath=n,t.fetchOptions=a,t.adjustmentTransform.copy(d),l=t.parse(e).then((e=>e.scene));break}case"gltf":case"glb":let t=new uO(s);t.workingPath=n,t.fetchOptions=a,l=t.parse(e);break;default:console.warn(`TilesRenderer: Content type "${p}" not supported.`),l=Promise.resolve(null)}return l.then((e=>{let r,i;if(e.isObject3D?(r=e,i=null):(r=e.scene,i=e),t._loadIndex!==o)return;r.updateMatrix(),("glb"===p||"gltf"===p)&&r.matrix.multiply(d),r.matrix.premultiply(u),r.matrix.decompose(r.position,r.quaternion,r.scale),r.traverse((e=>{e[mTe]=e.frustumCulled})),pTe(r,!this.autoDisableRendererCulling),r.traverse((e=>{e.raycast=this._overridenRaycast}));let n=[],a=[],s=[];r.traverse((e=>{if(e.geometry&&a.push(e.geometry),e.material){let t=e.material;n.push(e.material);for(let e in t){let r=t[e];r&&r.isTexture&&s.push(r)}}})),c.materials=n,c.geometry=a,c.textures=s,c.scene=r,c.metadata=i,this.onLoadModel&&this.onLoadModel(r,t)}))}disposeTile(e){let t=e.cached;if(t.scene){let r=t.materials,i=t.geometry,n=t.textures,a=t.scene.parent;for(let e=0,t=i.length;e<t;e++)i[e].dispose();for(let e=0,t=r.length;e<t;e++)r[e].dispose();for(let e=0,t=n.length;e<t;e++)n[e].dispose();a&&a.remove(t.scene),this.onDisposeModel&&this.onDisposeModel(t.scene,e),t.scene=null,t.materials=null,t.textures=null,t.geometry=null,t.metadata=null}this.activeTiles.delete(e),this.visibleTiles.delete(e),e._loadIndex++}setTileVisible(e,t){let r=e.cached.scene,i=this.visibleTiles,n=this.group;t?(n.add(r),i.add(e),r.updateMatrixWorld(!0)):(n.remove(r),i.delete(e)),this.onTileVisibilityChange&&this.onTileVisibilityChange(r,e,t)}setTileActive(e,t){let r=this.activeTiles;t?r.add(e):r.delete(e)}calculateError(e){let t=e.cached,r=t.inFrustum,i=this.cameras,n=this.cameraInfo,a=t.boundingVolume,s=-1/0,o=1/0;for(let t=0,l=i.length;t<l;t++){if(!r[t])continue;let i,l=n[t],h=l.invScale;if(l.isOrthographic){let t=l.pixelSize;i=e.geometricError/(t*h)}else{let t=a.distanceToPoint(l.position)*h,r=l.sseDenominator;i=e.geometricError/(t*r),o=Math.min(o,t)}s=Math.max(s,i)}e.__distanceFromCamera=o,e.__error=s}tileInView(e){let t=e.cached,r=t.boundingVolume,i=t.inFrustum,n=this.cameraInfo,a=!1;for(let e=0,t=n.length;e<t;e++){let t=n[e].frustum;r.intersectsFrustum(t)?(a=!0,i[e]=!0):i[e]=!1}return a}},BMe=ra(pSe(),1);function Ob(e){let t=e.length;for(;--t>=0;)e[t]=0}var ZRt=0,QSe=1,KRt=2,JRt=3,QRt=258,vq=29,cS=256,tS=cS+1+vq,Cb=30,yq=19,eMe=2*tS+1,I0=15,Y7=16,eCt=7,bq=256,tMe=16,rMe=17,nMe=18,lq=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),YO=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),tCt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),iMe=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),rCt=512,Mf=new Array(2*(tS+2));Ob(Mf);var Jw=new Array(2*Cb);Ob(Jw);var rS=new Array(rCt);Ob(rS);var nS=new Array(QRt-JRt+1);Ob(nS);var xq=new Array(vq);Ob(xq);var $O=new Array(Cb),sMe,aMe,oMe;function $7(e,t,r,i,n){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=i,this.max_length=n,this.has_stree=e&&e.length}function Z7(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Ob($O);var lMe=e=>e<256?rS[e]:rS[256+(e>>>7)],iS=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},al=(e,t,r)=>{e.bi_valid>Y7-r?(e.bi_buf|=t<<e.bi_valid&65535,iS(e,e.bi_buf),e.bi_buf=t>>Y7-e.bi_valid,e.bi_valid+=r-Y7):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},Jh=(e,t,r)=>{al(e,r[2*t],r[2*t+1])},cMe=(e,t)=>{let r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1},nCt=e=>{16===e.bi_valid?(iS(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)},iCt=(e,t)=>{let r,i,n,a,s,o,l=t.dyn_tree,h=t.max_code,c=t.stat_desc.static_tree,u=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,f=t.stat_desc.max_length,m=0;for(a=0;a<=I0;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<eMe;r++)i=e.heap[r],a=l[2*l[2*i+1]+1]+1,a>f&&(a=f,m++),l[2*i+1]=a,!(i>h)&&(e.bl_count[a]++,s=0,i>=p&&(s=d[i-p]),o=l[2*i],e.opt_len+=o*(a+s),u&&(e.static_len+=o*(c[2*i+1]+s)));if(0!==m){do{for(a=f-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[f]--,m-=2}while(m>0);for(a=f;0!==a;a--)for(i=e.bl_count[a];0!==i;)n=e.heap[--r],!(n>h)&&(l[2*n+1]!==a&&(e.opt_len+=(a-l[2*n+1])*l[2*n],l[2*n+1]=a),i--)}},uMe=(e,t,r)=>{let i,n,a=new Array(I0+1),s=0;for(i=1;i<=I0;i++)s=s+r[i-1]<<1,a[i]=s;for(n=0;n<=t;n++){let t=e[2*n+1];0!==t&&(e[2*n]=cMe(a[t]++,t))}},sCt=()=>{let e,t,r,i,n,a=new Array(I0+1);for(r=0,i=0;i<vq-1;i++)for(xq[i]=r,e=0;e<1<<lq[i];e++)nS[r++]=i;for(nS[r-1]=i,n=0,i=0;i<16;i++)for($O[i]=n,e=0;e<1<<YO[i];e++)rS[n++]=i;for(n>>=7;i<Cb;i++)for($O[i]=n<<7,e=0;e<1<<YO[i]-7;e++)rS[256+n++]=i;for(t=0;t<=I0;t++)a[t]=0;for(e=0;e<=143;)Mf[2*e+1]=8,e++,a[8]++;for(;e<=255;)Mf[2*e+1]=9,e++,a[9]++;for(;e<=279;)Mf[2*e+1]=7,e++,a[7]++;for(;e<=287;)Mf[2*e+1]=8,e++,a[8]++;for(uMe(Mf,tS+1,a),e=0;e<Cb;e++)Jw[2*e+1]=5,Jw[2*e]=cMe(e,5);sMe=new $7(Mf,lq,cS+1,tS,I0),aMe=new $7(Jw,YO,0,Cb,I0),oMe=new $7(new Array(0),tCt,0,yq,eCt)},hMe=e=>{let t;for(t=0;t<tS;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Cb;t++)e.dyn_dtree[2*t]=0;for(t=0;t<yq;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*bq]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},dMe=e=>{e.bi_valid>8?iS(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},mSe=(e,t,r,i)=>{let n=2*t,a=2*r;return e[n]<e[a]||e[n]===e[a]&&i[t]<=i[r]},K7=(e,t,r)=>{let i=e.heap[r],n=r<<1;for(;n<=e.heap_len&&(n<e.heap_len&&mSe(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!mSe(t,i,e.heap[n],e.depth));)e.heap[r]=e.heap[n],r=n,n<<=1;e.heap[r]=i},gSe=(e,t,r)=>{let i,n,a,s,o=0;if(0!==e.sym_next)do{i=255&e.pending_buf[e.sym_buf+o++],i+=(255&e.pending_buf[e.sym_buf+o++])<<8,n=e.pending_buf[e.sym_buf+o++],0===i?Jh(e,n,t):(a=nS[n],Jh(e,a+cS+1,t),s=lq[a],0!==s&&(n-=xq[a],al(e,n,s)),i--,a=lMe(i),Jh(e,a,r),s=YO[a],0!==s&&(i-=$O[a],al(e,i,s)))}while(o<e.sym_next);Jh(e,bq,t)},cq=(e,t)=>{let r,i,n,a=t.dyn_tree,s=t.stat_desc.static_tree,o=t.stat_desc.has_stree,l=t.stat_desc.elems,h=-1;for(e.heap_len=0,e.heap_max=eMe,r=0;r<l;r++)0!==a[2*r]?(e.heap[++e.heap_len]=h=r,e.depth[r]=0):a[2*r+1]=0;for(;e.heap_len<2;)n=e.heap[++e.heap_len]=h<2?++h:0,a[2*n]=1,e.depth[n]=0,e.opt_len--,o&&(e.static_len-=s[2*n+1]);for(t.max_code=h,r=e.heap_len>>1;r>=1;r--)K7(e,a,r);n=l;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],K7(e,a,1),i=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=i,a[2*n]=a[2*r]+a[2*i],e.depth[n]=(e.depth[r]>=e.depth[i]?e.depth[r]:e.depth[i])+1,a[2*r+1]=a[2*i+1]=n,e.heap[1]=n++,K7(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],iCt(e,t),uMe(a,h,e.bl_count)},vSe=(e,t,r)=>{let i,n,a=-1,s=t[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),t[2*(r+1)+1]=65535,i=0;i<=r;i++)n=s,s=t[2*(i+1)+1],!(++o<l&&n===s)&&(o<h?e.bl_tree[2*n]+=o:0!==n?(n!==a&&e.bl_tree[2*n]++,e.bl_tree[2*tMe]++):o<=10?e.bl_tree[2*rMe]++:e.bl_tree[2*nMe]++,o=0,a=n,0===s?(l=138,h=3):n===s?(l=6,h=3):(l=7,h=4))},ySe=(e,t,r)=>{let i,n,a=-1,s=t[1],o=0,l=7,h=4;for(0===s&&(l=138,h=3),i=0;i<=r;i++)if(n=s,s=t[2*(i+1)+1],!(++o<l&&n===s)){if(o<h)do{Jh(e,n,e.bl_tree)}while(0!=--o);else 0!==n?(n!==a&&(Jh(e,n,e.bl_tree),o--),Jh(e,tMe,e.bl_tree),al(e,o-3,2)):o<=10?(Jh(e,rMe,e.bl_tree),al(e,o-3,3)):(Jh(e,nMe,e.bl_tree),al(e,o-11,7));o=0,a=n,0===s?(l=138,h=3):n===s?(l=6,h=3):(l=7,h=4)}},aCt=e=>{let t;for(vSe(e,e.dyn_ltree,e.l_desc.max_code),vSe(e,e.dyn_dtree,e.d_desc.max_code),cq(e,e.bl_desc),t=yq-1;t>=3&&0===e.bl_tree[2*iMe[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t},oCt=(e,t,r,i)=>{let n;for(al(e,t-257,5),al(e,r-1,5),al(e,i-4,4),n=0;n<i;n++)al(e,e.bl_tree[2*iMe[n]+1],3);ySe(e,e.dyn_ltree,t-1),ySe(e,e.dyn_dtree,r-1)},lCt=e=>{let t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<cS;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0},bSe=!1,cCt=e=>{bSe||(sCt(),bSe=!0),e.l_desc=new Z7(e.dyn_ltree,sMe),e.d_desc=new Z7(e.dyn_dtree,aMe),e.bl_desc=new Z7(e.bl_tree,oMe),e.bi_buf=0,e.bi_valid=0,hMe(e)},fMe=(e,t,r,i)=>{al(e,(ZRt<<1)+(i?1:0),3),dMe(e),iS(e,r),iS(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r},uCt=e=>{al(e,QSe<<1,3),Jh(e,bq,Mf),nCt(e)},hCt=(e,t,r,i)=>{let n,a,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=lCt(e)),cq(e,e.l_desc),cq(e,e.d_desc),s=aCt(e),n=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=n&&(n=a)):n=a=r+5,r+4<=n&&-1!==t?fMe(e,t,r,i):4===e.strategy||a===n?(al(e,(QSe<<1)+(i?1:0),3),gSe(e,Mf,Jw)):(al(e,(KRt<<1)+(i?1:0),3),oCt(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),gSe(e,e.dyn_ltree,e.dyn_dtree)),hMe(e),i&&dMe(e)},dCt=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(nS[r]+cS+1)]++,e.dyn_dtree[2*lMe(t)]++),e.sym_next===e.sym_end),fCt=cCt,pCt=fMe,mCt=hCt,gCt=dCt,vCt=uCt,yCt={_tr_init:fCt,_tr_stored_block:pCt,_tr_flush_block:mCt,_tr_tally:gCt,_tr_align:vCt},bCt=(e,t,r,i)=>{let n=65535&e|0,a=e>>>16&65535|0,s=0;for(;0!==r;){s=r>2e3?2e3:r,r-=s;do{n=n+t[i++]|0,a=a+n|0}while(--s);n%=65521,a%=65521}return n|a<<16|0},sS=bCt,xCt=()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t},ECt=new Uint32Array(xCt()),_Ct=(e,t,r,i)=>{let n=ECt,a=i+r;e^=-1;for(let r=i;r<a;r++)e=e>>>8^n[255&(e^t[r])];return-1^e},Sa=_Ct,L0={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Db={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:TCt,_tr_stored_block:uq,_tr_flush_block:wCt,_tr_tally:vm,_tr_align:SCt}=yCt,{Z_NO_FLUSH:ym,Z_PARTIAL_FLUSH:MCt,Z_FULL_FLUSH:ACt,Z_FINISH:Vc,Z_BLOCK:xSe,Z_OK:Na,Z_STREAM_END:ESe,Z_STREAM_ERROR:Qh,Z_DATA_ERROR:RCt,Z_BUF_ERROR:J7,Z_DEFAULT_COMPRESSION:CCt,Z_FILTERED:PCt,Z_HUFFMAN_ONLY:GO,Z_RLE:ICt,Z_FIXED:OCt,Z_DEFAULT_STRATEGY:DCt,Z_UNKNOWN:LCt,Z_DEFLATED:JO}=Db,kCt=9,FCt=15,BCt=8,NCt=29,UCt=256,hq=UCt+1+NCt,HCt=30,VCt=19,zCt=2*hq+1,GCt=15,ai=3,gm=258,ed=gm+ai+1,qCt=32,Pb=42,Eq=57,dq=69,fq=73,pq=91,mq=103,O0=113,Zw=666,Po=1,Lb=2,k0=3,kb=4,jCt=3,D0=(e,t)=>(e.msg=L0[t],t),_Se=e=>2*e-(e>4?9:0),mm=e=>{let t=e.length;for(;--t>=0;)e[t]=0},WCt=e=>{let t,r,i,n=e.w_size;t=e.hash_size,i=t;do{r=e.head[--i],e.head[i]=r>=n?r-n:0}while(--t);t=n,i=t;do{r=e.prev[--i],e.prev[i]=r>=n?r-n:0}while(--t)},XCt=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask,bm=XCt,Ul=e=>{let t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},Hl=(e,t)=>{wCt(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Ul(e.strm)},Ci=(e,t)=>{e.pending_buf[e.pending++]=t},$w=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},gq=(e,t,r,i)=>{let n=e.avail_in;return n>i&&(n=i),0===n?0:(e.avail_in-=n,t.set(e.input.subarray(e.next_in,e.next_in+n),r),1===e.state.wrap?e.adler=sS(e.adler,t,n,r):2===e.state.wrap&&(e.adler=Sa(e.adler,t,n,r)),e.next_in+=n,e.total_in+=n,n)},pMe=(e,t)=>{let r,i,n=e.max_chain_length,a=e.strstart,s=e.prev_length,o=e.nice_match,l=e.strstart>e.w_size-ed?e.strstart-(e.w_size-ed):0,h=e.window,c=e.w_mask,u=e.prev,d=e.strstart+gm,p=h[a+s-1],f=h[a+s];e.prev_length>=e.good_match&&(n>>=2),o>e.lookahead&&(o=e.lookahead);do{if(r=t,h[r+s]===f&&h[r+s-1]===p&&h[r]===h[a]&&h[++r]===h[a+1]){a+=2,r++;do{}while(h[++a]===h[++r]&&h[++a]===h[++r]&&h[++a]===h[++r]&&h[++a]===h[++r]&&h[++a]===h[++r]&&h[++a]===h[++r]&&h[++a]===h[++r]&&h[++a]===h[++r]&&a<d);if(i=gm-(d-a),a=d-gm,i>s){if(e.match_start=t,s=i,i>=o)break;p=h[a+s-1],f=h[a+s]}}}while((t=u[t&c])>l&&0!=--n);return s<=e.lookahead?s:e.lookahead},Ib=e=>{let t,r,i,n=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=n+(n-ed)&&(e.window.set(e.window.subarray(n,n+n-r),0),e.match_start-=n,e.strstart-=n,e.block_start-=n,e.insert>e.strstart&&(e.insert=e.strstart),WCt(e),r+=n),0===e.strm.avail_in)break;if(t=gq(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=t,e.lookahead+e.insert>=ai)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=bm(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=bm(e,e.ins_h,e.window[i+ai-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<ai)););}while(e.lookahead<ed&&0!==e.strm.avail_in)},mMe=(e,t)=>{let r,i,n,a=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,o=e.strm.avail_in;do{if(r=65535,n=e.bi_valid+42>>3,e.strm.avail_out<n||(n=e.strm.avail_out-n,i=e.strstart-e.block_start,r>i+e.strm.avail_in&&(r=i+e.strm.avail_in),r>n&&(r=n),r<a&&(0===r&&t!==Vc||t===ym||r!==i+e.strm.avail_in)))break;s=t===Vc&&r===i+e.strm.avail_in?1:0,uq(e,0,0,s),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,Ul(e.strm),i&&(i>r&&(i=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,r-=i),r&&(gq(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(0===s);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?kb:t!==ym&&t!==Vc&&0===e.strm.avail_in&&e.strstart===e.block_start?Lb:(n=e.window_size-e.strstart,e.strm.avail_in>n&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,n+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),n>e.strm.avail_in&&(n=e.strm.avail_in),n&&(gq(e.strm,e.window,e.strstart,n),e.strstart+=n,e.insert+=n>e.w_size-e.insert?e.w_size-e.insert:n),e.high_water<e.strstart&&(e.high_water=e.strstart),n=e.bi_valid+42>>3,n=e.pending_buf_size-n>65535?65535:e.pending_buf_size-n,a=n>e.w_size?e.w_size:n,i=e.strstart-e.block_start,(i>=a||(i||t===Vc)&&t!==ym&&0===e.strm.avail_in&&i<=n)&&(r=i>n?n:i,s=t===Vc&&0===e.strm.avail_in&&r===i?1:0,uq(e,e.block_start,r,s),e.block_start+=r,Ul(e.strm)),s?k0:Po)},Q7=(e,t)=>{let r,i;for(;;){if(e.lookahead<ed){if(Ib(e),e.lookahead<ed&&t===ym)return Po;if(0===e.lookahead)break}if(r=0,e.lookahead>=ai&&(e.ins_h=bm(e,e.ins_h,e.window[e.strstart+ai-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-ed&&(e.match_length=pMe(e,r)),e.match_length>=ai)if(i=vm(e,e.strstart-e.match_start,e.match_length-ai),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=ai){e.match_length--;do{e.strstart++,e.ins_h=bm(e,e.ins_h,e.window[e.strstart+ai-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=bm(e,e.ins_h,e.window[e.strstart+1]);else i=vm(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Hl(e,!1),0===e.strm.avail_out))return Po}return e.insert=e.strstart<ai-1?e.strstart:ai-1,t===Vc?(Hl(e,!0),0===e.strm.avail_out?k0:kb):e.sym_next&&(Hl(e,!1),0===e.strm.avail_out)?Po:Lb},Ab=(e,t)=>{let r,i,n;for(;;){if(e.lookahead<ed){if(Ib(e),e.lookahead<ed&&t===ym)return Po;if(0===e.lookahead)break}if(r=0,e.lookahead>=ai&&(e.ins_h=bm(e,e.ins_h,e.window[e.strstart+ai-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=ai-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-ed&&(e.match_length=pMe(e,r),e.match_length<=5&&(e.strategy===PCt||e.match_length===ai&&e.strstart-e.match_start>4096)&&(e.match_length=ai-1)),e.prev_length>=ai&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-ai,i=vm(e,e.strstart-1-e.prev_match,e.prev_length-ai),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=n&&(e.ins_h=bm(e,e.ins_h,e.window[e.strstart+ai-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=ai-1,e.strstart++,i&&(Hl(e,!1),0===e.strm.avail_out))return Po}else if(e.match_available){if(i=vm(e,0,e.window[e.strstart-1]),i&&Hl(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return Po}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=vm(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<ai-1?e.strstart:ai-1,t===Vc?(Hl(e,!0),0===e.strm.avail_out?k0:kb):e.sym_next&&(Hl(e,!1),0===e.strm.avail_out)?Po:Lb},YCt=(e,t)=>{let r,i,n,a,s=e.window;for(;;){if(e.lookahead<=gm){if(Ib(e),e.lookahead<=gm&&t===ym)return Po;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=ai&&e.strstart>0&&(n=e.strstart-1,i=s[n],i===s[++n]&&i===s[++n]&&i===s[++n])){a=e.strstart+gm;do{}while(i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&i===s[++n]&&n<a);e.match_length=gm-(a-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=ai?(r=vm(e,1,e.match_length-ai),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=vm(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(Hl(e,!1),0===e.strm.avail_out))return Po}return e.insert=0,t===Vc?(Hl(e,!0),0===e.strm.avail_out?k0:kb):e.sym_next&&(Hl(e,!1),0===e.strm.avail_out)?Po:Lb},$Ct=(e,t)=>{let r;for(;;){if(0===e.lookahead&&(Ib(e),0===e.lookahead)){if(t===ym)return Po;break}if(e.match_length=0,r=vm(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(Hl(e,!1),0===e.strm.avail_out))return Po}return e.insert=0,t===Vc?(Hl(e,!0),0===e.strm.avail_out?k0:kb):e.sym_next&&(Hl(e,!1),0===e.strm.avail_out)?Po:Lb};function Kh(e,t,r,i,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=i,this.func=n}var Kw=[new Kh(0,0,0,0,mMe),new Kh(4,4,8,4,Q7),new Kh(4,5,16,8,Q7),new Kh(4,6,32,32,Q7),new Kh(4,4,16,16,Ab),new Kh(8,16,32,32,Ab),new Kh(8,16,128,128,Ab),new Kh(8,32,128,256,Ab),new Kh(32,128,258,1024,Ab),new Kh(32,258,258,4096,Ab)],ZCt=e=>{e.window_size=2*e.w_size,mm(e.head),e.max_lazy_match=Kw[e.level].max_lazy,e.good_match=Kw[e.level].good_length,e.nice_match=Kw[e.level].nice_length,e.max_chain_length=Kw[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=ai-1,e.match_available=0,e.ins_h=0};function KCt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=JO,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*zCt),this.dyn_dtree=new Uint16Array(2*(2*HCt+1)),this.bl_tree=new Uint16Array(2*(2*VCt+1)),mm(this.dyn_ltree),mm(this.dyn_dtree),mm(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(GCt+1),this.heap=new Uint16Array(2*hq+1),mm(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*hq+1),mm(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var uS=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==Pb&&t.status!==Eq&&t.status!==dq&&t.status!==fq&&t.status!==pq&&t.status!==mq&&t.status!==O0&&t.status!==Zw?1:0},gMe=e=>{if(uS(e))return D0(e,Qh);e.total_in=e.total_out=0,e.data_type=LCt;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?Eq:t.wrap?Pb:O0,e.adler=2===t.wrap?0:1,t.last_flush=-2,TCt(t),Na},vMe=e=>{let t=gMe(e);return t===Na&&ZCt(e.state),t},JCt=(e,t)=>uS(e)||2!==e.state.wrap?Qh:(e.state.gzhead=t,Na),yMe=(e,t,r,i,n,a)=>{if(!e)return Qh;let s=1;if(t===CCt&&(t=6),i<0?(s=0,i=-i):i>15&&(s=2,i-=16),n<1||n>kCt||r!==JO||i<8||i>15||t<0||t>9||a<0||a>OCt||8===i&&1!==s)return D0(e,Qh);8===i&&(i=9);let o=new KCt;return e.state=o,o.strm=e,o.status=Pb,o.wrap=s,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=n+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+ai-1)/ai),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<n+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=a,o.method=r,vMe(e)},QCt=(e,t)=>yMe(e,t,JO,FCt,BCt,DCt),e2t=(e,t)=>{if(uS(e)||t>xSe||t<0)return e?D0(e,Qh):Qh;let r=e.state;if(!e.output||0!==e.avail_in&&!e.input||r.status===Zw&&t!==Vc)return D0(e,0===e.avail_out?J7:Qh);let i=r.last_flush;if(r.last_flush=t,0!==r.pending){if(Ul(e),0===e.avail_out)return r.last_flush=-1,Na}else if(0===e.avail_in&&_Se(t)<=_Se(i)&&t!==Vc)return D0(e,J7);if(r.status===Zw&&0!==e.avail_in)return D0(e,J7);if(r.status===Pb&&0===r.wrap&&(r.status=O0),r.status===Pb){let t=JO+(r.w_bits-8<<4)<<8,i=-1;if(i=r.strategy>=GO||r.level<2?0:r.level<6?1:6===r.level?2:3,t|=i<<6,0!==r.strstart&&(t|=qCt),t+=31-t%31,$w(r,t),0!==r.strstart&&($w(r,e.adler>>>16),$w(r,65535&e.adler)),e.adler=1,r.status=O0,Ul(e),0!==r.pending)return r.last_flush=-1,Na}if(r.status===Eq)if(e.adler=0,Ci(r,31),Ci(r,139),Ci(r,8),r.gzhead)Ci(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Ci(r,255&r.gzhead.time),Ci(r,r.gzhead.time>>8&255),Ci(r,r.gzhead.time>>16&255),Ci(r,r.gzhead.time>>24&255),Ci(r,9===r.level?2:r.strategy>=GO||r.level<2?4:0),Ci(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Ci(r,255&r.gzhead.extra.length),Ci(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=Sa(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=dq;else if(Ci(r,0),Ci(r,0),Ci(r,0),Ci(r,0),Ci(r,0),Ci(r,9===r.level?2:r.strategy>=GO||r.level<2?4:0),Ci(r,jCt),r.status=O0,Ul(e),0!==r.pending)return r.last_flush=-1,Na;if(r.status===dq){if(r.gzhead.extra){let t=r.pending,i=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+i>r.pending_buf_size;){let n=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+n),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>t&&(e.adler=Sa(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex+=n,Ul(e),0!==r.pending)return r.last_flush=-1,Na;t=0,i-=n}let n=new Uint8Array(r.gzhead.extra);r.pending_buf.set(n.subarray(r.gzindex,r.gzindex+i),r.pending),r.pending+=i,r.gzhead.hcrc&&r.pending>t&&(e.adler=Sa(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex=0}r.status=fq}if(r.status===fq){if(r.gzhead.name){let t,i=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>i&&(e.adler=Sa(e.adler,r.pending_buf,r.pending-i,i)),Ul(e),0!==r.pending)return r.last_flush=-1,Na;i=0}t=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Ci(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>i&&(e.adler=Sa(e.adler,r.pending_buf,r.pending-i,i)),r.gzindex=0}r.status=pq}if(r.status===pq){if(r.gzhead.comment){let t,i=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>i&&(e.adler=Sa(e.adler,r.pending_buf,r.pending-i,i)),Ul(e),0!==r.pending)return r.last_flush=-1,Na;i=0}t=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Ci(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>i&&(e.adler=Sa(e.adler,r.pending_buf,r.pending-i,i))}r.status=mq}if(r.status===mq){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(Ul(e),0!==r.pending))return r.last_flush=-1,Na;Ci(r,255&e.adler),Ci(r,e.adler>>8&255),e.adler=0}if(r.status=O0,Ul(e),0!==r.pending)return r.last_flush=-1,Na}if(0!==e.avail_in||0!==r.lookahead||t!==ym&&r.status!==Zw){let i=0===r.level?mMe(r,t):r.strategy===GO?$Ct(r,t):r.strategy===ICt?YCt(r,t):Kw[r.level].func(r,t);if((i===k0||i===kb)&&(r.status=Zw),i===Po||i===k0)return 0===e.avail_out&&(r.last_flush=-1),Na;if(i===Lb&&(t===MCt?SCt(r):t!==xSe&&(uq(r,0,0,!1),t===ACt&&(mm(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Ul(e),0===e.avail_out))return r.last_flush=-1,Na}return t!==Vc?Na:r.wrap<=0?ESe:(2===r.wrap?(Ci(r,255&e.adler),Ci(r,e.adler>>8&255),Ci(r,e.adler>>16&255),Ci(r,e.adler>>24&255),Ci(r,255&e.total_in),Ci(r,e.total_in>>8&255),Ci(r,e.total_in>>16&255),Ci(r,e.total_in>>24&255)):($w(r,e.adler>>>16),$w(r,65535&e.adler)),Ul(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?Na:ESe)},t2t=e=>{if(uS(e))return Qh;let t=e.state.status;return e.state=null,t===O0?D0(e,RCt):Na},r2t=(e,t)=>{let r=t.length;if(uS(e))return Qh;let i=e.state,n=i.wrap;if(2===n||1===n&&i.status!==Pb||i.lookahead)return Qh;if(1===n&&(e.adler=sS(e.adler,t,r,0)),i.wrap=0,r>=i.w_size){0===n&&(mm(i.head),i.strstart=0,i.block_start=0,i.insert=0);let e=new Uint8Array(i.w_size);e.set(t.subarray(r-i.w_size,r),0),t=e,r=i.w_size}let a=e.avail_in,s=e.next_in,o=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,Ib(i);i.lookahead>=ai;){let e=i.strstart,t=i.lookahead-(ai-1);do{i.ins_h=bm(i,i.ins_h,i.window[e+ai-1]),i.prev[e&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=e,e++}while(--t);i.strstart=e,i.lookahead=ai-1,Ib(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=ai-1,i.match_available=0,e.next_in=s,e.input=o,e.avail_in=a,i.wrap=n,Na},n2t=QCt,i2t=yMe,s2t=vMe,a2t=gMe,o2t=JCt,l2t=e2t,c2t=t2t,u2t=r2t,h2t="pako deflate (from Nodeca project)",Qw={deflateInit:n2t,deflateInit2:i2t,deflateReset:s2t,deflateResetKeep:a2t,deflateSetHeader:o2t,deflate:l2t,deflateEnd:c2t,deflateSetDictionary:u2t,deflateInfo:h2t},d2t=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),f2t=function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(let t in r)d2t(r,t)&&(e[t]=r[t])}}return e},p2t=e=>{let t=0;for(let r=0,i=e.length;r<i;r++)t+=e[r].length;let r=new Uint8Array(t);for(let t=0,i=0,n=e.length;t<n;t++){let n=e[t];r.set(n,i),i+=n.length}return r},QO={assign:f2t,flattenChunks:p2t},bMe=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){bMe=!1}var aS=new Uint8Array(256);for(let e=0;e<256;e++)aS[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;aS[254]=aS[254]=1;var m2t=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,r,i,n,a,s=e.length,o=0;for(n=0;n<s;n++)r=e.charCodeAt(n),55296==(64512&r)&&n+1<s&&(i=e.charCodeAt(n+1),56320==(64512&i)&&(r=65536+(r-55296<<10)+(i-56320),n++)),o+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(o),a=0,n=0;a<o;n++)r=e.charCodeAt(n),55296==(64512&r)&&n+1<s&&(i=e.charCodeAt(n+1),56320==(64512&i)&&(r=65536+(r-55296<<10)+(i-56320),n++)),r<128?t[a++]=r:r<2048?(t[a++]=192|r>>>6,t[a++]=128|63&r):r<65536?(t[a++]=224|r>>>12,t[a++]=128|r>>>6&63,t[a++]=128|63&r):(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63,t[a++]=128|r>>>6&63,t[a++]=128|63&r);return t},g2t=(e,t)=>{if(t<65534&&e.subarray&&bMe)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let i=0;i<t;i++)r+=String.fromCharCode(e[i]);return r},v2t=(e,t)=>{let r=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,n,a=new Array(2*r);for(n=0,i=0;i<r;){let t=e[i++];if(t<128){a[n++]=t;continue}let s=aS[t];if(s>4)a[n++]=65533,i+=s-1;else{for(t&=2===s?31:3===s?15:7;s>1&&i<r;)t=t<<6|63&e[i++],s--;s>1?a[n++]=65533:t<65536?a[n++]=t:(t-=65536,a[n++]=55296|t>>10&1023,a[n++]=56320|1023&t)}}return g2t(a,n)},y2t=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+aS[e[r]]>t?r:t},oS={string2buf:m2t,buf2string:v2t,utf8border:y2t};function b2t(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var xMe=b2t,EMe=Object.prototype.toString,{Z_NO_FLUSH:x2t,Z_SYNC_FLUSH:E2t,Z_FULL_FLUSH:_2t,Z_FINISH:T2t,Z_OK:ZO,Z_STREAM_END:w2t,Z_DEFAULT_COMPRESSION:S2t,Z_DEFAULT_STRATEGY:M2t,Z_DEFLATED:A2t}=Db;function hS(e){this.options=QO.assign({level:S2t,method:A2t,chunkSize:16384,windowBits:15,memLevel:8,strategy:M2t},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new xMe,this.strm.avail_out=0;let r=Qw.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==ZO)throw new Error(L0[r]);if(t.header&&Qw.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?oS.string2buf(t.dictionary):"[object ArrayBuffer]"===EMe.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,r=Qw.deflateSetDictionary(this.strm,e),r!==ZO)throw new Error(L0[r]);this._dict_set=!0}}function _q(e,t){let r=new hS(t);if(r.push(e,!0),r.err)throw r.msg||L0[r.err];return r.result}function R2t(e,t){return(t=t||{}).raw=!0,_q(e,t)}function C2t(e,t){return(t=t||{}).gzip=!0,_q(e,t)}hS.prototype.push=function(e,t){let r,i,n=this.strm,a=this.options.chunkSize;if(this.ended)return!1;for(i=t===~~t?t:!0===t?T2t:x2t,"string"==typeof e?n.input=oS.string2buf(e):"[object ArrayBuffer]"===EMe.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(a),n.next_out=0,n.avail_out=a),(i===E2t||i===_2t)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(r=Qw.deflate(n,i),r===w2t)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),r=Qw.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===ZO;if(0!==n.avail_out){if(i>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},hS.prototype.onData=function(e){this.chunks.push(e)},hS.prototype.onEnd=function(e){e===ZO&&(this.result=QO.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var P2t=hS,I2t=_q,O2t=R2t,D2t=C2t,L2t=Db,k2t={Deflate:P2t,deflate:I2t,deflateRaw:O2t,gzip:D2t,constants:L2t},qO=16209,F2t=16191,B2t=function(e,t){let r,i,n,a,s,o,l,h,c,u,d,p,f,m,g,v,y,b,x,_,w,S,T,M,E=e.state;r=e.next_in,T=e.input,i=r+(e.avail_in-5),n=e.next_out,M=e.output,a=n-(t-e.avail_out),s=n+(e.avail_out-257),o=E.dmax,l=E.wsize,h=E.whave,c=E.wnext,u=E.window,d=E.hold,p=E.bits,f=E.lencode,m=E.distcode,g=(1<<E.lenbits)-1,v=(1<<E.distbits)-1;e:do{p<15&&(d+=T[r++]<<p,p+=8,d+=T[r++]<<p,p+=8),y=f[d&g];t:for(;;){if(b=y>>>24,d>>>=b,p-=b,b=y>>>16&255,0===b)M[n++]=65535&y;else{if(!(16&b)){if(64&b){if(32&b){E.mode=F2t;break e}e.msg="invalid literal/length code",E.mode=qO;break e}y=f[(65535&y)+(d&(1<<b)-1)];continue t}for(x=65535&y,b&=15,b&&(p<b&&(d+=T[r++]<<p,p+=8),x+=d&(1<<b)-1,d>>>=b,p-=b),p<15&&(d+=T[r++]<<p,p+=8,d+=T[r++]<<p,p+=8),y=m[d&v];;){if(b=y>>>24,d>>>=b,p-=b,b=y>>>16&255,16&b){if(_=65535&y,b&=15,p<b&&(d+=T[r++]<<p,p+=8,p<b&&(d+=T[r++]<<p,p+=8)),_+=d&(1<<b)-1,_>o){e.msg="invalid distance too far back",E.mode=qO;break e}if(d>>>=b,p-=b,b=n-a,_>b){if(b=_-b,b>h&&E.sane){e.msg="invalid distance too far back",E.mode=qO;break e}if(w=0,S=u,0===c){if(w+=l-b,b<x){x-=b;do{M[n++]=u[w++]}while(--b);w=n-_,S=M}}else if(c<b){if(w+=l+c-b,b-=c,b<x){x-=b;do{M[n++]=u[w++]}while(--b);if(w=0,c<x){b=c,x-=b;do{M[n++]=u[w++]}while(--b);w=n-_,S=M}}}else if(w+=c-b,b<x){x-=b;do{M[n++]=u[w++]}while(--b);w=n-_,S=M}for(;x>2;)M[n++]=S[w++],M[n++]=S[w++],M[n++]=S[w++],x-=3;x&&(M[n++]=S[w++],x>1&&(M[n++]=S[w++]))}else{w=n-_;do{M[n++]=M[w++],M[n++]=M[w++],M[n++]=M[w++],x-=3}while(x>2);x&&(M[n++]=M[w++],x>1&&(M[n++]=M[w++]))}break}if(64&b){e.msg="invalid distance code",E.mode=qO;break e}y=m[(65535&y)+(d&(1<<b)-1)]}}break}}while(r<i&&n<s);x=p>>3,r-=x,p-=x<<3,d&=(1<<p)-1,e.next_in=r,e.next_out=n,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=n<s?s-n+257:257-(n-s),E.hold=d,E.bits=p},Rb=15,TSe=852,wSe=592,SSe=0,eq=1,MSe=2,N2t=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),U2t=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),H2t=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),V2t=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),z2t=(e,t,r,i,n,a,s,o)=>{let l,h,c,u,d,p,f,m,g,v=o.bits,y=0,b=0,x=0,_=0,w=0,S=0,T=0,M=0,E=0,A=0,C=null,P=new Uint16Array(Rb+1),R=new Uint16Array(Rb+1),I=null;for(y=0;y<=Rb;y++)P[y]=0;for(b=0;b<i;b++)P[t[r+b]]++;for(w=v,_=Rb;_>=1&&0===P[_];_--);if(w>_&&(w=_),0===_)return n[a++]=20971520,n[a++]=20971520,o.bits=1,0;for(x=1;x<_&&0===P[x];x++);for(w<x&&(w=x),M=1,y=1;y<=Rb;y++)if(M<<=1,M-=P[y],M<0)return-1;if(M>0&&(e===SSe||1!==_))return-1;for(R[1]=0,y=1;y<Rb;y++)R[y+1]=R[y]+P[y];for(b=0;b<i;b++)0!==t[r+b]&&(s[R[t[r+b]]++]=b);if(e===SSe?(C=I=s,p=20):e===eq?(C=N2t,I=U2t,p=257):(C=H2t,I=V2t,p=0),A=0,b=0,y=x,d=a,S=w,T=0,c=-1,E=1<<w,u=E-1,e===eq&&E>TSe||e===MSe&&E>wSe)return 1;for(;;){f=y-T,s[b]+1<p?(m=0,g=s[b]):s[b]>=p?(m=I[s[b]-p],g=C[s[b]-p]):(m=96,g=0),l=1<<y-T,h=1<<S,x=h;do{h-=l,n[d+(A>>T)+h]=f<<24|m<<16|g|0}while(0!==h);for(l=1<<y-1;A&l;)l>>=1;if(0!==l?(A&=l-1,A+=l):A=0,b++,0==--P[y]){if(y===_)break;y=t[r+s[b]]}if(y>w&&(A&u)!==c){for(0===T&&(T=w),d+=x,S=y-T,M=1<<S;S+T<_&&(M-=P[S+T],!(M<=0));)S++,M<<=1;if(E+=1<<S,e===eq&&E>TSe||e===MSe&&E>wSe)return 1;c=A&u,n[c]=w<<24|S<<16|d-a|0}}return 0!==A&&(n[d+A]=y-T<<24|64<<16|0),o.bits=w,0},eS=z2t,G2t=0,_Me=1,TMe=2,{Z_FINISH:ASe,Z_BLOCK:q2t,Z_TREES:jO,Z_OK:F0,Z_STREAM_END:j2t,Z_NEED_DICT:W2t,Z_STREAM_ERROR:zc,Z_DATA_ERROR:wMe,Z_MEM_ERROR:SMe,Z_BUF_ERROR:X2t,Z_DEFLATED:RSe}=Db,eD=16180,CSe=16181,PSe=16182,ISe=16183,OSe=16184,DSe=16185,LSe=16186,kSe=16187,FSe=16188,BSe=16189,KO=16190,Sf=16191,tq=16192,NSe=16193,rq=16194,USe=16195,HSe=16196,VSe=16197,zSe=16198,WO=16199,XO=16200,GSe=16201,qSe=16202,jSe=16203,WSe=16204,XSe=16205,nq=16206,YSe=16207,$Se=16208,bs=16209,MMe=16210,AMe=16211,Y2t=852,$2t=592,Z2t=15,K2t=Z2t,ZSe=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function J2t(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var B0=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<eD||t.mode>AMe?1:0},RMe=e=>{if(B0(e))return zc;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=eD,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(Y2t),t.distcode=t.distdyn=new Int32Array($2t),t.sane=1,t.back=-1,F0},CMe=e=>{if(B0(e))return zc;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,RMe(e)},PMe=(e,t)=>{let r;if(B0(e))return zc;let i=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?zc:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=r,i.wbits=t,CMe(e))},IMe=(e,t)=>{if(!e)return zc;let r=new J2t;e.state=r,r.strm=e,r.window=null,r.mode=eD;let i=PMe(e,t);return i!==F0&&(e.state=null),i},Q2t=e=>IMe(e,K2t),KSe=!0,iq,sq,ePt=e=>{if(KSe){iq=new Int32Array(512),sq=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(eS(_Me,e.lens,0,288,iq,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;eS(TMe,e.lens,0,32,sq,0,e.work,{bits:5}),KSe=!1}e.lencode=iq,e.lenbits=9,e.distcode=sq,e.distbits=5},OMe=(e,t,r,i)=>{let n,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),i>=a.wsize?(a.window.set(t.subarray(r-a.wsize,r),0),a.wnext=0,a.whave=a.wsize):(n=a.wsize-a.wnext,n>i&&(n=i),a.window.set(t.subarray(r-i,r-i+n),a.wnext),(i-=n)?(a.window.set(t.subarray(r-i,r),0),a.wnext=i,a.whave=a.wsize):(a.wnext+=n,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=n))),0},tPt=(e,t)=>{let r,i,n,a,s,o,l,h,c,u,d,p,f,m,g,v,y,b,x,_,w,S,T,M,E=0,A=new Uint8Array(4),C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(B0(e)||!e.output||!e.input&&0!==e.avail_in)return zc;r=e.state,r.mode===Sf&&(r.mode=tq),s=e.next_out,n=e.output,l=e.avail_out,a=e.next_in,i=e.input,o=e.avail_in,h=r.hold,c=r.bits,u=o,d=l,S=F0;e:for(;;)switch(r.mode){case eD:if(0===r.wrap){r.mode=tq;break}for(;c<16;){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}if(2&r.wrap&&35615===h){0===r.wbits&&(r.wbits=15),r.check=0,A[0]=255&h,A[1]=h>>>8&255,r.check=Sa(r.check,A,2,0),h=0,c=0,r.mode=CSe;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",r.mode=bs;break}if((15&h)!==RSe){e.msg="unknown compression method",r.mode=bs;break}if(h>>>=4,c-=4,w=8+(15&h),0===r.wbits&&(r.wbits=w),w>15||w>r.wbits){e.msg="invalid window size",r.mode=bs;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&h?BSe:Sf,h=0,c=0;break;case CSe:for(;c<16;){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}if(r.flags=h,(255&r.flags)!==RSe){e.msg="unknown compression method",r.mode=bs;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=bs;break}r.head&&(r.head.text=h>>8&1),512&r.flags&&4&r.wrap&&(A[0]=255&h,A[1]=h>>>8&255,r.check=Sa(r.check,A,2,0)),h=0,c=0,r.mode=PSe;case PSe:for(;c<32;){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}r.head&&(r.head.time=h),512&r.flags&&4&r.wrap&&(A[0]=255&h,A[1]=h>>>8&255,A[2]=h>>>16&255,A[3]=h>>>24&255,r.check=Sa(r.check,A,4,0)),h=0,c=0,r.mode=ISe;case ISe:for(;c<16;){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}r.head&&(r.head.xflags=255&h,r.head.os=h>>8),512&r.flags&&4&r.wrap&&(A[0]=255&h,A[1]=h>>>8&255,r.check=Sa(r.check,A,2,0)),h=0,c=0,r.mode=OSe;case OSe:if(1024&r.flags){for(;c<16;){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}r.length=h,r.head&&(r.head.extra_len=h),512&r.flags&&4&r.wrap&&(A[0]=255&h,A[1]=h>>>8&255,r.check=Sa(r.check,A,2,0)),h=0,c=0}else r.head&&(r.head.extra=null);r.mode=DSe;case DSe:if(1024&r.flags&&(p=r.length,p>o&&(p=o),p&&(r.head&&(w=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(i.subarray(a,a+p),w)),512&r.flags&&4&r.wrap&&(r.check=Sa(r.check,i,p,a)),o-=p,a+=p,r.length-=p),r.length))break e;r.length=0,r.mode=LSe;case LSe:if(2048&r.flags){if(0===o)break e;p=0;do{w=i[a+p++],r.head&&w&&r.length<65536&&(r.head.name+=String.fromCharCode(w))}while(w&&p<o);if(512&r.flags&&4&r.wrap&&(r.check=Sa(r.check,i,p,a)),o-=p,a+=p,w)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=kSe;case kSe:if(4096&r.flags){if(0===o)break e;p=0;do{w=i[a+p++],r.head&&w&&r.length<65536&&(r.head.comment+=String.fromCharCode(w))}while(w&&p<o);if(512&r.flags&&4&r.wrap&&(r.check=Sa(r.check,i,p,a)),o-=p,a+=p,w)break e}else r.head&&(r.head.comment=null);r.mode=FSe;case FSe:if(512&r.flags){for(;c<16;){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}if(4&r.wrap&&h!==(65535&r.check)){e.msg="header crc mismatch",r.mode=bs;break}h=0,c=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=Sf;break;case BSe:for(;c<32;){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}e.adler=r.check=ZSe(h),h=0,c=0,r.mode=KO;case KO:if(0===r.havedict)return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,r.hold=h,r.bits=c,W2t;e.adler=r.check=1,r.mode=Sf;case Sf:if(t===q2t||t===jO)break e;case tq:if(r.last){h>>>=7&c,c-=7&c,r.mode=nq;break}for(;c<3;){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}switch(r.last=1&h,h>>>=1,c-=1,3&h){case 0:r.mode=NSe;break;case 1:if(ePt(r),r.mode=WO,t===jO){h>>>=2,c-=2;break e}break;case 2:r.mode=HSe;break;case 3:e.msg="invalid block type",r.mode=bs}h>>>=2,c-=2;break;case NSe:for(h>>>=7&c,c-=7&c;c<32;){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",r.mode=bs;break}if(r.length=65535&h,h=0,c=0,r.mode=rq,t===jO)break e;case rq:r.mode=USe;case USe:if(p=r.length,p){if(p>o&&(p=o),p>l&&(p=l),0===p)break e;n.set(i.subarray(a,a+p),s),o-=p,a+=p,l-=p,s+=p,r.length-=p;break}r.mode=Sf;break;case HSe:for(;c<14;){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}if(r.nlen=257+(31&h),h>>>=5,c-=5,r.ndist=1+(31&h),h>>>=5,c-=5,r.ncode=4+(15&h),h>>>=4,c-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=bs;break}r.have=0,r.mode=VSe;case VSe:for(;r.have<r.ncode;){for(;c<3;){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}r.lens[C[r.have++]]=7&h,h>>>=3,c-=3}for(;r.have<19;)r.lens[C[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,T={bits:r.lenbits},S=eS(G2t,r.lens,0,19,r.lencode,0,r.work,T),r.lenbits=T.bits,S){e.msg="invalid code lengths set",r.mode=bs;break}r.have=0,r.mode=zSe;case zSe:for(;r.have<r.nlen+r.ndist;){for(;E=r.lencode[h&(1<<r.lenbits)-1],g=E>>>24,v=E>>>16&255,y=65535&E,!(g<=c);){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}if(y<16)h>>>=g,c-=g,r.lens[r.have++]=y;else{if(16===y){for(M=g+2;c<M;){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}if(h>>>=g,c-=g,0===r.have){e.msg="invalid bit length repeat",r.mode=bs;break}w=r.lens[r.have-1],p=3+(3&h),h>>>=2,c-=2}else if(17===y){for(M=g+3;c<M;){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}h>>>=g,c-=g,w=0,p=3+(7&h),h>>>=3,c-=3}else{for(M=g+7;c<M;){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}h>>>=g,c-=g,w=0,p=11+(127&h),h>>>=7,c-=7}if(r.have+p>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=bs;break}for(;p--;)r.lens[r.have++]=w}}if(r.mode===bs)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=bs;break}if(r.lenbits=9,T={bits:r.lenbits},S=eS(_Me,r.lens,0,r.nlen,r.lencode,0,r.work,T),r.lenbits=T.bits,S){e.msg="invalid literal/lengths set",r.mode=bs;break}if(r.distbits=6,r.distcode=r.distdyn,T={bits:r.distbits},S=eS(TMe,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,T),r.distbits=T.bits,S){e.msg="invalid distances set",r.mode=bs;break}if(r.mode=WO,t===jO)break e;case WO:r.mode=XO;case XO:if(o>=6&&l>=258){e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,r.hold=h,r.bits=c,B2t(e,d),s=e.next_out,n=e.output,l=e.avail_out,a=e.next_in,i=e.input,o=e.avail_in,h=r.hold,c=r.bits,r.mode===Sf&&(r.back=-1);break}for(r.back=0;E=r.lencode[h&(1<<r.lenbits)-1],g=E>>>24,v=E>>>16&255,y=65535&E,!(g<=c);){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}if(v&&!(240&v)){for(b=g,x=v,_=y;E=r.lencode[_+((h&(1<<b+x)-1)>>b)],g=E>>>24,v=E>>>16&255,y=65535&E,!(b+g<=c);){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}h>>>=b,c-=b,r.back+=b}if(h>>>=g,c-=g,r.back+=g,r.length=y,0===v){r.mode=XSe;break}if(32&v){r.back=-1,r.mode=Sf;break}if(64&v){e.msg="invalid literal/length code",r.mode=bs;break}r.extra=15&v,r.mode=GSe;case GSe:if(r.extra){for(M=r.extra;c<M;){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}r.length+=h&(1<<r.extra)-1,h>>>=r.extra,c-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=qSe;case qSe:for(;E=r.distcode[h&(1<<r.distbits)-1],g=E>>>24,v=E>>>16&255,y=65535&E,!(g<=c);){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}if(!(240&v)){for(b=g,x=v,_=y;E=r.distcode[_+((h&(1<<b+x)-1)>>b)],g=E>>>24,v=E>>>16&255,y=65535&E,!(b+g<=c);){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}h>>>=b,c-=b,r.back+=b}if(h>>>=g,c-=g,r.back+=g,64&v){e.msg="invalid distance code",r.mode=bs;break}r.offset=y,r.extra=15&v,r.mode=jSe;case jSe:if(r.extra){for(M=r.extra;c<M;){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}r.offset+=h&(1<<r.extra)-1,h>>>=r.extra,c-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=bs;break}r.mode=WSe;case WSe:if(0===l)break e;if(p=d-l,r.offset>p){if(p=r.offset-p,p>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=bs;break}p>r.wnext?(p-=r.wnext,f=r.wsize-p):f=r.wnext-p,p>r.length&&(p=r.length),m=r.window}else m=n,f=s-r.offset,p=r.length;p>l&&(p=l),l-=p,r.length-=p;do{n[s++]=m[f++]}while(--p);0===r.length&&(r.mode=XO);break;case XSe:if(0===l)break e;n[s++]=r.length,l--,r.mode=XO;break;case nq:if(r.wrap){for(;c<32;){if(0===o)break e;o--,h|=i[a++]<<c,c+=8}if(d-=l,e.total_out+=d,r.total+=d,4&r.wrap&&d&&(e.adler=r.check=r.flags?Sa(r.check,n,d,s-d):sS(r.check,n,d,s-d)),d=l,4&r.wrap&&(r.flags?h:ZSe(h))!==r.check){e.msg="incorrect data check",r.mode=bs;break}h=0,c=0}r.mode=YSe;case YSe:if(r.wrap&&r.flags){for(;c<32;){if(0===o)break e;o--,h+=i[a++]<<c,c+=8}if(4&r.wrap&&h!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=bs;break}h=0,c=0}r.mode=$Se;case $Se:S=j2t;break e;case bs:S=wMe;break e;case MMe:return SMe;default:return zc}return e.next_out=s,e.avail_out=l,e.next_in=a,e.avail_in=o,r.hold=h,r.bits=c,(r.wsize||d!==e.avail_out&&r.mode<bs&&(r.mode<nq||t!==ASe))&&OMe(e,e.output,e.next_out,d-e.avail_out),u-=e.avail_in,d-=e.avail_out,e.total_in+=u,e.total_out+=d,r.total+=d,4&r.wrap&&d&&(e.adler=r.check=r.flags?Sa(r.check,n,d,e.next_out-d):sS(r.check,n,d,e.next_out-d)),e.data_type=r.bits+(r.last?64:0)+(r.mode===Sf?128:0)+(r.mode===WO||r.mode===rq?256:0),(0===u&&0===d||t===ASe)&&S===F0&&(S=X2t),S},rPt=e=>{if(B0(e))return zc;let t=e.state;return t.window&&(t.window=null),e.state=null,F0},nPt=(e,t)=>{if(B0(e))return zc;let r=e.state;return 2&r.wrap?(r.head=t,t.done=!1,F0):zc},iPt=(e,t)=>{let r,i,n,a=t.length;return B0(e)||(r=e.state,0!==r.wrap&&r.mode!==KO)?zc:r.mode===KO&&(i=1,i=sS(i,t,a,0),i!==r.check)?wMe:(n=OMe(e,t,a,a),n?(r.mode=MMe,SMe):(r.havedict=1,F0))},sPt=CMe,aPt=PMe,oPt=RMe,lPt=Q2t,cPt=IMe,uPt=tPt,hPt=rPt,dPt=nPt,fPt=iPt,pPt="pako inflate (from Nodeca project)",Af={inflateReset:sPt,inflateReset2:aPt,inflateResetKeep:oPt,inflateInit:lPt,inflateInit2:cPt,inflate:uPt,inflateEnd:hPt,inflateGetHeader:dPt,inflateSetDictionary:fPt,inflateInfo:pPt};function mPt(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gPt=mPt,DMe=Object.prototype.toString,{Z_NO_FLUSH:vPt,Z_FINISH:yPt,Z_OK:lS,Z_STREAM_END:aq,Z_NEED_DICT:oq,Z_STREAM_ERROR:bPt,Z_DATA_ERROR:JSe,Z_MEM_ERROR:xPt}=Db;function dS(e){this.options=QO.assign({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new xMe,this.strm.avail_out=0;let r=Af.inflateInit2(this.strm,t.windowBits);if(r!==lS)throw new Error(L0[r]);if(this.header=new gPt,Af.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=oS.string2buf(t.dictionary):"[object ArrayBuffer]"===DMe.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Af.inflateSetDictionary(this.strm,t.dictionary),r!==lS)))throw new Error(L0[r])}function Tq(e,t){let r=new dS(t);if(r.push(e),r.err)throw r.msg||L0[r.err];return r.result}function EPt(e,t){return(t=t||{}).raw=!0,Tq(e,t)}dS.prototype.push=function(e,t){let r,i,n,a=this.strm,s=this.options.chunkSize,o=this.options.dictionary;if(this.ended)return!1;for(i=t===~~t?t:!0===t?yPt:vPt,"[object ArrayBuffer]"===DMe.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(s),a.next_out=0,a.avail_out=s),r=Af.inflate(a,i),r===oq&&o&&(r=Af.inflateSetDictionary(a,o),r===lS?r=Af.inflate(a,i):r===JSe&&(r=oq));a.avail_in>0&&r===aq&&a.state.wrap>0&&0!==e[a.next_in];)Af.inflateReset(a),r=Af.inflate(a,i);switch(r){case bPt:case JSe:case oq:case xPt:return this.onEnd(r),this.ended=!0,!1}if(n=a.avail_out,a.next_out&&(0===a.avail_out||r===aq))if("string"===this.options.to){let e=oS.utf8border(a.output,a.next_out),t=a.next_out-e,r=oS.buf2string(a.output,e);a.next_out=t,a.avail_out=s-t,t&&a.output.set(a.output.subarray(e,e+t),0),this.onData(r)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(r!==lS||0!==n){if(r===aq)return r=Af.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},dS.prototype.onData=function(e){this.chunks.push(e)},dS.prototype.onEnd=function(e){e===lS&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=QO.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var _Pt=dS,TPt=Tq,wPt=EPt,SPt=Tq,MPt=Db,APt={Inflate:_Pt,inflate:TPt,inflateRaw:wPt,ungzip:SPt,constants:MPt},{Deflate:xar,deflate:Ear,deflateRaw:_ar,gzip:Tar}=k2t,{Inflate:war,inflate:RPt,inflateRaw:Sar,ungzip:Mar}=APt,Fb=RPt,tD=class extends B_{constructor(e){super(e)}parse(e,t){let r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function n(e,t,r,i){let n=r*i*4,a=new Uint8Array(e,t,n),s=new Uint8Array(n),o=0,l=0;for(let e=0;e<i;e++)for(let e=0;e<r;e++){let e=a[l];l++;let t=a[l];l++;let r=a[l];l++;let i=a[l];l++,s[o]=r,o++,s[o]=t,o++,s[o]=e,o++,s[o]=i,o++}return s}let a=i("DXT1"),s=i("DXT3"),o=i("DXT5"),l=i("ETC1"),h=i("DX10"),c=new Int32Array(e,0,31);if(542327876!==c[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),r;let u,d=c[21],p=!1,f=c[1]+4;switch(d){case a:u=8,r.format=Ly;break;case s:u=16,r.format=ky;break;case o:u=16,r.format=Fy;break;case l:u=8,r.format=q_;break;case h:f+=20;let t=new Int32Array(e,128,5)[0];switch(t){case 96:u=16,r.format=m_;break;case 95:u=16,r.format=g_;break;default:return console.error("THREE.DDSLoader.parse: Unsupported DXGI_FORMAT code ",t),r}break;default:if(!(32===c[22]&&16711680&c[23]&&65280&c[24]&&255&c[25]&&4278190080&c[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",(m=d,String.fromCharCode(255&m,m>>8&255,m>>16&255,m>>24&255))),r;p=!0,u=64,r.format=gs}var m;r.mipmapCount=1,131072&c[2]&&!1!==t&&(r.mipmapCount=Math.max(1,c[7]));let g=c[28];if(r.isCubemap=!!(512&g),r.isCubemap&&(!(1024&g)||!(2048&g)||!(4096&g)||!(8192&g)||!(16384&g)||!(32768&g)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),r;r.width=c[4],r.height=c[3];let v=r.isCubemap?6:1;for(let t=0;t<v;t++){let t=r.width,i=r.height;for(let a=0;a<r.mipmapCount;a++){let a,s;p?(a=n(e,f,t,i),s=a.length):(s=Math.max(4,t)/4*Math.max(4,i)/4*u,a=new Uint8Array(e,f,s));let o={data:a,width:t,height:i};r.mipmaps.push(o),f+=s,t=Math.max(t>>1,1),i=Math.max(i>>1,1)}}return r}},LMe={9728:ni,9729:wn},kMe={9984:mh,9985:rf,9986:hu,9987:ia},Sq={33071:pi,33648:fu,10497:ui},rD={int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,float:Float32Array,double:Float64Array},fS=(e=>(e[e.scalar=1]="scalar",e[e.vec2=2]="vec2",e[e.vec3=3]="vec3",e[e.vec4=4]="vec4",e[e.mat2=4]="mat2",e[e.mat3=9]="mat3",e[e.mat4=16]="mat4",e))(fS||{}),nD=class{constructor(e,t){this.baseUrl=e,this.textureLoaderCache=new Map,this.materialCache=new Map,this.textureCache=new Map,this.userDataCache=new Map,this.familyInstanceIdCache=new Map,this.familyInstanceAndUserIdsCache=new Map,this.userIdAndUserDataCache=new Map,this.userBoxCache=new Map,this.preprocessURL=null,this.protoRoot=t}getProperty(e,t,r){return bt(this,null,(function*(){return Ut.isBinaryFile(e)?this.getPropertyFromBinary(e,t,r):this.getPropertyFromJson(e,t)}))}getPropertyFromJson(e,t){return bt(this,null,(function*(){return yield fetch(this.baseUrl+e,t).then((t=>{if(t.ok)return t.json();throw new Error(`[BimTiles] Failed to load property "${e}", status ${t.status} : ${t.statusText}`)}))}))}getPropertyFromBinary(e,t,r){return bt(this,null,(function*(){return yield fetch(this.baseUrl+e,t).then((t=>{if(t.ok)return t.arrayBuffer();throw new Error(`[BimTiles] Failed to load property "${e}", status ${t.status} : ${t.statusText}`)})).then((e=>{let t=new Uint8Array(e),i=Fb(t);return this.protoRoot.lookupType(r).decode(i)}))}))}getTextureLoader(e){if("dds"!==e&&(e="default"),this.textureLoaderCache.has(e))return this.textureLoaderCache.get(e);let t;return t="dds"===e?new tD:new Ds,this.textureLoaderCache.set(e,t),t}loadTexture(e,t){let r=t.textures[e],i=t.images[r.image],n=i.uri+":"+r.sampler;if(this.textureCache.get(n))return this.textureCache.get(n);let a=this.getTextureLoader(i.type),s=new Promise(((e,n)=>{a.load(this.baseUrl+i.uri,(i=>{let n=(t.samplers||{})[r.sampler]||{};i.magFilter=LMe[n.magFilter]||wn,i.minFilter=kMe[n.minFilter]||ia,i.wrapS=Sq[n.wrapS]||ui,i.wrapT=Sq[n.wrapT]||ui,e(i)}),void 0,(e=>{throw de.error("[BimTiles] Couldn't load texture",i.uri),n(e),e}))}));return this.textureCache.set(n,s),s}assignTexture(e,t,r,i,n){return r.index?this.loadTexture(r.index,i).then((e=>e?(void 0!==r.texCoord&&r.texCoord>0&&((e=e.clone()).channel=r.texCoord),void 0!==n&&(e.colorSpace=n),e):null)).catch((()=>null)):Promise.resolve(null)}parseMaterial(e){let t=Object.values(e.materials).map((t=>bt(this,null,(function*(){let r={};if(t.name&&(r.name=t.name),r.color=new dt(1,1,1),r.opacity=1,Array.isArray(t.baseColorFactor)){let e=t.baseColorFactor;r.color.setRGB(e[0],e[1],e[2],Hi),r.opacity=e[3]}t.baseColorTexture&&(r.map=yield this.assignTexture(r,"map",t.baseColorTexture,e,Zr)),r.metalness=void 0!==t.metallicFactor?t.metallicFactor:1,r.roughness=void 0!==t.roughnessFactor?t.roughnessFactor:1,t.metallicRoughnessTexture&&(r.metalnessMap=yield this.assignTexture(r,"metalnessMap",t.metallicRoughnessTexture,e),r.roughnessMap=yield this.assignTexture(r,"roughnessMap",t.metallicRoughnessTexture,e)),!0===t.doubleSided&&(r.side=ln);let i=t.alphaMode||"OPAQUE";if("BLEND"===i?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,"MASK"===i&&(r.alphaTest=void 0!==t.alphaCutoff?t.alphaCutoff:.5)),t.normalTexture&&(r.normalMap=yield this.assignTexture(r,"normalMap",t.normalTexture,e),r.normalScale=new Te(1,1)),t.occlusionTexture&&(r.aoMap=yield this.assignTexture(r,"aoMap",t.occlusionTexture,e)),t.emissiveFactor){let e=t.emissiveFactor;r.emissive=(new dt).setRGB(e[0],e[1],e[2],Hi)}return t.emissiveTexture&&(r.emissiveMap=yield this.assignTexture(r,"emissiveMap",t.emissiveTexture,e,Zr)),this.materialCache.get(t.id)||this.materialCache.set(t.id,r),this.materialCache.get(t.id)}))));return Promise.all(t).then((()=>{de.info("[BimTilesPropertyParser] material parser complete.")}))}parseUserData(e){let{userDataKeys:t,userDataValues:r,userDataItems:i}=e;i.forEach(((e,i)=>{e.indexMap&&(e=e.indexMap);let n={};for(let i in e)n[t[i]]=r[e[i]];this.userDataCache.set(i,n)}))}parseUserId(e){let{modelIds:t,familyInstanceIds:r,modelTable:i,userIdTable:n}=e;Object.keys(i).forEach((e=>{let n=Number(e),a=t[n],s=(i[n].value||i[n]).map((e=>r[e]));this.familyInstanceIdCache.set(a,s)})),Object.keys(n).forEach((e=>{let i=Number(e),a=n[i].value||n[i],s=t[a[0]],o=r[a[1]],l=s+"#"+o;this.familyInstanceAndUserIdsCache.has(l)||this.familyInstanceAndUserIdsCache.set(l,[]),this.familyInstanceAndUserIdsCache.get(l).push(i);let h=a[2];this.userIdAndUserDataCache.set(i,{modelId:s,familyInstanceId:o,userDataIndex:h})}))}parseUserIdBox(e,t){e.boxMap&&(e=e.boxMap),Object.keys(e).forEach((r=>{let i=Number(r),n=e[i].value?e[i].value:e[i],a=(new Vt).setFromArray(n);t&&a.applyMatrix4(t),this.userBoxCache.set(i,a)}))}getMaterialParameters(e){return this.materialCache.get(e)}getUserData(e){if(0===this.userIdAndUserDataCache.size)return;let t=this.userIdAndUserDataCache.get(e);if(null==t||!t.userDataIndex)return;let r=this.userDataCache.get(t.userDataIndex);return r||(r={}),r.modelId=t.modelId,r.familyInstanceId=t.familyInstanceId,r}getFamilyInstanceIdsByModelId(e){return this.familyInstanceIdCache.get(e)}getUserIdBox(e){return this.userBoxCache.get(e)}getUserIds(){return Array.from(this.userIdAndUserDataCache.keys())}getUserIdsByFamilyInstanceId(e,t){if(0===this.familyInstanceAndUserIdsCache.size)return[];let r=e+"#"+t;return this.familyInstanceAndUserIdsCache.get(r)||[]}getUserIdByUserDataIndex(e){if(0!==this.userIdAndUserDataCache.size)for(let[t,r]of this.userIdAndUserDataCache)if(r.userDataIndex===e)return t}getUserIdByFilter(e){let t=[];return 0===this.userDataCache.size||this.userDataCache.forEach(((r,i)=>{if(e(r)){let e=this.getUserIdByUserDataIndex(i);void 0!==e&&t.push(e)}})),t}dispose(){this.textureLoaderCache.clear(),this.materialCache.clear(),this.textureCache.clear(),this.userDataCache.clear(),this.familyInstanceIdCache.clear(),this.familyInstanceAndUserIdsCache.clear(),this.userIdAndUserDataCache.clear(),this.userBoxCache.clear()}},pS=class{parse(e,t){let r=[];for(let i=0;i<t.length;i++){let n=t[i],{byteOffset:a,byteLength:s,batchTable:o}=n,l=e.slice(a,a+s);r.push(this.parseMesh(l,n,o))}return r}parseMesh(e,t,r){let i=t.primitive,n=t.buffers,a=this.parseTypedArray(e,n[i.position]),s=i.color?this.parseTypedArray(e,n[i.color]):new Float32Array,o=i.indice?this.parseTypedArray(e,n[i.indice]):new Uint16Array,l=i.normal?this.parseTypedArray(e,n[i.normal]):new Float32Array;i.normal>=0&&i.normalCompressed&&(l=BI(l));let h=i.tangent?this.parseTypedArray(e,n[i.tangent]):new Float32Array,c=i.uv_0?this.parseTypedArray(e,n[i.uv_0]):new Float32Array,u=i.barycentric?this.parseTypedArray(e,n[i.barycentric]):new Uint8Array,d=new Array(a.length/3);return r.forEach((e=>{d.fill(e.userId,e.positionStart,e.positionStart+e.positionCount)})),{type:i.type,position:a,indice:o,color:s,normal:l,tangent:h,barycentric:u,uv:c,userIds:d,materialId:i.materialId||i.material,batchTable:t.batchTable}}parseTypedArray(e,t){let{byteOffset:r,byteLength:i,count:n,type:a,componentType:s}=t,o=Number(fS[a]);return new(0,rD[s])(e.slice(r,r+i),0,n*o)}},Bb=class{parse(e,t,r){return bt(this,null,(function*(){let i=[];for(let n=0;n<e.length;n++){let{blobId:a,url:s,instances:o}=e[n],l=yield this.getInstancedMeshByUrlAndBlobId(t+s,a,r);if(!l){de.warn(`[BimTiles] Failed to get InstancedMesh by ${t+s}, bloblId '${a}'`);continue}let h=[],c=[];o.forEach((e=>{h.push(e.userId),c.push(...e.transform)}));let u=Ii(on({},l),{userIds:h,matrices:c});i.push(u)}return i}))}parseInstanceBuffer(e){let t=new Mc(e);this.header={magic:t.readUtf8String(4),version:t.readUint32(),byteLength:t.readUint64()};let r=t.readUint32(),i=t.readUint32(),n=t.readUint32(),a=t.readUint64(),s=e.slice(r,r+i),o=FI(new Uint8Array(s,0,i)),l=JSON.parse(o),h=e.slice(n,n+a);return this.parseMeshes(h,l.meshes)}parseInstanceProto(e,t){let r=Fb(e),i=t.lookupType("PBTileContent").decode(r);return this.parseMeshes(i.binaries.slice().buffer,i.meshes)}parseMeshes(e,t){let r=[];for(let i=0;i<t.length;i++){let n=t[i],{byteOffset:a=0,byteLength:s}=n,o=e.slice(a,a+s);r.push(this.parseMesh(o,n))}return r}parseMesh(e,t){let r=t.primitive,i=t.buffers,n=this.parseTypedArray(e,i[r.position]),a=r.color?this.parseTypedArray(e,i[r.color]):new Float32Array,s=r.indice?this.parseTypedArray(e,i[r.indice]):new Uint16Array,o=r.normal?this.parseTypedArray(e,i[r.normal]):new Float32Array;r.normal>=0&&r.normalCompressed&&(o=BI(o));let l=r.tangent?this.parseTypedArray(e,i[r.tangent]):new Float32Array,h=r.uv_0?this.parseTypedArray(e,i[r.uv_0]):new Float32Array,c=r.barycentric?this.parseTypedArray(e,i[r.barycentric]):new Uint8Array;return{type:r.type,position:n,indice:s,color:a,normal:o,tangent:l,uv:h,barycentric:c,userIds:[],matrices:[],materialId:r.materialId||r.material}}parseTypedArray(e,t){let{byteOffset:r,byteLength:i,count:n,type:a,componentType:s}=t,o=Number(fS[a]);return new(0,rD[s])(e.slice(r,r+i),0,n*o)}getInstancedMeshByUrlAndBlobId(e,t,r){return bt(this,null,(function*(){if(!Bb.instanceDataMap[e]){let t=yield fetch(e).then((e=>e.arrayBuffer())),i=new Uint8Array(t);Ut.isGizp(i)&&r?Bb.instanceDataMap[e]=this.parseInstanceProto(i,r):Bb.instanceDataMap[e]=this.parseInstanceBuffer(t)}return Bb.instanceDataMap[e][t]}))}},Nb=Bb;Nb.instanceDataMap={};var iD=class{parse(e,t,r){return bt(this,null,(function*(){let i=new Uint8Array(e);return Ut.isGizp(i)?this.parseProto(i,t,r):this.parseBinary(e,t)}))}parseBinary(e,t){return bt(this,null,(function*(){let r=new Mc(e),i=r.readUtf8String(4),n=r.readUint32(),a=r.readUint64(),s=r.readUint32(),o=r.readUint32(),l=r.readUint32(),h=r.readUint64(),c=e.slice(s,s+o),u=FI(new Uint8Array(c,0,o)),d=JSON.parse(u);de.debug(`[BimTiles] Tile, magic(${i}), version(${n}), byteLength(${a}), tileJson:`,d);let p=e.slice(l,l+h);return{batchedMeshes:(new pS).parse(p,d.batchedMeshes),instancedMeshes:yield(new Nb).parse(d.instancedMeshes,t)}}))}parseProto(e,t,r){return bt(this,null,(function*(){let i=Fb(e),n=r.lookupType("PBTileContent").decode(i),a=n.header;de.debug(`[BimTiles] Tile, magic(${a.magic}), version(${a.version}), byteLength(${i.byteLength}), tileJson:`,n);let s=n.binaries.slice().buffer;return{batchedMeshes:(new pS).parse(s,n.meshes),instancedMeshes:yield(new Nb).parse(n.instanceMeshes,t,r)}}))}},FMe='syntax = "proto3";\r\n\r\npackage BimTiles;\r\n\r\n// UserIdBox\r\nmessage PBBox {\r\n    repeated double value = 1;\r\n}\r\n\r\nmessage PBUserIdBox {\r\n    map<uint32, PBBox> boxMap = 1;\r\n}\r\n\r\n// UserId\r\nmessage PBModelFamilyInstanceIndex {\r\n    repeated uint32 value = 1;\r\n}\r\n\r\nmessage PBUserIdTableIndex {\r\n    repeated sint32 value = 1;\r\n}\r\n\r\nmessage PBUserId {\r\n    repeated string modelIds = 1;\r\n    repeated string familyInstanceIds = 2;\r\n    map<uint32, PBModelFamilyInstanceIndex> modelTable = 3;\r\n    map<uint32, PBUserIdTableIndex> userIdTable = 4;\r\n}\r\n\r\n// UserData\r\nmessage PBUserDataItem {\r\n    map<uint32, uint32> indexMap = 1;\r\n}\r\n\r\nmessage PBUserData {\r\n    repeated string userDataKeys = 1;\r\n    repeated string userDataValues = 2;\r\n    repeated PBUserDataItem userDataItems = 3;\r\n}\r\n\r\n// Material\r\nmessage PBTexture {\r\n    sint32 image = 1;\r\n    sint32 sampler = 2;\r\n}\r\n\r\nmessage PBImage {\r\n    string uri = 1;\r\n    string type = 2;\r\n    sint32 width = 3;\r\n    sint32 height = 4;\r\n    sint32 dimensions = 5;\r\n}\r\n\r\nmessage PBSampler {\r\n    sint32 magFilter = 1;\r\n    sint32 minFilter = 2;\r\n    sint32 wrapS = 3;\r\n    sint32 wrapT = 4;\r\n}\r\n\r\nmessage PBTextureTransform {\r\n    repeated float offset = 1;\r\n    repeated float scale = 2;\r\n    float rotation = 3;\r\n}\r\n\r\nmessage PBTextureInfo {\r\n    sint32 index = 1;\r\n    sint32 texCoord = 2;\r\n    optional PBTextureTransform transform = 3;\r\n}\r\n\r\nmessage PBMaterialInfo {\r\n    string id = 1;\r\n    string name = 2;\r\n    repeated float baseColorFactor = 3;\r\n    optional PBTextureInfo baseColorTexture = 4;\r\n    optional float metallicFactor = 5;\r\n    optional float roughnessFactor = 6;\r\n    optional PBTextureInfo metallicRoughnessTexture = 7;\r\n    optional bool doubleSided = 8;\r\n    optional string alphaMode = 9;\r\n    optional float alphaCutoff = 10;\r\n    optional PBTextureInfo normalTexture = 11;\r\n    repeated float emissiveFactor = 12;\r\n    optional PBTextureInfo emissiveTexture = 13;\r\n    optional PBTextureInfo occlusionTexture = 14; \r\n}\r\n\r\nmessage PBMaterials {\r\n    map<string, PBMaterialInfo> materials = 1;\r\n    repeated PBTexture textures = 2;\r\n    repeated PBImage images = 3;\r\n    repeated PBSampler samplers = 4;\r\n}\r\n\r\n/** Geometry */\r\n// header\r\nmessage PBTileHeader {\r\n    uint32 magic = 1;\r\n    uint32 version = 2;\r\n}\r\n\r\n/** content */\r\nmessage PBBufferView {\r\n    uint64 byteOffset = 1;\r\n    uint64 byteLength = 2;\r\n    string componentType = 3;\r\n    string type = 4;\r\n    uint32 count = 5;\r\n    repeated float max = 6;\r\n    repeated float min = 7;\r\n}\r\n\r\nmessage PBPrimitive {\r\n    int32 type = 1;\r\n    int32 position = 2;\r\n    string materialId = 3;\r\n    optional int32 indice = 4;\r\n    optional int32 normal = 5;\r\n    optional bool normalCompressed = 6;\r\n    optional int32 tangent = 7;\r\n    optional int32 color = 8;\r\n    optional int32 barycentric = 9;\r\n    optional int32 uv_0 = 10;\r\n    optional int32 uv_1 = 11;\r\n    optional int32 uv_2 = 12;\r\n}\r\n\r\n/** instance */\r\nmessage PBInstanceInfo {\r\n    uint32 userId = 1;\r\n    repeated double transform = 2;\r\n}\r\n\r\nmessage PBInstanceMesh {\r\n    uint32 blobId = 1;\r\n    string url = 2;\r\n    repeated PBInstanceInfo instances = 3;\r\n}\r\n\r\n/** batch */\r\nmessage PBBatchInfo {\r\n    uint32 userId = 1;\r\n    uint32 indexStart = 2;\r\n    uint32 indexCount = 3;\r\n    uint32 positionStart = 4;\r\n    uint32 positionCount = 5;\r\n}\r\n\r\nmessage PBMesh {\r\n    uint64 byteOffset = 1;\r\n    uint64 byteLength = 2;\r\n    repeated PBBufferView buffers = 3;\r\n    PBPrimitive primitive = 4;\r\n    repeated PBBatchInfo batchTable = 5;\r\n}\r\n\r\n// tile content\r\nmessage PBTileContent {\r\n    PBTileHeader header = 1;\r\n    repeated PBInstanceMesh instanceMeshes = 2;\r\n    repeated PBMesh meshes = 3;\r\n    bytes binaries = 4;\r\n}\r\n',NMe=Symbol("INITIAL_FRUSTUM_CULLED");function PPt(e,t){e.traverse((e=>{e.frustumCulled=e[NMe]&&t}))}var sD=new F,aD=new F,Mq=new Vt,oD=class extends Bw{constructor(e,t){super(e),this.downloadQueue.maxJobs=6,this.parseQueue.maxJobs=4,this.optimizeRaycast=!1,this.errorTarget=8,this.loadSiblings=!1,this.tilesetId=t,this.baseUrl=e.replace(/\/[^\\/]*\/?$/,"/"),this.highlighUsage=new Xr,this.highlighUsage.name=`highlighUsage-${this.tilesetId}`,this.group.add(this.highlighUsage),this.transparentUsage=new Xr,this.transparentUsage.name=`transparentUsage-${this.tilesetId}`,this.group.add(this.transparentUsage),this.pickUsage=new Xr,this.protoRoot=BMe.parse(FMe).root,this.propertyParser=new nD(this.baseUrl,this.protoRoot)}getVertexColorArray(e,t=new dt(16777215)){let r=[],{r:i,g:n,b:a}=t;for(let t=0;t<e;t+=3)r.push(i,n,a);return new Float32Array(r)}createBatchedMesh(e){var t,r;let{position:i,uv:n,normal:a,indice:s,barycentric:o,userIds:l,materialId:h,batchTable:c}=e,u=e.color,d=l.map((e=>IG(this.tilesetId,e))),p=new Nt;p.setAttribute("position",new zt(i,3)),p.setAttribute("normal",new zt(a,3)),p.setAttribute("uv",new zt(n,2)),p.setAttribute("tileObjectId",new Lg(d,1)),p.setIndex(Array.from(s));let f=this.propertyParser.getMaterialParameters(h);0===u.length&&(u=this.getVertexColorArray(i.length,null==f?void 0:f.color)),p.setAttribute("color",new zt(u,3));let m=o.length>0;m&&p.setAttribute("barycentric",new fr(o,1));let g=null==(t=this.materialManager)?void 0:t.createBatchMaterial(h,f,m);return{mesh:new Ht(p,g),pickMesh:new Ht(p,null==(r=this.materialManager)?void 0:r.pickMaterial),batchTable:c}}createInstancedMesh({position:e,uv:t,color:r,normal:i,indice:n,barycentric:a,matrices:s,userIds:o,materialId:l}){var h,c;let u=o.map((e=>IG(this.tilesetId,e))),d=o.length,p=new Nt;p.setIndex(Array.from(n)),p.setAttribute("position",new zt(e,3)),p.setAttribute("uv",new zt(t,2)),p.setAttribute("normal",new zt(i,3)),p.setAttribute("tileObjectId",new Ja(new Int32Array(u),1));let f=a.length>0;f&&p.setAttribute("barycentric",new fr(a,1));let m=this.propertyParser.getMaterialParameters(l),g=null==(h=this.materialManager)?void 0:h.createInstanceMaterial(l,m,f),v=new ls(p,g,d);v.instanceMatrix=new Ja(new Float32Array(s),16),0===r.length&&(r=this.getVertexColorArray(3*d,null==m?void 0:m.color)),v.instanceColor=new Ja(r,3);let y=new ls(p,null==(c=this.materialManager)?void 0:c.pickMaterial,d);return y.instanceMatrix=new Ja(new Float32Array(s),16),{mesh:v,pickMesh:y,userIds:o}}getGeometryByUserIds(e){let t=Date.now(),r=[];return this.forEachLoadedModel(((t,i)=>{let n=i.cached.scene.children;for(let t=0;t<n.length;t++){let i=n[t];if(!i||i.sourceMesh)continue;let a=i.userData.userIds;if(a)for(let t=0;t<e.length;t++){let n=e[t],s=a.indexOf(n);if(s>-1){let e=new Nt,t=i.geometry.getAttribute("position"),a=i.geometry.index,o=i.geometry.getAttribute("tileObjectId");if(i instanceof ls){let r=new lt;i.getMatrixAt(s,r),e.setAttribute("position",t.clone());let n=o.array[s*o.itemSize];e.setAttribute("tileObjectId",new Lg(new Array(t.array.length/3).fill(n),1)),a&&e.setIndex(a),e.applyMatrix4(r)}else{let{indexStart:r,indexCount:s,positionStart:l,positionCount:h}=i.userData.batchTable.find((e=>e.userId===n)),c=t.itemSize,u=t.array.slice(l*c,l*c+h*c),d=new zt(u,c);e.setAttribute("position",d);let p=o.array.slice(l,l+h),f=new Lg(p,1);if(e.setAttribute("tileObjectId",f),a){let t=a.array.slice(r,r+s);for(let e=0;e<t.length;e++)t[e]-=l;e.setIndex(new fr(t,1))}}e.applyMatrix4(i.matrixWorld),r.push(e)}}}})),de.info(`[BimTiles] getGeometryByUserIds cost ${(Date.now()-t)/1e3}s`),r.length>1?qi(r):r[0]}parseTile(e,t,r){this.onBeforeParseTile&&this.onBeforeParseTile(t),t._loadIndex=t._loadIndex||0,t._loadIndex++;let i=t.cached.transform;return(new iD).parse(e,this.baseUrl,this.protoRoot).then((({batchedMeshes:e,instancedMeshes:r})=>{de.debug("[BimTiles] batchedMeshes:",e),de.debug("[BimTiles] instancedMeshes:",r);let n=new Xr;n.name="TileGroup";let a=new Xr;a.name="TileGroup-pick",e.forEach((e=>{let{mesh:t,pickMesh:r,batchTable:i}=this.createBatchedMesh(e);n.add(t),t.userData.batchTable=i,t.userData.userIds=i.map((e=>e.userId)),a.add(r)})),r.forEach((e=>{let{mesh:t,pickMesh:r,userIds:i}=this.createInstancedMesh(e);n.add(t),t.userData.userIds=i,a.add(r)}));let s=e=>{e.applyMatrix4(i)};s(n),n.traverse((e=>{e[NMe]=e.frustumCulled})),PPt(n,!this.autoDisableRendererCulling),s(a),t.cached.scene=n,t.cached.pickScene=a,this.onLoadModel&&this.onLoadModel(n,t)}))}disposeTile(e){let t=e.cached;if(t.scene){let r=e=>{e.traverse((e=>{e.geometry&&e.geometry.dispose()})),e.removeFromParent()};r(t.scene),t.pickScene&&r(t.pickScene),this.onDisposeModel&&this.onDisposeModel(t.scene,e),t.scene=null,t.pickScene=null,t.materials=null,t.textures=null,t.geometry=null}this.activeTiles.delete(e),this.visibleTiles.delete(e),e._loadIndex++}preprocessNode(e,t,r){super.preprocessNode(e,t,r),Array.isArray(e.boundingVolume)&&(Mq.setFromArray(e.boundingVolume),e.cached&&e.cached.boundingVolume&&(Mq.getCenter(sD),Mq.getSize(aD),e.cached.boundingVolume.setObbData([sD.x,sD.y,sD.z,aD.x/2,0,0,0,aD.y/2,0,0,0,aD.z/2],e.cached.transform)))}fetchTileSet(e,t,r=void 0){return bt(this,null,(function*(){return fetch(e,t).then((t=>{if(t.ok)return t.json();throw new Error(`BimTilesRenderer: Failed to load tileset "${e}" with status ${t.status} : ${t.statusText}`)})).then((i=>bt(this,null,(function*(){let{material:n,userData:a,userId:s,userIdBox:o}=i.properties,l=[];if(n.url){let e=this.propertyParser.getProperty(n.url,t,"PBMaterials").then((e=>this.propertyParser.parseMaterial(e)));l.push(e)}if(a.url){let e=this.propertyParser.getProperty(a.url,t,"PBUserData").then((e=>this.propertyParser.parseUserData(e)));l.push(e)}if(s.url){let e=this.propertyParser.getProperty(s.url,t,"PBUserId").then((e=>this.propertyParser.parseUserId(e)));l.push(e)}if(o.url){let e=this.propertyParser.getProperty(o.url,t,"PBUserIdBox").then((e=>this.propertyParser.parseUserIdBox(e,this.group.matrix)));l.push(e)}yield Promise.all(l);let h=e.replace(/\/[^\\/]*\/?$/,"");return h=new URL(h,window.location.href).toString(),this.preprocessNode(i.root,h,r),this.onLoadTileSet&&Promise.resolve().then((()=>{this.onLoadTileSet(i)})),i}))))}))}loadRootTileSet(e){let t=this.tileSets;if(e in t)return t[e]instanceof Error?Promise.reject(t[e]):Promise.resolve(t[e]);{let r=this.fetchTileSet(this.preprocessURL?this.preprocessURL(e):e,this.fetchOptions).then((r=>{t[e]=r,this.materialManager=new KI(this,{maxId:r.properties.userId.maxUserIdIndex})}));return r.catch((r=>{de.error("[BimTiles] loadRootTileSet error:",r),t[e]=r})),t[e]=r,r}}update(){super.update()}setTileVisible(e,t){let{scene:r,pickScene:i}=e.cached,n=this.visibleTiles,a=this.group;t?(n.add(e),a.add(r),this.pickUsage.add(i),r.updateMatrixWorld(!0),i.updateMatrixWorld(!0)):(n.delete(e),a.remove(r),this.pickUsage.remove(i)),this.onTileVisibilityChange&&this.onTileVisibilityChange(r,e,t)}calculateError(e){let t=e.cached,r=t.inFrustum,i=this.cameras,n=this.cameraInfo,a=t.boundingVolume,s=-1/0,o=1/0;for(let t=0,l=i.length;t<l;t++){if(!r[t])continue;let i,l=n[t],h=l.invScale;if(l.isOrthographic){let t=l.pixelSize;i=e.geometricError/(t*h)}else{let t=a.distanceToPoint(l.position)*h,r=l.sseDenominator;i=e.geometricError/(t*r),o=Math.min(o,t)}s=Math.max(s,i)}e.__distanceFromCamera=o,e.__error=s}},Ub=class extends sm{constructor(e,t,r){super(),this.modelId=e.modelId;let i=t+r.getMetadata().root;this.tilesRenderer=new oD(i,Number(this.modelId)),this._bbox=e.bbox,this.metadata=r.getMetadata(),this.statistics=r.getStatistics()}getTilesRenderer(){return this.tilesRenderer}get materialManager(){return this.tilesRenderer.materialManager}get propertyParser(){return this.tilesRenderer.propertyParser}get highlighUsageGroup(){return this.tilesRenderer.highlighUsage}get transparentUsageGroup(){return this.tilesRenderer.transparentUsage}get pickUsageGroup(){return this.tilesRenderer.pickUsage}getModelObject(){return this.tilesRenderer.group}traverseObjectByUserId(e,t){if(t.userData.userIds){let r=t.userData.userIds;for(let i=0,n=r.length;i<n;i++)if(r[i]===e)return t}let r=t.children;for(let t=0,i=r.length;t<i;t++)if(this.traverseObjectByUserId(e,r[t]))return r[t]}getObjectByUserId(e){let t=this.tilesRenderer.group;return this.traverseObjectByUserId(e,t)}getBBox(){return this._bbox||(this._bbox=new Vt,this._bbox.setFromObject(this.getModelObject())),this._bbox}setObjectHoveredByUserId(e,t){this.materialManager.updateState(3,[e],t)}clearHovered(){this.materialManager.clearHovered()}setObjectHighlightedByUserIds(e,t){this.materialManager.updateState(2,e,t)}clearHighlight(){this.materialManager.clearState(2)}setObjectOpacityByUserIds(e,t){this.materialManager.updateState(1,e,!0,t)}clearObjectOpacityByUserIds(e){this.materialManager.updateState(1,e,!1)}setOpacity(e){this.materialManager.setOpacity(e)}clearOpacity(){this.materialManager.setOpacity(1)}setVisible(e){this.materialManager.setHidden(!e)}setObjectVisibleByUserIds(e,t){this.materialManager.updateState(0,e,!t)}hasVisibleObject(){return this.materialManager.hasVisibleObject()}hasInvisibleObject(){return this.materialManager.hasInvisibleObject()}getHoveredObject(){var e;return null==(e=this.materialManager)?void 0:e.getHoveredObject()}getBBoxByUserId(e){return this.propertyParser.getUserIdBox(e)}getUserDataByUserId(e){return this.propertyParser.getUserData(e)}getUserIds(){return this.propertyParser.getUserIds()}getUserId(e,t){return this.propertyParser.getUserIdsByFamilyInstanceId(e,t)}getUserData(e,t){let r=this.getUserId(e,t);if(r.length>0)return this.getUserDataByUserId(r[0])}getUserIdByFilter(e){return this.propertyParser.getUserIdByFilter(e)}setClipPlanes(e){this.materialManager.setClipPlanes(e)}},Hb=class{constructor(e){this.composerEnabled=!0,this.viewer=e,this.composer=new qI(this.viewer.renderer),this.viewer.addEventListener("afterrender",(()=>this.render()))}get enabled(){return this.composerEnabled}set enabled(e){this.composerEnabled=e}get renderPassEnabled(){var e;return!(null==(e=this.renderPass)||!e.enabled)}set renderPassEnabled(e){let t=this.viewer.scene,r=this.viewer.camera,{width:i,height:n}=this.viewer.container;if(this.composer){if(e&&!this.renderPass){let e=new jI(t,r);e.setSize(i,n),this.composer.addPass(e),this.renderPass=e}this.renderPass&&(this.renderPass.enabled=e),this.viewer.enableRender()}}get fxaaPassEnabled(){var e;return!(null==(e=this.effectFxaaPass)||!e.enabled)}set fxaaPassEnabled(e){if(!this.composer)return;let{width:t,height:r}=this.viewer.container;if(e&&!this.effectFxaaPass){let e=new hb(G_e);e.uniforms.resolution.value.set(1/t,1/r),e.renderToScreen=!0,e.setSize(t,r),this.composer.addPass(e),this.effectFxaaPass=e}this.effectFxaaPass&&(this.effectFxaaPass.enabled=e),this.viewer.enableRender()}get saoPassEnabled(){var e;return!(null==(e=this.saoPass)||!e.enabled)}set saoPassEnabled(e){let{width:t,height:r}=this.viewer.container,i=this.viewer.scene,n=this.viewer.camera;if(this.composer){if(e&&!this.saoPass){let e=new im(i,n,new Te(1/t,1/r));e.setSize(t,r),e.params.output=0,e.params.saoBias=.5,e.params.saoIntensity=3e-4,e.params.saoScale=8,e.params.saoKernelRadius=40,e.params.saoMinResolution=0,this.composer.addPass(e),this.saoPass=e}this.saoPass&&(this.saoPass.enabled=e),this.viewer.enableRender()}}get ssaoPassEnabled(){var e;return!(null==(e=this.ssaoPass)||!e.enabled)}set ssaoPassEnabled(e){let t=this.viewer.scene,r=this.viewer.camera,{width:i,height:n}=this.viewer.container;if(this.composer){if(e&&!this.ssaoPass){let e=new Fu(t,r,i,n);e.kernelRadius=16,e.minDistance=1e-4,e.maxDistance=.3,this.composer.addPass(e),this.ssaoPass=e}this.ssaoPass&&(this.ssaoPass.enabled=e),this.viewer.enableRender()}}get outlinePassEnabled(){var e;return!(null==(e=this.outlinePass)||!e.enabled)}set outlinePassEnabled(e){let t=this.viewer.scene,r=this.viewer.camera,{width:i,height:n}=this.viewer.container;if(this.composer){if(e&&!this.outlinePass){let e=new ku(new Te(i,n),t,r);e.edgeStrength=3,e.edgeGlow=0,e.edgeThickness=2,e.pulsePeriod=0,e.visibleEdgeColor.set(16711680),e.hiddenEdgeColor.set(16752768),this.composer.addPass(e),this.outlinePass=e}this.outlinePass&&(this.outlinePass.enabled=e),this.viewer.enableRender()}}get ssaaPassEnabled(){var e;return!(null==(e=this.ssaaRenderPass)||!e.enabled)}set ssaaPassEnabled(e){let t=this.viewer.scene,r=this.viewer.camera;if(this.composer){if(e&&!this.ssaaRenderPass){let e=new WI(t,r,16777215,0);this.composer.addPass(e),this.ssaaRenderPass=e,this.ssaaRenderPass=e}this.ssaaRenderPass&&(this.ssaaRenderPass.enabled=e),this.viewer.enableRender()}}get bloomPassEnabled(){var e;return!(null==(e=this.bloomPass)||!e.enabled)}set bloomPassEnabled(e){if(this.composer){if(e&&!this.bloomPass){let e=new Gh(1,25,4);e.renderToScreen=!0,this.composer.addPass(e),this.bloomPass=e}this.bloomPass&&(this.bloomPass.enabled=e),this.viewer.enableRender()}}get unrealBloomPassEnabled(){var e;return!(null==(e=this.unrealBloomPass)||!e.enabled)}set unrealBloomPassEnabled(e){let{width:t,height:r}=this.viewer.container;if(this.composer){if(e&&!this.unrealBloomPass){let e=new vf(new Te(t,r),1,0,0);e.threshold=0,e.strength=.5,e.radius=0,this.composer.addPass(e),this.unrealBloomPass=e}this.unrealBloomPass&&(this.unrealBloomPass.enabled=e),this.viewer.enableRender()}}setOutlinePassSelectObjects(e){this.outlinePass&&(this.outlinePass.selectedObjects=e)}enableModelEdges(e){let t=this.viewer.loadedModels;for(let r=0;r<t.length;++r){let i=t[r];if(i instanceof fb)if(e&&!i.edges){let t=i.getModelObject();t&&(de.debug(`[Viewer] Generating outlines for model '${t.id}'`),i.enableEdges(e))}else i.edges&&i.edges.forEach((t=>t.visible=e));else i instanceof Ub&&de.warn("[BimTiles] enableModelEdges() is not implemented for bimtiles yet.")}this.viewer.enableRender()}showVertexNormals(e,t=.1){e?(this.vertexNormalsHelpers||(this.vertexNormalsHelpers=new Xr),this.viewer.scene.traverseVisible((e=>{var r;if(e instanceof Ht&&!["SKYBOX","GROUND_GRID","GROUND_GRASS","BIM_VIEWER_BOX_HELPER"].includes(e.name)){if(!e.geometry.attributes.normal)return;let i=new VI(e,t,16711680);null==(r=this.vertexNormalsHelpers)||r.add(i)}})),this.viewer.scene.add(this.vertexNormalsHelpers)):this.vertexNormalsHelpers&&(this.viewer.scene.remove(this.vertexNormalsHelpers),this.vertexNormalsHelpers=void 0)}render(){!this.composer||!this.enabled||this.composer.render()}destroy(){var e,t,r,i,n,a,s,o,l;this.renderPass&&(null==(e=this.composer)||e.removePass(this.renderPass),this.renderPass.dispose(),this.renderPass=void 0),this.effectFxaaPass&&(null==(t=this.composer)||t.removePass(this.effectFxaaPass),this.effectFxaaPass.dispose(),this.effectFxaaPass=void 0),this.saoPass&&(null==(r=this.composer)||r.removePass(this.saoPass),this.saoPass.dispose(),this.saoPass=void 0),this.ssaoPass&&(null==(i=this.composer)||i.removePass(this.ssaoPass),this.ssaoPass.dispose(),this.ssaoPass=void 0),this.outlinePass&&(null==(n=this.composer)||n.removePass(this.outlinePass),this.outlinePass.dispose(),this.outlinePass=void 0),this.ssaaRenderPass&&(null==(a=this.composer)||a.removePass(this.ssaaRenderPass),this.ssaaRenderPass.dispose(),this.ssaaRenderPass=void 0),this.bloomPass&&(null==(s=this.composer)||s.removePass(this.bloomPass),this.bloomPass.dispose(),this.bloomPass=void 0),this.unrealBloomPass&&(null==(o=this.composer)||o.removePass(this.unrealBloomPass),this.unrealBloomPass.dispose(),this.unrealBloomPass=void 0),this.composer&&(null==(l=this.composer)||l.dispose(),this.composer=void 0)}},ju=class extends nm{constructor(e,t){if(super(e),this.name="Viewer3d",this.loadedModels=[],this.distanceCullingFactor=150,this.effect=new Hb(this),this.sceneManager.enableLights(!0),t)this.setHomeView(t),this.cameraManager.flyToViewpoint(t);else{let e={eye:new F(100,50,100),look:new F(0,0,0)};this.cameraManager.flyToViewpoint(e)}this.cameraManager.setProjection("Perspective"),this.cameraManager.setNavigationMode(0),this.setupDefaultEvents(),this.setDefaultBackground()}setupDefaultEvents(){let e,t,r=!1,i=0,n=0,a=0,s=e=>-1!==n&&-1!==a&&(Math.abs(e.x-n)<5&&Math.abs(e.y-a)<5),o=!1;this.inputManager.addEventListener("pointerdown",(i=>{r=!1,e=i.button;let n=new Te(i.x,i.y);t=this.pickObject(n),o=(null==t?void 0:t.object)===this.selectedObject,0===i.button&&this.handleAnchorPoint(t)})),this.inputManager.addEventListener("pointermove",(t=>{void 0!==e&&(r=!s(t),0===e&&this.cameraManager.enableRotate&&this.cameraManager.setOrbitPointVisible(!0))})),this.inputManager.addEventListener("pointerup",(l=>{e=void 0,this.cameraManager.setOrbitPointVisible(!1),r?r=!1:0===l.button?(e=>{let t=e.timestamp-i;return!!(0===e.button&&t<300&&s(e))})(l)?(null!=t&&t.object?this.flyToObject(null==t?void 0:t.object):this.viewFitAll(),i=0,n=-1,a=-1):(this.selectedObject&&(this.selectedObject instanceof Ki?this.selectedObject.selected=!1:this.clearHighlight(),this.selectedObject=void 0),i=l.timestamp,n=l.x,a=l.y,null!=t&&t.object&&!o&&this.handleClickObject(null==t?void 0:t.object)):l.button}))}setDefaultBackground(){this.sceneManager.renderer.setClearColor(11119017,1),this.sceneManager.setBackground(null),this.sceneManager.setEnvironmentFromData()}handleAnchorPoint(e){let t=new F;this.selectedObject?(new Vt).setFromObject(this.selectedObject).getCenter(t):e&&e.point?t.copy(e.point):this.getBBox().getCenter(t),this.cameraManager.setOrbitPoint(t),this.cameraManager.update(0)}handleClickObject(e){if(!this.enableSelection)return;let t=e=>!e.userData.modelId&&e.parent?t(e.parent):e.userData.modelId,r=t(e),i=this.loadedModels.find((e=>e.modelId===r));null==i||i.highlightObject(e),this.selectedObject=e,this.enableRender()}is3d(){return!0}loadLocalModel(e,t,r,i){return bt(this,null,(function*(){return this.loadModelInternal(t,i,!0,e,r)}))}loadModel(e,t){return bt(this,null,(function*(){return this.loadModelInternal(e,t)}))}loadModelInternal(e,t,r,i,n){return bt(this,null,(function*(){var a,s;this.spinner.increaseJobCount();let o,l=e.modelId||e.src,h=xn("ProgressBar.Loading"),c=e=>{var r;null==(r=this.progressBar)||r.updateProgress(l,h,e),t&&t(new ProgressEvent("LoadProgress",{loaded:e,total:100}))},u=!1,d=(e,r,i)=>{var n;let a=100*e.loaded/e.total;a=a*(i-r)/100+r,a>i&&(u||(de.warn("[Progress] Invalid ProgressEvent:",e),u=!0),a=i),null==(n=this.progressBar)||n.updateProgress(l,h,a),t&&t(new ProgressEvent("LoadProgress",{loaded:a,total:100}))};if(null==(a=this.progressBar)||a.addProgressItem(l),c(0),r?(this.loaderHelper.setLoadManager(n),o=yield this.loaderHelper.loadLocalModel(i,e.src,t)):o=yield this.loaderHelper.loadModel(e.src,e.fileFormat,(e=>d(e,0,50))),e.matrix&&16===e.matrix.length){let t=new lt;t.elements=e.matrix,o.applyMatrix4(t)}let p=this.getUniqueModelId(e.modelId||e.src),f=new fb({modelId:p,object:o});this.addModel(f),c(90);let m=f.getBBox();1===this.loadedModels.length&&setTimeout((()=>this.goToHomeView()),0);let g=new F;m.getCenter(g),this.cameraManager.setOrbitPoint(g),this.spinner.decreaseJobCount(),c(100),null==(s=this.progressBar)||s.delayRemoveProgressItem(l),this.dispatchEvent("modelload")}))}setDistanceCullingFactor(e){this.distanceCullingFactor=e}getDistanceCullingFactor(){return this.distanceCullingFactor}setObjectOpacity(e,t){this.loadedModels.forEach((r=>r.setObjectOpacity(e,t))),this.enableRender()}setOtherObjectsOpacity(e,t){this.loadedModels.forEach((r=>{r.setOpacity(t),r.clearObjectOpacity(e)})),this.enableRender()}clearObjectOpacity(e){this.loadedModels.forEach((t=>t.clearObjectOpacity(e))),this.enableRender()}setModelOpacity(e){let t=this.loadedModels.find((t=>t.modelId===e));null==t||t.setOpacity(),this.enableRender()}clearModelOpacity(e){let t=this.loadedModels.find((t=>t.modelId===e));null==t||t.clearOpacity(),this.enableRender()}setModelsOpacity(e){this.loadedModels.forEach((t=>t.setOpacity(e))),this.enableRender()}clearModelsOpacity(){this.loadedModels.forEach((e=>e.clearOpacity())),this.enableRender()}setObjectVisible(e,t){this.loadedModels.forEach((r=>r.setObjectVisible(e,t))),this.enableRender()}hideOtherObjects(e){this.loadedModels.forEach((t=>{t.setVisible(!1),t.setObjectVisible(e,!0)})),this.enableRender()}setModelVisible(e,t){let r=this.loadedModels.find((t=>t.modelId===e));null==r||r.setVisible(t),this.enableRender()}setModelsVisible(e){this.loadedModels.forEach((t=>t.setVisible(e))),this.enableRender()}setObjectHighlight(e){this.loadedModels.forEach((t=>t.highlightObject(e))),this.enableRender()}clearHighlight(){this.loadedModels.forEach((e=>e.clearHighlight())),this.enableRender()}clearSelection(){this.selectedObject&&this.selectedObject instanceof Ki&&(this.selectedObject.selected=!1),this.selectedObject=void 0,this.clearHighlight()}get enableSelection(){return this._enableSelection}set enableSelection(e){e||this.clearSelection(),this._enableSelection=e}hasVisibleObject(){for(let e of this.loadedModels)if(e.hasVisibleObject())return!0;return!1}hasInvisibleObject(){for(let e of this.loadedModels)if(e.hasInvisibleObject())return!0;return!1}enableSsao(e){this.effect.enabled=e,this.effect.renderPassEnabled=e,this.effect.ssaaPassEnabled=e,this.effect.ssaoPassEnabled=e}getSsaoEnabled(){return this.effect.enabled&&this.effect.ssaoPassEnabled}setEnvironmentData(e){return bt(this,null,(function*(){yield this.sceneManager.setEnvironmentFromData(e),this.enableRender()}))}setEnvironment(e){return bt(this,null,(function*(){yield this.sceneManager.setEnvironment(e),this.enableRender()}))}showVertexNormals(e,t=.1){this.effect.showVertexNormals(e,t)}getLights(){return{sun:this.sceneManager.directionalLight,ambient:this.sceneManager.ambientLight,hemisphere:this.sceneManager.hemisphereLight}}debugLights(e){this.sceneManager.debugLights(e)}setModelClipPlanes(e,t){let r=this.loadedModels.find((t=>t.modelId===`${e}`));null==r||r.setClipPlanes(t),this.enableRender()}setGlobalClipPlanes(e){let t=e.length>0;this.sceneManager.enableClipping(t),this.sceneManager.setClipPlanes(e)}};function UMe(e){return on(on({},{asset:"",version:"",datetime:"",root:"",modelSize:0,generateTool:""}),e)}function HMe(e){return on(on({},{elementCount:0,batchElementCount:0,instanceElementCount:0,batchCount:0,instanceCount:0,tileCount:0,userDataCount:0,materialCount:0,meshVertexCount:0,meshFaceCount:0,textureCount:0,texturePixels:0}),e)}function IPt(e){let t={transform:new lt,boundingVolume:new Vt};return on(on({},t),e)}var lD=class{constructor(e){this.url=e,this.metadata=UMe(),this.statistics=HMe(),this.view=IPt()}parse(){return bt(this,null,(function*(){return yield fetch(this.url).then((e=>e.ok?e.json():(de.error(`[BimTiles] Failed to request "${this.url}", status ${e.status} : ${e.statusText}`),Promise.reject(!1)))).then((e=>(this.metadata=UMe(e.metadata),this.statistics=HMe(e.statistics),e.view.transform&&16===e.view.transform.length&&this.view.transform.fromArray(e.view.transform),e.view.boundingVolume&&6===e.view.boundingVolume.length&&this.view.boundingVolume.setFromArray(e.view.boundingVolume),Promise.resolve(!0))))}))}getMetadata(){return this.metadata}getStatistics(){return this.statistics}getView(){return this.view}},OPt=0,Cf=class extends nm{constructor(e,t){if(super(e),this.name="BimTilesViewer",this.loadedModels=[],this.enableHoverEffect=!1,this.effect=new Hb(this),this.pickUsageScene=new Xi,this.sceneManager.enableLights(!0),t)this.setHomeView(t),this.cameraManager.flyToViewpoint(t);else{let e={eye:new F(100,50,100),look:new F(0,0,0)};this.cameraManager.flyToViewpoint(e)}this.cameraManager.setProjection("Perspective"),this.cameraManager.setNavigationMode(0),this.setupDefaultEvents(),this.setDefaultBackground(),this.addEventListener("beforerender",(()=>{this.update3dTiles()}))}setupDefaultEvents(){let e,t,r=!1,i=0,n=0,a=0,s=e=>-1!==n&&-1!==a&&(Math.abs(e.x-n)<5&&Math.abs(e.y-a)<5),o=!1;this.inputManager.addEventListener("pointerdown",(i=>{var n,a;r=!1,e=i.button,this.renderImmediately();let s=new Te(i.x,i.y);if(t=this.pickManager.pick(s,this.pickUsageScene),o=!!this.selectedObject&&(null==t?void 0:t.tilesetId)===(null==(n=this.selectedObject)?void 0:n.tilesetId)&&(null==t?void 0:t.userId)===(null==(a=this.selectedObject)?void 0:a.userId),0===i.button){let e=this.pickUsageScene;if(t){let r=this.loadedModels.find((e=>e.modelId===`${null==t?void 0:t.tilesetId}`));if(r){let i=r.getObjectByUserId(t.userId);i&&(e=i)}}let r=this.pickManager.pickObject(s,[e]);this.handleAnchorPoint(r)}})),this.inputManager.addEventListener("pointermove",(t=>{if(void 0!==e)r=!s(t),0===e&&this.cameraManager.enableRotate&&this.cameraManager.setOrbitPointVisible(!0);else if(this.enableHoverEffect){let e=new Te(t.x,t.y),r=this.pickManager.pick(e,this.pickUsageScene),i=this.getHoveredObject();r?(!i||i.tilesetId!==r.tilesetId||i.userId!==r.userId)&&this.setObjectHoveredByUserId(r.tilesetId,r.userId,!0):i&&this.clearHovered()}this.handleMouseMove(t)})),this.inputManager.addEventListener("pointerup",(l=>{e=void 0,this.cameraManager.setOrbitPointVisible(!1),r?r=!1:0===l.button?(e=>{let t=e.timestamp-i;return!!(0===e.button&&t<300&&s(e))})(l)?(t?this.flyToUserId(t.tilesetId,t.userId):this.viewFitAll(),i=0,n=-1,a=-1):(this.selectedObject&&(this.clearHighlight(),this.selectedObject=void 0),i=l.timestamp,n=l.x,a=l.y,t&&!o&&this.handleClickObject(t)):l.button}))}setDefaultBackground(){this.sceneManager.setBackground(new dt(11119017)),this.sceneManager.setEnvironmentFromData()}renderImmediately(){let{renderer:e,scene:t,camera:r}=this;!e||!t||!r||e.render(t,r)}handleAnchorPoint(e){let t=new F;if(this.selectedObject){let e=this.getBoxByUserId(this.selectedObject.tilesetId,this.selectedObject.userId);null==e||e.getCenter(t)}else e&&e.point?t.copy(e.point):this.getBBox().getCenter(t);this.cameraManager.setOrbitPoint(t),this.cameraManager.update(0)}handleClickObject(e){if(!this.enableSelection)return;let t=this.loadedModels.find((t=>t.modelId===`${e.tilesetId}`));t&&(null==t||t.setObjectHighlightedByUserIds([e.userId],!0),this.selectedObject=e),this.enableRender()}is3d(){return!0}setModelOpacity(e,t){let r=this.loadedModels.find((t=>t.modelId===e));null==r||r.setOpacity(t),this.enableRender()}clearModelOpacity(e){let t=this.loadedModels.find((t=>t.modelId===e));null==t||t.clearOpacity(),this.enableRender()}setModelsOpacity(e){this.loadedModels.forEach((t=>t.setOpacity(e))),this.enableRender()}clearModelsOpacity(){this.loadedModels.forEach((e=>e.clearOpacity())),this.enableRender()}setModelVisible(e,t){let r=this.loadedModels.find((t=>t.modelId===e));null==r||r.setVisible(t),this.enableRender()}setModelsVisible(e){this.loadedModels.forEach((t=>t.setVisible(e))),this.enableRender()}clearHighlight(){this.loadedModels.forEach((e=>e.clearHighlight())),this.enableRender()}clearSelection(){this.selectedObject&&this.selectedObject instanceof Ki&&(this.selectedObject.selected=!1),this.selectedObject=void 0,this.clearHighlight()}get enableSelection(){return this._enableSelection}set enableSelection(e){e||this.clearSelection(),this._enableSelection=e}flyToUserId(e,t){let r=this.getBoxByUserId(e,t);r&&this.cameraManager.flyToBox(r)}getBoxByUserId(e,t){let r=this.loadedModels.find((t=>t.modelId===`${e}`));if(r)return r.getBBoxByUserId(t)}handleMouseMove(e){}update3dTiles(){if(!this.camera)return;let e=this.loadedModels.filter((e=>!!e.tilesRenderer));0!==e.length&&(this.camera.updateMatrixWorld(),e.forEach((e=>{e.tilesRenderer.update()})))}loadModel(e,t){return bt(this,null,(function*(){if(0===e.src.length)return Promise.reject();let t=new lD(e.src);if(!(yield t.parse()))return Promise.reject();let r=e.src.replace(/\/[^\\/]*\/?$/,"/");r=new URL(r,window.location.href).toString(),this.spinner.increaseJobCount();let i=t.getView().boundingVolume.clone();i.applyMatrix4(t.getView().transform);let n=new Ub({modelId:""+OPt++,bbox:i},r,t),a=n.getTilesRenderer(),s=a.group;if(a.onBeforeParseTile=()=>{this.spinner.increaseJobCount()},a.onLoadModel=e=>{e.traverse((e=>{e.matrixAutoUpdate&&(e.matrixAutoUpdate=!1,e.updateMatrix()),e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0),e.geometry&&e.layers.enableAll()})),this.enableRender(),setTimeout((()=>this.spinner.decreaseJobCount()),100)},a.setCamera(this.camera),a.setResolutionFromRenderer(this.camera,this.renderer),a.update(),s){s.applyMatrix4(t.getView().transform),n.pickUsageGroup.applyMatrix4(t.getView().transform),this.pickUsageScene.add(n.pickUsageGroup),this.addModel(n),this.cameraManager.adjustCameraByBBox(i);let e=new F;return i.getCenter(e),this.cameraManager.setOrbitPoint(e),1===this.loadedModels.length&&this.goToHomeView(),this.spinner.decreaseJobCount(),this.dispatchEvent("modelload"),Promise.resolve()}return this.spinner.decreaseJobCount(),Promise.reject()}))}setObjectHighlightedByUserIds(e,t,r){let i=this.loadedModels.find((t=>t.modelId===`${e}`));null==i||i.setObjectHighlightedByUserIds(t,r),this.enableRender()}setObjectOpacityByUserIds(e,t,r){let i=this.loadedModels.find((t=>t.modelId===`${e}`));null==i||i.setObjectOpacityByUserIds(t,r),this.enableRender()}setOtherObjectOpacityByUserIds(e,t,r){this.loadedModels.forEach((e=>{e.setOpacity(r)}));let i=`${e}`,n=this.loadedModels.find((e=>e.modelId===i));null==n||n.clearObjectOpacityByUserIds(t),this.enableRender()}setObjectVisibleByUserIds(e,t,r){let i=this.loadedModels.find((t=>t.modelId===`${e}`));null==i||i.setObjectVisibleByUserIds(t,r),this.enableRender()}setOtherObjectVisibleByUserIds(e,t,r){this.loadedModels.forEach((e=>{e.setVisible(r)}));let i=this.loadedModels.find((t=>t.modelId===`${e}`));null==i||i.setObjectVisibleByUserIds(t,!r),this.enableRender()}setObjectHoveredByUserId(e,t,r){if(!this.enableHoverEffect)return;this.clearHovered();let i=this.loadedModels.find((t=>t.modelId===`${e}`));null==i||i.setObjectHoveredByUserId(t,r),this.enableRender()}getHoveredObject(){for(let e of this.loadedModels){let t=e.getHoveredObject();if(t)return t}}clearHovered(){this.loadedModels.forEach((e=>e.clearHovered())),this.enableRender()}hasVisibleObject(){for(let e of this.loadedModels)if(e.hasVisibleObject())return!0;return!1}hasInvisibleObject(){for(let e of this.loadedModels)if(e.hasInvisibleObject())return!0;return!1}setModelClipPlanes(e,t){let r=this.loadedModels.find((t=>t.modelId===`${e}`));null==r||r.setClipPlanes(t),this.enableRender()}setGlobalClipPlanes(e){let t=e.length>0;this.sceneManager.enableClipping(!t),this.sceneManager.setClipPlanes(e)}showVertexNormals(e,t=.1){this.effect.showVertexNormals(e,t)}getLights(){return{sun:this.sceneManager.directionalLight,ambient:this.sceneManager.ambientLight,hemisphere:this.sceneManager.hemisphereLight}}debugLights(e){this.sceneManager.debugLights(e)}pickObjects(e,t){let r=this.pickManager.pick(e,this.pickUsageScene),i=this.pickUsageScene;if(r){let e=this.loadedModels.find((e=>e.modelId===`${null==r?void 0:r.tilesetId}`));if(e){let t=e.getObjectByUserId(r.userId);t&&(i=t)}}let n=this.pickManager.pickObjects(e,[i],t);return n&&this.renderer.clippingPlanes.length>0&&(n=n.filter((e=>this.renderer.clippingPlanes.every((function(t){return t.distanceToPoint(e.point)>0}))))),n}};function Vb(e){return{all:e=e||new Map,on:function(t,r){var i=e.get(t);i?i.push(r):e.set(t,[r])},off:function(t,r){var i=e.get(t);i&&(r?i.splice(i.indexOf(r)>>>0,1):e.set(t,[]))},emit:function(t,r){var i=e.get(t);i&&i.slice().map((function(e){e(r)})),(i=e.get("*"))&&i.slice().map((function(e){e(t,r)}))}}}var cD=class{constructor(e){this.viewer=e,this.itemList={},this.handleMouseWheel=e=>{e.preventDefault(),this.element&&(this.element.scrollLeft+=e.deltaY)},e.addEventListener("modelload",(()=>{this.init()}))}init(){var e;let t=document.createElement("div");t.classList.add("model-layout-switch-bar");let r=document.createElement("div");r.classList.add("model-layout-switch-bar-content"),r.addEventListener("wheel",this.handleMouseWheel),this.viewer.getLayoutNames().forEach(((e,t)=>{let i=this.createItem(e,t);this.itemList[e]=i,i.resetActivate=()=>{for(let e in this.itemList)this.itemList[e].resetActive()},null==r||r.appendChild(i.element)})),this.element=t,this.content=r,this.element.appendChild(this.content),null==(e=this.viewer.widgetContainer)||e.appendChild(this.element)}createItem(e,t){let r=new Aq(this.viewer,e);return 0===t&&r.setActive(!0),r}destroy(){var e,t;for(let t in this.itemList){let r=this.itemList[t];r.destroy(),null==(e=this.content)||e.removeChild(r.element)}this.itemList={},this.element&&this.content&&(this.element.removeChild(this.content),this.element.removeEventListener("wheel",this.handleMouseWheel),null==(t=this.viewer.widgetContainer)||t.removeChild(this.element),this.element=void 0)}show(){this.element&&(this.element.style.display="block")}hide(){this.element&&(this.element.style.display="none")}},Aq=class{constructor(e,t){this.viewer=e,this.eventBus=Vb(),this.active=!1,this.element=this.createItem(t),this.eventBus.on("activechange",(e=>{this.resetActivate&&this.resetActivate(),e?(this.element.classList.add("activate"),this.viewer.activateLayout(t)):this.element.classList.remove("activate")}))}createItem(e){let t=document.createElement("div"),r=document.createElement("span");return t.classList.add("model-layout-switch-item"),t.onclick=()=>{this.active=!this.active,this.eventBus.emit("activechange",this.active)},r.innerText=e,t.appendChild(r),t}setActive(e){this.active!==e&&(this.active=e,this.eventBus.emit("activechange",e))}resetActive(){this.active=!1,this.element.classList.remove("activate")}destroy(){this.eventBus.off("activechange")}},Gc=(e=>(e.Distance="Distance",e.Area="Area",e.Angle="Angle",e.Coordinate="Coordinate",e))(Gc||{}),td=class extends ba{constructor(e,t,r,i,n){super(),this.actived=!1,this.mouseMoved=!1,this.mouseDowned=!1,this.touchDowned=!1,this.mouseDownPositionX=-1,this.mouseDownPositionY=-1,this.snapPoint=void 0,this.touchstart=e=>{this.mobileTouchHelper&&this.mobileTouchHelper.isIntersect(e)&&!this.touchDowned&&(this.clearClickedDrawable(),this.viewer.getCameraManager().enableControl(!1),this.touchDowned=!0,this.mouseDownPositionX=e.x,this.mouseDownPositionY=e.y)},this.touchmove=e=>{if(e.pointers&&e.pointers.length>1)return;let{width:t,height:r}=this.viewer.viewerContainer.getBoundingClientRect();if(!(e.x>t-15||e.x<35||e.y<15||e.y>r-35)&&this.touchDowned&&this.mobileTouchHelper){let t=e.x-this.mouseDownPositionX,r=e.y-this.mouseDownPositionY;this.mobileTouchHelper.translate(t,r),this.mouseDownPositionX=e.x,this.mouseDownPositionY=e.y;let i=this.mobileTouchHelper.getTouchPoint(),n=this.getIntersections(i);if(!n.length)return void this.osnapHelper.deactivate();let a=Date.now();if(this.snapPoint=this.osnapHelper.handleSnap(n,this.viewer.is3d(),this.lastMouseDownPosition),de.debug(`[Measure] handleSnap costs ${(Date.now()-a)/1e3}s`),!this.snapPoint)return void console.warn("[Measure] Failed to find a snap point!");this.onMouseMove(this.snapPoint)}},this.touchend=e=>{var t;if(this.viewer.getCameraManager().enableControl(!0),!(e.pointers&&e.pointers.length>1)){if(this.touchDowned){this.touchDowned=!1;let e=null==(t=this.mobileTouchHelper)?void 0:t.getTouchPoint();this.onMouseClick(e)}else this.selectMeasurementByEvent(e);Pn.isMobile&&(this.osnapHelper.deactivate(),this.dispatchEvent("update"))}},this.mousedown=e=>{this.mouseMoved=!1,this.mouseDowned=!0,this.mouseDownPositionX=e.x,this.mouseDownPositionY=e.y},this.mousemove=e=>{if(this.lastMoveEvent=e,this.mouseDownPositionX>=0&&this.mouseDownPositionY>=0&&(Math.abs(e.x-this.mouseDownPositionX)>5||Math.abs(e.y-this.mouseDownPositionY)>5)&&(this.mouseMoved=!0),this.mouseDowned)return;let t=Date.now(),r=this.getIntersections(e);if(de.debug(`[Measure] getIntersections costs ${(Date.now()-t)/1e3}s`),!r.length)return void this.osnapHelper.deactivate();let i=Date.now();this.snapPoint=this.osnapHelper.handleSnap(r,this.viewer.is3d(),this.lastMouseDownPosition),de.debug(`[Measure] OSnapHelper.handleSnap costs ${(Date.now()-i)/1e3}s`),this.snapPoint?this.onMouseMove(this.snapPoint):console.warn("[Measure] Failed to find a snap point!")},this.mouseup=e=>{this.mouseDowned=!1,this.mouseMoved||this.onMouseClick(e)},this.dblclick=()=>{de.info("[Measure] Double clicked")},this.keydown=e=>{if("Enter"===e.code){let e={x:0,y:0,pageX:0,pageY:0,clientX:0,clientY:0,deltaX:0,deltaY:0,button:2,movementX:0,movementY:0,deltaMode:0,pointerId:0,timestamp:0,buttons:0,pointerType:"mouse",altKey:!1,ctrlKey:!1,shiftKey:!1,metaKey:!1};this.onMouseClick(e)}else"Escape"===e.code&&this.cancel()},this.getIntersections=e=>{let t=new Te(e.x,e.y);return this.viewer.pickObjects(t)},this.type=e,this.viewer=t,this.inputManager=r,this.drawList=i,this.osnapHelper=n}get overlayRender(){return this.viewer.getOverlayRender()}get renderer(){return this.viewer.renderer}get isActive(){return this.actived}get isMeasuring(){return!1===this.completed}setTouchHelper(e){this.mobileTouchHelper=e}createMobileExitButton(){let e=this.viewer.widgetContainer,t=document.createElement("button");return t.innerText="X",t.style.cssText="position: absolute;right: 5%; top: 5%;background-color: #000000;color: #ffffff;padding: 3px 10px;font-weight: bolder;",null==e||e.appendChild(t),this.exitButton=t,this.exitButton.style.display="none",t.addEventListener("touchstart",(()=>{this.exitDrawing(),this.exitButton&&(this.exitButton.style.display="none")})),this.addEventListener("firstpointpicked",this.firstPickedListener=()=>{this.exitButton&&(this.exitButton.style.display="inline-block")}),this.addEventListener("complete",this.completedListener=()=>{this.exitButton&&(this.exitButton.style.display="none")}),this.exitButton}activate(){if(this.actived=!0,Pn.isMobile)this.inputManager.addEventListener("touchstart",this.touchstart),this.inputManager.addEventListener("touchmove",this.touchmove),this.inputManager.addEventListener("touchend",this.touchend);else{this.inputManager.addEventListener("pointerdown",this.mousedown),this.inputManager.addEventListener("pointermove",this.mousemove),this.inputManager.addEventListener("pointerup",this.mouseup),this.tooltip=new Dc("measure-tooltip",xn("Tooltip.measure"),{followPointer:!0,showOnCreate:!0,parentNode:this.viewer.widgetContainer,target:this.viewer.viewerContainer});let e=document.getElementById("measure-tooltip");e&&(e.style.pointerEvents="none"),this.setTooltipContent()}this.inputManager.addEventListener("dblclick",this.dblclick),this.inputManager.addEventListener("keydown",this.keydown)}deactivate(){var e,t;this.actived=!1,Pn.isMobile?(this.inputManager.removeEventListener("touchstart",this.touchstart),this.inputManager.removeEventListener("touchmove",this.touchmove),this.inputManager.removeEventListener("touchend",this.touchend)):(this.inputManager.removeEventListener("pointerdown",this.mousedown),this.inputManager.removeEventListener("pointermove",this.mousemove),this.inputManager.removeEventListener("pointerup",this.mouseup)),this.inputManager.removeEventListener("dblclick",this.dblclick),this.inputManager.removeEventListener("keydown",this.keydown),null==(e=this.tooltip)||e.hide(),null==(t=this.tooltip)||t.destroy(),this.tooltip=void 0,this.currentMeasureDrawable&&this.removeDrawable(this.currentMeasureDrawable),this.osnapHelper.deactivate(),this.drawingPoints=void 0,this.currentMeasureDrawable=void 0,this.lastMouseDownPosition=void 0}removeDrawable(e){this.dispatchEvent("beforeremove",e)}clearClickedDrawable(){this.clickedOnMeasurementDrawable&&(this.clickedOnMeasurementDrawable.selected=!1,this.clickedOnMeasurementDrawable=void 0)}onMouseClick(e){if(Pn.isMobile)return;let t=Date.now();this.lastClickTime&&t-this.lastClickTime<500||(this.lastClickTime=t,this.selectMeasurementByEvent(e))}selectMeasurementByEvent(e){if(this.clickedOnMeasurementDrawable&&(this.clickedOnMeasurementDrawable.selected=!1,this.clickedOnMeasurementDrawable=void 0),null==this.completed||!0===this.completed){let t=this.getIntersections(e)[0];if(t){let e=this.overlayRender.getDrawablesByDrawableListAndPosition(this.drawList,t.point);e&&(this.dispatchEvent("onclick",e),this.clickedOnMeasurementDrawable=e)}}}onMouseMove(e){this.createOrUpdateMeasureDrawable(e)}createOrUpdateMeasureDrawable(e){if(!this.drawingPoints||this.drawingPoints&&this.drawingPoints.length<1)return;let t=[...this.drawingPoints];if(!this.currentMeasureDrawable)return this.currentMeasureDrawable=this.createMeasureDrawable(),this.currentMeasureDrawable&&(this.currentMeasureDrawable.selected=!0),void this.dispatchEvent("beforeadd",this.currentMeasureDrawable);e&&t.push(e),this.currentMeasureDrawable.selected=!0,this.currentMeasureDrawable.update(t),this.currentMeasureDrawable.setDrawingState(!0),this.dispatchEvent("update")}},oo=class extends Ki{constructor(e,t){super(e),this.type="Distance",this.labelBounds=new ts,this.drawing=!1,this.update(t)}setDrawingState(e){this.drawing=e}drawSelect(e,t){let r=this.getVertexes();this.drawPoints(e,t,r)}drawPoints(e,t,r){e.save(),e.fillStyle=oo.MAJOR_COLOR,e.strokeStyle=oo.MINOR_COLOR,e.lineWidth=oo.LINE_WIDTH,e.beginPath(),(this.drawing?r.slice(0,r.length-1):r).forEach((r=>{let i=this.transToScreenCoord(r,t);e.moveTo(i.x+oo.POINT_RADIUS,i.y),e.arc(i.x,i.y,oo.POINT_RADIUS,0,2*Math.PI)})),e.closePath(),e.fill(),e.stroke(),e.restore()}drawText(e,t){if(!this.label||!this.labelPositon)return;e.font=`${oo.LABEL_FONT_SIZE}px Arial`;let r=1.2*e.measureText(this.label).width,i=1.5*oo.LABEL_FONT_SIZE;this.labelBounds.setFromCenterAndSize(this.labelPositon,new Te(r,i)),this.drawRoundRect(e,this.labelPositon.x-r/2,this.labelPositon.y-i/2,r,i,4),e.save(),e.fillStyle=oo.MINOR_COLOR,e.textBaseline="middle",e.textAlign="center",e.fillText(this.label,this.labelPositon.x,this.labelPositon.y),e.restore()}drawRoundRect(e,t,r,i,n,a){i<2*a&&(a=i/2),n<2*a&&(a=n/2),e.save(),e.fillStyle=oo.MAJOR_COLOR,e.strokeStyle=oo.MINOR_COLOR,e.lineWidth=oo.LINE_WIDTH,e.beginPath(),e.moveTo(t+a,r),e.arcTo(t+i,r,t+i,r+n,a),e.arcTo(t+i,r+n,t,r+n,a),e.arcTo(t,r+n,t,r,a),e.arcTo(t,r,t+i,r,a),e.closePath(),e.fill(),this.selected&&e.stroke(),e.restore()}getVertexes(){return this.points}update(e){let{min:t,max:r}=(new Vt).setFromPoints(e);return this.x=t.x,this.y=t.y,this.width=Math.abs(r.x-t.x),this.height=Math.abs(r.y-t.y),this.points=e,this}getBounds(){let e=this.getVertexes();return(new Vt).setFromPoints(e)}getData(){return{id:this.id,type:this.type,points:this.points.map((e=>[e.x,e.y,e.z]))}}setData(e){super.setData(e),this.setLineColor(Br.colorStr2Rgba(oo.MAJOR_COLOR)),this.setFillColor(Br.colorStr2Rgba(oo.AREA_FILL_COLOR)),this.setLineWidth(oo.LINE_WIDTH)}isPointInPath(e,t){let r=null==t?void 0:t.ray;if(!r)return!1;let i=3*this.tolerance,n=this.transToScreenCoord(e,t.camera);if(this.labelBounds.containsPoint(n))return!0;let a=new F,s=new F,o=this.points;for(let e=0;e<o.length-1;e++){let t=o[e],n=o[e+1]||o[0];if(r.distanceSqToSegment(t,n,s,a)<i*i)return!0}return!1}getUnitString(){return"Distance"===this.type?fT("mm"):"Area"===this.type?`${fT("m",2)}`:"Angle"===this.type?"°":""}},Jn=oo;Jn.MAJOR_COLOR="rgba(249, 157, 11, 0.9)",Jn.MINOR_COLOR="rgb(255, 255, 255)",Jn.AREA_FILL_COLOR="rgba(249, 157, 11, 0.3)",Jn.LINE_WIDTH=2,Jn.POINT_RADIUS=5,Jn.LABEL_FONT_SIZE=14;var mS=class extends Jn{constructor(e,t){super(e,t),this.type="Angle",this.update(t)}draw(e,t){e.save(),e.lineWidth=Jn.LINE_WIDTH,e.strokeStyle=Jn.MAJOR_COLOR;let r=this.points;if(e.beginPath(),r.forEach(((r,i)=>{let n=this.transToScreenCoord(r,t);0===i?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y)})),3===this.points.length){let[r,i,n]=this.points.map((e=>this.transToScreenCoord(e,t))),a=(new Te).subVectors(r,i).normalize(),s=(new Te).subVectors(n,i).normalize(),o=Math.min(r.distanceTo(i),n.distanceTo(i)),l=a.angle(),h=s.angle();e.moveTo(i.x,i.y),e.arc(i.x,i.y,o/5,l,h,a.cross(s)<0)}if(e.stroke(),e.restore(),this.drawing){let r=1===this.points.length?this.points:this.points.slice(0,this.points.length-1);this.drawPoints(e,t,r)}this.drawText(e,t)}drawText(e,t){if(this.points.length<3)return;let[r,i,n]=this.points,a=this.getAngleBisector(r,i,n),s=this.calculateAngle(r,i,n);this.label=`${Ch(s,2)} ${this.getUnitString()}`;let o=.3*Math.min(r.distanceTo(i),n.distanceTo(i));this.labelPositon=this.transToScreenCoord(i.clone().add(new F(a.x*o,a.y*o,a.z*o)),t),super.drawText(e,t)}getAngleBisector(e,t,r){let i=e,n=t,a=r,s=new F(i.x-n.x,i.y-n.y,i.z-n.z).normalize(),o=new F(a.x-n.x,a.y-n.y,a.z-n.z).normalize();return new F(s.x+o.x,s.y+o.y,s.z+o.z).normalize()}calculateAngle(e,t,r){let i=e,n=t,a=r,s=new F(i.x-n.x,i.y-n.y,i.z-n.z),o=new F(a.x-n.x,a.y-n.y,a.z-n.z);return 180*s.angleTo(o)/Math.PI}getClassType(){return"Angle"}};Jr._registerDrawableClass(mS);var uD=class extends td{constructor(e,t,r,i){super("Angle",e,t,r,i)}createMeasureDrawable(){if(this.drawingPoints)return new mS(Ut.guid(),this.drawingPoints)}onMouseClick(e){var t;if(super.onMouseClick(e),this.clickedOnMeasurementDrawable)return;if(this.drawingPoints||(this.drawingPoints=[]),2===e.button)return void this.exitDrawing();let r=this.getIntersections(e)[0];if(!r)return;let i=null!=(t=this.snapPoint)?t:null==r?void 0:r.point;if(this.drawingPoints[0]&&or.areVector3sEqual(this.drawingPoints[0],i))return;let n=this.drawingPoints;n.push(i),this.lastMouseDownPosition=i,1===n.length&&(this.dispatchEvent("firstpointpicked"),this.completed=!1),this.createOrUpdateMeasureDrawable(),n.length>=3&&this.complete()}exitDrawing(){this.drawingPoints=void 0,this.currentMeasureDrawable&&(this.removeDrawable(this.currentMeasureDrawable),this.currentMeasureDrawable=void 0),this.completed=void 0,this.lastMouseDownPosition=void 0}complete(){var e;!0!==this.completed&&(null==(e=this.currentMeasureDrawable)||e.setDrawingState(!1),this.dispatchEvent("complete",this.currentMeasureDrawable),this.completed=!0,this.currentMeasureDrawable=void 0,this.drawingPoints=void 0,this.lastMouseDownPosition=void 0)}cancel(){let e=this.drawingPoints;if(e&&e.length>0&&(e.pop(),0===e.length&&(this.currentMeasureDrawable&&(this.removeDrawable(this.currentMeasureDrawable),this.currentMeasureDrawable=void 0),this.completed=!0),this.lastMoveEvent)){let e=this.getIntersections(this.lastMoveEvent)[0];e&&this.onMouseMove(e.point)}this.osnapHelper.deactivate(),this.lastMouseDownPosition=void 0}deactivate(){super.deactivate(),this.currentMeasureDrawable&&this.removeDrawable(this.currentMeasureDrawable)}setTooltipContent(){var e;let t=xn("Tooltip.measure");t&&this.tooltip&&(null==(e=this.tooltip)||e.setContent(t))}},xm=class extends Jn{constructor(e,t,r){super(e,t),this.type="Area",this.scale=r,this.update(t)}draw(e,t){let r=this.points;if(e.save(),e.lineWidth=Jn.LINE_WIDTH,e.strokeStyle=Jn.MAJOR_COLOR,e.fillStyle=Jn.AREA_FILL_COLOR,e.beginPath(),r.forEach(((r,i)=>{let n=this.transToScreenCoord(r,t);0===i?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y)})),e.closePath(),e.fill(),e.stroke(),e.restore(),this.drawing){let r=1===this.points.length?this.points:this.points.slice(0,this.points.length-1);this.drawPoints(e,t,r)}this.drawText(e,t)}drawText(e,t){if(this.points.length<3)return;let r=this.points,i=this.calculateArea(r);this.scale&&(i*=Math.pow(this.scale,2)),this.label=`${Ch(i,2)}`,this.labelPositon=this.transToScreenCoord(this.getBarycenter(r),t),super.drawText(e,t)}calculateArea(e){let t=0,r=r0.getFaces(e);for(let i=0;i<r.length/3;i++){let n=e[r[3*i]],a=e[r[3*i+1]],s=e[r[3*i+2]],o=a.clone().sub(n),l=s.clone().sub(n);t+=o.cross(l).length()/2}return t}getBarycenter(e){let t=e.length,r=0,i=0,n=0;return e.forEach((e=>{r+=e.x,i+=e.y,n+=e.z})),new F(r/t,i/t,n/t)}isPointInPath(e,t){let r=null==t?void 0:t.ray;if(!r)return!1;let i=this.transToScreenCoord(e,t.camera);if(this.labelBounds.containsPoint(i))return!0;let n=3*this.tolerance,a=new F,s=new F,o=this.points;for(let e=0;e<o.length;e++){let t=o[e],i=o[e+1]||o[0];if(r.distanceSqToSegment(t,i,s,a)<n*n)return!0}let l=r0.getFaces(this.points);for(let t=0;t<l.length/3;t++){let i=this.points[l[3*t]],n=this.points[l[3*t+1]],a=this.points[l[3*t+2]];if(r.intersectTriangle(i,n,a,!1,e))return!0}return!1}getClassType(){return"Area"}};Jr._registerDrawableClass(xm);var VMe=new F,hD=class extends td{constructor(e,t,r,i){super("Area",e,t,r,i)}activate(){super.activate()}deactivate(){super.deactivate(),this.currentMeasureDrawable&&this.removeDrawable(this.currentMeasureDrawable),this.exitButton&&(this.exitButton.style.display="none")}createMeasureDrawable(){if(this.drawingPoints)return new xm(Ut.guid(),this.drawingPoints,this.scale)}onMouseMove(e){if(super.onMouseMove(e),this.drawingPoints&&this.drawingPoints.length>2&&this.drawingPoints[0]){let t=this.drawingPoints[0];VMe.subVectors(e,t).length()<3*this.viewer.getPixelSizeInWorldCoord()&&(this.osnapHelper.activateMarker(1,{point:t,type:1,distance:0}),de.info("[Measure] auto close area measurement."))}}onMouseClick(e){var t,r;if(super.onMouseClick(e),this.clickedOnMeasurementDrawable)return;this.drawingPoints||(this.drawingPoints=[]);let i=this.drawingPoints;if(2===e.button)return void this.exitDrawing();let n=this.getIntersections(e)[0];if(!n)return void de.warn("[Measure] No intersection found!");let a=null!=(r=null==(t=this.snapPoint)?void 0:t.clone())?r:null==n?void 0:n.point.clone();if(this.drawingPoints&&this.drawingPoints.length>2&&this.drawingPoints[0]){let e=this.drawingPoints[0];if(VMe.subVectors(a,e).length()<3*this.viewer.getPixelSizeInWorldCoord())return de.info("[Measure] auto close area measurement."),this.touchDowned=!1,void this.exitDrawing()}this.drawingPoints[0]&&or.areVector3sEqual(this.drawingPoints[0],a)||(i.push(a),this.lastMouseDownPosition=a,1===i.length&&(this.dispatchEvent("firstpointpicked"),this.completed=!1),this.createOrUpdateMeasureDrawable())}exitDrawing(){let e=this.drawingPoints||[],t=!0;if(e.length<3&&(de.warn("[Measure] If the number of points is less than 3, the measurement area cannot be formed !"),t=!1),t&&r0.isSelfIntersecting(e)&&(de.warn("[Measure] The area formed by these points intersects itself, so the correct measurement cannot be obtained !"),t=!1),!t)return this.drawingPoints=void 0,this.currentMeasureDrawable&&(this.removeDrawable(this.currentMeasureDrawable),this.currentMeasureDrawable=void 0),this.completed=void 0,void(this.lastMouseDownPosition=void 0);this.createOrUpdateMeasureDrawable(),this.complete()}complete(){var e;!0!==this.completed&&(null==(e=this.currentMeasureDrawable)||e.setDrawingState(!1),this.dispatchEvent("complete",this.currentMeasureDrawable),this.completed=!0,this.drawingPoints=void 0,this.currentMeasureDrawable=void 0,this.lastMouseDownPosition=void 0)}cancel(){let e=this.drawingPoints;if(e&&e.length>0&&(e.pop(),0===e.length&&(this.currentMeasureDrawable&&(this.removeDrawable(this.currentMeasureDrawable),this.currentMeasureDrawable=void 0),this.completed=!0),this.lastMoveEvent)){let e=this.getIntersections(this.lastMoveEvent)[0];e&&this.onMouseMove(e.point)}this.osnapHelper.deactivate(),this.lastMouseDownPosition=void 0}setTooltipContent(){var e;let t=xn("Tooltip.areaMeasurement");t&&this.tooltip&&(null==(e=this.tooltip)||e.setContent(t))}getScale(){return this.scale}setScale(e){this.scale=e;let t=this.drawList.getDrawables();for(let r of t){let t=r[1];t instanceof xm&&(t.scale=e)}}},gS=class extends Jn{constructor(e,t){super(e,t),this.type="Coordinate",this.update(t)}draw(e,t){this.drawText(e,t),e.save(),e.lineWidth=Jn.LINE_WIDTH,e.strokeStyle=Jn.MAJOR_COLOR,e.fillStyle=Jn.AREA_FILL_COLOR;let r=this.points;e.beginPath(),r.forEach((r=>{let i=this.transToScreenCoord(r,t);e.arc(i.x,i.y,Jn.POINT_RADIUS,0,2*Math.PI)})),e.fill(),e.stroke(),e.restore()}drawText(e,t){let r=this.points[0];or.areNumbersEqual(r.x,0);let i=or.areNumbersEqual(r.x,0)?0:r.x,n=or.areNumbersEqual(r.y,0)?0:r.y,a=or.areNumbersEqual(r.z,0)?0:r.z;this.label=`${Ch(i,2)}, ${Ch(n,2)}, ${Ch(a,2)}`,e.font=`${Jn.LABEL_FONT_SIZE}px Arial`;let s=1.2*e.measureText(this.label).width,o=1.5*Jn.LABEL_FONT_SIZE;this.labelPositon=this.transToScreenCoord(r,t),this.labelPositon.y-=o/2,this.labelBounds.setFromCenterAndSize(this.labelPositon,new Te(s,o)),this.drawRoundRect(e,this.labelPositon.x-s/2,this.labelPositon.y-o/2,s,o,4),e.save(),e.fillStyle=Jn.MINOR_COLOR,e.textBaseline="middle",e.textAlign="center",e.fillText(this.label,this.labelPositon.x,this.labelPositon.y),e.restore()}getClassType(){return"Coordinate"}};Jr._registerDrawableClass(gS);var dD=class extends td{constructor(e,t,r,i){super("Coordinate",e,t,r,i)}createMeasureDrawable(){if(this.drawingPoints)return new gS(Ut.guid(),this.drawingPoints)}onMouseClick(e){var t;if(super.onMouseClick(e),this.clickedOnMeasurementDrawable)return;if(this.drawingPoints||(this.drawingPoints=[]),2===e.button)return void this.exitDrawing();let r=this.getIntersections(e)[0];if(!r)return;let i=null!=(t=this.snapPoint)?t:null==r?void 0:r.point,n=this.drawingPoints;n.push(i),this.lastMouseDownPosition=i,1===n.length&&(this.dispatchEvent("firstpointpicked"),this.completed=!1),this.createOrUpdateMeasureDrawable(i),n.length>=1&&this.complete()}exitDrawing(){this.drawingPoints=void 0,this.currentMeasureDrawable&&(this.removeDrawable(this.currentMeasureDrawable),this.currentMeasureDrawable=void 0),this.completed=void 0,this.lastMouseDownPosition=void 0}complete(){!0!==this.completed&&(this.dispatchEvent("complete",this.currentMeasureDrawable),this.completed=!0,this.drawingPoints=void 0,this.currentMeasureDrawable=void 0,this.lastMouseDownPosition=void 0)}cancel(){let e=this.drawingPoints;if(e&&e.length>0&&(e.pop(),0===e.length&&(this.completed=!0),this.lastMoveEvent)){let e=this.getIntersections(this.lastMoveEvent)[0];e&&this.onMouseMove(e.point)}this.osnapHelper.deactivate(),this.drawingPoints=void 0,this.currentMeasureDrawable=void 0,this.lastMouseDownPosition=void 0}setTooltipContent(){var e;let t=xn("Tooltip.measure");t&&this.tooltip&&(null==(e=this.tooltip)||e.setContent(t))}},Rq=class extends Jn{constructor(e,t,r){super(e,t),this.type="Distance",this.scale=r,this.update(t)}draw(e,t){let r=this.points;if(e.save(),e.lineWidth=Jn.LINE_WIDTH,e.strokeStyle=Jn.MAJOR_COLOR,e.beginPath(),r.forEach(((r,i)=>{let n=this.transToScreenCoord(r,t);0===i?e.moveTo(n.x,n.y):e.lineTo(n.x,n.y)})),e.closePath(),e.stroke(),e.restore(),this.drawing){let r=1===this.points.length?this.points:this.points.slice(0,this.points.length-1);this.drawPoints(e,t,r)}else this.selected||this.drawVerticalLine(e,t);this.drawText(e,t)}drawText(e,t){if(this.points.length<2)return;let[r,i]=this.points,n=r.distanceTo(i);this.scale&&(n*=this.scale),this.label=`${Ch(n,2)}`,this.labelPositon=this.transToScreenCoord((new F).lerpVectors(r,i,.5),t),super.drawText(e,t)}drawVerticalLine(e,t){if(this.points.length<2)return;let[r,i]=this.points.map((e=>this.transToScreenCoord(e,t))),[n,a]=this.getShortLineBySegments(r,i),[s,o]=this.getShortLineBySegments(i,r);e.save(),e.lineWidth=Jn.LINE_WIDTH,e.strokeStyle=Jn.MAJOR_COLOR,e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(a.x,a.y),e.moveTo(s.x,s.y),e.lineTo(o.x,o.y),e.stroke(),e.restore()}getShortLineBySegments(e,t){let r=(new Te).subVectors(t,e).normalize(),i=Rq.SHORT_LINE_LENGTH/2,n=Math.PI/2;return[r.clone().rotateAround(new Te,n).normalize().multiplyScalar(i).add(e),r.clone().rotateAround(new Te,-n).normalize().multiplyScalar(i).add(e)]}getClassType(){return"Distance"}setScale(e){this.scale=e}},N0=Rq;N0.SHORT_LINE_LENGTH=12,Jr._registerDrawableClass(N0);var fD=class extends td{constructor(e,t,r,i){super("Distance",e,t,r,i)}createMeasureDrawable(){if(this.drawingPoints)return new N0(Ut.guid(),this.drawingPoints,this.scale)}onMouseClick(e){var t;if(super.onMouseClick(e),this.clickedOnMeasurementDrawable)return;if(this.drawingPoints||(this.drawingPoints=[]),2===e.button)return void this.exitDrawing();let r=this.getIntersections(e)[0];if(!r)return;let i=null!=(t=this.snapPoint)?t:null==r?void 0:r.point;if(this.drawingPoints[0]&&or.areVector3sEqual(this.drawingPoints[0],i))return;let n=this.drawingPoints;n.length<2&&n.push(i),this.lastMouseDownPosition=i,1===n.length&&(this.dispatchEvent("firstpointpicked"),this.completed=!1),this.createOrUpdateMeasureDrawable(),n.length>=2&&this.complete()}exitDrawing(){this.drawingPoints=void 0,this.currentMeasureDrawable&&(this.removeDrawable(this.currentMeasureDrawable),this.currentMeasureDrawable=void 0),this.completed=void 0,this.lastMouseDownPosition=void 0}complete(){var e;!0!==this.completed&&(null==(e=this.currentMeasureDrawable)||e.setDrawingState(!1),this.dispatchEvent("complete",this.currentMeasureDrawable),this.completed=!0,this.drawingPoints=void 0,this.currentMeasureDrawable=void 0,this.lastMouseDownPosition=void 0)}cancel(){let e=this.drawingPoints;e&&e.length>0&&(e.pop(),0===e.length&&(this.completed=!0),this.currentMeasureDrawable&&this.removeDrawable(this.currentMeasureDrawable)),this.osnapHelper.deactivate(),this.drawingPoints=void 0,this.currentMeasureDrawable=void 0,this.lastMouseDownPosition=void 0}deactivate(){super.deactivate(),this.currentMeasureDrawable&&this.removeDrawable(this.currentMeasureDrawable)}setTooltipContent(){var e;let t=xn("Tooltip.measure");t&&this.tooltip&&(null==(e=this.tooltip)||e.setContent(t))}getScale(){return this.scale}setScale(e){this.scale=e;let t=this.drawList.getDrawables();for(let r of t){let t=r[1];(t instanceof N0||t instanceof xm)&&(t.scale=e)}}},vn=class extends ba{constructor(e,t){if(!t.id)throw new Error("[Plugin] Missing plugin id!");super(),this.id=t.id,this.viewer=e,e.addPlugin(this)}destroy(){this.viewer.removePlugin(this)}},Cq=class extends vn{constructor(e){var t,r;super(e,{id:Cq.DEFAULT_ID}),this.selectedDrawable=void 0,this.drawableList=new Ol("measure"),this.drawableHelperList=new Ol("touchHelper"),this.snapToleranceInPixel=3,this.measurements={},this.activeMeasurementType=void 0,this.keydown=e=>{var t;let r,i=this.getActiveMeasurementType();i&&(r=this.measurements[i]);let n=this.selectedDrawable;n&&"Delete"===e.code&&(this.remove(n),null==(t=this.viewer.undoManager)||t.addCommand(new HI(this,n.getData())),this.activeMeasurementType&&this.measurements[this.activeMeasurementType].clearClickedDrawable()),e.ctrlKey&&"KeyZ"===e.code&&null!=r&&r.isMeasuring&&r.cancel(),e.ctrlKey&&"KeyY"===e.code&&null!=r&&r.isMeasuring};let i=e.getInputManager();if(!i)throw"InputManager init error";this.inputManager=i,this.overlayRender=this.viewer.overlayRender,null==(t=this.overlayRender)||t.addDrawableList(this.drawableHelperList),null==(r=this.overlayRender)||r.addDrawableList(this.drawableList);let n=new PI(this.overlayRender);e.is3d()&&(n.setOSnapTypeEnabled(32,!1),n.setOSnapTypeEnabled(64,!1)),this.measurements.Distance=new fD(e,i,this.drawableList,n),this.measurements.Area=new hD(e,i,this.drawableList,n),this.measurements.Angle=new uD(e,i,this.drawableList,n),this.measurements.Coordinate=new dD(e,i,this.drawableList,n),this.osnapHelper=n,this.inputManager.addEventListener("wheel",(()=>{this.updateSnapTolerance()})),this.viewer.addEventListener("layoutchange",(()=>{this.updateSnapTolerance()})),this.initEvents()}initEvents(){Object.values(this.measurements).forEach((e=>{e.addEventListener("complete",(e=>{var t;this.viewer.dispatchEvent("measurementadd",e.getData()),null==(t=this.viewer.undoManager)||t.addCommand(new Tw(this,e.getData())),this.select(e)})),e.addEventListener("beforeadd",(e=>{this.add(e,!1)})),e.addEventListener("update",(()=>{this.render()})),e.addEventListener("beforeremove",(e=>{this.remove(e,!1)})),e.addEventListener("deactivate",(()=>{this.osnapHelper.deactivate(),this.viewer.deactivateMeasurement()})),e.addEventListener("firstpointpicked",(()=>{this.unselect()})),e.addEventListener("onclick",(e=>{this.select(e)}))}))}get canvas(){var e;return null==(e=this.viewer.renderer)?void 0:e.domElement}get raycaster(){return this.viewer.getRaycaster()}add(e,t=!0){this.drawableList.addDrawable(e),this.selectedDrawable=e,this.render(),t&&this.viewer.dispatchEvent("measurementadd",e.getData())}create(e){return Jr.createDrawable(e)}remove(e,t=!0){this.drawableList.removeDrawable(e),this.render(),t&&this.viewer.dispatchEvent("measurementremove",e.getData())}setSnapTolerance(e){this.snapToleranceInPixel=e,this.updateSnapTolerance()}updateSnapTolerance(){let e=this.viewer.getPixelSizeInWorldCoord()*this.snapToleranceInPixel;this.osnapHelper.setSnapTolerance(e)}activate(e){this.activeMeasurementType&&this.deactivate(),this.measurements[e]?(this.measurements[e].activate(),this.activeMeasurementType=e,this.updateSnapTolerance()):(this.activeMeasurementType=void 0,de.error("[Measure] Failed to activate measurement, type:",e));let{width:t,height:r}=this.canvas.getBoundingClientRect();Pn.isMobile&&this.canvas&&!this.mobileTouchHelper&&(this.mobileTouchHelper=new LI(new Te(t/2,r/2)),this.drawableHelperList.addDrawable(this.mobileTouchHelper)),this.mobileTouchHelper&&(this.mobileTouchHelper.setPosition(new Te(t/2,r/2)),this.measurements[e].setTouchHelper(this.mobileTouchHelper),this.mobileTouchHelper.visible=!0,this.render()),this.enableSelection=this.viewer.enableSelection,this.viewer.enableSelection=!1,this.inputManager.addEventListener("keydown",this.keydown)}deactivate(){this.unselect();let e=this.activeMeasurementType;e&&this.measurements[e].deactivate(),this.activeMeasurementType=void 0,this.mobileTouchHelper&&(this.mobileTouchHelper.visible=!1,this.render()),null!=this.enableSelection&&(this.viewer.enableSelection=this.enableSelection),this.enableSelection=void 0,this.inputManager.removeEventListener("keydown",this.keydown)}getActiveMeasurementType(){return this.activeMeasurementType}isActive(){let e=this.activeMeasurementType;return e?this.measurements[e].isActive:!!this.getActiveMeasurementType()}isMeasuring(){let e=this.activeMeasurementType;return!!e&&this.measurements[e].isMeasuring}getData(){return this.drawableList.getDrawableDatas()}cancel(){let e=this.activeMeasurementType;e&&this.measurements[e].exitDrawing()}setData(e){var t,r;null==(t=this.viewer.undoManager)||t.startTransaction(),e.forEach((e=>{var t;this.measurements[e.type]?e.points.length>=2?(this.add(Jr.createDrawable(e)),null==(t=this.viewer.undoManager)||t.addCommand(new Tw(this,e))):de.info("[Measure] Invalid points found in MeasurementData:",e):de.warn("[Measure] Failed to add measurement data for",e)})),null==(r=this.viewer.undoManager)||r.endTransaction()}setVisibleById(e,t){let r=this.drawableList.getDrawables().get(e);return!!r&&(r.visible!==t&&(r.visible=t,this.render()),!0)}setVisibilities(e){let t=!1;this.drawableList.getDrawables().forEach((r=>{r.visible!==e&&(r.visible=e,t=!0)})),t&&this.render()}clear(){let e=this.activeMeasurementType;e&&this.measurements[e].exitDrawing(),this.drawableList.clear(),this.render()}getById(e){return this.drawableList.getDrawableById(e)}removeById(e){let t=this.drawableList.getDrawableById(e);t?this.remove(t):de.warn("[Measure] Failed to find measurement by id:",e)}selectById(e){let t=this.drawableList.getDrawableById(e);t&&this.select(t)}select(e){this.unselect(!1),e.selected=!0,this.selectedDrawable=e,this.render()}unselect(e=!0){this.selectedDrawable&&(this.selectedDrawable.selected=!1,e&&this.render()),this.selectedDrawable=void 0}getScale(){return this.measurements.Distance.getScale()}setScale(e){if(!e||e<=0)return void de.error("[Measure] Invalid scale value:",e);let t=this.measurements.Distance,r=this.measurements.Area;t.setScale(e),r.setScale(e)}destroy(){super.destroy(),this.deactivate(),this.clear(),this.drawableHelperList.clear(),this.measurements={},this.osnapHelper.destroy(),this.render()}render(e=!1){var t;e?this.viewer.enableRender():null==(t=this.overlayRender)||t.render()}},Pf=Cq;Pf.DEFAULT_ID="MeasurementPlugin";var DPt=-1e3,pD=new F,zMe=new lt,GMe=new Ml,Pq=new Vt,Em=class extends nm{constructor(e){super(e),this.name="Viewer2d",this.loadedModels=[],this.masterModelId="",this.activeLayoutName="",this.layoutInfos={},this.units=void 0,this.enableHideVisuallySmallObjects=!0,this.sortedHidableObjects={},this.lastCameraZoom=1/0,this.loadingDxfCount=0,e.enableLayoutBar&&(this.dxfLayoutBar=new cD(this)),this.cameraManager.setProjection("Orthographic"),this.cameraManager.setNavigationMode(2);let t=new F(0,0,100),r=new F(0,0,0);this.cameraManager.setCameraConfig({eye:t,look:r}),this.resize(),this.setupDefaultEvents(),this.setDefaultBackground(),this.addEventListener("beforerender",(()=>{this.updateRaycasterThreshold(),this.updateCameraZoomUniform(this.camera.zoom),this.updateHidableObjectsVisibility()}))}get camera(){return this.cameraManager.camera}setupDefaultEvents(){let e=!1,t=!1;this.inputManager.addEventListener("pointerdown",(r=>{var i;t=!1,e=!0,1===r.button&&(null==(i=this.inputManager)||i.setCursor("move"))})),this.inputManager.addEventListener("pointermove",(()=>{var r;e&&(t=!0,null==(r=this.inputManager)||r.setCursor("move"))})),this.inputManager.addEventListener("pointerup",(r=>{var i;if(e=!1,null==(i=this.inputManager)||i.setCursor("default"),t)return void(t=!1);this.handleMouseClick(r);let n={event:r};if(this.selectedObject&&this.selectedObject instanceof ns&&(n.markupData=this.selectedObject.getData()),this.selectedObject&&this.selectedObject instanceof Jn&&(n.measureData=this.selectedObject.getData()),this.selectedObject&&this.selectedObject instanceof yr){let e=t=>!t.userData.modelId&&t.parent?e(t.parent):t.userData.modelId;n.entityData={modelId:e(this.selectedObject),layerName:this.selectedObject.userData.layerName}}this.dispatchEvent("mouseclick",n)}))}handleMouseClick(e){if(!this.enableSelection)return;let t=new Te(e.x,e.y),r=this.getWorldPositionByMousePick(t);if(!r)return;let i=this.overlayRender.getDrawablesByPosition(r)[0];if(i)return this.selectedObject===i?(this.selectedObject.selected=!1,this.selectedObject=void 0):(this.selectedObject&&this.clearSelection(),this.selectedObject=i,this.selectedObject.selected=!0),void this.enableRender();let n=this.pickObject(t,[12]);if(n)return this.selectedObject===(null==n?void 0:n.object)?(this.setObjectUnHighlight(this.selectedObject),this.selectedObject=void 0):(this.selectedObject&&this.clearSelection(),this.selectedObject=null==n?void 0:n.object,this.setObjectHighlight(this.selectedObject)),void this.enableRender();this.clearSelection(),this.enableRender()}setDefaultBackground(){this.setBackgroundColor(.0295,.0212,.0152)}loadModel(e,t){return bt(this,null,(function*(){var r,i;let n=this.getUniqueModelId(e.modelId||e.src);this.spinner.increaseJobCount(),this.loaderHelper.setFont(this.fontManager),this.masterModelId||(this.masterModelId=n);let a=n,s=xn("ProgressBar.Loading"),o=e=>{var r;null==(r=this.progressBar)||r.updateProgress(a,s,e),t&&t(new ProgressEvent("LoadProgress",{loaded:e,total:100}))},l=(e,r,i)=>{var n;let o=100*e.loaded/e.total;o=o*(i-r)/100+r,null==(n=this.progressBar)||n.updateProgress(a,s,o),t&&t(new ProgressEvent("LoadProgress",{loaded:o,total:100}))};null==(r=this.progressBar)||r.addProgressItem(a),o(0);let h=this.viewerCfg,c=yield this.loaderHelper.loadDxfData(e.src,e.modelId,(e=>l(e,0,90)),void 0,{ignorePaperSpace:e.ignorePaperSpace,enableLocalCache:h.enableLocalCache,enableMerge:e.merge,encoding:e.encoding,overrideColor:e.overrideColor}).finally((()=>{this.loadingDxfCount--,0===this.loadingDxfCount&&this.fontManager&&this.fontManager.releaseFontData()})),u=c.threejsObject;if(e.matrix&&16===e.matrix.length){let t=new lt;t.elements=e.matrix,u.applyMatrix4(t)}let d=new Lc({modelId:n,dxfData:c});this.addModel(d),this.spinner.decreaseJobCount(),o(100),null==(i=this.progressBar)||i.delayRemoveProgressItem(a),this.dispatchEvent("modelload")}))}addModel(e){super.addModel(e);let t=e.modelId;if(e.dxfData){this.masterModelId===t?this.activateLayout(Qr.MODEL_LAYOUT_NAME):this.handleOverlayDxf(t);let r=e.getBBox(),i=new F;r.getCenter(i),this.cameraManager.adjustCameraByBBox(r);let n=this.getDxfUnits(e);this.masterModelId===t&&(this.units=n)}else{let t=e.getModelObject();this.activeLayoutName=Qr.MODEL_LAYOUT_NAME;let r=(new Vt).setFromObject(t);this.layoutInfos[this.activeLayoutName]={homeViewExtent:r,extent:r},t.matrixAutoUpdate=!1,this.scene.add(t);let i=r.max.z;i>this.camera.position.z&&(this.camera.position.z=i,this.camera.updateProjectionMatrix()),this.flyToObject(t)}this.updateGroundPlane()}getDxfUnits(e){return!e&&this.loadedModels.length>0&&(e=this.loadedModels.find((e=>this.masterModelId===e.modelId))),e?e.getUnits():"Unitless"}handleOverlayDxf(e){let t=this.loadedModels.find((t=>e===t.modelId));if(!t)return void de.warn(`[Viewer] Can't find model for modelId '${e}'!`);t.switchTransformMs(Qr.MODEL_LAYOUT_NAME);let r=t.getLayoutLevelObject(Qr.MODEL_LAYOUT_NAME);r&&r.traverse((e=>{t.addSpatialFilterSection(e,t.dxfData)})),t.showLayoutObjects(Qr.MODEL_LAYOUT_NAME)}setObjectHighlight(e){this.loadedModels.forEach((t=>t.highlightObject(e))),this.enableRender()}setObjectUnHighlight(e){this.loadedModels.forEach((t=>t.unHighlightObject(e))),this.enableRender()}clearHighlight(){this.loadedModels.forEach((e=>e.clearHighlight())),this.enableRender()}clearSelection(){this.selectedObject instanceof yr&&this.setObjectUnHighlight(this.selectedObject),this.selectedObject instanceof Ki&&(this.selectedObject.selected=!1),this.selectedObject=void 0}get enableSelection(){return this._enableSelection}set enableSelection(e){e||this.clearSelection(),this._enableSelection=e}updateGroundPlane(){let e=this.getActiveLayoutInfo();if(!e.homeViewExtent)return;let t=e.homeViewExtent.clone(),r=[],i=(e,t,i)=>{r.push(new F(e,t,i))},n=t.getSize(new F),a=t.getCenter(new F);if(i(-n.x/2,-n.y/2,0),i(n.x/2,-n.y/2,0),i(n.x/2,n.y/2,0),i(-n.x/2,n.y/2,0),this.groundPlane)this.groundPlane.position.set(a.x,a.y,-n.z),this.groundPlane.geometry.setFromPoints(r),this.groundPlane.geometry.computeBoundingSphere(),this.groundPlane.geometry.computeBoundingBox();else{let e=new Nt;e.setFromPoints(r),e.setIndex([0,3,2,0,2,1]);let t=new Mr({color:"#888",side:ln});this.groundPlane=new Ht(e,t),this.groundPlane.visible=!1,this.groundPlane.position.set(a.x,a.y,-n.z),this.groundPlane.scale.set(1e5,1e5,1),this.groundPlane.name="groundPlane",this.groundPlane.renderOrder=DPt,this.groundPlane.layers.enableAll(),pn.disableLayerChannels(this.groundPlane,[12]),this.scene.add(this.groundPlane)}this.groundPlane.updateMatrix(),this.groundPlane.updateMatrixWorld(!0)}getRaycastableObjects(){var e,t,r;let i=[],n=Date.now();if(this.activeLayoutName===Qr.MODEL_LAYOUT_NAME){if(this.raycastableObjects)return this.raycastableObjects;if(null!=(e=this.renderer)&&e.renderLists){let e=null==(t=this.renderer)?void 0:t.renderLists.get(this.scene,0);e&&(e.opaque.forEach((e=>{e.object&&e.object.geometry&&i.push(e.object)})),e.transparent.forEach((e=>{e.object&&e.object.geometry&&i.push(e.object)})))}zMe.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),GMe.setFromProjectionMatrix(zMe);for(let e of this.loadedModels){let t=e.getModelObject().children.find((e=>e.name===this.activeLayoutName));if(t){let e=t.children.find((e=>e.name===Qr.SNAP_GROUP_NAME));null==e||e.traverse((e=>{if(pn.isLeafObject(e)){if(Pq.makeEmpty(),Pq.expandByObject(e),!GMe.intersectsBox(Pq))return;i.push(e)}}))}}this.groundPlane&&i.push(this.groundPlane),de.debug("[Viewer] getRaycastableObjectsByMouse() from modelSpace"),this.raycastableObjects=i}else{let e=new WeakSet,t=this.getLayoutByName(this.activeLayoutName);if(t){let r=t.directAssociatedLeafObjectSet;r&&r.forEach((t=>{t.visible&&!e.has(t)&&(i.push(t),e.add(t))}))}let n=this.getViewportByPoint(this.pickManager.getRaycaster().ray.origin);n&&n.associatedLeafObjectSet?(null==(r=n.associatedLeafObjectSet)||r.forEach((t=>{!e.has(t)&&(t.visible||t.userData.isSnapObject)&&(i.push(t),e.add(t))})),de.debug("[Viewer] getRaycastableObjectsByMouse() from inside of viewport:",n.viewportId)):de.debug("[Viewer] getRaycastableObjectsByMouse() from out of viewport"),this.groundPlane&&i.push(this.groundPlane)}return de.debug(`[Viewer] getRaycastableObjectsByMouse() costs ${(Date.now()-n)/1e3} s`),i}getViewportByPoint(e){if(0===this.activeLayoutName.length||this.activeLayoutName===Qr.MODEL_LAYOUT_NAME)return;let t=this.getLayoutByName(this.activeLayoutName);if(!t)return;let r=t=>e.x<t.min.x||e.x>t.max.x||e.y<t.min.y||e.y>t.max.y,i=this.loadedModels.find((e=>this.masterModelId===e.modelId));if(!i)return;let n=i.getFilteredViewports(t);for(let e=0,t=n.length;e<t;e++){let t=n[e];if(!r(t.psBBox))return t}}getWorldPositionByMousePick(e){var t;let r=[];return this.groundPlane&&r.push(this.groundPlane),null==(t=this.pickManager.pickObject(e,r))?void 0:t.point}activateLayout(e=Qr.MODEL_LAYOUT_NAME){if(this.activeLayoutName===e||!this.masterModelId)return;let t=this.loadedModels.find((e=>this.masterModelId===e.modelId));if(!t)return;let r=t.getLayoutByName(e);if(!r)return;let i=this.getActiveLayoutInfo();if(this.groundPlane){let e=this.getCurrentViewExtent(),t=this.camera.position.z;i.lastViewExtent=new Vt(new F(e.min.x,e.min.y,0),new F(e.max.x,e.max.y,t))}let n=(e=>{let t=this.layoutInfos[e];return!(null==t||!t.lastViewExtent)})(e);null==t||t.activateLayout(e,n),this.activeLayoutName=e;let a=t.getFilteredViewports(r);if(de.debug("[Viewer] Active layout:",e,", viewports:",a),!n){let e=this.camera.position.z,t=0;a.forEach((e=>{var r;let i=null==(r=null==e?void 0:e.msToPsMatrix)?void 0:r.elements[14];i&&i>t&&(t=i)}));let r=this.cameraManager.getPosition();if(t>r.z+e){let i=Math.ceil(t+e);r.z=i,de.info(`[Viewer] Changing camera's z value from ${r.z} to ${i}`),this.cameraManager.setCameraPosition(r)}}let s=this.getActiveLayoutInfo();if(s.lastViewExtent)this.zoomToBBox(s.lastViewExtent);else{s.extent=this.getBBox();let e=this.getLayoutExtentEx(r);if(e){let t=e.max.x-e.min.x,r=e.max.y-e.min.y;(t<1e-16||r<1e-16||t>1e16||r>1e16)&&(de.warn(`[Viewer] Got wired bbox, max: ${e.max.toArray()}, min: ${e.min.toArray()}, going to use the calculated one...`),e=s.extent)}else de.warn("[Viewer] Failed to get layout extent, going to use the calculated one..."),e=s.extent;s.homeViewExtent=e,this.zoomToBBox(e)}let o=t.getLayoutLevelObject(e);o&&this.setLayoutHidableObjectArray(o),this.enableRender()}getLayoutExtentEx(e){let t=this.loadedModels.find((e=>this.masterModelId===e.modelId));if(t)return e.layoutName===Qr.MODEL_LAYOUT_NAME?t.getModelSpaceExtent():t.getLayoutExtent(e)}getActiveLayoutInfo(){return this.getLayoutInfo(this.activeLayoutName)}getLayoutByName(e){let t,r=this.loadedModels.find((e=>this.masterModelId===e.modelId));if(!r)return;let i=r.getLayouts();for(let r of i)if(r.layoutName===e){t=r;break}return t}getEntityCount(){let e=0;return this.loadedModels.forEach((t=>{e+=t.loadedEntityCount})),e}getLayoutNames(){let e=[],t=this.loadedModels.find((e=>this.masterModelId===e.modelId));return((null==t?void 0:t.getLayouts())||[]).forEach((t=>{e.push(t.layoutName)})),e}getLayoutInfo(e){return this.layoutInfos[e]||(this.layoutInfos[e]={}),this.layoutInfos[e]}goToHomeView(){let e=this.getActiveLayoutInfo();e.homeViewExtent?this.zoomToBBox(e.homeViewExtent):de.error(`[Viewer] Failed to find extent for ${this.activeLayoutName}`)}zoomToBBox(e){let t=e.getCenter(pD),r=e.max.x-e.min.x,i=e.max.y-e.min.y,n=this.camera.right-this.camera.left,a=this.camera.top-this.camera.bottom,s=Math.min(n/r,a/i);s/=1.1,this.cameraManager.cameraControls.moveTo(t.x,t.y,t.z),this.cameraManager.cameraControls.zoomTo(s)}getCurrentViewExtent(){let e=this.getHitResultByNdcCoordinate(new Te(-1,-1)),t=this.getHitResultByNdcCoordinate(new Te(1,1));return new ts(e,t)}getHitResultByNdcCoordinate(e){let t=[];this.groundPlane&&t.push(this.groundPlane);let r=this.pickManager.pickObjectsByNdc(e,t);if(r.length>0){let e=r[0].point;return new Te(e.x,e.y)}}getHitResult(e){let t=this.viewerContainer,r=Nr.getScreenCoordinateByEvent(e,t),i=Nr.screen2Ndc(r,this.camera,t);return this.getHitResultByNdcCoordinate(i)}getActiveLayoutName(){return this.activeLayoutName}zoomIn(e=.01){this.cameraManager.cameraControls.zoom(e)}zoomOut(e=.01){this.cameraManager.cameraControls.zoom(-e)}getLayers(){let e=[];if(this.masterModelId){let t=this.loadedModels.find((e=>this.masterModelId===e.modelId)),r=null==t?void 0:t.layers;r&&e.push({modelId:this.masterModelId,layers:r})}for(let t of this.loadedModels){let r=t.modelId;if(r===this.masterModelId)continue;let i=t.layers;i&&e.push({modelId:r,layers:i})}return e}setModelVisibility(e,t){let r=this.loadedModels.find((t=>e===t.modelId));if(!r)throw new Error(`Failed to find model by modelId '${e}'!`);r.setVisible(t),this.enableRender()}setLayerVisibility(e,t,r){let i=this.camera;r=r||this.masterModelId;let n=this.loadedModels.find((e=>r===e.modelId));if(!n)throw new Error(`Failed to find layer by modelId '${r}'!`);n.setLayerVisible(e,t,this.enableHideVisuallySmallObjects,i.zoom),this.raycastableObjects=void 0,this.enableRender()}setLayerOpacity(e,t,r){r=r||this.masterModelId;let i=this.loadedModels.find((e=>r===e.modelId));if(!i)throw new Error(`Failed to find layer by modelId '${r}'!`);i.setLayerOpacity(e,t),this.enableRender()}setLayerColor(e,t,r){r=r||this.masterModelId;let i=this.loadedModels.find((e=>r===e.modelId));if(!i)throw new Error(`Failed to find layer by modelId '${r}'!`);this.clearSelection(),i.setLayerColor(e,t),this.enableRender()}resetLayerColor(e,t){t=t||this.masterModelId;let r=this.loadedModels.find((e=>t===e.modelId));if(!r)throw new Error(`Failed to find model by modelId '${t}'!`);this.clearSelection(),r.resetLayerColor(e),this.enableRender()}getVisiblePixelSize(e){let t=6.5*Tr.smoothstep(e,1e4,3e4)+.5;return de.debug("[Viewer] visiblePixelSize:",t),t}setLayoutHidableObjectArray(e){let t=this.camera;if(!this.enableHideVisuallySmallObjects||!t)return;let r=Date.now(),i=e.name;this.sortedHidableObjects[i]||(this.sortedHidableObjects[i]=[]);let n=this.sortedHidableObjects[i];this.cameraManager.update(0);let a=t.zoom;this.lastCameraZoom=a;let s=1;e.traverse((e=>{if(e.userData.isSnapObject||!pn.isLeafObject(e))return;let t=e.geometry;t.boundingBox||t.computeBoundingBox();let r=t.boundingBox.clone();if(!r||!Ut.isBoxValid(r))return;r.applyMatrix4(e.matrixWorld),r.getSize(pD);let i=Math.max(pD.x,pD.y),a=s/i;a<1/0?n.push({visibleMinZoom:a,object:e}):e instanceof Di?n.push({visibleMinZoom:s,object:e}):de.warn("[Viewer] The size of bbox is 0 ! ",e)})),s=this.getVisiblePixelSize(n.length);let o=0;n.forEach((e=>{let t=e.visibleMinZoom*s;e.visibleMinZoom=t,e.object.userData.visibleMinZoom=t,t>a&&(e.object.visible=!1,o++)})),n.sort(((e,t)=>e.visibleMinZoom-t.visibleMinZoom)),de.debug(`[Viewer] setLayoutHidableObjectArray cost: ${(Date.now()-r)/1e3}s,             ${o} objects changed to hidden`)}updateRaycasterThreshold(){let e=3*this.getPixelSizeInWorldCoord(),t=this.getRaycaster().params;t.Line?t.Line.threshold=e:t.Line={threshold:e},t.Points?t.Points.threshold=e:t.Points={threshold:e}}updateHidableObjectsVisibility(){let e=this.camera,t=Date.now();this.cameraManager.update(0);let r=e.zoom;if(Math.abs(r-this.lastCameraZoom)<1e-5||(this.updateRaycasterThreshold(),this.updateCameraZoomUniform(r),this.raycastableObjects=void 0,!this.sortedHidableObjects[this.activeLayoutName]))return;let i=this.sortedHidableObjects[this.activeLayoutName];if(0===i.length)return;let n=r>this.lastCameraZoom,a=Math.min(r,this.lastCameraZoom),s=Math.max(r,this.lastCameraZoom),o=[],l=0;for(let e=0;e<i.length;++e)if(!1!==i[e].object.userData.layerVisible){if(i[e].visibleMinZoom<a){o.push(i[e].object);continue}if(i[e].visibleMinZoom>s)break;i[e].object.visible=n,n&&o.push(i[e].object),l++}this.lastCameraZoom=r,de.debug(`[Viewer] updateHidableObjectsVisibility cost: ${(Date.now()-t)/1e3}s,             ${l}(out of ${i.length}) objects changed to ${n?"visible":"hidden"}`)}updateCameraZoomUniform(e){Qr.CameraZoomUniform.value=e*this.container.height/50}},mD=ra(_m(),1);Bh.install({THREE:Kt});var Gb=class extends Bh{constructor(e,t){super(e,t),this.minZoom=0,this.draggingSmoothTime=0,this.keyTruckSpeed=7,this.keys={left:"ArrowLeft",up:"ArrowUp",right:"ArrowRight",bottom:"ArrowDown"},this.onKeyDown=e=>{if(this.enabled){switch(e.code){case this.keys.up:e.ctrlKey||e.metaKey||e.shiftKey?(this._rotateInternal(0,1),this._isUserControllingRotate=!0):(this._truckInternal(0,this.keyTruckSpeed,!1),this._isUserControllingTruck=!0);break;case this.keys.bottom:e.ctrlKey||e.metaKey||e.shiftKey?(this._rotateInternal(0,-1),this._isUserControllingRotate=!0):(this._truckInternal(0,-this.keyTruckSpeed,!1),this._isUserControllingTruck=!0);break;case this.keys.left:e.ctrlKey||e.metaKey||e.shiftKey?(this._rotateInternal(1,0),this._isUserControllingRotate=!0):(this._truckInternal(this.keyTruckSpeed,0,!1),this._isUserControllingTruck=!0);break;case this.keys.right:e.ctrlKey||e.metaKey||e.shiftKey?(this._rotateInternal(-1,0),this._isUserControllingRotate=!0):(this._truckInternal(-this.keyTruckSpeed,0,!1),this._isUserControllingTruck=!0)}this.dispatchEvent({type:"control"})}},this.onKeyUp=e=>{this.dispatchEvent({type:"controlend"})},this._getClientRect(this._elementRect),this.dollySpeedBackup=this.dollySpeed,this.azimuthRotateSpeedBackup=this.azimuthRotateSpeed,this.polarRotateSpeedBackup=this.polarRotateSpeed,this.truckSpeedBackup=this.truckSpeed}get enableZoom(){return!!this.dollySpeed}set enableZoom(e){e?this.dollySpeed=this.dollySpeedBackup:(this.dollySpeedBackup=this.dollySpeed,this.dollySpeed=0)}get enableRotate(){return!!this.azimuthRotateSpeed||!!this.polarRotateSpeed}set enableRotate(e){e?(this.azimuthRotateSpeed=this.azimuthRotateSpeedBackup,this.polarRotateSpeed=this.polarRotateSpeedBackup):(this.azimuthRotateSpeedBackup=this.azimuthRotateSpeed,this.polarRotateSpeedBackup=this.polarRotateSpeed,this.azimuthRotateSpeed=0,this.polarRotateSpeed=0)}get enableTruck(){return!!this.truckSpeed}set enableTruck(e){e?this.truckSpeed=this.truckSpeedBackup:(this.truckSpeedBackup=this.truckSpeed,this.truckSpeed=0)}listenToKeyEvents(){var e,t;null==(e=this._domElement)||e.addEventListener("keydown",this.onKeyDown),null==(t=this._domElement)||t.addEventListener("keyup",this.onKeyUp)}stopListenToKeyEvents(){var e,t;null==(e=this._domElement)||e.removeEventListener("keydown",this.onKeyDown),null==(t=this._domElement)||t.removeEventListener("keyup",this.onKeyUp)}dispose(){super.dispose(),this.stopListenToKeyEvents()}},LPt=(e=>(e[e.Browser=0]="Browser",e[e.Browserless=1]="Browserless",e[e.Headless=2]="Headless",e))(LPt||{}),qMe=class{constructor(e,t,r){if(this.scene=this.initScene(),this.selectedObject=void 0,this.loadedModels=[],this.clock=new mc,this.viewerMode=0,this.raycaster=new vu,this.savedMaterialsForOpacity=[],this.jobCount=0,this.bbox=new Vt,this.outlineMaterial=new Yr({color:1118481}),this.outlineRoot=new Xr,this.transparentObjectIds=[],this.applyOptionsAndAddToScene=(e,t,r,i)=>bt(this,null,(function*(){if(de.info(`[Viewer] '${e}' is loaded, adding to scene...`),r.matrix&&16===r.matrix.length){let e=new lt;e.elements=r.matrix,t.applyMatrix4(e)}let n;t.traverse((e=>{e.geometry&&e.layers.enableAll(),e instanceof fc&&(e.visible=!1)})),r.edges&&(n=yield pn.createOutlines(t,void 0,i));let a=r.modelId||r.src,s=e=>!!this.loadedModels.find((t=>t.modelId===e));if(s(a)){let e=1;for(;s(`${a}_${e}`);)e++;a=`${a}_${e}`,de.warn(`[Viewer] Model '${a}' is loaded more than once!`)}let o={modelId:a,object:t,edges:n};this.addModel(o)})),this.getMeshes=e=>{let t=[];return e instanceof Ht?t.push(e):e.traverseVisible((e=>{e instanceof Ht&&t.push(e)})),t},this.containerOrCanvas=e,t&&(this.viewerMode=t),this.glContext=r,1===this.viewerMode&&(e instanceof HTMLDivElement||!r))throw new Error("[Viewer] Parameters don't match Browserless viewerMode !");this.increaseJobCount(),this.init(),this.decreaseJobCount(),de.info("[Viewer] Initialized"),this.animate()}init(){this.initRenderer(),this.initCamera(),this.initControls(),this.initLights(),this.initPointerEvents(),this.scene.add(this.outlineRoot)}initScene(){let e=new Xi;return e.background=new dt(7112861),e.matrixAutoUpdate=!0,e}isBrowserlessMode(){return 1===this.viewerMode}isBrowserMode(){return 0===this.viewerMode}initRenderer(){let e={antialias:!0,preserveDrawingBuffer:!0},t=this.isBrowserlessMode();t&&Object.assign(e,{canvas:this.containerOrCanvas,context:this.glContext});let r=new Ka(e);if(t){let e=this.containerOrCanvas.width,t=this.containerOrCanvas.height;de.info(`[Viewer] Render target size: ${e} x ${t}`),this.renderTarget=new yn(e,t,{minFilter:wn,magFilter:ni,format:gs,type:wl}),r.setRenderTarget(this.renderTarget)}else{let e=this.containerOrCanvas.clientWidth,t=this.containerOrCanvas.clientHeight;this.containerOrCanvas.append(r.domElement),r.setPixelRatio(window.devicePixelRatio),r.setSize(e,t)}r.outputColorSpace=Zr,r.toneMappingExposure=1,r.setClearColor(11119017,1),r.shadowMap.enabled=!0,r.shadowMap.type=a1,this.renderer=r,t||(this.pmremGenerator=new Wd(r),this.pmremGenerator.compileEquirectangularShader(),this.setEnvironmentFromDataArray())}initCamera(){if(!this.scene)return;let e=this.containerOrCanvas.clientWidth||this.containerOrCanvas.width||0,t=this.containerOrCanvas.clientHeight||this.containerOrCanvas.height||0,r=1;e&&t&&(r=e/t),this.camera=new ci(68,r,.05,1e4),this.camera.position.set(10,10,10),this.camera.lookAt(0,0,0),this.scene.add(this.camera)}initControls(){if(!this.renderer)return;let e=this.camera;if(!e)return;let t=new Gb(e,this.renderer.domElement);t.smoothTime=.05,t.enabled=!0,t.keyTruckSpeed=10,t.keys={left:"KeyD",up:"KeyE",right:"KeyA",bottom:"KeyQ"},t.update(0),this.controls=t,t.addEventListener("update",(()=>{!this.isBrowserMode()&&this.renderer&&this.renderer.render(this.scene,e)}))}initLights(){if(!this.scene)return;let e=16777215,t=new ya(e,.3);t.position.set(-2,2,4);let r=new $o(3158064),i=new Mh(e,14540253,3);i.position.set(0,300,0),this.scene.add(t),this.scene.add(r),this.scene.add(i)}initPointerEvents(){if(!this.renderer||!this.camera||!this.controls)return;let e=!1,t=!1,r=-1,i=-1;this.renderer.domElement.addEventListener("pointerdown",(t=>{r=t.x,i=t.y,e=!1})),this.renderer.domElement.addEventListener("pointermove",(t=>{r>=0&&i>=0&&(Math.abs(t.x-r)>5||Math.abs(t.y-i)>5)&&(e=!0)})),this.renderer.domElement.addEventListener("pointerup",(()=>{t&&setTimeout((()=>{t=!1}),200),r=-1,i=-1})),this.renderer.domElement.addEventListener("dblclick",(r=>{t=!0,e||(this.handleMouseClick(r),this.flyToSelectedObject())}))}animate(){var e;this.isBrowserMode()&&requestAnimationFrame(this.animate.bind(this));let t=this.clock.getDelta();this.controls&&this.controls.update(t),this.scene&&this.camera&&(null==(e=this.renderer)||e.render(this.scene,this.camera))}destroy(){this.camera=void 0,this.scene&&this.scene.clear(),this.requestAnimationFrameHandle&&(cancelAnimationFrame(this.requestAnimationFrameHandle),this.requestAnimationFrameHandle=void 0),this.renderer&&(this.containerOrCanvas.removeChild(this.renderer.domElement),this.renderer.clear(),this.renderer.dispose(),this.renderer=void 0),this.controls&&(this.controls.dispose(),this.controls=void 0),this.renderTarget&&(this.renderTarget.dispose(),this.renderTarget=void 0),this.raycaster=void 0,this.selectedObject=void 0,this.savedMaterialsForOpacity=void 0,this.loadedModels=[]}loadLocalModel(e,t,r){return bt(this,null,(function*(){let i=yield(new Lu).loadLocalModel(e,t.src,r);return i?(yield this.applyOptionsAndAddToScene(e,i,t),Promise.resolve()):Promise.reject()}))}loadModel(e,t){return bt(this,null,(function*(){this.increaseJobCount();let r=yield(new Lu).loadModel(e.src,e.fileFormat,t);return r?(yield this.applyOptionsAndAddToScene(e.src,r,e),Promise.resolve()):Promise.reject()}))}parseGltf(e,t,r,i){this.increaseJobCount(),(new Lu).parseGltf(e,t.src,(e=>{this.applyOptionsAndAddToScene(t.src,e,t),r&&r(e)}),(e=>{i&&i(e)}))}addModel(e){if(!this.scene||!this.renderer)return;this.increaseJobCount();let t=(new Vt).setFromObject(e.object);e.bbox||(e.bbox=t),this.scene.add(e.object),this.loadedModels.push(e),this.computeBoundingBox(),1===this.loadedModels.length&&(this.tryAdjustCameraNearAndFar(),this.goToHomeView()),this.renderer.shadowMap.needsUpdate=!0,de.info(`[Viewer] Added '${e.modelId}' to scene`),this.decreaseJobCount()}addOrRemoveObjectOpacity(e=!0,t=.3,r,i){if(this.savedMaterialsForOpacity||(this.savedMaterialsForOpacity=[]),!this.scene)return;let n=this.scene,a=[];this.loadedModels.forEach((s=>{let o=s.object.id;if(e){this.savedMaterialsForOpacity&&this.savedMaterialsForOpacity.length>0&&pn.revertObjectOpacityById(n,o,this.savedMaterialsForOpacity);let e=pn.setObjectOpacityById(n,o,t,r,i);a.push(...e)}else this.savedMaterialsForOpacity&&pn.revertObjectOpacityById(n,o,this.savedMaterialsForOpacity)})),this.savedMaterialsForOpacity=e?a:[]}hasTransparentObject(){return!!(this.savedMaterialsForOpacity&&this.savedMaterialsForOpacity.length>0)}getIntersections(e){if(!this.raycaster||!this.camera||!this.scene)return[];let t=new Te;e&&(t=Nr.getScreenCoordinateByEvent(e,this.containerOrCanvas));let r=Nr.screen2Ndc(t,this.camera,this.containerOrCanvas);this.raycaster.setFromCamera(r,this.camera);let i=[];return this.loadedModels.forEach((e=>{let t=e.object;t&&t.visible&&i.push(t)})),this.raycaster.intersectObjects(i,!0)||[]}handleMouseClick(e){this.raycaster&&this.raycaster.layers.set(12);let t=this.getIntersections(e).find((e=>{let t=e.object;return t.visible&&t instanceof Ht})),r=t&&t.object||void 0;r&&this.selectedObject&&this.selectedObject.id===r.id&&(r=void 0),r?this.selectObject(r):this.clearSelection()}selectObject(e){if(this.selectedObject){let e=this.selectedObject.userData;if(e.originalMaterial){if(this.selectedObject.material){let e=this.selectedObject.material;Array.isArray(e)?e.forEach((e=>e.dispose())):e instanceof qn&&e.dispose()}this.selectedObject.material=e.originalMaterial,delete e.originalMaterial}this.selectedObject=void 0}if(!this.scene||!e)return;let t=$i.clonedHighlightMaterials(e);t&&(this.selectedObject=e,this.selectedObject.userData.originalMaterial=this.selectedObject.material,this.selectedObject.material=t)}clearSelection(){this.selectObject()}flyToObjects(e){if(!e||0===e.length||!this.camera)return;let t=new Vt;e.forEach((e=>{let r=bc.getBoundingBox(e);t.union(r)}));let r=new Sn;t.getBoundingSphere(r),this.controls.fitToSphere(r,!0)}flyToObject(e){this.flyToObjects([e])}flyToSelectedObject(){this.selectedObject&&this.flyToObject(this.selectedObject)}flyTo(e,t,r){var i;let n=this.camera,a=this.controls;if(!n||!a)return;let s=e=Array.isArray(e)?new F(e[0],e[1],e[2]):e,o=t=Array.isArray(t)?new F(t[0],t[1],t[2]):t;de.info("[Viewer] flyTo: ",Ut.vectorToString(s)),a.setPosition(s.x,s.y,s.z),a.setTarget(o.x,o.y,o.z),this.isBrowserMode()||null==(i=this.renderer)||i.render(this.scene,n),r&&r()}goToHomeView(){let e=new Sn;this.bbox.getBoundingSphere(e),this.controls.fitToSphere(e,!0)}setEnvironmentFromDataArray(e){kp.createEnvTextureFromDataArray(this.pmremGenerator,e).then((e=>{this.scene.environment=e,this.isBrowserMode()||this.animate()}))}tryAdjustCameraNearAndFar(){let e=this.camera;if(!this.scene||!e)return;let t=this.bbox,r=e.near,i=e.far,n=t.max.x-t.min.x,a=t.max.y-t.min.y,s=t.max.z-t.min.z,o=Math.max(n,a,s),l=o/5,h=5*o;if(r>l||i<h){let t=e=>Ut.numberToString(e);de.info(`[Viewer] BBox's longest side is: ${t(o)}`),r>l&&(de.warn(`[Viewer] camera.near(${t(r)}) shouldn't bigger than ${t(l)}, will change it!`),e.near=l),i<h&&(de.warn(`[Viewer] camera.far(${t(i)}) shouldn't smaller than ${t(h)}, will change it!`),e.far=h)}e.updateProjectionMatrix()}isolateObjects(e){let t=this.transparentObjectIds.length>0?void 0:this.transparentObjectIds,r=this.transparentObjectIds.length>0?this.transparentObjectIds:void 0,i=new Mr({color:16777215,transparent:!0,opacity:.1});this.loadedModels.forEach((e=>{let n=e.object.id;pn.applyMaterialToObjectById(this.scene,n,i,r,t)})),this.outlineRoot.clear();let n=[];if(e.forEach((e=>{let t=e.modelId,r=this.loadedModels.find((e=>e.modelId===t)),i=null==r?void 0:r.object;i||(de.warn(`[Viewer] The ModelId of ${t} has no corresponding model.`),i=this.scene),i.traverse((t=>{if((0,mD.includes)(e.id,(0,mD.get)(t.userData,"UniqueId"))){let e=this.getMeshes(t);n=n.concat(e)}}))})),n.length>0){n.forEach((e=>{let t=pn.createOutline(e.geometry,this.outlineMaterial);t.applyMatrix4(e.matrixWorld),this.outlineRoot.add(t),t.updateWorldMatrix(!0,!1)}));let e=n.map((e=>e.id));this.loadedModels.forEach((t=>{let r=t.object.id;pn.revertAppliedMaterialToObjectById(this.scene,r,e)})),this.transparentObjectIds=e,this.flyToObjects(n)}else de.warn(`[Viewer] No object found with uniqueIds: ${e.map((e=>e.id))}`);this.isBrowserMode()||this.animate()}increaseJobCount(){++this.jobCount}decreaseJobCount(){--this.jobCount}computeBoundingBox(){let e=new Vt;return this.loadedModels.forEach((t=>{t.bbox&&!t.bbox.isEmpty()&&e.union(t.bbox)})),this.bbox=e,e}getContext(){var e;return null==(e=this.renderer)?void 0:e.getContext()}getCameraDirection(){var e;let t=new F;return null==(e=this.camera)||e.getWorldDirection(t),{x:t.x,y:t.y,z:t.z}}setFov(e){this.camera&&(this.camera.fov=e,this.camera.updateProjectionMatrix())}},jMe=new F,kPt=(e=>(e.StartDraw="StartDraw",e.EndDraw="EndDraw",e.EndEdit="EndEdit",e))(kPt||{}),Iq=class extends vn{constructor(e){super(e,{id:Iq.DEFAULT_ID}),this.drawableList=new Ol("markup"),this.lineWidth=2,this.lineColor=[1,0,0,1],this.fillColor=[1,0,0,.3],this.fontSize=20,this.mouseDown=!1,this.mouseDownPositionX=void 0,this.mouseDownPositionY=void 0,this.isSelectLeaderText=!1,this.isDrawing=!1,this.tempPoints=[],this.activated=!1,this.handleDbClick=()=>{},this.handleInputMousemove=e=>{if(!this.mouseDown&&"CloudRectWithTextMarkup"===this.type&&this.isDrawing&&this.creatingShape){let t=Nr.getScreenCoordinateByEvent(e,this.viewerCanvas);this.creatingShape.updateInputPosition(this.mousedownPoint,t),this.render()}},this.mousedown=e=>{var t;if(e.pointers&&e.pointers.length>1)return;let r=new Te(e.x,e.y),i=this.pickPositionByScreenPoint(r);if(i){if(i.z=0,this.mouseDownPositionX=i.x,this.mouseDownPositionY=i.y,this.mousedownPoint=new Te(e.x,e.y),0===e.button&&(this.mouseDown=!0),2===e.button)return void(this.isDrawing&&this.endDraw(this.creatingShape));if(this.selectedShape&&(this.selectedShape.selected=!1,this.selectedShape=void 0,this.render()),!this.isDrawing){let e=this.drawableList.getDrawableByPosition(i);e&&(this.selectedShape=e,e.selected=!0,e instanceof i0&&(this.isSelectLeaderText=e.isLeaderTextSelected(i)),this.render())}if(this.isCreateTextMode()&&this.mouseDown&&!this.selectedShape){this.creatingShape||(this.creatingShape=this.drawText(i,""));let t=this.creatingShape;0===t.text.length?(t.setTolerance(this.viewer.getPixelSizeInWorldCoord()),t.update([i]),t.addInput(this,e.x,e.y)):(t.exitEditing(),this.addMarkup(t,!1),this.endDraw(t)),this.render()}if(this.isCreateLineMode()&&this.mouseDown&&!this.selectedShape){if(this.tempPoints.length>0){let e=this.tempPoints[0];if(jMe.subVectors(e,i).length()<5*this.viewer.getPixelSizeInWorldCoord())return i=this.tempPoints[0].clone(),this.tempPoints.push(i),void this.endDraw(this.creatingShape)}if(this.isDrawing=!0,this.tempPoints.push(i),!this.creatingShape){let e=this.creatingShape=this.drawLine([...this.tempPoints,i]);e&&this.addMarkup(e,!1)}this.creatingShape&&(this.creatingShape.update([...this.tempPoints,i]),this.render()),this.dispatchEvent("StartDraw",this.creatingShape)}if(this.isCreateDotMode()&&this.mouseDown&&!this.selectedShape){if(!this.creatingShape){let e=this.creatingShape=this.drawShape(i);e&&this.addMarkup(e,!1)}this.isDrawing=!0,this.render()}null==(t=this.creatingShape)||t.setTolerance(this.viewer.getPixelSizeInWorldCoord())}},this.mousemove=e=>{if(e.pointers&&e.pointers.length>1)return;let t=new Te(e.x,e.y),r=this.pickPositionByScreenPoint(t);if(r)if(this.selectedShape){if(this.mouseDown&&void 0!==this.mouseDownPositionX&&void 0!==this.mouseDownPositionY){this.isEditing()||(this.initialDataForEditing=this.selectedShape.getData());let e=r.x-this.mouseDownPositionX,t=r.y-this.mouseDownPositionY;this.selectedShape instanceof i0&&this.isSelectLeaderText?this.selectedShape.translateLeaderText(e,t):this.selectedShape.translate(e,t),this.render(),this.mouseDownPositionX=r.x,this.mouseDownPositionY=r.y}}else{if(this.isCreateDotMode())return;if(this.mouseDown&&this.isCreateShapeMode()&&void 0!==this.mouseDownPositionX&&void 0!==this.mouseDownPositionY){let e=new F(this.mouseDownPositionX,this.mouseDownPositionY,0);if(!this.creatingShape){let t=this.creatingShape=this.drawShape(e,r);t&&this.addMarkup(t,!1)}this.creatingShape.update([e,r]),this.isDrawing=!0,this.render()}if(this.isCreateLineMode()&&this.tempPoints.length>0&&this.isDrawing){let e=this.tempPoints[0];jMe.subVectors(e,r).length()<5*this.viewer.getPixelSizeInWorldCoord()&&(r=this.tempPoints[0].clone()),this.creatingShape.update([...this.tempPoints,r]),this.render()}}},this.mouseup=e=>{if(this.mouseDown=!1,this.selectedShape&&this.isEditing()&&this.endEdit(this.selectedShape),this.isCreateShapeMode()&&this.isDrawing&&this.creatingShape)if("LeaderLineMarkup"===this.type){let t=this.creatingShape;t.isEditing?t.exitEditing():(t.setFontSize(this.fontSize*this.viewer.getPixelSizeInWorldCoord()),t.addInput(this,e.x,e.y)),t.addEventListener("exitediting",(()=>{this.isDrawing=!1,this.endDraw(this.creatingShape)}))}else if("CloudRectWithTextMarkup"===this.type){let t=this.creatingShape;t.setFontSize(this.fontSize*this.viewer.getPixelSizeInWorldCoord()),t.addInput(this,e.x,e.y),t.addEventListener("exitediting",(()=>{this.isDrawing=!1,this.endDraw(this.creatingShape)}))}else this.endDraw(this.creatingShape)},this.keydown=e=>{"Delete"===e.code?this.selectedShape&&(this.viewer.hasEventListener("beforeremovemarkup")?this.viewer.dispatchEvent("beforeremovemarkup",this.confirmToRemove.bind(this)):(this.removeMarkup(this.selectedShape),this.undoMgr.addCommand(new gT(this,this.selectedShape.getData())),this.selectedShape=void 0)):"Escape"===e.code&&this.cancelDraw(this.creatingShape)},this.viewer=e,this.inputManager=e.getInputManager(),this.overlayRender=this.viewer.getOverlayRender(),this.overlayRender.addDrawableList(this.drawableList)}get viewerCanvas(){return this.overlayRender.getCanvas()}get camera(){return this.viewer.camera}get raycaster(){return this.viewer.getRaycaster()}get undoMgr(){return this.viewer.getUndoManager()}setMarkupVisibility(e,t){let r=this.drawableList.getDrawables().get(e);return!!r&&(r.visible!==t&&(r.visible=t,this.render()),!0)}setMarkupsVisibility(e){let t=!1;this.drawableList.getDrawables().forEach((r=>{r.visible!==e&&(r.visible=e,t=!0)})),t&&this.render()}clear(){this.drawableList.clear(),this.isDrawing&&this.reset(),this.render()}isActive(){return this.activated}activate(){this.activated=!0,Pn.isMobile?(this.inputManager.addEventListener("touchstart",this.mousedown),this.inputManager.addEventListener("touchmove",this.mousemove),this.inputManager.addEventListener("touchend",this.mouseup)):(this.inputManager.addEventListener("mousedown",this.mousedown),this.inputManager.addEventListener("mousemove",this.mousemove),this.inputManager.addEventListener("mouseup",this.mouseup),this.inputManager.addEventListener("dblclick",this.handleDbClick)),this.inputManager.addEventListener("keydown",this.keydown),window.addEventListener("mousemove",this.handleInputMousemove),this.viewer.getCameraManager().enableMouseLeft(!1),this.viewer.getCameraManager().enableKeyControl(!1),this.render()}deactivate(){this.activated=!1,Pn.isMobile?(this.inputManager.removeEventListener("touchstart",this.mousedown),this.inputManager.removeEventListener("touchmove",this.mousemove),this.inputManager.removeEventListener("touchend",this.mouseup)):(this.inputManager.removeEventListener("mousedown",this.mousedown),this.inputManager.removeEventListener("mousemove",this.mousemove),this.inputManager.removeEventListener("mouseup",this.mouseup),this.inputManager.removeEventListener("dblclick",this.handleDbClick)),this.inputManager.removeEventListener("keydown",this.keydown),window.removeEventListener("mousemove",this.handleInputMousemove),this.viewer.getCameraManager().enableMouseLeft(!0),this.viewer.getCameraManager().enableKeyControl(!0),this.mouseDown=!1,this.tempPoints=[],this.isDrawing=!1,this.creatingShape=void 0,this.selectedShape&&(this.selectedShape.selected=!1,this.selectedShape=void 0),this.render()}getActiveMarkupType(){return this.type}setDrawType(e){this.type=e,this.reset()}setLineWidth(e){this.lineWidth=e}getLineWidth(){return this.lineWidth}setLineColor(e){this.lineColor=e}getLineColor(){return this.lineColor}setFillColor(e){this.fillColor=e}getFillColor(){return this.fillColor}setFontSize(e){this.fontSize=e}getFontSize(){return this.fontSize}pickPositionByScreenPoint(e){var t;return null==(t=this.viewer.pickObject(e))?void 0:t.point}confirmToRemove(e){this.selectedShape&&e&&(this.removeMarkup(this.selectedShape),this.undoMgr.addCommand(new gT(this,this.selectedShape.getData())),this.selectedShape=void 0)}isEditing(){return!!this.initialDataForEditing}endEdit(e){if(!this.initialDataForEditing)return;let t=e.getData();this.viewer.dispatchEvent("markupupdate",{oldData:this.initialDataForEditing,newData:t}),this.dispatchEvent("EndEdit",e),this.undoMgr.addCommand(new e3(this,this.initialDataForEditing,t)),this.initialDataForEditing=void 0,this.isSelectLeaderText=!1}endDraw(e){if("PolylineMarkup"===this.type&&this.creatingShape&&(this.tempPoints.length<2?(this.removeMarkup(this.creatingShape,!1),this.creatingShape=void 0):this.creatingShape.update(this.tempPoints)),e){let t=e.getData();this.viewer.dispatchEvent("markupadd",t),this.undoMgr.addCommand(new mT(this,t))}this.dispatchEvent("EndDraw",e),this.reset()}cancelDraw(e){e&&this.removeMarkup(e,!1),this.reset()}reset(){this.tempPoints=[],this.isDrawing=!1,this.creatingShape=void 0,this.mouseDownPositionX=void 0,this.mouseDownPositionY=void 0,this.mousedownPoint=void 0,this.isSelectLeaderText=!1,this.selectedShape&&(this.selectedShape.selected=!1,this.selectedShape=void 0),this.render()}render(){var e;null==(e=this.overlayRender)||e.render()}addMarkup(e,t=!0){this.drawableList.addDrawable(e),this.render(),t&&this.viewer.dispatchEvent("markupadd",e.getData())}updateMarkup(e,t,r=!0){this.drawableList.updateDrawable(e,t),this.render(),r&&this.viewer.dispatchEvent("markupupdate",{oldData:e.getData(),newData:t})}removeMarkup(e,t=!0){this.drawableList.removeDrawable(e),this.render(),t&&this.viewer.dispatchEvent("markupremove",e.getData())}removeMarkupById(e){let t=this.getMarkupById(e);return!!t&&(this.removeMarkup(t,!1),!0)}createMarkup(e){return Jr.createDrawable(e)}getMarkupById(e){return this.drawableList.getDrawableById(e)}getData(){return this.drawableList.getDrawableDatas()}setData(e){this.undoMgr.startTransaction(),e.forEach((e=>{this.addMarkup(this.createMarkup(e)),this.undoMgr.addCommand(new mT(this,e))})),this.undoMgr.endTransaction(),this.render()}isCreateLineMode(){return["PolylineMarkup","CloudLineMarkup"].includes(this.type)}isCreateDotMode(){return["DotMarkup"].includes(this.type)}isCreateTextMode(){return["TextMarkup"].includes(this.type)}isCreateShapeMode(){return["XMarkup","RectMarkup","CloudRectMarkup","CircleMarkup","EllipseMarkup","ArrowMarkup","LeaderLineMarkup","CloudRectWithTextMarkup","DotMarkup"].includes(this.type)}drawShape(e,t){let r=[[e.x,e.y]];return t&&r.push([t.x,t.y]),Jr.createDrawable({id:Ut.guid(),lineWidth:this.lineWidth,lineColor:this.lineColor,fillColor:this.fillColor,type:this.type,points:r})}drawLine(e){return Jr.createDrawable({id:Ut.guid(),lineWidth:this.lineWidth,lineColor:this.lineColor,fillColor:this.fillColor,type:this.type,points:e.map((e=>[e.x,e.y]))})}drawText(e,t){return Jr.createDrawable({id:Ut.guid(),lineWidth:this.lineWidth,lineColor:this.lineColor,fillColor:this.fillColor,fontSize:this.fontSize*this.viewer.getPixelSizeInWorldCoord(),type:this.type,text:t,points:[[e.x,e.y]]})}destroy(){this.deactivate(),this.clear()}},If=Iq;If.DEFAULT_ID="MarkupPlugin";var WMe=new F,U0=class extends Ki{constructor(e,t){super(e),this.lineSegments=[],this.boxes=t,this.lineColor=[1,0,0,1],this.lineWidth=2,this.calculateCloudLineSegments(t)}calculateCloudLineSegments(e){var t;for(let r=0;r<e.length;r++){let i=e[r],n=[new F(i.min.x,i.min.y),new F(i.max.x,i.min.y),new F(i.max.x,i.max.y),new F(i.min.x,i.max.y),new F(i.min.x,i.min.y)],a=WMe.subVectors(n[0],n[2]).length()/10||1e-4,s=[];for(let e=0;e<n.length-1;e++){let t=n[e],r=n[e+1],i=WMe.subVectors(r,t),o=i.length(),l=i.normalize(),h=Math.ceil(o/a);for(let e=0;e<h;e++)s.push(t.clone().add(l.clone().multiplyScalar(a*e)))}s.push(s[0]),null==(t=this.lineSegments)||t.push(s)}}draw(e,t){e.save(),e.lineWidth=this.lineWidth,e.strokeStyle=Br.rgba2Color(this.lineColor),e.fillStyle=Br.rgba2Color(this.fillColor);for(let r=0;r<this.lineSegments.length;r++){let i=this.lineSegments[r];this.drawBox(e,t,i)}}drawBox(e,t,r){e.beginPath();for(let i=0;i<r.length-1;i++){let n=this.transToScreenCoord(r[i],t),a=this.transToScreenCoord(r[i+1],t),s=Eu.getControlPointByTwoPoints(a,n);0===i&&e.moveTo(n.x,n.y),e.quadraticCurveTo(s.x,s.y,a.x,a.y)}e.stroke()}drawSelect(e,t){throw new Error("Method not implemented.")}isPointInPath(e){return!1}getBounds(){let e=new Vt;for(let t=0;t<this.boxes.length;t++){let r=this.boxes[t];e.union(r)}return e}getClassType(){return"CompareDrawable"}};Jr._registerDrawableClass(U0);var XMe=class extends ba{constructor(e){var t;super(),this.drawableList=new Ol("compare"),this.viewer=e,this.overlayRender=this.viewer.getOverlayRender(),null==(t=this.overlayRender)||t.addDrawableList(this.drawableList)}drawCompareDrawable(e){let t=[],r=[],i=[];for(let n of Object.values(e)){let e=n.box;e&&("Added"===n.type?t.push(e):"Removed"===n.type?r.push(e):i.push(e))}let n=pr.mergeBBoxes(t),a=pr.mergeBBoxes(r),s=pr.mergeBBoxes(i);this.drawableList.addDrawable(new U0(Ut.guid(),n)),this.drawableList.addDrawable(new U0(Ut.guid(),a)),this.drawableList.addDrawable(new U0(Ut.guid(),s)),this.viewer.enableRender()}setCompareDrawableVisible(e){this.drawableList.getDrawables().forEach((t=>t.visible=e)),this.viewer.enableRender()}},gD=class{constructor(e){this.jobCount=0,this.viewer=new Em(e);let t=document.getElementById(e.containerId);this.container=(null==t?void 0:t.parentElement)||document.body;let r=new L1(e.containerId);this.loadingProgressBar=new k1(r);this.loader=new Qr(this.loadingManager,{ignorePaperSpace:!0}),this.initSpinner()}initSpinner(){let e=document.createElement("div");e.classList.add("x-spinner"),e.appendChild(document.createElement("span")),e.appendChild(document.createElement("span")),e.appendChild(document.createElement("span")),e.appendChild(document.createElement("span")),this.container.appendChild(e),this.spinner=e,this.setSpinnerVisibility(this.jobCount>0)}setFont(e){return bt(this,null,(function*(){let t=Date.now();this.fontManager||(this.fontManager=new kl),yield this.fontManager.loadFonts(e),de.info(`[DxfCompareHelper] Font file(s) load time in ${(Date.now()-t)/1e3}s`)}))}compare(e,t,r,i){return bt(this,null,(function*(){var n,a,s,o,l;let{src:h,modelId:c}=e,{src:u}=t;this.viewer.masterModelId=c||h;let d=Date.now();if(this.increaseJobCount(),!this.fontManager)return Promise.reject("[DxfCompareHelper] Should set font first!");this.loader.setFont(this.fontManager),yield this.fontManager.getFontFromIndexeddb();let p=h+u,f=a0.t("ProgressBar.Comparing"),m=e=>{var t;null==(t=this.loadingProgressBar)||t.updateProgress(p,f,e),i&&i(new ProgressEvent("CompareProgress",{loaded:e,total:100}))},g=(e,t,r)=>{var n;let a=100*e.loaded/e.total;a=a*(r-t)/100+t,null==(n=this.loadingProgressBar)||n.updateProgress(p,f,a),i&&i(new ProgressEvent("CompareProgress",{loaded:a,total:100}))};Ut.printMemory("Before comparing"),null==(n=this.loadingProgressBar)||n.addProgressItem(p),m(0);let v=Date.now(),y=yield this.loader.parse(h,(e=>g(e,0,15))),b=yield this.loader.parse(u,(e=>g(e,15,30))),[x,_]=yield Promise.allSettled([y,b]);if("rejected"===x.status)return Promise.reject(`[DxfCompareHelper] Failed to parse ${h}`);if("rejected"===_.status)return Promise.reject(`[DxfCompareHelper] Failed to parse ${u}`);if(de.info(`[DxfCompareHelper] loadFiles in ${(Date.now()-v)/1e3}s`),this.loader.isAborted())return Promise.reject("[DxfCompareHelper] compare loadFile aborted");let w=x.value,S=_.value;v=Date.now();let T=yield new Ea(w,S,r).compare((e=>g(e,30,60)));if(de.info(`[DxfCompareHelper] Compared in ${(Date.now()-v)/1e3}s`),de.debug("[DxfCompareHelper] Compared results:",T),this.loader.isAborted())return Promise.reject("[DxfCompareHelper] compare change aborted");Ut.printMemory("After getting the comparison results"),v=Date.now(),yield this.loader.loadEntitiesForCompare(w,S,T,!0,(e=>g(e,60,95))),Ut.printMemory("After Creating threejs objects based on comparison result"),null==(a=this.fontManager)||a.releaseFontData(),this.changes=T,de.info(`[DxfCompareHelper] Creates threejs objects based on comparison result in ${(Date.now()-v)/1e3}s`);let M=w,E=S;if(this.decreaseJobCount(),Object.keys(T).length||de.info("[DxfCompareHelper] No change found"),0===(null==(s=M.threejsObject)?void 0:s.children.length)&&0===(null==(o=E.threejsObject)?void 0:o.children.length)){let e=`[DxfCompareHelper] Nothing was loaded from ${h} and ${u}`;return de.warn(e),Promise.reject(e)}let A=M.threejsObject,C=E.threejsObject;return A.name=h,C.name=u,v=Date.now(),this.viewer.addModel(new Lc({modelId:e.modelId||e.src,dxfData:M})),this.viewer.flyToObject(A),Ut.printMemory("After adding first loaded Model to scene"),m(95),this.viewer.addModel(new Lc({modelId:t.modelId||t.src,dxfData:E})),Ut.printMemory("After adding second loaded Model to scene"),de.info(`[DxfCompareHelper] Added compared objects to scene in ${(Date.now()-v)/1e3}s`),de.info(`[DxfCompareHelper] The comparison between ${h}' and '${u}' is completed in ${(Date.now()-d)/1e3}s !`),m(100),null==(l=this.loadingProgressBar)||l.delayRemoveProgressItem(p),Promise.resolve()}))}getChanges(){return this.changes}zoomToChange(e){if(this.changes){let t=this.changes[e];if(!t)return;let r=t.box;r&&this.viewer.zoomToBBox(r.clone().expandByScalar(1.2))}}setSpinnerVisibility(e){this.spinner&&(e?this.spinner.classList.remove("hidden"):this.spinner.classList.add("hidden"))}increaseJobCount(){this.setSpinnerVisibility(++this.jobCount>0)}decreaseJobCount(){this.setSpinnerVisibility(--this.jobCount>0)}},YMe=class extends gD{constructor(e,t){super(e),this.syncCamera=!1,this.syncCameraControls=(e,t,r)=>{let i=new F,n=new F,a=new F;e.getPosition(n),e.getTarget(a),e.getFocalOffset(i),t.setLookAt(n.x,n.y,n.z,a.x,a.y,a.z),t.zoomTo(r),t.dispatchEvent({type:"control"})},this.viewer2=new Em(t),this.initSyncCameraEvent()}initSyncCameraEvent(){let e=this.viewer.getCameraManager().cameraControls,t=this.viewer2.getCameraManager().cameraControls,r=!1;e.addEventListener("control",(()=>{r=!1})),e.addEventListener("update",(()=>{!this.syncCamera||r||this.syncCameraControls(e,t,this.viewer.camera.zoom)})),t.addEventListener("control",(()=>{r=!0})),t.addEventListener("update",(()=>{!this.syncCamera||!r||this.syncCameraControls(t,e,this.viewer2.camera.zoom)}))}enableSyncCamera(e){if(this.syncCamera=e,e){let e=this.viewer.getCameraManager().cameraControls,t=this.viewer2.getCameraManager().cameraControls;this.syncCameraControls(e,t,this.viewer.camera.zoom)}}compare(e,t,r,i){return bt(this,null,(function*(){var n,a,s,o,l;let{src:h,modelId:c}=e,{src:u,modelId:d}=t;this.viewer.masterModelId=c||h,this.viewer2.masterModelId=d||u;let p=Date.now();if(this.increaseJobCount(),!this.fontManager)return Promise.reject("[DxfCompareHelper] Should set font first!");this.loader.setFont(this.fontManager),yield this.fontManager.getFontFromIndexeddb();let f=h+u,m=a0.t("ProgressBar.Comparing"),g=e=>{var t;null==(t=this.loadingProgressBar)||t.updateProgress(f,m,e),i&&i(new ProgressEvent("CompareProgress",{loaded:e,total:100}))},v=(e,t,r)=>{var n;let a=100*e.loaded/e.total;a=a*(r-t)/100+t,null==(n=this.loadingProgressBar)||n.updateProgress(f,m,a),i&&i(new ProgressEvent("CompareProgress",{loaded:a,total:100}))};Ut.printMemory("Before comparing"),null==(n=this.loadingProgressBar)||n.addProgressItem(f),g(0);let y=Date.now(),b=yield this.loader.parse(h,(e=>v(e,0,15))),x=yield this.loader.parse(u,(e=>v(e,15,30))),[_,w]=yield Promise.allSettled([b,x]);if("rejected"===_.status)return Promise.reject(`[DxfCompareHelper] Failed to parse ${h}`);if("rejected"===w.status)return Promise.reject(`[DxfCompareHelper] Failed to parse ${u}`);if(de.info(`[DxfCompareHelper] loadFiles in ${(Date.now()-y)/1e3}s`),this.loader.isAborted())return Promise.reject("[DxfCompareHelper] compare loadFile aborted");let S=_.value,T=w.value;y=Date.now();let M=yield new Ea(S,T,r).compare((e=>v(e,30,60)));if(de.info(`[DxfCompareHelper] Compared in ${(Date.now()-y)/1e3}s`),de.debug("Compared results:",M),this.loader.isAborted())return Promise.reject("[DxfCompareHelper] compare change aborted");Ut.printMemory("After getting the comparison results"),y=Date.now(),yield this.loader.loadEntitiesForCompare(S,T,M,!1,(e=>v(e,60,95))),Ut.printMemory("After Creating threejs objects based on comparison result"),null==(a=this.fontManager)||a.releaseFontData(),this.changes=M,de.info(`[DxfCompareHelper] Creates threejs objects based on comparison result in ${(Date.now()-y)/1e3}s`);let E=S,A=T;if(this.decreaseJobCount(),Object.keys(M).length||de.info("[DxfCompareHelper] No change found"),0===(null==(s=E.threejsObject)?void 0:s.children.length)&&0===(null==(o=A.threejsObject)?void 0:o.children.length)){let e=`[DxfCompareHelper] Nothing was loaded from ${h} and ${u}`;return de.warn(e),Promise.reject(e)}let C=E.threejsObject,P=A.threejsObject;return C.name=h,P.name=u,y=Date.now(),this.viewer.addModel(new Lc({modelId:e.modelId||e.src,dxfData:E})),Ut.printMemory("After adding first loaded Model to scene"),g(95),this.viewer2.addModel(new Lc({modelId:t.modelId||t.src,dxfData:A})),Ut.printMemory("After adding second loaded Model to scene"),de.info(`[DxfCompareHelper] Added compared objects to scene in ${(Date.now()-y)/1e3}s`),de.info(`[DxfCompareHelper] The comparison between ${h}' and '${u}' is completed in ${(Date.now()-p)/1e3}s !`),g(100),null==(l=this.loadingProgressBar)||l.delayRemoveProgressItem(f),Promise.resolve()}))}zoomToChange(e){if(this.changes){let t=this.changes[e];if(!t)return;let r=t.box;r&&(this.viewer.zoomToBBox(r.clone().expandByScalar(1.2)),this.viewer2.zoomToBBox(r.clone().expandByScalar(1.2)))}}},H0=ra($Me(),1),Of=class{constructor(e,t){this.current=e,this.next=t,this.inNormal=this.inwardsNormal(),this.outNormal=this.outwardsNormal()}outwardsNormal(){let e=this.inwardsNormal();return[-e[0],-e[1]]}inwardsNormal(){let e=this.next[0]-this.current[0],t=this.next[1]-this.current[1],r=Math.sqrt(e*e+t*t);if(0===r)throw new Error("Vertices overlap");return[-t/r,e/r]}offset(e,t){return Of.offsetEdge(this.current,this.next,e,t)}inverseOffset(e,t){return Of.offsetEdge(this.next,this.current,e,t)}inverse(){return new Of(this.next,this.current)}static offsetEdge(e,t,r,i){return new Of([e[0]+r,e[1]+i],[t[0]+r,t[1]+i])}},yS=Array.isArray,ZMe=(e,t)=>e[0]===t[0]&&e[1]===t[1],Lq=e=>Array.isArray(e)&&e.length,JMe=(e,t=0,r=!1)=>{let i,n;if(Lq(e)&&"number"==typeof e[0][0]){let t=0,a=e;for(i=0,n=a.length;i<n;i++){let e=a[i],r=a[(i+1)%n];t+=e[0]*r[1],t-=r[0]*e[1]}(!r&&t>0||r&&t<0)&&a.reverse()}else for(i=0,n=e.length;i<n;i++)JMe(e[i],t+1,i>0);if(0===t&&Lq(e)&&Lq(e[0])&&"number"==typeof e[0][0][0]){let t=e[0].slice(0,1)[0];e[0].pop(),e[0].push([t[0],t[1]])}return e},KMe=class{constructor(e,t=5){if(this.distance=0,this.arcSegments=t,!yS(e))throw new Error("Offset requires at least one coodinate to work with");this.edges=[],yS(e)&&"number"==typeof e[0]?this.vertices=e:(this.vertices=JMe(e),this.processContour(this.vertices,this.edges))}processContour(e,t){let r,i;if(yS(e[0])&&"number"==typeof e[0][0])for(i=e.length,ZMe(e[0],e[i-1])&&(i-=1),r=0;r<i;r++)t.push(new Of(e[r],e[(r+1)%i]));else for(r=0,i=e.length;r<i;r++)t.push([]),this.processContour(e[r],t[t.length-1])}setArcSegments(e){return this.arcSegments=e,this}createArc(e,t,r,i,n,a,s){let o=2*Math.PI,l=Math.atan2(i[1]-t[1],i[0]-t[0]),h=Math.atan2(n[1]-t[1],n[0]-t[0]);a%2==0&&(a-=1),l<0&&(l+=o),h<0&&(h+=o);let c=l>h?l-h:l+o-h,u=(s?-c:o-c)/a;e.push(i);for(let i=1;i<a;++i)c=l+u*i,e.push([t[0]+Math.cos(c)*r,t[1]+Math.sin(c)*r]);return e.push(n),e}setDistance(e){return this.distance=e,this}ensureLastPoint(e){return ZMe(e[0],e[e.length-1])||e.push([e[0][0],e[0][1]]),e}offset(e){return this.setDistance(e),0===this.distance?this.vertices:this.distance>0?this.margin(this.distance):this.padding(-this.distance)}offsetSegment(e,t,r,i){let n=[r.offset(r.inNormal[0]*i,r.inNormal[1]*i),r.inverseOffset(r.outNormal[0]*i,r.outNormal[1]*i)],a=[];for(let r=0,s=2;r<s;r++){let o=n[r],l=n[(r+s-1)%s];this.createArc(a,0===r?e:t,i,l.next,o.current,this.arcSegments,!0)}return a}margin(e){if(this.setDistance(e),"number"==typeof this.vertices[0])return this.offsetPoint(this.distance);if(0===e)return this.vertices;let t=this.offsetLines(this.distance);return t=(0,H0.union)(this.vertices,t),t}padding(e){if(this.setDistance(e),0===this.distance)return this.vertices;if(2===this.vertices.length&&"number"==typeof this.vertices[0])return this.vertices;let t=this.offsetLines(this.distance);return(0,H0.difference)(this.vertices,t)}offsetLine(e){return 0===e?this.vertices:this.offsetLines(e)}offsetLines(e){if(e<0)throw new Error("Cannot apply negative margin to the line");this.setDistance(e);let t=[];if(yS(this.vertices[0])&&"number"!=typeof this.vertices[0][0]){let e=[];for(let t=0,r=this.edges.length;t<r;t++){let r=this.offsetContour(this.vertices[t],this.edges[t]);r.length>0&&e.push(r)}e.length>0&&(t=1===e.length?e[0]:(0,H0.union)(e[0],...e.slice(1)))}else t=1===this.vertices.length?this.offsetPoint(e):this.offsetContour(this.vertices,this.edges);return t}offsetContour(e,t){let r=[],i=0,n=0;if(yS(e[0])&&"number"==typeof e[0][0]){for(i=0,n=e.length-1;i<n;i++){let n=[this.ensureLastPoint(this.offsetSegment(e[i],e[i+1],t[i],this.distance))];r.push(n)}r.length>0&&(r=1===r.length?[r[0]]:(0,H0.union)(r[0],r.slice(1)))}else{let a=[];for(i=0,n=t.length;i<n;i++){let r=this.offsetContour(e[i],t[i]);r.length>0&&a.push(r)}a.length>0&&(r=1===a.length?a[0]:(0,H0.union)(a[0],...a.slice(1)))}return r}offsetPoint(e){this.setDistance(e);let t=2*this.arcSegments,r=[],i=this.vertices,n=this.distance,a=0;t%2==0&&t++;for(let e=0;e<t;e++)a+=2*Math.PI/t,r.push([i[0]+n*Math.cos(a),i[1]+n*Math.sin(a)]);return[[this.ensureLastPoint(r)]]}},vD=class extends yr{constructor(e=!0,t=!1){super(),this.name="COORDINATE_AXES",this.AXIS_LENGTH=1,this.AXIS_COLOR_X=16711680,this.AXIS_COLOR_Y=65280,this.AXIS_COLOR_Z=255;let r=new F(0,0,0),i=new F(1,0,0),n=new F(0,1,0),a=new yu(i,r,this.AXIS_LENGTH,this.AXIS_COLOR_X,0,0),s=new yu(n,r,this.AXIS_LENGTH,this.AXIS_COLOR_Y,0,0);if(this.add(a,s),!t){let e=new F(0,0,1),t=new yu(e,r,this.AXIS_LENGTH,this.AXIS_COLOR_Z,0,0);this.add(t)}e&&this.addTexts(t)}addTexts(e=!1){let t=this.createText("X","#ff0000"),r=this.createText("Y","#00ff00");if(t.position.set(this.AXIS_LENGTH+.1,0,0),r.position.set(.1,this.AXIS_LENGTH,.1),this.add(t,r),!e){let e=this.createText("Z","#0000ff");e.position.set(0,0,this.AXIS_LENGTH+.1),this.add(e)}}createText(e,t,r=14){let i=document.createElement("div");i.innerHTML=e;let n=i.style;return n.color=t,n.width=`${r}px`,n.height=`${r}px`,n.textAlign="center",n.top="0px",n.left="0px",new S1(i)}},Fq=class extends vn{constructor(e,t){super(e,{id:(null==t?void 0:t.id)||Fq.DEFAULT_ID}),this.ignoreZAxis=!1,this.cfg=t||{},this.ignoreZAxis=!(null==t||!t.ignoreZAxis),this.hostCamera=e.camera,this.init()}init(){this.initRenderer(),this.initScene(),this.animate(),this.viewer.addEventListener("camerachange",(()=>{this.hostCamera=this.viewer.camera}))}initRenderer(){var e;let t,r=100,i=100;if(this.cfg.containerId&&(t=document.getElementById(this.cfg.containerId),t&&(r=t.clientWidth,i=t.clientHeight)),!t){let r="axisGizmo";t=document.createElement("div"),t.id=r,null==(e=this.viewer.widgetContainer)||e.appendChild(t)}this.renderer=new Ka({antialias:!0,alpha:!0}),this.renderer.setSize(r,i),t.appendChild(this.renderer.domElement),this.css2dRenderer=new M1,this.css2dRenderer.setSize(r,i),this.css2dRenderer.domElement.style.height="0",this.css2dRenderer.domElement.style.width="0",t.appendChild(this.css2dRenderer.domElement)}initScene(){this.scene=new Xi,this.camera=new Gi(-1,1,1,-1,.1,100),this.scene.add(this.camera),this.coordinateAxes=new vD(!0,this.ignoreZAxis),this.scene.add(this.coordinateAxes)}setHostCamera(e){this.hostCamera=e}render(){var e;!this.scene||!this.camera||(this.renderer&&(this.update(),this.renderer.render(this.scene,this.camera)),null==(e=this.css2dRenderer)||e.render(this.scene,this.camera))}animate(){requestAnimationFrame(this.animate.bind(this)),this.render()}update(){if(!this.hostCamera)return;let e=this.hostCamera;if(e){let t=new F;e.getWorldDirection(t);let r=e.up;this.updateCameraDirection(t,r)}}updateCameraDirection(e,t){if(!this.camera||!e)return;e.normalize();let r=.3;this.camera.position.set(2*-e.x+r,2*-e.y+r,2*-e.z+r),this.camera.lookAt(r,r,r),this.camera.up=t}destroy(){var e,t;super.destroy(),this.scene&&this.camera&&this.coordinateAxes&&(this.scene.clear(),this.scene=void 0,this.css2dRenderer&&(null==(e=this.container)||e.removeChild(this.css2dRenderer.domElement),this.css2dRenderer=void 0),this.renderer&&(null==(t=this.container)||t.removeChild(this.renderer.domElement),this.renderer.dispose(),this.renderer.forceContextLoss(),this.renderer=void 0),this.hostCamera=void 0,this.camera=void 0,this.coordinateAxes=void 0)}},kq=Fq;kq.DEFAULT_ID="AxisGizmoPlugin";var Nq=ra(_m(),1),FPt="bottomBar",QMe=e=>{let t=document.createElement("span"),r=e.viewer.getRenderInfo(),i=(e,r)=>{t.innerHTML+=`<p><span>${e}:</span>${r}</p>`};t.innerHTML="<p>-- Renderer Info --</p>";let n=` (${(e=>{var t;let r=null==(t=e.renderer)?void 0:t.domElement;return null==r?void 0:r.dataset.engine})(e.viewer)})`;if(i("Version",`${DT}${n}`),i("DrawCalls",r.drawCalls),i("Points",r.points),i("Lines",r.lines),i("Triangles",r.triangles),i("Materials",r.materials),i("Textures",r.textures),i("Geometries",r.geometries),"BimTilesViewer"===e.viewer.name){t.innerHTML+="<p>-- Tileset Info --</p>";let r=e.viewer,n=0,a=0,s=0,o=0,l=0,h=0,c=0;r.loadedModels.forEach((e=>{n+=e.metadata.modelSize,a+=e.statistics.tileCount,s+=e.statistics.elementCount,o+=e.statistics.materialCount,l+=e.statistics.textureCount,h+=e.statistics.meshVertexCount,c+=e.statistics.meshFaceCount})),i("Tileset count",r.loadedModels.length),i("Tile count",a),i("Model size",Ut.byteCountToString(n)),i("Element count",s),i("Material count",o),i("Texture count",l),i("Vertex count",h),i("Face count",c)}else if("Viewer2d"===e.viewer.name){i("Entities",e.viewer.getEntityCount())}return t},eAe=e=>{let t=document.createElement("span"),r=e.viewer.getCameraConfig(),i=(e,r)=>{t.innerHTML+=`<p><span>${e}:</span>${r}</p>`};t.innerHTML="";let n=e=>Ut.numberToString(e),a=e=>Ut.vectorToString(e);return i("Camera type",e.viewer.getCameraProjection()),i("Camera position",a(r.eye)),i("Camera target",a(r.look)),i("Camera up",a(r.up)),i("Camera near",n(r.near||0)),i("Camera far",n(r.far||0)),t},BPt={"x-viewer-threejs-statistics":{icon:{default:"icon-info",active:"icon-info-filled",iconFont:Yi},mutexIds:["x-viewer-threejs-cameraCfg","x-viewer-threejs-tips"],onActive:e=>{let t=QMe(e);e.tooltip.setContent(t),e.tooltip.show()},onDeactive:e=>{e.tooltip.hide()},onUpdate:e=>{let t=QMe(e);e.tooltip.setContent(t)}},"x-viewer-threejs-cameraCfg":{icon:{default:"icon-view",active:"icon-view-filled",iconFont:Yi},mutexIds:["x-viewer-threejs-statistics","x-viewer-threejs-tips"],onActive:e=>{let t=eAe(e);e.tooltip.setContent(t),e.tooltip.show()},onDeactive:e=>{e.tooltip.hide()},onUpdate:e=>{let t=eAe(e);e.tooltip.setContent(t)}},"x-viewer-threejs-tips":{icon:{default:"icon-more",iconFont:Yi},mutexIds:["x-viewer-threejs-cameraCfg","x-viewer-threejs-cameraCfg"],onActive:e=>{let t=document.createElement("span");"Viewer3d"===e.viewer.name||"BimTilesViewer"===e.viewer.name?t.innerHTML="\n                <p><span>W: </span>Move forward</p>\n                <p><span>A: </span>Move backward</p>\n                <p><span>S: </span>Move left</p>\n                <p><span>D: </span>Move right</p>\n                <p><span>Q: </span>Rise up</p>\n                <p><span>E: </span>Lower down</p>\n                <p><span>↑: </span>Rotate up</p>\n                <p><span>↓: </span>Rotate down</p>\n                <p><span>←: </span>Rotate to left</p>\n                <p><span>→: </span>Rotate to right</p>\n                ":"Viewer2d"===e.viewer.name?t.innerHTML="\n                <p><span>↑: </span>Move up</p>\n                <p><span>↓: </span>Move down</p>\n                <p><span>←: </span>Move to left</p>\n                <p><span>→: </span>Move to right</p>\n                ":t.innerHTML="\n                <p>Nothing to show</p>\n                ",e.tooltip.setContent(t),e.tooltip.show()},onDeactive:e=>{e.tooltip.hide()}}},tAe=class extends vn{constructor(e){super(e,{id:"BottomBarPlugin"}),this.itemList=new Map,this.init()}update(){this.itemList.forEach((e=>{e.update()}))}init(){var e;let t=document.createElement("div");t.id=FPt,t.classList.add("bottom-bar"),(0,Nq.forEach)(BPt,((e,r)=>{let i=this.createItem(this.viewer,r,e);t.appendChild(i.element)})),this.element=t,null==(e=this.viewer.widgetContainer)||e.appendChild(this.element),this.viewer.addEventListener("afterrender",(()=>{this.update()}))}createItem(e,t,r){let i=new Bq(e,this,t,r);return this.itemList.set(t,i),i}},Bq=class{constructor(e,t,r,i){this.viewer=e,this.bottomBar=t,this.menuId=r,this.cfg=i,this.eventBus=Vb(),this.active=!1,this.itemconfig=i,this.element=this.createButton(this.menuId,i),this.tooltip=new Dc(r+"-tooltip",null,{parentNode:e.widgetContainer}),this.eventBus.on("activitychange",(e=>{e?(this.element.classList.add("active"),(0,Nq.forEach)(i.mutexIds,(e=>{var t;let r=null==(t=this.bottomBar)?void 0:t.itemList.get(e);r&&r.active&&r.setActive(!1)})),i.onActive&&i.onActive(this)):(this.element.classList.remove("active"),i.onDeactive&&i.onDeactive(this)),this.element instanceof HTMLElement&&EP(this.element.classList,i.icon,this.active)}))}createButton(e,t){let r=document.createElement("i");r.id=e;let{default:i="icon-new",iconFont:n=AP}=t.icon;return r.classList.add("icon"),r.classList.add(n),r.classList.add(i),r.onclick=()=>{this.active=!this.active,t.onClick&&t.onClick(this),this.eventBus.emit("activitychange",this.active)},r}setActive(e){this.active=e,this.eventBus.emit("activitychange",this.active)}update(){this.active&&this.itemconfig.onUpdate&&this.itemconfig.onUpdate(this)}},bS=ra(_m(),1),Vl=e=>()=>xn(`ContextMenu.${e}`),nAe=e=>e.hasVisibleObject(),NPt=e=>e.hasInvisibleObject(),rAe=(e,t,r,i)=>{let n=e.selectedObject;return!(!n||!t||n.id!==t.id)},UPt=(e,t)=>{let r=e.selectedObject;return!(!r||!t||r.tilesetId!==t.tilesetId||r.userId!==t.userId)},HPt={getTitle:Vl("viewFitEntity"),getShown:({hit:e})=>e,doAction:({viewer:e,hit:t})=>{e instanceof ju?e.flyToObject(t):e instanceof Cf&&e.flyToUserId(t.tilesetId,t.userId)}},VPt={getTitle:Vl("viewFitAll"),getEnabled:({viewer:e})=>nAe(e),doAction:({viewer:e})=>e.viewFitAll()},zPt={getTitle:Vl("hideEntity"),getShown:({hit:e})=>e,doAction:({viewer:e,hit:t})=>{e instanceof ju?(e.clearSelection(),e.setObjectVisible(t,!1)):e instanceof Cf&&(e.clearSelection(),e.setObjectVisibleByUserIds(t.tilesetId,[t.userId],!1)),e.enableRender()}},GPt={getTitle:Vl("hideOthers"),getShown:({hit:e})=>e,doAction:({viewer:e,hit:t})=>{e instanceof ju?(e.clearSelection(),e.hideOtherObjects(t)):e instanceof Cf&&(e.clearSelection(),e.setOtherObjectVisibleByUserIds(t.tilesetId,[t.userId],!1)),e.enableRender()}},qPt={getTitle:Vl("hideAll"),getEnabled:({viewer:e})=>nAe(e),doAction:({viewer:e})=>{let t=e;t.clearSelection(),t.setModelsVisible(!1),t.enableRender()}},jPt={getTitle:Vl("showAll"),getEnabled:({viewer:e})=>NPt(e),doAction:({viewer:e})=>{let t=e;t.setModelsVisible(!0),t.enableRender()}},WPt={getTitle:({hit:e,viewer:t,instanceId:r,batchId:i})=>rAe(t,e,r,i)?Vl("deselect")():Vl("select")(),getShown:({hit:e,viewer:t})=>t.enableSelection&&e,doAction:({hit:e,viewer:t,instanceId:r,batchId:i})=>{if(t instanceof ju){if(!pn.isObjectSelectable(e))return void de.debug(`[ContextMenu] object(type: ${e.type}, name: ${e.name}) not selectable!`);rAe(t,e,r,i)?t.clearSelection():t.setObjectHighlight(e)}else t instanceof Cf&&(UPt(t,e)?t.clearSelection():t.setObjectHighlightedByUserIds(e.tilesetId,[e.userId],!0))}},XPt={getTitle:Vl("selectNone"),getShown:({viewer:e})=>e.enableSelection,getEnabled:({viewer:e})=>!!e.selectedObject,doAction:({viewer:e})=>e.clearSelection()},qb=!1,YPt={getTitle:Vl("xRayAll"),getShown:({viewer:e})=>!qb,doAction:({viewer:e})=>{let t=e;t.clearSelection(),t.setModelsOpacity(Ph),t.enableRender(),qb=!0}},$Pt={getTitle:Vl("xRayNone"),getEnabled:({viewer:e})=>qb,doAction:({viewer:e})=>{let t=e;t.clearSelection(),t.clearModelsOpacity(),t.enableRender(),qb=!1}},ZPt={getTitle:Vl("xRayEntity"),getShown:({hit:e})=>e,doAction:({viewer:e,hit:t})=>{e instanceof ju?(e.clearSelection(),e.setObjectOpacity(t,Ph)):e instanceof Cf&&(e.clearSelection(),e.setObjectOpacityByUserIds(t.tilesetId,[t.userId],Ph)),qb=!0}},KPt={getTitle:Vl("xRayOthers"),getShown:({hit:e})=>e,doAction:({viewer:e,hit:t})=>{e instanceof ju?(e.clearSelection(),e.setOtherObjectsOpacity(t,Ph)):e instanceof Cf&&(e.clearSelection(),e.setOtherObjectOpacityByUserIds(t.tilesetId,[t.userId],Ph)),qb=!0}},iAe=[[HPt,VPt],[zPt,GPt,qPt,jPt],[ZPt,KPt,YPt,$Pt],[WPt,XPt]],sAe=class extends vn{constructor(e){super(e,{id:"ContextMenuPlugin"}),this.itemList=[],this.handleClick=()=>{this.hide()},this.container=e.widgetContainer||document.body,this.context={viewer:e},this.element=this.createMenuUI(iAe||[]),window.oncontextmenu=e=>e.preventDefault(),this.hide(),this.initEvents()}initEvents(){let e=this.viewer.getInputManager();if(!e)return;let t=!1,r=!1,i=0,n=0;e.addEventListener("pointerdown",(()=>{r=!1,t=!0,this.hide()})),e.addEventListener("pointermove",(e=>{t&&!r&&(r=!(e=>-1!==i&&-1!==n&&Math.abs(e.x-i)<5&&Math.abs(e.y-n)<5)(e))})),e.addEventListener("pointerup",(e=>{if(t=!1,r)return r=!1,void this.hide();i=e.x,n=e.y;let a=this.viewer.findPlugin(Pf.DEFAULT_ID);2!==e.button||null!=a&&a.isActive()?this.hide():this.showContextMenu(e)})),document.addEventListener("click",this.handleClick)}showContextMenu(e){let t=this.context,r=this.viewer;this.context=Ii(on({},t),{hit:r.selectedObject});let{x:i,y:n}=e;this.show(i,n)}isEnabled(e){return e.getEnabled?e.getEnabled(this.context):void 0===e.enabled||e.enabled}isShown(e){return e.getShown?e.getShown(this.context):void 0===e.shown||e.shown}getTitle(e){return e.title||e.getTitle&&e.getTitle(this.context)||""}createMenuUI(e){let t=document.createElement("div");t.id=this.id,t.classList.add("context-menu");let r=this.createMenuGroup(e);return t.append(...r),this.container.appendChild(t),t}createMenuGroup(e){return(0,bS.map)(e,(e=>{let t=document.createElement("ul");return(0,bS.forEach)(e,(e=>{let r=this.createMenuItem(e);t.append(r)})),t}))}createMenuItem(e){let t=document.createElement("li");return t.innerHTML=this.getTitle(e),t.onclick=()=>e.doAction&&e.doAction(this.context),this.isEnabled(e)?t.classList.remove("disabled"):t.classList.add("disabled"),this.isShown(e)?t.removeAttribute("hidden"):t.setAttribute("hidden",""),this.itemList.push([e,t]),t}updateMenuItems(){(0,bS.forEach)(this.itemList,(([e,t])=>{this.isEnabled(e)?t.classList.remove("disabled"):t.classList.add("disabled"),this.isShown(e)?t.removeAttribute("hidden"):t.setAttribute("hidden",""),t.innerHTML=this.getTitle(e)}))}showMenuElement(e,t){let r=this.element.offsetHeight,i=this.element.offsetWidth;t+r>window.innerHeight&&(t=window.innerHeight-r-5),e+i>window.innerWidth&&(e=window.innerWidth-i-5),this.element.style.left=e+"px",this.element.style.top=t+"px"}show(e,t){this.updateMenuItems(),this.element.removeAttribute("hidden"),this.showMenuElement(e,t)}hide(){this.element.setAttribute("hidden","")}destroy(){document.removeEventListener("click",this.handleClick),this.container.removeChild(this.element)}};function JPt(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}function Xb(e,t){var r=e.__state.conversionName.toString(),i=Math.round(e.r),n=Math.round(e.g),a=Math.round(e.b),s=e.a,o=Math.round(e.h),l=e.s.toFixed(1),h=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===r||"SIX_CHAR_HEX"===r){for(var c=e.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===r?"rgb("+i+","+n+","+a+")":"CSS_RGBA"===r?"rgba("+i+","+n+","+a+","+s+")":"HEX"===r?"0x"+e.hex.toString(16):"RGB_ARRAY"===r?"["+i+","+n+","+a+"]":"RGBA_ARRAY"===r?"["+i+","+n+","+a+","+s+"]":"RGB_OBJ"===r?"{r:"+i+",g:"+n+",b:"+a+"}":"RGBA_OBJ"===r?"{r:"+i+",g:"+n+",b:"+a+",a:"+s+"}":"HSV_OBJ"===r?"{h:"+o+",s:"+l+",v:"+h+"}":"HSVA_OBJ"===r?"{h:"+o+",s:"+l+",v:"+h+",a:"+s+"}":"unknown format"}var aAe=Array.prototype.forEach,xS=Array.prototype.slice,Qt={BREAK:{},extend:function(e){return this.each(xS.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(r){this.isUndefined(t[r])||(e[r]=t[r])}.bind(this))}),this),e},defaults:function(e){return this.each(xS.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(r){this.isUndefined(e[r])&&(e[r]=t[r])}.bind(this))}),this),e},compose:function(){var e=xS.call(arguments);return function(){for(var t=xS.call(arguments),r=e.length-1;r>=0;r--)t=[e[r].apply(this,t)];return t[0]}},each:function(e,t,r){if(e)if(aAe&&e.forEach&&e.forEach===aAe)e.forEach(t,r);else if(e.length===e.length+0){var i,n=void 0;for(n=0,i=e.length;n<i;n++)if(n in e&&t.call(r,e[n],n)===this.BREAK)return}else for(var a in e)if(t.call(r,e[a],a)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,r){var i=void 0;return function(){var n=this,a=arguments;var s=r||!i;clearTimeout(i),i=setTimeout((function(){i=null,r||e.apply(n,a)}),t),s&&e.apply(n,a)}},toArray:function(e){return e.toArray?e.toArray():xS.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return isNaN(e)})),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return e instanceof Function}},QPt=[{litmus:Qt.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:Xb},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:Xb},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:Xb},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:Xb}}},{litmus:Qt.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:Qt.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:Qt.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(Qt.isNumber(e.r)&&Qt.isNumber(e.g)&&Qt.isNumber(e.b)&&Qt.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(Qt.isNumber(e.r)&&Qt.isNumber(e.g)&&Qt.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(Qt.isNumber(e.h)&&Qt.isNumber(e.s)&&Qt.isNumber(e.v)&&Qt.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(Qt.isNumber(e.h)&&Qt.isNumber(e.s)&&Qt.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],ES=void 0,yD=void 0,Hq=function(){yD=!1;var e=arguments.length>1?Qt.toArray(arguments):arguments[0];return Qt.each(QPt,(function(t){if(t.litmus(e))return Qt.each(t.conversions,(function(t,r){if(ES=t.read(e),!1===yD&&!1!==ES)return yD=ES,ES.conversionName=r,ES.conversion=t,Qt.BREAK})),Qt.BREAK})),yD},oAe=void 0,xD={hsv_to_rgb:function(e,t,r){var i=Math.floor(e/60)%6,n=e/60-Math.floor(e/60),a=r*(1-t),s=r*(1-n*t),o=r*(1-(1-n)*t),l=[[r,o,a],[s,r,a],[a,r,o],[a,s,r],[o,a,r],[r,a,s]][i];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,r){var i=Math.min(e,t,r),n=Math.max(e,t,r),a=n-i,s=void 0;return 0===n?{h:NaN,s:0,v:0}:(s=e===n?(t-r)/a:t===n?2+(r-e)/a:4+(e-t)/a,(s/=6)<0&&(s+=1),{h:360*s,s:a/n,v:n/255})},rgb_to_hex:function(e,t,r){var i=this.hex_with_component(0,2,e);return i=this.hex_with_component(i,1,t),i=this.hex_with_component(i,0,r)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,r){return r<<(oAe=8*t)|e&~(255<<oAe)}},e3t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wu=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Xu=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),Tm=function e(t,r,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,i)}if("value"in n)return n.value;var s=n.get;return void 0===s?void 0:s.call(i)},wm=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Sm=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},Ma=function(){function e(){if(Wu(this,e),this.__state=Hq.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return Xu(e,[{key:"toString",value:function(){return Xb(this)}},{key:"toHexString",value:function(){return Xb(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function Wq(e,t,r){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||Ma.recalculateRGB(this,t,r),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(Ma.recalculateRGB(this,t,r),this.__state.space="RGB"),this.__state[t]=e}})}function Xq(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||Ma.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(Ma.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}Ma.recalculateRGB=function(e,t,r){if("HEX"===e.__state.space)e.__state[t]=xD.component_from_hex(e.__state.hex,r);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");Qt.extend(e.__state,xD.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},Ma.recalculateHSV=function(e){var t=xD.rgb_to_hsv(e.r,e.g,e.b);Qt.extend(e.__state,{s:t.s,v:t.v}),Qt.isNaN(t.h)?Qt.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},Ma.COMPONENTS=["r","g","b","h","s","v","hex","a"],Wq(Ma.prototype,"r",2),Wq(Ma.prototype,"g",1),Wq(Ma.prototype,"b",0),Xq(Ma.prototype,"h"),Xq(Ma.prototype,"s"),Xq(Ma.prototype,"v"),Object.defineProperty(Ma.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(Ma.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=xD.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var V0=function(){function e(t,r){Wu(this,e),this.initialValue=t[r],this.domElement=document.createElement("div"),this.object=t,this.property=r,this.__onChange=void 0,this.__onFinishChange=void 0}return Xu(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),t3t={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},vAe={};Qt.each(t3t,(function(e,t){Qt.each(e,(function(e){vAe[e]=t}))}));var r3t=/(\d+(\.\d+)?)px/;function rd(e){if("0"===e||Qt.isUndefined(e))return 0;var t=e.match(r3t);return Qt.isNull(t)?0:parseFloat(t[1])}var Ct={makeSelectable:function(e,t){void 0===e||void 0===e.style||(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,r){var i=r,n=t;Qt.isUndefined(n)&&(n=!0),Qt.isUndefined(i)&&(i=!0),e.style.position="absolute",n&&(e.style.left=0,e.style.right=0),i&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,r,i){var n=r||{},a=vAe[t];if(!a)throw new Error("Event type "+t+" not supported.");var s=document.createEvent(a);switch(a){case"MouseEvents":var o=n.x||n.clientX||0,l=n.y||n.clientY||0;s.initMouseEvent(t,n.bubbles||!1,n.cancelable||!0,window,n.clickCount||1,0,0,o,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var h=s.initKeyboardEvent||s.initKeyEvent;Qt.defaults(n,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),h(t,n.bubbles||!1,n.cancelable,window,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.keyCode,n.charCode);break;default:s.initEvent(t,n.bubbles||!1,n.cancelable||!0)}Qt.defaults(s,i),e.dispatchEvent(s)},bind:function(e,t,r,i){var n=i||!1;return e.addEventListener?e.addEventListener(t,r,n):e.attachEvent&&e.attachEvent("on"+t,r),Ct},unbind:function(e,t,r,i){var n=i||!1;return e.removeEventListener?e.removeEventListener(t,r,n):e.detachEvent&&e.detachEvent("on"+t,r),Ct},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var r=e.className.split(/ +/);-1===r.indexOf(t)&&(r.push(t),e.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return Ct},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var r=e.className.split(/ +/),i=r.indexOf(t);-1!==i&&(r.splice(i,1),e.className=r.join(" "))}else e.className=void 0;return Ct},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return rd(t["border-left-width"])+rd(t["border-right-width"])+rd(t["padding-left"])+rd(t["padding-right"])+rd(t.width)},getHeight:function(e){var t=getComputedStyle(e);return rd(t["border-top-width"])+rd(t["border-bottom-width"])+rd(t["padding-top"])+rd(t["padding-bottom"])+rd(t.height)},getOffset:function(e){var t=e,r={left:0,top:0};if(t.offsetParent)do{r.left+=t.offsetLeft,r.top+=t.offsetTop,t=t.offsetParent}while(t);return r},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},yAe=function(e){function t(e,r){Wu(this,t);var i=Sm(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),n=i;return i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox"),Ct.bind(i.__checkbox,"change",(function(){n.setValue(!n.__prev)}),!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return wm(t,V0),Xu(t,[{key:"setValue",value:function(e){var r=Tm(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),r}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Tm(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),n3t=function(e){function t(e,r,i){Wu(this,t);var n=Sm(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),a=i,s=n;if(n.__select=document.createElement("select"),Qt.isArray(a)){var o={};Qt.each(a,(function(e){o[e]=e})),a=o}return Qt.each(a,(function(e,t){var r=document.createElement("option");r.innerHTML=t,r.setAttribute("value",e),s.__select.appendChild(r)})),n.updateDisplay(),Ct.bind(n.__select,"change",(function(){var e=this.options[this.selectedIndex].value;s.setValue(e)})),n.domElement.appendChild(n.__select),n}return wm(t,V0),Xu(t,[{key:"setValue",value:function(e){var r=Tm(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),r}},{key:"updateDisplay",value:function(){return Ct.isActive(this.__select)?this:(this.__select.value=this.getValue(),Tm(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(),i3t=function(e){function t(e,r){Wu(this,t);var i=Sm(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),n=i;function a(){n.setValue(n.__input.value)}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),Ct.bind(i.__input,"keyup",a),Ct.bind(i.__input,"change",a),Ct.bind(i.__input,"blur",(function(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())})),Ct.bind(i.__input,"keydown",(function(e){13===e.keyCode&&this.blur()})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return wm(t,V0),Xu(t,[{key:"updateDisplay",value:function(){return Ct.isActive(this.__input)||(this.__input.value=this.getValue()),Tm(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function lAe(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var bAe=function(e){function t(e,r,i){Wu(this,t);var n=Sm(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),a=i||{};return n.__min=a.min,n.__max=a.max,n.__step=a.step,Qt.isUndefined(n.__step)?0===n.initialValue?n.__impliedStep=1:n.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(n.initialValue))/Math.LN10))/10:n.__impliedStep=n.__step,n.__precision=lAe(n.__impliedStep),n}return wm(t,V0),Xu(t,[{key:"setValue",value:function(e){var r=e;return void 0!==this.__min&&r<this.__min?r=this.__min:void 0!==this.__max&&r>this.__max&&(r=this.__max),void 0!==this.__step&&r%this.__step!=0&&(r=Math.round(r/this.__step)*this.__step),Tm(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,r)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=lAe(e),this}}]),t}();function s3t(e,t){var r=Math.pow(10,t);return Math.round(e*r)/r}var ED=function(e){function t(e,r,i){Wu(this,t);var n=Sm(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,i));n.__truncationSuspended=!1;var a=n,s=void 0;function o(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function l(e){var t=s-e.clientY;a.setValue(a.getValue()+t*a.__impliedStep),s=e.clientY}function h(){Ct.unbind(window,"mousemove",l),Ct.unbind(window,"mouseup",h),o()}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),Ct.bind(n.__input,"change",(function(){var e=parseFloat(a.__input.value);Qt.isNaN(e)||a.setValue(e)})),Ct.bind(n.__input,"blur",(function(){o()})),Ct.bind(n.__input,"mousedown",(function(e){Ct.bind(window,"mousemove",l),Ct.bind(window,"mouseup",h),s=e.clientY})),Ct.bind(n.__input,"keydown",(function(e){13===e.keyCode&&(a.__truncationSuspended=!0,this.blur(),a.__truncationSuspended=!1,o())})),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return wm(t,bAe),Xu(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():s3t(this.getValue(),this.__precision),Tm(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function cAe(e,t,r,i,n){return i+(e-t)/(r-t)*(n-i)}var Vq=function(e){function t(e,r,i,n,a){Wu(this,t);var s=Sm(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,{min:i,max:n,step:a})),o=s;function l(e){e.preventDefault();var t=o.__background.getBoundingClientRect();return o.setValue(cAe(e.clientX,t.left,t.right,o.__min,o.__max)),!1}function h(){Ct.unbind(window,"mousemove",l),Ct.unbind(window,"mouseup",h),o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function c(e){var t=e.touches[0].clientX,r=o.__background.getBoundingClientRect();o.setValue(cAe(t,r.left,r.right,o.__min,o.__max))}function u(){Ct.unbind(window,"touchmove",c),Ct.unbind(window,"touchend",u),o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),Ct.bind(s.__background,"mousedown",(function(e){document.activeElement.blur(),Ct.bind(window,"mousemove",l),Ct.bind(window,"mouseup",h),l(e)})),Ct.bind(s.__background,"touchstart",(function(e){1===e.touches.length&&(Ct.bind(window,"touchmove",c),Ct.bind(window,"touchend",u),c(e))})),Ct.addClass(s.__background,"slider"),Ct.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return wm(t,bAe),Xu(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",Tm(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),xAe=function(e){function t(e,r,i){Wu(this,t);var n=Sm(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r)),a=n;return n.__button=document.createElement("div"),n.__button.innerHTML=void 0===i?"Fire":i,Ct.bind(n.__button,"click",(function(e){return e.preventDefault(),a.fire(),!1})),Ct.addClass(n.__button,"button"),n.domElement.appendChild(n.__button),n}return wm(t,V0),Xu(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(),zq=function(e){function t(e,r){Wu(this,t);var i=Sm(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));i.__color=new Ma(i.getValue()),i.__temp=new Ma(0);var n=i;i.domElement=document.createElement("div"),Ct.makeSelectable(i.domElement,!1),i.__selector=document.createElement("div"),i.__selector.className="selector",i.__saturation_field=document.createElement("div"),i.__saturation_field.className="saturation-field",i.__field_knob=document.createElement("div"),i.__field_knob.className="field-knob",i.__field_knob_border="2px solid ",i.__hue_knob=document.createElement("div"),i.__hue_knob.className="hue-knob",i.__hue_field=document.createElement("div"),i.__hue_field.className="hue-field",i.__input=document.createElement("input"),i.__input.type="text",i.__input_textShadow="0 1px 1px ",Ct.bind(i.__input,"keydown",(function(e){13===e.keyCode&&c.call(this)})),Ct.bind(i.__input,"blur",c),Ct.bind(i.__selector,"mousedown",(function(){Ct.addClass(this,"drag").bind(window,"mouseup",(function(){Ct.removeClass(n.__selector,"drag")}))})),Ct.bind(i.__selector,"touchstart",(function(){Ct.addClass(this,"drag").bind(window,"touchend",(function(){Ct.removeClass(n.__selector,"drag")}))}));var a=document.createElement("div");function s(e){d(e),Ct.bind(window,"mousemove",d),Ct.bind(window,"touchmove",d),Ct.bind(window,"mouseup",l),Ct.bind(window,"touchend",l)}function o(e){p(e),Ct.bind(window,"mousemove",p),Ct.bind(window,"touchmove",p),Ct.bind(window,"mouseup",h),Ct.bind(window,"touchend",h)}function l(){Ct.unbind(window,"mousemove",d),Ct.unbind(window,"touchmove",d),Ct.unbind(window,"mouseup",l),Ct.unbind(window,"touchend",l),u()}function h(){Ct.unbind(window,"mousemove",p),Ct.unbind(window,"touchmove",p),Ct.unbind(window,"mouseup",h),Ct.unbind(window,"touchend",h),u()}function c(){var e=Hq(this.value);!1!==e?(n.__color.__state=e,n.setValue(n.__color.toOriginal())):this.value=n.__color.toString()}function u(){n.__onFinishChange&&n.__onFinishChange.call(n,n.__color.toOriginal())}function d(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=n.__saturation_field.getBoundingClientRect(),r=e.touches&&e.touches[0]||e,i=r.clientX,a=r.clientY,s=(i-t.left)/(t.right-t.left),o=1-(a-t.top)/(t.bottom-t.top);return o>1?o=1:o<0&&(o=0),s>1?s=1:s<0&&(s=0),n.__color.v=o,n.__color.s=s,n.setValue(n.__color.toOriginal()),!1}function p(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=n.__hue_field.getBoundingClientRect(),r=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return r>1?r=1:r<0&&(r=0),n.__color.h=360*r,n.setValue(n.__color.toOriginal()),!1}return Qt.extend(i.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Qt.extend(i.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:i.__field_knob_border+(i.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Qt.extend(i.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Qt.extend(i.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Qt.extend(a.style,{width:"100%",height:"100%",background:"none"}),uAe(a,"top","rgba(0,0,0,0)","#000"),Qt.extend(i.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),o3t(i.__hue_field),Qt.extend(i.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:i.__input_textShadow+"rgba(0,0,0,0.7)"}),Ct.bind(i.__saturation_field,"mousedown",s),Ct.bind(i.__saturation_field,"touchstart",s),Ct.bind(i.__field_knob,"mousedown",s),Ct.bind(i.__field_knob,"touchstart",s),Ct.bind(i.__hue_field,"mousedown",o),Ct.bind(i.__hue_field,"touchstart",o),i.__saturation_field.appendChild(a),i.__selector.appendChild(i.__field_knob),i.__selector.appendChild(i.__saturation_field),i.__selector.appendChild(i.__hue_field),i.__hue_field.appendChild(i.__hue_knob),i.domElement.appendChild(i.__input),i.domElement.appendChild(i.__selector),i.updateDisplay(),i}return wm(t,V0),Xu(t,[{key:"updateDisplay",value:function(){var e=Hq(this.getValue());if(!1!==e){var t=!1;Qt.each(Ma.COMPONENTS,(function(r){if(!Qt.isUndefined(e[r])&&!Qt.isUndefined(this.__color.__state[r])&&e[r]!==this.__color.__state[r])return t=!0,{}}),this),t&&Qt.extend(this.__color.__state,e)}Qt.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var r=this.__color.v<.5||this.__color.s>.5?255:0,i=255-r;Qt.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+r+","+r+","+r+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,uAe(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Qt.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+r+","+r+","+r+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})}}]),t}(),a3t=["-moz-","-o-","-webkit-","-ms-",""];function uAe(e,t,r,i){e.style.background="",Qt.each(a3t,(function(n){e.style.cssText+="background: "+n+"linear-gradient("+t+", "+r+" 0%, "+i+" 100%); "}))}function o3t(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var l3t={load:function(e,t){var r=t||document,i=r.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=e,r.getElementsByTagName("head")[0].appendChild(i)},inject:function(e,t){var r=t||document,i=document.createElement("style");i.type="text/css",i.innerHTML=e;var n=r.getElementsByTagName("head")[0];try{n.appendChild(i)}catch(e){}}},c3t='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',u3t=function(e,t){var r=e[t];return Qt.isArray(arguments[2])||Qt.isObject(arguments[2])?new n3t(e,t,arguments[2]):Qt.isNumber(r)?Qt.isNumber(arguments[2])&&Qt.isNumber(arguments[3])?Qt.isNumber(arguments[4])?new Vq(e,t,arguments[2],arguments[3],arguments[4]):new Vq(e,t,arguments[2],arguments[3]):Qt.isNumber(arguments[4])?new ED(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new ED(e,t,{min:arguments[2],max:arguments[3]}):Qt.isString(r)?new i3t(e,t):Qt.isFunction(r)?new xAe(e,t,""):Qt.isBoolean(r)?new yAe(e,t):null};function h3t(e){setTimeout(e,1e3/60)}var d3t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||h3t,f3t=function(){function e(){Wu(this,e),this.backgroundElement=document.createElement("div"),Qt.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),Ct.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Qt.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;Ct.bind(this.backgroundElement,"click",(function(){t.hide()}))}return Xu(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Qt.defer((function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",Ct.unbind(e.domElement,"webkitTransitionEnd",t),Ct.unbind(e.domElement,"transitionend",t),Ct.unbind(e.domElement,"oTransitionEnd",t)};Ct.bind(this.domElement,"webkitTransitionEnd",t),Ct.bind(this.domElement,"transitionend",t),Ct.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-Ct.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-Ct.getHeight(this.domElement)/2+"px"}}]),e}(),p3t=JPt(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");l3t.inject(p3t);var hAe="dg",dAe=72,fAe=20,SS="Default",_S=function(){try{return!!window.localStorage}catch(e){return!1}}(),TS=void 0,pAe=!0,jb=void 0,Uq=!1,EAe=[],ss=function e(t){var r=this,i=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),Ct.addClass(this.domElement,hAe),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=Qt.defaults(i,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),i=Qt.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),Qt.isUndefined(i.load)?i.load={preset:SS}:i.preset&&(i.load.preset=i.preset),Qt.isUndefined(i.parent)&&i.hideable&&EAe.push(this),i.resizable=Qt.isUndefined(i.parent)&&i.resizable,i.autoPlace&&Qt.isUndefined(i.scrollable)&&(i.scrollable=!0);var n,a=_S&&"true"===localStorage.getItem(Wb(this,"isLocal")),s=void 0,o=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return r.parent?r.getRoot().preset:i.load.preset},set:function(e){r.parent?r.getRoot().preset=e:i.load.preset=e,y3t(this),r.revert()}},width:{get:function(){return i.width},set:function(e){i.width=e,jq(r,e)}},name:{get:function(){return i.name},set:function(e){i.name=e,o&&(o.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(t){i.closed=t,i.closed?Ct.addClass(r.__ul,e.CLASS_CLOSED):Ct.removeClass(r.__ul,e.CLASS_CLOSED),this.onResize(),r.__closeButton&&(r.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return a},set:function(e){_S&&(a=e,e?Ct.bind(window,"unload",s):Ct.unbind(window,"unload",s),localStorage.setItem(Wb(r,"isLocal"),e))}}}),Qt.isUndefined(i.parent)){if(this.closed=i.closed||!1,Ct.addClass(this.domElement,e.CLASS_MAIN),Ct.makeSelectable(this.domElement,!1),_S&&a){r.useLocalStorage=!0;var l=localStorage.getItem(Wb(this,"gui"));l&&(i.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,Ct.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),i.closeOnTop?(Ct.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(Ct.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),Ct.bind(this.__closeButton,"click",(function(){r.closed=!r.closed}))}else{void 0===i.closed&&(i.closed=!0);var h=document.createTextNode(i.name);Ct.addClass(h,"controller-name"),o=Yq(r,h);Ct.addClass(this.__ul,e.CLASS_CLOSED),Ct.addClass(o,"title"),Ct.bind(o,"click",(function(e){return e.preventDefault(),r.closed=!r.closed,!1})),i.closed||(this.closed=!1)}i.autoPlace&&(Qt.isUndefined(i.parent)&&(pAe&&(jb=document.createElement("div"),Ct.addClass(jb,hAe),Ct.addClass(jb,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(jb),pAe=!1),jb.appendChild(this.domElement),Ct.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||jq(r,i.width)),this.__resizeHandler=function(){r.onResizeDebounced()},Ct.bind(window,"resize",this.__resizeHandler),Ct.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),Ct.bind(this.__ul,"transitionend",this.__resizeHandler),Ct.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&v3t(this),s=function(){_S&&"true"===localStorage.getItem(Wb(r,"isLocal"))&&localStorage.setItem(Wb(r,"gui"),JSON.stringify(r.getSaveObject()))},this.saveToLocalStorageIfPossible=s,i.parent||((n=r.getRoot()).width+=1,Qt.defer((function(){n.width-=1})))};function Yq(e,t,r){var i=document.createElement("li");return t&&i.appendChild(t),r?e.__ul.insertBefore(i,r):e.__ul.appendChild(i),e.onResize(),i}function mAe(e){Ct.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&Ct.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function Gq(e,t){var r=e.__preset_select[e.__preset_select.selectedIndex];r.innerHTML=t?r.value+"*":r.value}function m3t(e,t,r){if(r.__li=t,r.__gui=e,Qt.extend(r,{options:function(t){if(arguments.length>1){var i=r.__li.nextElementSibling;return r.remove(),wS(e,r.object,r.property,{before:i,factoryArgs:[Qt.toArray(arguments)]})}if(Qt.isArray(t)||Qt.isObject(t)){var n=r.__li.nextElementSibling;return r.remove(),wS(e,r.object,r.property,{before:n,factoryArgs:[t]})}},name:function(e){return r.__li.firstElementChild.firstElementChild.innerHTML=e,r},listen:function(){return r.__gui.listen(r),r},remove:function(){return r.__gui.remove(r),r}}),r instanceof Vq){var i=new ED(r.object,r.property,{min:r.__min,max:r.__max,step:r.__step});Qt.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(e){var t=r[e],n=i[e];r[e]=i[e]=function(){var e=Array.prototype.slice.call(arguments);return n.apply(i,e),t.apply(r,e)}})),Ct.addClass(t,"has-slider"),r.domElement.insertBefore(i.domElement,r.domElement.firstElementChild)}else if(r instanceof ED){var n=function(t){if(Qt.isNumber(r.__min)&&Qt.isNumber(r.__max)){var i=r.__li.firstElementChild.firstElementChild.innerHTML,n=r.__gui.__listening.indexOf(r)>-1;r.remove();var a=wS(e,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[r.__min,r.__max,r.__step]});return a.name(i),n&&a.listen(),a}return t};r.min=Qt.compose(n,r.min),r.max=Qt.compose(n,r.max)}else r instanceof yAe?(Ct.bind(t,"click",(function(){Ct.fakeEvent(r.__checkbox,"click")})),Ct.bind(r.__checkbox,"click",(function(e){e.stopPropagation()}))):r instanceof xAe?(Ct.bind(t,"click",(function(){Ct.fakeEvent(r.__button,"click")})),Ct.bind(t,"mouseover",(function(){Ct.addClass(r.__button,"hover")})),Ct.bind(t,"mouseout",(function(){Ct.removeClass(r.__button,"hover")}))):r instanceof zq&&(Ct.addClass(t,"color"),r.updateDisplay=Qt.compose((function(e){return t.style.borderLeftColor=r.__color.toString(),e}),r.updateDisplay),r.updateDisplay());r.setValue=Qt.compose((function(t){return e.getRoot().__preset_select&&r.isModified()&&Gq(e.getRoot(),!0),t}),r.setValue)}function _Ae(e,t){var r=e.getRoot(),i=r.__rememberedObjects.indexOf(t.object);if(-1!==i){var n=r.__rememberedObjectIndecesToControllers[i];if(void 0===n&&(n={},r.__rememberedObjectIndecesToControllers[i]=n),n[t.property]=t,r.load&&r.load.remembered){var a=r.load.remembered,s=void 0;if(a[e.preset])s=a[e.preset];else{if(!a[SS])return;s=a[SS]}if(s[i]&&void 0!==s[i][t.property]){var o=s[i][t.property];t.initialValue=o,t.setValue(o)}}}}function wS(e,t,r,i){if(void 0===t[r])throw new Error('Object "'+t+'" has no property "'+r+'"');var n=void 0;if(i.color)n=new zq(t,r);else{var a=[t,r].concat(i.factoryArgs);n=u3t.apply(e,a)}i.before instanceof V0&&(i.before=i.before.__li),_Ae(e,n),Ct.addClass(n.domElement,"c");var s=document.createElement("span");Ct.addClass(s,"property-name"),s.innerHTML=n.property;var o=document.createElement("div");o.appendChild(s),o.appendChild(n.domElement);var l=Yq(e,o,i.before);return Ct.addClass(l,ss.CLASS_CONTROLLER_ROW),n instanceof zq?Ct.addClass(l,"color"):Ct.addClass(l,e3t(n.getValue())),m3t(e,l,n),e.__controllers.push(n),n}function Wb(e,t){return document.location.href+"."+t}function qq(e,t,r){var i=document.createElement("option");i.innerHTML=t,i.value=t,e.__preset_select.appendChild(i),r&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function gAe(e,t){t.style.display=e.useLocalStorage?"block":"none"}function g3t(e){var t=e.__save_row=document.createElement("li");Ct.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),Ct.addClass(t,"save-row");var r=document.createElement("span");r.innerHTML="&nbsp;",Ct.addClass(r,"button gears");var i=document.createElement("span");i.innerHTML="Save",Ct.addClass(i,"button"),Ct.addClass(i,"save");var n=document.createElement("span");n.innerHTML="New",Ct.addClass(n,"button"),Ct.addClass(n,"save-as");var a=document.createElement("span");a.innerHTML="Revert",Ct.addClass(a,"button"),Ct.addClass(a,"revert");var s=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?Qt.each(e.load.remembered,(function(t,r){qq(e,r,r===e.preset)})):qq(e,SS,!1),Ct.bind(s,"change",(function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value})),t.appendChild(s),t.appendChild(r),t.appendChild(i),t.appendChild(n),t.appendChild(a),_S){var o=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(Wb(e,"isLocal"))&&l.setAttribute("checked","checked"),gAe(e,o),Ct.bind(l,"change",(function(){e.useLocalStorage=!e.useLocalStorage,gAe(e,o)}))}var h=document.getElementById("dg-new-constructor");Ct.bind(h,"keydown",(function(e){e.metaKey&&(67===e.which||67===e.keyCode)&&TS.hide()})),Ct.bind(r,"click",(function(){h.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),TS.show(),h.focus(),h.select()})),Ct.bind(i,"click",(function(){e.save()})),Ct.bind(n,"click",(function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)})),Ct.bind(a,"click",(function(){e.revert()}))}function v3t(e){var t=void 0;function r(r){return r.preventDefault(),e.width+=t-r.clientX,e.onResize(),t=r.clientX,!1}function i(){Ct.removeClass(e.__closeButton,ss.CLASS_DRAG),Ct.unbind(window,"mousemove",r),Ct.unbind(window,"mouseup",i)}function n(n){return n.preventDefault(),t=n.clientX,Ct.addClass(e.__closeButton,ss.CLASS_DRAG),Ct.bind(window,"mousemove",r),Ct.bind(window,"mouseup",i),!1}e.__resize_handle=document.createElement("div"),Qt.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),Ct.bind(e.__resize_handle,"mousedown",n),Ct.bind(e.__closeButton,"mousedown",n),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function jq(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function bD(e,t){var r={};return Qt.each(e.__rememberedObjects,(function(i,n){var a={},s=e.__rememberedObjectIndecesToControllers[n];Qt.each(s,(function(e,r){a[r]=t?e.initialValue:e.getValue()})),r[n]=a})),r}function y3t(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}function TAe(e){0!==e.length&&d3t.call(window,(function(){TAe(e)})),Qt.each(e,(function(e){e.updateDisplay()}))}ss.toggleHide=function(){Uq=!Uq,Qt.each(EAe,(function(e){e.domElement.style.display=Uq?"none":""}))},ss.CLASS_AUTO_PLACE="a",ss.CLASS_AUTO_PLACE_CONTAINER="ac",ss.CLASS_MAIN="main",ss.CLASS_CONTROLLER_ROW="cr",ss.CLASS_TOO_TALL="taller-than-window",ss.CLASS_CLOSED="closed",ss.CLASS_CLOSE_BUTTON="close-button",ss.CLASS_CLOSE_TOP="close-top",ss.CLASS_CLOSE_BOTTOM="close-bottom",ss.CLASS_DRAG="drag",ss.DEFAULT_WIDTH=245,ss.TEXT_CLOSED="Close Controls",ss.TEXT_OPEN="Open Controls",ss._keydownHandler=function(e){"text"!==document.activeElement.type&&(e.which===dAe||e.keyCode===dAe)&&ss.toggleHide()},Ct.bind(window,"keydown",ss._keydownHandler,!1),Qt.extend(ss.prototype,{add:function(e,t){return wS(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return wS(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;Qt.defer((function(){t.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&jb.removeChild(this.domElement);var e=this;Qt.each(this.__folders,(function(t){e.removeFolder(t)})),Ct.unbind(window,"keydown",ss._keydownHandler,!1),mAe(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var r=new ss(t);this.__folders[e]=r;var i=Yq(this,r.domElement);return Ct.addClass(i,"folder"),r},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],mAe(e);var t=this;Qt.each(e.__folders,(function(t){e.removeFolder(t)})),Qt.defer((function(){t.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=Ct.getOffset(e.__ul).top,r=0;Qt.each(e.__ul.childNodes,(function(t){e.autoPlace&&t===e.__save_row||(r+=Ct.getHeight(t))})),window.innerHeight-t-fAe<r?(Ct.addClass(e.domElement,ss.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-fAe+"px"):(Ct.removeClass(e.domElement,ss.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&Qt.defer((function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:Qt.debounce((function(){this.onResize()}),50),remember:function(){if(Qt.isUndefined(TS)&&((TS=new f3t).domElement.innerHTML=c3t),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;Qt.each(Array.prototype.slice.call(arguments),(function(t){0===e.__rememberedObjects.length&&g3t(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)})),this.autoPlace&&jq(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=bD(this)),e.folders={},Qt.each(this.__folders,(function(t,r){e.folders[r]=t.getSaveObject()})),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=bD(this),Gq(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[SS]=bD(this,!0)),this.load.remembered[e]=bD(this),this.preset=e,qq(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){Qt.each(this.__controllers,(function(t){this.getRoot().load.remembered?_Ae(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}),this),Qt.each(this.__folders,(function(e){e.revert(e)})),e||Gq(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&TAe(this.__listening)},updateDisplay:function(){Qt.each(this.__controllers,(function(e){e.updateDisplay()})),Qt.each(this.__folders,(function(e){e.updateDisplay()}))}});var wAe=ss,SAe=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Df=(()=>{if("undefined"==typeof document)return!1;let e=SAe[0],t={};for(let r of SAe)if((null==r?void 0:r[1])in document){for(let[i,n]of r.entries())t[e[i]]=n;return t}return!1})(),MAe={change:Df.fullscreenchange,error:Df.fullscreenerror},zl={request:(e=document.documentElement,t)=>new Promise(((r,i)=>{let n=()=>{zl.off("change",n),r()};zl.on("change",n);let a=e[Df.requestFullscreen](t);a instanceof Promise&&a.then(n).catch(i)})),exit:()=>new Promise(((e,t)=>{if(!zl.isFullscreen)return void e();let r=()=>{zl.off("change",r),e()};zl.on("change",r);let i=document[Df.exitFullscreen]();i instanceof Promise&&i.then(r).catch(t)})),toggle:(e,t)=>zl.isFullscreen?zl.exit():zl.request(e,t),onchange(e){zl.on("change",e)},onerror(e){zl.on("error",e)},on(e,t){let r=MAe[e];r&&document.addEventListener(r,t,!1)},off(e,t){let r=MAe[e];r&&document.removeEventListener(r,t,!1)},raw:Df};Object.defineProperties(zl,{isFullscreen:{get:()=>Boolean(document[Df.fullscreenElement])},element:{enumerable:!0,get:()=>{var e;return null!=(e=document[Df.fullscreenElement])?e:void 0}},isEnabled:{enumerable:!0,get:()=>Boolean(document[Df.fullscreenEnabled])}}),Df||(zl={isEnabled:!1});var _D=zl,TD=new F,wD=class{constructor(e,t,r=void 0){this.scale=1,this.explodeUp=!1,this.scene=e,this.objectId=t,t||de.debug(`[EXP] Invalid objectId: ${t}`),r?this.explodeCenter=r:(this.explodeCenter=new F,this.getObjectCenter(this.explodeCenter));let i=this.scene.getObjectById(this.objectId);null==i||i.updateWorldMatrix(!0,!0)}explode(e){if(this.scale=e,!this.objectId||!this.explodeCenter||!this.scale)return void de.debug(`[EXP] Invalid objectId: ${this.objectId}, or position: ${this.explodeCenter}, or this.power: ${this.scale}`);let t=this.scene.getObjectById(this.objectId);t&&t.children?(de.debug(`[EXP] Exploding object '${t.name}'(id: ${t.id}) at: ${Ut.vectorToString(this.explodeCenter)}`),this.explodeObject(t)):de.debug("[EXP] No children to explode!")}explodeObject(e){e.geometry?this.explodeLeafObject(e):e.children.length>0?e.children.forEach((e=>this.explodeObject(e))):this.explodeLeafObject(e)}explodeLeafObject(e){var t;let r=e;if(!r.geometry)return;r.userData.originalMatrixWorld||(r.userData.originalMatrixWorld=r.matrixWorld);let i=r.userData.originalMatrixWorld;r.userData.originalCenter||(r.geometry.boundingBox||r.geometry.computeBoundingBox(),TD.set(0,0,0),null==(t=r.geometry.boundingBox)||t.getCenter(TD),TD.applyMatrix4(r.matrixWorld),r.userData.originalCenter=TD.clone());let n=r.userData.originalCenter.clone();n.sub(this.explodeCenter),n.multiplyScalar(this.scale-1),this.explodeUp&&(n.setX(0),n.setZ(0));let a=new lt;a.setPosition(n),a.multiply(i),r.matrixWorld=a,r.children.length>0&&r.children.forEach((e=>e.updateMatrix()))}unexplode(){let e=this.scene.getObjectById(this.objectId);e&&e.children?(de.debug(`[EXP] Unexploding '${e.name}'(id: ${e.id}) at: ${Ut.vectorToString(this.explodeCenter)}`),this.unexplodeObject(e)):de.debug("[EXP] No children to explode!")}unexplodeObject(e){e.geometry?this.unexplodeLeafObject(e):e.children.length>0?e.children.forEach((e=>this.unexplodeObject(e))):this.unexplodeLeafObject(e)}unexplodeLeafObject(e){let t=e.userData.originalMatrixWorld;t&&(e.matrixWorld=t,e.children.length>0&&e.children.forEach((e=>e.updateMatrix())))}setExplodeUp(e){this.explodeUp=e}getObjectCenter(e){let t=new Vt;if(!this.objectId)return void de.debug(`[EXP] Invalid objectId: ${this.objectId}`);let r=this.scene.getObjectById(this.objectId);r&&r.children?(r.traverse((e=>{t.expandByObject(e)})),t.getCenter(e)):de.debug("[EXP] No children to explode!")}},$q=class extends vn{constructor(e,t){super(e,{id:(null==t?void 0:t.id)||$q.DEFAULT_ID}),this.exploders=[],this.onModelLoaded=()=>{this.init()},this.viewer=e,this.cfg=t||{},this.viewer.addEventListener("modelload",this.onModelLoaded)}get scene(){return this.viewer.scene}init(){this.viewer.loadedModels.forEach((e=>{if(this.hasExploderForModel(e.getModelObject().id))return;let t=new F;if(this.cfg.explodeCenter){let e=this.cfg.explodeCenter;t.set(e.x,e.y,e.z)}else!this.cfg.explodeCenter&&!e.getBBox().isEmpty()&&e.getBBox().getCenter(t);let r=new wD(this.scene,e.getModelObject().id,t);r.setExplodeUp(!!this.cfg.explodeUp),this.exploders.push(r)}))}explode(e){0===this.exploders.length&&this.init();for(let t of this.exploders)t.explode(e),this.viewer.enableRender()}unexplode(){for(let e of this.exploders)e.unexplode(),this.viewer.enableRender()}hasExploderForModel(e){return!!this.exploders.find((t=>t.objectId===e))}destroy(){super.destroy(),this.viewer.removeEventListener("modelload",this.onModelLoaded),this.unexplode()}},MS=$q;MS.DEFAULT_ID="ExplodePlugin";var Zq=class extends vn{constructor(e,t){super(e,{id:(null==t?void 0:t.id)||Zq.DEFAULT_ID}),this.NAME="GROUND_GRASS",this.DEFAULT_SIZE=1e3,this.DEFAULT_REPEAT=20,this.onModelLoaded=()=>{!1!==this.cfg.visible&&(this.init(),this.viewer.enableRender())},this.cfg=t||{},!1!==this.cfg.visible&&this.init(),this.viewer.addEventListener("modelload",this.onModelLoaded)}init(){var e;this.groundGrass&&(null==(e=this.viewer.scene)||e.remove(this.groundGrass),this.groundGrass=void 0);let t=this.cfg.texture||"images/terrain/grass.jpg",r=this.cfg.width||this.DEFAULT_SIZE,i=this.cfg.height||this.DEFAULT_SIZE,n=this.cfg.repeatX||this.DEFAULT_REPEAT,a=this.cfg.repeatY||this.DEFAULT_REPEAT,s=new F,o=this.viewer.getBBox();o&&o.getCenter(s),bt(this,null,(function*(){var e;this.groundGrass=yield this.createGrassGround(t,r,i,n,a),null==(e=this.viewer.scene)||e.add(this.groundGrass),this.viewer.enableRender()}))}setVisible(e){e&&!this.groundGrass&&this.init(),this.groundGrass&&(this.groundGrass.visible=e),this.viewer.enableRender()}createGrassGround(e,t,r,i,n){return bt(this,null,(function*(){return new Promise((a=>{(new Ds).load(e,(e=>{e.wrapS=e.wrapT=ui,e.repeat.set(i,n),e.anisotropy=16,e.encoding=ph;let s=new Th({map:e});s.side=zi;let o=new Ht(new vs(t,r),s);return o.rotation.x=-Math.PI/2,o.position.y=0,o.receiveShadow=!0,o.name=this.NAME,o.layers.enableAll(),o.layers.disable(12),o.matrixAutoUpdate=!1,o.updateMatrix(),o.updateMatrixWorld(!0),a(o)}))}))}))}destroy(){super.destroy(),this.groundGrass&&(this.groundGrass.removeFromParent(),this.groundGrass.geometry.dispose(),this.groundGrass.clear(),this.groundGrass=void 0),this.viewer.removeEventListener("modelload",this.onModelLoaded)}},AS=Zq;AS.DEFAULT_ID="GroundGrassPlugin";var Kq=class extends vn{constructor(e,t){super(e,{id:(null==t?void 0:t.id)||Kq.DEFAULT_ID}),this.NAME="GROUND_GRID",this.DEFAULT_SIZE=1e3,this.DEFAULT_DIVISIONS=100,this.DEFAULT_MAT_PARAMS={color:12829635,transparent:!0,opacity:.5,wireframeLinewidth:.5},this.onModelLoaded=()=>{!1!==this.cfg.visible&&(this.init(),this.viewer.enableRender())},this.cfg=t||{},!1!==this.cfg.visible&&this.init(),this.viewer.addEventListener("modelload",this.onModelLoaded)}init(){var e,t;this.gridHelper&&(null==(e=this.viewer.scene)||e.remove(this.gridHelper),this.gridHelper=void 0);let r=this.cfg.size,i=this.cfg.divisions,n=new F,a=this.viewer.getBBox();a&&a.getCenter(n),this.gridHelper=this.createGroundGrid(r,i,n),null==(t=this.viewer.scene)||t.add(this.gridHelper),this.viewer.enableRender()}setVisible(e){e&&!this.gridHelper&&this.init(),this.gridHelper&&(this.gridHelper.visible=e),this.viewer.enableRender()}createGroundGrid(e,t,r){e=e||this.DEFAULT_SIZE,t=t||this.DEFAULT_DIVISIONS;let i=new z_(e,t);r?i.position.set(r.x,r.y,r.z):i.position.y=0;let n=i.material;return Array.isArray(n)||(n.opacity=this.DEFAULT_MAT_PARAMS.opacity,n.transparent=this.DEFAULT_MAT_PARAMS.transparent),i.name=this.NAME,i.layers.enableAll(),i.layers.disable(12),i.matrixAutoUpdate=!1,i.updateMatrix(),i}destroy(){super.destroy(),this.gridHelper&&(this.gridHelper.removeFromParent(),this.gridHelper.geometry.dispose(),this.gridHelper.clear(),this.gridHelper=void 0),this.viewer.removeEventListener("modelload",this.onModelLoaded)}},RS=Kq;RS.DEFAULT_ID="GroundGridPlugin";var x3t=(e=>(e.Default="Default",e.BoxSelection="BoxSelection",e.PickMarkup="PickMarkup",e))(x3t||{}),Jq=class extends vn{constructor(e,t){super(e,{id:(null==t?void 0:t.id)||Jq.DEFAULT_ID}),this.originalBackground=void 0,this.originalClearAlpha=1,this.cfg=t||{},this.cfg.type=this.cfg.type||"image/png",this.cfg.quality=this.cfg.quality||.8,this.cfg.setBackgroundTransparent=this.cfg.setBackgroundTransparent||!1}getScreenshot(){var e;let t=null==(e=this.viewer.renderer)?void 0:e.domElement;if(!t)return;this.setBackgroundTransparent();let r=t.toDataURL(this.cfg.type,this.cfg.quality);return this.recoverBackgroundTransparency(),r}getScreenshotByScreenBBox(e){return bt(this,null,(function*(){let t=this.viewer.renderer.domElement,r=t.width,i=t.height,n=e.min.x,a=e.min.y,s=e.max.x,o=e.max.y;if(n=Math.max(n,0),n=Math.min(n,r),a=Math.max(a,0),a=Math.min(a,i),s=Math.min(s||r,r),s=Math.max(s,0),o=Math.min(o||i,i),o=Math.max(o,0),0===Math.abs(s-n)||0===Math.abs(o-a))return void de.error(`[Screenshot] Invalid input, minX: ${n}, minY: ${a}, maxX: ${s}, maxY: ${o}`);let l=new ts;l.expandByPoint(new Te(n,a)),l.expandByPoint(new Te(s,o)),this.setBackgroundTransparent();let h=yield Ut.canvasToImage(t);this.recoverBackgroundTransparency();let c=document.createElement("canvas");c.width=t.width,c.height=t.height;let u=window.devicePixelRatio,d=c.getContext("2d");return d.drawImage(h,0,0,h.width/u,h.height/u),Ut.renderingContextToImage(d,l,this.cfg.type,this.cfg.quality)}))}getScreenshotByWorldBBox(e){return bt(this,null,(function*(){let t=this.viewer.camera,r=this.viewer.container.viewerContainer,i=Nr.worldBBox2Screen(e,t,r);return this.getScreenshotByScreenBBox(i)}))}getScreenshotAsync(){return bt(this,arguments,(function*(e="BoxSelection"){this.cancel();let t,r=this.viewer,i=r.renderer.domElement;if("PickMarkup"===e?(this.pickMarkupHelper||(this.pickMarkupHelper=new II(r)),t=yield this.pickMarkupHelper.pick()):"BoxSelection"===e&&(this.boxSelectHelper||(this.boxSelectHelper=new rm(r)),t=yield this.boxSelectHelper.select()),"Default"!==e&&!t)return;this.setBackgroundTransparent();let n=yield Ut.canvasToImage(i);this.recoverBackgroundTransparency();let a=document.createElement("canvas"),s=window.devicePixelRatio;a.width=i.width/s,a.height=i.height/s;let o=a.getContext("2d");if(o.drawImage(n,0,0,n.width/s,n.height/s),r.overlayRender){let e=yield r.overlayRender.getImage((e=>e instanceof Jn||e instanceof ns));o.drawImage(e,0,0,e.width/s,e.height/s)}let l=this.cfg.type,h=this.cfg.quality,c=Ut.renderingContextToImage(o,t,l,h);if(r instanceof Em){return{base64Image:c,viewExtent:r.getCurrentViewExtent(),imageType:l}}return{base64Image:c,imageType:l}}))}isActive(){var e,t;return(null==(e=this.boxSelectHelper)?void 0:e.isActive)||(null==(t=this.pickMarkupHelper)?void 0:t.isActive)}cancel(){var e,t;null!=(e=this.boxSelectHelper)&&e.isActive&&this.boxSelectHelper.deactivate(),null!=(t=this.pickMarkupHelper)&&t.isActive&&this.pickMarkupHelper.deactivate()}setBackgroundTransparent(){if(!this.cfg.setBackgroundTransparent)return;let e=this.viewer,t=e.scene,r=e.renderer,i=this.viewer.camera;this.originalBackground=t.background,this.originalClearAlpha=r.getClearAlpha(),t.background=null,r.setClearAlpha(0),r.render(t,i)}recoverBackgroundTransparency(){if(!this.cfg.setBackgroundTransparent)return;let e=this.viewer,t=e.scene,r=e.renderer,i=this.viewer.camera;t.background=this.originalBackground,r.setClearAlpha(this.originalClearAlpha),r.render(t,i),this.originalBackground=void 0,this.originalClearAlpha=1}},Mm=Jq;Mm.DEFAULT_ID="ScreenshotPlugin";var Ua=new F(1,0,0),nd=new F(0,1,0),id=new F(0,0,1),AAe=new F(0,1,0),CS=new lt,Yb=2,ol=class extends Xr{constructor(e=Ua){super(),this.redMaterial=new Mr({color:16711680,depthTest:!1}),this.greenMaterial=new Mr({color:65280,depthTest:!1}),this.blueMaterial=new Mr({color:255,depthTest:!1}),this.highlightMaterial=new Mr({color:16776960,depthTest:!1}),this.pickableMaterial=new Mr({color:9807270,depthTest:!1}),this.initIgnoreClipMaterial(),this.initOrUpdateByAxis(e)}initIgnoreClipMaterial(){[this.redMaterial,this.greenMaterial,this.blueMaterial,this.highlightMaterial,this.pickableMaterial].forEach((e=>{e.onBeforeCompile=function(e,t){e.fragmentShader=e.fragmentShader.replace("#include <clipping_planes_pars_fragment>","").replace("#include <clipping_planes_fragment>",""),e.vertexShader=e.vertexShader.replace("#include <clipping_planes_pars_vertex>","").replace("#include <clipping_planes_vertex>","")}}))}setDirection(e){let t=new dn;t.setFromUnitVectors(Ua,e),this.applyQuaternion(t)}initOrUpdateByAxis(e){this.clear(),[{actionType:"TranslateX",direction:Ua,material:this.redMaterial},{actionType:"TranslateY",direction:nd,material:this.greenMaterial},{actionType:"TranslateZ",direction:id,material:this.blueMaterial}].forEach((t=>{let{actionType:r,direction:i,material:n}=t,a=0===i.angleTo(e)?n:this.pickableMaterial,s=this.createTranslateGizmo(r,i,Yb,a);this.add(s)})),[{actionType:"RotateX",direction:Ua,material:this.redMaterial,degree:90},{actionType:"RotateY",direction:nd,material:this.greenMaterial,degree:90},{actionType:"RotateZ",direction:id,material:this.blueMaterial,degree:90}].forEach((t=>{let{actionType:r,direction:i,material:n,degree:a}=t;if(0!==i.angleTo(e)){let e=this.createRotateGizmo(r,i,Yb,n,a);this.add(e)}})),this.createSphere(1,this.pickableMaterial),this.createSphere(1,this.pickableMaterial,new F(12*Yb,0,0)),this.createSphere(1,this.pickableMaterial,new F(0,12*Yb,0)),this.createSphere(1,this.pickableMaterial,new F(0,0,12*Yb))}createTranslateGizmo(e,t,r,i){let n=t.angleTo(AAe),a=AAe.clone().cross(t);CS.makeRotationAxis(a,n);let s=new gu(r/5,r/5,20*r),o=10*r;s.translate(0,o,0),s.applyMatrix4(CS);let l=new gu(0,r,3*r),h=2*o;l.translate(0,h,0),l.applyMatrix4(CS);let c=qi([l,s]),u=new Ht(c,i);return u.layers.enable(12),u.userData.actionType=e,i===this.pickableMaterial&&u.layers.disable(12),u}createRotateGizmo(e,t,r,i,n){let a=new F(0,0,1),s=t.clone().cross(a),o=t.angleTo(a);CS.makeRotationAxis(s,o);let l=new _p(12*r,r/5,24,36,Tr.degToRad(n));l.applyMatrix4(CS);let h=new Ht(l,i);return h.layers.enable(12),h.userData.actionType=e,h}createSphere(e,t,r=new F){let i=new Al(e,32,16),n=new Ht(i,t);n.position.copy(r),n.layers.disable(12),this.add(n)}setActiveAxis(e){this.initOrUpdateByAxis(e)}createHoverRotateObjectByAxis(e){let t=Ua;switch(e){case"RotateX":t=Ua;break;case"RotateY":t=nd;break;case"RotateZ":t=id}return this.createRotateGizmo("",t,Yb,this.highlightMaterial,360)}setActive(e,t){var r;let i=t.userData.actionType;["RotateX","RotateY","RotateZ"].includes(i)?e?(this.hoverObject=this.createHoverRotateObjectByAxis(i),this.add(this.hoverObject),t.visible=!1):(null==(r=this.hoverObject)||r.removeFromParent(),t.visible=!0,this.hoverObject=void 0):e?(this.originalMaterial=t.material,t.material=this.highlightMaterial):this.originalMaterial&&(t.material=this.originalMaterial)}adjustSize(e){let t=new F;this.getWorldPosition(t);let r=e.position,i=1;e instanceof Gi?i=(e.top-e.bottom)/e.zoom:e instanceof ci&&(i=t.distanceTo(r)*Math.min(1.9*Math.tan(Math.PI*e.fov/360)/e.zoom,7)),this.scale.set(1,1,1).multiplyScalar(i/180),this.updateWorldMatrix(!0,!0)}},Am=class{constructor(e,t){this.raycaster=new vu,this.sectionBox=new Vt,this.lastWorldPos=new F,this.mouseMoved=!1,this.dragStarted=!1,this.refrencePlane=new ii,this.active=!1,this.capsVisibility=!1,this.capsWireframeMaterial=new Mr({color:16777044,side:ln,transparent:!1}),this.showSectionPlane=!1,this.mousedown=e=>{if(0===e.button){if(!this.selectedObject){let t=this.getIntersection(e);if(!t)return;this.activateSelectedObject(!1),this.selectedObject=t.object}this.inputManager.setCursor("grabbing"),this.dragStarted=!0,this.setControlsEnabled(!1),this.onDragStart(e),this.viewer.enableRender()}},this.mousemove=e=>{var t;if(this.dragStarted)this.updateRaycasterByMouse(e),this.onDragMove(e);else{this.activateSelectedObject(!1),this.selectedObject=void 0;let r=this.getIntersection(e),i="default";r&&r.object.visible&&null!=(t=r.object.parent)&&t.visible&&(this.selectedObject=r.object,this.activateSelectedObject(!0),i="grab"),this.inputManager.setCursor(i)}this.viewer.enableRender()},this.mouseup=e=>{0===e.button&&(this.dragStarted&&(this.onDragEnd(e),this.setControlsEnabled(!0)),this.dragStarted=!1,this.activateSelectedObject(!1),this.selectedObject=void 0,this.inputManager.setCursor("default"))},this.keydown=e=>{"Escape"===e.code&&this.deactivate()},this.viewer=e,this.inputManager=t,this.scene=e.scene,this.renderer=e.renderer,this.raycaster.layers.set(12),this.capsScene=new Xi,this.capsScene.matrixAutoUpdate=!0,this.capsScene.matrixWorldAutoUpdate=!0}get canvas(){var e;return null==(e=this.viewer.renderer)?void 0:e.domElement}get isActive(){return!!this.active}get camera(){return this.viewer.camera}setGlobalClippingEnabled(e){if(!this.clipPlanes)return;let t=e?this.clipPlanes:[];this.viewer.setGlobalClipPlanes(t)}setObjectClippingEnabled(e){var t,r;if(!this.clipPlanes||null==(t=this.clippingObjetIds)||!t.length)return;this.renderer.localClippingEnabled=e;let i=e?this.clipPlanes:[];null==(r=this.clippingObjetIds)||r.forEach((e=>{let t=this.scene.getObjectById(e);t&&t.traverse((e=>{e.material&&(Array.isArray(e.material)?e.material.forEach((e=>{e.clippingPlanes=i,e.clipIntersection=!1})):e.material&&(e.material.clippingPlanes=i,e.material.clipIntersection=!1))}))}))}clearClippingObjectIds(){this.setObjectClippingEnabled(!1),this.clippingObjetIds=[]}setClippingEnabled(e){var t;null!=(t=this.clippingObjetIds)&&t.length?(this.setGlobalClippingEnabled(!1),this.setObjectClippingEnabled(e)):this.setGlobalClippingEnabled(e)}activate(){if(this.inputManager.addEventListener("pointerdown",this.mousedown),this.inputManager.addEventListener("pointermove",this.mousemove),this.inputManager.addEventListener("pointerup",this.mouseup),this.inputManager.addEventListener("keydown",this.keydown),this.sectionBox.isEmpty()){let e=this.viewer.getBBox();e&&this.sectionBox.copy(e)}this.active=!0}deactivate(e=!1){var t;this.inputManager.removeEventListener("pointerdown",this.mousedown),this.inputManager.removeEventListener("pointermove",this.mousemove),this.inputManager.removeEventListener("pointerup",this.mouseup),this.inputManager.removeEventListener("keydown",this.keydown),e||this.setClippingEnabled(!1),null==(t=this.selectedObject)||t.removeFromParent(),this.selectedObject=void 0,this.dragStarted=!1,this.active=!1,this.inputManager.setCursor("default"),this.setControlsEnabled(!0)}setCapsVisible(e){this.capsVisibility=e}getCapsVisible(){return this.capsVisibility}setControlsEnabled(e){this.viewer.enableRotate(e)}getIntersection(e){if(!this.raycaster)return;this.updateRaycasterByMouse(e);let t=this.raycaster.intersectObjects(this.getIntersectObjects())||[];return t.find((e=>e.object&&e.object.parent instanceof ol))||t[0]}updateRaycasterByMouse(e){if(!this.raycaster)return;let t=new Te(e.x,e.y),r=Nr.screen2Ndc(t,this.camera,this.canvas);this.raycaster.setFromCamera(r,this.camera)}destroy(){this.deactivate()}},CAe=new Vt,PAe=new dn,SD=class extends Ht{constructor(e,t){super(),this.vertices=[],this.layers.enable(12),this.actionType=e,this.geometry=new Nt,this.vertices=t,this.geometry.setFromPoints(t),this.geometry.setAttribute("uv",new zt([0,1,1,1,0,0,1,0],2)),this.geometry.setIndex([0,1,2,0,2,3]),this.material=new Mr({depthTest:!1,color:SD.normalPlaneColor,transparent:!0,opacity:.01,side:ln}),this.createIgnoreClipMaterials(this.material),this.geometry.computeVertexNormals(),this.edge=this.createEdge(t),this.add(this.edge)}createIgnoreClipMaterials(e){e.onBeforeCompile=function(e,t){e.fragmentShader=e.fragmentShader.replace("#include <clipping_planes_pars_fragment>","").replace("#include <clipping_planes_fragment>",""),e.vertexShader=e.vertexShader.replace("#include <clipping_planes_pars_vertex>","").replace("#include <clipping_planes_vertex>","")}}createEdge(e){let t=new Nt;t.setFromPoints(e),t.setIndex([0,1,1,2,2,3,3,0]);let r=new Yr({color:SD.normalLineColor});return this.createIgnoreClipMaterials(r),new jn(t,r)}createLine(){var e;null==(e=this.wireframe)||e.removeFromParent();let t=this.vertices[0].distanceTo(this.vertices[1]),r=this.vertices[1].distanceTo(this.vertices[2]),i=[];for(let e=.5*t,n=.5*r,a=1;a<t+r;a+=1){let s,o;a<r?(s=this.vertices[1].clone().sub(this.vertices[2]).normalize().multiplyScalar(-n+a),s.add(this.vertices[1].clone().sub(this.vertices[0]).normalize().multiplyScalar(-e))):(s=this.vertices[1].clone().sub(this.vertices[2]).normalize().multiplyScalar(n),s.add(this.vertices[2].clone().sub(this.vertices[3]).normalize().multiplyScalar(a-r-e))),a<t?(o=this.vertices[1].clone().sub(this.vertices[2]).normalize().multiplyScalar(-n),o.add(this.vertices[1].clone().sub(this.vertices[0]).normalize().multiplyScalar(-e+a))):(o=this.vertices[0].clone().sub(this.vertices[3]).normalize().multiplyScalar(a-t-n),o.add(this.vertices[2].clone().sub(this.vertices[3]).normalize().multiplyScalar(e))),i.push(s),i.push(o)}let n=(new Nt).setFromPoints(i),a=new Yr({color:0,transparent:!1});this.createIgnoreClipMaterials(a);let s=new Wn(n,a);s.position.copy(this.vertices[0].clone().add(this.vertices[2]).multiplyScalar(.5)),s.position.add(this.getPlaneNormal().multiplyScalar(.1)),s.updateMatrix(),s.updateMatrixWorld(),this.add(s),this.wireframe=s}update(e){this.geometry.setFromPoints(e),this.geometry.computeBoundingSphere(),this.geometry.computeVertexNormals(),this.edge.geometry.setFromPoints(e),this.vertices=e,this.wireframe&&this.createLine()}rotatePlane(e,t){let r=this.getPlaneCenter();PAe.setFromAxisAngle(e,t),this.vertices=this.vertices.map((e=>e.sub(r).applyQuaternion(PAe).add(r))),this.update(this.vertices)}setDirection(e){let t=new dn;t.setFromUnitVectors(Ua,e);let r=this.getPlaneCenter();this.vertices=this.vertices.map((e=>e.sub(r).applyQuaternion(t).add(r))),this.update(this.vertices)}getPlaneNormal(){let[e,t,r]=this.vertices,i=new F;return yi.getNormal(e,t,r,i),i}setActive(e){this.material.opacity=e?.1:.01}getPlaneCenter(){CAe.setFromPoints(this.vertices);let e=new F;return CAe.getCenter(e),e}},Vi=SD;Vi.normalPlaneColor=new dt(0,.855,.718),Vi.activePlaneColor=new dt(1,1,0),Vi.normalLineColor=16777215;var IAe=(e=>(e.X="X",e.Y="Y",e.Z="Z",e))(IAe||{}),MD=class extends Am{constructor(e,t){super(e,t),this.activeAxis="X",this.mousedown=e=>{if(0===e.button){if(!this.selectedObject){let t=this.getIntersection(e);if(!t)return;this.activateSelectedObject(!1),this.selectedObject=t.object}this.selectedObject.parent instanceof ol&&(this.inputManager.setCursor("grabbing"),this.dragStarted=!0,this.setControlsEnabled(!1),this.onDragStart(e),this.viewer.enableRender())}},this.mousemove=e=>{var t;if(this.dragStarted)this.updateRaycasterByMouse(e),this.onDragMove(e);else{this.activateSelectedObject(!1),this.selectedObject=void 0;let r=this.getIntersection(e),i="default";r&&r.object.visible&&null!=(t=r.object.parent)&&t.visible&&(this.selectedObject=r.object,this.activateSelectedObject(!0),this.selectedObject.parent instanceof ol&&(i="grab")),this.inputManager.setCursor(i)}this.viewer.enableRender()},this.center=new F,this.axisInfoMap={X:{normal:new F(1,0,0)},Y:{normal:new F(0,1,0)},Z:{normal:new F(0,0,1)}},this.showSectionPlane=!0,this.viewer.addEventListener("beforerender",(()=>{var e,t;this.isActive&&(null==(e=this.gizmo)||e.adjustSize(this.camera),null==(t=this.planeMesh)||t.updateWorldMatrix(!0,!0))}))}activate(e="X",t){super.activate(),this.setActiveAxis(e,t)}deactivate(e=!1){var t,r;super.deactivate(e),null==(t=this.planeMesh)||t.removeFromParent(),null==(r=this.gizmo)||r.removeFromParent(),this.planeMesh=void 0,this.gizmo=void 0}reset(){var e,t;null==(e=this.planeMesh)||e.removeFromParent(),null==(t=this.gizmo)||t.removeFromParent(),this.setClippingEnabled(!1),this.planeMesh=void 0,this.gizmo=void 0,this.setActiveAxis(this.activeAxis)}setActiveAxis(e,t){this.activeAxis=e,this.sectionBox&&this.sectionBox.getCenter(this.center),this.clipPlaneConstant=t,this.initOrUpdateGizmo(),this.initOrUpdateSectionPlaneMeshes(),this.initOrUpdateClipPlanes(),this.setClippingEnabled(!0),this.clipPlaneConstant=void 0,this.viewer.enableRender()}setSectionPlaneVisible(e){this.gizmo&&this.planeMesh&&(this.gizmo.visible=e,this.planeMesh.visible=e),this.showSectionPlane=e,this.viewer.enableRender()}initOrUpdateClipPlanes(){switch(this.activeAxis){case"X":{let e=this.clipPlaneConstant||this.center.x;this.clipPlane=new ii(new F(-1,0,0),e);break}case"Y":{let e=this.clipPlaneConstant||this.center.y;this.clipPlane=new ii(new F(0,-1,0),e);break}case"Z":{let e=this.clipPlaneConstant||this.center.z;this.clipPlane=new ii(new F(0,0,-1),e);break}}this.clipPlane&&(this.clipPlanes=[this.clipPlane])}initOrUpdateSectionPlaneMeshes(){var e;let t=new F;this.sectionBox.getSize(t);let r=t.length(),i=this.center.clone();this.adjustPositionByClipPlaneConstant(i);let n=(new Vt).setFromCenterAndSize(i,new F(r,r,r)),{min:a,max:s}=n;switch(null==(e=this.planeMesh)||e.removeFromParent(),this.activeAxis){case"X":this.planeMesh=new Vi("X",[new F(i.x,s.y,a.z),new F(i.x,s.y,s.z),new F(i.x,a.y,s.z),new F(i.x,a.y,a.z)]);break;case"Y":this.planeMesh=new Vi("Y",[new F(s.x,i.y,a.z),new F(a.x,i.y,a.z),new F(a.x,i.y,s.z),new F(s.x,i.y,s.z)]);break;case"Z":this.planeMesh=new Vi("Z",[new F(s.x,s.y,i.z),new F(a.x,s.y,i.z),new F(a.x,a.y,i.z),new F(s.x,a.y,i.z)])}this.planeMesh&&(this.planeMesh.visible=this.showSectionPlane,this.scene.add(this.planeMesh)),this.createCapsWireframe(),this.viewer.enableRender()}createCapsWireframe(){var e;if(!this.planeMesh)return;let{actionType:t,vertices:r}=this.planeMesh;null==(e=this.capsWireframe)||e.removeFromParent(),this.capsWireframe=new Vi(t,r);let i=this.capsWireframeMaterial;this.capsWireframe.createIgnoreClipMaterials(i),this.capsWireframe.material=i,this.capsWireframe.createLine(),this.setCapsVisible(!1),this.capsScene.add(this.capsWireframe)}initOrUpdateGizmo(){var e,t;null==(e=this.gizmo)||e.removeFromParent();let r=this.axisInfoMap[this.activeAxis].normal,i=new ol;i.setDirection(r),this.sectionBox.getCenter(i.position),this.adjustPositionByClipPlaneConstant(i.position),i.adjustSize(this.camera),i.visible=this.showSectionPlane,null==(t=this.scene)||t.add(i),this.gizmo=i}onDragStart(e){var t;if(this.selectedObject instanceof Vi)return;de.info("[Section] onDragStart:",e);let r=new F;this.sectionBox.getCenter(r),this.refrencePlane.setFromNormalAndCoplanarPoint(this.camera.getWorldDirection(this.refrencePlane.normal),r),null==(t=this.raycaster)||t.ray.intersectPlane(this.refrencePlane,this.lastWorldPos)}onDragMove(e){var t,r,i,n,a,s,o;if(!this.lastWorldPos||!this.selectedObject||!this.clipPlane||!this.planeMesh||!this.gizmo||this.selectedObject&&this.selectedObject instanceof Vi)return;let l=new F;null==(t=this.raycaster)||t.ray.intersectPlane(this.refrencePlane,l);let h=this.selectedObject.userData.actionType,c=(new F).subVectors(this.lastWorldPos,this.center).normalize(),u=(new F).subVectors(l,this.center).normalize(),d=(new F).subVectors(l,this.lastWorldPos).projectOnVector(Ua.clone().applyQuaternion(this.gizmo.quaternion)),p=c.angleTo(u),f=(new F).crossVectors(c,u),m=new F;this.sectionBox.getSize(m);let g,v=Math.max(m.x,m.y,m.z);switch(h){case"TranslateX":case"TranslateY":case"TranslateZ":g=(new F).addVectors(this.gizmo.position,d),this.sectionBox.clone().setFromCenterAndSize(this.center,new F(v,v,v)).containsPoint(g)&&(null==(r=this.gizmo)||r.position.add(d),null==(i=this.planeMesh)||i.position.add(d),null==(n=this.capsWireframe)||n.position.add(d));break;case"RotateX":{let e=Ua.clone().applyQuaternion(this.gizmo.quaternion);f.dot(e)<0&&(p=-p),this.gizmo.rotateX(p),this.planeMesh.rotatePlane(e,p),null==(a=this.capsWireframe)||a.rotatePlane(e,p)}break;case"RotateY":{let e=nd.clone().applyQuaternion(this.gizmo.quaternion);f.dot(e)<0&&(p=-p),this.gizmo.rotateY(p),this.planeMesh.rotatePlane(e,p),null==(s=this.capsWireframe)||s.rotatePlane(e,p)}break;case"RotateZ":{let e=id.clone().applyQuaternion(this.gizmo.quaternion);f.dot(e)<0&&(p=-p),this.gizmo.rotateZ(p),this.planeMesh.rotatePlane(e,p),null==(o=this.capsWireframe)||o.rotatePlane(e,p)}}this.clipPlane.setFromNormalAndCoplanarPoint(this.planeMesh.getPlaneNormal().negate(),this.gizmo.position),this.lastWorldPos=l}onDragEnd(e){this.selectedObject instanceof Vi||de.info("[Section] onDragEnd:",e)}getIntersectObjects(){return this.planeMesh&&this.gizmo?[this.planeMesh,this.gizmo]:[]}activateSelectedObject(e){this.selectedObject&&(this.selectedObject instanceof Vi?this.selectedObject.setActive(e):this.selectedObject.parent instanceof ol&&this.selectedObject.parent.setActive(e,this.selectedObject))}adjustPositionByClipPlaneConstant(e){null!=this.clipPlaneConstant&&("X"===this.activeAxis?e.setX(this.clipPlaneConstant):"Y"===this.activeAxis?e.setY(this.clipPlaneConstant):"Z"===this.activeAxis&&e.setZ(this.clipPlaneConstant))}},AD=class extends Am{constructor(e,t){super(e,t),this.sectionRange={}}activate(){super.activate();let e=this.viewer.getBBox();if(e){let{min:t,max:r}=e;this.sectionRange={x:[t.x,r.x],y:[t.y,r.y],z:[t.z,r.z]}}this.initOrUpdateClipPlanes(),this.initOrUpdateVertices(),this.initOrUpdateSectionPlaneMeshes(),this.initOrUpdateCapsWireframes(),this.setCapsVisible(!1),this.setClippingEnabled(!0)}deactivate(e=!1){super.deactivate(e),this.planeMeshes&&this.scene.remove(...this.planeMeshes),this.capsWireframes&&this.capsScene.remove(...this.capsWireframes),this.planeMeshes=void 0,this.capsWireframes=void 0}initOrUpdateVertices(){if(!this.sectionBox)return;let{min:e,max:t}=this.sectionBox;this.vertices=[new F(t.x,t.y,t.z),new F(e.x,t.y,t.z),new F(e.x,e.y,t.z),new F(t.x,e.y,t.z),new F(t.x,t.y,e.z),new F(e.x,t.y,e.z),new F(e.x,e.y,e.z),new F(t.x,e.y,e.z)]}initOrUpdateClipPlanes(){let{min:e,max:t}=this.sectionBox;this.clipPlanes?(this.clipPlanes[0].constant=t.x,this.clipPlanes[1].constant=-e.x,this.clipPlanes[2].constant=t.y,this.clipPlanes[3].constant=-e.y,this.clipPlanes[4].constant=t.z,this.clipPlanes[5].constant=-e.z):this.clipPlanes=[new ii(new F(-1,0,0),t.x),new ii(new F(1,0,0),-e.x),new ii(new F(0,-1,0),t.y),new ii(new F(0,1,0),-e.y),new ii(new F(0,0,-1),t.z),new ii(new F(0,0,1),-e.z)]}initOrUpdateSectionPlaneMeshes(){let e=this.vertices;if(e){if(this.planeMeshes)this.planeMeshes[0].update([e[4],e[0],e[3],e[7]]),this.planeMeshes[1].update([e[1],e[5],e[6],e[2]]),this.planeMeshes[2].update([e[4],e[5],e[1],e[0]]),this.planeMeshes[3].update([e[6],e[7],e[3],e[2]]),this.planeMeshes[4].update([e[0],e[1],e[2],e[3]]),this.planeMeshes[5].update([e[5],e[4],e[7],e[6]]);else{let t=[new Vi("Right",[e[4],e[0],e[3],e[7]]),new Vi("Left",[e[1],e[5],e[6],e[2]]),new Vi("Top",[e[4],e[5],e[1],e[0]]),new Vi("Bottom",[e[6],e[7],e[3],e[2]]),new Vi("Front",[e[0],e[1],e[2],e[3]]),new Vi("Back",[e[5],e[4],e[7],e[6]])];this.planeMeshes=t,this.scene.add(...t)}this.viewer.enableRender()}}initOrUpdateCapsWireframes(){let e=this.vertices;if(e){if(this.capsWireframes)this.capsWireframes[0].update([e[4],e[0],e[3],e[7]]),this.capsWireframes[1].update([e[1],e[5],e[6],e[2]]),this.capsWireframes[2].update([e[4],e[5],e[1],e[0]]),this.capsWireframes[3].update([e[6],e[7],e[3],e[2]]),this.capsWireframes[4].update([e[0],e[1],e[2],e[3]]),this.capsWireframes[5].update([e[5],e[4],e[7],e[6]]);else{let t=[this.createCapsWireframe("Right",[e[4],e[0],e[3],e[7]]),this.createCapsWireframe("Left",[e[1],e[5],e[6],e[2]]),this.createCapsWireframe("Top",[e[4],e[5],e[1],e[0]]),this.createCapsWireframe("Bottom",[e[6],e[7],e[3],e[2]]),this.createCapsWireframe("Front",[e[0],e[1],e[2],e[3]]),this.createCapsWireframe("Back",[e[5],e[4],e[7],e[6]])];this.capsWireframes=t,this.capsScene.add(...t)}this.viewer.enableRender()}}createCapsWireframe(e,t){let r=new Vi(e,t);return r.material=this.capsWireframeMaterial,r.createIgnoreClipMaterials(r.material),r.createLine(),r}activateSelectedObject(e){var t;null==(t=this.selectedObject)||t.setActive(e)}onDragStart(e){var t;this.selectedObject&&(de.info("[Section] onDragStart:",e),this.refrencePlane.setFromNormalAndCoplanarPoint(this.camera.getWorldDirection(this.refrencePlane.normal),this.selectedObject.getPlaneCenter()),null==(t=this.raycaster)||t.ray.intersectPlane(this.refrencePlane,this.lastWorldPos))}onDragMove(e){var t;if(!this.lastWorldPos||!this.selectedObject)return;let r=new F;null==(t=this.raycaster)||t.ray.intersectPlane(this.refrencePlane,r);let i=this.selectedObject.actionType;switch(i){case"Top":case"Bottom":this.dragTranslateSectionPlane(nd,this.lastWorldPos,r,i);break;case"Left":case"Right":this.dragTranslateSectionPlane(Ua,this.lastWorldPos,r,i);break;case"Front":case"Back":this.dragTranslateSectionPlane(id,this.lastWorldPos,r,i)}this.lastWorldPos=r}onDragEnd(e){de.info("[Section] onDragEnd:",e)}dragTranslateSectionPlane(e,t,r,i){let n,{min:a,max:s}=this.sectionBox,o=r.clone().sub(t).projectOnVector(e);switch(i){case"Top":n=s.y+o.y,this.isInRange(n,this.sectionRange.y)&&(s.y=n);break;case"Bottom":n=a.y+o.y,this.isInRange(n,this.sectionRange.y)&&(a.y=n);break;case"Left":n=a.x+o.x,this.isInRange(n,this.sectionRange.x)&&(a.x=n);break;case"Right":n=s.x+o.x,this.isInRange(n,this.sectionRange.x)&&(s.x=n);break;case"Front":n=s.z+o.z,this.isInRange(n,this.sectionRange.z)&&(s.z=n);break;case"Back":n=a.z+o.z,this.isInRange(n,this.sectionRange.z)&&(a.z=n)}this.initOrUpdateVertices(),this.initOrUpdateSectionPlaneMeshes(),this.initOrUpdateClipPlanes(),this.initOrUpdateCapsWireframes(),this.viewer.enableRender()}isInRange(e,t){return e>t[0]&&e<t[1]}getIntersection(e){return this.raycaster?(this.updateRaycasterByMouse(e),(this.raycaster.intersectObjects(this.getIntersectObjects())||[])[0]):void 0}getIntersectObjects(){return this.planeMeshes||[]}reset(){this.sectionBox=this.viewer.getBBox(),this.initOrUpdateVertices(),this.initOrUpdateSectionPlaneMeshes(),this.initOrUpdateCapsWireframes(),this.initOrUpdateClipPlanes(),this.viewer.enableRender()}setSectionPlaneVisible(e){var t;null==(t=this.planeMeshes)||t.forEach((t=>t.visible=e)),this.showSectionPlane=e,this.viewer.enableRender()}setCapsVisible(e){var t;super.setCapsVisible(e),null==(t=this.capsWireframes)||t.forEach((t=>{t.visible=e})),this.viewer.enableRender()}},RD=class extends Am{constructor(e,t){super(e,t),this.mousedown=e=>{var t;if(0===e.button){if(!this.pickedFaceInfo){let r=this.pickObject(e);if(!r&&this.lastMouseMoveIntersection&&(r=this.lastMouseMoveIntersection),r&&r.face){let e=r.face.normal,i=new Wr;e.applyNormalMatrix(i.getNormalMatrix(r.object.matrixWorld)),this.pickedFaceInfo={position:r.point,normal:e.normalize()},this.setSection(),null==(t=this.tooltip)||t.hide()}return}if(!this.selectedObject){let t=this.getIntersection(e);if(!t)return;this.activateSelectedObject(!1),this.selectedObject=t.object}this.selectedObject.parent instanceof ol&&(this.inputManager.setCursor("grabbing"),this.dragStarted=!0,this.setControlsEnabled(!1),this.onDragStart(e),this.viewer.enableRender())}},this.mousemove=e=>{var t,r,i;if(!this.pickedFaceInfo){let i=this.pickObject(e);return i?null==(t=this.tooltip)||t.show():null==(r=this.tooltip)||r.hide(),void(this.lastMouseMoveIntersection=i)}if(this.dragStarted)this.updateRaycasterByMouse(e),this.onDragMove(e);else{this.activateSelectedObject(!1),this.selectedObject=void 0;let t=this.getIntersection(e),r="default";t&&t.object.visible&&null!=(i=t.object.parent)&&i.visible&&(this.selectedObject=t.object,this.activateSelectedObject(!0),this.selectedObject.parent instanceof ol&&(r="grab")),this.inputManager.setCursor(r)}this.viewer.enableRender()},this.center=new F,this.viewer.addEventListener("beforerender",(()=>{var e,t,r;this.isActive&&(null==(e=this.gizmo)||e.adjustSize(this.camera),null==(t=this.planeMesh)||t.updateWorldMatrix(!0,!0),null==(r=this.capsWireframe)||r.updateWorldMatrix(!0,!0))}))}activate(){super.activate(),this.sectionBox.getCenter(this.center),this.tooltip=new Dc("pick-section-plane",xn("Tooltip.section"),{parentNode:this.viewer.widgetContainer,followPointer:!0})}deactivate(e=!1){var t,r,i;super.deactivate(e),null==(t=this.planeMesh)||t.removeFromParent(),null==(r=this.gizmo)||r.removeFromParent(),this.planeMesh=void 0,this.gizmo=void 0,this.pickedFaceInfo=void 0,this.lastMouseMoveIntersection=void 0,null==(i=this.tooltip)||i.destroy(),this.tooltip=void 0}setSection(){this.initOrUpdateGizmo(),this.initOrUpdateSectionPlaneMeshes(),this.initOrUpdateClipPlanes(),this.setClippingEnabled(!0),this.viewer.enableRender()}reset(){var e,t,r;null==(e=this.planeMesh)||e.removeFromParent(),null==(t=this.gizmo)||t.removeFromParent(),this.setClippingEnabled(!1),this.planeMesh=void 0,this.gizmo=void 0,this.pickedFaceInfo=void 0,this.lastMouseMoveIntersection=void 0,null==(r=this.tooltip)||r.show(),this.viewer.enableRender()}setSectionPlaneVisible(e){this.gizmo&&this.planeMesh&&(this.gizmo.visible=e,this.planeMesh.visible=e),this.showSectionPlane=e,this.viewer.enableRender()}initOrUpdateClipPlanes(){if(!this.pickedFaceInfo)return;let{normal:e,position:t}=this.pickedFaceInfo;this.clipPlane=(new ii).setFromNormalAndCoplanarPoint(e.clone().negate(),t),this.clipPlane&&(this.clipPlanes=[this.clipPlane])}initOrUpdateSectionPlaneMeshes(){var e;if(!this.pickedFaceInfo)return;let{normal:t,position:r}=this.pickedFaceInfo,i=new F;this.sectionBox.getSize(i);let n=i.length(),a=r,s=(new Vt).setFromCenterAndSize(a,new F(n,n,n)),{min:o,max:l}=s;null==(e=this.planeMesh)||e.removeFromParent(),this.planeMesh=new Vi("Plane",[new F(a.x,l.y,o.z),new F(a.x,l.y,l.z),new F(a.x,o.y,l.z),new F(a.x,o.y,o.z)]),this.planeMesh.setDirection(t),this.planeMesh&&this.scene.add(this.planeMesh),this.createCapsWireframe(),this.viewer.enableRender()}createCapsWireframe(){var e;if(!this.planeMesh)return;let{actionType:t,vertices:r}=this.planeMesh;null==(e=this.capsWireframe)||e.removeFromParent(),this.capsWireframe=new Vi(t,r);let i=this.capsWireframeMaterial;this.capsWireframe.createIgnoreClipMaterials(i),this.capsWireframe.material=i,this.capsWireframe.createLine(),this.setCapsVisible(!1),this.capsWireframe&&this.capsScene.add(this.capsWireframe)}initOrUpdateGizmo(){var e,t;if(!this.pickedFaceInfo)return;null==(e=this.gizmo)||e.removeFromParent();let{normal:r,position:i}=this.pickedFaceInfo,n=new ol;n.setDirection(r),n.position.copy(i),n.adjustSize(this.camera),null==(t=this.scene)||t.add(n),n.updateMatrix(),n.updateMatrixWorld(!0),this.gizmo=n}onDragStart(e){var t;if(!this.pickedFaceInfo||this.selectedObject instanceof Vi)return;de.info("[Section] onDragStart:",e);let{position:r}=this.pickedFaceInfo;this.refrencePlane.setFromNormalAndCoplanarPoint(this.camera.getWorldDirection(this.refrencePlane.normal),r),null==(t=this.raycaster)||t.ray.intersectPlane(this.refrencePlane,this.lastWorldPos)}onDragMove(e){var t,r,i,n,a,s,o;if(!this.lastWorldPos||!this.selectedObject||!this.clipPlane||!this.planeMesh||!this.gizmo||!this.gizmo.visible||!this.pickedFaceInfo||this.selectedObject&&this.selectedObject instanceof Vi)return;let l=new F;null==(t=this.raycaster)||t.ray.intersectPlane(this.refrencePlane,l);let h=this.selectedObject.userData.actionType,{position:c}=this.pickedFaceInfo,u=(new F).subVectors(this.lastWorldPos,c).normalize(),d=(new F).subVectors(l,c).normalize(),p=(new F).subVectors(l,this.lastWorldPos).projectOnVector(Ua.clone().applyQuaternion(this.gizmo.quaternion)),f=u.angleTo(d),m=(new F).crossVectors(u,d),g=new F;this.sectionBox.getSize(g);let v,y=Math.max(g.x,g.y,g.z);switch(h){case"TranslateX":case"TranslateY":case"TranslateZ":v=(new F).addVectors(this.gizmo.position,p),this.sectionBox.clone().setFromCenterAndSize(this.center,new F(y,y,y)).containsPoint(v)&&(null==(r=this.gizmo)||r.position.add(p),null==(i=this.planeMesh)||i.position.add(p),null==(n=this.capsWireframe)||n.position.add(p));break;case"RotateX":{let e=Ua.clone().applyQuaternion(this.gizmo.quaternion);m.dot(e)<0&&(f=-f),this.gizmo.rotateX(f),this.planeMesh.rotatePlane(e,f),null==(a=this.capsWireframe)||a.rotatePlane(e,f)}break;case"RotateY":{let e=nd.clone().applyQuaternion(this.gizmo.quaternion);m.dot(e)<0&&(f=-f),this.gizmo.rotateY(f),this.planeMesh.rotatePlane(e,f),null==(s=this.capsWireframe)||s.rotatePlane(e,f)}break;case"RotateZ":{let e=id.clone().applyQuaternion(this.gizmo.quaternion);m.dot(e)<0&&(f=-f),this.gizmo.rotateZ(f),this.planeMesh.rotatePlane(e,f),null==(o=this.capsWireframe)||o.rotatePlane(e,f)}}this.clipPlane.setFromNormalAndCoplanarPoint(this.planeMesh.getPlaneNormal().negate(),this.gizmo.position),this.lastWorldPos=l}onDragEnd(e){this.selectedObject instanceof Vi||de.info("[Section] onDragEnd:",e)}getIntersectObjects(){return this.planeMesh&&this.gizmo?[this.planeMesh,this.gizmo]:[]}activateSelectedObject(e){this.selectedObject&&(this.selectedObject instanceof Vi?this.selectedObject.setActive(e):this.selectedObject.parent instanceof ol&&this.selectedObject.parent.setActive(e,this.selectedObject))}pickObject(e){let t=new Te(e.x,e.y);return this.viewer.pickObject(t)}setCapsVisible(e){super.setCapsVisible(e),this.capsWireframe&&(this.capsWireframe.visible=e),this.viewer.enableRender()}},Qq=(e=>(e.ObjectsBoxSection="ObjectsBoxSection",e.PickPlaneSection="PickPlaneSection",e.AxisPlaneSection="AxisPlaneSection",e))(Qq||{}),e9=class extends vn{constructor(e){super(e,{id:e9.DEFAULT_ID}),this.sections={},this.lastRenderAutoClear=!0,this.onBeforeRender=()=>{if(!this.activeSectionType)return;let e=this.sections[this.activeSectionType],t=e.capsScene;e.getCapsVisible()&&(this.lastRenderAutoClear=this.viewer.renderer.autoClear,this.render(t))},this.onAfterRender=()=>{this.viewer.renderer.autoClear=this.lastRenderAutoClear},this.viewer=e;let t=e.getInputManager();t&&(this.sections.ObjectsBoxSection=new AD(e,t),this.sections.AxisPlaneSection=new MD(e,t),this.sections.PickPlaneSection=new RD(e,t)),this.createCapStencilMaterials(),this.viewer.addEventListener("beforerender",this.onBeforeRender),this.viewer.addEventListener("afterrender",this.onAfterRender)}get raycaster(){return this.viewer.getRaycaster()}createCapStencilMaterials(){this.backMaterial=new Mr({color:16711680,colorWrite:!1,depthWrite:!1,side:ws}),this.frontMaterial=new Mr({color:255,colorWrite:!1,depthWrite:!1,side:zi})}render(e){let t=this.viewer,r=t.renderer,i=r.getClearAlpha();r.autoClear&&(r.clear(),r.setClearAlpha(0),r.autoClear=!1),("Viewer3d"===this.viewer.name||"BimTilesViewer"===this.viewer.name)&&t.getSsaoEnabled()&&r.clear();let n=r.getContext(),a=r.state;a.buffers.stencil.setTest(!0),a.buffers.stencil.setLocked(!0),a.buffers.stencil.setFunc(n.ALWAYS,1,255),a.buffers.stencil.setOp(n.KEEP,n.KEEP,n.INCR),t.scene.overrideMaterial=this.backMaterial,t.scene.userData.backFrontStencil=!0,r.render(t.scene,t.camera),a.buffers.stencil.setFunc(n.ALWAYS,1,255),a.buffers.stencil.setOp(n.KEEP,n.KEEP,n.DECR),t.scene.overrideMaterial=this.frontMaterial,r.render(t.scene,t.camera),t.scene.userData.backFrontStencil=!1,a.buffers.stencil.setFunc(n.LEQUAL,1,255),a.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),r.render(e,t.camera),a.buffers.stencil.setTest(!1),a.buffers.stencil.setLocked(!1),r.setClearAlpha(i),t.scene.overrideMaterial=null}activate(e){this.activeSectionType&&this.deactivate(!1),this.activeSectionType=e,this.sections[e].activate(),this.enableSelection=this.viewer.enableSelection,this.viewer.enableSelection=!1}deactivate(e=!1){let t=this.activeSectionType;t&&this.sections[t].deactivate(e),this.activeSectionType=void 0,null!=this.enableSelection&&(this.viewer.enableSelection=this.enableSelection),this.enableSelection=void 0}reset(){let e=this.activeSectionType;e&&this.sections[e].reset()}setSectionPlaneVisible(e){let t=this.activeSectionType;t&&this.sections[t].setSectionPlaneVisible(e)}isActive(){let e=this.activeSectionType;return e?this.sections[e].isActive:!!this.getActiveSectionType()}getActiveSectionType(){return this.activeSectionType}getActiveSection(){if(this.activeSectionType)return this.sections[this.activeSectionType]}setClippingObjectIds(e){for(let t in this.sections)this.setClippingObjectIdsForType(t,e)}setClippingObjectIdsForType(e,t){this.sections[e].clearClippingObjectIds(),null!=t&&t.length&&(this.sections[e].clippingObjetIds=t,this.sections[e].setClippingEnabled(!0))}destroy(){var e,t;null==(e=this.backMaterial)||e.dispose(),null==(t=this.frontMaterial)||t.dispose(),this.viewer.removeEventListener("beforerender",this.onBeforeRender),this.viewer.removeEventListener("afterrender",this.onAfterRender),Object.keys(this.sections).forEach((e=>{let t=e;this.sections[t].destroy()}))}},Yu=e9;Yu.DEFAULT_ID="SectionPlugin";var $b=class{constructor(e="uploadModelFile"){this.input=document.createElement("input"),this.input.id=e,this.input.type="file",this.input.multiple=!0,this.input.accept=this.formats().map((e=>"."+e)).join(","),this.input.style.display="none",this.input.onchange=e=>{let t=e.target.files;!t||t.length<=0?de.error("[Uploader] No files to be uploaded!"):this.uploadFiles(t)}}formats(){return de.warn("[Uploader]: Should call derived class instead!"),[]}uploadFiles(e){de.warn(`[Uploader]: Should call derived class instead! files: ${e}`)}openFileBrowserToUpload(){this.input.click()}},CD=class extends $b{constructor(e,t){super(t),this.defaultModelConfig={src:"",merge:!0},this.viewer=e}formats(){return["gltf","glb","dxf","obj","stl","fbx","ifc","dae","*"]}uploadFiles(e){let t=e.length;if(0===t)return;if(this.checkAllFilesWithTheSameFormat(e)){for(let r=0;r<t;r++){let t=e[r];this.uploadSingleFile(t)}return}let r,i,n,a=on({},this.defaultModelConfig),s=new Map;for(let r=0;r<t;r++){let t=e[r];s.set(t.name,t),t.name.match(/\.(gltf|glb)$/)&&(n=t)}let o=[],l=()=>{n&&(r=URL.createObjectURL(n),o.push(r),a.src=n.name)};if(n){l();let e=oa.extractUrlBase(r);i=new Sh,i.setURLModifier((t=>{let r=decodeURI(t).replace(e,"").replace(/^(\.?\/)/,"");if(s.has(r)){let e=s.get(r),t=URL.createObjectURL(e);return o.push(t),t}return t}))}else n=e[0],l();this.viewer.loadLocalModel(r,a,i,(e=>{let t=Math.floor(100*e.loaded/e.total);de.info(`[Uploader] Loading ${null==n?void 0:n.name}, ${t}%`)})).then((()=>{de.info(`[Uploader] Loaded ${null==n?void 0:n.name}`),o.forEach(URL.revokeObjectURL)}))}checkAllFilesWithTheSameFormat(e){let t=e=>{let t=e.lastIndexOf(".");return e.substring(t+1).toLowerCase()},r=e.length,i=t(e[0].name);for(let n=0;n<r;n++)if(t(e[n].name)!==i)return!1;return!0}uploadSingleFile(e){let t=on({},this.defaultModelConfig),r=URL.createObjectURL(e);t.src=e.name;let i=e.name.toLowerCase();if(i.endsWith(".stl")){let e=new lt,r=new F(0,0,0),i=new dn;i.setFromAxisAngle(new F(1,0,0),-Math.PI/2);let n=new F(.001,.001,.001);e.compose(r,i,n),t.matrix=e.elements}else if(i.endsWith(".3dm")){let e=new lt,r=new F(0,0,0),i=new dn;i.setFromAxisAngle(new F(1,0,0),-Math.PI/2);let n=new F(1,1,1);e.compose(r,i,n),t.matrix=e.elements}let n=new Sh;this.viewer.loadLocalModel(r,t,n,(t=>{let r=Math.floor(100*t.loaded/t.total);de.info(`[Uploader] Loading ${null==e?void 0:e.name}, ${r}%`)}))}},OAe=class extends vn{constructor(e){super(e,{id:"Viewer3dDatGuiPlugin"}),this.controls={showGroundGrid:!1,showGroundGrass:!1,skyMode:["None","Black Background","White Background","Gradient ramp","Cloudy"],environments:["None","Default (City Streat 64x32)","Venice Sunset","Footprint Court (HDR Labs)","City Street"],homeView:()=>console.log("[DGH] Go to home view"),views:["Top","Bottom","Front","Back","Left","Right"],OrthographicCamera:!1,viewpoints:!1,annotations:!1,takeSnapshot:()=>console.log("[DGH] Taking snapshot..."),takeSnapshotForViewerBBox:()=>console.log("[DGH] Taking snapshot for objects..."),fullScreen:()=>console.log("[DGH] Full screen..."),webcam:!1,uploadFile:()=>console.log("[DGH] Upload file..."),showBimTree:!1,showPropertyPanel:!1,transparentMode:!1,showVertexNormals:!1,explode:1,sectionMode:["No section","Box section","Pick plane section","Axis plane section"],alVisible:!0,alColor:"#cccccc",alIntensity:1,dlColor:"#dddddd",showDlHelper:!1,hlVisible:!0,hlIntensity:1,hlColor:[255,255,255,.6],hlGroundColor:[200,255,200,.6],fogEnabled:!1,fogColor:14540253,fogNearDistance:1,fogFarDistance:1e3,distanceCullingFactor:100},this.viewer=e,this.init()}init(){if(!this.viewer||!this.viewer.renderer||!this.viewer.scene)throw new Error("Need to initialize renderer, scene first!");let e=this.viewer,t=this.viewer.scene,r=this.controls;this.gui=new wAe({name:"controls",autoPlace:!0,width:300,closed:!0}),this.gui.domElement.style.opacity="0.6";let i=this.gui.addFolder("Common settings");i.add(r,"showGroundGrid").name("Show ground grid").onChange((t=>{let r=e.findPlugin("GroundGridPlugin");r?r.setVisible(t):r=new RS(e)})),i.add(r,"showGroundGrass").name("Show ground grass").onChange((t=>{let r=e.findPlugin("GroundGrassPlugin");r?r.setVisible(t):r=new AS(e)})),i.add(r,"environments",r.environments).name("Environments").onChange((r=>{let i="";"Default (City Streat 64x32)"!==r?("Venice Sunset"===r?i="venice_sunset_1k.hdr":"Footprint Court (HDR Labs)"===r?i="footprint_court_2k.hdr":"City Street"===r&&(i="city_street_256.hdr"),""===i?(t.environment=null,e.enableRender()):(i=`${window.location.origin}/images/envmap/${i}`,e.setEnvironment(i))):e.setEnvironmentData()})),i.add(r,"homeView").name("Go to home view").onChange((()=>{e.goToHomeView()})),i.add(r,"views",r.views).name("Views").onChange((t=>{let r=QP.getCameraDirectionByView(t);e.flyToDirection(r)})),i.add(r,"OrthographicCamera").name("Orth Camera").onChange((t=>{e.setCameraProjection(t?"Orthographic":"Perspective")})),i.add(r,"takeSnapshot").name("Take snapshot").onChange((()=>{let t=e.findPlugin("ScreenshotPlugin");t||(t=new Mm(e));let r=t.getScreenshot(),i=document.createElement("a");i.href=r,i.download="",i.click()})),i.add(r,"takeSnapshotForViewerBBox").name("Take snapshot for viewer bbox").onChange((()=>{let t=e.findPlugin("ScreenshotPlugin");t||(t=new Mm(e)),(()=>{bt(this,null,(function*(){let r=e.getBBox(),i=yield t.getScreenshotByWorldBBox(r),n=document.createElement("a");n.href=i,n.download="",n.click()}))})()})),i.add(r,"fullScreen").name("Full screen").onChange((()=>{_D&&_D.isEnabled&&_D.request(),e.enableRender()})),e instanceof ju&&i.add(r,"uploadFile").name("Upload file").onChange((()=>{new CD(e).openFileBrowserToUpload()}));let n=this.gui.addFolder("Model operations");n.add(r,"transparentMode",r.transparentMode).name("Transparent mode").onChange((t=>{t?e.setModelsOpacity(.03):e.clearModelsOpacity(),e.enableRender()})),n.add(r,"showVertexNormals",r.showVertexNormals).name("Show Vertex Normals").onChange((t=>{e.showVertexNormals(t),e.enableRender()})),n.add(r,"explode",1,5).name("Explode tool").onChange((t=>{let r=e.findPlugin("ExplodePlugin");r||(r=new MS(e)),r.explode(t)})),n.add(r,"sectionMode",r.sectionMode).name("Section mode").onChange((t=>{let r=e.findPlugin("SectionPlugin");r||(r=new Yu(e)),"No section"===t?r.deactivate():"Box section"===t?r.activate("ObjectsBoxSection"):"Pick plane section"===t?r.activate("PickPlaneSection"):"Axis plane section"===t&&r.activate("AxisPlaneSection"),e.enableRender()}));let a=this.viewer.getLights().ambient,s=this.gui.addFolder("Ambient light");s.add(r,"alVisible",r.alVisible).name("visible").onChange((t=>{a&&(a.visible=t),e.enableRender()})),s.addColor(r,"alColor").name("color").onChange((t=>{a&&(a.color=new dt(t)),e.enableRender()})),s.add(r,"alIntensity",0,5).name("intensity").onChange((t=>{a&&(a.intensity=t),e.enableRender()}));let o=this.viewer.getLights().sun;if(o){let t=this.gui.addFolder("Directional light");t.add(o,"visible").name("visible").onChange((t=>{o&&(o.visible=t),e.enableRender()})),t.addColor(r,"dlColor").name("color").onChange((t=>{o&&(o.color=new dt(t)),e.enableRender()})),t.add(o,"intensity",0,5).name("intensity").onChange((t=>{o&&(o.intensity=t),e.enableRender()})),t.add(o,"castShadow").name("castShadow").onChange((t=>{o&&(o.castShadow=t),e.enableRender()})),t.add(r,"showDlHelper").name("showDlHelper").onChange((t=>{e.debugLights(t),e.enableRender()}))}let l=this.viewer.getLights().hemisphere,h=this.gui.addFolder("Hemisphere Light");h.add(r,"hlVisible",r.hlVisible).name("visible").onChange((t=>{l&&(l.visible=t),e.enableRender()})),h.add(r,"hlIntensity",0,5).name("intensity").onChange((t=>{l&&(l.intensity=t),e.enableRender()})),h.addColor(r,"hlColor").name("color").onChange((t=>{l&&(l.color=new dt(t)),e.enableRender()})),h.addColor(r,"hlGroundColor").name("groundColor").onChange((t=>{l&&(l.groundColor=new dt(t)),e.enableRender()}));let c=this.gui.addFolder("Fog");c.add(r,"fogEnabled",r.fogEnabled).name("Enabled").onChange((i=>{t.fog=i?new vh(r.fogColor,r.fogNearDistance,r.fogFarDistance):null,e.enableRender()})),c.add(r,"fogNearDistance",0,100).name("Near").onChange((i=>{r.fogEnabled&&t&&(t.fog=new vh(r.fogColor,i,r.fogFarDistance)),e.enableRender()})),c.add(r,"fogFarDistance",100,2e3).name("Far").onChange((i=>{r.fogEnabled&&t&&(t.fog=new vh(r.fogColor,r.fogNearDistance,i)),e.enableRender()}));let u=this.gui.addFolder("Performance");e.getDistanceCullingFactor&&u.add(r,"distanceCullingFactor",10,1e3).name("Distance Culling Factor").onChange((t=>{e.setDistanceCullingFactor(t),e.enableRender()})).setValue(e.getDistanceCullingFactor())}open(){this.gui&&this.gui.open()}close(){this.gui&&this.gui.close()}destroy(){super.destroy(),this.gui&&this.gui.destroy(),this.gui=void 0}},r9=class extends vn{constructor(e,t){super(e,{id:(null==t?void 0:t.id)||r9.DEFAULT_ID}),this.mouseDownPositionX=-1,this.mouseDownPositionY=-1,this.onPointerDown=e=>{let t=e.target;null!=t&&t.classList.contains("draggable")&&0===e.button&&(this.mouseDownPositionX=e.x,this.mouseDownPositionY=e.y,document.addEventListener("pointermove",this.onPointerMove),document.addEventListener("pointerup",this.onPointerUp))},this.onPointerMove=e=>{let t=this.layerMgrRoot,r=this.viewer.viewerContainer;if(!t||!r)return;let i=r.clientLeft+r.clientWidth,n=r.clientTop+r.clientHeight,a=e.x-this.mouseDownPositionX,s=e.y-this.mouseDownPositionY,o=t.offsetLeft+a,l=t.offsetTop+s;o<0&&(o=0),o>0&&o+t.clientWidth>i&&a>0&&(o=t.offsetLeft),l<0&&(l=0),l>0&&l+t.clientHeight>n&&s>0&&(l=t.offsetTop),t.style.left=`${o}px`,t.style.top=`${l}px`,this.mouseDownPositionX=e.x,this.mouseDownPositionY=e.y},this.onPointerUp=()=>{document.removeEventListener("pointermove",this.onPointerMove),document.removeEventListener("pointerup",this.onPointerUp)},this.cfg=t||{},!1!==this.cfg.visible&&this.init()}init(){let e=this.viewer;this.cfg.containerId&&(this.container=document.getElementById(this.cfg.containerId)),this.container||(this.container=e.widgetContainer),this.dxfLayersArray=e.getLayers(),this.buildPage(),this.addContent(),this.addEventHandlers()}setVisible(e){e&&!this.container&&this.init();let t=this.layerMgrRoot;"none"!==t.style.display!==e&&(e?(this.updatePage(),t.style.display=""):t.style.display="none",this.dispatchEvent("visibilitychange",e))}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}destroy(){var e,t,r;super.destroy(),null==(e=this.closeBtn)||e.removeEventListener("click",this.closePanel),null==(t=this.checkboxes)||t.forEach((e=>{e.removeEventListener("change",(()=>{this.checkboxHandler(e)}))})),null==(r=this.layerMgrRoot)||r.remove()}buildPage(){var e;this.layerMgrRoot=document.createElement("div"),this.layerMgrRoot.classList.add("layer-manager");let t=document.createElement("div");t.classList.add("header","draggable"),this.headerText=document.createElement("span"),this.headerText.innerHTML="Layers",this.headerText.classList.add("draggable"),this.closeBtn=document.createElement("span"),this.closeBtn.classList.add("close"),this.closeBtn.innerHTML="X",t.appendChild(this.headerText),t.appendChild(this.closeBtn),this.layerMgrRoot.appendChild(t),this.layerList=document.createElement("div"),this.layerList.classList.add("layer-list"),this.layerMgrRoot.appendChild(this.layerList),null==(e=this.container)||e.appendChild(this.layerMgrRoot),this.updateHeaderText()}addContent(){var e;let t='\n        <div class="layer-list-item">\n            <input type="checkbox" id="toggleAllLayers" checked class="checkbox"></input>\n            <span class="popup-layer-color">Color</span>\n            <span class="item-layer-name">&nbsp;&nbsp;Layer name</span>\n        </div>\n        ';if(this.dxfLayersArray){let e=this.dxfLayersArray.length>1;for(let r=0;r<this.dxfLayersArray.length;++r){let i=this.dxfLayersArray[r].layers,n=Object.keys(i);n=n.sort(((e,t)=>{let r=/[a-zA-Z0-9]/,i=e.toString(),n=t.toString();return r.test(i[0])||r.test(n[0])?i>n?1:i<n?-1:0:i.localeCompare(n)}));for(let a of n){let n=i[a],s=e?`&lt;${this.dxfLayersArray[r].modelId}&gt; ${a}`:a,o=this.convertDecimalToHex(n.color);t+=this.generateListItem(s,n.visible,o)}}}this.layerList&&(this.layerList.innerHTML=t);let r=null==(e=this.layerMgrRoot)?void 0:e.querySelectorAll("input[type=checkbox]");this.checkboxes=[].slice.call(r,0),this.checkboxes.forEach((e=>{e.addEventListener("change",(()=>{this.checkboxHandler(e)}))}))}generateListItem(e,t,r){return`\n            <div class="layer-list-item">\n                <input type="checkbox" value="${e}" ${t?"checked":""} class="checkbox">\n                <div class="item-color" style="${r?`background-color: ${r}`:"opacity: 0.1"}"></div>\n                <span class="item-layer-name" title="${e}">${e}</span>\n            </div>\n            `}closePanel(){this.hide()}addEventHandlers(){var e,t;null==(e=this.closeBtn)||e.addEventListener("click",this.closePanel.bind(this)),null==(t=this.layerMgrRoot)||t.addEventListener("pointerdown",this.onPointerDown)}checkboxHandler(e){var t;if(!this.dxfLayersArray||!this.checkboxes)return;let r=this.viewer;if("toggleAllLayers"===e.id){for(let t=0;t<this.dxfLayersArray.length;++t){let i=this.dxfLayersArray[t].modelId,n=this.dxfLayersArray[t].layers;Object.keys(n).forEach((t=>{r.setLayerVisibility(t,e.checked,i)}))}return void(null==(t=this.checkboxes)||t.forEach((t=>t.checked=e.checked)))}let i="",n=e.value,a=n.indexOf(">");-1!==a&&(i=n.slice(1,a),n=n.slice(a+2)),i||(i=this.dxfLayersArray[0].modelId),r.setLayerVisibility(n,e.checked,i)}updatePage(){if(!this.dxfLayersArray)return;let e=this.viewer.getLayers();e.length!==this.dxfLayersArray.length&&(this.dxfLayersArray=e,this.addContent(),this.updateHeaderText())}updateHeaderText(){if(!this.dxfLayersArray||!this.headerText)return;let e=0;for(let t=0;t<this.dxfLayersArray.length;++t){let r=this.dxfLayersArray[t].layers;e+=Object.keys(r).length}this.headerText.innerHTML=`Layers (count: ${e})`}convertDecimalToHex(e){return void 0===e?void 0:`#${e.toString(16).padStart(6,"0")}`}},t9=r9;t9.DEFAULT_ID="LayerManagerPlugin";var DAe={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:.001953125}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float h;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"},LAe={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:.001953125}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float v;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 sum = vec4( 0.0 );\n\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;\n\t\t\tsum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;\n\n\t\t\tgl_FragColor = sum;\n\n\t\t}"},i9=class extends vn{constructor(e,t){let r=(null==t?void 0:t.id)||i9.DEFAULT_ID;super(e,{id:r}),this.shouldRender=!1,this.onModelLoaded=()=>{this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((()=>{this.update()}),2e3)},this.onShadowRender=()=>{var e,t,r,i,n;this.shouldRender&&(this.render(),null==(e=this.shadowCamera)||e.removeFromParent(),this.shadowCamera=void 0,null==(t=this.blurPlane)||t.removeFromParent(),this.blurPlane=void 0,null==(r=this.depthMaterial)||r.dispose(),this.depthMaterial=void 0,null==(i=this.horizontalBlurMaterial)||i.dispose(),this.horizontalBlurMaterial=void 0,null==(n=this.verticalBlurMaterial)||n.dispose(),this.verticalBlurMaterial=void 0,this.shouldRender=!1)},this.cfg=t||{id:r},void 0===this.cfg.blur&&(this.cfg.blur=5),void 0===this.cfg.darkness&&(this.cfg.darkness=.8),this.viewer.addEventListener("modelload",this.onModelLoaded),this.viewer.addEventListener("beforerender",this.onShadowRender)}get scene(){return this.viewer.scene}get renderer(){return this.viewer.renderer}update(){this.initMaterial(),this.initRenderTarget(),this.updateGroundShadow(),this.shouldRender=!0,this.viewer.enableRender()}initMaterial(){this.depthMaterial=new Yd,this.depthMaterial.userData.darkness={value:this.cfg.darkness},this.depthMaterial.onBeforeCompile=e=>{var t;e.uniforms.darkness=null==(t=this.depthMaterial)?void 0:t.userData.darkness,e.fragmentShader=`\n                uniform float darkness;\n                ${e.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * darkness );")}\n            `},this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1,this.horizontalBlurMaterial=new xr(DAe),this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial=new xr(LAe),this.verticalBlurMaterial.depthTest=!1}initRenderTarget(){this.renderTarget=new yn(128,128),this.renderTarget.texture.generateMipmaps=!1,this.renderTargetBlur=new yn(128,128),this.renderTargetBlur.texture.generateMipmaps=!1}updateGroundShadow(){var e,t,r;let i=this.viewer.getBBox(),n=new Xr;n.name="ground-shadow",pn.disableLayerChannels(n,[12,11]),null==(e=this.scene)||e.add(n);let{min:a,max:s}=i,o=new F;i.getSize(o),o.multiplyScalar(2);let l=new F;i.getCenter(l);let h=new vs(o.x,o.z).rotateX(Math.PI/2),c=new Mr({map:null==(t=this.renderTarget)?void 0:t.texture,transparent:!0,depthWrite:!1}),u=new Ht(h,c);u.renderOrder=1,u.position.set(l.x,a.y,l.z),u.scale.y=-1,null==n||n.add(u),this.shadowCamera=new Gi(-o.x/2,o.x/2,o.z/2,-o.z/2,-o.y/2,o.y),this.shadowCamera.position.set(l.x,a.y,l.z),this.shadowCamera.lookAt(l.x,s.y,l.z),this.shadowCamera.updateProjectionMatrix(),n.add(this.shadowCamera);let d=new Ht(h);d.position.set(l.x,a.y,l.z),d.visible=!1,n.add(d),this.blurPlane=d,null==(r=this.shadowGroup)||r.removeFromParent(),this.shadowGroup=n,this.shadowGroup.updateWorldMatrix(!0,!0)}blurShadow(e){this.renderer&&this.blurPlane&&this.renderTarget&&this.renderTargetBlur&&this.shadowCamera&&this.horizontalBlurMaterial&&this.verticalBlurMaterial&&(this.blurPlane.visible=!0,this.blurPlane.material=this.horizontalBlurMaterial,this.horizontalBlurMaterial.uniforms.tDiffuse.value=this.renderTarget.texture,this.horizontalBlurMaterial.uniforms.h.value=1*e/256,this.renderer.setRenderTarget(this.renderTargetBlur),this.renderer.render(this.blurPlane,this.shadowCamera),this.blurPlane.material=this.verticalBlurMaterial,this.verticalBlurMaterial.uniforms.tDiffuse.value=this.renderTargetBlur.texture,this.verticalBlurMaterial.uniforms.v.value=1*e/256,this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(this.blurPlane,this.shadowCamera),this.blurPlane.visible=!1)}render(){if(!(this.renderer&&this.scene&&this.renderTarget&&this.shadowCamera&&this.depthMaterial))return;let e=this.scene.background;this.scene.background=null,this.scene.overrideMaterial=this.depthMaterial;let t=this.renderer.getClearAlpha();this.renderer.setClearAlpha(0),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(this.scene,this.shadowCamera),this.scene.overrideMaterial=null,this.blurShadow(this.cfg.blur),this.blurShadow(.4*this.cfg.blur),this.renderer.setRenderTarget(null),this.renderer.setClearAlpha(t),this.scene.background=e}destroy(){var e,t,r,i,n,a,s;super.destroy(),this.viewer.removeEventListener("modelload",this.onModelLoaded),this.viewer.removeEventListener("beforerender",this.onShadowRender),null==(e=this.shadowCamera)||e.removeFromParent(),this.shadowCamera=void 0,null==(t=this.blurPlane)||t.removeFromParent(),this.blurPlane=void 0,null==(r=this.depthMaterial)||r.dispose(),this.depthMaterial=void 0,null==(i=this.horizontalBlurMaterial)||i.dispose(),this.horizontalBlurMaterial=void 0,null==(n=this.verticalBlurMaterial)||n.dispose(),this.verticalBlurMaterial=void 0,null==(a=this.renderTarget)||a.dispose(),this.renderTarget=void 0,null==(s=this.renderTargetBlur)||s.dispose(),this.renderTargetBlur=void 0}},n9=i9;n9.DEFAULT_ID="GroundShadowPlugin";var kAe=class extends vn{constructor(e){super(e,{id:"HotpointPlugin"}),this.onAfterRender=()=>{var e;let t=this.viewer.scene,r=this.viewer.camera;!t||!r||!this.hotpointRoot||0===this.hotpointRoot.children.length||null==(e=this.css2dRenderer)||e.render(t,r)},this.css2dRenderer=this.viewer.css2dRenderer,this.viewer.addEventListener("afterrender",this.onAfterRender)}add(e){var t;if(this.has(e.hotpointId))return void de.warn(`[Hotpoint] Hotpoint with id '${e.hotpointId}' already exist!`);let r=e.anchorPosition,i=_P.createHotpoint(e.html);i.position.set(r[0]||0,r[1]||0,r[2]||0),i.visible=!1!==e.visible,i.userData.hotpoint=e,this.hotpointRoot||(this.hotpointRoot=new Xr,this.hotpointRoot.matrixAutoUpdate=!1,this.hotpointRoot.matrixWorldAutoUpdate=!1,this.hotpointRoot.name="HotpointRoot",null==(t=this.viewer.scene)||t.add(this.hotpointRoot)),this.hotpointRoot.add(i),i.updateWorldMatrix(!1,!1),this.viewer.enableRender()}remove(e){var t,r;let i=(null==(t=this.hotpointRoot)?void 0:t.children)||[];for(let t=0;t<i.length;++t){let n=i[t];(null==(r=n.userData.hotpoint)?void 0:r.hotpointId)===e&&n.removeFromParent()}}clear(){var e;null==(e=this.hotpointRoot)||e.clear()}has(e){return!!this.findHotpointObject(e)}move(e,t){let r=this.findHotpointObject(e);if(r){let e=t.z||0;r.position.set(t.x,t.y,e),r.updateWorldMatrix(!1,!1),this.viewer.enableRender()}}setVisible(e,t){let r=this.findHotpointObject(e);r&&(r.visible=t)}findHotpointObject(e){var t;return((null==(t=this.hotpointRoot)?void 0:t.children)||[]).find((t=>{var r;return(null==(r=t.userData.hotpoint)?void 0:r.hotpointId)===e}))}flyToHotpoint(e,t=this.viewer.camera.zoom){let r=this.findHotpointObject(e);if(!r)return;r.updateWorldMatrix(!1,!1);let i=r.position,n=this.viewer.camera.position,a=new F(i.x,i.y,n.z),s=new F(i.x,i.y,0);this.viewer.flyTo(a,s,t)}destroy(){super.destroy(),this.clear()}},ua=ra(FAe(),1),wi=ra(gRe(),1),I9={Fill:"Fill",Stroke:"Stroke",Shading:"Shading"},jc={Fill:0,Stroke:1,FillStroke:2,Invisible:3,FillAddToPath:4,StrokeAddToPath:5,FillStrokeAddToPath:6,AddToPath:7,FillStrokeMask:3,AddToPathFlag:4},vRe=16,yRe=100,D9=[1,0,0,1,0,0],L9=[.001,0,0,.001,0,0],E3t={},bRe={},xRe=new dt,UD=new lt,O9=0,_3t=.01,k9=class extends Mn{constructor(e){if(super(),this.contentVisible=!0,this.markedContentStack=[],this.stateStack=[],this.current=new HD(1,1),this.tempSMask=null,this.pendingEOFill=!1,this.activeLayoutName="Model",this.defaultLayerId="0",this.currentLayerId="0",this.layers={0:{name:"0",id:"0",index:"0",visible:!0}},this.loadedEntityCount=0,this.viewportScale=1,this.baseTransform=new lt,this.currentTransform=new lt,this.transformStack=[],this.clipType=ua.PolyFillType.pftNonZero,this.paths=[],this.pointsMaterials={},this.lineBasicMaterials={},this.meshBasicMaterials={},this.lineWithWidthCount=0,void 0===wi)throw"[PdfLoader] need load pdf.js first";"3.8.162"!==wi.version&&de.warn("[PdfLoader] The pdf.js version we are using now is 3.8.162,if not maybe wrong."),this.fontManager=e.font,wi.GlobalWorkerOptions.workerSrc=e.pdfWorker}load(e,t,r,i){this.loadAsync(e,r).then((e=>{t(e)})).catch((e=>{i(e)}))}loadAsync(e,t){return bt(this,null,(function*(){var r,i,n;let a=Ut.getUpdateProgressFunc(t),s=Ut.getUpdateSubProgressFunc(0,10,t);a(0);let{src:o}=e;this.modelCfg=e;let l=e.modelId||o,h=Date.now(),c=wi.getDocument(o);c.onProgress=s;let u=yield c.promise;return this.pdf=u,de.info(`[PdfLoader] Pdf document loaded in ${(Date.now()-h)/1e3}s`),h=Date.now(),de.log(u),this.pdfDocumentGroup=new Xr,this.pdfDocumentGroup.name=`PdfDocument-${l}`,this.optionalContentConfig=yield u.getOptionalContentConfig(),yield null==(r=this.fontManager)?void 0:r.getFontFromIndexeddb(),de.log("[PdfLoader] Font loaded."),u.numPages>1&&de.info("[PdfLoader] Only the first page can be render others will be ignore."),yield this.loadPage(1,t),null!=(i=this.fontManager)&&i.missingFonts&&de.warn("[PdfLoader] Missing fonts and reference count:",null==(n=this.fontManager)?void 0:n.missingFonts,", used other fonts instead."),this.lineWithWidthCount>0&&de.warn(`[PdfLoader] Found ${this.lineWithWidthCount} line(s) with width, line width is not supported and was ignored.`),this.progressiveLoadCallback||(a(100),de.info(`[PdfLoader] Loaded '${e.src}' in ${(Date.now()-h)/1e3}s, adding to scene...`)),{modelId:l,pdfData:{threejsObject:this.pdfDocumentGroup,layers:this.layers||[],layersAndThreejsObjects:this.layersAndThreejsObjects,loadedEntityCount:this.loadedEntityCount}}}))}loadPage(e,t){return bt(this,null,(function*(){var r,i,n,a,s;if(!this.pdf||e>this.pdf.numPages)return Promise.reject("load pdf page failed");this.pdfPage&&this.pdfPageGroup&&(null==(r=this.pdfPageGroup)||r.removeFromParent(),null==(i=this.pdfPageGroup)||i.traverse((e=>{e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})),null==(n=this.pdfPageGroup)||n.clear(),this.pdfPageGroup=void 0,this.tryCleanup(),this.pdfPage.objs.clear(),this.pdfPage.cleanup(),this.objs=void 0,this.pdfPage=void 0,null==(a=this.viewportMesh)||a.removeFromParent(),this.viewportMesh=void 0,this.layersAndThreejsObjects=void 0);let o=Ut.getUpdateProgressFunc(t),l=Ut.getUpdateSubProgressFunc(30,90,t),h=Date.now(),c=yield this.pdf.getPage(e);o(20),de.info(`[PdfLoader] Pdf page loaded in ${(Date.now()-h)/1e3}s`),h=Date.now(),de.log(c),this.pdfPage=c,this.pdfPageGroup=new Xr,this.pdfPageGroup.name=k9.MODEL_LAYOUT_NAME,null==(s=this.pdfDocumentGroup)||s.add(this.pdfPageGroup),this.commonObjs=this.pdf._transport.commonObjs,this.objs=c.objs;let u=c.view,d=8192/Math.max(u[2]-u[0],u[3]-u[1]),p=Math.min(300/72,d),f=c.getViewport({scale:p});this.beginDrawing(f),this.current=new HD(f.width,f.height),yield this.buildLayers(c),o(30),yield this.getOperatorList(l)}))}getPageCount(){if(this.pdf)return this.pdf.numPages}getOperatorList(e){return bt(this,null,(function*(){let t=this.pdfPage;if(!t)return;let r,i=wi.AnnotationMode.ENABLE,n=t._transport.getRenderingIntent("display",i,null,!0),a=t._intentStates.get(n.cacheKey);return a||(a=Object.create(null),t._intentStates.set(n.cacheKey,a)),a.opListReadCapability||(r=Object.create(null),r.operatorListChanged=function(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(r))},a.opListReadCapability=new wi.PromiseCapability,(a.renderTasks||(a.renderTasks=new Set)).add(r),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null}),yield this._pumpOperatorList(n,e)}))}_pumpOperatorList(e,t){return bt(this,null,(function*(){let r=this.pdfPage;if(!r)return;let{renderingIntent:i,cacheKey:n,annotationStorageSerializable:a}=e,{map:s,transfers:o}=a,l=r._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:r._pageIndex,intent:i,cacheKey:n,annotationStorage:s},o).getReader(),h=r._intentStates.get(n);h.streamReader=l;let c=h.operatorList.argsArray.length,u=c<3e3;de.info(`[PdfLoader] Operation count: ${c}, isVerboseProgress: ${u}`);let d=0,p=Ut.getUpdateProgressFunc(t);p(0);let f=()=>bt(this,null,(function*(){var e;try{let{value:i,done:n}=yield l.read();if(n)return h.streamReader=null,void(this.progressiveLoadCallback||p(100));if(r._transport.destroyed)return;let a=i,s=a.argsArray.length,o=100*d/c,m=100*(d+s)/c;if(u){let e=Ut.getUpdateSubProgressFunc(o,m,t);yield this.executeOperatorList(a,e)}else yield this.executeOperatorList(a),p(m);let g=this.progressiveLoadCallback,v=a.lastChunk;g?window.requestAnimationFrame((()=>{var e,t;null!=(e=this.modelCfg)&&e.merge&&this.mergePdfObjects(),g(O9,v),null==(t=this.pdfPageGroup)||t.updateMatrixWorld(!0)})):null!=(e=this.modelCfg)&&e.merge&&this.mergePdfObjects(),a.lastChunk&&this.endDrawing(),d+=s,g?f():yield f()}catch(e){if(h.streamReader=null,r._transport.destroyed)return;if(h.operatorList){h.operatorList.lastChunk=!0;for(let e of h.renderTasks)e.operatorListChanged();this.tryCleanup()}if(h.displayReadyCapability)h.displayReadyCapability.reject(e);else{if(!h.opListReadCapability)throw e;h.opListReadCapability.reject(e)}}}));yield f()}))}tryCleanup(){let e=this.pdfPage;e&&e._intentStates.clear()}mergePdfObjects(){for(let e in this.layersAndThreejsObjects){let t=this.layersAndThreejsObjects[e];if(t.length<=1)continue;let r=Zi.deepMerge(t,this.pdfPageGroup,!1,!1,!1),i=r.added,n=r.removed;n.forEach((e=>{var t,r;null==(t=this.pdfPageGroup)||t.remove(e);let i=e;i.geometry.dispose(),i.material.dispose(),null==(r=i.material.map)||r.dispose()})),i.forEach((e=>{var t;null==(t=this.pdfPageGroup)||t.add(e)}));let a=t.filter((e=>!n.includes(e)));a.push(...i),this.layersAndThreejsObjects[e]=a}}getPointsMaterial(e,t=1){return this.pointsMaterials[`${e}-${t}`]||(this.pointsMaterials[`${e}-${t}`]=new Ai({color:e,transparent:!0,opacity:t})),this.pointsMaterials[`${e}-${t}`]}getLineBasicMaterial(e,t=1){return this.lineBasicMaterials[`${e}-${t}`]||(this.lineBasicMaterials[`${e}-${t}`]=new Yr({color:e,transparent:!0,opacity:t})),this.lineBasicMaterials[`${e}-${t}`]}getMeshBasicMaterial(e,t=1){return this.meshBasicMaterials[`${e}-${t}`]||(this.meshBasicMaterials[`${e}-${t}`]=new Mr({color:e,transparent:!0,opacity:t,side:ln})),this.meshBasicMaterials[`${e}-${t}`]}getTransformByMatrix4(e){return[e.elements[0],e.elements[1],e.elements[4],e.elements[5],e.elements[12],e.elements[13]]}getObject(e,t=null){return"string"==typeof e?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing(e){var t,r,i,n;de.log("beginDrawing",e),this.viewportScale=e.scale;let[a,s,o,l,h,c]=e.transform;this.baseTransform.set(a,o,0,h,s,l,0,c,0,0,1,0,0,0,0,1),this.currentTransform.copy(this.baseTransform),null==(t=this.pdfPageGroup)||t.applyMatrix4(this.baseTransform),null==(r=this.pdfPageGroup)||r.rotateZ(Tr.degToRad(-e.rotation)),null==(i=this.pdfPageGroup)||i.updateMatrix();let{width:u,height:d}=e,p=(new Nt).setFromPoints([new F(0,0,0),new F(u,0,0),new F(u,d,0),new F(0,0,0),new F(u,d,0),new F(0,d,0)]),f=new Mr({color:16777215}),m=new Ht(p,f);m.name="PDF-viewport",m.renderOrder=-999,m.layers.disable(10),this.viewportMesh=m,null==(n=this.pdfPageGroup)||n.add(m)}endDrawing(){var e;null==(e=this.pdfPageGroup)||e.updateMatrixWorld(!0)}releaseData(){var e;null==(e=this.fontManager)||e.releaseFontData(),this.operatorList=void 0,this.optionalContentConfig=void 0,this.commonObjs=void 0,this.objs=void 0,this.pdfPage=void 0,this.pdf=void 0}buildLayers(e){return bt(this,null,(function*(){if(!this.pdf)return;let t=yield e.getOperatorList(),r=t.fnArray,i=t.argsArray,n={},a=1;for(let e=0;r&&e<r.length;e++)if(r[e]===wi.OPS.beginMarkedContentProps&&i[e]&&"OC"==i[e][0]&&null!==i[e][1]){let t;t="object"==typeof i[e][1]?i[e][1].id:i[e][1],void 0===n[t]&&(n[t]=a++)}let s=this.optionalContentConfig,o={0:{name:"0",id:"0",index:"0",visible:!0}},l=1;for(let e in n){let t=s.getGroup(e);t?(l++,o[t.name]={name:t.name,id:e,index:n[e],visible:t.visible}):n[e]=0}return de.log("buildLayers",o),this.layers=o,{layerCount:l,layersMap:o,layers:n}}))}addObjectToModel(e){var t,r;this.layersAndThreejsObjects||(this.layersAndThreejsObjects={});let i=this.layers[this.currentLayerId],n=(null==i?void 0:i.name)||this.defaultLayerId;this.layersAndThreejsObjects[n]||(this.layersAndThreejsObjects[n]=[]),e.userData.layerName=n,this.layersAndThreejsObjects[n].push(e),this.loadedEntityCount++,e.layers.enableAll();let a=e;a.geometry&&a.geometry.hasAttribute("normal")&&a.geometry.deleteAttribute("normal"),a.material&&!a.material.map&&a.geometry&&a.geometry.hasAttribute("uv")&&a.geometry.deleteAttribute("uv"),null!=(t=this.modelCfg)&&t.merge&&a.geometry&&(a.geometry.translate(0,0,O9),O9+=_3t),null==(r=this.pdfPageGroup)||r.add(e)}executeOperatorList(e,t){return bt(this,null,(function*(){var r;let i=e.argsArray,n=e.fnArray,a=i.length,s=Ut.getUpdateProgressFuncForLoop(a,t),o=this.commonObjs,l=this.objs,h=0;for(;h<a;){let e=n[h];if(e!==wi.OPS.dependency)null==(r=this[e])||r.apply(this,i[h]);else for(let e of i[h])(e.startsWith("g_")?o:l).has(e)||console.warn("Why it runs here?!");h++,yield s(h)}}))}setLineWidth(e){this.current.lineWidth=e,e>1&&this.lineWithWidthCount++}setLineCap(e){this.current.lineCap=e}setLineJoin(e){this.current.lineJoin=e}setMiterLimit(e){this.current.miterLimit=e}setDash(e,t){}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(let[t,r]of e)switch(t){case"LW":this.setLineWidth(r);break;case"LC":this.setLineCap(r);break;case"LJ":this.setLineJoin(r);break;case"ML":this.setMiterLimit(r);break;case"D":this.setDash(r[0],r[1]);break;case"RI":this.setRenderingIntent(r);break;case"FL":this.setFlatness(r);break;case"Font":this.setFont(r[0],r[1]);break;case"CA":this.current.strokeAlpha=r;break;case"ca":this.current.fillAlpha=r;break;case"BM":case"TR":break;case"SMask":this.current.activeSMask=r?this.tempSMask:null,this.tempSMask=null}}save(){let e=this.current;this.transformStack.push(this.currentTransform.clone()),this.stateStack.push(e),this.current=e.clone()}restore(){0!==this.stateStack.length&&(this.current=this.stateStack.pop()),0!==this.transformStack.length&&this.currentTransform.copy(this.transformStack.pop()),this.pendingClip=null,this.paths=[]}transform(e,t,r,i,n,a){let s=UD.set(e,r,0,n,t,i,0,a,0,0,1,0,0,0,0,1);this.currentTransform.multiply(s)}moveTo(){}lineTo(){}curveTo(){}curveTo2(){}curveTo3(){}closePath(){this.currentPath&&this.currentPath.curves.length>0&&(this.currentPath.closePath(),this.paths.push(this.currentPath.clone()),this.currentPath=void 0)}rectangle(){}stroke(e=!0){if(this.contentVisible){let e=this.current.strokeColor,t=this.current.strokeAlpha,r=[],i=[];for(let e=0;e<this.paths.length;e++){let t=this.paths[e],n=1===t.getPoints().length,a=(new Nt).setFromPoints(t.getPoints());a.applyMatrix4(this.currentTransform),n?r.push(a):i.push(a)}if(r.length>0){let i=qi(r),n=new Di(i,this.getPointsMaterial(e,t));this.addObjectToModel(n)}if(i.length>0){let r=qi(i),n=new jn(r,this.getLineBasicMaterial(e,t));this.addObjectToModel(n)}}e&&this.consumePath(this.current.getClippedPathBoundingBox())}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){if(0===this.paths.length)return;this.current.patternFill&&de.warn("[PdfLoader] fill pattern not supported now.");let t=this.current.getClippedPathBoundingBox();if(this.contentVisible&&null!==t){let e,t=[];if(this.clipPaths){let e=new ua.PolyTree,r=new ua.Clipper,i=this.paths.map((e=>e.getPoints().map((e=>({X:e.x,Y:e.y}))))),n=this.clipPaths.map((e=>e.getPoints().map((e=>({X:e.x,Y:e.y}))))),a=100;ua.JS.ScaleUpPaths(i,a),ua.JS.ScaleUpPaths(n,a),r.AddPaths(i,ua.PolyType.ptSubject,!0),r.AddPaths(n,ua.PolyType.ptClip,!0),r.Execute(ua.ClipType.ctIntersection,e,this.pendingEOFill?ua.PolyFillType.pftEvenOdd:ua.PolyFillType.pftNonZero,this.clipType);let s=ua.JS.PolyTreeToExPolygons(e);for(let e=0;e<s.length;e++){let{outer:r,holes:i}=s[e],n=new Ys;n.setFromPoints(r.map((e=>new Te(e.X/a,e.Y/a)))),i.length>0&&i.forEach((e=>{let t=new Ys;t.setFromPoints(e.map((e=>new Te(e.X/a,e.Y/a)))),n.holes.push(t)})),t.push(n)}this.clipPaths=void 0}if(t.length>0)e=new hc(t);else{e=qi(this.paths.map((e=>new hc(e))))}e.applyMatrix4(this.currentTransform);let r=this.current.fillColor,i=this.current.fillAlpha,n=new Ht(e,this.getMeshBasicMaterial(r,i));this.addObjectToModel(n),this.pendingEOFill=!1}e&&this.consumePath(t)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=E3t}eoClip(){this.pendingClip=bRe}beginText(){this.current.textMatrix=D9,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){this.currentPath=new Ys}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){let r=this.commonObjs.get(e),i=this.current;if(!r)throw new Error(`Can't find font for ${e}`);if(i.fontMatrix=r.fontMatrix||L9,(0===i.fontMatrix[0]||0===i.fontMatrix[3])&&de.warn("Invalid font matrix for font "+e),t<0?(t=-t,i.fontDirection=-1):i.fontDirection=1,this.current.font=r,this.current.fontSize=t,r.isType3Font)return;let n=t;t<vRe?n=vRe:t>yRe&&(n=yRe),this.current.fontSizeScale=t/n,this.current.browserFontSize=n}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(){}setTextMatrix(e,t,r,i,n,a){this.current.textMatrix=[e,t,r,i,n,a],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,r){var i,n,a,s;let o,l,h=this.current,c=h.font,u=h.textRenderingMode,d=h.fontSize/h.fontSizeScale,p=u&jc.FillStrokeMask,f=!!(u&jc.AddToPathFlag),m=h.patternFill&&!c.missingFile;return(c.disableFontFace||f||m)&&(o=c.getPathGenerator(this.commonObjs,e)),c.disableFontFace||m?de.log("paintChar path:",o,d,p):((p===jc.Fill||p===jc.FillStroke)&&(l=null==(n=this.fontManager)?void 0:n.getCharShape(e,null==(i=this.current.font)?void 0:i.name,.8*this.current.browserFontSize)),(p===jc.Stroke||p===jc.FillStroke)&&(l=null==(s=this.fontManager)?void 0:s.getCharShape(e,null==(a=this.current.font)?void 0:a.name,.8*this.current.browserFontSize))),l}showText(e){var t,r;let i=this.current,n=i.font;if(n.isType3Font)return this.showType3Text(e);let a=i.fontSize;if(0===a)return;let s=i.fontSizeScale,o=i.charSpacing,l=i.wordSpacing,h=i.fontDirection,c=i.textHScale*h,u=e.length,d=n.vertical,p=d?1:-1,f=n.defaultVMetrics,m=a*i.fontMatrix[0],g=i.textRenderingMode===jc.Fill&&!n.disableFontFace&&!i.patternFill,[v,y,b,x,_,w]=i.textMatrix,S=this.currentTransform.clone();S.multiply(UD.set(v,b,0,_,y,x,0,w,0,0,1,0,0,0,0,1)),S.multiply(UD.makeTranslation(i.x,i.y+i.textRise,0)),h>0?S.scale(new F(c,1,1)):S.scale(new F(c,-1,1));let T=i.lineWidth,M=i.textMatrixScale;if(0===M||0===T){(i.textRenderingMode&jc.FillStrokeMask)===jc.Stroke||jc.FillStroke}else T/=M;1!==s&&(S.scale(new F(s,s,1)),T/=s);let E,A=0,C=[];for(E=0;E<u;++E){let i=e[E];if("number"==typeof i){A+=p*i*a/1e3;continue}let c,u,v,y=(i.isSpace?l:0)+o,b=i.unicode,x=i.accent,_=i.width;if(d){let e=i.vmetric||f,t=-(i.vmetric?e[1]:.5*_)*m,r=e[2]*m;_=e?-e[0]:_,c=t/s,u=(A+r)/s}else c=A/s,u=0;if(n.remeasure,this.contentVisible&&(i.isInFont||n.missingFile))if(g&&!x){let e=null==(r=this.fontManager)?void 0:r.getCharShape(b,null==(t=this.current.font)?void 0:t.name,this.current.browserFontSize);e&&(e.translate(c,u,0),e.applyMatrix4(S),C.push(e))}else{let e=this.paintChar(b,c,u);e&&(e.translate(c,u,0),e.applyMatrix4(S),C.push(e))}v=d?_*m-y*h:_*m+y*h,A+=v}if(C.length>0){let e=C.filter((e=>e instanceof va)),t=C.filter((e=>!(e instanceof va)));if(e.length>0){let t=e.length>1?qi(e):e[0],r=new Ht(t,this.getMeshBasicMaterial(this.current.fillColor));this.addObjectToModel(r),r.layers.disable(11)}if(t.length>0){let e=t.length>1?qi(t):t[0],r=new Wn(e,this.getLineBasicMaterial(this.current.fillColor));this.addObjectToModel(r),r.layers.disable(11)}}d?i.y-=A:i.x+=A*c}showType3Text(e){}setCharWidth(e,t){}setCharWidthAndBounds(e,t,r,i,n,a){}setStrokeColor(){}setStrokeColorN(){}setFillColorN(){this.current.patternFill=!0}setStrokeRGBColor(e,t,r){this.current.strokeColor=xRe.setRGB(e/255,t/255,r/255).convertSRGBToLinear().getHex()}setFillRGBColor(e,t,r){this.current.fillColor=xRe.setRGB(e/255,t/255,r/255).convertSRGBToLinear().getHex(),this.current.patternFill=!1}shadingFill(){}beginInlineImage(){}beginImageData(){}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){de.log("beginMarkedContent",e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){if("OC"===e){this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)});let e=this.optionalContentConfig.getGroup(null==t?void 0:t.id);this.currentLayerId=(null==e?void 0:e.name)||this.defaultLayerId}else this.markedContentStack.push({visible:!0});this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){let t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip,this.pendingClip&&(t||(this.pendingClip===bRe?this.clipType=ua.PolyFillType.pftEvenOdd:this.clipType=ua.PolyFillType.pftNonZero,this.clipPaths=this.paths.slice()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),this.paths=[],this.currentPath=void 0}paintFormXObjectBegin(e,t){de.log("paintFormXObjectBegin",e,t)}paintFormXObjectEnd(){}beginGroup(){}endGroup(){}beginAnnotation(){}endAnnotation(){}paintImageMaskXObject(){}paintImageMaskXObjectGroup(){}paintImageXObject(e){if(!this.contentVisible)return;let t=this.getObject(e);t?this.paintInlineImageXObject(t):de.warn("Dependent image isn't ready yet")}paintInlineImageXObject(e){if(!this.contentVisible)return;de.log("paintInlineImageXObject",e),this.save();let{bitmap:t,width:r,height:i}=e;this.currentTransform.multiply(UD.makeScale(1/r,-1/i,1));let n=new Zd(t),a=new Mr({map:n,transparent:!0}),s=new vs(r,i),o=new Ht(s,a);o.translateX(r/2),o.translateY(-i/2),o.applyMatrix4(this.currentTransform),this.addObjectToModel(o),this.restore()}paintInlineImageXObjectGroup(){}paintImageXObjectRepeat(){}paintImageMaskXObjectRepeat(){}paintSolidColorImageMask(){}_scaleImage(e,t){let r=e.width,i=e.height,n=Math.max(Math.hypot(t.elements[0],t.elements[4]),1),a=Math.max(Math.hypot(t.elements[1],t.elements[5]),1),s=r,o=i,l=s,h=o;for(;n>2&&s>1||a>2&&o>1;)n>2&&s>1&&(l=s>=16384?Math.floor(s/2)-1||1:Math.ceil(s/2),n/=s/l),a>2&&o>1&&(h=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o)/2,a/=o/h),s=l,o=h;return{paintWidth:s,paintHeight:o}}constructPath(e,t,r){let i,n,a=this.current,s=a.x,o=a.y,l=[this.currentTransform.elements[0],this.currentTransform.elements[1],this.currentTransform.elements[4],this.currentTransform.elements[5],this.currentTransform.elements[12],this.currentTransform.elements[13]],h=0===l[0]&&0===l[3]||0===l[1]&&0===l[2],c=h?r.slice(0):null;for(let r=0,u=0,d=e.length;r<d;r++)switch(this.currentPath||(this.currentPath=new Ys),0|e[r]){case wi.OPS.rectangle:{s=t[u++],o=t[u++];let e=t[u++],r=t[u++],i=s+e,n=o+r;this.currentPath.moveTo(s,o),0===e||0===r?this.currentPath.lineTo(i,n):(this.currentPath.lineTo(i,o),this.currentPath.lineTo(i,n),this.currentPath.lineTo(s,n)),h||a.updateRectMinMax(l,[s,o,i,n]),this.currentPath.closePath(),this.paths.push(this.currentPath.clone()),this.currentPath=void 0}break;case wi.OPS.moveTo:s=t[u++],o=t[u++],this.currentPath.moveTo(s,o),h||a.updatePathMinMax(l,s,o);break;case wi.OPS.lineTo:s=t[u++],o=t[u++],this.currentPath.lineTo(s,o),h||a.updatePathMinMax(l,s,o);break;case wi.OPS.curveTo:i=s,n=o,s=t[u+4],o=t[u+5],this.currentPath.bezierCurveTo(t[u],t[u+1],t[u+2],t[u+3],s,o),a.updateCurvePathMinMax(l,i,n,t[u],t[u+1],t[u+2],t[u+3],s,o,c),u+=6;break;case wi.OPS.curveTo2:i=s,n=o,this.currentPath.bezierCurveTo(s,o,t[u],t[u+1],t[u+2],t[u+3]),a.updateCurvePathMinMax(l,i,n,s,o,t[u],t[u+1],t[u+2],t[u+3],c),s=t[u+2],o=t[u+3],u+=4;break;case wi.OPS.curveTo3:i=s,n=o,s=t[u+2],o=t[u+3],this.currentPath.bezierCurveTo(t[u],t[u+1],s,o,s,o),a.updateCurvePathMinMax(l,i,n,t[u],t[u+1],s,o,s,o,c),u+=4;break;case wi.OPS.closePath:this.paths.push(this.currentPath.clone()),this.currentPath=void 0}this.currentPath&&this.paths.push(this.currentPath.clone()),h&&a.updateScalingPathMinMax(l,c),this.current.setCurrentPoint(s,o)}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}},Rm=k9;Rm.MODEL_LAYOUT_NAME="Model";for(let e in wi.OPS)void 0!==Rm.prototype[e]&&(Rm.prototype[wi.OPS[e]]=Rm.prototype[e]);var HD=class{constructor(e,t){this.textMatrix=D9,this.fontMatrix=L9,this.textRenderingMode=jc.Fill,this.fillColor=0,this.strokeColor=0,this.activeSMask=null,this.lineCap=0,this.lineJoin=0,this.miterLimit=0,this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.browserFontSize=1,this.textMatrix=D9,this.textMatrixScale=1,this.fontMatrix=L9,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=jc.Fill,this.textRise=0,this.fillColor=0,this.strokeColor=0,this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.ctxMatrix=new Wr,this.clipBox=[0,0,e,t],this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}clone(){return Object.create(this)}setCurrentPoint(e,t){this.x=e,this.y=t}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}updatePathMinMax(e,t,r){[t,r]=wi.Util.applyTransform([t,r],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,r),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,r)}getPathBoundingBox(e=I9.Fill,t=null){let r=[this.minX,this.minY,this.maxX,this.maxY];if(e===I9.Stroke){if(!t)throw new Error("Stroke bounding box must include transform.");let e=wi.Util.singularValueDecompose2dScale(t),i=e[0]*this.lineWidth/2,n=e[1]*this.lineWidth/2;r[0]-=i,r[1]-=n,r[2]+=i,r[3]+=n}return r}updateRectMinMax(e,t){let r=wi.Util.applyTransform(t,e),i=wi.Util.applyTransform(t.slice(2),e);this.minX=Math.min(this.minX,r[0],i[0]),this.minY=Math.min(this.minY,r[1],i[1]),this.maxX=Math.max(this.maxX,r[0],i[0]),this.maxY=Math.max(this.maxY,r[1],i[1])}updateScalingPathMinMax(e,t){wi.Util.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.maxX=Math.max(this.maxX,t[1]),this.minY=Math.min(this.minY,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,r,i,n,a,s,o,l,h){let c=wi.Util.bezierBoundingBox(t,r,i,n,a,s,o,l);if(h)return h[0]=Math.min(h[0],c[0],c[2]),h[1]=Math.max(h[1],c[0],c[2]),h[2]=Math.min(h[2],c[1],c[3]),void(h[3]=Math.max(h[3],c[1],c[3]));this.updateRectMinMax(e,c)}updateClipFromPath(){let e=wi.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}getClippedPathBoundingBox(e=I9.Fill,t=null){return wi.Util.intersect(this.clipBox,this.getPathBoundingBox(e,t))||[]}},F9=class extends vn{constructor(e,t){super(e,{id:(null==t?void 0:t.id)||F9.DEFAULT_ID}),this.cfg=t||{},null==this.cfg.enableProgressiveLoad&&(this.cfg.enableProgressiveLoad=!0)}loadAsync(e,t){return bt(this,null,(function*(){let r=this.viewer;r.getSpinner().increaseJobCount();let i=Date.now(),n=r.getFontManager(),a=this.cfg.pdfWorker;this.loader||(this.loader=new Rm({font:n,pdfWorker:a})),this.cfg.enableProgressiveLoad&&(this.loader.progressiveLoadCallback=(n,a)=>{let s=r.camera.position;n&&s.z<n&&r.getCameraManager().setCameraPosition(new F(s.x,s.y,n)),a&&(Ut.getUpdateProgressFunc(t)(100),de.info(`[PdfLoader] Progressively loaded '${e.src}' in ${(Date.now()-i)/1e3}s`),r.getSpinner().decreaseJobCount()),r.enableRender()});let s=yield this.loader.loadAsync(e,t);return this.cfg.enableProgressiveLoad||r.getSpinner().decreaseJobCount(),new Lc(s)}))}loadPage(e,t){return bt(this,null,(function*(){var r;return null==(r=this.loader)?void 0:r.loadPage(e,t)}))}getPageCount(){var e;return(null==(e=this.loader)?void 0:e.getPageCount())||0}getPdfViewport(){var e;let t=null==(e=this.loader)?void 0:e.viewportMesh;return t?(new Vt).setFromObject(t):void 0}worldPosition2PdfPoint(e){let t=this.getPdfViewport(),r=(null==t?void 0:t.min)||new F,i=new F;null==t||t.getSize(i);let n=i.x,a=i.y,s=e.x-r.x,o=e.y-r.y;return new Te(s/n,o/a)}pdfPoint2WorldPosition(e){let t=this.getPdfViewport(),r=(null==t?void 0:t.min)||new F,i=new F;null==t||t.getSize(i);let n=i.x,a=i.y;return new Te(e.x*n+r.x,e.y*a+r.y)}},kS=F9;kS.DEFAULT_ID="PdfLoaderPlugin";var ERe=class extends $b{constructor(e,t){super(t),this.pdfWorker="",this.defaultModelConfig={src:"",merge:!0},this.viewer=e}setPdfWorker(e){this.pdfWorker=e}formats(){return["dxf","pdf"]}uploadFiles(e){for(let t=0;t<e.length;t++){let r=e[t];r.name.match(/\.(dxf)$/)?this.uploadSingleDxf(r):r.name.match(/\.(pdf)$/)&&this.uploadSinglePdf(r)}}uploadSingleDxf(e){return bt(this,null,(function*(){let t=Ii(on({},this.defaultModelConfig),{src:URL.createObjectURL(e),modelId:e.name});yield this.viewer.loadModel(t,(t=>{let r=Math.floor(100*t.loaded/t.total);de.info(`[Uploader] Loading ${null==e?void 0:e.name}, ${r}%`)}))}))}uploadSinglePdf(e){return bt(this,null,(function*(){let t=t=>{let r=Math.floor(100*t.loaded/t.total);de.info(`[Uploader] Loading ${null==e?void 0:e.name}, ${r}%`)};try{let r=this.viewer,i={font:r.fontManager,pdfWorker:this.pdfWorker,enableProgressiveLoad:!0},n={merge:!0,src:URL.createObjectURL(e),modelId:e.name};new kS(r,i).loadAsync(n,t).then((e=>{this.viewer.addModel(e),this.onSuccess&&this.onSuccess({})}))}catch(e){de.info(e)}}))}},_Re=new F,T3t=new dn,TRe=new F,G0=class extends yr{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)}))}))}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}},sd=new lt,w3t=new lt,VD=class{constructor(e={}){let t,r,i,n,a=this,s={camera:{style:""},objects:new WeakMap},o=void 0!==e.element?e.element:document.createElement("div");o.style.overflow="hidden",this.domElement=o;let l=document.createElement("div");l.style.transformOrigin="0 0",l.style.pointerEvents="none",o.appendChild(l);let h=document.createElement("div");function c(e){return Math.abs(e)<1e-10?0:e}function u(e){let t=e.elements;return"matrix3d("+c(t[0])+","+c(-t[1])+","+c(t[2])+","+c(t[3])+","+c(t[4])+","+c(-t[5])+","+c(t[6])+","+c(t[7])+","+c(t[8])+","+c(-t[9])+","+c(t[10])+","+c(t[11])+","+c(t[12])+","+c(-t[13])+","+c(t[14])+","+c(t[15])+")"}function d(e){let t=e.elements;return"translate(-50%,-50%)matrix3d("+c(t[0])+","+c(t[1])+","+c(t[2])+","+c(t[3])+","+c(-t[4])+","+c(-t[5])+","+c(-t[6])+","+c(-t[7])+","+c(t[8])+","+c(t[9])+","+c(t[10])+","+c(t[11])+","+c(t[12])+","+c(t[13])+","+c(t[14])+","+c(t[15])+")"}function p(e,t,r,i){if(e.isCSS3DObject){let i=!0===e.visible&&!0===e.layers.test(r.layers);if(e.element.style.display=!0===i?"":"none",!0===i){let i;e.onBeforeRender(a,t,r),e.isCSS3DSprite?(sd.copy(r.matrixWorldInverse),sd.transpose(),0!==e.rotation2D&&sd.multiply(w3t.makeRotationZ(e.rotation2D)),e.matrixWorld.decompose(_Re,T3t,TRe),sd.setPosition(_Re),sd.scale(TRe),sd.elements[3]=0,sd.elements[7]=0,sd.elements[11]=0,sd.elements[15]=1,i=d(sd)):i=d(e.matrixWorld);let n=e.element,o=s.objects.get(e);if(void 0===o||o.style!==i){n.style.transform=i;let t={style:i};s.objects.set(e,t)}n.parentNode!==h&&h.appendChild(n),e.onAfterRender(a,t,r)}}for(let n=0,a=e.children.length;n<a;n++)p(e.children[n],t,r,i)}h.style.transformStyle="preserve-3d",l.appendChild(h),this.getSize=function(){return{width:t,height:r}},this.render=function(e,a){let o,d,f=a.projectionMatrix.elements[5]*n;a.view&&a.view.enabled?(l.style.transform=`translate( ${-a.view.offsetX*(t/a.view.width)}px, ${-a.view.offsetY*(r/a.view.height)}px )`,l.style.transform+=`scale( ${a.view.fullWidth/a.view.width}, ${a.view.fullHeight/a.view.height} )`):l.style.transform="",!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===a.parent&&!0===a.matrixWorldAutoUpdate&&a.updateMatrixWorld(),a.isOrthographicCamera&&(o=-(a.right+a.left)/2,d=(a.top+a.bottom)/2);let m=a.view&&a.view.enabled?a.view.height/a.view.fullHeight:1,g=a.isOrthographicCamera?`scale( ${m} )scale(`+f+")translate("+c(o)+"px,"+c(d)+"px)"+u(a.matrixWorldInverse):`scale( ${m} )translateZ(`+f+"px)"+u(a.matrixWorldInverse),v=(a.isPerspectiveCamera?"perspective("+f+"px) ":"")+g+"translate("+i+"px,"+n+"px)";s.camera.style!==v&&(h.style.transform=v,s.camera.style=v),p(e,e,a,g)},this.setSize=function(e,a){t=e,r=a,i=t/2,n=r/2,o.style.width=e+"px",o.style.height=a+"px",l.style.width=e+"px",l.style.height=a+"px",h.style.width=e+"px",h.style.height=a+"px"}}},q0=ra(_m(),1),wRe="#2C7BE5",Bi=Math.PI/2,Qn=Math.PI/4,Aa=([e,t,r],[i,n,a])=>({position:new F(e,t,r),rotation:new tn(i,n,a)}),S3t={Front:Ii(on({},Aa([0,0,1],[0,0,0])),{label:"NavCube.front"}),Right:Ii(on({},Aa([1,0,0],[0,Bi,0])),{label:"NavCube.right"}),Back:Ii(on({},Aa([0,0,-1],[0,Math.PI,0])),{label:"NavCube.back"}),Left:Ii(on({},Aa([-1,0,0],[0,-Bi,0])),{label:"NavCube.left"}),Top:Ii(on({},Aa([0,1,0],[-Bi,0,0])),{label:"NavCube.top"}),Bottom:Ii(on({},Aa([0,-1,0],[Bi,0,0])),{label:"NavCube.bottom"})},M3t=[Aa([0,1,1],[-Qn,0,-Bi]),Aa([0,1,-1],[-3*Qn,0,-Bi]),Aa([0,-1,1],[Qn,0,-Bi]),Aa([0,-1,-1],[3*Qn,0,-Bi]),Aa([1,1,0],[-Bi,Qn,0]),Aa([1,-1,0],[-Bi,3*Qn,0]),Aa([-1,1,0],[-Bi,-Qn,0]),Aa([-1,-1,0],[-Bi,-3*Qn,0]),Aa([1,0,1],[0,Qn,0]),Aa([1,0,-1],[0,3*Qn,0]),Aa([-1,0,1],[0,-Qn,0]),Aa([-1,0,-1],[0,-3*Qn,0])],A3t=[{position:new F(1,1,1),rotation:[new tn(-Bi,Bi,-Qn),new tn(-Bi,0,Qn),new tn(0,0,3*Qn)]},{position:new F(1,1,-1),rotation:[new tn(0,Bi,3*Qn),new tn(-Bi,0,3*Qn),new tn(0,Math.PI,-3*Qn)]},{position:new F(-1,1,-1),rotation:[new tn(Math.PI,-Bi,Qn),new tn(-Bi,0,-3*Qn),new tn(0,Math.PI,3*Qn)]},{position:new F(-1,1,1),rotation:[new tn(0,-Bi,3*Qn),new tn(-Bi,0,-Qn),new tn(0,0,-3*Qn)]},{position:new F(1,-1,1),rotation:[new tn(0,Bi,-Qn),new tn(-Bi,Math.PI,-Qn),new tn(0,0,Qn)]},{position:new F(1,-1,-1),rotation:[new tn(-Bi,Bi,3*Qn),new tn(Bi,0,Qn),new tn(0,Math.PI,-Qn)]},{position:new F(-1,-1,1),rotation:[new tn(0,-Bi,Qn),new tn(Bi,0,-3*Qn),new tn(0,0,-Qn)]},{position:new F(-1,-1,-1),rotation:[new tn(0,-Bi,-Qn),new tn(Bi,0,-Qn),new tn(0,Math.PI,Qn)]}],zD=class extends yr{constructor(e={}){super(),this.NAVCUBE_SIZE=100,this.clickHandler=e.onClick,(0,q0.forEach)(S3t,(e=>{this.createPlane(e)})),(0,q0.forEach)(M3t,(e=>{this.createEdge(e)})),(0,q0.forEach)(A3t,((e,t)=>{this.createCorner(e,t)}))}createPlane(e){let t=e.position.clone().multiplyScalar(this.NAVCUBE_SIZE/2),{rotation:r,label:i}=e,n=document.createElement("div");n.style.width=this.NAVCUBE_SIZE+"px",n.style.height=this.NAVCUBE_SIZE+"px",n.classList.add("navcube-plane"),n.classList.add("outer");let a=document.createElement("div");a.style.width=this.NAVCUBE_SIZE-4+"px",a.style.height=this.NAVCUBE_SIZE-4+"px",a.innerHTML=xn(i),a.classList.add("navcube-plane"),a.classList.add("inner"),n.appendChild(a);let s=new G0(n);s.position.copy(t),s.rotation.copy(r),this.add(s),n.addEventListener("click",(()=>{this.clickHandler&&this.clickHandler(t.clone().normalize(),r)}))}createEdge(e){let t=e.position.clone().multiplyScalar(this.NAVCUBE_SIZE/2),r=document.createElement("div");r.style.width="4px",r.style.height=this.NAVCUBE_SIZE-40+"px",r.style.background=wRe,r.classList.add("navcube-edge");let i=new G0(r);i.position.copy(t),i.rotation.copy(e.rotation),this.add(i),r.addEventListener("click",(()=>{this.clickHandler&&this.clickHandler(t.clone().normalize(),e.rotation)}))}createCorner(e,t){let r=r=>{r.addEventListener("click",(()=>{this.clickHandler&&this.clickHandler(e.position.clone().normalize(),new tn)})),r.addEventListener("mouseenter",(()=>{let e=document.getElementsByClassName("group-"+t);(0,q0.forEach)(e,(e=>{e instanceof HTMLElement&&e.classList.add("highlight")}))})),r.addEventListener("mouseleave",(()=>{let e=document.getElementsByClassName("group-"+t);(0,q0.forEach)(e,(e=>{e instanceof HTMLElement&&e.classList.remove("highlight")}))}))},i=e.position.clone().multiplyScalar(this.NAVCUBE_SIZE/2+.5),n=document.createElement("div");n.style.borderTop=14*Math.sqrt(3)+"px solid #efefef",n.style.borderLeft="14px solid transparent",n.style.borderRight="14px solid transparent",n.classList.add("navcube-corner"),n.classList.add("group-"+t);let a=new G0(n);a.position.copy(i).lerp(e.position,.14);let s=Math.atan2(i.z,i.x);a.rotateY(i.z*i.x<0?Math.PI+s:s);let o=(new tn).setFromVector3(i.clone().normalize());a.rotateX(-o.y),i.y<0&&a.rotateZ(Math.PI),this.add(a);let l=(t,n,a)=>{let s=document.createElement("div");s.style.borderTop=`13px solid ${wRe}`,s.style.borderLeft="13px solid transparent",s.style.borderRight="13px solid transparent",s.classList.add("navcube-corner-plane"),s.classList.add("group-"+n);let o=new G0(s),l=e.position.clone();l.setComponent(a,0),o.position.copy(i).sub(l),o.rotateX(t.x),o.rotateY(t.y),o.rotateZ(t.z),this.add(o),r(s)};(0,q0.forEach)(e.rotation,((e,r)=>{l(e,t,r)})),r(n)}},N9=class extends vn{constructor(e,t){super(e,{id:(null==t?void 0:t.id)||N9.DEFAULT_ID}),this.cfg=t||{},this.init()}init(){this.initRenderer(),this.initScene(),this.animate()}initRenderer(){var e;let t,r=135,i=135;if(this.cfg.containerId&&(t=document.getElementById(this.cfg.containerId),t&&(r=t.clientWidth,i=t.clientHeight)),!t){let r="navCube";t=document.createElement("div"),t.id=r,null==(e=this.viewer.widgetContainer)||e.appendChild(t)}this.renderer=new VD,this.renderer.setSize(r,i),this.renderer.domElement.classList.add("css3d-navcube"),t.appendChild(this.renderer.domElement)}initScene(){this.scene=new Xi;let e=window.innerWidth/window.innerHeight,t=200;this.camera=new Gi(t*e/-2,t*e/2,100,-100,1,1e3),this.camera.position.set(-200,200,200),this.scene.add(this.camera),this.navCube=new zD({onClick:e=>this.viewer.flyToDirection(e)}),this.scene.add(this.navCube)}render(){this.renderer&&this.scene&&this.camera&&(this.update(),this.renderer.render(this.scene,this.camera))}animate(){requestAnimationFrame(this.animate.bind(this)),this.render()}update(){let e=this.viewer.camera;if(e){let t=new F;e.getWorldDirection(t);let r=e.up;this.updateCameraDirection(t,r)}}updateCameraDirection(e,t){if(!this.camera||!e)return;e.normalize();this.camera.position.set(20*-e.x+0,20*-e.y+0,20*-e.z+0),this.camera.lookAt(0,0,0),this.camera.up=t}destroy(){super.destroy(),this.scene&&this.camera&&this.navCube&&(this.scene.clear(),this.camera=void 0,this.navCube=void 0,this.scene=void 0)}},B9=N9;B9.DEFAULT_ID="NavCubePlugin";var FS=function(){var e=0,t=document.createElement("div");function r(e){return t.appendChild(e.dom),e}function i(r){for(var i=0;i<t.children.length;i++)t.children[i].style.display=i===r?"block":"none";e=r}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(r){r.preventDefault(),i(++e%t.children.length)}),!1);var n=(performance||Date).now(),a=n,s=0,o=r(new FS.Panel("FPS","#0ff","#002")),l=r(new FS.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=r(new FS.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:t,addPanel:r,showPanel:i,begin:function(){n=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(l.update(e-n,200),e>=a+1e3&&(o.update(1e3*s/(e-a),100),a=e,s=0,h)){var t=performance.memory;h.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){n=this.end()},domElement:t,setMode:i}};FS.Panel=function(e,t,r){var i=1/0,n=0,a=Math.round,s=a(window.devicePixelRatio||1),o=80*s,l=48*s,h=3*s,c=2*s,u=3*s,d=15*s,p=74*s,f=30*s,m=document.createElement("canvas");m.width=o,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*s+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=r,g.fillRect(0,0,o,l),g.fillStyle=t,g.fillText(e,h,c),g.fillRect(u,d,p,f),g.fillStyle=r,g.globalAlpha=.9,g.fillRect(u,d,p,f),{dom:m,update:function(l,v){i=Math.min(i,l),n=Math.max(n,l),g.fillStyle=r,g.globalAlpha=1,g.fillRect(0,0,o,d),g.fillStyle=t,g.fillText(a(l)+" "+e+" ("+a(i)+"-"+a(n)+")",h,c),g.drawImage(m,u+s,d,p-s,f,u,d,p-s,f),g.fillRect(u+p-s,d,s,f),g.fillStyle=r,g.globalAlpha=.9,g.fillRect(u+p-s,d,s,a((1-l/v)*f))}}};var SRe=FS,MRe=class extends vn{constructor(e){super(e,{id:"StatsPlugin"}),this.init()}init(){var e;let t=new SRe;t.setMode(0);let r=document.createElement("div");r.classList.add("statsOutput"),r.appendChild(t.domElement),null==(e=this.viewer.widgetContainer)||e.append(r),this.stats=t,this.viewer.addEventListener("onanimate",(()=>{var e;null==(e=this.stats)||e.update()}))}show(){var e;null==(e=this.stats)||e.showPanel(0)}hide(){var e;null==(e=this.stats)||e.showPanel(-1)}destroy(){super.destroy(),this.stats=void 0}},U9=class extends Ht{constructor(e,t,r,i=4e3,n=32,a=15,s=new F,o=new F(0,.7,.5)){super(),this.vertexShader="\n    varying vec3 vWorldPosition;\n    void main() {\n      vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n      vWorldPosition = worldPosition.xyz;\n      mat4 modifiedViewMatrix = modelViewMatrix;\n      modifiedViewMatrix[3] = vec4(0.0, 0.0, 0.0, 1.0);\n      gl_Position = projectionMatrix * modifiedViewMatrix * vec4( position, 1.0 );\n      gl_Position = gl_Position.xyww;\n    }",this.fragmentShader="\n    uniform vec3 topColor;\n    uniform vec3 skylineColor;\n    uniform vec3 bottomColor;\n    uniform float offset;\n    uniform float exponent;\n    uniform vec3 skyCenter;\n    uniform vec3 sunDirection;\n    varying vec3 vWorldPosition;\n    // Used to find the position to draw the sun. Sun size is bigger when this value is smaller\n    const float sunDirectionDotThreshold = 0.98;\n\n    void main() {\n      vec3 position = vec3(vWorldPosition.x - skyCenter.x, vWorldPosition.y - skyCenter.y, vWorldPosition.z - skyCenter.z);\n      vec3 normalizedPosition = normalize( position + offset );\n      float h = normalizedPosition.y;\n      vec3 color;\n      if (h > 0.0) {\n        color = mix( skylineColor, topColor, pow( h, exponent ) );\n\n        // draw the sun\n        float dotResult = dot(sunDirection, normalizedPosition);\n        if (dotResult > sunDirectionDotThreshold) {\n            const float sunSize = 1.0 - sunDirectionDotThreshold; // maximum sun size\n            const vec3 sunColor = vec3(1.0, 1.0, 1.0);\n            color = mix(color, sunColor, pow((dotResult + sunSize - 1.0) / sunSize, 3.0));\n        }\n      } else {\n        color = mix( skylineColor, bottomColor, pow( -h, exponent ) );\n      }\n      gl_FragColor = vec4(color , 1.0);\n    }";let l={topColor:{value:e},skylineColor:{value:t},bottomColor:{value:r},offset:{value:400},exponent:{value:.9},skyCenter:{value:s||new F},sunDirection:{value:o.normalize()}};this.geometry=new Al(i,n,a),this.material=new xr({uniforms:l,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,side:ws}),this.name=U9.NAME,this.matrixAutoUpdate=!1,this.layers.disable(12)}},$u=U9;$u.NAME="SKYBOX",$u.MIN_SKY_RADIUS=4e3,$u.MAX_SKY_RADIUS=2e4;var V9=class extends vn{constructor(e,t){let r=(null==t?void 0:t.id)||V9.DEFAULT_ID;super(e,{id:r}),null!=t&&t.color?this.setSkyboxByColor(t.color):this.setSkyboxByGradientColors(),e.addEventListener("modelload",(()=>{let t=e.getBBox(),r=this.viewer.getHomeView();if(t){if(t=t.clone(),r&&r.eye&&r.look){let e=r&&Ut.arrayToVector3(r.eye),i=r&&Ut.arrayToVector3(r.look),n=new Vt;n.setFromPoints([e,i]),t.union(n)}this.updateGradientColorSkybox(t)}}))}setSkyboxByColor(e=[.92,.95,.96]){this.gradientColorSkybox&&(this.gradientColorSkybox.visible=!1),this.viewer.sceneManager.setBackground(this.rgb2Color(e)),this.viewer.enableRender()}setSkyboxByGradientColors(e=[.52,.71,.96],t=[1,1,1],r=[.6,.6,.6]){this.gradientColorSkybox&&(this.gradientColorSkybox.removeFromParent(),this.gradientColorSkybox=void 0);let i=this.rgb2Color(e),n=this.rgb2Color(t),a=this.rgb2Color(r);this.gradientColorSkybox=new $u(i,n,a),this.viewer.scene.add(this.gradientColorSkybox),this.viewer.enableRender()}setSkyboxByCubeTexture(e){this.gradientColorSkybox&&(this.gradientColorSkybox.visible=!1),(new N_).load(e,(e=>{this.viewer.sceneManager.setBackground(e),this.viewer.enableRender()}))}updateGradientColorSkybox(e){if(!this.gradientColorSkybox)return;let t=2*(e.max.x-e.min.x+(e.max.y-e.min.y)+(e.max.z-e.min.z));t<$u.MIN_SKY_RADIUS?t=$u.MIN_SKY_RADIUS:t>$u.MAX_SKY_RADIUS&&(t=$u.MAX_SKY_RADIUS),this.gradientColorSkybox.geometry=new Al(t,32,15);let r=this.viewer.getCameraManager(),i=2*t;r.camera.far<=i&&de.warn(`[Skybox] camera.far is ${r.camera.far}, which is too small, suggest to changed to ${i}`),this.viewer.enableRender()}destroy(){var e;super.destroy(),null==(e=this.gradientColorSkybox)||e.removeFromParent(),this.gradientColorSkybox=void 0,this.viewer.sceneManager.setBackground(null)}rgb2Color(e){let t=e[0]||0,r=e[1]||0,i=e[2]||0,n=new dt;return n.setRGB(t,r,i),n}},H9=V9;H9.DEFAULT_ID="SkyboxPlugin";var US=ra(_m(),1),ks=ra(_m(),1),GD=(e=>(e[e.ClickEvent=1]="ClickEvent",e[e.Popup=2]="Popup",e[e.SubMenu=3]="SubMenu",e[e.Switch=4]="Switch",e))(GD||{}),z9=(e=>(e.HomeView="HomeView",e.OrthoMode="OrthoMode",e.Measure="Measure",e.MeasureDistance="MeasureDistance",e.MeasureArea="MeasureArea",e.MeasureAngle="MeasureAngle",e.MeasureCoordinate="MeasureCoordinate",e.MeasureClear="MeasureClear",e.MarkupVisibility="MarkupVisibility",e.Markup="Markup",e.MarkupArrow="Arrow",e.MarkupRect="Rect",e.MarkupCloudRect="CloudRect",e.MarkupPolyLine="PolyLine",e.MarkupCloudLine="CloudLine",e.MarkupEllipse="Ellipse",e.MarkupCircle="Circle",e.MarkupDot="Dot",e.MarkupText="Text",e.MarkupX="X",e.MarkupStrokeStyle="StrokeStyle",e.MarkupLineWidth="LineWidth",e.MarkupLineWidth2="LineWidth2",e.MarkupLineWidth5="LineWidth5",e.MarkupLineWidth10="LineWidth10",e.MarkupFontSize="FontSize",e.MarkupFontSize14="FontSize14",e.MarkupFontSize18="FontSize18",e.MarkupFontSize24="FontSize24",e.MarkupClear="MarkupClear",e.MarkupQuit="MarkupQuit",e.Section="Section",e.SectionBox="SectionBox",e.SectionPlane="SectionPlane",e.SectionAxis="SectionAxis",e.BimTree="BimTree",e.Viewpoint="Viewpoint",e.Annotation="Annotation",e.Property="Property",e.Settings="Settings",e.Compared="Compared",e.QuitCompare="QuitCompare",e.Fullscreen="FullScreen",e.SceneClear="SceneClear",e.Layers="Layers",e.ZoomToRectangle="ZoomToRectangle",e.Screenshot="GetScreenshot",e))(z9||{}),qD=[["HomeView","OrthoMode","FullScreen","ZoomToRectangle","GetScreenshot"],["Measure","Markup","MarkupVisibility","Section"],["BimTree","Viewpoint","Annotation","Property","Compared","QuitCompare","Layers"],["Settings"]],Cm=class{constructor(e,t,r=[]){this.visible=!0,this.menuList=new Map,this.keydown=e=>{if(this.visible&&"Escape"===e.code){let e=this.viewer.findPlugin(Pf.DEFAULT_ID),t=this.viewer.findPlugin(If.DEFAULT_ID);if(null!=e&&e.isMeasuring()||null!=t&&t.isActive())return;this.clearActive()}},this.viewer=e,this.menuCfg=t,this.groupCfg=r,this.init(),window.addEventListener("keydown",this.keydown,!1)}init(){var e;let t=document.createElement("div");t.classList.add("toolbar");let r=this.menuCfg;this.groupCfg.forEach(((e,i)=>{let n=document.createElement("div");n.classList.add("toolbar-group");let a=document.createElement("div");a.classList.add("toolbar-group-division"),e.forEach((e=>{let t=(0,ks.get)(r,e);if(t&&!1!==t.visible){let r=this.createToolbarMenu(this.viewer,e,t);n.appendChild(r.element)}})),n.hasChildNodes()&&(i&&t.appendChild(a),t.appendChild(n))})),this.element=t,null==(e=this.viewer.widgetContainer)||e.appendChild(t),t.oncontextmenu=e=>{e.preventDefault()}}clearActive(){if(this.activateMenuId){let e=this.menuList.get(this.activateMenuId);null==e||e.setActive(!1),this.activateMenuId=void 0}}setActive(e,t){let r=this.menuList.get(e);null==r||r.setActive(t),this.activateMenuId=t?e:void 0}createToolbarMenu(e,t,r,i){let n=new G9(e,this,t,r,i);if(this.menuList.set(t,n),r.children){let t=document.createElement("div");t.classList.add("toolbar-sub-menu");let i=document.createElement("div");i.classList.add("toolbar-sub-menu-list"),t.appendChild(i),(0,ks.forIn)(r.children,((t,r)=>{if(t&&!1!==t.visible){let a=this.createToolbarMenu(e,r,t,n);i.appendChild(a.element)}})),n.element.appendChild(t)}return n}updateMenu(e,t){(0,ks.assign)(this.menuCfg[e],t),this.refresh()}updateMenus(e){(0,ks.forEach)(e,(({menuId:e,config:t})=>{(0,ks.assign)(this.menuCfg[e],t)})),this.refresh()}addMenu(e,t,r){if((0,ks.keys)(this.menuCfg).includes(e))de.error("[Toolbar]",e,"exists.");else{if((0,ks.assign)(this.menuCfg,{[e]:t}),r){let[t,i]=r;if(t>this.groupCfg.length-1)this.groupCfg=(0,ks.concat)(this.groupCfg,[[e]]);else{let r=this.groupCfg[t];this.groupCfg[t]=i>r.length-1?(0,ks.concat)(r,e):(0,ks.concat)((0,ks.take)(r,i),e,(0,ks.takeRight)(r,r.length-i))}}else this.groupCfg=(0,ks.concat)(this.groupCfg,[[e]]);this.refresh()}}refresh(){this.element&&this.element.remove(),this.element=void 0,this.menuList.clear(),this.init()}show(){this.element&&(this.element.style.display=""),this.visible=!0}hide(){this.element&&(this.element.style.display="none"),this.visible=!1}destroy(){this.element&&this.element.remove(),this.element=void 0,this.menuList.clear(),window.removeEventListener("keydown",this.keydown,!1)}},G9=class{constructor(e,t,r,i,n){this.eventBus=Vb(),this.toolbar=t,this.menuId=r,this.active=i.defaultActive||!1,this.element=i.customElement&&i.customElement(e,this.menuId,i)||this.createButton(e,this.menuId,i),this.eventBus.on("activitychange",(t=>{t?(this.element.classList.add("active"),(0,ks.forEach)(i.mutexIds,(e=>{var t;let r=null==(t=this.toolbar)?void 0:t.menuList.get(e);r&&r.active&&r.setActive(!1)})),i.onActive&&i.onActive(e)):(this.element.classList.remove("active"),i.onDeactive&&i.onDeactive(e)),this.element.firstChild instanceof HTMLElement&&EP(this.element.firstChild.classList,i.icon,this.active),n&&n.setActive(t)})),Pn.isMobile?(this.element.ontouchstart=t=>{switch(this.element.classList.toggle("toolbar-parent-menu-active"),this.element.classList.toggle("toolbar-menu-active"),t.stopPropagation(),i.type){case 1:i.onClick&&i.onClick(e,this.toolbar,t);break;case 4:i.onClick&&i.onClick(e,this.toolbar,t),this.active=!this.active,this.toolbar.activateMenuId=this.menuId,this.eventBus.emit("activitychange",this.active)}},this.element.addEventListener("touchend",(()=>{n&&n.element.classList.remove("toolbar-parent-menu-active")}))):(this.element.onclick=t=>{switch(t.stopPropagation(),i.type){case 1:i.onClick&&i.onClick(e,this.toolbar,t);break;case 4:i.onClick&&i.onClick(e,this.toolbar,t),this.active=!this.active,this.toolbar.activateMenuId=this.menuId,this.eventBus.emit("activitychange",this.active)}n&&n.element.classList.remove("toolbar-parent-menu-active")},this.element.addEventListener("mouseover",(()=>{this.element.classList.toggle("toolbar-parent-menu-active"),this.element.classList.add("toolbar-menu-active")})),this.element.addEventListener("mouseout",(()=>{this.element.classList.contains("toolbar-parent-menu-active")&&this.element.classList.remove("toolbar-parent-menu-active"),this.element.classList.remove("toolbar-menu-active")})))}createButton(e,t,r){let i=document.createElement("div");i.id=t,i.classList.add("toolbar-menu"),r.defaultActive&&i.classList.add("active"),r.children&&i.classList.add("toolbar-parent-menu");let{default:n="icon-new",iconFont:a=AP}=r.icon;return i.innerHTML=`<div class="icon ${a} ${n}"></div>`,i.title=xn(r.menuName),i.innerHTML+=`<span>${i.title}</span>`,i}setActive(e){this.active=e,e?this.element.classList.add("toolbar-menu-active"):this.element.classList.remove("toolbar-menu-active"),this.eventBus.emit("activitychange",this.active)}},Zu=e=>e.findPlugin(If.DEFAULT_ID),ad=(e,t)=>{let r=Zu(e);r&&(r.isActive()||r.activate(),r.setDrawType(t))},od=e=>{let t=Zu(e);null==t||t.deactivate()},ARe={Arrow:{menuName:"Toolbar.markupArrow",icon:{default:"icon-arrow"},type:4,onActive:e=>{ad(e,"ArrowMarkup")},onDeactive(e){od(e)},mutexIds:["Rect","CloudRect","PolyLine","CloudLine","Ellipse","Circle","Dot","Text","X"]},Rect:{defaultActive:!1,menuName:"Toolbar.markupRect",icon:{default:"icon-rectangle"},type:4,onActive:e=>{ad(e,"RectMarkup")},onDeactive(e){od(e)},mutexIds:["Arrow","CloudRect","PolyLine","CloudLine","Ellipse","Circle","Dot","Text","X"]},CloudRect:{defaultActive:!0,menuName:"Toolbar.markupCloudRect",icon:{default:"icon-cloud"},type:4,onActive:e=>{ad(e,"CloudRectWithTextMarkup")},onDeactive(e){od(e)},mutexIds:["Rect","Arrow","PolyLine","CloudLine","Ellipse","Circle","Dot","Text","X"]},PolyLine:{menuName:"Toolbar.markupPolyLine",icon:{default:"icon-polyline"},type:4,onActive:e=>{ad(e,"PolylineMarkup")},onDeactive(e){od(e)},mutexIds:["Rect","Arrow","CloudRect","CloudLine","Ellipse","Circle","Dot","Text","X"]},CloudLine:{menuName:"Toolbar.markupCloudLine",icon:{default:"icon-cloud-segment"},type:4,onActive:e=>{ad(e,"CloudLineMarkup")},onDeactive(e){od(e)},mutexIds:["Rect","CloudRect","PolyLine","Arrow","Ellipse","Circle","Dot","Text","X"]},Ellipse:{menuName:"Toolbar.markupEllipse",icon:{default:"icon-oval"},type:4,onActive:e=>{ad(e,"EllipseMarkup")},onDeactive(e){od(e)},mutexIds:["Rect","CloudRect","PolyLine","CloudLine","Arrow","Circle","Dot","Text","X"]},Circle:{menuName:"Toolbar.markupCircle",icon:{default:"icon-round"},type:4,onActive:e=>{ad(e,"CircleMarkup")},onDeactive(e){od(e)},mutexIds:["Rect","CloudRect","PolyLine","CloudLine","Ellipse","Arrow","Dot","Text","X"]},Dot:{menuName:"Toolbar.markupDot",icon:{default:"icon-round"},type:4,onActive:e=>{ad(e,"DotMarkup")},onDeactive(e){od(e)},mutexIds:["Rect","CloudRect","PolyLine","CloudLine","Ellipse","Arrow","Circle","Text","X"]},X:{menuName:"Toolbar.markupX",icon:{default:"icon-cross"},type:4,onActive:e=>{ad(e,"XMarkup")},onDeactive(e){od(e)},mutexIds:["Rect","CloudRect","PolyLine","CloudLine","Ellipse","Circle","Dot","Arrow","Text"]},Text:{menuName:"Toolbar.markupText",icon:{default:"icon-text"},type:4,onActive:e=>{ad(e,"TextMarkup")},onDeactive(e){od(e)},mutexIds:["Rect","CloudRect","PolyLine","CloudLine","Ellipse","Circle","Dot","Arrow","X"]},StrokeStyle:{menuName:"Toolbar.markupStroke",icon:{default:"icon-color-red"},type:1,onClick:(e,t,r)=>{let i=Zu(e),n=r.target.parentElement,a=null==n?void 0:n.firstElementChild,s=document.createElement("input");s.setAttribute("type","color"),s.value=Br.rgba2Color(null==i?void 0:i.getLineColor()),s.click(),s.oninput=e=>{let t=e.target.value;null==i||i.setLineColor(Br.color2rgba(t)),a.style.color=t}}},LineWidth:{menuName:"Toolbar.markupLineWidth",icon:{default:"icon-line"},customElement(e,t,r){let i=document.createElement("div");return i.id=t,i.classList.add("toolbar-menu"),r.children&&i.classList.add("toolbar-parent-menu"),i.title=xn(r.menuName),i.innerHTML+=`<span>${i.title}</span>`,i},type:3,children:{LineWidth2:{defaultActive:!0,icon:{default:"icon-line-2"},onClick:e=>{let t=Zu(e);null==t||t.setLineWidth(2)},type:4,menuName:"Toolbar.markupLineWidth2",mutexIds:["LineWidth5","LineWidth10"]},LineWidth5:{icon:{default:"icon-line-3"},onClick:e=>{let t=Zu(e);null==t||t.setLineWidth(3)},type:4,menuName:"Toolbar.markupLineWidth5",mutexIds:["LineWidth2","LineWidth10"]},LineWidth10:{icon:{default:"icon-line-4"},onClick:e=>{let t=Zu(e);null==t||t.setLineWidth(4)},type:4,menuName:"Toolbar.markupLineWidth10",mutexIds:["LineWidth2","LineWidth5"]}}},FontSize:{menuName:"Toolbar.markupFontSize",icon:{default:"icon-font"},customElement(e,t,r){let i=document.createElement("div");return i.id=t,i.classList.add("toolbar-menu"),r.children&&i.classList.add("toolbar-parent-menu"),i.title=xn(r.menuName),i.innerHTML+=`<span>${i.title}</span>`,i},type:3,children:{FontSize14:{icon:{default:"icon-font14"},onClick:e=>{let t=Zu(e);null==t||t.setFontSize(14)},type:4,menuName:"",mutexIds:["FontSize18","FontSize24"]},FontSize18:{defaultActive:!0,icon:{default:"icon-font18"},onClick:e=>{let t=Zu(e);null==t||t.setFontSize(18)},type:4,menuName:"",mutexIds:["FontSize14","FontSize24"]},FontSize24:{icon:{default:"icon-font24"},onClick:e=>{let t=Zu(e);null==t||t.setFontSize(24)},type:4,menuName:"",mutexIds:["FontSize14","FontSize18"]}}},MarkupClear:{icon:{default:"icon-eraser"},onClick:e=>{de.info("[Toolbar]","Clear Markup",e);let t=Zu(e);null==t||t.clear()},type:1,menuName:"Toolbar.clearMarkup"},MarkupQuit:{icon:{default:""},customElement(e,t,r){let i=document.createElement("div");return i.id=t,i.classList.add("toolbar-menu"),r.children&&i.classList.add("toolbar-parent-menu"),i.title=xn(r.menuName),i.innerHTML+=`<span>${i.title}</span>`,i},onClick:e=>{let t=Zu(e);null==t||t.deactivate(),e.dispatchEvent("markupdeactivate")},type:1,menuName:"Toolbar.quitMarkup"}},RRe=[["Arrow","Rect","CloudRect","PolyLine","Ellipse","Circle","Text","StrokeStyle","FontSize","MarkupClear","MarkupQuit"]],jD=class extends Cm{constructor(e,t,r=[]){super(e,t,r),this.keydown=()=>{}}},tx=class{constructor(e,t,r=document.body){this.container=r,this.isFollowing=!1,this.diffX=0,this.diffY=0,this.start=e=>{this.isFollowing=!0,this.diffX=e.clientX-this.element.offsetLeft,this.diffY=e.clientY-this.element.offsetTop},this.stop=()=>{this.isFollowing=!1},this.follow=e=>{if(!this.isFollowing)return;let t=e.clientX-this.diffX,r=e.clientY-this.diffY;this.element.style.left=t+"px",this.element.style.top=r+"px"},this.element=document.createElement("div"),this.element.id=e,this.element.classList.add("pop-panel");let i=document.createElement("div");i.classList.add("pop-panel-header"),i.append(t),this.element.appendChild(i),this.header=i;let n=document.createElement("div");n.classList.add("pop-panel-body"),this.element.appendChild(n),this.body=n,i.addEventListener("mousedown",this.start),i.addEventListener("mouseup",this.stop),document.body.addEventListener("mousemove",this.follow),this.container.appendChild(this.element)}destroy(){document.body.removeEventListener("mousemove",this.follow),this.element.removeEventListener("mousedown",this.start),this.element.removeEventListener("mouseup",this.stop),this.element.remove()}},WD=class extends tx{constructor(e){super("axis-section-pop-panel",xn("Toolbar.axisSection"),e.widgetContainer),this.axis="x",this.isVisible=!0,this.keydown=e=>{"Escape"===e.code&&this.destroy()};let t=e.findPlugin(Yu.DEFAULT_ID);this.section=t.getActiveSection(),this.createGroupSelectLayout(),this.addGroupSelectItems(),this.createActiveSelectLayout(),this.addActiveItems(),window.addEventListener("keydown",this.keydown)}destroy(){super.destroy(),window.removeEventListener("keydown",this.keydown)}createGroupSelectLayout(){let e=document.createElement("div");e.classList.add("pop-panel-group-select"),this.body.appendChild(e),this.groupSelectNode=e}addGroupSelectItems(){let e=(e,t,r=!1)=>{let i=document.createElement("div");return i.classList.add("pop-panel-item"),i.setAttribute("itemName",e),i.append(t),r&&i.classList.add("active"),this.groupSelectNode&&this.groupSelectNode.appendChild(i),i},t=(e,t)=>a=>{a.stopPropagation(),this.activeItem!==e&&(r.classList.remove("active"),i.classList.remove("active"),n.classList.remove("active"),this.activeItem=e,t.classList.add("active"),this.section.setActiveAxis(e))},r=e("X","X",!0);r.onclick=t("X",r);let i=e("Y","Y");i.onclick=t("Y",i);let n=e("Z","Z");n.onclick=t("Z",n)}createActiveSelectLayout(){let e=document.createElement("div");e.classList.add("pop-panel-active-select"),this.body.appendChild(e),this.activeSelectNode=e}addActiveItems(){let e=(e,t)=>{let r=document.createElement("i");r.classList.add(Yi),r.classList.add(t),e.innerHTML="",e.appendChild(r)},t=xn("ContextMenu.hideSectionPlane"),r=xn("ContextMenu.showSectionPlane"),i=((t,r,i="")=>{let n=document.createElement("div");return n.classList.add("pop-panel-item"),r&&n.setAttribute("title",r),n.setAttribute("itemName",t),n.setAttribute("isActive","false"),e(n,i),n})("visible",t,"icon-hidesectionplane");i.onclick=()=>{this.isVisible=!this.isVisible,this.isVisible?(e(i,"icon-hidesectionplane"),i.setAttribute("title",t)):(e(i,"icon-showsectionplane"),i.setAttribute("title",r)),this.section.setSectionPlaneVisible(this.isVisible)},this.activeSelectNode&&this.activeSelectNode.appendChild(i)}},XD=class extends tx{constructor(e){super("pick-section-pop-panel","拾取面剖切",e.widgetContainer),this.isVisible=!0,this.enabled=!0,this.keydown=e=>{"Escape"===e.code&&this.destroy()};let t=e.findPlugin(Yu.DEFAULT_ID);this.section=t.getActiveSection(),this.createActiveSelectLayout(),this.addActiveItems(),window.addEventListener("keydown",this.keydown)}destroy(){super.destroy(),window.removeEventListener("keydown",this.keydown)}createActiveSelectLayout(){let e=document.createElement("div");e.classList.add("pop-panel-active-select"),this.body.appendChild(e),this.activeSelectNode=e}addActiveItems(){let e=(e,t)=>{let r=document.createElement("i");r.classList.add(Yi),r.classList.add(t),e.innerHTML="",e.appendChild(r)},t=(t,r,i="")=>{let n=document.createElement("div");return n.classList.add("pop-panel-item"),r&&n.setAttribute("title",r),n.setAttribute("itemName",t),n.setAttribute("isActive","false"),e(n,i),n},r=xn("ContextMenu.hideSectionPlane"),i=xn("ContextMenu.showSectionPlane"),n=xn("PopPanel.reset"),a=t("visible",r,"icon-hidesectionplane");a.onclick=()=>{this.enabled&&(this.isVisible=!this.isVisible,this.isVisible?(e(a,"icon-hidesectionplane"),a.setAttribute("title",r)):(e(a,"icon-showsectionplane"),a.setAttribute("title",i)),this.section.setSectionPlaneVisible(this.isVisible))},this.activeSelectNode&&this.activeSelectNode.appendChild(a),this.visibleNode=a;let s=t("reset",n,"icon-reset");s.onclick=t=>{t.stopPropagation(),this.enabled&&(this.isVisible=!0,e(a,"icon-hidesectionplane"),a.setAttribute("title",r),this.section.reset())},this.activeSelectNode&&this.activeSelectNode.appendChild(s),this.resetNode=s}enable(){this.enabled=!0,this.visibleNode&&this.visibleNode.classList.remove("disable")}disable(){this.enabled=!1,this.visibleNode&&this.visibleNode.classList.add("disable")}},Io,q9=e=>e.findPlugin(If.DEFAULT_ID),ll=e=>e.findPlugin(Pf.DEFAULT_ID),NS=e=>e.findPlugin(Yu.DEFAULT_ID),R3t=e=>e.findPlugin(Mm.DEFAULT_ID),YD=e=>t=>{let r=ll(t),i=NS(t);null==i||i.deactivate(),null==r||r.activate(e)},BS=e=>{let t=ll(e);null==t||t.deactivate()},j9=e=>{let t=ll(e);t&&(t.deactivate(),t.getData().forEach((e=>t.setVisibleById(e.id,!1))))},W9=e=>{let t=ll(e);t&&(t.deactivate(),t.getData().forEach((e=>t.setVisibleById(e.id,!0))));let r=NS(e);null==r||r.deactivate(!1),null==Io||Io.destroy(),Io=void 0,e.enableRender()},CRe={HomeView:{icon:{default:"icon-home",active:"icon-home-filled",iconFont:Yi},menuName:"Toolbar.homeView",type:1,onClick:e=>{e.goToHomeView()}},OrthoMode:{icon:{default:"icon-orthomode",active:"icon-orthomode-filled",iconFont:Yi},menuName:"Toolbar.orthoView",type:4,onActive:e=>{de.info("[Toolbar]","Enter OrthoMode"),e.setCameraProjection("Orthographic")},onDeactive:e=>{de.info("[Toolbar]","Exit OrthoMode"),e.setCameraProjection("Perspective")}},Measure:{icon:{default:"icon-measure",active:"icon-measure-filled",iconFont:Yi},menuName:"Toolbar.measurement",type:3,children:{MeasureDistance:{icon:{default:"icon-measure-distance"},menuName:"Toolbar.distanceMeasurement",onActive:YD("Distance"),onDeactive:BS,type:4,mutexIds:["MeasureArea","MeasureAngle","MeasureCoordinate"]},MeasureArea:{icon:{default:"icon-measure-area-color"},onActive:YD("Area"),onDeactive:BS,type:4,menuName:"Toolbar.areaMeasurement",mutexIds:["MeasureDistance","MeasureAngle","MeasureCoordinate"]},MeasureAngle:{menuName:"Toolbar.angleMeasurement",icon:{default:"icon-angle-measure"},type:4,onActive:YD("Angle"),onDeactive:BS,mutexIds:["MeasureDistance","MeasureArea","MeasureCoordinate"]},MeasureCoordinate:{menuName:"Toolbar.coordinateMeasurement",icon:{default:"icon-distancemeasure",iconFont:Yi},type:4,onActive:YD("Coordinate"),onDeactive:BS,mutexIds:["MeasureDistance","MeasureArea","MeasureAngle"]},MeasureClear:{icon:{default:"icon-clear",active:"icon-clear-filled",iconFont:Yi},onClick:e=>{let t=ll(e);null==t||t.deactivate(),null==t||t.clear()},type:1,menuName:"Toolbar.clearMeasurement"}},mutexIds:["Section","SectionAxis","SectionBox","SectionPlane"]},Section:{icon:{default:"icon-section",active:"icon-section-filled",iconFont:Yi},menuName:"Toolbar.section",type:3,children:{SectionAxis:{icon:{default:"icon-sectionplane",active:"icon-sectionplane-filled",iconFont:Yi},menuName:"Toolbar.axisSection",type:4,onActive:e=>{j9(e);let t=NS(e);null==t||t.activate("AxisPlaneSection"),null==Io||Io.destroy(),Io=new WD(e)},onDeactive:W9,mutexIds:["SectionBox","SectionPlane"]},SectionPlane:{icon:{default:"icon-choosesectionplane",active:"icon-choosesectionplane-filled",iconFont:Yi},menuName:"Toolbar.pickSectionPlane",type:4,onActive:e=>{j9(e);let t=NS(e);null==t||t.activate("PickPlaneSection"),null==Io||Io.destroy(),Io=new XD(e)},onDeactive:W9,mutexIds:["SectionAxis","SectionBox"]},SectionBox:{icon:{default:"icon-sectionbox",active:"icon-sectionbox-filled",iconFont:Yi},menuName:"Toolbar.sectionBox",type:4,onActive:e=>{j9(e);let t=NS(e);null==t||t.activate("ObjectsBoxSection"),null==Io||Io.destroy()},onDeactive:W9,mutexIds:["SectionAxis","SectionPlane"]}},mutexIds:["Measure","MeasureDistance","MeasureArea","MeasureAngle","MeasureCoordinate"]},BimTree:{icon:{default:"icon-bimtree",active:"icon-bimtree-filled",iconFont:Yi},menuName:"Toolbar.bimTree",type:4,onActive:()=>{de.info("[Toolbar]","Activate Bim Tree")},onDeactive:()=>{de.info("[Toolbar]","Deactivate Bim Tree")},visible:!1},Viewpoint:{icon:{default:"icon-viewpoint",active:"icon-viewpoint-filled",iconFont:Yi},menuName:"Toolbar.viewpoint",type:4,onActive:()=>{de.info("[Toolbar]","Activate Viewpoint")},onDeactive:()=>{de.info("[Toolbar]","Deactivate Viewpoint")},visible:!1},Annotation:{icon:{default:"icon-annotation",active:"icon-annotation-filled",iconFont:Yi},menuName:"Toolbar.annotation",type:4,onActive:()=>{de.info("[Toolbar]","Activate Annotation")},onDeactive:()=>{de.info("[Toolbar]","Deactivate Annotation")},visible:!1},Property:{icon:{default:"icon-property",active:"icon-property-filled",iconFont:Yi},menuName:"Toolbar.property",type:4,onActive:()=>{de.info("[Toolbar]","Activate Property")},onDeactive:()=>{de.info("[Toolbar]","Deactivate Property")},visible:!1},Settings:{icon:{default:"icon-settings",active:"icon-settings-filled",iconFont:Yi},menuName:"Toolbar.settings",type:4,onActive:()=>{de.info("[Toolbar]","Activate Settings")},onDeactive:()=>{de.info("[Toolbar]","Deactivate Settings")},visible:!1},FullScreen:{icon:{default:"icon-fullscreen",active:"icon-fullscreen-filled",iconFont:Yi},menuName:"Toolbar.fullscreen",type:4,onClick:(e,t)=>{var r;let i=()=>{let e=null==t?void 0:t.menuList.get("FullScreen");e&&e.setActive(Ut.isFullScreen())};Ut.isFullScreen()?(Ut.exitFullscreen(),window.removeEventListener("resize",i)):Ut.fullScreen(null==(r=e.viewerContainer)?void 0:r.parentElement),window.addEventListener("resize",i)}}},PRe={HomeView:{icon:{default:"icon-zhushitu",active:"icon-zhushitu"},menuName:"Toolbar.homeView",type:1,onClick:e=>{e.goToHomeView()}},ZoomToRectangle:{icon:{default:"icon-kuangxuanfangda",active:"icon-kuangxuanfangda"},menuName:"Toolbar.zoomToRectangle",type:4,onClick:(e,t)=>{let r=e;r.removeEventListener("boxselectdeactivate"),r.addEventListener("boxselectdeactivate",(()=>{null==t||t.setActive("ZoomToRectangle",!1)})),r.zoomToRect()},mutexIds:["GetScreenshot"]},GetScreenshot:{icon:{default:"icon-frame-clipping",active:"icon-frame-clipping"},menuName:"Toolbar.screenshot",type:4,onClick:(e,t)=>{let r=e;r.removeEventListener("boxselectdeactivate"),r.addEventListener("boxselectdeactivate",(()=>{null==t||t.setActive("GetScreenshot",!1)}));let i=R3t(e);null==i||i.getScreenshotAsync().then((e=>{if(de.info("[Toolbar] getScreenshot() returns:",null==e?void 0:e.base64Image),null==e||!e.base64Image)throw"[Toolbar] Image data is empty!";let t=document.createElement("a");t.href=null==e?void 0:e.base64Image,t.download="",t.click()})).catch((e=>{de.error("[Toolbar] Failed to get screenshot, reason:",e),null==t||t.setActive("GetScreenshot",!1)}))},mutexIds:["ZoomToRectangle"]},Measure:{icon:{default:"icon-celiang1",active:"icon-celiang1"},menuName:"Toolbar.measurement",type:3,children:{MeasureDistance:{icon:{default:"icon-measure-distance"},menuName:"Toolbar.distanceMeasurement",onActive:e=>{let t=ll(e);null==t||t.activate("Distance")},onDeactive:e=>{let t=ll(e);null==t||t.deactivate()},type:4,mutexIds:["MeasureArea","MeasureAngle","MeasureCoordinate","ZoomToRectangle","GetScreenshot"]},MeasureArea:{icon:{default:"icon-measure-area-color"},onActive:e=>{let t=ll(e);null==t||t.activate("Area")},onDeactive:e=>{let t=ll(e);null==t||t.deactivate()},type:4,menuName:"Toolbar.areaMeasurement",mutexIds:["MeasureDistance","MeasureAngle","MeasureCoordinate","ZoomToRectangle","GetScreenshot"]},MeasureAngle:{menuName:"Toolbar.angleMeasurement",icon:{default:"icon-angle-measure"},type:4,onActive:e=>{let t=ll(e);null==t||t.activate("Angle")},onDeactive:e=>{let t=ll(e);null==t||t.deactivate()},mutexIds:["MeasureDistance","MeasureArea","MeasureCoordinate","ZoomToRectangle","GetScreenshot"]},MeasureCoordinate:{menuName:"Toolbar.coordinateMeasurement",icon:{default:"icon-distancemeasure",iconFont:Yi},type:4,onActive:e=>{let t=ll(e);null==t||t.activate("Coordinate")},onDeactive:e=>{let t=ll(e);null==t||t.deactivate()},visible:!1,mutexIds:["MeasureDistance","MeasureArea","MeasureAngle","ZoomToRectangle","GetScreenshot"]},MeasureClear:{icon:{default:"icon-clear",active:"icon-clear-filled",iconFont:Yi},onClick:e=>{let t=ll(e);null==t||t.clear()},type:1,menuName:"Toolbar.clearMeasurement"}}},Markup:{icon:{default:"icon-annotation"},menuName:"Toolbar.markup",type:1,onClick:(e,t)=>{BS(e),null==t||t.updateMenu("Measure",{defaultActive:!1}),null==t||t.setActive("ZoomToRectangle",!1);let r=q9(e);r?(r.getData().forEach((e=>r.setMarkupVisibility(e.id,!0))),null==t||t.setActive("MarkupVisibility",!1),r.activate(),r.setDrawType("CloudRectWithTextMarkup"),e.dispatchEvent("markupactivate")):de.warn("[Toolbar] MarkupPlugin is not installed!")}},MarkupVisibility:{icon:{default:"icon-annotation-show",active:"icon-annotation-hide"},menuName:"Toolbar.markupVisibility",type:4,onActive:e=>{let t=q9(e);t?t.getData().forEach((e=>t.setMarkupVisibility(e.id,!1))):de.warn("[Toolbar] MarkupPlugin is not installed!")},onDeactive:e=>{let t=q9(e);t?t.getData().forEach((e=>t.setMarkupVisibility(e.id,!0))):de.warn("[Toolbar] MarkupPlugin is not installed!")},visible:!0},Settings:{icon:{default:"icon-settings",active:"icon-settings-filled",iconFont:Yi},menuName:"Toolbar.settings",type:4,onActive:()=>{de.info("[Toolbar]","Activate Settings")},onDeactive:()=>{de.info("[Toolbar]","Deactivate Settings")},visible:!0},Compared:{icon:{default:"icon-compared"},menuName:"Toolbar.compared",type:4,onActive:()=>{de.info("[Toolbar]","Activate Compare")},onDeactive:()=>{de.info("[Toolbar]","Deactivate Compare")},visible:!1},QuitCompare:{icon:{default:"icon-compared"},menuName:"Toolbar.quitCompare",type:4,onActive:()=>{de.info("[Toolbar]","Activate Compare")},onDeactive:()=>{de.info("[Toolbar]","Deactivate Compare")},visible:!1},Layers:{icon:{default:"icon-tucengkongzhi",active:"icon-tucengkongzhi"},menuName:"Toolbar.layers",type:4,onClick:()=>{}},FullScreen:{icon:{default:"icon-quanping",active:"icon-quanping"},menuName:"Toolbar.fullscreen",type:4,onClick:(e,t)=>{var r;let i=()=>{let e=null==t?void 0:t.menuList.get("FullScreen");e&&e.setActive(Ut.isFullScreen())};Ut.isFullScreen()?(Ut.exitFullscreen(),window.removeEventListener("resize",i)):Ut.fullScreen(null==(r=e.viewerContainer)?void 0:r.parentElement),window.addEventListener("resize",i)}}},Y9=class extends vn{constructor(e,t){super(e,{id:(null==t?void 0:t.id)||Y9.DEFAULT_ID}),this.onMarkupActivated=()=>{if(!this.markupToolbar){let e=(0,US.merge)(this.cfg.markupMenuCfg||[],ARe),t=(0,US.merge)(this.cfg.markupGroupCfg||[],RRe);this.markupToolbar=new jD(this.viewer,e,t),this.markupToolbar.hide()}this.toolbar.hide(),this.markupToolbar.show()},this.onMarkupDeactivated=()=>{var e;null==(e=this.markupToolbar)||e.hide(),this.toolbar.show()},this.cfg=t||{};let r=(0,US.merge)({},PRe,this.cfg.menuConfig),i=(0,US.merge)(this.cfg.groupConfig||[],qD);this.toolbar=new Cm(e,r,i),this.viewer.addEventListener("markupactivate",this.onMarkupActivated),this.viewer.addEventListener("markupdeactivate",this.onMarkupDeactivated)}getToolbar(){return this.toolbar}getMarkupToolbar(){return this.markupToolbar}setActive(e,t){this.toolbar.setActive(e,t)}destroy(){var e;super.destroy(),null==(e=this.markupToolbar)||e.destroy(),this.toolbar.destroy()}},X9=Y9;X9.DEFAULT_ID="Viewer2dToolbarPlugin";var Z9=ra(_m(),1),K9=class extends vn{constructor(e,t){super(e,{id:(null==t?void 0:t.id)||K9.DEFAULT_ID}),this.cfg=t||{};let r=(0,Z9.merge)({},CRe,this.cfg.menuConfig),i=(0,Z9.merge)(this.cfg.groupConfig||[],qD);this.toolbar=new Cm(e,r,i)}getToolbar(){return this.toolbar}setActive(e,t){this.toolbar.setActive(e,t)}destroy(){super.destroy(),this.toolbar.destroy()}},$9=K9;function C3t(e,t,r,i,n){let a=document.createElement("span");return a.style.font="1px serif",a.style.fontFamily=e,a.style.fontSize=`${t}px`,a.style.fontStyle=r,a.style.fontVariant=i,a.style.fontWeight=n,a.style.font}$9.DEFAULT_ID="Viewer3dToolbarPlugin";var P3t=Object.freeze({text:"",color:"#fff",alignment:"center",backgroundColor:0,fontFamily:"sans-serif",fontSize:16,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",lineGap:1/4,padding:.5,strokeColor:"#000",strokeWidth:0}),$D=class extends bi{constructor(e,t=document.createElement("canvas")){super(t),this.canvas=t,this.textTexture=!0,this.needsRedraw=!0,this.contentOffset=0,this.lineOffset=0,this.width=0,this.height=0,this.pixelRatio=Math.max(window.devicePixelRatio||1),this.computeOptimalPixelRatio=()=>{let e=new F,t=new Te,r=new F,i=new F,n=new Te;return(a,s,o)=>{var l,h;if(n.set(this.width,this.height),n.x&&n.y){a.getWorldPosition(r),o.getWorldPosition(e);let c=r.distanceTo(e);if(o.isPerspectiveCamera&&(c*=2*Math.tan(Tr.degToRad(o.fov)/2)),(o.isPerspectiveCamera||o.isOrthographicCamera)&&(c/=o.zoom),c){a.getWorldScale(i);let e=null!=(h=null==(l=s.capabilities)?void 0:l.maxTextureSize)?h:1/0;return s.getDrawingBufferSize(t),Math.min(Math.max(i.x/c*(t.x/n.x),i.y/c*(t.y/n.y)),e/n.x,e/n.y)}}return 0}},this.cfg=on(on({},P3t),e);let{text:r}=this.cfg;this.lines=r?r.split("\n"):[];let{fontFamily:i,fontSize:n,fontStyle:a,fontVariant:s,fontWeight:o}=this.cfg;this.font=C3t(i,n,a,s,o)}getContentWidth(){let{font:e,lines:t}=this,r=document.createElement("canvas").getContext("2d");return r.font=e,Math.max(...t.map((e=>r.measureText(e).width)))}initDraw(){let{lineGap:e,padding:t,strokeWidth:r}=this.cfg;t*=this.cfg.fontSize,e*=this.cfg.fontSize,r*=this.cfg.fontSize;let i=this.lines.length,n=this.cfg.fontSize+e,a=t+r/2,s=(i?this.getContentWidth():0)+2*a,o=(i?this.cfg.fontSize+n*(i-1):0)+2*a;this.width=s,this.height=o,this.contentOffset=a,this.lineOffset=n}getDrawPosition(e){let t=this.contentOffset+this.cfg.fontSize/2;switch(e){case"left":return{x:this.contentOffset,y:t};case"right":return{x:this.width-this.contentOffset,y:t}}return{x:this.width/2,y:t}}draw(){let e=this.canvas.getContext("2d"),{alignment:t,backgroundColor:r,color:i,strokeColor:n,strokeWidth:a}=this.cfg;e.fillStyle="#"+r.toString(16),e.fillRect(0,0,e.canvas.width,e.canvas.height),Object.assign(e,{fillStyle:i,font:this.font,lineWidth:a,miterLimit:1,strokeStyle:n,textAlign:t,textBaseline:"middle"});let{x:s,y:o}=this.getDrawPosition(t),l=o;this.lines.forEach((t=>{e.fillText(t,s,l),a&&e.strokeText(t,s,l),l+=this.lineOffset}))}getDrawingBufferWidth(){return Tr.ceilPowerOfTwo(this.width*this.pixelRatio)}getDrawingBufferHeight(){return Tr.ceilPowerOfTwo(this.height*this.pixelRatio)}redrew(){if(this.needsRedraw){this.initDraw();let e=this.canvas,t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),e.width=this.getDrawingBufferWidth(),e.height=this.getDrawingBufferHeight(),e.width&&e.height?(t.save(),t.scale(e.width/this.width,e.height/this.height),this.draw(),t.restore()):e.width=e.height=1,this.needsRedraw=!1,this.needsUpdate=!0}}setPixelRatio(e){if(this.pixelRatio!==e){let t=this.getDrawingBufferWidth(),r=this.getDrawingBufferHeight();this.pixelRatio=e;let i=this.getDrawingBufferWidth(),n=this.getDrawingBufferHeight();(i!==t||n!==r)&&(this.needsRedraw=!0)}}setOptimalPixelRatio(e,t,r){let i=this.computeOptimalPixelRatio();this.setPixelRatio(i(e,t,r))}updateConfig(e){this.cfg=on(on({},this.cfg),e),this.needsRedraw=!0}},J9=(e,t,r)=>{let i=new dt(e),n=new dt(t);return i.lerp(n,r).getHex()},Xn=(e=>(e[e.Rotate0=0]="Rotate0",e[e.Rotate90=Math.PI/2]="Rotate90",e[e.Rotate180=Math.PI]="Rotate180",e[e.Rotate270=1.5*Math.PI]="Rotate270",e))(Xn||{}),ld=new F(1,0,0),lo=new F(0,1,0),Qs=new F(0,0,1),IRe={right:{text:"right",name:"RightFace",position:new F(50,0,0),rotation:{axis:lo,rad:Xn.Rotate90}},left:{text:"left",name:"LeftFace",position:new F(-50,0,0),rotation:{axis:lo,rad:Xn.Rotate270}},top:{text:"top",name:"TopFace",position:new F(0,50,0),rotation:{axis:ld,rad:Xn.Rotate270}},bottom:{text:"bottom",name:"BottomFace",position:new F(0,-50,0),rotation:{axis:ld,rad:Xn.Rotate90}},front:{text:"front",name:"FrontFace",position:new F(0,0,50),rotation:{axis:lo,rad:0}},back:{text:"back",name:"BackFace",position:new F(0,0,-50),rotation:{axis:lo,rad:Xn.Rotate180}}},ZD=class extends yr{constructor(e){super(),this.name="ViewCube",this.AXIS_COLOR_X=16711680,this.AXIS_COLOR_Y=65280,this.AXIS_COLOR_Z=255,this.FACE_BACKGROUND_COLOR=16777215,this.FACE_HOVER_BACKGROUND_COLOR=8421584,this.INNER_CUBE_WIDTH=80,this.OUTER_CUBE_WIDTH=100,this.CORNER_WIDTH=(this.OUTER_CUBE_WIDTH-this.INNER_CUBE_WIDTH)/2,this.AXIS_LENGTH=1.3*this.OUTER_CUBE_WIDTH,this.EDGE_COLOUR=13684944,this.EDGE_OPACITY=.2,this.EDGE_SIZE=new Te(this.INNER_CUBE_WIDTH,this.CORNER_WIDTH),this.CORNER_COLOR=13290452,this.CORNER_OPACITY=1,this.faces=[],this.dirty=!1,this.showAxes=(null==e?void 0:e.showAxes)||!0,this.lineColor=(null==e?void 0:e.lineColor)||9478304,this.init()}init(){this.showAxes&&this.add(this.createAxes()),this.add(this.createViewCubeFaces()),this.add(this.createViewCubeEdges()),this.add(this.createViewCubeCorners())}createAxes(){let e=this.OUTER_CUBE_WIDTH/2+1,t=new yr,r=new F(-e,-e,-e),i=new F(1,0,0),n=new F(0,1,0),a=new F(0,0,1),s=this.AXIS_LENGTH/15,o=this.AXIS_LENGTH/20,l=new yu(i,r,this.AXIS_LENGTH,this.AXIS_COLOR_X,s,o),h=new yu(n,r,this.AXIS_LENGTH,this.AXIS_COLOR_Y,s,o),c=new yu(a,r,this.AXIS_LENGTH,this.AXIS_COLOR_Z,s,o);return t.add(l,h,c),t}createViewCubeFaces(){let e=new yr,t=[],r=new Ss({color:this.FACE_BACKGROUND_COLOR,opacity:0,transparent:!0});Object.keys(IRe).forEach((e=>{let i=IRe[e],n=xn(`NavCube.${i.text}`)||i.text,a=new $D({text:n,fontSize:18,color:"#333333",backgroundColor:this.FACE_BACKGROUND_COLOR,padding:.8,fontWeight:"bold"});a.redrew();let s=new Ss({color:this.FACE_BACKGROUND_COLOR,map:a,opacity:1,transparent:!0});t.push(s);let o=this.createViewCubeFace(i.name,r,i.position,i.rotation);o.layers.enableAll(),o.userData={material:s,tick:0,translateTick:0},this.faces.push(o)})),e.add(...this.faces);let i=new lc(this.INNER_CUBE_WIDTH,this.INNER_CUBE_WIDTH,this.INNER_CUBE_WIDTH),n=new Ht(i,t);this.innerViewCubeMesh=n,e.add(n);let a=new _h(new lc(this.OUTER_CUBE_WIDTH,this.OUTER_CUBE_WIDTH,this.OUTER_CUBE_WIDTH)),s=new Mr({color:this.lineColor}),o=new Wn(a,s);return e.add(o),e.position.set(0,0,0),e}createViewCubeFace(e,t,r,i){let n=new vs(this.INNER_CUBE_WIDTH,this.INNER_CUBE_WIDTH),a=new Ht(n,t);return a.name=e,a.rotateOnAxis(i.axis,i.rad),a.position.copy(r),a}createViewCubeEdges(){let e=new yr,t=this.OUTER_CUBE_WIDTH/2+1,r=this.createEdge("TopFrontEdge",new F(0,t,t),[{axis:Qs,rad:Xn.Rotate180}]),i=this.createEdge("TopRightEdge",new F(t,t,0),[{axis:ld,rad:Xn.Rotate180},{axis:lo,rad:Xn.Rotate90},{axis:Qs,rad:0}]),n=this.createEdge("TopBackEdge",new F(0,t,-t),[{axis:Qs,rad:Xn.Rotate180},{axis:lo,rad:Xn.Rotate180}]),a=this.createEdge("TopLeftEdge",new F(-t,t,0),[{axis:ld,rad:Xn.Rotate90},{axis:lo,rad:Xn.Rotate180},{axis:Qs,rad:Xn.Rotate90}]),s=this.createEdge("BottomFrontEdge",new F(0,-t,t),[{axis:Qs,rad:0}]),o=this.createEdge("BottomRightEdge",new F(t,-t,0),[{axis:ld,rad:Xn.Rotate90},{axis:lo,rad:0},{axis:Qs,rad:Xn.Rotate90}]),l=this.createEdge("BottomBackEdge",new F(0,-t,-t),[{axis:Qs,rad:0},{axis:lo,rad:Xn.Rotate180}]),h=this.createEdge("BottomLeftEdge",new F(-t,-t,0),[{axis:ld,rad:Xn.Rotate90},{axis:lo,rad:Xn.Rotate270},{axis:Qs,rad:Xn.Rotate90}]),c=this.createEdge("FrontRightEdge",new F(t,0,t),[{axis:Qs,rad:Xn.Rotate90}]),u=this.createEdge("BackRightEdge",new F(t,0,-t),[{axis:Qs,rad:Xn.Rotate90},{axis:lo,rad:Xn.Rotate180}]),d=this.createEdge("BackLeftEdge",new F(-t,0,-t),[{axis:Qs,rad:Xn.Rotate270},{axis:lo,rad:Xn.Rotate180}]),p=this.createEdge("FrontLeftEdge",new F(-t,0,t),[{axis:Qs,rad:Xn.Rotate270}]);return e.add(r),e.add(i),e.add(n),e.add(a),e.add(s),e.add(o),e.add(l),e.add(h),e.add(c),e.add(u),e.add(d),e.add(p),e}createEdge(e,t,r){let i=new yr,n=new vs(this.EDGE_SIZE.x,this.EDGE_SIZE.y),a=new Ss({color:this.EDGE_COLOUR,opacity:this.EDGE_OPACITY,transparent:!0}),s={tick:0},o=new Ht(n,a);o.name=e,o.userData=s,o.position.setY(this.EDGE_SIZE.y/2),o.layers.enableAll();let l=new Ht(n,a);return l.name=e,l.userData=s,l.position.setZ(-this.EDGE_SIZE.y/2),l.rotateOnAxis(new F(1,0,0),Math.PI/2),l.layers.enableAll(),i.add(o),i.add(l),i.position.copy(t),r.forEach((e=>{i.rotateOnAxis(e.axis,e.rad)})),i}createViewCubeCorners(){let e=new yr,t=this.OUTER_CUBE_WIDTH/2+1,r=this.createCorner("TopFrontLeftCorner",new F(-t,t,t),[{axis:Qs,rad:Xn.Rotate270}]),i=this.createCorner("TopFrontRightCorner",new F(t,t,t),[{axis:Qs,rad:Xn.Rotate180}]),n=this.createCorner("TopBackRightCorner",new F(t,t,-t),[{axis:ld,rad:Xn.Rotate90},{axis:lo,rad:Xn.Rotate180},{axis:Qs,rad:0}]),a=this.createCorner("TopBackLeftCorner",new F(-t,t,-t),[{axis:ld,rad:Xn.Rotate90},{axis:lo,rad:Xn.Rotate180},{axis:Qs,rad:Xn.Rotate90}]),s=this.createCorner("BottomFrontLeftCorner",new F(-t,-t,t),[{axis:Qs,rad:0}]),o=this.createCorner("BottomFrontRightCorner",new F(t,-t,t),[{axis:Qs,rad:Xn.Rotate90}]),l=this.createCorner("BottomBackRightCorner",new F(t,-t,-t),[{axis:ld,rad:0},{axis:lo,rad:Xn.Rotate180},{axis:Qs,rad:0}]),h=this.createCorner("BottomBackLeftCorner",new F(-t,-t,-t),[{axis:ld,rad:0},{axis:lo,rad:Xn.Rotate180},{axis:Qs,rad:Xn.Rotate90}]);return e.add(r),e.add(i),e.add(n),e.add(a),e.add(s),e.add(o),e.add(l),e.add(h),e}createCorner(e,t,r){let i=new yr,n=new vs(this.CORNER_WIDTH,this.CORNER_WIDTH),a=new Ss({color:this.CORNER_COLOR,opacity:this.CORNER_OPACITY,transparent:!0}),s={tick:0},o=new Ht(n,a);o.name=e,o.userData=s,o.position.set(this.CORNER_WIDTH/2,this.CORNER_WIDTH/2,0),o.layers.enableAll();let l=new Ht(n,a);l.name=e,l.userData=s,l.position.set(this.CORNER_WIDTH/2,0,-this.CORNER_WIDTH/2),l.rotateOnAxis(new F(1,0,0),Math.PI/2),l.layers.enableAll();let h=new Ht(n,a);return h.name=e,h.userData=s,h.position.set(0,this.CORNER_WIDTH/2,-this.CORNER_WIDTH/2),h.rotateOnAxis(new F(0,1,0),-Math.PI/2),h.layers.enableAll(),i.add(o),i.add(l),i.add(h),i.position.copy(t),r.forEach((e=>{i.rotateOnAxis(e.axis,e.rad)})),i}getBBox(){let e=new Vt;return e.setFromObject(this),e}getDirectionByElement(e){switch(e){case"TopFace":return new F(0,1,0);case"BottomFace":return new F(0,-1,0);case"FrontFace":return new F(0,0,1);case"BackFace":return new F(0,0,-1);case"LeftFace":return new F(-1,0,0);case"RightFace":return new F(1,0,0);case"TopFrontEdge":return new F(0,1,1);case"TopRightEdge":return new F(1,1,0);case"TopBackEdge":return new F(0,1,-1);case"TopLeftEdge":return new F(-1,1,0);case"BottomFrontEdge":return new F(0,-1,1);case"BottomRightEdge":return new F(1,-1,0);case"BottomBackEdge":return new F(0,-1,-1);case"BottomLeftEdge":return new F(-1,-1,0);case"FrontLeftEdge":return new F(-1,0,1);case"FrontRightEdge":return new F(1,0,1);case"BackRightEdge":return new F(1,0,-1);case"BackLeftEdge":return new F(-1,0,-1);case"TopFrontLeftCorner":return new F(-1,1,1);case"TopFrontRightCorner":return new F(1,1,1);case"TopBackRightCorner":return new F(1,1,-1);case"TopBackLeftCorner":return new F(-1,1,-1);case"BottomFrontLeftCorner":return new F(-1,-1,1);case"BottomFrontRightCorner":return new F(1,-1,1);case"BottomBackRightCorner":return new F(1,-1,-1);case"BottomBackLeftCorner":return new F(-1,-1,-1)}}update(){this.traverse((e=>{e instanceof Ht&&this.updateViewCube(e)}))}updateViewCube(e){this.updateMeshTick(e);let t=e.userData.tick;if(e.name.indexOf("Face")>-1){let r=e.userData.material;if(r){let e=J9(this.FACE_BACKGROUND_COLOR,this.FACE_HOVER_BACKGROUND_COLOR,t);t>0&&r.color.set(e)}if(this.innerViewCubeMesh){this.updateMeshTick(e,"translateTick",2);let t=e.position.clone().normalize(),r=Math.max(2*e.userData.translateTick-2,0);t.multiplyScalar(r*this.CORNER_WIDTH/2),r>0&&this.innerViewCubeMesh.position.copy(t)}}else if(e.name.indexOf("Edge")>-1){let r=e.material,i=J9(this.EDGE_COLOUR,this.FACE_HOVER_BACKGROUND_COLOR,t);r.color.set(i),r.opacity=Math.max(t,.1)}else if(e.name.indexOf("Corner")>-1){let r=e.material,i=J9(this.CORNER_COLOR,this.FACE_HOVER_BACKGROUND_COLOR,t);r.color.set(i);let n=1+.3*t;e.parent&&e.parent.scale.set(n,n,n)}}updateMeshTick(e,t="tick",r=1){let i=e.userData,n=i[t];void 0!==n&&(e.name===this.activateMeshName&&n<r?i[t]+=.05:e.name!==this.activateMeshName&&n>0&&(i[t]-=.05),i[t]>0&&i[t]<r&&(this.dirty=!0),i[t]=Math.min(Math.max(i[t],0),r))}},ej=class extends vn{constructor(e,t){var r;super(e,{id:(null==t?void 0:t.id)||ej.DEFAULT_ID}),this.width=0,this.height=0,this.renderEnabled=!1,this.onPointerDown=e=>{var t,r;if(null==(t=e.originalEvent)||t.stopPropagation(),!this.viewCube)return;let i=new Te(e.x,e.y),n=this.pickManager.pickObject(i,[this.viewCube]);if(!n)return;this.lastCoords=i;let a=n.object.name,s=null==(r=this.viewCube)?void 0:r.getDirectionByElement(a);s&&this.updateViewerCamera(s)},this.onPointerMove=e=>{var t;null==(t=e.originalEvent)||t.stopPropagation();let r=new Te(e.x,e.y);this.updateActivateMeshName(r),this.lastCoords=r},this.onPointerleave=e=>{var t,r;null==(t=e.originalEvent)||t.stopPropagation(),this.lastCoords=void 0,null!=(r=this.viewCube)&&r.activateMeshName&&(this.viewCube.activateMeshName=void 0)},this.onClick=e=>{var t;null==(t=e.originalEvent)||t.stopPropagation()},this.updateCameraAndMeshName=()=>{var e;if(null==(e=this.viewer)||!e.camera)return;let t=this.viewer.camera,r=new F;t.getWorldDirection(r);let i=t.up;this.updateCameraDirection(r,i),this.renderEnabled=!0,this.lastCoords&&this.updateActivateMeshName(this.lastCoords)},this.cfg=t||{};let i=this.cfg.containerId?document.getElementById(this.cfg.containerId):void 0;if(!i){let e="x-viewer-viewCube";i=document.createElement("div"),i.id=e,null==(r=this.viewer.widgetContainer)||r.appendChild(i),this.cfg.containerId=e}this.width=i.clientWidth,this.height=i.clientHeight,this.container=i,this.inputManager=new mf(this.container),this.pickManager=new ub(this),this.init(),this.animate()}get viewerContainer(){return this.container}init(){this.initScene(),this.initRenderer(),this.initCamera(),this.initLights(),this.initViewCube(),this.initEvents()}initScene(){let e=new Xi;e.matrixAutoUpdate=!1,this.scene=e}initCamera(){if(!this.scene)return;let e=new Gi(-this.width/2,this.width/2,this.height/2,-this.height/2,.1,1e5);e.position.set(300,300,300),e.lookAt(0,0,0),e.zoom=10,e.updateProjectionMatrix(),this.scene.add(e),this.camera=e}initRenderer(){this.renderer=new Ka({antialias:!0,preserveDrawingBuffer:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.setClearColor(11119017,0),this.container.appendChild(this.renderer.domElement)}initLights(){if(!this.scene)return;let e=16777215,t=new ya(e,1.5);t.position.set(-100,80,0),t.name="sun",this.directionalLight=t;let r=new $o(e),i=new Mh(e,14540253,.5);this.scene.add(r),this.scene.add(i),this.scene.add(t),this.scene.add(t.target)}initViewCube(){if(!this.scene)return;let e=new ZD(this.cfg);this.viewCube=e,this.scene.add(e),this.zoomToBBox(e.getBBox())}initEvents(){var e,t,r,i;null==(e=this.inputManager)||e.addEventListener("pointerdown",this.onPointerDown),null==(t=this.inputManager)||t.addEventListener("pointermove",this.onPointerMove),null==(r=this.inputManager)||r.addEventListener("pointerleave",this.onPointerleave),null==(i=this.inputManager)||i.addEventListener("click",this.onClick),this.viewer.addEventListener("afterrender",this.updateCameraAndMeshName)}updateViewerCamera(e){e.normalize(),this.viewer.flyToDirection(e)}updateActivateMeshName(e){if(!this.viewCube)return;let t=this.pickManager.pickObject(e,[this.viewCube]);if(!t)return;this.viewCube.activateMeshName&&(this.viewCube.activateMeshName=void 0);let r=t.object;this.viewCube.activateMeshName=r.name}updateCameraDirection(e,t){if(!this.camera||!e)return;e.normalize();this.camera.position.set(200*-e.x+0,200*-e.y+0,200*-e.z+0),this.camera.lookAt(0,0,0),this.camera.up=t,this.camera.updateMatrixWorld()}animate(){var e,t;this.requestAnimationFrameHandle=requestAnimationFrame(this.animate.bind(this)),this.scene&&this.camera&&this.viewCube&&(this.renderEnabled||this.viewCube.dirty)&&(null==(e=this.renderer)||e.render(this.scene,this.camera),this.renderEnabled=!1,this.viewCube.dirty=!1),null==(t=this.viewCube)||t.update()}zoomToBBox(e){if(!this.camera)return;let t=this.camera.right-this.camera.left,r=this.camera.top-this.camera.bottom,i=new F;e.getSize(i);let n=Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2)+Math.pow(i.z,2)),a=Math.min(t/n,r/n);this.camera.position.set(i.x/2,i.y/2,i.z/2),this.camera.zoom=a,this.camera.updateProjectionMatrix()}destroy(){var e,t,r,i,n,a;super.destroy(),this.requestAnimationFrameHandle&&(cancelAnimationFrame(this.requestAnimationFrameHandle),this.requestAnimationFrameHandle=void 0),this.renderer&&(this.renderer.domElement.remove(),this.renderer.clear(),this.renderer.dispose(),this.renderer.forceContextLoss(),this.renderer=void 0),this.container.remove(),null==(e=this.scene)||e.clear(),this.scene=void 0,null==(t=this.directionalLight)||t.dispose(),this.directionalLight=void 0,null==(r=this.inputManager)||r.removeEventListener("pointerdown",this.onPointerDown),null==(i=this.inputManager)||i.removeEventListener("pointermove",this.onPointerMove),null==(n=this.inputManager)||n.removeEventListener("pointerleave",this.onPointerleave),null==(a=this.inputManager)||a.removeEventListener("click",this.onClick),this.viewer.removeEventListener("afterrender",this.updateCameraAndMeshName)}},Q9=ej;Q9.DEFAULT_ID="ViewCubePlugin";var KD=class extends Ki{constructor(e,t){super(e),this.needsFrustumCulled=!1,this.image=t.image,this.min=t.min,this.max=t.max,this.radius=t.radius,this.renderOrder=t.renderOrder||-1e3}getClassType(){return"OverviewMapDrawable"}getImageScreenSize(e,t,r){let i=this.transToScreenCoord(e,r),n=this.transToScreenCoord(t,r);return{width:Math.floor(Math.abs(i.x-n.x)),height:Math.floor(Math.abs(i.y-n.y))}}draw(e,t){let r=this.getImageScreenSize(this.max,this.min,t),i=new F;i.addVectors(this.max,this.min).multiplyScalar(.5);let n=this.transToScreenCoord(i,t),a=this.transToScreenCoord(t.position,t);e.save(),e.beginPath(),this.radius&&(e.arc(a.x,a.y,this.radius/this.tolerance,0,2*Math.PI,!0),e.clip()),e.drawImage(this.image,n.x-this.width/2,n.y-this.height/2,this.width,this.height),e.closePath(),e.restore(),this.width=r.width,this.height=r.height}drawSelect(){}isPointInPath(){return!1}getBBox(){return new Vt(this.min,this.max)}},HS=class extends Ki{constructor(e,t){super(e),this.hover=!1,this.needsFrustumCulled=!1,this.image=t.image,this.hoverImage=t.hoverImage,this.translate=t.translate,this.scale=t.scale||1,this.position=t.position,this.direction=t.direction,this.radius=t.radius,this.displayRadius=t.displayRadius||1/0,this.rotation=t.rotation,this.enabledHover=!!t.enabledHover,this.renderOrder=t.renderOrder||-997}direction2Rotation(e){return new Te(e.x,e.z).angle()+Math.PI}getRotation(){let e=this.direction?this.direction2Rotation(this.direction):0,t=this.rotation?this.rotation:0;return t+=e,t}drawImage(e,t,r){let i=new Te(1,1);this.translate&&i.set(this.translate.x,this.translate.y);let n=t.width*this.scale,a=t.height*this.scale,s=this.getRotation();s?(e.translate(r.x,r.y),e.rotate(s),e.drawImage(t,i.x*n,i.y*a,n,a),e.translate(-r.x,-r.y)):e.drawImage(t,r.x+i.x*n,r.y+i.y*a,n,a),this.width=n*this.tolerance,this.height=a*this.tolerance}draw(e,t){let r=this.position.clone(),i=!1;if(this.radius){let e=new Te(r.x,r.z),n=new Te(t.position.x,t.position.z),a=e.distanceTo(n);a>this.radius&&a<this.displayRadius?r.lerp(t.position,1-this.radius/a):i=!0}let n=this.transToScreenCoord(r,t),a=this.hover&&this.hoverImage?this.hoverImage:this.image;if(e.save(),e.beginPath(),this.radius&&i){let r=this.transToScreenCoord(t.position,t);e.arc(r.x,r.y,this.radius/this.tolerance,0,2*Math.PI,!0),e.clip()}this.drawImage(e,a,n),e.closePath(),e.restore()}drawSelect(){}getClassType(){return"ImageDrawable"}isPointInPath(e,t){var r,i;if(null==t||!t.camera||!this.ctx||!this.enabledHover)return!1;let n=this.transToScreenCoord(this.position,t.camera),a=this.transToScreenCoord(e,t.camera);this.ctx.save(),this.ctx.clearRect(0,0,null==(r=this.ctx)?void 0:r.canvas.width,null==(i=this.ctx)?void 0:i.canvas.height),this.drawImage(this.ctx,this.image,n);let s=Math.max(devicePixelRatio,1),o=this.ctx.getImageData(a.x*s,a.y*s,1,1);return this.ctx.restore(),!!(o&&o.data[3]>0)}getBBox(){let e=this.position,t=new Te(e.x,e.z),r=new Vt,i=new Te(1,1);this.translate&&i.set(this.translate.x,this.translate.y);let n=[],a=i.x*this.width,s=i.y*this.height,o=(t,r)=>n.push(new Te(e.x+t,e.z+r));o(a,s),o(a,s+this.height),o(a+this.width,s+this.height),o(a+this.width,s);let l=n.map((r=>{let i=this.getRotation();return i&&r.rotateAround(t,i),new F(r.x,e.y,r.y)}));return r.setFromPoints(l),r}},ORe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABgCAMAAACuYkXGAAAAulBMVEUAAABJSV9pdntRWmdeaHZMW21ZYnJqcH9PV2dSWmtTXmtXX3Jka3tfZ3daY3NXYHBbZHNbZHJaYXNWX3D9/f5cZnT+/v6xs7zKzdKusbr6+vvs7e/Z29/s7e/09faPlaCVmaX6+vz6+vv5+fnw8fP3+Pjh4+Xu7/Da2+Dp6uz+/v719vjz9PX09PRfYXP///+vsLlpa3vDxMv19ffr6+7r6+2lprCHiJZ9fo1zdITNzdObnKeRkp9zdYQN9RLUAAAALnRSTlMAAwQICgYSBwsPDRUMDxcZHRsjH+Mg8TwvIMZ+UpGIMizVtqael3VrZ1zTuq2q+zBSvwAABtBJREFUaN7tmXlD00AQxSW7yeYsPaktKJcgeBRbbsHv/7V8b3ZjTOiRrfylTnoIpD+eb2dmD978j789dtzrjry8HrYWIL8u91Xx+HxgOYG88FHGK2gNbOxUb+7720It2BFNiAh4BXw66bjPMwlKA4gJTWiMUsrgUoZflrL9ra4sMCo0mlilldb4lxY6hQvbU7HDUipQiFjrPLYXvlKiXdAU7a03JCCWyNM8jfFM81znuRI0fmtovW7vr1ANpIGbpmmBSHglSZEiAIcr8JyOtLbDyoUarSGO2MnB/umn4RViOD3ZP0iKIi1yjQDY2EFsiUVwtHLITSaX072rWuydfIwgnG4rzWFsQxYsEkppcPGfn7wH9WUMT99Cth3HINysmQYzceECvU2IXRXv3yYp0YZFA3Abe0PYAG5xWWKvF3fPj/PZbPZ4f7e4KVV/TAr6oQwSb0PWkWsQzIVicuao3+5ntXgo2WcT2JHHSm3Q/Ct5NdI2efvJYam0GU8WPYQdcaxlBNc1DnIN0zcGd3jFAHZ5fHPkqKAbBK8mUzGqCeNWRJZ78zBbGT9unGaIps9rzEB5SmdIU8ddQO7qmH+v3IBm2ryKC3AIg4tiItxvFWSNHZ8mURLbQoGy5U6w3nRaJNGZ47Yin8HmnPnM/r3cYQMw8iz6yPu/z1rEgndeQnKs7AAuFwwfWMdi8M28DXh+Q5snEcbPlsnOipRQcV5E7ynjcdYqHqS6owRmhMsTQ+Y2ZAQyraXBlc17E9hMMwh+KTikExi5Uxoxaxvza5Ec5bDZvHRZ5mM6nBYZHX5qDXaSUSZQDEqzGUlXU2gRTAkK9pN8ic5PyS8Vsw2rGNzohCXnARbJ0wjj5yTXGzxTQhOcsQc/+IDv3fClOeoaAhsWg6vQfLIDPycY9OIgklxmw3jR4JWmE/ueTrjy288wnWhKRtSsMHboMlp85we+w0dOsyhx4GaHDy14irvu/cDP+MgxwbnSMvnVyxn9J0mizlDK2St+sF9kyAu2ZWj8XTPqmf0nirIrxMwv5vxMlqGsCa5lBZNCoeyiqOMLZpRgKnZeVE7I1BFlW4M7NFk18o1r0RDlUYLnW4B3Ac6RyBRcnz2M1N3WgwfFUcq5Lwga2YZZH2O3e4y7nv3ArOmpWKHZ7UVx1TSNyUXx1+0K5DPBhWazB7jeKix425ImmOlmalbYiTQnmE3o2g98yybkrDC1PHbpVhB8tOdb0w9sm71OmcdBo7sBzHTLelNOpb5OnAgYrb7RN6mYiYy06F3Qi7mnE+e9TOYQExqIrE9MRkki78ILL8lPzOIu6yPR0ukbM17AZTHBvXd+kin4C8GsD9PwGF64GSTr9Pwky7pw3KNigMEluV4hkm9Rp9el5KuHtuWMeNft2R7UXLKQLOCCXnSP2C9u2y0KacRwTCeK1K0461aUK0Ka3L24alt+sqg/7zonYhO8OHeBNdKRE3ox+OCz8P4w6O52skTWyA3BCPwq2X4kIvnouP1WYXjkBNvyaFj8a8mSsEZ6g/FQFvXrNzcL4Y4H4Eo962qD01wU0guRPLLk28c1LeLWcmkEBAOslu7WA9lDx1gCZB3aDPI6O+awwXEpmHs9dqA1WwWZ+KC578i3T0ux1/LD4/HICU4xQLUkbnY4DckkdwejQ+YG0YtGsdwTK/lwSL2Sw9wpALsCHMi+n82TZoz65xDt2Hf3j1T6+Hy3IFVsuOgPrF4Wh+aybcV+LJB2n8tEAnJ31B+julfE3rvD/qhLLo3gCtZW3XIwybG1mT4P+v3xl+FK7ACJ1ukIV8HgFVzaI6cKKpdZFT7TaLDPP+81qNMLwVZcdolVYGHLLh0tg/tpS4bTiIP9z1NRPjz+sn9wiO8MaK/4m3CRaeBwE9yskoAHFgBD9C7sABrsRozgbm/X+Ztq1Jw9ytpwOKboM8k0moMosivqgNiexRZJzoQwELzxEEt2qCQDDTbRZLsYIIC1XIDlWM9uzzeRgdaaI1iADD8QhDMGeBKKQetEkdgQIx/K7fkmdKioGXawCEs2ebwE6tSmItcm8MaTQueGNrKxLiy6YwNQJhipxNo0Y2W0PzWlaHEaqsXsKoSawIVcM89U24NvJzpkd1bidUG0C1KZClCLHyoFrPcBckgy0XGaJ0mBB4US6rxltTm5vkf0CkE20FCe5kVKKAtC8TIV1/OUHuMCWWTHuQZf57o8+scglNQd/7+DSLsj2GjrKJGa2NBiPeU6uKAlDM/5AeMbs8vIgUeD62kH4S4ok0IBbVC3RANUxU5FrcDbiy5pVMu3BnQ7dJl+AnZCeeHx5yE0C9us1R8uz//xD8RPQ80FqUsWMbIAAAAASUVORK5CYII=",DRe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKoAAACqCAMAAAAKqCSwAAAAh1BMVEUAAABfTP9eTP9fTP9eTP9fTP9fTP9fTf9fTf9fTP9fTP9fTP9fTf9fTP9eTf9eTP9fTP9fTP9eTP9eTP9eTP9fTf9fTf9fTf9fTf9fTf9fTf9eTP9fTf9cSP9dS/9eTP9fTf9fTf9fTP9fTf9cSv9fTf9fTf9fTf9fTf9fTf9fTf9fTf9fTf/hY9QXAAAALXRSTlMARjRhS0HMZ1M5PVgva1wrTyYbFyJwlnx0gaATeAUPH4mmjYUKm5Gvv7m0q8X/SpWnAAAGcklEQVR42tXcCXriMAwFYEFhBsqeQIEGB2jTjc79zzdmFaDEjgmyhU/wf6+yvIUCxxhE8CBj3Kw9iHXZbNYew7p81tSHsEbPe2pDvDVuH6nSrVkdqcMlCB6q2z6jtgRb1aB+pGrpsCXYOq4jdZuqXGtcR2ptl2qrI9Oadi+oO2unMwZ5Q43OqY0DVaR11L2kDvfUfl+cNRl0SQHsqU/CrNmAUlsHqiyrGg+KU316GoGcEY+M1L9yrOnojNo8dQCkirGq5ciSqhhrMkYq6at7aq8nwqrGhEoKQFsHEH5EudThOVVLe5Pw1nSJ1PbFduUy1Ulwq4o01TStkDoLbE1s1P6ROpvNuhBiYKj51GFOqrNFkFwxVHuqSF2EyzWLojK1itRpMGsckVSbeLbKo4ayZoRqTXU6D2NN4tidGsSaxXGMtWrcA5xT3+vgfaTxRQF0Tc0KqSGsKjmnDooKgKb6vvJtzZBarq8i1bc10VRDX20ZUl29ebVmSeLQASZXVK/WVEtdlgCk7qyf/qxqR7Wn2iepznepfn62wdPIMNXRsQO0Cw4sdFqtNPXFk1WlJNWucVrRVF88WbMtNTF2ALK1XpxNK2194bcilU4rWgB92qxOqb58eLCqLDVMK3oMLKKyWpGaklSte4Apob4+A/PITqlGBiqdVpTKbVUHqvPWmlKJlY8a3URdnVHXfFakJnkLK1LNBYDUdRPOh+ACWK8Zc1VFBeCwsL6dqNr6i7kyUXEPYE8Vm9X8ulY1Fa081L0Vqe7NCqlfJ6uQApjmU381Fa1M1Pg+02pL3aCVmWpP9WpnRaibGofUdQnoFXYALIANi7UClRbAWg8t1dSfnxprqsvbDtdb6yFVpGorF1Vbb6PSDnCgftfCpkoP1/nTaqOp2spCNd4EUuqisFlhqt/fDa5U3W5XpjmbQKzVzY76r8GUqlMBWPrqz56KVg8FQKeVvQAwVbT6KABaqxNDB8BmdaD+abBQ3Y+Bc9qsrqlo5acW7AGmZQrgrlZSq873q6vcJQBTRWtVae4xsGvtAJZUkYpW/iWAvgXQZkX7KlLR6nsJ6BmpNFW08lC7tpvAhW21QipaWVarrjFVWqufhlTvZdVSMq0sBUCalbkDoNX/gcWxA9zNqhhOrISK1oAdYJ5XAGRaoZX1wEKpDqlSayWq6dLS7Wz1YWhWaPW6tZ5cXa+ZlwBi5aTSFxaknlarDwsVrR7PVo4LK7VyUOm3K/bV6pfUKrXemdq+U1+l1q+IoQNYD9e0AOiBhUoZa1VL899YaQd4JVQq5TxcD7FWXU8BxLqJgJPqXqs4raiUmdqq3qzwrx+0r+LCSvcARHo36qh6ql+kVomUcwlwfws4UkmdyplWhIqZ+r8Ictta/yNS1mlF+ursQLWfWFHq89KyU+EYiNLKVHwOrlYAtAOglDXVpuGTsPKpolTc4ZrsV4k0yGo1t6a6k0qgYqpFZyuUVh7GWjVRp+WWACKtmmpa4lvrjvuVxVYq5XsAPFznp/qLUuZmVfUiCKX8BYCrFVLJC0vhErCO4TCE9tVTqlr6INR1LOrTBcMS8EqljFtrOq3+kmn1XrCwotRjquQxyH62QilvB3B/Y6UF8IFSP99ZNfN/c23fWaGUi7q8z2MQkxSwAGK6Wu1jHTo2qxci9bSzajhuAtmkANW2KzTVT5QyUqu/W11IxVCneZtAVilStdXxLYDeWrNKARy/te4ZvrN6S4B1ZOV+GmansktBOfw0zNhXVwlwD4dNoGm1eueUIlVbb0sVO4APKSjrtGrZfhuIUuZhP7BYC2DuRwrZjT8MwYXVlxSU6YWlYf/KAqX8w+k5mL6wTP1JIavw20BmKY21wv3qwqsUspuvLHxLAW7+txvepZA5XQUjdZaC76HofpW+W1FqAClAesu0moSQgnL7zGaxpXqWYqzOtdoLJAXl2qxCSDFWSj1KabP6m0K4UXoTqKWzoFJIS/+DiNBSgPIXQaGlkJ2oXfPvrZ5SCD3icqkKkIJa7qgD00WQDClAWuI1sC9CChBZP7ORIgV1ubDSJaAjRQqQmKeVICnAspgqTApqVExtZSBqpIU3gdKkAFF+qgKlAKPcL9iHAqWgclKVKQXI6C8uGzKlAPHVw6VcKcDysgBqcqUAg7MCkC0F1UWqbKm21o8F0BQuBcjae6p8KUCqqY8hBYg19fkhpFvro0gBEhbpfwjbOY5gXmpMAAAAAElFTkSuQmCC",LRe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABgCAMAAACuYkXGAAAAt1BMVEUAAABRUmRVYHFcZHBRWWZia3plb39aYnFeZnVYYXNZYnJPWGdZYnJRWWtZYnJZY3JWYG9eZnVcY3RXXnH+/v7+/v78/P2xs7zKzdKusbr6+vv4+frz9PXn6evs7e/09faPlaCVmaX6+vz09PX5+fns7fDa2+Dp6uzS1Nni4+X+/v7l5+rx8vL9/f1fTf////+vpv9pWP/DvP/19P9zY//r6f/r6P+lm/+Hef99bv/Nx/+bkP+RhP+tEDdkAAAALnRSTlMAAQMGCAsIDQ8UEgsXEB0gGhojJOLx5DwvIMa4m3CRiDIs1aymfWdcV03ShXjTY8FN1QAABtZJREFUaN7tmWlb2kAUhS1knSFAXFBArFtduoAgbtX//7t67gITEsCM+rFHwNZHXs9z5t6bybDzX376hi/5Bx5fxsSTeIBD8qPPUxUndP6f0+fITo0GngUs/ZEPMl0ADVAbKgf3J+siLaxWpOY1HV8yIQvQZlOeJeNedaJWHLhZlrJ94/imKkCjZhAEUYDXSMjCVtN14c4tM/GIAA3CILRhRPyo6HunJrhoVuwCGQIZxqF8t4TH3xK0rqEPmJiwZ4UXx7GN6ZX+AtwHTTYOMkf9DlkqV1MAFO9nZKLK8Iwh0C24hG7UQmv5arphBHcgJf3b35c/9yfQ/mD4+5bxFIx6hriZ6q0arVZsbZL1rwcHkxUdDEcZ0KFkzZ5JW/2qXc6B7fa/g1rV/uUR0FhGVCEHLdo6y5gb0YLFjN2k70dZHGNlIwl6KxdSbmCBTa4X2PvZ09t8Oh6P589Ps8eFawSCqB1586hecqPQIoVjpd49j1f0smAf9xEH6iMQ8nospaBlBm4cZ0c/FQunFb0Kev8oS6Q6dHBU2cAqOEC+KIYjlBek2KrulGyEvCVm4WoORrgPL+ONmj+qZ8QRcdWtn3WLhUOvLbkz2N2s6V8lI+dA04DWcRnM68bcOwfZEsefvkls4EbSGjD3G7oiM8fKrUU+NlR1FIakUSkJDSJOzGgC/R3X0GwCXWeJDXkgrUkCaOLS2JGCeJjWAU8fKea+iS1bXkvmimDD38nGfFxLL9zdJkPNsWWozG1C4KKCawbsYj7oI2Ys4DrLmjCCMJcUxLiupvdkOUXNWYArMS97LklSSvi1Nlgto02WA3SlKggcseGRGPazfG2SxFrpkp2y4ygirhlSy3mA2fLAGFh289MVW4OXDuCUZvCLD/hZlw9kBrsW4Qsdd12SpbeeSUCUxa0xMVfct6JjvoCKYfPDMwltvx8pli8ky4C5peMoaEyYlCJ+8gM/4S2Xqcli6mvFqnSuJYh4gN969gO/4S3nBI65rXcaxdEGLkfc2ud29tKc5kXL0CjSEVdYPFk7Y1oTaOyn6QRqpdzWAJf6GVw4VrCnFAzHq+NCRzFd6tJPgBGFXlRXJ0WEokgFPP0QOEVZVBZPGxqOex9dvJRaJGByybG1Bo7P8VtvHlTt6QE5FrBm7EZQzI4vPtYgw5Z0SECtt2pYo/hoSzvHxcVjMEYFGuSG9mt+YLqg3pBjrWOXBNzTdZQdnx349vQLjc2c6xjgJsAlyzyDWl0aFne+SQxzqmOOuNR6dC8TMviKsph6JjHqEjjWXYsrYwYHvHo5svCy/Ipf77UZHHKDAOjAHEVoMSta+Qlb9jJ80c6pPyw7Lu1X5MpEWfhY1n3hYQ5wRhu4BuSi0ClkefXyNlmevNRtZ+iEkjC8swC2UdmvhGy52z7r+W0Ke4ftnKdxZcuiyxdowbWvJnXbjzf1o3YuY94Cu7qvwFWvyWMoyQjc8dt4d6QmLDtGwkWw7oSk+fL22Xn9W4XeWbvbJcOxcNWwWz2qi8Dy8nXbhz3e1G+/uZkx9xB+5boUuYSd5M6cLbcQhpIf5ltGxKNwOQgj29gq190yUcoIowPytjimiMFxOeEI4DIZKWtbWw1jSX54XYu9n5DOwVXDga3eKrgmCSJYlvVrd06PJ4KelZrlGVjW8Sn8Sm9QETdk31YFO8uoOZA7I5hW9tPznJzO355moEoMV7sdCRhgWbl1jvGQlOXSx553D08mm3RwcrrLOWhv8Cnf+jMnhCyW44TJOci7hxe9TVji5i2pCHc2VKGS9OY/pphTJnc6u3uj4UGJOriCW2DbLeLKfSn8rgW7YzE6akuSTMjIY29vd+/m13DAznvnF79uTvEj4nYxIpZcvRXbdsKCyqA+UTK7hvacQAWWY0izLNFjIT30rapwhEUdyFWHpLk8CA4gqSNYVJnYxcKBSwkTY/OpMU+5gD0jjZTIXbINuqpNWOVyAUdR4eht8znh8tgtzhLDprtd2HbKc1AhYzgGq+eQ2w/tGYwGFNOJVAeUgw7lOR6gils5dVNuCbux6Li56QiSAhE4VXZLoIJN5CxIRwT0DlhLA2i4RhtCJmUByVAJwfIJtY40UY1TaTnpDijqhBJZSKkUQhDyialy3/9wwZ1383k5H54SHDgg8SpHpUrV02OttBrkRRNGajvGQxXGQo0W3KLbWqZ1EZWNpyX7eOGT/yVWPzurx5X+dlk3iQ4envRFlaBYpZa575aHsiMMPXoqdJmtygPr6oO19gMhNcxcL8NVdqMELcwzL8/uY4ay8DPH9ZW+UcQwkeAqHwT5w6va+aLPTPW1QJXTni+QYuW7gr9SHO5/eesfYdwFkua/O6kAAAAASUVORK5CYII=",kRe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKoAAACqCAMAAAAKqCSwAAAB0VBMVEUAAAB5d55fTP9fTf9fTP9eTf9eTP9fTP9fTf5fTf9aYnFfTP9fTP9RV2hfTP9fTf9fTP9fTP9eTP9eTf9eTf9eTP9fTv5fTf9fTP9fTf9fTf9fTP9fTf9fTf9eTP9eTP9fTP9fTf9YX3BaYnRfTf9fTf9fTP9fTP9QVmZeTf9eTf9fTf9fTf9fTP9fTf9fTf9fTf9eTP9fTf9eTf9jantgTv1fTP9fTf9fTf9fTf9fTP9fTf9eTP9eTftfTf9fTf9eTf9fTP9fTf9fTf9gTvxfTf9aY3RaYnJfTf9fTf9fTf9eTf9aYnNZYXJeTP9fTf9eTuxbYnRfTv1cTuBfTvJfTf9eTP1fUPhfUuVcVsJbT91cT9tbWKtcWLFbXpNdVM5ZX3ReTvtcUsxbVMRcU8heUOb8/P5cWLlcVMheTPxZWZ79/v7+/v63ucpcXJvw8fSvs7r29vmVmarp6e7NztNWU7j7+/vR0eH7+/zh4uTy8/Tr7O2wsbr39/z3+Pj3+Pjl5+rKytSnptWpqsqKisD5+vro6PLs7PTa2ulfTf////9zY//r6P/19P9pWP/DvP+Hef+bkP/r6f+vpv/X0v+5sf/h3v/Nx/+lm/+RhP99bv89/FqOAAAAiXRSTlMABMw/RS9kbCdWB092BUIslzo8U180Ko9Zh5syI4RbNjh9DRBxaUd5CWdRrXNhXaNLSYpvCyBNgIGxjHtMG76UkqG6nh60JhnIqKbEExWqtyciFh4jwRkTIR0mGx0iISAdDycZFRjkKCQKGeLxOSeNP6ksby4QxVnUT5yAHsnJuF9HREI213iiZ4OOOrcAAA/ESURBVHja1NhPj5pAGAbwIYrr4gLVXf9lqavJFi3RZtHFblpJe/ATcIAzR7JNeuhemjTp3U/deWccRxjsSTLjYzTG0y9P3nkBURXpxehC4lj1EF1EAsuqX4Z1W6tZdde9AOu204FWfX+LFE/U7tQw1fX9jeLWrIupNdyq+7RpKW3V9DGlukD1AqRsNPuBUmFW1y3vVl2r02VU14dWvWtVrfF9l7f6BK1eK2pNdULlx6qFqQMVrVpTL7Ta8jB14CDl0tSPqO6BOvqknDWyCbW9p9IBINQ7xaxZj1L5rMKxuiXUhVJWzQFqYQBYq4tGE6mTuNmzbeFYsVYbClnTJqbqeeoG9iqjflTFqgWcyvfqGmaVUT8oYo2cIhVuAumsDvbUKyWsmiNQ6wfqiFGvekh+wgLVosdq7eWpK/nWNAjKWl23itRH2VYt5FTeqnu8Vxd76txGUpNsxVaBKrY6n99ItWrhNnDEDYCpa3YJuGuwVm+kWhNKFVsVNgChTnUkK1mMqUFJq/4GNkCx1en0qzRrFOap7fILK6dOJpKsWZRvtctaFQeAtTr5fI9kJGFUYa9SqnCsgPoiw5pFhHriwup5+3uARb7Vl/cSrGkUc6pd2KvlG2AC1IqtGrzJi/+URFF4guoL1Eeg0laHwy6qMsCEcG2WlA6AxfaqB9RR8VhBq8Mlt1ahNIGJvxw6TkQqf7Zie3VU2uryC7NWUadpsk+T9poxaumdFW2VD8Bqlaf2H1AFASIIDfIiZOCnSVRKtWir/OFaPFbD5bJfiZW2aRrG20/DMGmzCBkpH4CSVhl1dNzq9KjV/vfx+aEmxMB5/fGGrRCMT4EqbIDTDyz5AVhi6rfxuaEadc5mv3a7v7MZfAdt+r9WXfL/qjgAvFWgvmuf30qkf153u93v5+cZsWaEGpdT3dJba5H6j1Vz+00iCsJ4vDz4Um8x3qIxYdUYjalGaqJ4ibb1UkFbwQhCiwK1TcHUFrFatfEW4w5QWrHV+tc6c85ujzA7sCDzwusv337nm5lzQNYei0qgweAs/KjDa0RVrCWGymcApipDPdxbVg0aeAVQXq7AN2RF2GAp95hQ3SGQN1bKVSEBCPWyRkXWHgVqn/r6QSQNzEHNtjeg8D4QOBU8VSo9e5x7OImoQre6iA7gjTUUcsNKoSLr4N4eiYqkWtPAR6iWbdv+CbOWhbAlUpVQhxpQ93jNAGebDXDUGGBw8MbenoiqfEqklpWHuo21AoVXiBpA1Nwk1tWrA8LC0sarlzdRkbUHRaQIiqRF+GGrWoPXlqVIc48nUVU5AQiV71amW2mvDt7o79/WA1kJVZG+ysOqRl2uwlvLylFNEqqUAHKuEqo5Vqhq/8i2HpAqp1qWNQe/bKfqkA9bM0Sape8vtAC9BQiqGgPsVqqO3N3WC6cqo1JQ2W5V4F1kZmYml82RqkOCqsIW0JQAhx3U+zt7Ean4/cMUVLr0yZqfwcpOJpNJQdWmyeqERiVSMwMYAyDqmZ3/Q6qTKoikeKaMqBRYi0SazRLqkHysnNF6n6BqI6ph7fZUBUlUdaZMlQE+Sah8smpADXkcq36Nemnn/3x/R1Rs/obTCayURo1Gh3xNVuZYyahds24hqxIqBdWGwXQCayGVUqioasxzt8K+6qdbGQNcGh7e3jWrJrXoTDXVb3g+n0JSpWpMVLVVAhzgqg4/2N5tVOlOpYKqudZhNpVNtDCAeQ6WGytHvdmdrq5V30CdkarASiSS0WR0aCAWGxXerXyijjgGQNRuWGl7Uk21CNWVMq91mEslElFUNU4G2O+FeloMK1HVm9dOdmNVJWogD1ItJJLEGv/XAMfYDCCpyr06rFC7YHXOfzGv6rlHzSWUWQdadSt+FcznVST9F/XR+c7nP2KlBhC5/fTp2NjYLafGsJ5OTKTw+6eTJOpArAF1r2sAM6+ae4CQVlVIAI1671zn3x9RkTR8+zaxGlSqCWRNKK/G0QA7PEdrX8dqsMkAhHqvM111VhFqRKvawDqhUdPRNKLGRkfbvwbyIVBW9d6dc51d/ehNhb6/a4CvL1/Ob6Km0AHpdDoajcViXl41j+z7vK/XjKoc9c6VzkTto+9vRTTq/LulAlAtLS5o1nGSVanKDaA31u5VvbP1ov9DpRuAi7qwRJTVSqVKv/kikiLreFqjxvgLix6teViFzE2gV1g92ERlrHJX1VmlrTq/iJi11bKaVFZqFYDnL4mUDBAnVOZVWq5ZAvA18LpCRVKG2gErTYBoVYus+iIP1fqybWq1AoXvWtW4QkVSn+NKqH0L0KpiXfEpq5uqkcinAqw3zSvlGsDsOKFqVY/sN6iiAeRuNeKBylhlVHSq/v44rdaMpGZthaJinUZSMoD8xCajyqoqVp8e6NNZhah5vVZz1sKX8fHp6bg3aoOqZ8U7Kz1aC6oyXcVYRVH1skKa8qrBB0RF1iejox7HSj9biAnADWCO1SNC5azyAqBQww1zNVtaNCqy8ptAfr963MwA4hBowsqti+3XakJtvADgS8sHQn2iUXfxboVDIHtiI1U5qmQAzipvgOE8iSrL6qJSAnADiI9Bh5rWwLsc1T+rE1VvYd0Waw1mpzKOqgxVJwC/s/Kbq/5YTauyFmFNRl2BD1PTGUJFWduH1XF5ub7LjxVnlXcVGlXCr2FDRl2GwlQmk9Gouzz+ECIYwNe44p+VVEXUN/DHlqsKX6ccVO7V5o31gnC9JqByVpkUUfWpkqsCnxXqE6Oq2QLwhUXIVd5YDSozAGflBqBW1R41g4WkfAZgLyzcq/xYyagya5+zq7Q2AMCUqyrPVWe3OthqsrouG4CzSq//zq76t5oz/5EhCuJ4T4hr3UcciXMY1yJYZwhCTCJGXBnERGYdw65da9Z93yTNYtz8tar6Tc3r6W/XPNpMtpX1C798Ultdd72qX9NJf9FndVm0alCXLA61LP4is3Kj7tithYB6Wv2glbOq+Y8ElYeBOGSH1QXdVrEKQFK9BGTUe/6IjvrBfw2ocsIQGVyuwNWFFiGAWJFU/6wMav6u/xEQbe/6ua5VQZ2Hg0vMrLTA6ib1uLFmUIf8L7pSq5cJVUIAtte6lK41ahWdFZKqapVqdXjA/6ErVVBBq2QAzu6KAxVI9S4wOStWq5kCo9C4/Q2RXuHfv/WreMSEy0t6IwhQkRSFbFU6a1UeBKF89ysvL4e06t4IwhDgLliQFB1rowmYH74bw/r+i195ce0ao15BAzCoEq2c4+B9WhKIpCiCmuXOCrGOROz14zsmZdTz1lanYWptDQCc1U7HZ4WkurGaKpAbltxc+VQLgX7x/VdMyvUKpNaupiW2gvdpgRVJUSQISBvwRoVgP9RoJvCr9pX6QANDB68xap31ZAN1TthWuyJ+tVvRqqBCtHKTZpjVNFdZrWViZVgRAqXWZUAalIEnw1qd0XQcyqiLkjaCkFQfBBnXKi3rZw+ePK5UXj0ZunOQhEkF9SRWrDmpWPUqwJFaI6meBYpaiVUmAVaov8qopr92VJqWjrlVNwTWPWofAEgdxir+qhxhNQ12aa9RIwgKFj2wLv3TaIWkeieQm5YyCmBWS2pRSaBnNXMqNIJcVQB+VkDqrq+tWoX1WAO11GhaKmMLrK1WulBFq0iq+4AQqrCGx1YkJaPV2FZwzlYBLT2AZqtri3+5DMQW8PDmzUGW600yGEhjbAFazTVWF+bBCQOgYmB1k2LbgqfBqlQFVfEAYqvKhEX3AEeKyXYsbvNgBWXErwzawSUagCSBCfyqQuo01uy9+IT1nT9Ec0uaXKJW7asL2F2J3bNq7lkdAlKnVqVxVY2rWWp+pSRDVmV7LXQXsBpsVdWqQuqw1bpaHw5gKfj2nX9DULcog8uuuBDgHFxuKCZcCOoxu0vfYkpAnrGePasYgKQrjpYFFiwbjidaspB5AK2D/4AScJBQeXmFd1ccu9aOEBDOV/cRaWLWeuPifaSwqhrSs7wOoG0EMaq+ZwWfFaHu10jdxioF1m3/a+SbCpRqtHpasVVtxqr3V5ORZmTPKkivnzWPhOibOlcytkqs4WuLOTBi+4uu9QIHqXt2zZXA/bDD+uxXyv1MatYXTzt2AiEHUFAdpO702gyvh0MO6+2I/7RMrGdKsr0GBjBVdq1VZ4Wp9fSkpDJnk+z6Ac0vraPKl/sJtW6rFFhlywK6K4CqBtbkpOICBLVM63bWUeXzbAAXAls9razaKkuhSma1959ITbySQuAOOSwJ/mVC7S+ZVdtAq3FPGVjU2c7UWkiTokrZakpBcVjkqIbz+UI/CbEWT8C1haQreMaof1YJSbFoMYXAYPBlvSdHVTaoFwK1FpWlUO00LG5uNTcRKXYDpMI2XWE6CmDSw4cD0kvFS81anaPvBG5W/erOU225s2RUo1Z2WD/NN1UoHM5eZFb92iLnyletVhOTYoG1TFjJYVHwzwdKzd66GJww7FbPGNmvYisYndUmIE0YsEyB1fiy/IG6UpdlgyOWs0yK91birCBdwbHFfCBNHAWkxGa93qOVpUKBdZpd1sOkJKBVJbVW+qsLT7XzLtSwsg0Unlwl0EKWSXtuMSsfXOLJbWPE5spXgTS5mHu7VYaVd66eskYZla4DDWrLk1vX9tr2tpFmjF5XkbkaVgZllZJMmnTrFN2GFdmv6q8ugFabbFUhTewEmJXbLCQBJwufh07h1wGsreKQHSYs0XRlWxtIMRcUWCbtWUUq5TtxPg62L4SoBYt2GbS03aTm3ppIA9oeEjkPntLHatUOmR0b7G0ixQwrYxRLP/TXHF1nSPg6VD8N29pSqyuBtF32ynhMazQ6ie/uGw9EKI9EbW3lV9tEipkAsxKtEaKkH/vsBh4yu/dXJwNpu58ImGJISYwr65P3AVquhc8GrXb3eh2RDP8hMbyk4UDMf4EBwLK9bQVbZ9UBUnzPQlQq0otJoHsfYDmQtlOtQsuk8g8smegDETPw4jL6QgiRdliaEK1a40NADt9eEwMYD6SdACWRD0oko9iqbAXDazYdIkVelF5Exf6qrQJWdJYUYfGZOKwCcMTW3c2koyi9ylsWsGZDqKuJdDSlqLxlgQXLuFEm9fqU54y2hi/Z2VmtI9JRluNKdyViq7NHn9TLxNlqtL2WClL6stBWoWBZnwpSz9utPLthN4IWpYSU3rUVA1BCwLy0kHreqVa11ew0kXreAfAAoWg1MU2k9K49ttdEq7P6vFRJL+wDiK2mjZTia0wnkFHXpI7U8yZEcgBjAF0pJPUy02Ie4d+aRlLKW9Cv7konKZmroMr+6sa0knrelqY1m65cekk9bxqvL0ojaGyaSclcra2mm5RY54gBTE05KbEuMS2LMaknpQjLIeC/IKVSi7T6f5CSe5068z8hpUS7I6S/ARbzgdCIDH2vAAAAAElFTkSuQmCC",k3t=(e=>(e.ZoomChange="zoomchange",e.SyncCamera="synccamera",e.CameraChange="camerachanged",e))(k3t||{}),rj=class extends vn{constructor(e,t){var r,i,n;super(e,{id:(null==t?void 0:t.id)||rj.DEFAULT_ID}),this.CAMERA_Z_POSITION=100,this.width=0,this.height=0,this.frustumSize=this.width,this.renderEnabled=!1,this.drawableList=new Ol("overviewMap"),this.clock=new mc,this.raf=new K1,this.raycaster=new vu,this.translateStart=new Te,this.rotateStart=new Te,this.markerRotateState=!1,this.markerTranslateState=!1,this.isMarkerRotating=!1,this.isMarkerTranslating=!1,this.isUpdateWhenPawnMove=!0,this.allMarkersBBox=new Vt,this.tolerance=5,this.enableLookToAllMarkers=!1,this.handlePointerDown=e=>{let t=this.cameraDrawable,r=this.cameraDirDrawable;if(!(t&&r&&this.viewerContainer&&this.camera&&this.controls))return;let i=this.getDrawableByEvent(e),n=Nr.getScreenCoordinateByEvent(e,this.viewerContainer),a=this.lockCameraInViewCenter?this.camera.position:Nr.world2Screen(t.position,this.camera,this.viewerContainer);i&&i===r&&(this.isMarkerRotating=!0,this.rotateStart.set(n.x-a.x,n.y-a.y),this.controls.enabled=!1),i&&i===t&&(this.isMarkerTranslating=!0,this.translateStart.set(n.x,n.y),this.controls.enabled=!1)},this.onCameraMove=e=>{var t,r;let i=this.cameraDrawable,n=this.cameraDirDrawable;if(!(i&&n&&this.camera&&this.viewerContainer))return;let a=Nr.getScreenCoordinateByEvent(e,this.viewerContainer),s=this.lockCameraInViewCenter?this.camera.position:Nr.world2Screen(i.position,this.camera,this.viewerContainer);if(this.isMarkerRotating){let e=new Te(a.x-s.x,a.y-s.y),r=(new Te).subVectors(e,this.rotateStart);if(Math.abs(r.x)>this.tolerance||Math.abs(r.y)>this.tolerance){let r=e.angle()-this.rotateStart.angle();r=(r+2*Math.PI)%(2*Math.PI),null==(t=n.direction)||t.applyAxisAngle(this.camera.up,-r),this.rotateStart.copy(e)}}if(this.isMarkerTranslating){let e=new Te(a.x,a.y),t=(new Te).subVectors(e,this.translateStart);if(Math.abs(t.x)>this.tolerance||Math.abs(t.y)>this.tolerance){let t=Nr.screen2World(this.translateStart,this.camera,this.viewerContainer),n=Nr.screen2World(e,this.camera,this.viewerContainer),a=(new F).subVectors(n,t);a.setY(0),this.lockCameraInViewCenter?null==(r=this.controls)||r.truck(a.x,a.z):i.position.add(a),this.translateStart.copy(e)}}if(this.isMarkerRotating||this.isMarkerTranslating){let e=this.lockCameraInViewCenter?this.camera.position.clone():i.position.clone(),t=n.direction.clone();this.syncCamera(e,t)}},this.handlePointerUp=()=>{this.isMarkerTranslating=!1,this.isMarkerRotating=!1,this.markerRotateState=!1,this.markerTranslateState=!1,this.controls.enabled=!0},this.handlePointerLeave=()=>{this.markerRotateState=this.isMarkerRotating,this.markerTranslateState=this.isMarkerTranslating,this.isMarkerTranslating=!1,this.isMarkerRotating=!1,this.controls.enabled=!0},this.handlePointerEnter=e=>{1&e.buttons?(this.isMarkerTranslating=this.markerTranslateState,this.isMarkerRotating=this.markerRotateState,this.controls.enabled=!1):(this.markerRotateState=!1,this.markerTranslateState=!1)},this.handleDblClick=e=>{var t;let r=this.cameraDrawable,i=this.cameraDirDrawable;if(this.animationId&&window.cancelAnimationFrame(this.animationId),!(r&&i&&this.camera&&this.viewerContainer))return;let n=Nr.getScreenCoordinateByEvent(e,this.viewerContainer),a=Nr.screen2World(n,this.camera,this.viewerContainer);this.lockCameraInViewCenter?(a.setY(this.camera.position.y),null==(t=this.controls)||t.setLookAt(a.x,a.y,a.z,a.x,0,a.z)):(a.setY(r.position.y),r.position.copy(a));let s=i.direction.clone();this.syncCamera(a,s)},this.handlePointerMove=e=>{this.onCameraHover(e),this.onCameraMove(e),this.enableRender()},this.enableRender=(e=1e3)=>{this.renderEnabled=!0,this.raf&&(this.timeoutSymbol&&this.raf.clearTimeout(this.timeoutSymbol),this.timeoutSymbol=this.raf.setTimeout((()=>{this.renderEnabled=!1}),e))},this.isPointInBoundary=e=>{var t;if(null==(t=this.boundaries)||!t.size)return;let r,i=new Te(e.x,e.y);return this.boundaries.forEach((e=>{e.polygon.length<3||pr.isPointInPolygon(i,e.polygon)&&(r={id:e.id,name:e.name})})),r},this.animate=()=>{var e,t,r;this.requestAnimationFrameHandle=requestAnimationFrame(this.animate);let i=this.clock.getDelta(),n=null==(e=this.controls)?void 0:e.update(i);if(this.scene&&this.camera){if(this.viewerContainer&&this.viewerContainer){let{width:e,height:t}=this.viewerContainer.getBoundingClientRect();(this.width!==e||this.height!==t)&&(n=!0,this.resize(e,t))}if(this.renderEnabled||n){if(null==(t=this.renderer)||t.render(this.scene,this.camera),!Pn.isBrowser){let e=null==(r=this.renderer)?void 0:r.getContext();e&&e.endFrameEXP&&(e.flush(),e.endFrameEXP())}this.enableLookToAllMarkers&&this.lookToAllMarkers(),this.dispatchEvent("afterrender")}}},this.cfg=t||{},this.enabled=null==(r=this.cfg.enabled)||r,this.lockCameraInViewCenter=!!this.cfg.lockCameraInViewCenter,this.radius=this.cfg.radius,this.size=this.cfg.size,this.minZoomFactor=null!=(i=this.cfg.minZoomFactor)?i:.3,this.maxZoomFactor=null!=(n=this.cfg.maxZoomFactor)?n:5,this.init(),this.animate(),this.enableRender()}get cameraDrawable(){return this.getMarker("cameraDrawable")}get cameraDirDrawable(){return this.getMarker("cameraDirDrawable")}get overviewMapDrawable(){return this.getMarker("overviewMap")}init(){Pn.isBrowser&&!this.cfg.context&&this.initDom(),this.initScene(),this.initRenderer(),this.initCamera(),this.initInputManager(),this.initEvents(),this.initControls()}initDom(){let e=this.cfg.containerId?document.getElementById(this.cfg.containerId):void 0,t=document.createElement("div");if(e)t.style.cssText="width: 100%; height: 100%;display: inline-block;position: relative; overflow: hidden;",e.appendChild(t);else{let e="x-viewer-overview-map";t.id=e,this.cfg.containerId=e,document.body.appendChild(t)}this.width=t.clientWidth,this.height=t.clientHeight,this.viewerContainer=t}initInputManager(){this.viewerContainer&&(this.inputManager=new mf(this.viewerContainer))}initScene(){let e=new Xi;e.background=null,e.matrixAutoUpdate=!1,e.matrixWorldAutoUpdate=!1,this.scene=e}initCamera(){if(!this.scene)return;let e=new Gi(-this.width/2,this.width/2,this.height/2,-this.height/2,.1,1e5);e.position.set(0,0,this.CAMERA_Z_POSITION),e.zoom=10,e.updateProjectionMatrix(),this.scene.add(e),this.camera=e,this.frustumSize=this.width}initRenderer(){var e;let{context:t}=this.cfg,r={context:t,antialias:!0,preserveDrawingBuffer:!0,alpha:!1,stencil:!1};!Pn.isBrowser&&t&&Object.assign(r,{context:t,canvas:Pn.creatReactNativeCanvas(t)}),t&&(this.width=t.drawingBufferWidth,this.height=t.drawingBufferHeight),this.renderer=new Ka(r),this.renderer.setClearColor(11119017,1),this.renderer.setClearAlpha(0),Pn.isBrowser&&(!t&&this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.domElement.classList.add("webgl-renderer"),null==(e=this.viewerContainer)||e.appendChild(this.renderer.domElement)),this.renderer.setSize(this.width,this.height),this.overlayRender=new Jr(this),this.overlayRender.addDrawableList(this.drawableList)}initControls(){let e=this.camera;if(!this.inputManager||!e)return;let t=new Gb(e,this.inputManager);t.enableRotate=!1,t.enabled=this.enabled,t.keyTruckSpeed=10,t.dollyToCursor=!0,t.dollySpeed=.1,t.truckSpeed=1,t.mouseButtons={left:kt.TRUCK,middle:kt.TRUCK,wheel:kt.ZOOM,right:kt.TRUCK},t.touches={one:kt.TOUCH_TRUCK,two:kt.TOUCH_ZOOM_TRUCK,three:kt.NONE},t.update(0),this.controls=t,t.addEventListener("control",this.onControlsChange()),t.addEventListener("update",this.onControlsUpdate())}onControlsChange(){return()=>{this.enableRender()}}onControlsUpdate(){return()=>{if(!this.camera||!this.cameraZoom||!this.initialZoom)return;let e=this.camera.zoom;or.areNumbersEqual(e,this.cameraZoom)||(this.cameraZoom=e,this.dispatchEvent("zoomchange",(e/this.initialZoom).toFixed(2)))}}initEvents(){var e,t,r,i,n,a;!this.enabled||this.lockCameraInViewCenter||(null==(e=this.inputManager)||e.addEventListener("pointermove",this.handlePointerMove),null==(t=this.inputManager)||t.addEventListener("pointerdown",this.handlePointerDown),null==(r=this.inputManager)||r.addEventListener("pointerup",this.handlePointerUp),null==(i=this.inputManager)||i.addEventListener("dblclick",this.handleDblClick),null==(n=this.inputManager)||n.addEventListener("pointerleave",this.handlePointerLeave),null==(a=this.inputManager)||a.addEventListener("pointerenter",this.handlePointerEnter))}getDrawableByEvent(e){var t;if(!this.camera||!this.groundPlane||!this.viewerContainer)return;let r=this.raycaster;if(!r)return;let i=Nr.getScreenCoordinateByEvent(e,this.viewerContainer),n=Nr.screen2Ndc(i,this.camera,this.viewerContainer);r.setFromCamera(n,this.camera);let a=r.intersectObject(this.groundPlane);if(0===a.length||!a[0].point)return;let s=null==(t=this.overlayRender)?void 0:t.getDrawablesByPosition(a[0].point);return s&&s.length>0?s[0]:void 0}onCameraHover(e){let t=this.cameraDrawable,r=this.cameraDirDrawable;if(!t||!r)return;t.hover=!1,r.hover=!1;let i=this.getDrawableByEvent(e);i&&i===r&&(r.hover=!0),i&&i===t&&(t.hover=!0),this.enableRender()}syncCamera(e,t){this.timeout&&clearTimeout(this.timeout),this.isUpdateWhenPawnMove=!1,this.dispatchEvent("synccamera",{location:e,direction:t}),this.dispatchEvent("camerachanged",e),this.timeout=setTimeout((()=>{this.timeout&&clearTimeout(this.timeout),this.isUpdateWhenPawnMove=!0}),500)}updateZoomFromRadius(){if(!this.camera||!this.radius||!this.controls)return;let e=this.controls;e.minZoom=0,e.maxZoom=1/0,e.update(0);let t=this.getContainerRadius(),r=this.camera.zoom*Number((t/this.radius).toFixed(2));this.controls.zoomTo(r)}getContainerRadius(){if(!this.viewerContainer)return;let e=this.viewerContainer,{width:t,height:r}=e.getBoundingClientRect();return this.size&&(t=this.size.width,r=this.size.height),this.screenDistance2WorldDistance(Math.min(t,r)/2)}screenDistance2WorldDistance(e){let t=this.camera,r=this.viewerContainer,i=Nr.screen2World(new Te(e,0),t,r),n=Nr.screen2World(new Te(0,0),t,r);return Math.abs(new Te(i.x,i.z).distanceTo(new Te(n.x,n.z)))}initGroundPlane(e){var t;Ut.expandBoxByScale(e,3);let r=e.min,i=e.max,n=i.x-r.x+i.y-r.y+i.z-r.z;Ut.expandBoxByMinSize(e,n);let a=[],s=(e,t,r)=>{a.push(new F(e,t,r))},o=e.getSize(new F),l=e.getCenter(new F);if(s(-o.x/2,0,-o.z/2),s(o.x/2,0,-o.z/2),s(o.x/2,0,o.z/2),s(-o.x/2,0,o.z/2),this.groundPlane)this.groundPlane.geometry.setFromPoints(a),this.groundPlane.geometry.computeBoundingSphere(),this.groundPlane.geometry.computeBoundingBox(),this.groundPlane.geometry.computeVertexNormals();else{let e=new Nt;e.setFromPoints(a),e.setIndex([0,3,2,0,2,1]),e.computeVertexNormals();let r=new Mr({color:"#888",transparent:!0,opacity:0,side:ln});this.groundPlane=new Ht(e,r),this.groundPlane.frustumCulled=!1,this.groundPlane.position.copy(l),this.groundPlane.scale.set(1e5,1e5,1),this.groundPlane.name="groundPlane",this.groundPlane.userData.selectable=!1,this.groundPlane.renderOrder=-1e3,this.groundPlane.layers.enableAll(),pn.disableLayerChannels(this.groundPlane,[12]),null==(t=this.scene)||t.add(this.groundPlane)}this.groundPlane.updateMatrixWorld()}initMaxAndMinZoom(){if(!this.controls)return;this.controls.update(0);let e=this.camera.zoom;this.controls.minZoom=e*this.minZoomFactor,this.controls.maxZoom=e*this.maxZoomFactor,this.initialZoom=e,this.cameraZoom=e}getImageElementFromUrl(e){let t=new Image;return t.src=e,new Promise(((e,r)=>{t.onload=()=>{e(t)},t.onerror=e=>{r(e)}}))}updateOverviewMap(e){return bt(this,null,(function*(){let t=new F,r=new F;t.set(e.min.x,e.min.y,e.min.z),r.set(e.max.x,e.max.y,e.max.z);let i=yield this.getImageElementFromUrl(e.image),n=new F(Math.min(t.x,r.x),0,Math.min(t.z,r.z)),a=new F(Math.max(t.x,r.x),0,Math.max(t.z,r.z)),s=new Vt(n,a);this.initGroundPlane(s.clone());let o=this.overviewMapDrawable;o?(o.image=i,o.radius=this.radius,o.max.copy(r),o.min.copy(t)):(this.zoomToBBox(s),this.updateZoomFromRadius(),this.initMaxAndMinZoom(),this.addMarker(new KD("overviewMap",{image:i,min:t,max:r,radius:this.radius}))),this.imgBBox=s,this.enableRender()}))}createCameraMarkers(e,t){return bt(this,null,(function*(){var r,i;if(!this.camera||!this.viewerContainer)return;let n=this.cameraDrawable,a=this.cameraDirDrawable;if(n)n.position.copy(e),null==(r=n.direction)||r.copy(t);else{let r=yield this.getImageElementFromUrl(DRe),i=yield this.getImageElementFromUrl(kRe);this.addMarker(new HS("cameraDirDrawable",{image:r,hoverImage:i,translate:new Te(-1,-.5),scale:.25,position:e,direction:t,enabledHover:this.enabled}))}if(a)a.position.copy(e),null==(i=a.direction)||i.copy(t);else{let r=yield this.getImageElementFromUrl(ORe),i=yield this.getImageElementFromUrl(LRe);this.addMarker(new HS("cameraDrawable",{image:r,hoverImage:i,translate:new Te(-.5,-.5),scale:.25,position:e,direction:t,enabledHover:this.enabled,renderOrder:-996}))}this.enableRender()}))}initCameraMarkers(e,t){return bt(this,null,(function*(){var r;let i=new F(e.x,e.y,e.z),n=new F(t.x,t.y,t.z);if(this.lockCameraInViewCenter){let e=this.camera;yield this.createCameraMarkers(e.position,n),i.setY(e.position.y),null==(r=this.controls)||r.setLookAt(i.x,i.y,i.z,i.x,0,i.z)}else yield this.createCameraMarkers(i,n)}))}updateOverviewMapCameraAnimation(){var e,t;let r=this.animationParam;if(!r)return void(this.animationId&&cancelAnimationFrame(this.animationId));let{startTime:i,positionStart:n,positionEnd:a,directionStart:s,directionEnd:o}=r,l=Math.min(1,(Date.now()-i)/500),h=n.lerp(a,l),c=null==s?void 0:s.lerp(o,l),u=this.cameraDrawable,d=this.cameraDirDrawable;if(c&&(null==(e=null==d?void 0:d.direction)||e.copy(c)),this.lockCameraInViewCenter?null==(t=this.controls)||t.setLookAt(h.x,h.y,h.z,h.x,0,h.z):(null==u||u.position.copy(h),null==d||d.position.copy(h)),this.enableRender(),1===l)return this.animationParam=void 0,void(this.animationId&&cancelAnimationFrame(this.animationId));this.animationId=requestAnimationFrame(this.updateOverviewMapCameraAnimation.bind(this))}updateOverviewMapCamera(e,t){var r;let i=this.cameraDrawable,n=this.cameraDirDrawable;if(!(this.camera&&this.viewerContainer&&i&&this.isUpdateWhenPawnMove))return;this.animationId&&cancelAnimationFrame(this.animationId);let a,s=new F(e.x,e.y,e.z),o=new F(t.x,t.y,t.z);this.lockCameraInViewCenter?(a=this.camera.position.clone(),s.setY(a.y)):a=i.position.clone();let l=Date.now(),h=null==(r=null==n?void 0:n.direction)?void 0:r.clone();this.animationParam={startTime:l,positionStart:a,positionEnd:s,directionStart:h,directionEnd:o},this.updateOverviewMapCameraAnimation(),this.dispatchEvent("camerachanged",s)}zoomToBBox(e){if(!this.scene||!this.camera||!this.controls)return;let t=this.camera,r=e.max.x-e.min.x,i=e.max.z-e.min.z,n=t.right-t.left,a=t.top-t.bottom,s=Math.min(n/r,a/i);this.controls.zoomTo(s);let o=new F;e.getCenter(o);let l=o.clone().setY(e.max.y+2);l.equals(o)||this.controls.setLookAt(l.x,l.y,l.z,o.x,o.y,o.z)}addMarker(e){this.drawableList.addDrawable(e),this.enableRender()}getMarker(e){return this.drawableList.getDrawableById(e)}removeMarker(e){this.drawableList.removeDrawable(e),this.enableRender()}dollyIn(e=.2){let t=this.camera;if(!t||!this.controls||!this.initialZoom)return;let r=t.zoom,i=Math.min(r+e*this.initialZoom,this.controls.maxZoom);this.controls.zoomTo(i)}dollyOut(e=.2){let t=this.camera;if(!t||!this.controls||!this.initialZoom)return;let r=t.zoom,i=Math.max(r-e*this.initialZoom,this.controls.minZoom);this.controls.zoomTo(i)}goToHomeView(){this.imgBBox&&this.zoomToBBox(this.imgBBox)}setRadius(e){this.radius=e;let t=this.overviewMapDrawable;t&&(t.radius=e),this.updateZoomFromRadius()}registerBoundaries(e){this.boundaries||(this.boundaries=new Map),e.forEach((e=>{var t;let r=e.points.map((e=>new Te(e.x,e.y)));null==(t=this.boundaries)||t.set(e.id,{id:e.id,name:e.name,polygon:r})}))}screenShot(){return bt(this,null,(function*(){var e;try{let t=yield null==(e=this.overlayRender)?void 0:e.getImage((()=>!0));return null==t?void 0:t.src}catch(e){return void de.error(e)}}))}getViewerConfig(){return this.cfg}is3d(){return!0}getRaycaster(){return this.raycaster}getPixelSizeInWorldCoord(){let e=this.camera,{clientWidth:t,clientHeight:r}=this.viewerContainer;return Math.max(e.right-e.left,e.top-e.bottom)/e.zoom/Math.max(t,r)}lookToAllMarkers(){var e,t;let r=new Vt;this.drawableList.getDrawables().forEach((e=>{if("overviewMap"===e.id||"cameraDrawable"===e.id||"cameraDirDrawable"===e.id||!this.camera||!this.viewerContainer)return;let t=e;r.union(t.getBBox())})),r.min.setY(0),r.max.setY(0);let i=r.min.distanceTo(r.max);r.expandByVector(new F(.01*i,0,.01*i)),or.areVector3sEqual(null==(e=this.allMarkersBBox)?void 0:e.min,r.min)&&or.areVector3sEqual(null==(t=this.allMarkersBBox)?void 0:t.max,r.max)?this.enableLookToAllMarkers=!1:(this.allMarkersBBox=r,this.zoomToBBox(r))}resize(e,t){let r=this.camera;if(r&&t>0){let i=e/t;r.left=-this.frustumSize/2,r.right=this.frustumSize/2,r.top=this.frustumSize/i/2,r.bottom=-this.frustumSize/i/2,r.updateProjectionMatrix(),this.renderer&&this.renderer.setSize(e,t,!0),this.overlayRender&&this.overlayRender.setSize(e,t)}this.width=e,this.height=t,this.enableRender()}destroy(){var e,t,r;this.raycaster=void 0,null==(e=this.inputManager)||e.removeEventListener(),this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=void 0),this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0),this.drawableList.clear(),null==(t=this.viewerContainer)||t.remove(),this.viewerContainer=void 0,null==(r=this.scene)||r.clear(),this.scene=void 0,this.requestAnimationFrameHandle&&(cancelAnimationFrame(this.requestAnimationFrameHandle),this.requestAnimationFrameHandle=void 0),this.renderer&&(this.renderer.domElement.remove(),this.renderer.clear(),this.renderer.dispose(),this.renderer.forceContextLoss(),this.renderer=void 0),this.overlayRender&&(this.overlayRender.destroy(),this.overlayRender=void 0),this.camera=void 0,this.controls&&(this.controls.dispose(),this.controls=void 0),this.groundPlane&&(this.groundPlane.geometry.dispose(),this.groundPlane.clear(),this.groundPlane=void 0),this.removeEventListener()}},tj=rj;tj.DEFAULT_ID="OverviewMapPlugin";var FRe=class extends Ki{constructor(e,t){super(e),this.needsFrustumCulled=!1,this.text=t.text,this.position=t.position,this.offset=t.offset||new Te,this.textStyle=t.textStyle||{},this.radius=t.radius,this.displayRadius=t.displayRadius||1/0,this.size=t.size||{width:0,height:0},this.renderOrder=t.renderOrder||-998}getFont(){let e=this.textStyle,t="";return t+=(e.fontSize?e.fontSize:12)+"px ",t+=e.fontWeight?e.fontWeight+" ":"",t+=e.fontFamily?e.fontFamily:"Arial",t}drawRoundRect(e,t,r,i,n,a,s){let o=this.textStyle,l=Math.min(o.borderRadius||0,i/2,n/2);e.save(),o.backgroundColor&&(e.fillStyle=o.backgroundColor),o.borderColor&&(e.strokeStyle=o.borderColor),o.borderWidth&&(e.lineWidth=o.borderWidth),this.radius&&s&&(e.beginPath(),e.arc(a.x,a.y,this.radius/this.tolerance,0,2*Math.PI,!0),e.clip(),e.closePath()),e.beginPath(),e.moveTo(t+l,r),e.arcTo(t+i,r,t+i,r+n,l),e.arcTo(t+i,r+n,t,r+n,l),e.arcTo(t,r+n,t,r,l),e.arcTo(t,r,t+i,r,l),o.borderWidth&&e.stroke(),o.backgroundColor&&e.fill(),e.closePath(),e.restore()}draw(e,t){let r=this.textStyle,i=new F(this.position.x,this.position.y,this.position.z),n=!1;if(this.radius){let e=new Te(i.x,i.z),r=new Te(t.position.x,t.position.z),a=e.distanceTo(r);a>this.radius&&a<this.displayRadius?i.lerp(t.position,1-this.radius/a):n=!0}let a=this.transToScreenCoord(i,t),s=this.getFont(),o=r.fontSize?r.fontSize:12;e.font=s,e.textAlign="center",e.textBaseline="middle";let l=e.measureText(this.text).width,h=o;r.outlineWidth&&(e.lineWidth=r.outlineWidth,e.strokeStyle=r.outlineColor||"black");let c=new Te(this.offset.x,this.offset.y),u=this.transToScreenCoord(t.position,t);(r.borderWidth||r.backgroundColor)&&(l=1.2*l<this.size.width?this.size.width:1.2*l,h=1.5*h<this.size.height?this.size.height:1.5*h,this.drawRoundRect(e,a.x+(c.x-.5)*l,a.y+(c.y-.5)*h,l,h,u,n)),e.save(),e.beginPath(),this.radius&&n&&(e.arc(u.x,u.y,this.radius/this.tolerance,0,2*Math.PI,!0),e.clip()),r.outlineWidth&&e.strokeText(this.text,a.x+c.x*l,a.y+c.y*h),e.fillStyle=r.fontColor||"white",e.fillText(this.text,a.x+c.x*l,a.y+c.y*h),e.restore(),this.width=l*this.tolerance,this.height=h*this.tolerance}drawSelect(){}getClassType(){return"TextMarker"}isPointInPath(){return!1}getBBox(){let e=new F(this.position.x,this.position.y,this.position.z),t=new Vt;return t.min.x=e.x+(this.offset.x-.5)*this.width,t.min.y=e.y,t.min.z=e.z+(this.offset.y-.5)*this.height,t.max.x=e.x+(this.offset.x+.5)*this.width,t.max.y=e.y,t.max.z=e.z+(this.offset.y+.5)*this.height,t}},BRe=class extends Ki{constructor(e,t){super(e),this.needsFrustumCulled=!1,this.positions=t.positions,this.lineWidth=t.lineWidth||1,this.lineColor=t.lineColor||[0,0,0,1],this.renderOrder=t.renderOrder||-999}draw(e,t){let r=this.positions.map((e=>{let r=new F(e.x,e.y,e.z);return this.transToScreenCoord(r,t)}));e.save(),e.beginPath(),e.lineWidth=this.lineWidth,e.strokeStyle=Br.rgba2Color(this.lineColor),r.forEach(((t,r)=>{0===r?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y)})),e.stroke(),e.restore()}drawSelect(){}getClassType(){return"LineDrawable"}isPointInPath(){return!1}getBBox(){let e=this.positions.map((e=>new F(e.x,e.y,e.z)));return(new Vt).setFromPoints(e)}};window.THREE=Kt;export{h8 as ArrowMarkup,kq as AxisGizmoPlugin,MD as AxisPlaneSection,IAe as AxisType,gD as BaseDxfCompareHelper,Jn as BaseMeasureDrawable,td as BaseMeasurement,Am as BaseSection,nm as BaseViewer,Ub as BimTilesModel,oD as BimTilesRenderer,Cf as BimTilesViewer,Mc as BinaryReader,tAe as BottomBarPlugin,rm as BoxSelectHelper,ib as ByBlock,nb as ByLayer,_P as CSS2DObjectUtils,o0 as CameraProjection,Qve as CancelablePromise,Jr as CanvasRender,d8 as CircleMarkup,Eu as CloudLineMarkup,f8 as CloudRectMarkup,Br as ColorUtils,Ut as CommonUtils,U0 as CompareDrawable,L1 as Container,iAe as ContextMenuItems,sAe as ContextMenuPlugin,h0 as ControlsMode,Nr as CoordinateUtils,MP as DefaultCameraFar,lye as DefaultCameraFov,SP as DefaultCameraNear,ARe as DefaultMarkupToolbarConfig,Ph as DefaultOpacity,PRe as DefaultViewer2dToolbarConfig,iXt as DefaultViewer3dConfig,CRe as DefaultViewer3dToolbarConfig,Pn as DeviceUtils,p8 as DotMarkup,Ki as Drawable,Ol as DrawableList,yG as DxfChangeType,Ea as DxfCompare,YMe as DxfCompareHelper,XMe as DxfCompareMarkupManager,Qr as DxfLoader,_0 as DxfParser,p_e as DxfRenderOrder,Ou as DxfUtils,CP as EdgeUtils,m8 as EllipseMarkup,ba as Event,MS as ExplodePlugin,Op as ExportUtils,kl as FontManager,Eye as FpsUtils,wI as GenerateMeshBvhWorker,pr as GeometryUtils,AS as GroundGrassPlugin,RS as GroundGridPlugin,DPt as GroundPlaneRenderOrder,n9 as GroundShadowPlugin,qD as GroupConfig,wP as HighlightColor,u7t as HighlightColorRgba,kAe as HotpointPlugin,AP as IconfontClass,Yi as IconfontClass2,HS as ImageDrawable,mf as InputManager,zxe as InstantiateHelper,TP as LayerForHitableObjects,Li as LayerForSelectableObjects,Zs as LayerForSnapableObjects,t9 as LayerManagerPlugin,g8 as LeaderLineMarkup,jn as Line,BRe as LineDrawable,lI as LinePatternShaders,Lu as LoadingHelper,ERe as LocalDxfUploader,CD as LocalModelUploader,RRe as MarkupGroupConfig,If as MarkupPlugin,kPt as MarkupPluginEvent,jD as MarkupToolbar,So as MarkupType,$i as MaterialUtils,or as MathUtils,rs as MatrixAutoUpdate,Pf as MeasurementPlugin,Gc as MeasurementType,GD as MenuTypeEnums,Zi as MergeUtils,Ht as Mesh,SI as MeshBvhHelper,LI as MobileTouchHelperDrawable,sm as Model,Lc as Model2d,fb as Model3d,B9 as NavCubePlugin,b0 as NestedCompareTypes,PI as OSnapHelper,Cqt as OSnapIconSize,b1e as OSnapMarkerType,PG as OSnapType,F_e as ObjectPixelSizeHelper,pn as ObjectUtils,AD as ObjectsBoxSection,KMe as Offset,p3 as OrbitControls,Q_ as OutlineColorRgba,KD as OverviewMapDrawable,tj as OverviewMapPlugin,k3t as OverviewMapPluginEvent,Rm as PdfLoader,kS as PdfLoaderPlugin,II as PickMarkupHelper,RD as PickPlaneSection,m3 as PlanControls,vn as Plugin,Di as Points,r0 as PolygonUtils,v8 as PolylineMarkup,k1 as ProgressBar,K1 as RafHelper,y8 as RectMarkup,y1e as SVGObjectUtils,bc as SceneUtils,x3t as ScreenshotMode,Mm as ScreenshotPlugin,Yu as SectionPlugin,Qq as SectionType,Ih as SectionUtils,zr as ShaderChunk,v1e as SimplifyUtils,H9 as SkyboxPlugin,Ks as SnapDrawable,o3 as Spinner,MRe as StatsPlugin,FRe as TextDrawable,xc as TextMarkup,S1e as TextMarkupEvent,kp as TextureUtils,RP as ThresholdAngleForEdge,Cm as Toolbar,G9 as ToolbarMenu,z9 as ToolbarMenuId,x1e as UnitConversionByMeter,cxt as UnitLabels,YZt as UnitScaleConversion,x_e as UnitScaleToMeter,hI as Units,Q9 as ViewCubePlugin,Em as Viewer2d,X9 as Viewer2dToolbarPlugin,ju as Viewer3d,OAe as Viewer3dDatGuiPlugin,qMe as Viewer3dLite,$9 as Viewer3dToolbarPlugin,QP as Viewer3dUtils,Fi as ViewerEvent,LPt as ViewerMode,Fp as ViewerName,u8 as Views,b8 as XMarkup,DI as ZoomToRectHelper,b_e as bspline,Lxe as checkIsNewVersion,Uye as cn,v_e as createHatchPatternShaderMaterial,qMt as decodeDxfTextCharacterCodes,WMt as decodeDxfTextMbcsCharacterCodes,jMt as decodeDxfTextUnicodeCodePoints,Nye as en,Bqt as getLengthValueByUnit,fT as getUnitStr,uSt as getVersionFromLocalStorage,de as log,cI as parseDxfMTextContent,uI as parseDxfTextContent,y_e as round10,EP as setIcon,rye as setLogLevel,hSt as setVersionToLocalStorage,Ch as showPrecisionValue};